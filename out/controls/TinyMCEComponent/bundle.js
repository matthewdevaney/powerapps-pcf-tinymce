/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
var pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad;
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./TinyMCEComponent/index.ts":
/*!***********************************!*\
  !*** ./TinyMCEComponent/index.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TinyMCEComponent: () => (/* binding */ TinyMCEComponent)\n/* harmony export */ });\nclass TinyMCEComponent {\n  constructor() {\n    this.ID = function () {\n      // Math.random should be unique because of its seeding algorithm.\n      // Convert it to base 36 (numbers + letters), and grab the first 9 characters\n      // after the decimal.\n      return '_' + Math.random().toString(36).substr(2, 9);\n    };\n    this._tinymce = __webpack_require__(/*! tinymce/tinymce */ \"./node_modules/tinymce/tinymce.js\");\n    __webpack_require__(/*! tinymce/themes/silver */ \"./node_modules/tinymce/themes/silver/index.js\");\n    __webpack_require__(/*! tinymce/icons/default */ \"./node_modules/tinymce/icons/default/index.js\");\n    // Any plugins you want to use has to be imported\n    __webpack_require__(/*! tinymce/plugins/paste */ \"./node_modules/tinymce/plugins/paste/index.js\");\n    __webpack_require__(/*! tinymce/plugins/link */ \"./node_modules/tinymce/plugins/link/index.js\");\n    __webpack_require__(/*! tinymce/plugins/autoresize */ \"./node_modules/tinymce/plugins/autoresize/index.js\");\n    __webpack_require__(/*! tinymce/plugins/code */ \"./node_modules/tinymce/plugins/code/index.js\");\n    __webpack_require__(/*! tinymce/plugins/lists */ \"./node_modules/tinymce/plugins/lists/index.js\");\n    ;\n    __webpack_require__(/*! tinymce/plugins/table */ \"./node_modules/tinymce/plugins/table/index.js\");\n  }\n  /**\r\n   * Used to initialize the control instance. Controls can kick off remote server calls and other initialization actions here.\r\n   * Data-set values are not initialized here, use updateView.\r\n   * @param context The entire property bag available to control via Context Object; It contains values as set up by the customizer mapped to property names defined in the manifest, as well as utility functions.\r\n   * @param notifyOutputChanged A callback method to alert the framework that the control has new outputs ready to be retrieved asynchronously.\r\n   * @param state A piece of data that persists in one session for a single user. Can be set at any point in a controls life cycle by calling 'setControlState' in the Mode interface.\r\n   * @param container If a control is marked control-type='standard', it will receive an empty div element within which it can render its content.\r\n   */\n  init(context, notifyOutputChanged, state, container) {\n    this._context = context;\n    this._notifyOutputChanged = notifyOutputChanged;\n    this._fontFamily = this._context.parameters.fontFamily.raw || \"\";\n    this._fontSize = Number(this._context.parameters.fontSize.raw) || 12;\n    this._autoResize = Boolean(this._context.parameters.autoResize.raw) || false;\n    this._editorHeight = this._context.parameters.editorHeight.raw || \"100%\";\n    this._container = container;\n    this._domId = this.ID();\n    this._textEditor = document.createElement(\"textarea\");\n    this._textEditor.setAttribute(\"id\", \"text_editor\" + this._domId);\n    this._textEditor.innerHTML = this._context.parameters.htmlText.raw || \"\";\n    this._container.appendChild(this._textEditor);\n    container = this._container;\n    // Add control initialization code\n    this.loadWidget();\n  }\n  loadWidget() {\n    var plugins = ['code', 'link', 'lists', 'paste', 'table'];\n    if (this._autoResize) {\n      plugins.push('autoresize');\n    }\n    this.addCrossOriginShim();\n    this._tinymce.init({\n      selector: '#text_editor' + this._domId,\n      width: \"100%\",\n      height: this._editorHeight || \"100%\",\n      menubar: false,\n      statusbar: false,\n      font_formats: \"Arial=arial,sans-serif; Arial Black=arial black,avant garde; Arial Bold Italic=arial bold italic, arial, sans-serif; Arial Bold=arial bold, arial, sans-serif; Arial Italic=arial italic, arial, sans-serif; Arial Narrow Bold Italic=arial narrow bold italic, arial, sans-serif; Arial Narrow Bold=arial narrow bold, arial, sans-serif; Arial Narrow Italic=arial narrow italic, arial, sans-serif; Arial Narrow Italic=arial narrow italic, arial, sans-serif; Arial Narrow=arial narrow, arial, sans-serif; Arial Unicode MS=arial unicode ms, arial, sans-serif; Batang=batang, arial, sans-serif; BatangChe=batangche, arial, sans-serif; Calibri Bold Italic=calibri bold italic, arial, sans-serif; Calibri Bold=calibri bold, arial, sans-serif; Calibri Italic=calibri italic, arial, sans-serif; Calibri Light Italic=calibri light italic, arial, sans-serif; Calibri Light=calibri light, arial, sans-serif; Calibri=calibri, arial, sans-serif; Cambria Bold Italic=cambria bold italic, arial, sans-serif; Cambria Bold=cambria bold, arial, sans-serif; Cambria Italic=cambria italic, arial, sans-serif; Cambria Math=cambria math, arial, sans-serif; Cambria=cambria, arial, sans-serif; Century Gothic=century gothic, arial, sans-serif; Comic Sans MS Bold Italic=comic sans ms bold italic, sans-serif; Comic Sans MS Bold=comic sans ms bold, sans-serif; Comic Sans MS Italic=comic sans ms italic, sans-serif; Comic Sans MS=comic sans ms, sans-serif; Consolas Bold Italic=consolas bold italic, arial, sans-serif; Consolas Bold=consolas bold, arial, sans-serif; Consolas Italic=consolas italic, arial, sans-serif; Consolas=consolas, arial, sans-serif; Courier New Bold Italic=courier new bold italic,courier; Courier New Bold=courier new bold,courier; Courier New Italic=courier new italic,courier; Courier New=courier new,courier; Dotum=dotum, arial, sans-serif; DotumChe=dotumche, arial, sans-serif; Ebrima Bold=ebrima bold, arial, sans-serif; Ebrima=ebrima, arial, sans-serif; Edwardian Script ITC=edwardian script itc, arial, sans-serif; Freestyle Script=freestyle script, arial, sans-serif; Gadugi=gadugi, arial, sans-serif; Garamond=garamond, arial, sans-serif; Georgia Bold Italic=georgia bold italic,palatino; Georgia Bold=georgia bold,palatino; Georgia Italic=georgia italic,palatino; Georgia=georgia,palatino; Gulim=gulim, arial, sans-serif; GulimChe=gulimche, arial, sans-serif; Gungsuh=gungsuh, arial, sans-serif; GungsuhChe=gungsuhche, arial, sans-serif; Javanese Text=javanese text, arial, sans-serif; Leelawadee UI Bold=leelawadee ui bold, arial, sans-serif; Leelawadee UI Semilight=leelawadee ui semilight, arial, sans-serif; Leelawadee UI=leelawadee ui, arial, sans-serif; Lucida Console=lucida console, arial, sans-serif; Malgun Gothic=malgun gothic, arial, sans-serif; Microsoft Himalaya=microsoft himalaya, arial, sans-serif; Microsoft JhengHei UI=microsoft jhenghei ui, arial, sans-serif; Microsoft JhengHei=microsoft jhenghei, arial, sans-serif; Microsoft New Tai Lue=microsoft new tai lue, arial, sans-serif; Microsoft PhagsPa=microsoft phagspa, arial, sans-serif; Microsoft Tai Le=microsoft tai le, arial, sans-serif; Microsoft YaHei UI=microsoft yahei ui, arial, sans-serif; Microsoft YaHei=microsoft yahei, arial, sans-serif; Microsoft Yi Baiti=microsoft yi baiti, arial, sans-serif; Mongolian Baiti=mongolian baiti, arial, sans-serif; MV Boli=mv boli, arial, sans-serif; Myanmar Text=myanmar text, arial, sans-serif; Nirmala UI Bold=nirmala ui bold, arial, sans-serif; Nirmala UI Semilight=nirmala ui semilight, arial, sans-serif; Nirmala UI=nirmala ui, arial, sans-serif; NSimSun=nsimsun, arial, sans-serif; Segoe MDL2 Assets=segoe mdl2 assets, arial, sans-serif; Segoe Print=segoe print, arial, sans-serif; Segoe UI Black=segoe ui black, arial, sans-serif; Segoe UI Bold Italic=segoe ui bold italic, arial, sans-serif; Segoe UI Bold=segoe ui bold, arial, sans-serif; Segoe UI Emoji=segoe ui emoji, arial, sans-serif; Segoe UI Historic=segoe ui historic, arial, sans-serif; Segoe UI Italic=segoe ui italic, arial, sans-serif; Segoe UI Light=segoe ui light, arial, sans-serif; Segoe UI Semibold=segoe ui semibold, arial, sans-serif; Segoe UI Semilight=segoe ui semilight, arial, sans-serif; Segoe UI Symbol=segoe ui symbol, arial, sans-serif; Segoe UI=segoe ui, arial, sans-serif; SimSun=simsun, arial, sans-serif; Source Code Pro Black Italic=source code pro black italic, arial, sans-serif; Source Code Pro Black=source code pro black, arial, sans-serif; Source Code Pro Bold Italic=source code pro bold italic, arial, sans-serif; Source Code Pro Bold=source code pro bold, arial, sans-serif; Source Code Pro ExtraLight Italic=source code pro extralight italic, arial, sans-serif; Source Code Pro ExtraLight=source code pro extralight, arial, sans-serif; Source Code Pro Italic=source code pro italic, arial, sans-serif; Source Code Pro Light Italic=source code pro light italic, arial, sans-serif; Source Code Pro Light=source code pro light, arial, sans-serif; Source Code Pro Medium Italic=source code pro medium italic, arial, sans-serif; Source Code Pro Medium=source code pro medium, arial, sans-serif; Source Code Pro Semibold Italic=source code pro semibold italic, arial, sans-serif; Source Code Pro Semibold=source code pro semibold, arial, sans-serif; Source Code Pro=source code pro, arial, sans-serif; Source Sans Pro Black Italic=source sans pro black italic, arial, sans-serif; Source Sans Pro Black=source sans pro black, arial, sans-serif; Source Sans Pro Bold Italic=source sans pro bold italic, arial, sans-serif; Source Sans Pro Bold=source sans pro bold, arial, sans-serif; Source Sans Pro ExtraLight Italic=source sans pro extralight italic, arial, sans-serif; Source Sans Pro ExtraLight=source sans pro extralight, arial, sans-serif; Source Sans Pro Italic=source sans pro italic, arial, sans-serif; Source Sans Pro Light Italic=source sans pro light italic, arial, sans-serif; Source Sans Pro Light=source sans pro light, arial, sans-serif; Source Sans Pro Semibold Italic=source sans pro semibold italic, arial, sans-serif; Source Sans Pro Semibold=source sans pro semibold, arial, sans-serif; Source Sans Pro=source sans pro, arial, sans-serif; Symbol=symbol; Tahoma=tahoma,arial,helvetica,sans-serif; Times New Roman Bold Italic=times new roman bold italic, times; Times New Roman Bold=times new roman bold, times; Times New Roman Italic=times new roman italic, times; Times New Roman=times new roman, times; Trebuchet MS Bold Italic=trebuchet ms bold italic, geneva; Trebuchet MS Bold=trebuchet ms bold, geneva; Trebuchet MS Italic=trebuchet ms italic, geneva; Trebuchet MS=trebuchet ms, geneva; Verdana Bold Italic=verdana bold italic,geneva; Verdana Bold=verdana bold,geneva; Verdana Italic=verdana italic,geneva; Verdana=verdana,geneva; Webdings=webdings, zapf dingbats Wingdings 3=wingdings 3, zapf dingbats Wingdings=wingdings, zapf dingbats Yu Gothic Medium=yu gothic medium, arial, sans-serif; Yu Gothic UI Regular=yu gothic ui regular, arial, sans-serif;\",\n      content_style: \"body { font-family: \" + this._fontFamily + \"; font-size: \" + this._fontSize + \"pt; }\",\n      plugins: plugins,\n      toolbar: \"undo redo | fontselect fontsizeselect  forecolor stylesbold italic underline removeformat | alignleft aligncenter alignright alignjustify lineheight | bullist numlist outdent indent | format | table | help\",\n      setup: ed => {\n        ed.on('change', e => {\n          this._notifyOutputChanged();\n        });\n        ed.on('init', e => {\n          ed.execCommand(\"fontName\", true, this._fontFamily);\n          ed.execCommand(\"fontSize\", true, this._fontSize + \"pt\");\n        });\n      }\n    });\n  }\n  /**\r\n   * This is a supportable hack that's necessary to ensure that cross origin frames don't interfere with the TinyMCE editor.\r\n   * The TinyMCE editor includes an implementation of the 'on' JQuery method to add event listeners to the window object.\r\n   * The implementation iterates over all windows in the DOM, some of which in the case of a Custom Page are cross-origin.\r\n   * When attempting to access properties on the cross-origin window, an error is thrown and the execution of the script is halted.\r\n   * There's no supported method for detecting this prior to the error being thrown, so the only way to handle this is to catch the error and continue as below.\r\n   * The error is logged to the console for debugging purposes.\r\n   */\n  addCrossOriginShim() {\n    var eventUtils = this._tinymce.dom.EventUtils.Event;\n    this._tinymce.$.fn.on = function (name, callback) {\n      this.each(function (index, window) {\n        try {\n          eventUtils.bind(window, name, callback);\n        } catch (error) {\n          // Continue with the execution\n          console.log('Error adding handler for ' + name + ': ' + error);\n        }\n      });\n    };\n  }\n  /**\r\n   * Called when any value in the property bag has changed. This includes field values, data-sets, global values such as container height and width, offline status, control metadata values such as label, visible, etc.\r\n   * @param context The entire property bag available to control via Context Object; It contains values as set up by the customizer mapped to names defined in the manifest, as well as utility functions\r\n   */\n  updateView(context) {\n    // Add code to update control view\n    this._context = context;\n    var editor = this._tinymce.get('text_editor' + this._domId);\n    // Check if any property values have changed\n    if (this._context.updatedProperties.indexOf(\"htmlText\") > -1) {\n      // If the boundHTML property has changed, update the editor\n      this._textValue = this._context.parameters.htmlText.raw || \"\";\n      if (editor && editor.getContent() !== this._textValue && this._context.parameters.htmlText !== null && this._context.parameters.htmlText.raw !== null) {\n        editor.setContent(this._textValue);\n      }\n    } else {\n      if (editor.getContent() !== this._textValue) {\n        // If the editor has changed, update the output property\n        this._notifyOutputChanged();\n      }\n    }\n    // Only update if one of these values has changed\n    if (this._context.updatedProperties.indexOf(\"autoResize\") > -1 || this._context.updatedProperties.indexOf(\"editorHeight\") > -1 || this._context.updatedProperties.indexOf(\"fontFamily\") > -1 || this._context.updatedProperties.indexOf(\"fontSize\") > -1) {\n      this._fontFamily = this._context.parameters.fontFamily.raw || \"\";\n      this._autoResize = Boolean(this._context.parameters.autoResize.raw) || false;\n      this._fontSize = Number(this._context.parameters.fontSize.raw) || 12;\n      this._editorHeight = this._context.parameters.editorHeight.raw || \"100%\";\n      if (editor) {\n        editor.remove();\n      }\n      // Reinitialize TinyMCE with the new height\n      this.loadWidget();\n    }\n  }\n  /**\r\n   * It is called by the framework prior to a control receiving new data.\r\n   * @returns an object based on nomenclature defined in manifest, expecting object[s] for property marked as “bound” or “output”\r\n   */\n  getOutputs() {\n    var editor = this._tinymce.get('text_editor' + this._domId);\n    return {\n      htmlText: editor.getContent()\n    };\n  }\n  /**\r\n   * Called when the control is to be removed from the DOM tree. Controls should use this call for cleanup.\r\n   * i.e. cancelling any pending remote calls, removing listeners, etc.\r\n   */\n  destroy() {\n    // Add code to cleanup control if necessary\n  }\n}\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./TinyMCEComponent/index.ts?");

/***/ }),

/***/ "./node_modules/tinymce/icons/default/icons.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/icons/default/icons.js ***!
  \*****************************************************/
/***/ (() => {

eval("tinymce.IconManager.add('default', {\n  icons: {\n    'accessibility-check': '<svg width=\"24\" height=\"24\"><path d=\"M12 2a2 2 0 012 2 2 2 0 01-2 2 2 2 0 01-2-2c0-1.1.9-2 2-2zm8 7h-5v12c0 .6-.4 1-1 1a1 1 0 01-1-1v-5c0-.6-.4-1-1-1a1 1 0 00-1 1v5c0 .6-.4 1-1 1a1 1 0 01-1-1V9H4a1 1 0 110-2h16c.6 0 1 .4 1 1s-.4 1-1 1z\" fill-rule=\"nonzero\"/></svg>',\n    'action-next': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M5.7 7.3a1 1 0 00-1.4 1.4l7.7 7.7 7.7-7.7a1 1 0 10-1.4-1.4L12 13.6 5.7 7.3z\"/></svg>',\n    'action-prev': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M18.3 15.7a1 1 0 001.4-1.4L12 6.6l-7.7 7.7a1 1 0 001.4 1.4L12 9.4l6.3 6.3z\"/></svg>',\n    'align-center': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm3 4h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 110-2zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2zm-3-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2z\" fill-rule=\"evenodd\"/></svg>',\n    'align-justify': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2z\" fill-rule=\"evenodd\"/></svg>',\n    'align-left': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm0 4h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2zm0-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2z\" fill-rule=\"evenodd\"/></svg>',\n    'align-none': '<svg width=\"24\" height=\"24\"><path d=\"M14.2 5L13 7H5a1 1 0 110-2h9.2zm4 0h.8a1 1 0 010 2h-2l1.2-2zm-6.4 4l-1.2 2H5a1 1 0 010-2h6.8zm4 0H19a1 1 0 010 2h-4.4l1.2-2zm-6.4 4l-1.2 2H5a1 1 0 010-2h4.4zm4 0H19a1 1 0 010 2h-6.8l1.2-2zM7 17l-1.2 2H5a1 1 0 010-2h2zm4 0h8a1 1 0 010 2H9.8l1.2-2zm5.2-13.5l1.3.7-9.7 16.3-1.3-.7 9.7-16.3z\" fill-rule=\"evenodd\"/></svg>',\n    'align-right': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm6 4h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm-6-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2z\" fill-rule=\"evenodd\"/></svg>',\n    'arrow-left': '<svg width=\"24\" height=\"24\"><path d=\"M5.6 13l12 6a1 1 0 001.4-1V6a1 1 0 00-1.4-.9l-12 6a1 1 0 000 1.8z\" fill-rule=\"evenodd\"/></svg>',\n    'arrow-right': '<svg width=\"24\" height=\"24\"><path d=\"M18.5 13l-12 6A1 1 0 015 18V6a1 1 0 011.4-.9l12 6a1 1 0 010 1.8z\" fill-rule=\"evenodd\"/></svg>',\n    'bold': '<svg width=\"24\" height=\"24\"><path d=\"M7.8 19c-.3 0-.5 0-.6-.2l-.2-.5V5.7c0-.2 0-.4.2-.5l.6-.2h5c1.5 0 2.7.3 3.5 1 .7.6 1.1 1.4 1.1 2.5a3 3 0 01-.6 1.9c-.4.6-1 1-1.6 1.2.4.1.9.3 1.3.6s.8.7 1 1.2c.4.4.5 1 .5 1.6 0 1.3-.4 2.3-1.3 3-.8.7-2.1 1-3.8 1H7.8zm5-8.3c.6 0 1.2-.1 1.6-.5.4-.3.6-.7.6-1.3 0-1.1-.8-1.7-2.3-1.7H9.3v3.5h3.4zm.5 6c.7 0 1.3-.1 1.7-.4.4-.4.6-.9.6-1.5s-.2-1-.7-1.4c-.4-.3-1-.4-2-.4H9.4v3.8h4z\" fill-rule=\"evenodd\"/></svg>',\n    'bookmark': '<svg width=\"24\" height=\"24\"><path d=\"M6 4v17l6-4 6 4V4c0-.6-.4-1-1-1H7a1 1 0 00-1 1z\" fill-rule=\"nonzero\"/></svg>',\n    'border-style': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><rect width=\"18\" height=\"2\" x=\"3\" y=\"6\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"3\" y=\"16\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"6.8\" y=\"16\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"10.6\" y=\"16\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"14.4\" y=\"16\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"18.2\" y=\"16\" rx=\"1\"/><rect width=\"8\" height=\"2\" x=\"3\" y=\"11\" rx=\"1\"/><rect width=\"8\" height=\"2\" x=\"13\" y=\"11\" rx=\"1\"/></g></svg>',\n    'border-width': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><rect width=\"18\" height=\"5\" x=\"3\" y=\"5\" rx=\"1\"/><rect width=\"18\" height=\"3.5\" x=\"3\" y=\"11.5\" rx=\"1\"/><rect width=\"18\" height=\"2\" x=\"3\" y=\"17\" rx=\"1\"/></g></svg>',\n    'brightness': '<svg width=\"24\" height=\"24\"><path d=\"M12 17c.3 0 .5.1.7.3.2.2.3.4.3.7v1c0 .3-.1.5-.3.7a1 1 0 01-.7.3 1 1 0 01-.7-.3 1 1 0 01-.3-.7v-1c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3zm0-10a1 1 0 01-.7-.3A1 1 0 0111 6V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7v1c0 .3-.1.5-.3.7a1 1 0 01-.7.3zm7 4c.3 0 .5.1.7.3.2.2.3.4.3.7 0 .3-.1.5-.3.7a1 1 0 01-.7.3h-1a1 1 0 01-.7-.3 1 1 0 01-.3-.7c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h1zM7 12c0 .3-.1.5-.3.7a1 1 0 01-.7.3H5a1 1 0 01-.7-.3A1 1 0 014 12c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h1c.3 0 .5.1.7.3.2.2.3.4.3.7zm10 3.5l.7.8c.2.1.3.4.3.6 0 .3-.1.6-.3.8a1 1 0 01-.8.3 1 1 0 01-.6-.3l-.8-.7a1 1 0 01-.3-.8c0-.2.1-.5.3-.7a1 1 0 011.4 0zm-10-7l-.7-.8a1 1 0 01-.3-.6c0-.3.1-.6.3-.8.2-.2.5-.3.8-.3.2 0 .5.1.7.3l.7.7c.2.2.3.5.3.8 0 .2-.1.5-.3.7a1 1 0 01-.7.3 1 1 0 01-.8-.3zm10 0a1 1 0 01-.8.3 1 1 0 01-.7-.3 1 1 0 01-.3-.7c0-.3.1-.6.3-.8l.8-.7c.1-.2.4-.3.6-.3.3 0 .6.1.8.3.2.2.3.5.3.8 0 .2-.1.5-.3.7l-.7.7zm-10 7c.2-.2.5-.3.8-.3.2 0 .5.1.7.3a1 1 0 010 1.4l-.8.8a1 1 0 01-.6.3 1 1 0 01-.8-.3 1 1 0 01-.3-.8c0-.2.1-.5.3-.6l.7-.8zM12 8a4 4 0 013.7 2.4 4 4 0 010 3.2A4 4 0 0112 16a4 4 0 01-3.7-2.4 4 4 0 010-3.2A4 4 0 0112 8zm0 6.5c.7 0 1.3-.2 1.8-.7.5-.5.7-1.1.7-1.8s-.2-1.3-.7-1.8c-.5-.5-1.1-.7-1.8-.7s-1.3.2-1.8.7c-.5.5-.7 1.1-.7 1.8s.2 1.3.7 1.8c.5.5 1.1.7 1.8.7z\" fill-rule=\"evenodd\"/></svg>',\n    'browse': '<svg width=\"24\" height=\"24\"><path d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2h-4v-2h4V8H5v10h4v2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-8 9.4l-2.3 2.3a1 1 0 11-1.4-1.4l4-4a1 1 0 011.4 0l4 4a1 1 0 01-1.4 1.4L13 13.4V20a1 1 0 01-2 0v-6.6z\" fill-rule=\"nonzero\"/></svg>',\n    'cancel': '<svg width=\"24\" height=\"24\"><path d=\"M12 4.6a7.4 7.4 0 110 14.8 7.4 7.4 0 010-14.8zM12 3a9 9 0 100 18 9 9 0 000-18zm0 8L14.8 8l1 1.1-2.7 2.8 2.7 2.7-1.1 1.1-2.7-2.7-2.7 2.7-1-1.1 2.6-2.7-2.7-2.7 1-1.1 2.8 2.7z\" fill-rule=\"nonzero\"/></svg>',\n    'cell-background-color': '<svg width=\"24\" height=\"24\"><path d=\"M15.7 2l1.6 1.6-2.7 2.6 5.9 5.8c.7.7.7 1.7 0 2.4l-6.3 6.1a1.7 1.7 0 01-2.4 0l-6.3-6.1c-.7-.7-.7-1.7 0-2.4L15.7 2zM18 12l-4.5-4L9 12h9zM4 16s2 2.4 2 3.8C6 21 5.1 22 4 22s-2-1-2-2.2C2 18.4 4 16 4 16z\"/></svg>',\n    'cell-border-color': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M5 13v5h2v2H5a2 2 0 01-2-2v-5h2zm8-7V4h6a2 2 0 012 2h-8z\" opacity=\".2\"/><path fill-rule=\"nonzero\" d=\"M13 4v2H5v7H3V6c0-1.1.9-2 2-2h8zm-2.6 14.1l.1-.1.1.1.2.3.2.2.2.2c.4.6.8 1.2.8 1.7 0 .8-.7 1.5-1.5 1.5S9 21.3 9 20.5c0-.5.4-1.1.8-1.7l.2-.2.2-.2.2-.3z\"/><path d=\"M13 11l-2 2H5v-2h6V6h2z\"/><path fill-rule=\"nonzero\" d=\"M18.4 8l1 1-1.8 1.9 4 4c.5.4.5 1.1 0 1.6l-4.3 4.2a1.2 1.2 0 01-1.6 0l-4.4-4.2c-.4-.5-.4-1.2 0-1.7l7-6.8zm1.6 7l-3-3-3 3h6z\"/></g></svg>',\n    'change-case': '<svg width=\"24\" height=\"24\"><path d=\"M18.4 18.2v-.6c-.5.8-1.3 1.2-2.4 1.2-2.2 0-3.3-1.6-3.3-4.8 0-3.1 1-4.7 3.3-4.7 1.1 0 1.8.3 2.4 1.1v-.6c0-.5.4-.8.8-.8s.8.3.8.8v8.4c0 .5-.4.8-.8.8a.8.8 0 01-.8-.8zm-2-7.4c-1.3 0-1.8.9-1.8 3.2 0 2.4.5 3.3 1.7 3.3 1.3 0 1.8-.9 1.8-3.2 0-2.4-.5-3.3-1.7-3.3zM10 15.7H5.5l-.8 2.6a1 1 0 01-1 .7h-.2a.7.7 0 01-.7-1l4-12a1 1 0 012 0l4 12a.7.7 0 01-.8 1h-.2a1 1 0 01-1-.7l-.8-2.6zm-.3-1.5l-2-6.5-1.9 6.5h3.9z\" fill-rule=\"evenodd\"/></svg>',\n    'character-count': '<svg width=\"24\" height=\"24\"><path d=\"M4 11.5h16v1H4v-1zm4.8-6.8V10H7.7V5.8h-1v-1h2zM11 8.3V9h2v1h-3V7.7l2-1v-.9h-2v-1h3v2.4l-2 1zm6.3-3.4V10h-3.1V9h2.1V8h-2.1V6.8h2.1v-1h-2.1v-1h3.1zM5.8 16.4c0-.5.2-.8.5-1 .2-.2.6-.3 1.2-.3l.8.1c.2 0 .4.2.5.3l.4.4v2.8l.2.3H8.2v-.1-.2l-.6.3H7c-.4 0-.7 0-1-.2a1 1 0 01-.3-.9c0-.3 0-.6.3-.8.3-.2.7-.4 1.2-.4l.6-.2h.3v-.2l-.1-.2a.8.8 0 00-.5-.1 1 1 0 00-.4 0l-.3.4h-1zm2.3.8h-.2l-.2.1-.4.1a1 1 0 00-.4.2l-.2.2.1.3.5.1h.4l.4-.4v-.6zm2-3.4h1.2v1.7l.5-.3h.5c.5 0 .9.1 1.2.5.3.4.5.8.5 1.4 0 .6-.2 1.1-.5 1.5-.3.4-.7.6-1.3.6l-.6-.1-.4-.4v.4h-1.1v-5.4zm1.1 3.3c0 .3 0 .6.2.8a.7.7 0 001.2 0l.2-.8c0-.4 0-.6-.2-.8a.7.7 0 00-.6-.3l-.6.3-.2.8zm6.1-.5c0-.2 0-.3-.2-.4a.8.8 0 00-.5-.2c-.3 0-.5.1-.6.3l-.2.9c0 .3 0 .6.2.8.1.2.3.3.6.3.2 0 .4 0 .5-.2l.2-.4h1.1c0 .5-.3.8-.6 1.1a2 2 0 01-1.3.4c-.5 0-1-.2-1.3-.6a2 2 0 01-.5-1.4c0-.6.1-1.1.5-1.5.3-.4.8-.5 1.4-.5.5 0 1 0 1.2.3.4.3.5.7.5 1.2h-1v-.1z\" fill-rule=\"evenodd\"/></svg>',\n    'checklist-rtl': '<svg width=\"24\" height=\"24\"><path d=\"M5 17h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm14.2 11c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 20c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 14c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 8c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8z\" fill-rule=\"evenodd\"/></svg>',\n    'checklist': '<svg width=\"24\" height=\"24\"><path d=\"M11 17h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0-6h8a1 1 0 010 2h-8a1 1 0 010-2zM7.2 16c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 20c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 14c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 8c-.2.3-.7.4-1 0L3.8 6.9a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8z\" fill-rule=\"evenodd\"/></svg>',\n    'checkmark': '<svg width=\"24\" height=\"24\"><path d=\"M18.2 5.4a1 1 0 011.6 1.2l-8 12a1 1 0 01-1.5.1l-5-5a1 1 0 111.4-1.4l4.1 4.1 7.4-11z\" fill-rule=\"nonzero\"/></svg>',\n    'chevron-down': '<svg width=\"10\" height=\"10\"><path d=\"M8.7 2.2c.3-.3.8-.3 1 0 .4.4.4.9 0 1.2L5.7 7.8c-.3.3-.9.3-1.2 0L.2 3.4a.8.8 0 010-1.2c.3-.3.8-.3 1.1 0L5 6l3.7-3.8z\" fill-rule=\"nonzero\"/></svg>',\n    'chevron-left': '<svg width=\"10\" height=\"10\"><path d=\"M7.8 1.3L4 5l3.8 3.7c.3.3.3.8 0 1-.4.4-.9.4-1.2 0L2.2 5.7a.8.8 0 010-1.2L6.6.2C7 0 7.4 0 7.8.2c.3.3.3.8 0 1.1z\" fill-rule=\"nonzero\"/></svg>',\n    'chevron-right': '<svg width=\"10\" height=\"10\"><path d=\"M2.2 1.3a.8.8 0 010-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 010-1.1L6 5 2.2 1.3z\" fill-rule=\"nonzero\"/></svg>',\n    'chevron-up': '<svg width=\"10\" height=\"10\"><path d=\"M8.7 7.8L5 4 1.3 7.8c-.3.3-.8.3-1 0a.8.8 0 010-1.2l4.1-4.4c.3-.3.9-.3 1.2 0l4.2 4.4c.3.3.3.9 0 1.2-.3.3-.8.3-1.1 0z\" fill-rule=\"nonzero\"/></svg>',\n    'close': '<svg width=\"24\" height=\"24\"><path d=\"M17.3 8.2L13.4 12l3.9 3.8a1 1 0 01-1.5 1.5L12 13.4l-3.8 3.9a1 1 0 01-1.5-1.5l3.9-3.8-3.9-3.8a1 1 0 011.5-1.5l3.8 3.9 3.8-3.9a1 1 0 011.5 1.5z\" fill-rule=\"evenodd\"/></svg>',\n    'code-sample': '<svg width=\"24\" height=\"26\"><path d=\"M7.1 11a2.8 2.8 0 01-.8 2 2.8 2.8 0 01.8 2v1.7c0 .3.1.6.4.8.2.3.5.4.8.4.3 0 .4.2.4.4v.8c0 .2-.1.4-.4.4-.7 0-1.4-.3-2-.8-.5-.6-.8-1.3-.8-2V15c0-.3-.1-.6-.4-.8-.2-.3-.5-.4-.8-.4a.4.4 0 01-.4-.4v-.8c0-.2.2-.4.4-.4.3 0 .6-.1.8-.4.3-.2.4-.5.4-.8V9.3c0-.7.3-1.4.8-2 .6-.5 1.3-.8 2-.8.3 0 .4.2.4.4v.8c0 .2-.1.4-.4.4-.3 0-.6.1-.8.4-.3.2-.4.5-.4.8V11zm9.8 0V9.3c0-.3-.1-.6-.4-.8-.2-.3-.5-.4-.8-.4a.4.4 0 01-.4-.4V7c0-.2.1-.4.4-.4.7 0 1.4.3 2 .8.5.6.8 1.3.8 2V11c0 .3.1.6.4.8.2.3.5.4.8.4.2 0 .4.2.4.4v.8c0 .2-.2.4-.4.4-.3 0-.6.1-.8.4-.3.2-.4.5-.4.8v1.7c0 .7-.3 1.4-.8 2-.6.5-1.3.8-2 .8a.4.4 0 01-.4-.4v-.8c0-.2.1-.4.4-.4.3 0 .6-.1.8-.4.3-.2.4-.5.4-.8V15a2.8 2.8 0 01.8-2 2.8 2.8 0 01-.8-2zm-3.3-.4c0 .4-.1.8-.5 1.1-.3.3-.7.5-1.1.5-.4 0-.8-.2-1.1-.5-.4-.3-.5-.7-.5-1.1 0-.5.1-.9.5-1.2.3-.3.7-.4 1.1-.4.4 0 .8.1 1.1.4.4.3.5.7.5 1.2zM12 13c.4 0 .8.1 1.1.5.4.3.5.7.5 1.1 0 1-.1 1.6-.5 2a3 3 0 01-1.1 1c-.4.3-.8.4-1.1.4a.5.5 0 01-.5-.5V17a3 3 0 001-.2l.6-.6c-.6 0-1-.2-1.3-.5-.2-.3-.3-.7-.3-1 0-.5.1-1 .5-1.2.3-.4.7-.5 1.1-.5z\" fill-rule=\"evenodd\"/></svg>',\n    'color-levels': '<svg width=\"24\" height=\"24\"><path d=\"M17.5 11.4A9 9 0 0118 14c0 .5 0 1-.2 1.4 0 .4-.3.9-.5 1.3a6.2 6.2 0 01-3.7 3 5.7 5.7 0 01-3.2 0A5.9 5.9 0 017.6 18a6.2 6.2 0 01-1.4-2.6 6.7 6.7 0 010-2.8c0-.4.1-.9.3-1.3a13.6 13.6 0 012.3-4A20 20 0 0112 4a26.4 26.4 0 013.2 3.4 18.2 18.2 0 012.3 4zm-2 4.5c.4-.7.5-1.4.5-2a7.3 7.3 0 00-1-3.2c.2.6.2 1.2.2 1.9a4.5 4.5 0 01-1.3 3 5.3 5.3 0 01-2.3 1.5 4.9 4.9 0 01-2 .1 4.3 4.3 0 002.4.8 4 4 0 002-.6 4 4 0 001.5-1.5z\" fill-rule=\"evenodd\"/></svg>',\n    'color-picker': '<svg width=\"24\" height=\"24\"><path d=\"M12 3a9 9 0 000 18 1.5 1.5 0 001.1-2.5c-.2-.3-.4-.6-.4-1 0-.8.7-1.5 1.5-1.5H16a5 5 0 005-5c0-4.4-4-8-9-8zm-5.5 9a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm3-4a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm5 0a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm3 4a1.5 1.5 0 110-3 1.5 1.5 0 010 3z\" fill-rule=\"nonzero\"/></svg>',\n    'color-swatch-remove-color': '<svg width=\"24\" height=\"24\"><path stroke=\"#000\" stroke-width=\"2\" d=\"M21 3L3 21\" fill-rule=\"evenodd\"/></svg>',\n    'color-swatch': '<svg width=\"24\" height=\"24\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"1\" fill-rule=\"evenodd\"/></svg>',\n    'comment-add': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M9 19l3-2h7c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H5a1 1 0 00-1 1v10c0 .6.4 1 1 1h4v2zm-2 4v-4H5a3 3 0 01-3-3V6a3 3 0 013-3h14a3 3 0 013 3v10a3 3 0 01-3 3h-6.4L7 23z\"/><path d=\"M13 10h2a1 1 0 010 2h-2v2a1 1 0 01-2 0v-2H9a1 1 0 010-2h2V8a1 1 0 012 0v2z\"/></g></svg>',\n    'comment': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M9 19l3-2h7c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H5a1 1 0 00-1 1v10c0 .6.4 1 1 1h4v2zm-2 4v-4H5a3 3 0 01-3-3V6a3 3 0 013-3h14a3 3 0 013 3v10a3 3 0 01-3 3h-6.4L7 23z\"/></svg>',\n    'contrast': '<svg width=\"24\" height=\"24\"><path d=\"M12 4a7.8 7.8 0 015.7 2.3A8 8 0 1112 4zm-6 8a6 6 0 006 6V6a6 6 0 00-6 6z\" fill-rule=\"evenodd\"/></svg>',\n    'copy': '<svg width=\"24\" height=\"24\"><path d=\"M16 3H6a2 2 0 00-2 2v11h2V5h10V3zm1 4a2 2 0 012 2v10a2 2 0 01-2 2h-7a2 2 0 01-2-2V9c0-1.2.9-2 2-2h7zm0 12V9h-7v10h7z\" fill-rule=\"nonzero\"/></svg>',\n    'crop': '<svg width=\"24\" height=\"24\"><path d=\"M17 8v7h2c.6 0 1 .4 1 1s-.4 1-1 1h-2v2c0 .6-.4 1-1 1a1 1 0 01-1-1v-2H7V9H5a1 1 0 110-2h2V5c0-.6.4-1 1-1s1 .4 1 1v2h7l3-3 1 1-3 3zM9 9v5l5-5H9zm1 6h5v-5l-5 5z\" fill-rule=\"evenodd\"/></svg>',\n    'cut-column': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M7.2 4.5c.9 0 1.6.4 2.2 1A3.7 3.7 0 0110.5 8v.5l1 1 4-4 1-.5a3.3 3.3 0 012 0c.4 0 .7.3 1 .5L17 8h4v13h-6V10l-1.5 1.5.5.5v4l-2.5-2.5-1 1v.5c0 .4 0 .8-.3 1.2-.2.5-.4.9-.8 1.2-.6.7-1.3 1-2.2 1-.8.2-1.5 0-2-.6l-.5-.8-.2-1c0-.4 0-.8.3-1.2A3.9 3.9 0 017 12.7c.5-.2 1-.3 1.5-.2l1-1-1-1c-.5 0-1 0-1.5-.2-.5-.1-1-.4-1.4-.9-.4-.3-.6-.7-.8-1.2L4.5 7c0-.4 0-.7.2-1 0-.3.3-.6.5-.8.5-.5 1.2-.8 2-.7zm12.3 5h-3v10h3v-10zM8 13.8h-.3l-.4.2a2.8 2.8 0 00-.7.4v.1a2.8 2.8 0 00-.6.8l-.1.4v.7l.2.5.5.2h.7a2.6 2.6 0 00.8-.3 2.4 2.4 0 00.7-.7 2.5 2.5 0 00.3-.8 1.5 1.5 0 000-.8 1 1 0 00-.2-.4 1 1 0 00-.5-.2H8zm3.5-3.7c-.4 0-.7.1-1 .4-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4s.7-.1 1-.4c.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4zM7 5.8h-.4a1 1 0 00-.5.3 1 1 0 00-.2.5v.7a2.5 2.5 0 00.3.8l.2.3h.1l.4.4.4.2.4.1h.7L9 9l.2-.4a1.6 1.6 0 000-.8 2.6 2.6 0 00-.3-.8A2.5 2.5 0 007.7 6l-.4-.1H7z\"/></svg>',\n    'cut-row': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M22 3v5H9l3 3 2-2h4l-4 4 1 1h.5c.4 0 .8 0 1.2.3.5.2.9.4 1.2.8.7.6 1 1.3 1 2.2.2.8 0 1.5-.6 2l-.8.5-1 .2c-.4 0-.8 0-1.2-.3a3.9 3.9 0 01-2.1-2.2c-.2-.5-.3-1-.2-1.5l-1-1-1 1c0 .5 0 1-.2 1.5-.1.5-.4 1-.9 1.4-.3.4-.7.6-1.2.8l-1.2.3c-.4 0-.7 0-1-.2-.3 0-.6-.3-.8-.5-.5-.5-.8-1.2-.7-2 0-.9.4-1.6 1-2.2A3.7 3.7 0 018.6 14H9l1-1-4-4-.5-1a3.3 3.3 0 010-2c0-.4.3-.7.5-1l2 2V3h14zM8.5 15.3h-.3a2.6 2.6 0 00-.8.4 2.5 2.5 0 00-.9 1.1l-.1.4v.7l.2.5.5.2h.7a2.5 2.5 0 00.8-.3L9 18V18l.4-.4.2-.4.1-.4v-.3-.4a1 1 0 00-.2-.5 1 1 0 00-.4-.2h-.5zm7 0H15a1 1 0 00-.4.3 1 1 0 00-.2.5 1.5 1.5 0 000 .7v.4a2.8 2.8 0 00.5.7h.1a2.8 2.8 0 00.8.6l.4.1h.7l.5-.2.2-.5v-.4-.3a2.6 2.6 0 00-.3-.8 2.4 2.4 0 00-.7-.7 2.5 2.5 0 00-.8-.3h-.3zM12 11.6c-.4 0-.7.1-1 .4-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4s.7-.1 1-.4c.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4zm8.5-7.1h-11v2h11v-2z\"/></svg>',\n    'cut': '<svg width=\"24\" height=\"24\"><path d=\"M18 15c.6.7 1 1.4 1 2.3 0 .8-.2 1.5-.7 2l-.8.5-1 .2c-.4 0-.8 0-1.2-.3a3.9 3.9 0 01-2.1-2.2c-.2-.5-.3-1-.2-1.5l-1-1-1 1c0 .5 0 1-.2 1.5-.1.5-.4 1-.9 1.4-.3.4-.7.6-1.2.8l-1.2.3c-.4 0-.7 0-1-.2-.3 0-.6-.3-.8-.5-.5-.5-.8-1.2-.7-2 0-.9.4-1.6 1-2.2A3.7 3.7 0 018.6 14H9l1-1-4-4-.5-1a3.3 3.3 0 010-2c0-.4.3-.7.5-1l6 6 6-6 .5 1a3.3 3.3 0 010 2c0 .4-.3.7-.5 1l-4 4 1 1h.5c.4 0 .8 0 1.2.3.5.2.9.4 1.2.8zm-8.5 2.2l.1-.4v-.3-.4a1 1 0 00-.2-.5 1 1 0 00-.4-.2 1.6 1.6 0 00-.8 0 2.6 2.6 0 00-.8.3 2.5 2.5 0 00-.9 1.1l-.1.4v.7l.2.5.5.2h.7a2.5 2.5 0 00.8-.3 2.8 2.8 0 001-1zm2.5-2.8c.4 0 .7-.1 1-.4.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4s-.7.1-1 .4c-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4zm5.4 4l.2-.5v-.4-.3a2.6 2.6 0 00-.3-.8 2.4 2.4 0 00-.7-.7 2.5 2.5 0 00-.8-.3 1.5 1.5 0 00-.8 0 1 1 0 00-.4.2 1 1 0 00-.2.5 1.5 1.5 0 000 .7v.4l.3.4.3.4a2.8 2.8 0 00.8.5l.4.1h.7l.5-.2z\" fill-rule=\"evenodd\"/></svg>',\n    'document-properties': '<svg width=\"24\" height=\"24\"><path d=\"M14.4 3H7a2 2 0 00-2 2v14c0 1.1.9 2 2 2h10a2 2 0 002-2V7.6L14.4 3zM17 19H7V5h6v4h4v10z\" fill-rule=\"nonzero\"/></svg>',\n    'drag': '<svg width=\"24\" height=\"24\"><path d=\"M13 5h2v2h-2V5zm0 4h2v2h-2V9zM9 9h2v2H9V9zm4 4h2v2h-2v-2zm-4 0h2v2H9v-2zm0 4h2v2H9v-2zm4 0h2v2h-2v-2zM9 5h2v2H9V5z\" fill-rule=\"evenodd\"/></svg>',\n    'duplicate-column': '<svg width=\"24\" height=\"24\"><path d=\"M17 6v16h-7V6h7zm-2 2h-3v12h3V8zm-2-6v2H8v15H6V2h7z\"/></svg>',\n    'duplicate-row': '<svg width=\"24\" height=\"24\"><path d=\"M22 11v7H6v-7h16zm-2 2H8v3h12v-3zm-1-6v2H4v5H2V7h17z\"/></svg>',\n    'duplicate': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M16 3v2H6v11H4V5c0-1.1.9-2 2-2h10zm3 8h-2V9h-7v10h9a2 2 0 01-2 2h-7a2 2 0 01-2-2V9c0-1.2.9-2 2-2h7a2 2 0 012 2v2z\"/><path d=\"M17 14h1a1 1 0 010 2h-1v1a1 1 0 01-2 0v-1h-1a1 1 0 010-2h1v-1a1 1 0 012 0v1z\"/></g></svg>',\n    'edit-block': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19.8 8.8l-9.4 9.4c-.2.2-.5.4-.9.4l-5.4 1.2 1.2-5.4.5-.8 9.4-9.4c.7-.7 1.8-.7 2.5 0l2.1 2.1c.7.7.7 1.8 0 2.5zm-2-.2l1-.9v-.3l-2.2-2.2a.3.3 0 00-.3 0l-1 1L18 8.5zm-1 1l-2.5-2.4-6 6 2.5 2.5 6-6zm-7 7.1l-2.6-2.4-.3.3-.1.2-.7 3 3.1-.6h.1l.4-.5z\"/></svg>',\n    'edit-image': '<svg width=\"24\" height=\"24\"><path d=\"M18 16h2V7a2 2 0 00-2-2H7v2h11v9zM6 17h15a1 1 0 010 2h-1v1a1 1 0 01-2 0v-1H6a2 2 0 01-2-2V7H3a1 1 0 110-2h1V4a1 1 0 112 0v13zm3-5.3l1.3 2 3-4.7 3.7 6H7l2-3.3z\" fill-rule=\"nonzero\"/></svg>',\n    'embed-page': '<svg width=\"24\" height=\"24\"><path d=\"M19 6V5H5v14h2A13 13 0 0119 6zm0 1.4c-.8.8-1.6 2.4-2.2 4.6H19V7.4zm0 5.6h-2.4c-.4 1.8-.6 3.8-.6 6h3v-6zm-4 6c0-2.2.2-4.2.6-6H13c-.7 1.8-1.1 3.8-1.1 6h3zm-4 0c0-2.2.4-4.2 1-6H9.6A12 12 0 008 19h3zM4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 01-1-1V4c0-.6.4-1 1-1zm11.8 9c.4-1.9 1-3.4 1.8-4.5a9.2 9.2 0 00-4 4.5h2.2zm-3.4 0a12 12 0 012.8-4 12 12 0 00-5 4h2.2z\" fill-rule=\"nonzero\"/></svg>',\n    'embed': '<svg width=\"24\" height=\"24\"><path d=\"M4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 01-1-1V4c0-.6.4-1 1-1zm1 2v14h14V5H5zm4.8 2.6l5.6 4a.5.5 0 010 .8l-5.6 4A.5.5 0 019 16V8a.5.5 0 01.8-.4z\" fill-rule=\"nonzero\"/></svg>',\n    'emoji': '<svg width=\"24\" height=\"24\"><path d=\"M9 11c.6 0 1-.4 1-1s-.4-1-1-1a1 1 0 00-1 1c0 .6.4 1 1 1zm6 0c.6 0 1-.4 1-1s-.4-1-1-1a1 1 0 00-1 1c0 .6.4 1 1 1zm-3 5.5c2.1 0 4-1.5 4.4-3.5H7.6c.5 2 2.3 3.5 4.4 3.5zM12 4a8 8 0 100 16 8 8 0 000-16zm0 14.5a6.5 6.5 0 110-13 6.5 6.5 0 010 13z\" fill-rule=\"nonzero\"/></svg>',\n    'export': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M14.4 3L18 7v1h-5V5H7v14h9a1 1 0 012 0c0 1-.8 2-1.9 2H7c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2h7.5z\"/><path d=\"M18.1 12c.5 0 .9.4.9 1 0 .5-.3 1-.8 1h-7.3c-.5 0-.9-.4-.9-1 0-.5.3-1 .8-1h7.3z\"/><path d=\"M16.4 9.2a1 1 0 011.4.2l2.4 3.6-2.4 3.6a1 1 0 01-1.7-1v-.2l1.7-2.4-1.6-2.4a1 1 0 01.2-1.4z\"/></g></svg>',\n    'fill': '<svg width=\"24\" height=\"26\"><path d=\"M16.6 12l-9-9-1.4 1.4 2.4 2.4-5.2 5.1c-.5.6-.5 1.6 0 2.2L9 19.6a1.5 1.5 0 002.2 0l5.5-5.5c.5-.6.5-1.6 0-2.2zM5.2 13L10 8.2l4.8 4.8H5.2zM19 14.5s-2 2.2-2 3.5c0 1.1.9 2 2 2a2 2 0 002-2c0-1.3-2-3.5-2-3.5z\" fill-rule=\"nonzero\"/></svg>',\n    'flip-horizontally': '<svg width=\"24\" height=\"24\"><path d=\"M14 19h2v-2h-2v2zm4-8h2V9h-2v2zM4 7v10c0 1.1.9 2 2 2h3v-2H6V7h3V5H6a2 2 0 00-2 2zm14-2v2h2a2 2 0 00-2-2zm-7 16h2V3h-2v18zm7-6h2v-2h-2v2zm-4-8h2V5h-2v2zm4 12a2 2 0 002-2h-2v2z\" fill-rule=\"nonzero\"/></svg>',\n    'flip-vertically': '<svg width=\"24\" height=\"24\"><path d=\"M5 14v2h2v-2H5zm8 4v2h2v-2h-2zm4-14H7a2 2 0 00-2 2v3h2V6h10v3h2V6a2 2 0 00-2-2zm2 14h-2v2a2 2 0 002-2zM3 11v2h18v-2H3zm6 7v2h2v-2H9zm8-4v2h2v-2h-2zM5 18c0 1.1.9 2 2 2v-2H5z\" fill-rule=\"nonzero\"/></svg>',\n    'format-painter': '<svg width=\"24\" height=\"24\"><path d=\"M18 5V4c0-.5-.4-1-1-1H5a1 1 0 00-1 1v4c0 .6.5 1 1 1h12c.6 0 1-.4 1-1V7h1v4H9v9c0 .6.4 1 1 1h2c.6 0 1-.4 1-1v-7h8V5h-3z\" fill-rule=\"nonzero\"/></svg>',\n    'format': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M17 5a1 1 0 010 2h-4v11a1 1 0 01-2 0V7H7a1 1 0 110-2h10z\"/></svg>',\n    'fullscreen': '<svg width=\"24\" height=\"24\"><path d=\"M15.3 10l-1.2-1.3 2.9-3h-2.3a.9.9 0 110-1.7H19c.5 0 .9.4.9.9v4.4a.9.9 0 11-1.8 0V7l-2.9 3zm0 4l3 3v-2.3a.9.9 0 111.7 0V19c0 .5-.4.9-.9.9h-4.4a.9.9 0 110-1.8H17l-3-2.9 1.3-1.2zM10 15.4l-2.9 3h2.3a.9.9 0 110 1.7H5a.9.9 0 01-.9-.9v-4.4a.9.9 0 111.8 0V17l2.9-3 1.2 1.3zM8.7 10L5.7 7v2.3a.9.9 0 01-1.7 0V5c0-.5.4-.9.9-.9h4.4a.9.9 0 010 1.8H7l3 2.9-1.3 1.2z\" fill-rule=\"nonzero\"/></svg>',\n    'gallery': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M5 15.7l2.3-2.2c.3-.3.7-.3 1 0L11 16l5.1-5c.3-.4.8-.4 1 0l2 1.9V8H5v7.7zM5 18V19h3l1.8-1.9-2-2L5 17.9zm14-3l-2.5-2.4-6.4 6.5H19v-4zM4 6h16c.6 0 1 .4 1 1v13c0 .6-.4 1-1 1H4a1 1 0 01-1-1V7c0-.6.4-1 1-1zm6 7a2 2 0 110-4 2 2 0 010 4zM4.5 4h15a.5.5 0 110 1h-15a.5.5 0 010-1zm2-2h11a.5.5 0 110 1h-11a.5.5 0 010-1z\"/></svg>',\n    'gamma': '<svg width=\"24\" height=\"24\"><path d=\"M4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 01-1-1V4c0-.6.4-1 1-1zm1 2v14h14V5H5zm6.5 11.8V14L9.2 8.7a5.1 5.1 0 00-.4-.8l-.1-.2H8 8v-1l.3-.1.3-.1h.7a1 1 0 01.6.5l.1.3a8.5 8.5 0 01.3.6l1.9 4.6 2-5.2a1 1 0 011-.6.5.5 0 01.5.6L13 14v2.8a.7.7 0 01-1.4 0z\" fill-rule=\"nonzero\"/></svg>',\n    'help': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M12 5.5a6.5 6.5 0 00-6 9 6.3 6.3 0 001.4 2l1 1a6.3 6.3 0 003.6 1 6.5 6.5 0 006-9 6.3 6.3 0 00-1.4-2l-1-1a6.3 6.3 0 00-3.6-1zM12 4a7.8 7.8 0 015.7 2.3A8 8 0 1112 4z\"/><path d=\"M9.6 9.7a.7.7 0 01-.7-.8c0-1.1 1.5-1.8 3.2-1.8 1.8 0 3.2.8 3.2 2.4 0 1.4-.4 2.1-1.5 2.8-.2 0-.3.1-.3.2a2 2 0 00-.8.8.8.8 0 01-1.4-.6c.3-.7.8-1 1.3-1.5l.4-.2c.7-.4.8-.6.8-1.5 0-.5-.6-.9-1.7-.9-.5 0-1 .1-1.4.3-.2 0-.3.1-.3.2v-.2c0 .4-.4.8-.8.8z\" fill-rule=\"nonzero\"/><circle cx=\"12\" cy=\"16\" r=\"1\"/></g></svg>',\n    'highlight-bg-color': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path id=\"tox-icon-highlight-bg-color__color\" d=\"M3 18h18v3H3z\"/><path fill-rule=\"nonzero\" d=\"M7.7 16.7H3l3.3-3.3-.7-.8L10.2 8l4 4.1-4 4.2c-.2.2-.6.2-.8 0l-.6-.7-1.1 1.1zm5-7.5L11 7.4l3-2.9a2 2 0 012.6 0L18 6c.7.7.7 2 0 2.7l-2.9 2.9-1.8-1.8-.5-.6\"/></g></svg>',\n    'home': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\"/></svg>',\n    'horizontal-rule': '<svg width=\"24\" height=\"24\"><path d=\"M4 11h16v2H4z\" fill-rule=\"evenodd\"/></svg>',\n    'image-options': '<svg width=\"24\" height=\"24\"><path d=\"M6 10a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2zm12 0a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2zm-6 0a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2z\" fill-rule=\"nonzero\"/></svg>',\n    'image': '<svg width=\"24\" height=\"24\"><path d=\"M5 15.7l3.3-3.2c.3-.3.7-.3 1 0L12 15l4.1-4c.3-.4.8-.4 1 0l2 1.9V5H5v10.7zM5 18V19h3l2.8-2.9-2-2L5 17.9zm14-3l-2.5-2.4-6.4 6.5H19v-4zM4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 01-1-1V4c0-.6.4-1 1-1zm6 8a2 2 0 100-4 2 2 0 000 4z\" fill-rule=\"nonzero\"/></svg>',\n    'indent': '<svg width=\"24\" height=\"24\"><path d=\"M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 110-2zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 010-2zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 010-2zm-5 4h12a1 1 0 010 2H7a1 1 0 010-2zm-2.6-3.8L6.2 12l-1.8-1.2a1 1 0 011.2-1.6l3 2a1 1 0 010 1.6l-3 2a1 1 0 11-1.2-1.6z\" fill-rule=\"evenodd\"/></svg>',\n    'info': '<svg width=\"24\" height=\"24\"><path d=\"M12 4a7.8 7.8 0 015.7 2.3A8 8 0 1112 4zm-1 3v2h2V7h-2zm3 10v-1h-1v-5h-3v1h1v4h-1v1h4z\" fill-rule=\"evenodd\"/></svg>',\n    'insert-character': '<svg width=\"24\" height=\"24\"><path d=\"M15 18h4l1-2v4h-6v-3.3l1.4-1a6 6 0 001.8-2.9 6.3 6.3 0 00-.1-4.1 5.8 5.8 0 00-3-3.2c-.6-.3-1.3-.5-2.1-.5a5.1 5.1 0 00-3.9 1.8 6.3 6.3 0 00-1.3 6 6.2 6.2 0 001.8 3l1.4.9V20H4v-4l1 2h4v-.5l-2-1L5.4 15A6.5 6.5 0 014 11c0-1 .2-1.9.6-2.7A7 7 0 016.3 6C7.1 5.4 8 5 9 4.5c1-.3 2-.5 3.1-.5a8.8 8.8 0 015.7 2 7 7 0 011.7 2.3 6 6 0 01.2 4.8c-.2.7-.6 1.3-1 1.9a7.6 7.6 0 01-3.6 2.5v.5z\" fill-rule=\"evenodd\"/></svg>',\n    'insert-time': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M12 19a7 7 0 100-14 7 7 0 000 14zm0 2a9 9 0 110-18 9 9 0 010 18z\"/><path d=\"M16 12h-3V7c0-.6-.4-1-1-1a1 1 0 00-1 1v7h5c.6 0 1-.4 1-1s-.4-1-1-1z\"/></g></svg>',\n    'invert': '<svg width=\"24\" height=\"24\"><path d=\"M18 19.3L16.5 18a5.8 5.8 0 01-3.1 1.9 6.1 6.1 0 01-5.5-1.6A5.8 5.8 0 016 14v-.3l.1-1.2A13.9 13.9 0 017.7 9l-3-3 .7-.8 2.8 2.9 9 8.9 1.5 1.6-.7.6zm0-5.5v.3l-.1 1.1-.4 1-1.2-1.2a4.3 4.3 0 00.2-1v-.2c0-.4 0-.8-.2-1.3l-.5-1.4a14.8 14.8 0 00-3-4.2L12 6a26.1 26.1 0 00-2.2 2.5l-1-1a20.9 20.9 0 012.9-3.3L12 4l1 .8a22.2 22.2 0 014 5.4c.6 1.2 1 2.4 1 3.6z\" fill-rule=\"evenodd\"/></svg>',\n    'italic': '<svg width=\"24\" height=\"24\"><path d=\"M16.7 4.7l-.1.9h-.3c-.6 0-1 0-1.4.3-.3.3-.4.6-.5 1.1l-2.1 9.8v.6c0 .5.4.8 1.4.8h.2l-.2.8H8l.2-.8h.2c1.1 0 1.8-.5 2-1.5l2-9.8.1-.5c0-.6-.4-.8-1.4-.8h-.3l.2-.9h5.8z\" fill-rule=\"evenodd\"/></svg>',\n    'language': '<svg width=\"24\" height=\"24\"><path d=\"M12 3a9 9 0 110 18 9 9 0 010-18zm4.3 13.3c-.5 1-1.2 2-2 2.9a7.5 7.5 0 003.2-2.1l-.2-.2a6 6 0 00-1-.6zm-8.6 0c-.5.2-.9.5-1.2.8.9 1 2 1.7 3.2 2a10 10 0 01-2-2.8zm3.6-.8c-.8 0-1.6.1-2.2.3.5 1 1.2 1.9 2.1 2.7zm1.5 0v3c.9-.8 1.6-1.7 2.1-2.7-.6-.2-1.4-.3-2.1-.3zm-6-2.7H4.5c.2 1 .5 2.1 1 3h.3l1.3-1a10 10 0 01-.3-2zm12.7 0h-2.3c0 .7-.1 1.4-.3 2l1.6 1.1c.5-1 .9-2 1-3.1zm-3.8 0h-3V14c1 0 2 .1 2.7.4.2-.5.3-1 .3-1.6zm-4.4 0h-3l.3 1.6c.8-.3 1.7-.4 2.7-.4v-1.3zm-5.5-5c-.7 1-1.1 2.2-1.3 3.5h2.3c0-1 .2-1.8.5-2.6l-1.5-1zm2.9 1.4v.1c-.2.6-.4 1.3-.4 2h3V9.4c-1 0-1.8-.1-2.6-.3zm6.6 0h-.1l-2.4.3v1.8h3l-.5-2.1zm3-1.4l-.3.1-1.3.8c.3.8.5 1.6.5 2.6h2.3a7.5 7.5 0 00-1.3-3.5zm-9 0l2 .2V5.5a9 9 0 00-2 2.2zm3.5-2.3V8c.6 0 1.3 0 1.9-.2a9 9 0 00-2-2.3zm-3-.7h-.1c-1.1.4-2.1 1-3 1.8l1.2.7a10 10 0 011.9-2.5zm4.4 0l.1.1a10 10 0 011.8 2.4l1.1-.7a7.5 7.5 0 00-3-1.8z\"/></svg>',\n    'line-height': '<svg width=\"24\" height=\"24\"><path d=\"M21 5a1 1 0 01.1 2H13a1 1 0 01-.1-2H21zm0 4a1 1 0 01.1 2H13a1 1 0 01-.1-2H21zm0 4a1 1 0 01.1 2H13a1 1 0 01-.1-2H21zm0 4a1 1 0 01.1 2H13a1 1 0 01-.1-2H21zM7 3.6l3.7 3.7a1 1 0 01-1.3 1.5h-.1L8 7.3v9.2l1.3-1.3a1 1 0 011.3 0h.1c.4.4.4 1 0 1.3v.1L7 20.4l-3.7-3.7a1 1 0 011.3-1.5h.1L6 16.7V7.4L4.7 8.7a1 1 0 01-1.3 0h-.1a1 1 0 010-1.3v-.1L7 3.6z\"/></svg>',\n    'line': '<svg width=\"24\" height=\"24\"><path d=\"M15 9l-8 8H4v-3l8-8 3 3zm1-1l-3-3 1-1h1c-.2 0 0 0 0 0l2 2s0 .2 0 0v1l-1 1zM4 18h16v2H4v-2z\" fill-rule=\"evenodd\"/></svg>',\n    'link': '<svg width=\"24\" height=\"24\"><path d=\"M6.2 12.3a1 1 0 011.4 1.4l-2.1 2a2 2 0 102.7 2.8l4.8-4.8a1 1 0 000-1.4 1 1 0 111.4-1.3 2.9 2.9 0 010 4L9.6 20a3.9 3.9 0 01-5.5-5.5l2-2zm11.6-.6a1 1 0 01-1.4-1.4l2-2a2 2 0 10-2.6-2.8L11 10.3a1 1 0 000 1.4A1 1 0 119.6 13a2.9 2.9 0 010-4L14.4 4a3.9 3.9 0 015.5 5.5l-2 2z\" fill-rule=\"nonzero\"/></svg>',\n    'list-bull-circle': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path d=\"M11 16a2 2 0 100-4 2 2 0 000 4zm0 1a3 3 0 110-6 3 3 0 010 6zM11 26a2 2 0 100-4 2 2 0 000 4zm0 1a3 3 0 110-6 3 3 0 010 6zM11 36a2 2 0 100-4 2 2 0 000 4zm0 1a3 3 0 110-6 3 3 0 010 6z\" fill-rule=\"nonzero\"/><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/></g></svg>',\n    'list-bull-default': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><circle cx=\"11\" cy=\"14\" r=\"3\"/><circle cx=\"11\" cy=\"24\" r=\"3\"/><circle cx=\"11\" cy=\"34\" r=\"3\"/><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/></g></svg>',\n    'list-bull-square': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path d=\"M8 11h6v6H8zM8 21h6v6H8zM8 31h6v6H8z\"/><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/></g></svg>',\n    'list-num-default-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M37.4 17v-4.8l-1.6 1v-1.1l1.6-1h1.2V17zM33.3 17.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm1.7 5.7c0-1.2 1-2 2.2-2 1.3 0 2.1.8 2.1 1.8 0 .7-.3 1.2-1.3 2.2l-1.2 1v.2h2.6v1h-4.3v-.9l2-1.9c.8-.8 1-1.1 1-1.5 0-.5-.4-.8-1-.8-.5 0-.9.3-.9.9H35zm-1.7 4.3c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm3.2 7.3v-1h.7c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7s-1 .3-1 .8H35c0-1.1 1-1.8 2.2-1.8 1.2 0 2.1.6 2.1 1.6 0 .7-.4 1.2-1 1.3v.1c.7.1 1.3.7 1.3 1.4 0 1-1 1.9-2.4 1.9-1.3 0-2.2-.8-2.3-2h1.2c0 .6.5 1 1.1 1 .6 0 1-.4 1-1 0-.5-.3-.8-1-.8h-.7zm-3.3 2.7c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7z\"/></g></svg>',\n    'list-num-default': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M10 17v-4.8l-1.5 1v-1.1l1.6-1h1.2V17h-1.2zm3.6.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zm-5 5.7c0-1.2.8-2 2.1-2s2.1.8 2.1 1.8c0 .7-.3 1.2-1.4 2.2l-1.1 1v.2h2.6v1H8.6v-.9l2-1.9c.8-.8 1-1.1 1-1.5 0-.5-.4-.8-1-.8-.5 0-.9.3-.9.9H8.5zm6.3 4.3c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zM10 34.4v-1h.7c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7s-1 .3-1 .8H8.6c0-1.1 1-1.8 2.2-1.8 1.3 0 2.1.6 2.1 1.6 0 .7-.4 1.2-1 1.3v.1c.8.1 1.3.7 1.3 1.4 0 1-1 1.9-2.4 1.9-1.3 0-2.2-.8-2.3-2h1.2c0 .6.5 1 1.1 1 .7 0 1-.4 1-1 0-.5-.3-.8-1-.8h-.7zm4.7 2.7c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7z\"/></g></svg>',\n    'list-num-lower-alpha-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M36.5 16c-.9 0-1.5-.5-1.5-1.3s.6-1.3 1.8-1.4h1v-.4c0-.4-.2-.6-.7-.6-.4 0-.7.1-.8.4h-1.1c0-.8.8-1.4 2-1.4S39 12 39 13V16h-1.2v-.6c-.3.4-.8.7-1.4.7zm.4-.8c.6 0 1-.4 1-.9V14h-1c-.5.1-.7.3-.7.6 0 .4.3.6.7.6zM33.1 16.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zM37.7 26c-.7 0-1.2-.2-1.5-.7v.7H35v-6.3h1.2v2.5c.3-.5.8-.9 1.5-.9 1.1 0 1.8 1 1.8 2.4 0 1.5-.7 2.4-1.8 2.4zm-.5-3.6c-.6 0-1 .5-1 1.3s.4 1.4 1 1.4c.7 0 1-.6 1-1.4 0-.8-.3-1.3-1-1.3zM33.2 26.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zm6 7h-1c-.1-.5-.4-.8-1-.8s-1 .5-1 1.4c0 1 .4 1.4 1 1.4.5 0 .9-.2 1-.7h1c0 1-.8 1.7-2 1.7-1.4 0-2.2-.9-2.2-2.4s.8-2.4 2.2-2.4c1.2 0 2 .7 2 1.7zm-6.1 3c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\n    'list-num-lower-alpha': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M10.3 15.2c.5 0 1-.4 1-.9V14h-1c-.5.1-.8.3-.8.6 0 .4.3.6.8.6zm-.4.9c-1 0-1.5-.6-1.5-1.4 0-.8.6-1.3 1.7-1.4h1.1v-.4c0-.4-.2-.6-.7-.6-.5 0-.8.1-.9.4h-1c0-.8.8-1.4 2-1.4 1.1 0 1.8.6 1.8 1.6V16h-1.1v-.6h-.1c-.2.4-.7.7-1.3.7zm4.6 0c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm-3.2 10c-.6 0-1.2-.3-1.4-.8v.7H8.5v-6.3H10v2.5c.3-.5.8-.9 1.4-.9 1.2 0 1.9 1 1.9 2.4 0 1.5-.7 2.4-1.9 2.4zm-.4-3.7c-.7 0-1 .5-1 1.3s.3 1.4 1 1.4c.6 0 1-.6 1-1.4 0-.8-.4-1.3-1-1.3zm4 3.7c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm-2.2 7h-1.2c0-.5-.4-.8-.9-.8-.6 0-1 .5-1 1.4 0 1 .4 1.4 1 1.4.5 0 .8-.2 1-.7h1c0 1-.8 1.7-2 1.7-1.4 0-2.2-.9-2.2-2.4s.8-2.4 2.2-2.4c1.2 0 2 .7 2 1.7zm1.8 3c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\n    'list-num-lower-greek-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M37.4 16c-1.2 0-2-.8-2-2.3 0-1.5.8-2.4 2-2.4.6 0 1 .4 1.3 1v-.9H40v3.2c0 .4.1.5.4.5h.2v.9h-.6c-.6 0-1-.2-1-.7h-.2c-.2.4-.7.8-1.3.8zm.3-1c.6 0 1-.5 1-1.3s-.4-1.3-1-1.3-1 .5-1 1.3.4 1.4 1 1.4zM33.3 16.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zM36 21.9c0-1.5.8-2.3 2.1-2.3 1.2 0 2 .6 2 1.6 0 .6-.3 1-.9 1.3.9.3 1.3.8 1.3 1.7 0 1.2-.7 1.9-1.8 1.9-.6 0-1.1-.3-1.4-.8v2.2H36V22zm1.8 1.2v-1h.3c.5 0 .9-.2.9-.7 0-.5-.3-.8-.9-.8-.5 0-.8.3-.8 1v2.2c0 .8.4 1.3 1 1.3s1-.4 1-1-.4-1-1.2-1h-.3zM33.3 26.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zM37.1 34.6L34.8 30h1.4l1.7 3.5 1.7-3.5h1.1l-2.2 4.6v.1c.5.8.7 1.4.7 1.8 0 .4-.2.8-.4 1-.2.2-.6.3-1 .3-.9 0-1.3-.4-1.3-1.2 0-.5.2-1 .5-1.7l.1-.2zm.7 1a2 2 0 00-.4.9c0 .3.1.4.4.4.3 0 .4-.1.4-.4 0-.2-.1-.6-.4-1zM33.3 36.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\n    'list-num-lower-greek': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M10.5 15c.7 0 1-.5 1-1.3s-.3-1.3-1-1.3c-.5 0-.9.5-.9 1.3s.4 1.4 1 1.4zm-.3 1c-1.1 0-1.8-.8-1.8-2.3 0-1.5.7-2.4 1.8-2.4.7 0 1.1.4 1.3 1h.1v-.9h1.2v3.2c0 .4.1.5.4.5h.2v.9h-.6c-.6 0-1-.2-1.1-.7h-.1c-.2.4-.7.8-1.4.8zm5 .1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zm-4.9 7v-1h.3c.6 0 1-.2 1-.7 0-.5-.4-.8-1-.8-.5 0-.8.3-.8 1v2.2c0 .8.4 1.3 1.1 1.3.6 0 1-.4 1-1s-.5-1-1.3-1h-.3zM8.6 22c0-1.5.7-2.3 2-2.3 1.2 0 2 .6 2 1.6 0 .6-.3 1-.8 1.3.8.3 1.3.8 1.3 1.7 0 1.2-.8 1.9-1.9 1.9-.6 0-1.1-.3-1.3-.8v2.2H8.5V22zm6.2 4.2c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zm-4.5 8.5L8 30h1.4l1.7 3.5 1.7-3.5h1.1l-2.2 4.6v.1c.5.8.7 1.4.7 1.8 0 .4-.1.8-.4 1-.2.2-.6.3-1 .3-.9 0-1.3-.4-1.3-1.2 0-.5.2-1 .5-1.7l.1-.2zm.7 1a2 2 0 00-.4.9c0 .3.1.4.4.4.3 0 .4-.1.4-.4 0-.2-.1-.6-.4-1zm4.5.5c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\n    'list-num-lower-roman-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M32.9 16v-1.2h-1.3V16H33zm0 10v-1.2h-1.3V26H33zm0 10v-1.2h-1.3V36H33z\"/><path fill-rule=\"nonzero\" d=\"M36 21h-1.5v5H36zM36 31h-1.5v5H36zM39 21h-1.5v5H39zM39 31h-1.5v5H39zM42 31h-1.5v5H42zM36 11h-1.5v5H36zM36 19h-1.5v1H36zM36 29h-1.5v1H36zM39 19h-1.5v1H39zM39 29h-1.5v1H39zM42 29h-1.5v1H42zM36 9h-1.5v1H36z\"/></g></svg>',\n    'list-num-lower-roman': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M15.1 16v-1.2h1.3V16H15zm0 10v-1.2h1.3V26H15zm0 10v-1.2h1.3V36H15z\"/><path fill-rule=\"nonzero\" d=\"M12 21h1.5v5H12zM12 31h1.5v5H12zM9 21h1.5v5H9zM9 31h1.5v5H9zM6 31h1.5v5H6zM12 11h1.5v5H12zM12 19h1.5v1H12zM12 29h1.5v1H12zM9 19h1.5v1H9zM9 29h1.5v1H9zM6 29h1.5v1H6zM12 9h1.5v1H12z\"/></g></svg>',\n    'list-num-upper-alpha-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M39.3 17l-.5-1.4h-2l-.5 1.4H35l2-6h1.6l2 6h-1.3zm-1.6-4.7l-.7 2.3h1.6l-.8-2.3zM33.4 17c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zm4.7 9.9h-2.7v-6H38c1.2 0 1.9.6 1.9 1.5 0 .6-.5 1.2-1 1.3.7.1 1.3.7 1.3 1.5 0 1-.8 1.7-2 1.7zm-1.4-5v1.5h1c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7h-1zm0 4h1.1c.7 0 1.1-.3 1.1-.8 0-.6-.4-.9-1.1-.9h-1.1V26zM33 27.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm4.9 10c-1.8 0-2.8-1.1-2.8-3.1s1-3.1 2.8-3.1c1.4 0 2.5.9 2.6 2.2h-1.3c0-.7-.6-1.1-1.3-1.1-1 0-1.6.7-1.6 2s.6 2 1.6 2c.7 0 1.2-.4 1.4-1h1.2c-.1 1.3-1.2 2.2-2.6 2.2zm-4.5 0c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\n    'list-num-upper-alpha': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M12.6 17l-.5-1.4h-2L9.5 17H8.3l2-6H12l2 6h-1.3zM11 12.3l-.7 2.3h1.6l-.8-2.3zm4.7 4.8c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zM11.4 27H8.7v-6h2.6c1.2 0 1.9.6 1.9 1.5 0 .6-.5 1.2-1 1.3.7.1 1.3.7 1.3 1.5 0 1-.8 1.7-2 1.7zM10 22v1.5h1c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7h-1zm0 4H11c.7 0 1.1-.3 1.1-.8 0-.6-.4-.9-1.1-.9H10V26zm5.4 1.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm-4.1 10c-1.8 0-2.8-1.1-2.8-3.1s1-3.1 2.8-3.1c1.4 0 2.5.9 2.6 2.2h-1.3c0-.7-.6-1.1-1.3-1.1-1 0-1.6.7-1.6 2s.6 2 1.6 2c.7 0 1.2-.4 1.4-1h1.2c-.1 1.3-1.2 2.2-2.6 2.2zm4.5 0c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\n    'list-num-upper-roman-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M31.6 17v-1.2H33V17h-1.3zm0 10v-1.2H33V27h-1.3zm0 10v-1.2H33V37h-1.3z\"/><path fill-rule=\"nonzero\" d=\"M34.5 20H36v7h-1.5zM34.5 30H36v7h-1.5zM37.5 20H39v7h-1.5zM37.5 30H39v7h-1.5zM40.5 30H42v7h-1.5zM34.5 10H36v7h-1.5z\"/></g></svg>',\n    'list-num-upper-roman': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M15.1 17v-1.2h1.3V17H15zm0 10v-1.2h1.3V27H15zm0 10v-1.2h1.3V37H15z\"/><path fill-rule=\"nonzero\" d=\"M12 20h1.5v7H12zM12 30h1.5v7H12zM9 20h1.5v7H9zM9 30h1.5v7H9zM6 30h1.5v7H6zM12 10h1.5v7H12z\"/></g></svg>',\n    'lock': '<svg width=\"24\" height=\"24\"><path d=\"M16.3 11c.2 0 .3 0 .5.2l.2.6v7.4c0 .3 0 .4-.2.6l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6v-7.4c0-.3 0-.4.2-.6l.5-.2H8V8c0-.8.3-1.5.9-2.1.6-.6 1.3-.9 2.1-.9h2c.8 0 1.5.3 2.1.9.6.6.9 1.3.9 2.1v3h.3zM10 8v3h4V8a1 1 0 00-.3-.7A1 1 0 0013 7h-2a1 1 0 00-.7.3 1 1 0 00-.3.7z\" fill-rule=\"evenodd\"/></svg>',\n    'ltr': '<svg width=\"24\" height=\"24\"><path d=\"M11 5h7a1 1 0 010 2h-1v11a1 1 0 01-2 0V7h-2v11a1 1 0 01-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 017.8 10a3.3 3.3 0 010-2.8 3.4 3.4 0 011.8-1.8L11 5zM4.4 16.2L6.2 15l-1.8-1.2a1 1 0 011.2-1.6l3 2a1 1 0 010 1.6l-3 2a1 1 0 11-1.2-1.6z\" fill-rule=\"evenodd\"/></svg>',\n    'more-drawer': '<svg width=\"24\" height=\"24\"><path d=\"M6 10a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2zm12 0a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2zm-6 0a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2z\" fill-rule=\"nonzero\"/></svg>',\n    'new-document': '<svg width=\"24\" height=\"24\"><path d=\"M14.4 3H7a2 2 0 00-2 2v14c0 1.1.9 2 2 2h10a2 2 0 002-2V7.6L14.4 3zM17 19H7V5h6v4h4v10z\" fill-rule=\"nonzero\"/></svg>',\n    'new-tab': '<svg width=\"24\" height=\"24\"><path d=\"M15 13l2-2v8H5V7h8l-2 2H7v8h8v-4zm4-8v5.5l-2-2-5.6 5.5H10v-1.4L15.5 7l-2-2H19z\" fill-rule=\"evenodd\"/></svg>',\n    'non-breaking': '<svg width=\"24\" height=\"24\"><path d=\"M11 11H8a1 1 0 110-2h3V6c0-.6.4-1 1-1s1 .4 1 1v3h3c.6 0 1 .4 1 1s-.4 1-1 1h-3v3c0 .6-.4 1-1 1a1 1 0 01-1-1v-3zm10 4v5H3v-5c0-.6.4-1 1-1s1 .4 1 1v3h14v-3c0-.6.4-1 1-1s1 .4 1 1z\" fill-rule=\"evenodd\"/></svg>',\n    'notice': '<svg width=\"24\" height=\"24\"><path d=\"M17.8 9.8L15.4 4 20 8.5v7L15.5 20h-7L4 15.5v-7L8.5 4h7l2.3 5.8zm0 0l2.2 5.7-2.3-5.8zM13 17v-2h-2v2h2zm0-4V7h-2v6h2z\" fill-rule=\"evenodd\"/></svg>',\n    'ordered-list-rtl': '<svg width=\"24\" height=\"24\"><path d=\"M6 17h8a1 1 0 010 2H6a1 1 0 010-2zm0-6h8a1 1 0 010 2H6a1 1 0 010-2zm0-6h8a1 1 0 010 2H6a1 1 0 110-2zm13-1v3.5a.5.5 0 11-1 0V5h-.5a.5.5 0 110-1H19zm-1 8.8l.2.2h1.3a.5.5 0 110 1h-1.6a1 1 0 01-.9-1V13c0-.4.3-.8.6-1l1.2-.4.2-.3a.2.2 0 00-.2-.2h-1.3a.5.5 0 01-.5-.5c0-.3.2-.5.5-.5h1.6c.5 0 .9.4.9 1v.1c0 .4-.3.8-.6 1l-1.2.4-.2.3zm2 4.2v2c0 .6-.4 1-1 1h-1.5a.5.5 0 010-1h1.2a.3.3 0 100-.6h-1.3a.4.4 0 110-.8h1.3a.3.3 0 000-.6h-1.2a.5.5 0 110-1H19c.6 0 1 .4 1 1z\" fill-rule=\"evenodd\"/></svg>',\n    'ordered-list': '<svg width=\"24\" height=\"24\"><path d=\"M10 17h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 110-2zM6 4v3.5c0 .3-.2.5-.5.5a.5.5 0 01-.5-.5V5h-.5a.5.5 0 010-1H6zm-1 8.8l.2.2h1.3c.3 0 .5.2.5.5s-.2.5-.5.5H4.9a1 1 0 01-.9-1V13c0-.4.3-.8.6-1l1.2-.4.2-.3a.2.2 0 00-.2-.2H4.5a.5.5 0 01-.5-.5c0-.3.2-.5.5-.5h1.6c.5 0 .9.4.9 1v.1c0 .4-.3.8-.6 1l-1.2.4-.2.3zM7 17v2c0 .6-.4 1-1 1H4.5a.5.5 0 010-1h1.2c.2 0 .3-.1.3-.3 0-.2-.1-.3-.3-.3H4.4a.4.4 0 110-.8h1.3c.2 0 .3-.1.3-.3 0-.2-.1-.3-.3-.3H4.5a.5.5 0 110-1H6c.6 0 1 .4 1 1z\" fill-rule=\"evenodd\"/></svg>',\n    'orientation': '<svg width=\"24\" height=\"24\"><path d=\"M7.3 6.4L1 13l6.4 6.5 6.5-6.5-6.5-6.5zM3.7 13l3.6-3.7L11 13l-3.7 3.7-3.6-3.7zM12 6l2.8 2.7c.3.3.3.8 0 1-.3.4-.9.4-1.2 0L9.2 5.7a.8.8 0 010-1.2L13.6.2c.3-.3.9-.3 1.2 0 .3.3.3.8 0 1.1L12 4h1a9 9 0 11-4.3 16.9l1.5-1.5A7 7 0 1013 6h-1z\" fill-rule=\"nonzero\"/></svg>',\n    'outdent': '<svg width=\"24\" height=\"24\"><path d=\"M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 110-2zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 010-2zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 010-2zm-5 4h12a1 1 0 010 2H7a1 1 0 010-2zm1.6-3.8a1 1 0 01-1.2 1.6l-3-2a1 1 0 010-1.6l3-2a1 1 0 011.2 1.6L6.8 12l1.8 1.2z\" fill-rule=\"evenodd\"/></svg>',\n    'page-break': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M5 11c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zm3 0h1c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2zm4 0c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zm3 0h1c.6 0 1 .4 1 1s-.4 1-1 1h-1a1 1 0 010-2zm4 0c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zM7 3v5h10V3c0-.6.4-1 1-1s1 .4 1 1v7H5V3c0-.6.4-1 1-1s1 .4 1 1zM6 22a1 1 0 01-1-1v-7h14v7c0 .6-.4 1-1 1a1 1 0 01-1-1v-5H7v5c0 .6-.4 1-1 1z\"/></g></svg>',\n    'paragraph': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M10 5h7a1 1 0 010 2h-1v11a1 1 0 01-2 0V7h-2v11a1 1 0 01-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 016.8 10a3.3 3.3 0 010-2.8 3.4 3.4 0 011.8-1.8L10 5z\"/></svg>',\n    'paste-column-after': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M12 1a3 3 0 012.8 2H18c1 0 2 .8 2 1.9V7h-2V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h7v2H6c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2H9.2A3 3 0 0112 1zm8 7v12h-6V8h6zm-1.5 1.5h-3v9h3v-9zM12 3a1 1 0 100 2 1 1 0 000-2z\"/></svg>',\n    'paste-column-before': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M12 1a3 3 0 012.8 2H18c1 0 2 .8 2 1.9V18c0 1-.8 2-1.9 2H11v-2h7V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v2H4V5c0-1 .8-2 1.9-2H9.2A3 3 0 0112 1zm-2 7v12H4V8h6zM8.5 9.5h-3v9h3v-9zM12 3a1 1 0 100 2 1 1 0 000-2z\"/></svg>',\n    'paste-row-after': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M12 1a3 3 0 012.8 2H18c1 0 2 .8 2 1.9V11h-2V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h14c0 1-.8 2-1.9 2H6c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2H9.2A3 3 0 0112 1zm10 11v5H8v-5h14zm-1.5 1.5h-11v2h11v-2zM12 3a1 1 0 100 2 1 1 0 000-2z\"/></svg>',\n    'paste-row-before': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M12 1a3 3 0 012.8 2H18c1 0 2 .8 2 1.9V7h-2V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h12v-4h2v4c0 1-.8 2-1.9 2H6c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2H9.2A3 3 0 0112 1zm10 7v5H8V8h14zm-1.5 1.5h-11v2h11v-2zM12 3a1 1 0 100 2 1 1 0 000-2z\"/></svg>',\n    'paste-text': '<svg width=\"24\" height=\"24\"><path d=\"M18 9V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h3V9h9zM9 20H6a2 2 0 01-2-2V5c0-1.1.9-2 2-2h3.2A3 3 0 0112 1a3 3 0 012.8 2H18a2 2 0 012 2v4h1v12H9v-1zm1.5-9.5v9h9v-9h-9zM12 3a1 1 0 00-1 1c0 .5.4 1 1 1s1-.5 1-1-.4-1-1-1zm0 9h6v2h-.5l-.5-1h-1v4h.8v1h-3.6v-1h.8v-4h-1l-.5 1H12v-2z\" fill-rule=\"nonzero\"/></svg>',\n    'paste': '<svg width=\"24\" height=\"24\"><path d=\"M18 9V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h3V9h9zM9 20H6a2 2 0 01-2-2V5c0-1.1.9-2 2-2h3.2A3 3 0 0112 1a3 3 0 012.8 2H18a2 2 0 012 2v4h1v12H9v-1zm1.5-9.5v9h9v-9h-9zM12 3a1 1 0 00-1 1c0 .5.4 1 1 1s1-.5 1-1-.4-1-1-1z\" fill-rule=\"nonzero\"/></svg>',\n    'permanent-pen': '<svg width=\"24\" height=\"24\"><path d=\"M10.5 17.5L8 20H3v-3l3.5-3.5a2 2 0 010-3L14 3l1 1-7.3 7.3a1 1 0 000 1.4l3.6 3.6c.4.4 1 .4 1.4 0L20 9l1 1-7.6 7.6a2 2 0 01-2.8 0l-.1-.1z\" fill-rule=\"nonzero\"/></svg>',\n    'plus': '<svg width=\"24\" height=\"24\"><path d=\"M12 4c.5 0 1 .4 1 .9V11h6a1 1 0 01.1 2H13v6a1 1 0 01-2 .1V13H5a1 1 0 01-.1-2H11V5c0-.6.4-1 1-1z\"/></svg>',\n    'preferences': '<svg width=\"24\" height=\"24\"><path d=\"M20.1 13.5l-1.9.2a5.8 5.8 0 01-.6 1.5l1.2 1.5c.4.4.3 1 0 1.4l-.7.7a1 1 0 01-1.4 0l-1.5-1.2a6.2 6.2 0 01-1.5.6l-.2 1.9c0 .5-.5.9-1 .9h-1a1 1 0 01-1-.9l-.2-1.9a5.8 5.8 0 01-1.5-.6l-1.5 1.2a1 1 0 01-1.4 0l-.7-.7a1 1 0 010-1.4l1.2-1.5a6.2 6.2 0 01-.6-1.5l-1.9-.2a1 1 0 01-.9-1v-1c0-.5.4-1 .9-1l1.9-.2a5.8 5.8 0 01.6-1.5L5.2 7.3a1 1 0 010-1.4l.7-.7a1 1 0 011.4 0l1.5 1.2a6.2 6.2 0 011.5-.6l.2-1.9c0-.5.5-.9 1-.9h1c.5 0 1 .4 1 .9l.2 1.9a5.8 5.8 0 011.5.6l1.5-1.2a1 1 0 011.4 0l.7.7c.3.4.4 1 0 1.4l-1.2 1.5a6.2 6.2 0 01.6 1.5l1.9.2c.5 0 .9.5.9 1v1c0 .5-.4 1-.9 1zM12 15a3 3 0 100-6 3 3 0 000 6z\" fill-rule=\"evenodd\"/></svg>',\n    'preview': '<svg width=\"24\" height=\"24\"><path d=\"M3.5 12.5c.5.8 1.1 1.6 1.8 2.3 2 2 4.2 3.2 6.7 3.2s4.7-1.2 6.7-3.2a16.2 16.2 0 002.1-2.8 15.7 15.7 0 00-2.1-2.8c-2-2-4.2-3.2-6.7-3.2a9.3 9.3 0 00-6.7 3.2A16.2 16.2 0 003.2 12c0 .2.2.3.3.5zm-2.4-1l.7-1.2L4 7.8C6.2 5.4 8.9 4 12 4c3 0 5.8 1.4 8.1 3.8a18.2 18.2 0 012.8 3.7v1l-.7 1.2-2.1 2.5c-2.3 2.4-5 3.8-8.1 3.8-3 0-5.8-1.4-8.1-3.8a18.2 18.2 0 01-2.8-3.7 1 1 0 010-1zm12-3.3a2 2 0 102.7 2.6 4 4 0 11-2.6-2.6z\" fill-rule=\"nonzero\"/></svg>',\n    'print': '<svg width=\"24\" height=\"24\"><path d=\"M18 8H6a3 3 0 00-3 3v6h2v3h14v-3h2v-6a3 3 0 00-3-3zm-1 10H7v-4h10v4zm.5-5c-.8 0-1.5-.7-1.5-1.5s.7-1.5 1.5-1.5 1.5.7 1.5 1.5-.7 1.5-1.5 1.5zm.5-8H6v2h12V5z\" fill-rule=\"nonzero\"/></svg>',\n    'quote': '<svg width=\"24\" height=\"24\"><path d=\"M7.5 17h.9c.4 0 .7-.2.9-.6L11 13V8c0-.6-.4-1-1-1H6a1 1 0 00-1 1v4c0 .6.4 1 1 1h2l-1.3 2.7a1 1 0 00.8 1.3zm8 0h.9c.4 0 .7-.2.9-.6L19 13V8c0-.6-.4-1-1-1h-4a1 1 0 00-1 1v4c0 .6.4 1 1 1h2l-1.3 2.7a1 1 0 00.8 1.3z\" fill-rule=\"nonzero\"/></svg>',\n    'redo': '<svg width=\"24\" height=\"24\"><path d=\"M17.6 10H12c-2.8 0-4.4 1.4-4.9 3.5-.4 2 .3 4 1.4 4.6a1 1 0 11-1 1.8c-2-1.2-2.9-4.1-2.3-6.8.6-3 3-5.1 6.8-5.1h5.6l-3.3-3.3a1 1 0 111.4-1.4l5 5a1 1 0 010 1.4l-5 5a1 1 0 01-1.4-1.4l3.3-3.3z\" fill-rule=\"nonzero\"/></svg>',\n    'reload': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M5 22.1l-1.2-4.7v-.2a1 1 0 011-1l5 .4a1 1 0 11-.2 2l-2.2-.2a7.8 7.8 0 008.4.2 7.5 7.5 0 003.5-6.4 1 1 0 112 0 9.5 9.5 0 01-4.5 8 9.9 9.9 0 01-10.2 0l.4 1.4a1 1 0 11-2 .5zM13.6 7.4c0-.5.5-1 1-.9l2.8.2a8 8 0 00-9.5-1 7.5 7.5 0 00-3.6 7 1 1 0 01-2 0 9.5 9.5 0 014.5-8.6 10 10 0 0110.9.3l-.3-1a1 1 0 012-.5l1.1 4.8a1 1 0 01-1 1.2l-5-.4a1 1 0 01-.9-1z\"/></g></svg>',\n    'remove-formatting': '<svg width=\"24\" height=\"24\"><path d=\"M13.2 6a1 1 0 010 .2l-2.6 10a1 1 0 01-1 .8h-.2a.8.8 0 01-.8-1l2.6-10H8a1 1 0 110-2h9a1 1 0 010 2h-3.8zM5 18h7a1 1 0 010 2H5a1 1 0 010-2zm13 1.5L16.5 18 15 19.5a.7.7 0 01-1-1l1.5-1.5-1.5-1.5a.7.7 0 011-1l1.5 1.5 1.5-1.5a.7.7 0 011 1L17.5 17l1.5 1.5a.7.7 0 01-1 1z\" fill-rule=\"evenodd\"/></svg>',\n    'remove': '<svg width=\"24\" height=\"24\"><path d=\"M16 7h3a1 1 0 010 2h-1v9a3 3 0 01-3 3H9a3 3 0 01-3-3V9H5a1 1 0 110-2h3V6a3 3 0 013-3h2a3 3 0 013 3v1zm-2 0V6c0-.6-.4-1-1-1h-2a1 1 0 00-1 1v1h4zm2 2H8v9c0 .6.4 1 1 1h6c.6 0 1-.4 1-1V9zm-7 3a1 1 0 012 0v4a1 1 0 01-2 0v-4zm4 0a1 1 0 012 0v4a1 1 0 01-2 0v-4z\" fill-rule=\"nonzero\"/></svg>',\n    'resize-handle': '<svg width=\"10\" height=\"10\"><g fill-rule=\"nonzero\"><path d=\"M8.1 1.1A.5.5 0 119 2l-7 7A.5.5 0 111 8l7-7zM8.1 5.1A.5.5 0 119 6l-3 3A.5.5 0 115 8l3-3z\"/></g></svg>',\n    'resize': '<svg width=\"24\" height=\"24\"><path d=\"M4 5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h6c.3 0 .5.1.7.3.2.2.3.4.3.7 0 .3-.1.5-.3.7a1 1 0 01-.7.3H7.4L18 16.6V13c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7v6c0 .3-.1.5-.3.7a1 1 0 01-.7.3h-6a1 1 0 01-.7-.3 1 1 0 01-.3-.7c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h3.6L6 7.4V11c0 .3-.1.5-.3.7a1 1 0 01-.7.3 1 1 0 01-.7-.3A1 1 0 014 11V5z\" fill-rule=\"evenodd\"/></svg>',\n    'restore-draft': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M17 13c0 .6-.4 1-1 1h-4V8c0-.6.4-1 1-1s1 .4 1 1v4h2c.6 0 1 .4 1 1z\"/><path d=\"M4.7 10H9a1 1 0 010 2H3a1 1 0 01-1-1V5a1 1 0 112 0v3l2.5-2.4a9.2 9.2 0 0110.8-1.5A9 9 0 0113.4 21c-2.4.1-4.7-.7-6.5-2.2a1 1 0 111.3-1.5 7.2 7.2 0 0011.6-3.7 7 7 0 00-3.5-7.7A7.2 7.2 0 008 7L4.7 10z\" fill-rule=\"nonzero\"/></g></svg>',\n    'rotate-left': '<svg width=\"24\" height=\"24\"><path d=\"M4.7 10H9a1 1 0 010 2H3a1 1 0 01-1-1V5a1 1 0 112 0v3l2.5-2.4a9.2 9.2 0 0110.8-1.5A9 9 0 0113.4 21c-2.4.1-4.7-.7-6.5-2.2a1 1 0 111.3-1.5 7.2 7.2 0 0011.6-3.7 7 7 0 00-3.5-7.7A7.2 7.2 0 008 7L4.7 10z\" fill-rule=\"nonzero\"/></svg>',\n    'rotate-right': '<svg width=\"24\" height=\"24\"><path d=\"M20 8V5a1 1 0 012 0v6c0 .6-.4 1-1 1h-6a1 1 0 010-2h4.3L16 7A7.2 7.2 0 007.7 6a7 7 0 003 13.1c1.9.1 3.7-.5 5-1.7a1 1 0 011.4 1.5A9.2 9.2 0 012.2 14c-.9-3.9 1-8 4.5-9.9 3.5-1.9 8-1.3 10.8 1.5L20 8z\" fill-rule=\"nonzero\"/></svg>',\n    'rtl': '<svg width=\"24\" height=\"24\"><path d=\"M8 5h8v2h-2v12h-2V7h-2v12H8v-7c-.5 0-1 0-1.4-.3A3.4 3.4 0 014.8 10a3.3 3.3 0 010-2.8 3.4 3.4 0 011.8-1.8L8 5zm12 11.2a1 1 0 11-1 1.6l-3-2a1 1 0 010-1.6l3-2a1 1 0 111 1.6L18.4 15l1.8 1.2z\" fill-rule=\"evenodd\"/></svg>',\n    'save': '<svg width=\"24\" height=\"24\"><path d=\"M5 16h14a2 2 0 012 2v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2c0-1.1.9-2 2-2zm0 2v2h14v-2H5zm10 0h2v2h-2v-2zm-4-6.4L8.7 9.3a1 1 0 10-1.4 1.4l4 4c.4.4 1 .4 1.4 0l4-4a1 1 0 10-1.4-1.4L13 11.6V4a1 1 0 00-2 0v7.6z\" fill-rule=\"nonzero\"/></svg>',\n    'search': '<svg width=\"24\" height=\"24\"><path d=\"M16 17.3a8 8 0 111.4-1.4l4.3 4.4a1 1 0 01-1.4 1.4l-4.4-4.3zm-5-.3a6 6 0 100-12 6 6 0 000 12z\" fill-rule=\"nonzero\"/></svg>',\n    'select-all': '<svg width=\"24\" height=\"24\"><path d=\"M3 5h2V3a2 2 0 00-2 2zm0 8h2v-2H3v2zm4 8h2v-2H7v2zM3 9h2V7H3v2zm10-6h-2v2h2V3zm6 0v2h2a2 2 0 00-2-2zM5 21v-2H3c0 1.1.9 2 2 2zm-2-4h2v-2H3v2zM9 3H7v2h2V3zm2 18h2v-2h-2v2zm8-8h2v-2h-2v2zm0 8a2 2 0 002-2h-2v2zm0-12h2V7h-2v2zm0 8h2v-2h-2v2zm-4 4h2v-2h-2v2zm0-16h2V3h-2v2zM7 17h10V7H7v10zm2-8h6v6H9V9z\" fill-rule=\"nonzero\"/></svg>',\n    'selected': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6c0-1.1.9-2 2-2zm3.6 10.9L7 12.3a.7.7 0 00-1 1L9.6 17 18 8.6a.7.7 0 000-1 .7.7 0 00-1 0l-7.4 7.3z\"/></svg>',\n    'settings': '<svg width=\"24\" height=\"24\"><path d=\"M11 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8v.3c0 .2 0 .3-.2.5l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6V8H5a1 1 0 110-2h2v-.3c0-.2 0-.3.2-.5l.5-.2h2.5c.3 0 .4 0 .6.2l.2.5V6zM8 8h2V6H8v2zm9 2.8v.2h2c.6 0 1 .4 1 1s-.4 1-1 1h-2v.3c0 .2 0 .3-.2.5l-.6.2h-2.4c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6V13H5a1 1 0 010-2h8v-.3c0-.2 0-.3.2-.5l.6-.2h2.4c.3 0 .4 0 .6.2l.2.6zM14 13h2v-2h-2v2zm-3 2.8v.2h8c.6 0 1 .4 1 1s-.4 1-1 1h-8v.3c0 .2 0 .3-.2.5l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6V18H5a1 1 0 010-2h2v-.3c0-.2 0-.3.2-.5l.5-.2h2.5c.3 0 .4 0 .6.2l.2.6zM8 18h2v-2H8v2z\" fill-rule=\"evenodd\"/></svg>',\n    'sharpen': '<svg width=\"24\" height=\"24\"><path d=\"M16 6l4 4-8 9-8-9 4-4h8zm-4 10.2l5.5-6.2-.1-.1H12v-.3h5.1l-.2-.2H12V9h4.6l-.2-.2H12v-.3h4.1l-.2-.2H12V8h3.6l-.2-.2H8.7L6.5 10l.1.1H12v.3H6.9l.2.2H12v.3H7.3l.2.2H12v.3H7.7l.3.2h4v.3H8.2l.2.2H12v.3H8.6l.3.2H12v.3H9l.3.2H12v.3H9.5l.2.2H12v.3h-2l.2.2H12v.3h-1.6l.2.2H12v.3h-1.1l.2.2h.9v.3h-.7l.2.2h.5v.3h-.3l.3.2z\" fill-rule=\"evenodd\"/></svg>',\n    'sourcecode': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M9.8 15.7c.3.3.3.8 0 1-.3.4-.9.4-1.2 0l-4.4-4.1a.8.8 0 010-1.2l4.4-4.2c.3-.3.9-.3 1.2 0 .3.3.3.8 0 1.1L6 12l3.8 3.7zM14.2 15.7c-.3.3-.3.8 0 1 .4.4.9.4 1.2 0l4.4-4.1c.3-.3.3-.9 0-1.2l-4.4-4.2a.8.8 0 00-1.2 0c-.3.3-.3.8 0 1.1L18 12l-3.8 3.7z\"/></g></svg>',\n    'spell-check': '<svg width=\"24\" height=\"24\"><path d=\"M6 8v3H5V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h2c.3 0 .5.1.7.3.2.2.3.4.3.7v6H8V8H6zm0-3v2h2V5H6zm13 0h-3v5h3v1h-3a1 1 0 01-.7-.3 1 1 0 01-.3-.7V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h3v1zm-5 1.5l-.1.7c-.1.2-.3.3-.6.3.3 0 .5.1.6.3l.1.7V10c0 .3-.1.5-.3.7a1 1 0 01-.7.3h-3V4h3c.3 0 .5.1.7.3.2.2.3.4.3.7v1.5zM13 10V8h-2v2h2zm0-3V5h-2v2h2zm3 5l1 1-6.5 7L7 15.5l1.3-1 2.2 2.2L16 12z\" fill-rule=\"evenodd\"/></svg>',\n    'strike-through': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M15.6 8.5c-.5-.7-1-1.1-1.3-1.3-.6-.4-1.3-.6-2-.6-2.7 0-2.8 1.7-2.8 2.1 0 1.6 1.8 2 3.2 2.3 4.4.9 4.6 2.8 4.6 3.9 0 1.4-.7 4.1-5 4.1A6.2 6.2 0 017 16.4l1.5-1.1c.4.6 1.6 2 3.7 2 1.6 0 2.5-.4 3-1.2.4-.8.3-2-.8-2.6-.7-.4-1.6-.7-2.9-1-1-.2-3.9-.8-3.9-3.6C7.6 6 10.3 5 12.4 5c2.9 0 4.2 1.6 4.7 2.4l-1.5 1.1z\"/><path d=\"M5 11h14a1 1 0 010 2H5a1 1 0 010-2z\" fill-rule=\"nonzero\"/></g></svg>',\n    'subscript': '<svg width=\"24\" height=\"24\"><path d=\"M10.4 10l4.6 4.6-1.4 1.4L9 11.4 4.4 16 3 14.6 7.6 10 3 5.4 4.4 4 9 8.6 13.6 4 15 5.4 10.4 10zM21 19h-5v-1l1-.8 1.7-1.6c.3-.4.5-.8.5-1.2 0-.3 0-.6-.2-.7-.2-.2-.5-.3-.9-.3a2 2 0 00-.8.2l-.7.3-.4-1.1 1-.6 1.2-.2c.8 0 1.4.3 1.8.7.4.4.6.9.6 1.5s-.2 1.1-.5 1.6a8 8 0 01-1.3 1.3l-.6.6h2.6V19z\" fill-rule=\"nonzero\"/></svg>',\n    'superscript': '<svg width=\"24\" height=\"24\"><path d=\"M15 9.4L10.4 14l4.6 4.6-1.4 1.4L9 15.4 4.4 20 3 18.6 7.6 14 3 9.4 4.4 8 9 12.6 13.6 8 15 9.4zm5.9 1.6h-5v-1l1-.8 1.7-1.6c.3-.5.5-.9.5-1.3 0-.3 0-.5-.2-.7-.2-.2-.5-.3-.9-.3l-.8.2-.7.4-.4-1.2c.2-.2.5-.4 1-.5.3-.2.8-.2 1.2-.2.8 0 1.4.2 1.8.6.4.4.6 1 .6 1.6 0 .5-.2 1-.5 1.5l-1.3 1.4-.6.5h2.6V11z\" fill-rule=\"nonzero\"/></svg>',\n    'table-caption': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><rect width=\"12\" height=\"2\" x=\"3\" y=\"4\" rx=\"1\"/><path d=\"M19 8a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2v-8c0-1.1.9-2 2-2h14zM5 15v3h6v-3H5zm14 0h-6v3h6v-3zm0-5h-6v3h6v-3zM5 13h6v-3H5v3z\"/></g></svg>',\n    'table-cell-classes': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M13 4v9H3V6c0-1.1.9-2 2-2h8zm-2 2H5v5h6V6z\"/><path fill-rule=\"nonzero\" d=\"M13 4h6a2 2 0 012 2v7h-8v-2h6V6h-6V4z\" opacity=\".2\"/><path d=\"M18 20l-2.6 1.6.7-3-2.4-2 3.1-.2 1.2-2.9 1.2 2.9 3 .2-2.3 2 .7 3z\"/><path fill-rule=\"nonzero\" d=\"M3 13v5c0 1.1.9 2 2 2h8v-7h-2v5H5v-5H3z\" opacity=\".2\"/></g></svg>',\n    'table-cell-properties': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-8 9H5v5h6v-5zm8 0h-6v5h6v-5zm-8-7H5v5h6V6z\"/></svg>',\n    'table-cell-select-all': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm0 2H5v12h14V6z\"/><path d=\"M13 6v5h6v2h-6v5h-2v-5H5v-2h6V6h2z\" opacity=\".2\"/></g></svg>',\n    'table-cell-select-inner': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm0 2H5v12h14V6z\" opacity=\".2\"/><path d=\"M13 6v5h6v2h-6v5h-2v-5H5v-2h6V6h2z\"/></g></svg>',\n    'table-classes': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v7h-8v7H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-8 9H5v5h6v-5zm8-7h-6v5h6V6zm-8 0H5v5h6V6z\"/><path d=\"M18 20l-2.6 1.6.7-3-2.4-2 3.1-.2 1.2-2.9 1.2 2.9 3 .2-2.3 2 .7 3z\"/></g></svg>',\n    'table-delete-column': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-4 4h-2V6h-2v2H9V6H5v12h4v-2h2v2h2v-2h2v2h4V6h-4v2zm.3.5l1 1.2-3 2.3 3 2.3-1 1.2L12 13l-3.3 2.6-1-1.2 3-2.3-3-2.3 1-1.2L12 11l3.3-2.5z\"/></svg>',\n    'table-delete-row': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm0 2H5v3h2.5v2H5v2h2.5v2H5v3h14v-3h-2.5v-2H19v-2h-2.5V9H19V6zm-4.7 1.8l1.2 1L13 12l2.6 3.3-1.2 1-2.3-3-2.3 3-1.2-1L11 12 8.5 8.7l1.2-1 2.3 3 2.3-3z\"/></svg>',\n    'table-delete-table': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 6v12h14V6H5z\"/><path d=\"M14.4 8.6l1 1-2.3 2.4 2.3 2.4-1 1-2.4-2.3-2.4 2.3-1-1 2.3-2.4-2.3-2.4 1-1 2.4 2.3z\"/></g></svg>',\n    'table-insert-column-after': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M20 4c.6 0 1 .4 1 1v2a1 1 0 01-2 0V6h-8v12h8v-1a1 1 0 012 0v2c0 .5-.4 1-.9 1H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h15zM9 13H5v5h4v-5zm7-5c.5 0 1 .4 1 .9V11h2a1 1 0 01.1 2H17v2a1 1 0 01-2 .1V13h-2a1 1 0 01-.1-2H15V9c0-.6.4-1 1-1zM9 6H5v5h4V6z\"/></svg>',\n    'table-insert-column-before': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H4a1 1 0 01-1-1v-2a1 1 0 012 0v1h8V6H5v1a1 1 0 11-2 0V5c0-.6.4-1 1-1h15zm0 9h-4v5h4v-5zM8 8c.5 0 1 .4 1 .9V11h2a1 1 0 01.1 2H9v2a1 1 0 01-2 .1V13H5a1 1 0 01-.1-2H7V9c0-.6.4-1 1-1zm11-2h-4v5h4V6z\"/></svg>',\n    'table-insert-row-above': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M6 4a1 1 0 110 2H5v6h14V6h-1a1 1 0 010-2h2c.6 0 1 .4 1 1v13a2 2 0 01-2 2H5a2 2 0 01-2-2V5c0-.6.4-1 1-1h2zm5 10H5v4h6v-4zm8 0h-6v4h6v-4zM12 3c.5 0 1 .4 1 .9V6h2a1 1 0 010 2h-2v2a1 1 0 01-2 .1V8H9a1 1 0 010-2h2V4c0-.6.4-1 1-1z\"/></svg>',\n    'table-insert-row-after': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M12 13c.5 0 1 .4 1 .9V16h2a1 1 0 01.1 2H13v2a1 1 0 01-2 .1V18H9a1 1 0 01-.1-2H11v-2c0-.6.4-1 1-1zm6 7a1 1 0 010-2h1v-6H5v6h1a1 1 0 010 2H4a1 1 0 01-1-1V6c0-1.1.9-2 2-2h14a2 2 0 012 2v13c0 .5-.4 1-.9 1H18zM11 6H5v4h6V6zm8 0h-6v4h6V6z\"/></svg>',\n    'table-left-header': '<svg width=\"24\" height=\"24\"><path d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm0 9h-4v5h4v-5zm-6 0H9v5h4v-5zm0-7H9v5h4V6zm6 0h-4v5h4V6z\"/></svg>',\n    'table-merge-cells': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 15.5V18h3v-2.5H5zm14-5h-9V18h9v-7.5zM19 6h-4v2.5h4V6zM8 6H5v2.5h3V6zm5 0h-3v2.5h3V6zm-8 7.5h3v-3H5v3z\"/></svg>',\n    'table-row-numbering-rtl': '<svg width=\"24\" height=\"24\"><path d=\"M6 4a2 2 0 00-2 2v13c0 1.1.9 2 2 2h12a2 2 0 002-2V6a2 2 0 00-2-2H6zm0 12h8v3H6v-3zm11 0c.6 0 1 .4 1 1v1a1 1 0 01-2 0v-1c0-.6.4-1 1-1zM6 11h8v3H6v-3zm11 0c.6 0 1 .4 1 1v1a1 1 0 01-2 0v-1c0-.6.4-1 1-1zM6 6h8v3H6V6zm11 0c.6 0 1 .4 1 1v1a1 1 0 11-2 0V7c0-.6.4-1 1-1z\"/></svg>',\n    'table-row-numbering': '<svg width=\"24\" height=\"24\"><path d=\"M18 4a2 2 0 012 2v13a2 2 0 01-2 2H6a2 2 0 01-2-2V6c0-1.1.9-2 2-2h12zm0 12h-8v3h8v-3zM7 16a1 1 0 00-1 1v1a1 1 0 002 0v-1c0-.6-.4-1-1-1zm11-5h-8v3h8v-3zM7 11a1 1 0 00-1 1v1a1 1 0 002 0v-1c0-.6-.4-1-1-1zm11-5h-8v3h8V6zM7 6a1 1 0 00-1 1v1a1 1 0 102 0V7c0-.6-.4-1-1-1z\"/></svg>',\n    'table-row-properties': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 15v3h6v-3H5zm14 0h-6v3h6v-3zm0-9h-6v3h6V6zM5 9h6V6H5v3z\"/></svg>',\n    'table-split-cells': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM8 15.5H5V18h3v-2.5zm11-5h-9V18h9v-7.5zm-2.5 1l1 1-2 2 2 2-1 1-2-2-2 2-1-1 2-2-2-2 1-1 2 2 2-2zm-8.5-1H5v3h3v-3zM19 6h-4v2.5h4V6zM8 6H5v2.5h3V6zm5 0h-3v2.5h3V6z\"/></svg>',\n    'table-top-header': '<svg width=\"24\" height=\"24\"><path d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-8 11H5v3h6v-3zm8 0h-6v3h6v-3zm0-5h-6v3h6v-3zM5 13h6v-3H5v3z\"/></svg>',\n    'table': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 14v4h6v-4H5zm14 0h-6v4h6v-4zm0-6h-6v4h6V8zM5 12h6V8H5v4z\"/></svg>',\n    'template': '<svg width=\"24\" height=\"24\"><path d=\"M19 19v-1H5v1h14zM9 16v-4a5 5 0 116 0v4h4a2 2 0 012 2v3H3v-3c0-1.1.9-2 2-2h4zm4 0v-5l.8-.6a3 3 0 10-3.6 0l.8.6v5h2z\" fill-rule=\"nonzero\"/></svg>',\n    'temporary-placeholder': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M9 7.6V6h2.5V4.5a.5.5 0 111 0V6H15v1.6a8 8 0 11-6 0zm-2.6 5.3a.5.5 0 00.3.6c.3 0 .6 0 .6-.3l.1-.2a5 5 0 013.3-2.8c.3-.1.4-.4.4-.6-.1-.3-.4-.5-.6-.4a6 6 0 00-4.1 3.7z\"/><circle cx=\"14\" cy=\"4\" r=\"1\"/><circle cx=\"12\" cy=\"2\" r=\"1\"/><circle cx=\"10\" cy=\"4\" r=\"1\"/></g></svg>',\n    'text-color': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path id=\"tox-icon-text-color__color\" d=\"M3 18h18v3H3z\"/><path d=\"M8.7 16h-.8a.5.5 0 01-.5-.6l2.7-9c.1-.3.3-.4.5-.4h2.8c.2 0 .4.1.5.4l2.7 9a.5.5 0 01-.5.6h-.8a.5.5 0 01-.4-.4l-.7-2.2c0-.3-.3-.4-.5-.4h-3.4c-.2 0-.4.1-.5.4l-.7 2.2c0 .3-.2.4-.4.4zm2.6-7.6l-.6 2a.5.5 0 00.5.6h1.6a.5.5 0 00.5-.6l-.6-2c0-.3-.3-.4-.5-.4h-.4c-.2 0-.4.1-.5.4z\"/></g></svg>',\n    'toc': '<svg width=\"24\" height=\"24\"><path d=\"M5 5c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 110-2zm3 0h11c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 110-2zm-3 8c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zm3 0h11c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2zm0-4c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 110-2zm3 0h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm-3 8c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zm3 0h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2z\" fill-rule=\"evenodd\"/></svg>',\n    'translate': '<svg width=\"24\" height=\"24\"><path d=\"M12.7 14.3l-.3.7-.4.7-2.2-2.2-3.1 3c-.3.4-.8.4-1 0a.7.7 0 010-1l3.1-3A12.4 12.4 0 016.7 9H8a10.1 10.1 0 001.7 2.4c.5-.5 1-1.1 1.4-1.8l.9-2H4.7a.7.7 0 110-1.5h4.4v-.7c0-.4.3-.8.7-.8.4 0 .7.4.7.8v.7H15c.4 0 .8.3.8.7 0 .4-.4.8-.8.8h-1.4a12.3 12.3 0 01-1 2.4 13.5 13.5 0 01-1.7 2.3l1.9 1.8zm4.3-3l2.7 7.3a.5.5 0 01-.4.7 1 1 0 01-1-.7l-.6-1.5h-3.4l-.6 1.5a1 1 0 01-1 .7.5.5 0 01-.4-.7l2.7-7.4a1 1 0 012 0zm-2.2 4.4h2.4L16 12.5l-1.2 3.2z\" fill-rule=\"evenodd\"/></svg>',\n    'underline': '<svg width=\"24\" height=\"24\"><path d=\"M16 5c.6 0 1 .4 1 1v5.5a4 4 0 01-.4 1.8l-1 1.4a5.3 5.3 0 01-5.5 1 5 5 0 01-1.6-1c-.5-.4-.8-.9-1.1-1.4a4 4 0 01-.4-1.8V6c0-.6.4-1 1-1s1 .4 1 1v5.5c0 .3 0 .6.2 1l.6.7a3.3 3.3 0 002.2.8 3.4 3.4 0 002.2-.8c.3-.2.4-.5.6-.8l.2-.9V6c0-.6.4-1 1-1zM8 17h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2z\" fill-rule=\"evenodd\"/></svg>',\n    'undo': '<svg width=\"24\" height=\"24\"><path d=\"M6.4 8H12c3.7 0 6.2 2 6.8 5.1.6 2.7-.4 5.6-2.3 6.8a1 1 0 01-1-1.8c1.1-.6 1.8-2.7 1.4-4.6-.5-2.1-2.1-3.5-4.9-3.5H6.4l3.3 3.3a1 1 0 11-1.4 1.4l-5-5a1 1 0 010-1.4l5-5a1 1 0 011.4 1.4L6.4 8z\" fill-rule=\"nonzero\"/></svg>',\n    'unlink': '<svg width=\"24\" height=\"24\"><path d=\"M6.2 12.3a1 1 0 011.4 1.4l-2 2a2 2 0 102.6 2.8l4.8-4.8a1 1 0 000-1.4 1 1 0 111.4-1.3 2.9 2.9 0 010 4L9.6 20a3.9 3.9 0 01-5.5-5.5l2-2zm11.6-.6a1 1 0 01-1.4-1.4l2.1-2a2 2 0 10-2.7-2.8L11 10.3a1 1 0 000 1.4A1 1 0 119.6 13a2.9 2.9 0 010-4L14.4 4a3.9 3.9 0 015.5 5.5l-2 2zM7.6 6.3a.8.8 0 01-1 1.1L3.3 4.2a.7.7 0 111-1l3.2 3.1zM5.1 8.6a.8.8 0 010 1.5H3a.8.8 0 010-1.5H5zm5-3.5a.8.8 0 01-1.5 0V3a.8.8 0 011.5 0V5zm6 11.8a.8.8 0 011-1l3.2 3.2a.8.8 0 01-1 1L16 17zm-2.2 2a.8.8 0 011.5 0V21a.8.8 0 01-1.5 0V19zm5-3.5a.7.7 0 110-1.5H21a.8.8 0 010 1.5H19z\" fill-rule=\"nonzero\"/></svg>',\n    'unlock': '<svg width=\"24\" height=\"24\"><path d=\"M16 5c.8 0 1.5.3 2.1.9.6.6.9 1.3.9 2.1v3h-2V8a1 1 0 00-.3-.7A1 1 0 0016 7h-2a1 1 0 00-.7.3 1 1 0 00-.3.7v3h.3c.2 0 .3 0 .5.2l.2.6v7.4c0 .3 0 .4-.2.6l-.6.2H4.8c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6v-7.4c0-.3 0-.4.2-.6l.5-.2H11V8c0-.8.3-1.5.9-2.1.6-.6 1.3-.9 2.1-.9h2z\" fill-rule=\"evenodd\"/></svg>',\n    'unordered-list': '<svg width=\"24\" height=\"24\"><path d=\"M11 5h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zM4.5 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1zm0 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1zm0 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1z\" fill-rule=\"evenodd\"/></svg>',\n    'unselected': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6c0-1.1.9-2 2-2zm0 1a1 1 0 00-1 1v12c0 .6.4 1 1 1h12c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H6z\"/></svg>',\n    'upload': '<svg width=\"24\" height=\"24\"><path d=\"M18 19v-2a1 1 0 012 0v3c0 .6-.4 1-1 1H5a1 1 0 01-1-1v-3a1 1 0 012 0v2h12zM11 6.4L8.7 8.7a1 1 0 01-1.4-1.4l4-4a1 1 0 011.4 0l4 4a1 1 0 11-1.4 1.4L13 6.4V16a1 1 0 01-2 0V6.4z\" fill-rule=\"nonzero\"/></svg>',\n    'user': '<svg width=\"24\" height=\"24\"><path d=\"M12 24a12 12 0 110-24 12 12 0 010 24zm-8.7-5.3a11 11 0 0017.4 0C19.4 16.3 14.6 15 12 15c-2.6 0-7.4 1.3-8.7 3.7zM12 13c2.2 0 4-2 4-4.5S14.2 4 12 4 8 6 8 8.5 9.8 13 12 13z\" fill-rule=\"nonzero\"/></svg>',\n    'vertical-align': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><rect width=\"18\" height=\"2\" x=\"3\" y=\"11\" rx=\"1\"/><path d=\"M12 2c.6 0 1 .4 1 1v4l2-1.3a1 1 0 011.2 1.5l-.1.1-4.1 3-4-3a1 1 0 011-1.7l2 1.5V3c0-.6.4-1 1-1zm0 11.8l4 2.9a1 1 0 01-1 1.7l-2-1.5V21c0 .5-.4 1-.9 1H12a1 1 0 01-1-1v-4l-2 1.3a1 1 0 01-1.2-.1l-.1-.1a1 1 0 01.1-1.3l.1-.1 4.1-3z\"/></g></svg>',\n    'visualblocks': '<svg width=\"24\" height=\"24\"><path d=\"M9 19v2H7v-2h2zm-4 0v2a2 2 0 01-2-2h2zm8 0v2h-2v-2h2zm8 0a2 2 0 01-2 2v-2h2zm-4 0v2h-2v-2h2zM15 7a1 1 0 010 2v7a1 1 0 01-2 0V9h-1v7a1 1 0 01-2 0v-4a2.5 2.5 0 01-.2-5H15zM5 15v2H3v-2h2zm16 0v2h-2v-2h2zM5 11v2H3v-2h2zm16 0v2h-2v-2h2zM5 7v2H3V7h2zm16 0v2h-2V7h2zM5 3v2H3c0-1.1.9-2 2-2zm8 0v2h-2V3h2zm6 0a2 2 0 012 2h-2V3zM9 3v2H7V3h2zm8 0v2h-2V3h2z\" fill-rule=\"evenodd\"/></svg>',\n    'visualchars': '<svg width=\"24\" height=\"24\"><path d=\"M10 5h7a1 1 0 010 2h-1v11a1 1 0 01-2 0V7h-2v11a1 1 0 01-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 016.8 10a3.3 3.3 0 010-2.8 3.4 3.4 0 011.8-1.8L10 5z\" fill-rule=\"evenodd\"/></svg>',\n    'warning': '<svg width=\"24\" height=\"24\"><path d=\"M19.8 18.3c.2.5.3.9 0 1.2-.1.3-.5.5-1 .5H5.2c-.5 0-.9-.2-1-.5-.3-.3-.2-.7 0-1.2L11 4.7l.5-.5.5-.2c.2 0 .3 0 .5.2.2 0 .3.3.5.5l6.8 13.6zM12 18c.3 0 .5-.1.7-.3.2-.2.3-.4.3-.7a1 1 0 00-.3-.7 1 1 0 00-.7-.3 1 1 0 00-.7.3 1 1 0 00-.3.7c0 .3.1.5.3.7.2.2.4.3.7.3zm.7-3l.3-4a1 1 0 00-.3-.7 1 1 0 00-.7-.3 1 1 0 00-.7.3 1 1 0 00-.3.7l.3 4h1.4z\" fill-rule=\"evenodd\"/></svg>',\n    'zoom-in': '<svg width=\"24\" height=\"24\"><path d=\"M16 17.3a8 8 0 111.4-1.4l4.3 4.4a1 1 0 01-1.4 1.4l-4.4-4.3zm-5-.3a6 6 0 100-12 6 6 0 000 12zm-1-9a1 1 0 012 0v6a1 1 0 01-2 0V8zm-2 4a1 1 0 010-2h6a1 1 0 010 2H8z\" fill-rule=\"nonzero\"/></svg>',\n    'zoom-out': '<svg width=\"24\" height=\"24\"><path d=\"M16 17.3a8 8 0 111.4-1.4l4.3 4.4a1 1 0 01-1.4 1.4l-4.4-4.3zm-5-.3a6 6 0 100-12 6 6 0 000 12zm-3-5a1 1 0 010-2h6a1 1 0 010 2H8z\" fill-rule=\"nonzero\"/></svg>'\n  }\n});\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/icons/default/icons.js?");

/***/ }),

/***/ "./node_modules/tinymce/icons/default/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/icons/default/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"default\" icons for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/icons/default')\n//   ES2015:\n//     import 'tinymce/icons/default'\n__webpack_require__(/*! ./icons.js */ \"./node_modules/tinymce/icons/default/icons.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/icons/default/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/autoresize/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/tinymce/plugins/autoresize/index.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"autoresize\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/autoresize')\n//   ES2015:\n//     import 'tinymce/plugins/autoresize'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/autoresize/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/autoresize/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/autoresize/plugin.js":
/*!***********************************************************!*\
  !*** ./node_modules/tinymce/plugins/autoresize/plugin.js ***!
  \***********************************************************/
/***/ (() => {

eval("/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.9 (2023-11-15)\n */\n(function () {\n  'use strict';\n\n  var Cell = function Cell(initial) {\n    var value = initial;\n    var get = function get() {\n      return value;\n    };\n    var set = function set(v) {\n      value = v;\n    };\n    return {\n      get: get,\n      set: set\n    };\n  };\n  var hasOwnProperty = Object.hasOwnProperty;\n  var has = function has(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n  var global$2 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var global$1 = tinymce.util.Tools.resolve('tinymce.Env');\n  var global = tinymce.util.Tools.resolve('tinymce.util.Delay');\n  var fireResizeEditor = function fireResizeEditor(editor) {\n    return editor.fire('ResizeEditor');\n  };\n  var getAutoResizeMinHeight = function getAutoResizeMinHeight(editor) {\n    return editor.getParam('min_height', editor.getElement().offsetHeight, 'number');\n  };\n  var getAutoResizeMaxHeight = function getAutoResizeMaxHeight(editor) {\n    return editor.getParam('max_height', 0, 'number');\n  };\n  var getAutoResizeOverflowPadding = function getAutoResizeOverflowPadding(editor) {\n    return editor.getParam('autoresize_overflow_padding', 1, 'number');\n  };\n  var getAutoResizeBottomMargin = function getAutoResizeBottomMargin(editor) {\n    return editor.getParam('autoresize_bottom_margin', 50, 'number');\n  };\n  var shouldAutoResizeOnInit = function shouldAutoResizeOnInit(editor) {\n    return editor.getParam('autoresize_on_init', true, 'boolean');\n  };\n  var isFullscreen = function isFullscreen(editor) {\n    return editor.plugins.fullscreen && editor.plugins.fullscreen.isFullscreen();\n  };\n  var _wait = function wait(editor, oldSize, times, interval, callback) {\n    global.setEditorTimeout(editor, function () {\n      _resize(editor, oldSize);\n      if (times--) {\n        _wait(editor, oldSize, times, interval, callback);\n      } else if (callback) {\n        callback();\n      }\n    }, interval);\n  };\n  var toggleScrolling = function toggleScrolling(editor, state) {\n    var body = editor.getBody();\n    if (body) {\n      body.style.overflowY = state ? '' : 'hidden';\n      if (!state) {\n        body.scrollTop = 0;\n      }\n    }\n  };\n  var parseCssValueToInt = function parseCssValueToInt(dom, elm, name, computed) {\n    var value = parseInt(dom.getStyle(elm, name, computed), 10);\n    return isNaN(value) ? 0 : value;\n  };\n  var shouldScrollIntoView = function shouldScrollIntoView(trigger) {\n    if ((trigger === null || trigger === void 0 ? void 0 : trigger.type.toLowerCase()) === 'setcontent') {\n      var setContentEvent = trigger;\n      return setContentEvent.selection === true || setContentEvent.paste === true;\n    } else {\n      return false;\n    }\n  };\n  var _resize = function resize(editor, oldSize, trigger) {\n    var dom = editor.dom;\n    var doc = editor.getDoc();\n    if (!doc) {\n      return;\n    }\n    if (isFullscreen(editor)) {\n      toggleScrolling(editor, true);\n      return;\n    }\n    var docEle = doc.documentElement;\n    var resizeBottomMargin = getAutoResizeBottomMargin(editor);\n    var resizeHeight = getAutoResizeMinHeight(editor);\n    var marginTop = parseCssValueToInt(dom, docEle, 'margin-top', true);\n    var marginBottom = parseCssValueToInt(dom, docEle, 'margin-bottom', true);\n    var contentHeight = docEle.offsetHeight + marginTop + marginBottom + resizeBottomMargin;\n    if (contentHeight < 0) {\n      contentHeight = 0;\n    }\n    var containerHeight = editor.getContainer().offsetHeight;\n    var contentAreaHeight = editor.getContentAreaContainer().offsetHeight;\n    var chromeHeight = containerHeight - contentAreaHeight;\n    if (contentHeight + chromeHeight > getAutoResizeMinHeight(editor)) {\n      resizeHeight = contentHeight + chromeHeight;\n    }\n    var maxHeight = getAutoResizeMaxHeight(editor);\n    if (maxHeight && resizeHeight > maxHeight) {\n      resizeHeight = maxHeight;\n      toggleScrolling(editor, true);\n    } else {\n      toggleScrolling(editor, false);\n    }\n    if (resizeHeight !== oldSize.get()) {\n      var deltaSize = resizeHeight - oldSize.get();\n      dom.setStyle(editor.getContainer(), 'height', resizeHeight + 'px');\n      oldSize.set(resizeHeight);\n      fireResizeEditor(editor);\n      if (global$1.browser.isSafari() && global$1.mac) {\n        var win = editor.getWin();\n        win.scrollTo(win.pageXOffset, win.pageYOffset);\n      }\n      if (editor.hasFocus() && shouldScrollIntoView(trigger)) {\n        editor.selection.scrollIntoView();\n      }\n      if (global$1.webkit && deltaSize < 0) {\n        _resize(editor, oldSize, trigger);\n      }\n    }\n  };\n  var setup = function setup(editor, oldSize) {\n    editor.on('init', function () {\n      var overflowPadding = getAutoResizeOverflowPadding(editor);\n      var dom = editor.dom;\n      dom.setStyles(editor.getDoc().documentElement, {\n        height: 'auto'\n      });\n      dom.setStyles(editor.getBody(), {\n        'paddingLeft': overflowPadding,\n        'paddingRight': overflowPadding,\n        'min-height': 0\n      });\n    });\n    editor.on('NodeChange SetContent keyup FullscreenStateChanged ResizeContent', function (e) {\n      _resize(editor, oldSize, e);\n    });\n    if (shouldAutoResizeOnInit(editor)) {\n      editor.on('init', function () {\n        _wait(editor, oldSize, 20, 100, function () {\n          _wait(editor, oldSize, 5, 1000);\n        });\n      });\n    }\n  };\n  var register = function register(editor, oldSize) {\n    editor.addCommand('mceAutoResize', function () {\n      _resize(editor, oldSize);\n    });\n  };\n  function Plugin() {\n    global$2.add('autoresize', function (editor) {\n      if (!has(editor.settings, 'resize')) {\n        editor.settings.resize = false;\n      }\n      if (!editor.inline) {\n        var oldSize = Cell(0);\n        register(editor, oldSize);\n        setup(editor, oldSize);\n      }\n    });\n  }\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/autoresize/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/code/index.js":
/*!****************************************************!*\
  !*** ./node_modules/tinymce/plugins/code/index.js ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"code\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/code')\n//   ES2015:\n//     import 'tinymce/plugins/code'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/code/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/code/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/code/plugin.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/code/plugin.js ***!
  \*****************************************************/
/***/ (() => {

eval("/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.9 (2023-11-15)\n */\n(function () {\n  'use strict';\n\n  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var setContent = function setContent(editor, html) {\n    editor.focus();\n    editor.undoManager.transact(function () {\n      editor.setContent(html);\n    });\n    editor.selection.setCursorLocation();\n    editor.nodeChanged();\n  };\n  var getContent = function getContent(editor) {\n    return editor.getContent({\n      source_view: true\n    });\n  };\n  var open = function open(editor) {\n    var editorContent = getContent(editor);\n    editor.windowManager.open({\n      title: 'Source Code',\n      size: 'large',\n      body: {\n        type: 'panel',\n        items: [{\n          type: 'textarea',\n          name: 'code'\n        }]\n      },\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: {\n        code: editorContent\n      },\n      onSubmit: function onSubmit(api) {\n        setContent(editor, api.getData().code);\n        api.close();\n      }\n    });\n  };\n  var register$1 = function register$1(editor) {\n    editor.addCommand('mceCodeEditor', function () {\n      open(editor);\n    });\n  };\n  var register = function register(editor) {\n    var onAction = function onAction() {\n      return editor.execCommand('mceCodeEditor');\n    };\n    editor.ui.registry.addButton('code', {\n      icon: 'sourcecode',\n      tooltip: 'Source code',\n      onAction: onAction\n    });\n    editor.ui.registry.addMenuItem('code', {\n      icon: 'sourcecode',\n      text: 'Source code',\n      onAction: onAction\n    });\n  };\n  function Plugin() {\n    global.add('code', function (editor) {\n      register$1(editor);\n      register(editor);\n      return {};\n    });\n  }\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/code/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/link/index.js":
/*!****************************************************!*\
  !*** ./node_modules/tinymce/plugins/link/index.js ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"link\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/link')\n//   ES2015:\n//     import 'tinymce/plugins/link'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/link/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/link/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/link/plugin.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/link/plugin.js ***!
  \*****************************************************/
/***/ (() => {

eval("/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.9 (2023-11-15)\n */\n(function () {\n  'use strict';\n\n  var global$7 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var global$6 = tinymce.util.Tools.resolve('tinymce.util.VK');\n  var typeOf = function typeOf(x) {\n    var t = typeof x;\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n  var isType = function isType(type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n  var isSimpleType = function isSimpleType(type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n  var eq = function eq(t) {\n    return function (a) {\n      return t === a;\n    };\n  };\n  var isString = isType('string');\n  var isArray = isType('array');\n  var isNull = eq(null);\n  var isBoolean = isSimpleType('boolean');\n  var isFunction = isSimpleType('function');\n  var noop = function noop() {};\n  var constant = function constant(value) {\n    return function () {\n      return value;\n    };\n  };\n  var identity = function identity(x) {\n    return x;\n  };\n  var tripleEquals = function tripleEquals(a, b) {\n    return a === b;\n  };\n  var never = constant(false);\n  var always = constant(true);\n  var none = function none() {\n    return NONE;\n  };\n  var NONE = function () {\n    var call = function call(thunk) {\n      return thunk();\n    };\n    var id = identity;\n    var me = {\n      fold: function fold(n, _s) {\n        return n();\n      },\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function getOrDie(msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: function filter() {\n        return none();\n      },\n      toArray: function toArray() {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n  var _some = function some(a) {\n    var constant_a = constant(a);\n    var self = function self() {\n      return me;\n    };\n    var bind = function bind(f) {\n      return f(a);\n    };\n    var me = {\n      fold: function fold(n, s) {\n        return s(a);\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function map(f) {\n        return _some(f(a));\n      },\n      each: function each(f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function filter(f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function toArray() {\n        return [a];\n      },\n      toString: function toString() {\n        return 'some(' + a + ')';\n      }\n    };\n    return me;\n  };\n  var from = function from(value) {\n    return value === null || value === undefined ? NONE : _some(value);\n  };\n  var Optional = {\n    some: _some,\n    none: none,\n    from: from\n  };\n  var nativeIndexOf = Array.prototype.indexOf;\n  var nativePush = Array.prototype.push;\n  var rawIndexOf = function rawIndexOf(ts, t) {\n    return nativeIndexOf.call(ts, t);\n  };\n  var contains = function contains(xs, x) {\n    return rawIndexOf(xs, x) > -1;\n  };\n  var map = function map(xs, f) {\n    var len = xs.length;\n    var r = new Array(len);\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n    return r;\n  };\n  var each$1 = function each$1(xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n  var foldl = function foldl(xs, f, acc) {\n    each$1(xs, function (x, i) {\n      acc = f(acc, x, i);\n    });\n    return acc;\n  };\n  var flatten = function flatten(xs) {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n      nativePush.apply(r, xs[i]);\n    }\n    return r;\n  };\n  var bind = function bind(xs, f) {\n    return flatten(map(xs, f));\n  };\n  var findMap = function findMap(arr, f) {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n      if (r.isSome()) {\n        return r;\n      }\n    }\n    return Optional.none();\n  };\n  var is = function is(lhs, rhs, comparator) {\n    if (comparator === void 0) {\n      comparator = tripleEquals;\n    }\n    return lhs.exists(function (left) {\n      return comparator(left, rhs);\n    });\n  };\n  var cat = function cat(arr) {\n    var r = [];\n    var push = function push(x) {\n      r.push(x);\n    };\n    for (var i = 0; i < arr.length; i++) {\n      arr[i].each(push);\n    }\n    return r;\n  };\n  var someIf = function someIf(b, a) {\n    return b ? Optional.some(a) : Optional.none();\n  };\n  var assumeExternalTargets = function assumeExternalTargets(editor) {\n    var externalTargets = editor.getParam('link_assume_external_targets', false);\n    if (isBoolean(externalTargets) && externalTargets) {\n      return 1;\n    } else if (isString(externalTargets) && (externalTargets === 'http' || externalTargets === 'https')) {\n      return externalTargets;\n    }\n    return 0;\n  };\n  var hasContextToolbar = function hasContextToolbar(editor) {\n    return editor.getParam('link_context_toolbar', false, 'boolean');\n  };\n  var getLinkList = function getLinkList(editor) {\n    return editor.getParam('link_list');\n  };\n  var getDefaultLinkTarget = function getDefaultLinkTarget(editor) {\n    return editor.getParam('default_link_target');\n  };\n  var getTargetList = function getTargetList(editor) {\n    return editor.getParam('target_list', true);\n  };\n  var getRelList = function getRelList(editor) {\n    return editor.getParam('rel_list', [], 'array');\n  };\n  var getLinkClassList = function getLinkClassList(editor) {\n    return editor.getParam('link_class_list', [], 'array');\n  };\n  var shouldShowLinkTitle = function shouldShowLinkTitle(editor) {\n    return editor.getParam('link_title', true, 'boolean');\n  };\n  var allowUnsafeLinkTarget = function allowUnsafeLinkTarget(editor) {\n    return editor.getParam('allow_unsafe_link_target', false, 'boolean');\n  };\n  var useQuickLink = function useQuickLink(editor) {\n    return editor.getParam('link_quicklink', false, 'boolean');\n  };\n  var getDefaultLinkProtocol = function getDefaultLinkProtocol(editor) {\n    return editor.getParam('link_default_protocol', 'http', 'string');\n  };\n  var global$5 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var getValue = function getValue(item) {\n    return isString(item.value) ? item.value : '';\n  };\n  var getText = function getText(item) {\n    if (isString(item.text)) {\n      return item.text;\n    } else if (isString(item.title)) {\n      return item.title;\n    } else {\n      return '';\n    }\n  };\n  var _sanitizeList = function sanitizeList(list, extractValue) {\n    var out = [];\n    global$5.each(list, function (item) {\n      var text = getText(item);\n      if (item.menu !== undefined) {\n        var items = _sanitizeList(item.menu, extractValue);\n        out.push({\n          text: text,\n          items: items\n        });\n      } else {\n        var value = extractValue(item);\n        out.push({\n          text: text,\n          value: value\n        });\n      }\n    });\n    return out;\n  };\n  var sanitizeWith = function sanitizeWith(extracter) {\n    if (extracter === void 0) {\n      extracter = getValue;\n    }\n    return function (list) {\n      return Optional.from(list).map(function (list) {\n        return _sanitizeList(list, extracter);\n      });\n    };\n  };\n  var sanitize = function sanitize(list) {\n    return sanitizeWith(getValue)(list);\n  };\n  var createUi = function createUi(name, label) {\n    return function (items) {\n      return {\n        name: name,\n        type: 'listbox',\n        label: label,\n        items: items\n      };\n    };\n  };\n  var ListOptions = {\n    sanitize: sanitize,\n    sanitizeWith: sanitizeWith,\n    createUi: createUi,\n    getValue: getValue\n  };\n  var _assign = function __assign() {\n    _assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n    };\n    return _assign.apply(this, arguments);\n  };\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n  var each = function each(obj, f) {\n    var props = keys(obj);\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n  var objAcc = function objAcc(r) {\n    return function (x, i) {\n      r[i] = x;\n    };\n  };\n  var internalFilter = function internalFilter(obj, pred, onTrue, onFalse) {\n    var r = {};\n    each(obj, function (x, i) {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n    return r;\n  };\n  var filter = function filter(obj, pred) {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n  var has = function has(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n  var hasNonNullableKey = function hasNonNullableKey(obj, key) {\n    return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  };\n  var global$4 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');\n  var global$3 = tinymce.util.Tools.resolve('tinymce.util.URI');\n  var isAnchor = function isAnchor(elm) {\n    return elm && elm.nodeName.toLowerCase() === 'a';\n  };\n  var isLink = function isLink(elm) {\n    return isAnchor(elm) && !!getHref(elm);\n  };\n  var collectNodesInRange = function collectNodesInRange(rng, predicate) {\n    if (rng.collapsed) {\n      return [];\n    } else {\n      var contents = rng.cloneContents();\n      var walker = new global$4(contents.firstChild, contents);\n      var elements = [];\n      var current = contents.firstChild;\n      do {\n        if (predicate(current)) {\n          elements.push(current);\n        }\n      } while (current = walker.next());\n      return elements;\n    }\n  };\n  var hasProtocol = function hasProtocol(url) {\n    return /^\\w+:/i.test(url);\n  };\n  var getHref = function getHref(elm) {\n    var href = elm.getAttribute('data-mce-href');\n    return href ? href : elm.getAttribute('href');\n  };\n  var applyRelTargetRules = function applyRelTargetRules(rel, isUnsafe) {\n    var rules = ['noopener'];\n    var rels = rel ? rel.split(/\\s+/) : [];\n    var toString = function toString(rels) {\n      return global$5.trim(rels.sort().join(' '));\n    };\n    var addTargetRules = function addTargetRules(rels) {\n      rels = removeTargetRules(rels);\n      return rels.length > 0 ? rels.concat(rules) : rules;\n    };\n    var removeTargetRules = function removeTargetRules(rels) {\n      return rels.filter(function (val) {\n        return global$5.inArray(rules, val) === -1;\n      });\n    };\n    var newRels = isUnsafe ? addTargetRules(rels) : removeTargetRules(rels);\n    return newRels.length > 0 ? toString(newRels) : '';\n  };\n  var trimCaretContainers = function trimCaretContainers(text) {\n    return text.replace(/\\uFEFF/g, '');\n  };\n  var getAnchorElement = function getAnchorElement(editor, selectedElm) {\n    selectedElm = selectedElm || editor.selection.getNode();\n    if (isImageFigure(selectedElm)) {\n      return editor.dom.select('a[href]', selectedElm)[0];\n    } else {\n      return editor.dom.getParent(selectedElm, 'a[href]');\n    }\n  };\n  var getAnchorText = function getAnchorText(selection, anchorElm) {\n    var text = anchorElm ? anchorElm.innerText || anchorElm.textContent : selection.getContent({\n      format: 'text'\n    });\n    return trimCaretContainers(text);\n  };\n  var hasLinks = function hasLinks(elements) {\n    return global$5.grep(elements, isLink).length > 0;\n  };\n  var hasLinksInSelection = function hasLinksInSelection(rng) {\n    return collectNodesInRange(rng, isLink).length > 0;\n  };\n  var isOnlyTextSelected = function isOnlyTextSelected(editor) {\n    var inlineTextElements = editor.schema.getTextInlineElements();\n    var isElement = function isElement(elm) {\n      return elm.nodeType === 1 && !isAnchor(elm) && !has(inlineTextElements, elm.nodeName.toLowerCase());\n    };\n    var elements = collectNodesInRange(editor.selection.getRng(), isElement);\n    return elements.length === 0;\n  };\n  var isImageFigure = function isImageFigure(elm) {\n    return elm && elm.nodeName === 'FIGURE' && /\\bimage\\b/i.test(elm.className);\n  };\n  var getLinkAttrs = function getLinkAttrs(data) {\n    var attrs = ['title', 'rel', 'class', 'target'];\n    return foldl(attrs, function (acc, key) {\n      data[key].each(function (value) {\n        acc[key] = value.length > 0 ? value : null;\n      });\n      return acc;\n    }, {\n      href: data.href\n    });\n  };\n  var handleExternalTargets = function handleExternalTargets(href, assumeExternalTargets) {\n    if ((assumeExternalTargets === 'http' || assumeExternalTargets === 'https') && !hasProtocol(href)) {\n      return assumeExternalTargets + '://' + href;\n    }\n    return href;\n  };\n  var applyLinkOverrides = function applyLinkOverrides(editor, linkAttrs) {\n    var newLinkAttrs = _assign({}, linkAttrs);\n    if (!(getRelList(editor).length > 0) && allowUnsafeLinkTarget(editor) === false) {\n      var newRel = applyRelTargetRules(newLinkAttrs.rel, newLinkAttrs.target === '_blank');\n      newLinkAttrs.rel = newRel ? newRel : null;\n    }\n    if (Optional.from(newLinkAttrs.target).isNone() && getTargetList(editor) === false) {\n      newLinkAttrs.target = getDefaultLinkTarget(editor);\n    }\n    newLinkAttrs.href = handleExternalTargets(newLinkAttrs.href, assumeExternalTargets(editor));\n    return newLinkAttrs;\n  };\n  var updateLink = function updateLink(editor, anchorElm, text, linkAttrs) {\n    text.each(function (text) {\n      if (has(anchorElm, 'innerText')) {\n        anchorElm.innerText = text;\n      } else {\n        anchorElm.textContent = text;\n      }\n    });\n    editor.dom.setAttribs(anchorElm, linkAttrs);\n    editor.selection.select(anchorElm);\n  };\n  var createLink = function createLink(editor, selectedElm, text, linkAttrs) {\n    if (isImageFigure(selectedElm)) {\n      linkImageFigure(editor, selectedElm, linkAttrs);\n    } else {\n      text.fold(function () {\n        editor.execCommand('mceInsertLink', false, linkAttrs);\n      }, function (text) {\n        editor.insertContent(editor.dom.createHTML('a', linkAttrs, editor.dom.encode(text)));\n      });\n    }\n  };\n  var linkDomMutation = function linkDomMutation(editor, attachState, data) {\n    var selectedElm = editor.selection.getNode();\n    var anchorElm = getAnchorElement(editor, selectedElm);\n    var linkAttrs = applyLinkOverrides(editor, getLinkAttrs(data));\n    editor.undoManager.transact(function () {\n      if (data.href === attachState.href) {\n        attachState.attach();\n      }\n      if (anchorElm) {\n        editor.focus();\n        updateLink(editor, anchorElm, data.text, linkAttrs);\n      } else {\n        createLink(editor, selectedElm, data.text, linkAttrs);\n      }\n    });\n  };\n  var unlinkSelection = function unlinkSelection(editor) {\n    var dom = editor.dom,\n      selection = editor.selection;\n    var bookmark = selection.getBookmark();\n    var rng = selection.getRng().cloneRange();\n    var startAnchorElm = dom.getParent(rng.startContainer, 'a[href]', editor.getBody());\n    var endAnchorElm = dom.getParent(rng.endContainer, 'a[href]', editor.getBody());\n    if (startAnchorElm) {\n      rng.setStartBefore(startAnchorElm);\n    }\n    if (endAnchorElm) {\n      rng.setEndAfter(endAnchorElm);\n    }\n    selection.setRng(rng);\n    editor.execCommand('unlink');\n    selection.moveToBookmark(bookmark);\n  };\n  var unlinkDomMutation = function unlinkDomMutation(editor) {\n    editor.undoManager.transact(function () {\n      var node = editor.selection.getNode();\n      if (isImageFigure(node)) {\n        unlinkImageFigure(editor, node);\n      } else {\n        unlinkSelection(editor);\n      }\n      editor.focus();\n    });\n  };\n  var unwrapOptions = function unwrapOptions(data) {\n    var cls = data.class,\n      href = data.href,\n      rel = data.rel,\n      target = data.target,\n      text = data.text,\n      title = data.title;\n    return filter({\n      class: cls.getOrNull(),\n      href: href,\n      rel: rel.getOrNull(),\n      target: target.getOrNull(),\n      text: text.getOrNull(),\n      title: title.getOrNull()\n    }, function (v, _k) {\n      return isNull(v) === false;\n    });\n  };\n  var sanitizeData = function sanitizeData(editor, data) {\n    var href = data.href;\n    return _assign(_assign({}, data), {\n      href: global$3.isDomSafe(href, 'a', editor.settings) ? href : ''\n    });\n  };\n  var link = function link(editor, attachState, data) {\n    var sanitizedData = sanitizeData(editor, data);\n    editor.hasPlugin('rtc', true) ? editor.execCommand('createlink', false, unwrapOptions(sanitizedData)) : linkDomMutation(editor, attachState, sanitizedData);\n  };\n  var unlink = function unlink(editor) {\n    editor.hasPlugin('rtc', true) ? editor.execCommand('unlink') : unlinkDomMutation(editor);\n  };\n  var unlinkImageFigure = function unlinkImageFigure(editor, fig) {\n    var img = editor.dom.select('img', fig)[0];\n    if (img) {\n      var a = editor.dom.getParents(img, 'a[href]', fig)[0];\n      if (a) {\n        a.parentNode.insertBefore(img, a);\n        editor.dom.remove(a);\n      }\n    }\n  };\n  var linkImageFigure = function linkImageFigure(editor, fig, attrs) {\n    var img = editor.dom.select('img', fig)[0];\n    if (img) {\n      var a = editor.dom.create('a', attrs);\n      img.parentNode.insertBefore(a, img);\n      a.appendChild(img);\n    }\n  };\n  var isListGroup = function isListGroup(item) {\n    return hasNonNullableKey(item, 'items');\n  };\n  var _findTextByValue = function findTextByValue(value, catalog) {\n    return findMap(catalog, function (item) {\n      if (isListGroup(item)) {\n        return _findTextByValue(value, item.items);\n      } else {\n        return someIf(item.value === value, item);\n      }\n    });\n  };\n  var getDelta = function getDelta(persistentText, fieldName, catalog, data) {\n    var value = data[fieldName];\n    var hasPersistentText = persistentText.length > 0;\n    return value !== undefined ? _findTextByValue(value, catalog).map(function (i) {\n      return {\n        url: {\n          value: i.value,\n          meta: {\n            text: hasPersistentText ? persistentText : i.text,\n            attach: noop\n          }\n        },\n        text: hasPersistentText ? persistentText : i.text\n      };\n    }) : Optional.none();\n  };\n  var findCatalog = function findCatalog(catalogs, fieldName) {\n    if (fieldName === 'link') {\n      return catalogs.link;\n    } else if (fieldName === 'anchor') {\n      return catalogs.anchor;\n    } else {\n      return Optional.none();\n    }\n  };\n  var init = function init(initialData, linkCatalog) {\n    var persistentData = {\n      text: initialData.text,\n      title: initialData.title\n    };\n    var getTitleFromUrlChange = function getTitleFromUrlChange(url) {\n      return someIf(persistentData.title.length <= 0, Optional.from(url.meta.title).getOr(''));\n    };\n    var getTextFromUrlChange = function getTextFromUrlChange(url) {\n      return someIf(persistentData.text.length <= 0, Optional.from(url.meta.text).getOr(url.value));\n    };\n    var onUrlChange = function onUrlChange(data) {\n      var text = getTextFromUrlChange(data.url);\n      var title = getTitleFromUrlChange(data.url);\n      if (text.isSome() || title.isSome()) {\n        return Optional.some(_assign(_assign({}, text.map(function (text) {\n          return {\n            text: text\n          };\n        }).getOr({})), title.map(function (title) {\n          return {\n            title: title\n          };\n        }).getOr({})));\n      } else {\n        return Optional.none();\n      }\n    };\n    var onCatalogChange = function onCatalogChange(data, change) {\n      var catalog = findCatalog(linkCatalog, change.name).getOr([]);\n      return getDelta(persistentData.text, change.name, catalog, data);\n    };\n    var onChange = function onChange(getData, change) {\n      var name = change.name;\n      if (name === 'url') {\n        return onUrlChange(getData());\n      } else if (contains(['anchor', 'link'], name)) {\n        return onCatalogChange(getData(), change);\n      } else if (name === 'text' || name === 'title') {\n        persistentData[name] = getData()[name];\n        return Optional.none();\n      } else {\n        return Optional.none();\n      }\n    };\n    return {\n      onChange: onChange\n    };\n  };\n  var DialogChanges = {\n    init: init,\n    getDelta: getDelta\n  };\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n  var delayedConfirm = function delayedConfirm(editor, message, callback) {\n    var rng = editor.selection.getRng();\n    global$2.setEditorTimeout(editor, function () {\n      editor.windowManager.confirm(message, function (state) {\n        editor.selection.setRng(rng);\n        callback(state);\n      });\n    });\n  };\n  var tryEmailTransform = function tryEmailTransform(data) {\n    var url = data.href;\n    var suggestMailTo = url.indexOf('@') > 0 && url.indexOf('/') === -1 && url.indexOf('mailto:') === -1;\n    return suggestMailTo ? Optional.some({\n      message: 'The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?',\n      preprocess: function preprocess(oldData) {\n        return _assign(_assign({}, oldData), {\n          href: 'mailto:' + url\n        });\n      }\n    }) : Optional.none();\n  };\n  var tryProtocolTransform = function tryProtocolTransform(assumeExternalTargets, defaultLinkProtocol) {\n    return function (data) {\n      var url = data.href;\n      var suggestProtocol = assumeExternalTargets === 1 && !hasProtocol(url) || assumeExternalTargets === 0 && /^\\s*www(\\.|\\d\\.)/i.test(url);\n      return suggestProtocol ? Optional.some({\n        message: 'The URL you entered seems to be an external link. Do you want to add the required ' + defaultLinkProtocol + ':// prefix?',\n        preprocess: function preprocess(oldData) {\n          return _assign(_assign({}, oldData), {\n            href: defaultLinkProtocol + '://' + url\n          });\n        }\n      }) : Optional.none();\n    };\n  };\n  var preprocess = function preprocess(editor, data) {\n    return findMap([tryEmailTransform, tryProtocolTransform(assumeExternalTargets(editor), getDefaultLinkProtocol(editor))], function (f) {\n      return f(data);\n    }).fold(function () {\n      return global$1.resolve(data);\n    }, function (transform) {\n      return new global$1(function (callback) {\n        delayedConfirm(editor, transform.message, function (state) {\n          callback(state ? transform.preprocess(data) : data);\n        });\n      });\n    });\n  };\n  var DialogConfirms = {\n    preprocess: preprocess\n  };\n  var getAnchors = function getAnchors(editor) {\n    var anchorNodes = editor.dom.select('a:not([href])');\n    var anchors = bind(anchorNodes, function (anchor) {\n      var id = anchor.name || anchor.id;\n      return id ? [{\n        text: id,\n        value: '#' + id\n      }] : [];\n    });\n    return anchors.length > 0 ? Optional.some([{\n      text: 'None',\n      value: ''\n    }].concat(anchors)) : Optional.none();\n  };\n  var AnchorListOptions = {\n    getAnchors: getAnchors\n  };\n  var getClasses = function getClasses(editor) {\n    var list = getLinkClassList(editor);\n    if (list.length > 0) {\n      return ListOptions.sanitize(list);\n    }\n    return Optional.none();\n  };\n  var ClassListOptions = {\n    getClasses: getClasses\n  };\n  var global = tinymce.util.Tools.resolve('tinymce.util.XHR');\n  var parseJson = function parseJson(text) {\n    try {\n      return Optional.some(JSON.parse(text));\n    } catch (err) {\n      return Optional.none();\n    }\n  };\n  var getLinks = function getLinks(editor) {\n    var extractor = function extractor(item) {\n      return editor.convertURL(item.value || item.url, 'href');\n    };\n    var linkList = getLinkList(editor);\n    return new global$1(function (callback) {\n      if (isString(linkList)) {\n        global.send({\n          url: linkList,\n          success: function success(text) {\n            return callback(parseJson(text));\n          },\n          error: function error(_) {\n            return callback(Optional.none());\n          }\n        });\n      } else if (isFunction(linkList)) {\n        linkList(function (output) {\n          return callback(Optional.some(output));\n        });\n      } else {\n        callback(Optional.from(linkList));\n      }\n    }).then(function (optItems) {\n      return optItems.bind(ListOptions.sanitizeWith(extractor)).map(function (items) {\n        if (items.length > 0) {\n          var noneItem = [{\n            text: 'None',\n            value: ''\n          }];\n          return noneItem.concat(items);\n        } else {\n          return items;\n        }\n      });\n    });\n  };\n  var LinkListOptions = {\n    getLinks: getLinks\n  };\n  var getRels = function getRels(editor, initialTarget) {\n    var list = getRelList(editor);\n    if (list.length > 0) {\n      var isTargetBlank_1 = is(initialTarget, '_blank');\n      var enforceSafe = allowUnsafeLinkTarget(editor) === false;\n      var safeRelExtractor = function safeRelExtractor(item) {\n        return applyRelTargetRules(ListOptions.getValue(item), isTargetBlank_1);\n      };\n      var sanitizer = enforceSafe ? ListOptions.sanitizeWith(safeRelExtractor) : ListOptions.sanitize;\n      return sanitizer(list);\n    }\n    return Optional.none();\n  };\n  var RelOptions = {\n    getRels: getRels\n  };\n  var fallbacks = [{\n    text: 'Current window',\n    value: ''\n  }, {\n    text: 'New window',\n    value: '_blank'\n  }];\n  var getTargets = function getTargets(editor) {\n    var list = getTargetList(editor);\n    if (isArray(list)) {\n      return ListOptions.sanitize(list).orThunk(function () {\n        return Optional.some(fallbacks);\n      });\n    } else if (list === false) {\n      return Optional.none();\n    }\n    return Optional.some(fallbacks);\n  };\n  var TargetOptions = {\n    getTargets: getTargets\n  };\n  var nonEmptyAttr = function nonEmptyAttr(dom, elem, name) {\n    var val = dom.getAttrib(elem, name);\n    return val !== null && val.length > 0 ? Optional.some(val) : Optional.none();\n  };\n  var extractFromAnchor = function extractFromAnchor(editor, anchor) {\n    var dom = editor.dom;\n    var onlyText = isOnlyTextSelected(editor);\n    var text = onlyText ? Optional.some(getAnchorText(editor.selection, anchor)) : Optional.none();\n    var url = anchor ? Optional.some(dom.getAttrib(anchor, 'href')) : Optional.none();\n    var target = anchor ? Optional.from(dom.getAttrib(anchor, 'target')) : Optional.none();\n    var rel = nonEmptyAttr(dom, anchor, 'rel');\n    var linkClass = nonEmptyAttr(dom, anchor, 'class');\n    var title = nonEmptyAttr(dom, anchor, 'title');\n    return {\n      url: url,\n      text: text,\n      title: title,\n      target: target,\n      rel: rel,\n      linkClass: linkClass\n    };\n  };\n  var collect = function collect(editor, linkNode) {\n    return LinkListOptions.getLinks(editor).then(function (links) {\n      var anchor = extractFromAnchor(editor, linkNode);\n      return {\n        anchor: anchor,\n        catalogs: {\n          targets: TargetOptions.getTargets(editor),\n          rels: RelOptions.getRels(editor, anchor.target),\n          classes: ClassListOptions.getClasses(editor),\n          anchor: AnchorListOptions.getAnchors(editor),\n          link: links\n        },\n        optNode: Optional.from(linkNode),\n        flags: {\n          titleEnabled: shouldShowLinkTitle(editor)\n        }\n      };\n    });\n  };\n  var DialogInfo = {\n    collect: collect\n  };\n  var handleSubmit = function handleSubmit(editor, info) {\n    return function (api) {\n      var data = api.getData();\n      if (!data.url.value) {\n        unlink(editor);\n        api.close();\n        return;\n      }\n      var getChangedValue = function getChangedValue(key) {\n        return Optional.from(data[key]).filter(function (value) {\n          return !is(info.anchor[key], value);\n        });\n      };\n      var changedData = {\n        href: data.url.value,\n        text: getChangedValue('text'),\n        target: getChangedValue('target'),\n        rel: getChangedValue('rel'),\n        class: getChangedValue('linkClass'),\n        title: getChangedValue('title')\n      };\n      var attachState = {\n        href: data.url.value,\n        attach: data.url.meta !== undefined && data.url.meta.attach ? data.url.meta.attach : noop\n      };\n      DialogConfirms.preprocess(editor, changedData).then(function (pData) {\n        link(editor, attachState, pData);\n      });\n      api.close();\n    };\n  };\n  var collectData = function collectData(editor) {\n    var anchorNode = getAnchorElement(editor);\n    return DialogInfo.collect(editor, anchorNode);\n  };\n  var getInitialData = function getInitialData(info, defaultTarget) {\n    var anchor = info.anchor;\n    var url = anchor.url.getOr('');\n    return {\n      url: {\n        value: url,\n        meta: {\n          original: {\n            value: url\n          }\n        }\n      },\n      text: anchor.text.getOr(''),\n      title: anchor.title.getOr(''),\n      anchor: url,\n      link: url,\n      rel: anchor.rel.getOr(''),\n      target: anchor.target.or(defaultTarget).getOr(''),\n      linkClass: anchor.linkClass.getOr('')\n    };\n  };\n  var makeDialog = function makeDialog(settings, onSubmit, editor) {\n    var urlInput = [{\n      name: 'url',\n      type: 'urlinput',\n      filetype: 'file',\n      label: 'URL'\n    }];\n    var displayText = settings.anchor.text.map(function () {\n      return {\n        name: 'text',\n        type: 'input',\n        label: 'Text to display'\n      };\n    }).toArray();\n    var titleText = settings.flags.titleEnabled ? [{\n      name: 'title',\n      type: 'input',\n      label: 'Title'\n    }] : [];\n    var defaultTarget = Optional.from(getDefaultLinkTarget(editor));\n    var initialData = getInitialData(settings, defaultTarget);\n    var catalogs = settings.catalogs;\n    var dialogDelta = DialogChanges.init(initialData, catalogs);\n    var body = {\n      type: 'panel',\n      items: flatten([urlInput, displayText, titleText, cat([catalogs.anchor.map(ListOptions.createUi('anchor', 'Anchors')), catalogs.rels.map(ListOptions.createUi('rel', 'Rel')), catalogs.targets.map(ListOptions.createUi('target', 'Open link in...')), catalogs.link.map(ListOptions.createUi('link', 'Link list')), catalogs.classes.map(ListOptions.createUi('linkClass', 'Class'))])])\n    };\n    return {\n      title: 'Insert/Edit Link',\n      size: 'normal',\n      body: body,\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: initialData,\n      onChange: function onChange(api, _a) {\n        var name = _a.name;\n        dialogDelta.onChange(api.getData, {\n          name: name\n        }).each(function (newData) {\n          api.setData(newData);\n        });\n      },\n      onSubmit: onSubmit\n    };\n  };\n  var open$1 = function open$1(editor) {\n    var data = collectData(editor);\n    data.then(function (info) {\n      var onSubmit = handleSubmit(editor, info);\n      return makeDialog(info, onSubmit, editor);\n    }).then(function (spec) {\n      editor.windowManager.open(spec);\n    });\n  };\n  var appendClickRemove = function appendClickRemove(link, evt) {\n    document.body.appendChild(link);\n    link.dispatchEvent(evt);\n    document.body.removeChild(link);\n  };\n  var open = function open(url) {\n    var link = document.createElement('a');\n    link.target = '_blank';\n    link.href = url;\n    link.rel = 'noreferrer noopener';\n    var evt = document.createEvent('MouseEvents');\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n    appendClickRemove(link, evt);\n  };\n  var getLink = function getLink(editor, elm) {\n    return editor.dom.getParent(elm, 'a[href]');\n  };\n  var getSelectedLink = function getSelectedLink(editor) {\n    return getLink(editor, editor.selection.getStart());\n  };\n  var hasOnlyAltModifier = function hasOnlyAltModifier(e) {\n    return e.altKey === true && e.shiftKey === false && e.ctrlKey === false && e.metaKey === false;\n  };\n  var gotoLink = function gotoLink(editor, a) {\n    if (a) {\n      var href = getHref(a);\n      if (/^#/.test(href)) {\n        var targetEl = editor.$(href);\n        if (targetEl.length) {\n          editor.selection.scrollIntoView(targetEl[0], true);\n        }\n      } else {\n        open(a.href);\n      }\n    }\n  };\n  var openDialog = function openDialog(editor) {\n    return function () {\n      open$1(editor);\n    };\n  };\n  var gotoSelectedLink = function gotoSelectedLink(editor) {\n    return function () {\n      gotoLink(editor, getSelectedLink(editor));\n    };\n  };\n  var setupGotoLinks = function setupGotoLinks(editor) {\n    editor.on('click', function (e) {\n      var link = getLink(editor, e.target);\n      if (link && global$6.metaKeyPressed(e)) {\n        e.preventDefault();\n        gotoLink(editor, link);\n      }\n    });\n    editor.on('keydown', function (e) {\n      var link = getSelectedLink(editor);\n      if (link && e.keyCode === 13 && hasOnlyAltModifier(e)) {\n        e.preventDefault();\n        gotoLink(editor, link);\n      }\n    });\n  };\n  var toggleState = function toggleState(editor, toggler) {\n    editor.on('NodeChange', toggler);\n    return function () {\n      return editor.off('NodeChange', toggler);\n    };\n  };\n  var toggleActiveState = function toggleActiveState(editor) {\n    return function (api) {\n      var updateState = function updateState() {\n        return api.setActive(!editor.mode.isReadOnly() && getAnchorElement(editor, editor.selection.getNode()) !== null);\n      };\n      updateState();\n      return toggleState(editor, updateState);\n    };\n  };\n  var toggleEnabledState = function toggleEnabledState(editor) {\n    return function (api) {\n      var updateState = function updateState() {\n        return api.setDisabled(getAnchorElement(editor, editor.selection.getNode()) === null);\n      };\n      updateState();\n      return toggleState(editor, updateState);\n    };\n  };\n  var toggleUnlinkState = function toggleUnlinkState(editor) {\n    return function (api) {\n      var hasLinks$1 = function hasLinks$1(parents) {\n        return hasLinks(parents) || hasLinksInSelection(editor.selection.getRng());\n      };\n      var parents = editor.dom.getParents(editor.selection.getStart());\n      api.setDisabled(!hasLinks$1(parents));\n      return toggleState(editor, function (e) {\n        return api.setDisabled(!hasLinks$1(e.parents));\n      });\n    };\n  };\n  var register = function register(editor) {\n    editor.addCommand('mceLink', function () {\n      if (useQuickLink(editor)) {\n        editor.fire('contexttoolbar-show', {\n          toolbarKey: 'quicklink'\n        });\n      } else {\n        openDialog(editor)();\n      }\n    });\n  };\n  var setup = function setup(editor) {\n    editor.addShortcut('Meta+K', '', function () {\n      editor.execCommand('mceLink');\n    });\n  };\n  var setupButtons = function setupButtons(editor) {\n    editor.ui.registry.addToggleButton('link', {\n      icon: 'link',\n      tooltip: 'Insert/edit link',\n      onAction: openDialog(editor),\n      onSetup: toggleActiveState(editor)\n    });\n    editor.ui.registry.addButton('openlink', {\n      icon: 'new-tab',\n      tooltip: 'Open link',\n      onAction: gotoSelectedLink(editor),\n      onSetup: toggleEnabledState(editor)\n    });\n    editor.ui.registry.addButton('unlink', {\n      icon: 'unlink',\n      tooltip: 'Remove link',\n      onAction: function onAction() {\n        return unlink(editor);\n      },\n      onSetup: toggleUnlinkState(editor)\n    });\n  };\n  var setupMenuItems = function setupMenuItems(editor) {\n    editor.ui.registry.addMenuItem('openlink', {\n      text: 'Open link',\n      icon: 'new-tab',\n      onAction: gotoSelectedLink(editor),\n      onSetup: toggleEnabledState(editor)\n    });\n    editor.ui.registry.addMenuItem('link', {\n      icon: 'link',\n      text: 'Link...',\n      shortcut: 'Meta+K',\n      onAction: openDialog(editor)\n    });\n    editor.ui.registry.addMenuItem('unlink', {\n      icon: 'unlink',\n      text: 'Remove link',\n      onAction: function onAction() {\n        return unlink(editor);\n      },\n      onSetup: toggleUnlinkState(editor)\n    });\n  };\n  var setupContextMenu = function setupContextMenu(editor) {\n    var inLink = 'link unlink openlink';\n    var noLink = 'link';\n    editor.ui.registry.addContextMenu('link', {\n      update: function update(element) {\n        return hasLinks(editor.dom.getParents(element, 'a')) ? inLink : noLink;\n      }\n    });\n  };\n  var setupContextToolbars = function setupContextToolbars(editor) {\n    var collapseSelectionToEnd = function collapseSelectionToEnd(editor) {\n      editor.selection.collapse(false);\n    };\n    var onSetupLink = function onSetupLink(buttonApi) {\n      var node = editor.selection.getNode();\n      buttonApi.setDisabled(!getAnchorElement(editor, node));\n      return noop;\n    };\n    var getLinkText = function getLinkText(value) {\n      var anchor = getAnchorElement(editor);\n      var onlyText = isOnlyTextSelected(editor);\n      if (!anchor && onlyText) {\n        var text = getAnchorText(editor.selection, anchor);\n        return Optional.some(text.length > 0 ? text : value);\n      } else {\n        return Optional.none();\n      }\n    };\n    editor.ui.registry.addContextForm('quicklink', {\n      launch: {\n        type: 'contextformtogglebutton',\n        icon: 'link',\n        tooltip: 'Link',\n        onSetup: toggleActiveState(editor)\n      },\n      label: 'Link',\n      predicate: function predicate(node) {\n        return !!getAnchorElement(editor, node) && hasContextToolbar(editor);\n      },\n      initValue: function initValue() {\n        var elm = getAnchorElement(editor);\n        return !!elm ? getHref(elm) : '';\n      },\n      commands: [{\n        type: 'contextformtogglebutton',\n        icon: 'link',\n        tooltip: 'Link',\n        primary: true,\n        onSetup: function onSetup(buttonApi) {\n          var node = editor.selection.getNode();\n          buttonApi.setActive(!!getAnchorElement(editor, node));\n          return toggleActiveState(editor)(buttonApi);\n        },\n        onAction: function onAction(formApi) {\n          var value = formApi.getValue();\n          var text = getLinkText(value);\n          var attachState = {\n            href: value,\n            attach: noop\n          };\n          link(editor, attachState, {\n            href: value,\n            text: text,\n            title: Optional.none(),\n            rel: Optional.none(),\n            target: Optional.none(),\n            class: Optional.none()\n          });\n          collapseSelectionToEnd(editor);\n          formApi.hide();\n        }\n      }, {\n        type: 'contextformbutton',\n        icon: 'unlink',\n        tooltip: 'Remove link',\n        onSetup: onSetupLink,\n        onAction: function onAction(formApi) {\n          unlink(editor);\n          formApi.hide();\n        }\n      }, {\n        type: 'contextformbutton',\n        icon: 'new-tab',\n        tooltip: 'Open link',\n        onSetup: onSetupLink,\n        onAction: function onAction(formApi) {\n          gotoSelectedLink(editor)();\n          formApi.hide();\n        }\n      }]\n    });\n  };\n  function Plugin() {\n    global$7.add('link', function (editor) {\n      setupButtons(editor);\n      setupMenuItems(editor);\n      setupContextMenu(editor);\n      setupContextToolbars(editor);\n      setupGotoLinks(editor);\n      register(editor);\n      setup(editor);\n    });\n  }\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/link/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/lists/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/lists/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"lists\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/lists')\n//   ES2015:\n//     import 'tinymce/plugins/lists'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/lists/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/lists/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/lists/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/lists/plugin.js ***!
  \******************************************************/
/***/ (() => {

eval("/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.9 (2023-11-15)\n */\n(function () {\n  'use strict';\n\n  var global$7 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var typeOf = function typeOf(x) {\n    var t = typeof x;\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n  var isType$1 = function isType$1(type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n  var isSimpleType = function isSimpleType(type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n  var isString = isType$1('string');\n  var isObject = isType$1('object');\n  var isArray = isType$1('array');\n  var isBoolean = isSimpleType('boolean');\n  var isFunction = isSimpleType('function');\n  var isNumber = isSimpleType('number');\n  var noop = function noop() {};\n  var constant = function constant(value) {\n    return function () {\n      return value;\n    };\n  };\n  var identity = function identity(x) {\n    return x;\n  };\n  var tripleEquals = function tripleEquals(a, b) {\n    return a === b;\n  };\n  var not = function not(f) {\n    return function (t) {\n      return !f(t);\n    };\n  };\n  var never = constant(false);\n  var always = constant(true);\n  var none = function none() {\n    return NONE;\n  };\n  var NONE = function () {\n    var call = function call(thunk) {\n      return thunk();\n    };\n    var id = identity;\n    var me = {\n      fold: function fold(n, _s) {\n        return n();\n      },\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function getOrDie(msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: function filter() {\n        return none();\n      },\n      toArray: function toArray() {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n  var _some = function some(a) {\n    var constant_a = constant(a);\n    var self = function self() {\n      return me;\n    };\n    var bind = function bind(f) {\n      return f(a);\n    };\n    var me = {\n      fold: function fold(n, s) {\n        return s(a);\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function map(f) {\n        return _some(f(a));\n      },\n      each: function each(f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function filter(f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function toArray() {\n        return [a];\n      },\n      toString: function toString() {\n        return 'some(' + a + ')';\n      }\n    };\n    return me;\n  };\n  var from = function from(value) {\n    return value === null || value === undefined ? NONE : _some(value);\n  };\n  var Optional = {\n    some: _some,\n    none: none,\n    from: from\n  };\n  var nativeSlice = Array.prototype.slice;\n  var nativePush = Array.prototype.push;\n  var map = function map(xs, f) {\n    var len = xs.length;\n    var r = new Array(len);\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n    return r;\n  };\n  var each$1 = function each$1(xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n  var filter$1 = function filter$1(xs, pred) {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        r.push(x);\n      }\n    }\n    return r;\n  };\n  var groupBy = function groupBy(xs, f) {\n    if (xs.length === 0) {\n      return [];\n    } else {\n      var wasType = f(xs[0]);\n      var r = [];\n      var group = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        var type = f(x);\n        if (type !== wasType) {\n          r.push(group);\n          group = [];\n        }\n        wasType = type;\n        group.push(x);\n      }\n      if (group.length !== 0) {\n        r.push(group);\n      }\n      return r;\n    }\n  };\n  var foldl = function foldl(xs, f, acc) {\n    each$1(xs, function (x, i) {\n      acc = f(acc, x, i);\n    });\n    return acc;\n  };\n  var findUntil = function findUntil(xs, pred, until) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return Optional.some(x);\n      } else if (until(x, i)) {\n        break;\n      }\n    }\n    return Optional.none();\n  };\n  var find$1 = function find$1(xs, pred) {\n    return findUntil(xs, pred, never);\n  };\n  var flatten = function flatten(xs) {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n      nativePush.apply(r, xs[i]);\n    }\n    return r;\n  };\n  var bind = function bind(xs, f) {\n    return flatten(map(xs, f));\n  };\n  var reverse = function reverse(xs) {\n    var r = nativeSlice.call(xs, 0);\n    r.reverse();\n    return r;\n  };\n  var get$1 = function get$1(xs, i) {\n    return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  };\n  var head = function head(xs) {\n    return get$1(xs, 0);\n  };\n  var last = function last(xs) {\n    return get$1(xs, xs.length - 1);\n  };\n  var findMap = function findMap(arr, f) {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n      if (r.isSome()) {\n        return r;\n      }\n    }\n    return Optional.none();\n  };\n  var _assign = function __assign() {\n    _assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n    };\n    return _assign.apply(this, arguments);\n  };\n  function __spreadArray(to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n        if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n        ar[i] = from[i];\n      }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n  }\n  var cached = function cached(f) {\n    var called = false;\n    var r;\n    return function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      if (!called) {\n        called = true;\n        r = f.apply(null, args);\n      }\n      return r;\n    };\n  };\n  var DeviceType = function DeviceType(os, browser, userAgent, mediaMatch) {\n    var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n    var isiPhone = os.isiOS() && !isiPad;\n    var isMobile = os.isiOS() || os.isAndroid();\n    var isTouch = isMobile || mediaMatch('(pointer:coarse)');\n    var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');\n    var isPhone = isiPhone || isMobile && !isTablet;\n    var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n    var isDesktop = !isPhone && !isTablet && !iOSwebview;\n    return {\n      isiPad: constant(isiPad),\n      isiPhone: constant(isiPhone),\n      isTablet: constant(isTablet),\n      isPhone: constant(isPhone),\n      isTouch: constant(isTouch),\n      isAndroid: os.isAndroid,\n      isiOS: os.isiOS,\n      isWebView: constant(iOSwebview),\n      isDesktop: constant(isDesktop)\n    };\n  };\n  var firstMatch = function firstMatch(regexes, s) {\n    for (var i = 0; i < regexes.length; i++) {\n      var x = regexes[i];\n      if (x.test(s)) {\n        return x;\n      }\n    }\n    return undefined;\n  };\n  var find = function find(regexes, agent) {\n    var r = firstMatch(regexes, agent);\n    if (!r) {\n      return {\n        major: 0,\n        minor: 0\n      };\n    }\n    var group = function group(i) {\n      return Number(agent.replace(r, '$' + i));\n    };\n    return nu$2(group(1), group(2));\n  };\n  var detect$3 = function detect$3(versionRegexes, agent) {\n    var cleanedAgent = String(agent).toLowerCase();\n    if (versionRegexes.length === 0) {\n      return unknown$2();\n    }\n    return find(versionRegexes, cleanedAgent);\n  };\n  var unknown$2 = function unknown$2() {\n    return nu$2(0, 0);\n  };\n  var nu$2 = function nu$2(major, minor) {\n    return {\n      major: major,\n      minor: minor\n    };\n  };\n  var Version = {\n    nu: nu$2,\n    detect: detect$3,\n    unknown: unknown$2\n  };\n  var detectBrowser$1 = function detectBrowser$1(browsers, userAgentData) {\n    return findMap(userAgentData.brands, function (uaBrand) {\n      var lcBrand = uaBrand.brand.toLowerCase();\n      return find$1(browsers, function (browser) {\n        var _a;\n        return lcBrand === ((_a = browser.brand) === null || _a === void 0 ? void 0 : _a.toLowerCase());\n      }).map(function (info) {\n        return {\n          current: info.name,\n          version: Version.nu(parseInt(uaBrand.version, 10), 0)\n        };\n      });\n    });\n  };\n  var detect$2 = function detect$2(candidates, userAgent) {\n    var agent = String(userAgent).toLowerCase();\n    return find$1(candidates, function (candidate) {\n      return candidate.search(agent);\n    });\n  };\n  var detectBrowser = function detectBrowser(browsers, userAgent) {\n    return detect$2(browsers, userAgent).map(function (browser) {\n      var version = Version.detect(browser.versionRegexes, userAgent);\n      return {\n        current: browser.name,\n        version: version\n      };\n    });\n  };\n  var detectOs = function detectOs(oses, userAgent) {\n    return detect$2(oses, userAgent).map(function (os) {\n      var version = Version.detect(os.versionRegexes, userAgent);\n      return {\n        current: os.name,\n        version: version\n      };\n    });\n  };\n  var contains$1 = function contains$1(str, substr) {\n    return str.indexOf(substr) !== -1;\n  };\n  var blank = function blank(r) {\n    return function (s) {\n      return s.replace(r, '');\n    };\n  };\n  var trim = blank(/^\\s+|\\s+$/g);\n  var isNotEmpty = function isNotEmpty(s) {\n    return s.length > 0;\n  };\n  var isEmpty$1 = function isEmpty$1(s) {\n    return !isNotEmpty(s);\n  };\n  var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n  var checkContains = function checkContains(target) {\n    return function (uastring) {\n      return contains$1(uastring, target);\n    };\n  };\n  var browsers = [{\n    name: 'Edge',\n    versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n    search: function search(uastring) {\n      return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');\n    }\n  }, {\n    name: 'Chrome',\n    brand: 'Chromium',\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/, normalVersionRegex],\n    search: function search(uastring) {\n      return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');\n    }\n  }, {\n    name: 'IE',\n    versionRegexes: [/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/, /.*?rv:([0-9]+)\\.([0-9]+).*/],\n    search: function search(uastring) {\n      return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');\n    }\n  }, {\n    name: 'Opera',\n    versionRegexes: [normalVersionRegex, /.*?opera\\/([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('opera')\n  }, {\n    name: 'Firefox',\n    versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('firefox')\n  }, {\n    name: 'Safari',\n    versionRegexes: [normalVersionRegex, /.*?cpu os ([0-9]+)_([0-9]+).*/],\n    search: function search(uastring) {\n      return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');\n    }\n  }];\n  var oses = [{\n    name: 'Windows',\n    search: checkContains('win'),\n    versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'iOS',\n    search: function search(uastring) {\n      return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');\n    },\n    versionRegexes: [/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/, /.*cpu iphone os ([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Android',\n    search: checkContains('android'),\n    versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'OSX',\n    search: checkContains('mac os x'),\n    versionRegexes: [/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Linux',\n    search: checkContains('linux'),\n    versionRegexes: []\n  }, {\n    name: 'Solaris',\n    search: checkContains('sunos'),\n    versionRegexes: []\n  }, {\n    name: 'FreeBSD',\n    search: checkContains('freebsd'),\n    versionRegexes: []\n  }, {\n    name: 'ChromeOS',\n    search: checkContains('cros'),\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]\n  }];\n  var PlatformInfo = {\n    browsers: constant(browsers),\n    oses: constant(oses)\n  };\n  var edge = 'Edge';\n  var chrome = 'Chrome';\n  var ie = 'IE';\n  var opera = 'Opera';\n  var firefox = 'Firefox';\n  var safari = 'Safari';\n  var unknown$1 = function unknown$1() {\n    return nu$1({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n  var nu$1 = function nu$1(info) {\n    var current = info.current;\n    var version = info.version;\n    var isBrowser = function isBrowser(name) {\n      return function () {\n        return current === name;\n      };\n    };\n    return {\n      current: current,\n      version: version,\n      isEdge: isBrowser(edge),\n      isChrome: isBrowser(chrome),\n      isIE: isBrowser(ie),\n      isOpera: isBrowser(opera),\n      isFirefox: isBrowser(firefox),\n      isSafari: isBrowser(safari)\n    };\n  };\n  var Browser = {\n    unknown: unknown$1,\n    nu: nu$1,\n    edge: constant(edge),\n    chrome: constant(chrome),\n    ie: constant(ie),\n    opera: constant(opera),\n    firefox: constant(firefox),\n    safari: constant(safari)\n  };\n  var windows = 'Windows';\n  var ios = 'iOS';\n  var android = 'Android';\n  var linux = 'Linux';\n  var osx = 'OSX';\n  var solaris = 'Solaris';\n  var freebsd = 'FreeBSD';\n  var chromeos = 'ChromeOS';\n  var unknown = function unknown() {\n    return nu({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n  var nu = function nu(info) {\n    var current = info.current;\n    var version = info.version;\n    var isOS = function isOS(name) {\n      return function () {\n        return current === name;\n      };\n    };\n    return {\n      current: current,\n      version: version,\n      isWindows: isOS(windows),\n      isiOS: isOS(ios),\n      isAndroid: isOS(android),\n      isOSX: isOS(osx),\n      isLinux: isOS(linux),\n      isSolaris: isOS(solaris),\n      isFreeBSD: isOS(freebsd),\n      isChromeOS: isOS(chromeos)\n    };\n  };\n  var OperatingSystem = {\n    unknown: unknown,\n    nu: nu,\n    windows: constant(windows),\n    ios: constant(ios),\n    android: constant(android),\n    linux: constant(linux),\n    osx: constant(osx),\n    solaris: constant(solaris),\n    freebsd: constant(freebsd),\n    chromeos: constant(chromeos)\n  };\n  var detect$1 = function detect$1(userAgent, userAgentDataOpt, mediaMatch) {\n    var browsers = PlatformInfo.browsers();\n    var oses = PlatformInfo.oses();\n    var browser = userAgentDataOpt.bind(function (userAgentData) {\n      return detectBrowser$1(browsers, userAgentData);\n    }).orThunk(function () {\n      return detectBrowser(browsers, userAgent);\n    }).fold(Browser.unknown, Browser.nu);\n    var os = detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n    var deviceType = DeviceType(os, browser, userAgent, mediaMatch);\n    return {\n      browser: browser,\n      os: os,\n      deviceType: deviceType\n    };\n  };\n  var PlatformDetection = {\n    detect: detect$1\n  };\n  var mediaMatch = function mediaMatch(query) {\n    return window.matchMedia(query).matches;\n  };\n  var platform = cached(function () {\n    return PlatformDetection.detect(navigator.userAgent, Optional.from(navigator.userAgentData), mediaMatch);\n  });\n  var detect = function detect() {\n    return platform();\n  };\n  var compareDocumentPosition = function compareDocumentPosition(a, b, match) {\n    return (a.compareDocumentPosition(b) & match) !== 0;\n  };\n  var documentPositionContainedBy = function documentPositionContainedBy(a, b) {\n    return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);\n  };\n  var ELEMENT = 1;\n  var fromHtml = function fromHtml(html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      console.error('HTML does not have a single root node', html);\n      throw new Error('HTML must have a single root node');\n    }\n    return fromDom(div.childNodes[0]);\n  };\n  var fromTag = function fromTag(tag, scope) {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom(node);\n  };\n  var fromText = function fromText(text, scope) {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom(node);\n  };\n  var fromDom = function fromDom(node) {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n    return {\n      dom: node\n    };\n  };\n  var fromPoint = function fromPoint(docElm, x, y) {\n    return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n  };\n  var SugarElement = {\n    fromHtml: fromHtml,\n    fromTag: fromTag,\n    fromText: fromText,\n    fromDom: fromDom,\n    fromPoint: fromPoint\n  };\n  var is$2 = function is$2(element, selector) {\n    var dom = element.dom;\n    if (dom.nodeType !== ELEMENT) {\n      return false;\n    } else {\n      var elem = dom;\n      if (elem.matches !== undefined) {\n        return elem.matches(selector);\n      } else if (elem.msMatchesSelector !== undefined) {\n        return elem.msMatchesSelector(selector);\n      } else if (elem.webkitMatchesSelector !== undefined) {\n        return elem.webkitMatchesSelector(selector);\n      } else if (elem.mozMatchesSelector !== undefined) {\n        return elem.mozMatchesSelector(selector);\n      } else {\n        throw new Error('Browser lacks native selectors');\n      }\n    }\n  };\n  var eq = function eq(e1, e2) {\n    return e1.dom === e2.dom;\n  };\n  var regularContains = function regularContains(e1, e2) {\n    var d1 = e1.dom;\n    var d2 = e2.dom;\n    return d1 === d2 ? false : d1.contains(d2);\n  };\n  var ieContains = function ieContains(e1, e2) {\n    return documentPositionContainedBy(e1.dom, e2.dom);\n  };\n  var contains = function contains(e1, e2) {\n    return detect().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);\n  };\n  var is$1 = is$2;\n  var global$6 = tinymce.util.Tools.resolve('tinymce.dom.RangeUtils');\n  var global$5 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');\n  var global$4 = tinymce.util.Tools.resolve('tinymce.util.VK');\n  var keys = Object.keys;\n  var each = function each(obj, f) {\n    var props = keys(obj);\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n  var objAcc = function objAcc(r) {\n    return function (x, i) {\n      r[i] = x;\n    };\n  };\n  var internalFilter = function internalFilter(obj, pred, onTrue, onFalse) {\n    var r = {};\n    each(obj, function (x, i) {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n    return r;\n  };\n  var filter = function filter(obj, pred) {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n  typeof window !== 'undefined' ? window : Function('return this;')();\n  var name = function name(element) {\n    var r = element.dom.nodeName;\n    return r.toLowerCase();\n  };\n  var type = function type(element) {\n    return element.dom.nodeType;\n  };\n  var isType = function isType(t) {\n    return function (element) {\n      return type(element) === t;\n    };\n  };\n  var isElement = isType(ELEMENT);\n  var isTag = function isTag(tag) {\n    return function (e) {\n      return isElement(e) && name(e) === tag;\n    };\n  };\n  var rawSet = function rawSet(dom, key, value) {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n  var setAll = function setAll(element, attrs) {\n    var dom = element.dom;\n    each(attrs, function (v, k) {\n      rawSet(dom, k, v);\n    });\n  };\n  var clone$1 = function clone$1(element) {\n    return foldl(element.dom.attributes, function (acc, attr) {\n      acc[attr.name] = attr.value;\n      return acc;\n    }, {});\n  };\n  var parent = function parent(element) {\n    return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n  };\n  var children = function children(element) {\n    return map(element.dom.childNodes, SugarElement.fromDom);\n  };\n  var child = function child(element, index) {\n    var cs = element.dom.childNodes;\n    return Optional.from(cs[index]).map(SugarElement.fromDom);\n  };\n  var firstChild = function firstChild(element) {\n    return child(element, 0);\n  };\n  var lastChild = function lastChild(element) {\n    return child(element, element.dom.childNodes.length - 1);\n  };\n  var before$1 = function before$1(marker, element) {\n    var parent$1 = parent(marker);\n    parent$1.each(function (v) {\n      v.dom.insertBefore(element.dom, marker.dom);\n    });\n  };\n  var append$1 = function append$1(parent, element) {\n    parent.dom.appendChild(element.dom);\n  };\n  var before = function before(marker, elements) {\n    each$1(elements, function (x) {\n      before$1(marker, x);\n    });\n  };\n  var append = function append(parent, elements) {\n    each$1(elements, function (x) {\n      append$1(parent, x);\n    });\n  };\n  var remove = function remove(element) {\n    var dom = element.dom;\n    if (dom.parentNode !== null) {\n      dom.parentNode.removeChild(dom);\n    }\n  };\n  var clone = function clone(original, isDeep) {\n    return SugarElement.fromDom(original.dom.cloneNode(isDeep));\n  };\n  var deep = function deep(original) {\n    return clone(original, true);\n  };\n  var shallowAs = function shallowAs(original, tag) {\n    var nu = SugarElement.fromTag(tag);\n    var attributes = clone$1(original);\n    setAll(nu, attributes);\n    return nu;\n  };\n  var mutate = function mutate(original, tag) {\n    var nu = shallowAs(original, tag);\n    before$1(original, nu);\n    var children$1 = children(original);\n    append(nu, children$1);\n    remove(original);\n    return nu;\n  };\n  var global$3 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var matchNodeName = function matchNodeName(name) {\n    return function (node) {\n      return node && node.nodeName.toLowerCase() === name;\n    };\n  };\n  var matchNodeNames = function matchNodeNames(regex) {\n    return function (node) {\n      return node && regex.test(node.nodeName);\n    };\n  };\n  var isTextNode = function isTextNode(node) {\n    return node && node.nodeType === 3;\n  };\n  var isListNode = matchNodeNames(/^(OL|UL|DL)$/);\n  var isOlUlNode = matchNodeNames(/^(OL|UL)$/);\n  var isOlNode = matchNodeName('ol');\n  var isListItemNode = matchNodeNames(/^(LI|DT|DD)$/);\n  var isDlItemNode = matchNodeNames(/^(DT|DD)$/);\n  var isTableCellNode = matchNodeNames(/^(TH|TD)$/);\n  var isBr = matchNodeName('br');\n  var isFirstChild = function isFirstChild(node) {\n    return node.parentNode.firstChild === node;\n  };\n  var isTextBlock = function isTextBlock(editor, node) {\n    return node && !!editor.schema.getTextBlockElements()[node.nodeName];\n  };\n  var isBlock = function isBlock(node, blockElements) {\n    return node && node.nodeName in blockElements;\n  };\n  var isBogusBr = function isBogusBr(dom, node) {\n    if (!isBr(node)) {\n      return false;\n    }\n    return dom.isBlock(node.nextSibling) && !isBr(node.previousSibling);\n  };\n  var isEmpty = function isEmpty(dom, elm, keepBookmarks) {\n    var empty = dom.isEmpty(elm);\n    if (keepBookmarks && dom.select('span[data-mce-type=bookmark]', elm).length > 0) {\n      return false;\n    }\n    return empty;\n  };\n  var isChildOfBody = function isChildOfBody(dom, elm) {\n    return dom.isChildOf(elm, dom.getRoot());\n  };\n  var shouldIndentOnTab = function shouldIndentOnTab(editor) {\n    return editor.getParam('lists_indent_on_tab', true);\n  };\n  var getForcedRootBlock = function getForcedRootBlock(editor) {\n    var block = editor.getParam('forced_root_block', 'p');\n    if (block === false) {\n      return '';\n    } else if (block === true) {\n      return 'p';\n    } else {\n      return block;\n    }\n  };\n  var getForcedRootBlockAttrs = function getForcedRootBlockAttrs(editor) {\n    return editor.getParam('forced_root_block_attrs', {});\n  };\n  var createTextBlock = function createTextBlock(editor, contentNode) {\n    var dom = editor.dom;\n    var blockElements = editor.schema.getBlockElements();\n    var fragment = dom.createFragment();\n    var blockName = getForcedRootBlock(editor);\n    var node, textBlock, hasContentNode;\n    if (blockName) {\n      textBlock = dom.create(blockName);\n      if (textBlock.tagName === blockName.toUpperCase()) {\n        dom.setAttribs(textBlock, getForcedRootBlockAttrs(editor));\n      }\n      if (!isBlock(contentNode.firstChild, blockElements)) {\n        fragment.appendChild(textBlock);\n      }\n    }\n    if (contentNode) {\n      while (node = contentNode.firstChild) {\n        var nodeName = node.nodeName;\n        if (!hasContentNode && (nodeName !== 'SPAN' || node.getAttribute('data-mce-type') !== 'bookmark')) {\n          hasContentNode = true;\n        }\n        if (isBlock(node, blockElements)) {\n          fragment.appendChild(node);\n          textBlock = null;\n        } else {\n          if (blockName) {\n            if (!textBlock) {\n              textBlock = dom.create(blockName);\n              fragment.appendChild(textBlock);\n            }\n            textBlock.appendChild(node);\n          } else {\n            fragment.appendChild(node);\n          }\n        }\n      }\n    }\n    if (!blockName) {\n      fragment.appendChild(dom.create('br'));\n    } else {\n      if (!hasContentNode) {\n        textBlock.appendChild(dom.create('br', {\n          'data-mce-bogus': '1'\n        }));\n      }\n    }\n    return fragment;\n  };\n  var DOM$2 = global$3.DOM;\n  var splitList = function splitList(editor, list, li) {\n    var removeAndKeepBookmarks = function removeAndKeepBookmarks(targetNode) {\n      global$2.each(bookmarks, function (node) {\n        targetNode.parentNode.insertBefore(node, li.parentNode);\n      });\n      DOM$2.remove(targetNode);\n    };\n    var bookmarks = DOM$2.select('span[data-mce-type=\"bookmark\"]', list);\n    var newBlock = createTextBlock(editor, li);\n    var tmpRng = DOM$2.createRng();\n    tmpRng.setStartAfter(li);\n    tmpRng.setEndAfter(list);\n    var fragment = tmpRng.extractContents();\n    for (var node = fragment.firstChild; node; node = node.firstChild) {\n      if (node.nodeName === 'LI' && editor.dom.isEmpty(node)) {\n        DOM$2.remove(node);\n        break;\n      }\n    }\n    if (!editor.dom.isEmpty(fragment)) {\n      DOM$2.insertAfter(fragment, list);\n    }\n    DOM$2.insertAfter(newBlock, list);\n    if (isEmpty(editor.dom, li.parentNode)) {\n      removeAndKeepBookmarks(li.parentNode);\n    }\n    DOM$2.remove(li);\n    if (isEmpty(editor.dom, list)) {\n      DOM$2.remove(list);\n    }\n  };\n  var isDescriptionDetail = isTag('dd');\n  var isDescriptionTerm = isTag('dt');\n  var outdentDlItem = function outdentDlItem(editor, item) {\n    if (isDescriptionDetail(item)) {\n      mutate(item, 'dt');\n    } else if (isDescriptionTerm(item)) {\n      parent(item).each(function (dl) {\n        return splitList(editor, dl.dom, item.dom);\n      });\n    }\n  };\n  var indentDlItem = function indentDlItem(item) {\n    if (isDescriptionTerm(item)) {\n      mutate(item, 'dd');\n    }\n  };\n  var dlIndentation = function dlIndentation(editor, indentation, dlItems) {\n    if (indentation === 'Indent') {\n      each$1(dlItems, indentDlItem);\n    } else {\n      each$1(dlItems, function (item) {\n        return outdentDlItem(editor, item);\n      });\n    }\n  };\n  var getNormalizedPoint = function getNormalizedPoint(container, offset) {\n    if (isTextNode(container)) {\n      return {\n        container: container,\n        offset: offset\n      };\n    }\n    var node = global$6.getNode(container, offset);\n    if (isTextNode(node)) {\n      return {\n        container: node,\n        offset: offset >= container.childNodes.length ? node.data.length : 0\n      };\n    } else if (node.previousSibling && isTextNode(node.previousSibling)) {\n      return {\n        container: node.previousSibling,\n        offset: node.previousSibling.data.length\n      };\n    } else if (node.nextSibling && isTextNode(node.nextSibling)) {\n      return {\n        container: node.nextSibling,\n        offset: 0\n      };\n    }\n    return {\n      container: container,\n      offset: offset\n    };\n  };\n  var normalizeRange = function normalizeRange(rng) {\n    var outRng = rng.cloneRange();\n    var rangeStart = getNormalizedPoint(rng.startContainer, rng.startOffset);\n    outRng.setStart(rangeStart.container, rangeStart.offset);\n    var rangeEnd = getNormalizedPoint(rng.endContainer, rng.endOffset);\n    outRng.setEnd(rangeEnd.container, rangeEnd.offset);\n    return outRng;\n  };\n  var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DomQuery');\n  var getParentList = function getParentList(editor, node) {\n    var selectionStart = node || editor.selection.getStart(true);\n    return editor.dom.getParent(selectionStart, 'OL,UL,DL', getClosestListRootElm(editor, selectionStart));\n  };\n  var isParentListSelected = function isParentListSelected(parentList, selectedBlocks) {\n    return parentList && selectedBlocks.length === 1 && selectedBlocks[0] === parentList;\n  };\n  var findSubLists = function findSubLists(parentList) {\n    return filter$1(parentList.querySelectorAll('ol,ul,dl'), isListNode);\n  };\n  var getSelectedSubLists = function getSelectedSubLists(editor) {\n    var parentList = getParentList(editor);\n    var selectedBlocks = editor.selection.getSelectedBlocks();\n    if (isParentListSelected(parentList, selectedBlocks)) {\n      return findSubLists(parentList);\n    } else {\n      return filter$1(selectedBlocks, function (elm) {\n        return isListNode(elm) && parentList !== elm;\n      });\n    }\n  };\n  var findParentListItemsNodes = function findParentListItemsNodes(editor, elms) {\n    var listItemsElms = global$2.map(elms, function (elm) {\n      var parentLi = editor.dom.getParent(elm, 'li,dd,dt', getClosestListRootElm(editor, elm));\n      return parentLi ? parentLi : elm;\n    });\n    return global$1.unique(listItemsElms);\n  };\n  var getSelectedListItems = function getSelectedListItems(editor) {\n    var selectedBlocks = editor.selection.getSelectedBlocks();\n    return filter$1(findParentListItemsNodes(editor, selectedBlocks), isListItemNode);\n  };\n  var getSelectedDlItems = function getSelectedDlItems(editor) {\n    return filter$1(getSelectedListItems(editor), isDlItemNode);\n  };\n  var getClosestListRootElm = function getClosestListRootElm(editor, elm) {\n    var parentTableCell = editor.dom.getParents(elm, 'TD,TH');\n    return parentTableCell.length > 0 ? parentTableCell[0] : editor.getBody();\n  };\n  var findLastParentListNode = function findLastParentListNode(editor, elm) {\n    var parentLists = editor.dom.getParents(elm, 'ol,ul', getClosestListRootElm(editor, elm));\n    return last(parentLists);\n  };\n  var getSelectedLists = function getSelectedLists(editor) {\n    var firstList = findLastParentListNode(editor, editor.selection.getStart());\n    var subsequentLists = filter$1(editor.selection.getSelectedBlocks(), isOlUlNode);\n    return firstList.toArray().concat(subsequentLists);\n  };\n  var getSelectedListRoots = function getSelectedListRoots(editor) {\n    var selectedLists = getSelectedLists(editor);\n    return getUniqueListRoots(editor, selectedLists);\n  };\n  var getUniqueListRoots = function getUniqueListRoots(editor, lists) {\n    var listRoots = map(lists, function (list) {\n      return findLastParentListNode(editor, list).getOr(list);\n    });\n    return global$1.unique(listRoots);\n  };\n  var is = function is(lhs, rhs, comparator) {\n    if (comparator === void 0) {\n      comparator = tripleEquals;\n    }\n    return lhs.exists(function (left) {\n      return comparator(left, rhs);\n    });\n  };\n  var lift2 = function lift2(oa, ob, f) {\n    return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();\n  };\n  var fromElements = function fromElements(elements, scope) {\n    var doc = scope || document;\n    var fragment = doc.createDocumentFragment();\n    each$1(elements, function (element) {\n      fragment.appendChild(element.dom);\n    });\n    return SugarElement.fromDom(fragment);\n  };\n  var fireListEvent = function fireListEvent(editor, action, element) {\n    return editor.fire('ListMutation', {\n      action: action,\n      element: element\n    });\n  };\n  var isSupported = function isSupported(dom) {\n    return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n  };\n  var internalSet = function internalSet(dom, property, value) {\n    if (!isString(value)) {\n      console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n      throw new Error('CSS value must be a string: ' + value);\n    }\n    if (isSupported(dom)) {\n      dom.style.setProperty(property, value);\n    }\n  };\n  var set = function set(element, property, value) {\n    var dom = element.dom;\n    internalSet(dom, property, value);\n  };\n  var joinSegment = function joinSegment(parent, child) {\n    append$1(parent.item, child.list);\n  };\n  var joinSegments = function joinSegments(segments) {\n    for (var i = 1; i < segments.length; i++) {\n      joinSegment(segments[i - 1], segments[i]);\n    }\n  };\n  var appendSegments = function appendSegments(head$1, tail) {\n    lift2(last(head$1), head(tail), joinSegment);\n  };\n  var createSegment = function createSegment(scope, listType) {\n    var segment = {\n      list: SugarElement.fromTag(listType, scope),\n      item: SugarElement.fromTag('li', scope)\n    };\n    append$1(segment.list, segment.item);\n    return segment;\n  };\n  var createSegments = function createSegments(scope, entry, size) {\n    var segments = [];\n    for (var i = 0; i < size; i++) {\n      segments.push(createSegment(scope, entry.listType));\n    }\n    return segments;\n  };\n  var populateSegments = function populateSegments(segments, entry) {\n    for (var i = 0; i < segments.length - 1; i++) {\n      set(segments[i].item, 'list-style-type', 'none');\n    }\n    last(segments).each(function (segment) {\n      setAll(segment.list, entry.listAttributes);\n      setAll(segment.item, entry.itemAttributes);\n      append(segment.item, entry.content);\n    });\n  };\n  var normalizeSegment = function normalizeSegment(segment, entry) {\n    if (name(segment.list) !== entry.listType) {\n      segment.list = mutate(segment.list, entry.listType);\n    }\n    setAll(segment.list, entry.listAttributes);\n  };\n  var createItem = function createItem(scope, attr, content) {\n    var item = SugarElement.fromTag('li', scope);\n    setAll(item, attr);\n    append(item, content);\n    return item;\n  };\n  var appendItem = function appendItem(segment, item) {\n    append$1(segment.list, item);\n    segment.item = item;\n  };\n  var writeShallow = function writeShallow(scope, cast, entry) {\n    var newCast = cast.slice(0, entry.depth);\n    last(newCast).each(function (segment) {\n      var item = createItem(scope, entry.itemAttributes, entry.content);\n      appendItem(segment, item);\n      normalizeSegment(segment, entry);\n    });\n    return newCast;\n  };\n  var writeDeep = function writeDeep(scope, cast, entry) {\n    var segments = createSegments(scope, entry, entry.depth - cast.length);\n    joinSegments(segments);\n    populateSegments(segments, entry);\n    appendSegments(cast, segments);\n    return cast.concat(segments);\n  };\n  var composeList = function composeList(scope, entries) {\n    var cast = foldl(entries, function (cast, entry) {\n      return entry.depth > cast.length ? writeDeep(scope, cast, entry) : writeShallow(scope, cast, entry);\n    }, []);\n    return head(cast).map(function (segment) {\n      return segment.list;\n    });\n  };\n  var isList = function isList(el) {\n    return is$1(el, 'OL,UL');\n  };\n  var hasFirstChildList = function hasFirstChildList(el) {\n    return firstChild(el).exists(isList);\n  };\n  var hasLastChildList = function hasLastChildList(el) {\n    return lastChild(el).exists(isList);\n  };\n  var isIndented = function isIndented(entry) {\n    return entry.depth > 0;\n  };\n  var isSelected = function isSelected(entry) {\n    return entry.isSelected;\n  };\n  var cloneItemContent = function cloneItemContent(li) {\n    var children$1 = children(li);\n    var content = hasLastChildList(li) ? children$1.slice(0, -1) : children$1;\n    return map(content, deep);\n  };\n  var createEntry = function createEntry(li, depth, isSelected) {\n    return parent(li).filter(isElement).map(function (list) {\n      return {\n        depth: depth,\n        dirty: false,\n        isSelected: isSelected,\n        content: cloneItemContent(li),\n        itemAttributes: clone$1(li),\n        listAttributes: clone$1(list),\n        listType: name(list)\n      };\n    });\n  };\n  var indentEntry = function indentEntry(indentation, entry) {\n    switch (indentation) {\n      case 'Indent':\n        entry.depth++;\n        break;\n      case 'Outdent':\n        entry.depth--;\n        break;\n      case 'Flatten':\n        entry.depth = 0;\n    }\n    entry.dirty = true;\n  };\n  var cloneListProperties = function cloneListProperties(target, source) {\n    target.listType = source.listType;\n    target.listAttributes = _assign({}, source.listAttributes);\n  };\n  var cleanListProperties = function cleanListProperties(entry) {\n    entry.listAttributes = filter(entry.listAttributes, function (_value, key) {\n      return key !== 'start';\n    });\n  };\n  var closestSiblingEntry = function closestSiblingEntry(entries, start) {\n    var depth = entries[start].depth;\n    var matches = function matches(entry) {\n      return entry.depth === depth && !entry.dirty;\n    };\n    var until = function until(entry) {\n      return entry.depth < depth;\n    };\n    return findUntil(reverse(entries.slice(0, start)), matches, until).orThunk(function () {\n      return findUntil(entries.slice(start + 1), matches, until);\n    });\n  };\n  var normalizeEntries = function normalizeEntries(entries) {\n    each$1(entries, function (entry, i) {\n      closestSiblingEntry(entries, i).fold(function () {\n        if (entry.dirty) {\n          cleanListProperties(entry);\n        }\n      }, function (matchingEntry) {\n        return cloneListProperties(entry, matchingEntry);\n      });\n    });\n    return entries;\n  };\n  var Cell = function Cell(initial) {\n    var value = initial;\n    var get = function get() {\n      return value;\n    };\n    var set = function set(v) {\n      value = v;\n    };\n    return {\n      get: get,\n      set: set\n    };\n  };\n  var parseItem = function parseItem(depth, itemSelection, selectionState, item) {\n    return firstChild(item).filter(isList).fold(function () {\n      itemSelection.each(function (selection) {\n        if (eq(selection.start, item)) {\n          selectionState.set(true);\n        }\n      });\n      var currentItemEntry = createEntry(item, depth, selectionState.get());\n      itemSelection.each(function (selection) {\n        if (eq(selection.end, item)) {\n          selectionState.set(false);\n        }\n      });\n      var childListEntries = lastChild(item).filter(isList).map(function (list) {\n        return _parseList(depth, itemSelection, selectionState, list);\n      }).getOr([]);\n      return currentItemEntry.toArray().concat(childListEntries);\n    }, function (list) {\n      return _parseList(depth, itemSelection, selectionState, list);\n    });\n  };\n  var _parseList = function parseList(depth, itemSelection, selectionState, list) {\n    return bind(children(list), function (element) {\n      var parser = isList(element) ? _parseList : parseItem;\n      var newDepth = depth + 1;\n      return parser(newDepth, itemSelection, selectionState, element);\n    });\n  };\n  var parseLists = function parseLists(lists, itemSelection) {\n    var selectionState = Cell(false);\n    var initialDepth = 0;\n    return map(lists, function (list) {\n      return {\n        sourceList: list,\n        entries: _parseList(initialDepth, itemSelection, selectionState, list)\n      };\n    });\n  };\n  var outdentedComposer = function outdentedComposer(editor, entries) {\n    var normalizedEntries = normalizeEntries(entries);\n    return map(normalizedEntries, function (entry) {\n      var content = fromElements(entry.content);\n      return SugarElement.fromDom(createTextBlock(editor, content.dom));\n    });\n  };\n  var indentedComposer = function indentedComposer(editor, entries) {\n    var normalizedEntries = normalizeEntries(entries);\n    return composeList(editor.contentDocument, normalizedEntries).toArray();\n  };\n  var composeEntries = function composeEntries(editor, entries) {\n    return bind(groupBy(entries, isIndented), function (entries) {\n      var groupIsIndented = head(entries).exists(isIndented);\n      return groupIsIndented ? indentedComposer(editor, entries) : outdentedComposer(editor, entries);\n    });\n  };\n  var indentSelectedEntries = function indentSelectedEntries(entries, indentation) {\n    each$1(filter$1(entries, isSelected), function (entry) {\n      return indentEntry(indentation, entry);\n    });\n  };\n  var getItemSelection = function getItemSelection(editor) {\n    var selectedListItems = map(getSelectedListItems(editor), SugarElement.fromDom);\n    return lift2(find$1(selectedListItems, not(hasFirstChildList)), find$1(reverse(selectedListItems), not(hasFirstChildList)), function (start, end) {\n      return {\n        start: start,\n        end: end\n      };\n    });\n  };\n  var listIndentation = function listIndentation(editor, lists, indentation) {\n    var entrySets = parseLists(lists, getItemSelection(editor));\n    each$1(entrySets, function (entrySet) {\n      indentSelectedEntries(entrySet.entries, indentation);\n      var composedLists = composeEntries(editor, entrySet.entries);\n      each$1(composedLists, function (composedList) {\n        fireListEvent(editor, indentation === 'Indent' ? 'IndentList' : 'OutdentList', composedList.dom);\n      });\n      before(entrySet.sourceList, composedLists);\n      remove(entrySet.sourceList);\n    });\n  };\n  var selectionIndentation = function selectionIndentation(editor, indentation) {\n    var lists = map(getSelectedListRoots(editor), SugarElement.fromDom);\n    var dlItems = map(getSelectedDlItems(editor), SugarElement.fromDom);\n    var isHandled = false;\n    if (lists.length || dlItems.length) {\n      var bookmark = editor.selection.getBookmark();\n      listIndentation(editor, lists, indentation);\n      dlIndentation(editor, indentation, dlItems);\n      editor.selection.moveToBookmark(bookmark);\n      editor.selection.setRng(normalizeRange(editor.selection.getRng()));\n      editor.nodeChanged();\n      isHandled = true;\n    }\n    return isHandled;\n  };\n  var indentListSelection = function indentListSelection(editor) {\n    return selectionIndentation(editor, 'Indent');\n  };\n  var outdentListSelection = function outdentListSelection(editor) {\n    return selectionIndentation(editor, 'Outdent');\n  };\n  var flattenListSelection = function flattenListSelection(editor) {\n    return selectionIndentation(editor, 'Flatten');\n  };\n  var global = tinymce.util.Tools.resolve('tinymce.dom.BookmarkManager');\n  var DOM$1 = global$3.DOM;\n  var createBookmark = function createBookmark(rng) {\n    var bookmark = {};\n    var setupEndPoint = function setupEndPoint(start) {\n      var container = rng[start ? 'startContainer' : 'endContainer'];\n      var offset = rng[start ? 'startOffset' : 'endOffset'];\n      if (container.nodeType === 1) {\n        var offsetNode = DOM$1.create('span', {\n          'data-mce-type': 'bookmark'\n        });\n        if (container.hasChildNodes()) {\n          offset = Math.min(offset, container.childNodes.length - 1);\n          if (start) {\n            container.insertBefore(offsetNode, container.childNodes[offset]);\n          } else {\n            DOM$1.insertAfter(offsetNode, container.childNodes[offset]);\n          }\n        } else {\n          container.appendChild(offsetNode);\n        }\n        container = offsetNode;\n        offset = 0;\n      }\n      bookmark[start ? 'startContainer' : 'endContainer'] = container;\n      bookmark[start ? 'startOffset' : 'endOffset'] = offset;\n    };\n    setupEndPoint(true);\n    if (!rng.collapsed) {\n      setupEndPoint();\n    }\n    return bookmark;\n  };\n  var resolveBookmark = function resolveBookmark(bookmark) {\n    var restoreEndPoint = function restoreEndPoint(start) {\n      var node;\n      var nodeIndex = function nodeIndex(container) {\n        var node = container.parentNode.firstChild,\n          idx = 0;\n        while (node) {\n          if (node === container) {\n            return idx;\n          }\n          if (node.nodeType !== 1 || node.getAttribute('data-mce-type') !== 'bookmark') {\n            idx++;\n          }\n          node = node.nextSibling;\n        }\n        return -1;\n      };\n      var container = node = bookmark[start ? 'startContainer' : 'endContainer'];\n      var offset = bookmark[start ? 'startOffset' : 'endOffset'];\n      if (!container) {\n        return;\n      }\n      if (container.nodeType === 1) {\n        offset = nodeIndex(container);\n        container = container.parentNode;\n        DOM$1.remove(node);\n        if (!container.hasChildNodes() && DOM$1.isBlock(container)) {\n          container.appendChild(DOM$1.create('br'));\n        }\n      }\n      bookmark[start ? 'startContainer' : 'endContainer'] = container;\n      bookmark[start ? 'startOffset' : 'endOffset'] = offset;\n    };\n    restoreEndPoint(true);\n    restoreEndPoint();\n    var rng = DOM$1.createRng();\n    rng.setStart(bookmark.startContainer, bookmark.startOffset);\n    if (bookmark.endContainer) {\n      rng.setEnd(bookmark.endContainer, bookmark.endOffset);\n    }\n    return normalizeRange(rng);\n  };\n  var listToggleActionFromListName = function listToggleActionFromListName(listName) {\n    switch (listName) {\n      case 'UL':\n        return 'ToggleUlList';\n      case 'OL':\n        return 'ToggleOlList';\n      case 'DL':\n        return 'ToggleDLList';\n    }\n  };\n  var isCustomList = function isCustomList(list) {\n    return /\\btox\\-/.test(list.className);\n  };\n  var listState = function listState(editor, listName, activate) {\n    var nodeChangeHandler = function nodeChangeHandler(e) {\n      var inList = findUntil(e.parents, isListNode, isTableCellNode).filter(function (list) {\n        return list.nodeName === listName && !isCustomList(list);\n      }).isSome();\n      activate(inList);\n    };\n    var parents = editor.dom.getParents(editor.selection.getNode());\n    nodeChangeHandler({\n      parents: parents\n    });\n    editor.on('NodeChange', nodeChangeHandler);\n    return function () {\n      return editor.off('NodeChange', nodeChangeHandler);\n    };\n  };\n  var updateListStyle = function updateListStyle(dom, el, detail) {\n    var type = detail['list-style-type'] ? detail['list-style-type'] : null;\n    dom.setStyle(el, 'list-style-type', type);\n  };\n  var setAttribs = function setAttribs(elm, attrs) {\n    global$2.each(attrs, function (value, key) {\n      elm.setAttribute(key, value);\n    });\n  };\n  var updateListAttrs = function updateListAttrs(dom, el, detail) {\n    setAttribs(el, detail['list-attributes']);\n    global$2.each(dom.select('li', el), function (li) {\n      setAttribs(li, detail['list-item-attributes']);\n    });\n  };\n  var updateListWithDetails = function updateListWithDetails(dom, el, detail) {\n    updateListStyle(dom, el, detail);\n    updateListAttrs(dom, el, detail);\n  };\n  var removeStyles = function removeStyles(dom, element, styles) {\n    global$2.each(styles, function (style) {\n      var _a;\n      return dom.setStyle(element, (_a = {}, _a[style] = '', _a));\n    });\n  };\n  var getEndPointNode = function getEndPointNode(editor, rng, start, root) {\n    var container = rng[start ? 'startContainer' : 'endContainer'];\n    var offset = rng[start ? 'startOffset' : 'endOffset'];\n    if (container.nodeType === 1) {\n      container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n    }\n    if (!start && isBr(container.nextSibling)) {\n      container = container.nextSibling;\n    }\n    while (container.parentNode !== root) {\n      if (isTextBlock(editor, container)) {\n        return container;\n      }\n      if (/^(TD|TH)$/.test(container.parentNode.nodeName)) {\n        return container;\n      }\n      container = container.parentNode;\n    }\n    return container;\n  };\n  var getSelectedTextBlocks = function getSelectedTextBlocks(editor, rng, root) {\n    var textBlocks = [];\n    var dom = editor.dom;\n    var startNode = getEndPointNode(editor, rng, true, root);\n    var endNode = getEndPointNode(editor, rng, false, root);\n    var block;\n    var siblings = [];\n    for (var node = startNode; node; node = node.nextSibling) {\n      siblings.push(node);\n      if (node === endNode) {\n        break;\n      }\n    }\n    global$2.each(siblings, function (node) {\n      if (isTextBlock(editor, node)) {\n        textBlocks.push(node);\n        block = null;\n        return;\n      }\n      if (dom.isBlock(node) || isBr(node)) {\n        if (isBr(node)) {\n          dom.remove(node);\n        }\n        block = null;\n        return;\n      }\n      var nextSibling = node.nextSibling;\n      if (global.isBookmarkNode(node)) {\n        if (isListNode(nextSibling) || isTextBlock(editor, nextSibling) || !nextSibling && node.parentNode === root) {\n          block = null;\n          return;\n        }\n      }\n      if (!block) {\n        block = dom.create('p');\n        node.parentNode.insertBefore(block, node);\n        textBlocks.push(block);\n      }\n      block.appendChild(node);\n    });\n    return textBlocks;\n  };\n  var hasCompatibleStyle = function hasCompatibleStyle(dom, sib, detail) {\n    var sibStyle = dom.getStyle(sib, 'list-style-type');\n    var detailStyle = detail ? detail['list-style-type'] : '';\n    detailStyle = detailStyle === null ? '' : detailStyle;\n    return sibStyle === detailStyle;\n  };\n  var applyList = function applyList(editor, listName, detail) {\n    var rng = editor.selection.getRng();\n    var listItemName = 'LI';\n    var root = getClosestListRootElm(editor, editor.selection.getStart(true));\n    var dom = editor.dom;\n    if (dom.getContentEditable(editor.selection.getNode()) === 'false') {\n      return;\n    }\n    listName = listName.toUpperCase();\n    if (listName === 'DL') {\n      listItemName = 'DT';\n    }\n    var bookmark = createBookmark(rng);\n    var selectedTextBlocks = getSelectedTextBlocks(editor, rng, root);\n    global$2.each(selectedTextBlocks, function (block) {\n      var listBlock;\n      var sibling = block.previousSibling;\n      var parent = block.parentNode;\n      if (!isListItemNode(parent)) {\n        if (sibling && isListNode(sibling) && sibling.nodeName === listName && hasCompatibleStyle(dom, sibling, detail)) {\n          listBlock = sibling;\n          block = dom.rename(block, listItemName);\n          sibling.appendChild(block);\n        } else {\n          listBlock = dom.create(listName);\n          block.parentNode.insertBefore(listBlock, block);\n          listBlock.appendChild(block);\n          block = dom.rename(block, listItemName);\n        }\n        removeStyles(dom, block, ['margin', 'margin-right', 'margin-bottom', 'margin-left', 'margin-top', 'padding', 'padding-right', 'padding-bottom', 'padding-left', 'padding-top']);\n        updateListWithDetails(dom, listBlock, detail);\n        mergeWithAdjacentLists(editor.dom, listBlock);\n      }\n    });\n    editor.selection.setRng(resolveBookmark(bookmark));\n  };\n  var isValidLists = function isValidLists(list1, list2) {\n    return list1 && list2 && isListNode(list1) && list1.nodeName === list2.nodeName;\n  };\n  var hasSameListStyle = function hasSameListStyle(dom, list1, list2) {\n    var targetStyle = dom.getStyle(list1, 'list-style-type', true);\n    var style = dom.getStyle(list2, 'list-style-type', true);\n    return targetStyle === style;\n  };\n  var hasSameClasses = function hasSameClasses(elm1, elm2) {\n    return elm1.className === elm2.className;\n  };\n  var shouldMerge = function shouldMerge(dom, list1, list2) {\n    return isValidLists(list1, list2) && hasSameListStyle(dom, list1, list2) && hasSameClasses(list1, list2);\n  };\n  var mergeWithAdjacentLists = function mergeWithAdjacentLists(dom, listBlock) {\n    var sibling, node;\n    sibling = listBlock.nextSibling;\n    if (shouldMerge(dom, listBlock, sibling)) {\n      while (node = sibling.firstChild) {\n        listBlock.appendChild(node);\n      }\n      dom.remove(sibling);\n    }\n    sibling = listBlock.previousSibling;\n    if (shouldMerge(dom, listBlock, sibling)) {\n      while (node = sibling.lastChild) {\n        listBlock.insertBefore(node, listBlock.firstChild);\n      }\n      dom.remove(sibling);\n    }\n  };\n  var updateList$1 = function updateList$1(editor, list, listName, detail) {\n    if (list.nodeName !== listName) {\n      var newList = editor.dom.rename(list, listName);\n      updateListWithDetails(editor.dom, newList, detail);\n      fireListEvent(editor, listToggleActionFromListName(listName), newList);\n    } else {\n      updateListWithDetails(editor.dom, list, detail);\n      fireListEvent(editor, listToggleActionFromListName(listName), list);\n    }\n  };\n  var toggleMultipleLists = function toggleMultipleLists(editor, parentList, lists, listName, detail) {\n    var parentIsList = isListNode(parentList);\n    if (parentIsList && parentList.nodeName === listName && !hasListStyleDetail(detail)) {\n      flattenListSelection(editor);\n    } else {\n      applyList(editor, listName, detail);\n      var bookmark = createBookmark(editor.selection.getRng());\n      var allLists = parentIsList ? __spreadArray([parentList], lists, true) : lists;\n      global$2.each(allLists, function (elm) {\n        updateList$1(editor, elm, listName, detail);\n      });\n      editor.selection.setRng(resolveBookmark(bookmark));\n    }\n  };\n  var hasListStyleDetail = function hasListStyleDetail(detail) {\n    return 'list-style-type' in detail;\n  };\n  var toggleSingleList = function toggleSingleList(editor, parentList, listName, detail) {\n    if (parentList === editor.getBody()) {\n      return;\n    }\n    if (parentList) {\n      if (parentList.nodeName === listName && !hasListStyleDetail(detail) && !isCustomList(parentList)) {\n        flattenListSelection(editor);\n      } else {\n        var bookmark = createBookmark(editor.selection.getRng());\n        updateListWithDetails(editor.dom, parentList, detail);\n        var newList = editor.dom.rename(parentList, listName);\n        mergeWithAdjacentLists(editor.dom, newList);\n        editor.selection.setRng(resolveBookmark(bookmark));\n        applyList(editor, listName, detail);\n        fireListEvent(editor, listToggleActionFromListName(listName), newList);\n      }\n    } else {\n      applyList(editor, listName, detail);\n      fireListEvent(editor, listToggleActionFromListName(listName), parentList);\n    }\n  };\n  var toggleList = function toggleList(editor, listName, _detail) {\n    var parentList = getParentList(editor);\n    var selectedSubLists = getSelectedSubLists(editor);\n    var detail = isObject(_detail) ? _detail : {};\n    if (selectedSubLists.length > 0) {\n      toggleMultipleLists(editor, parentList, selectedSubLists, listName, detail);\n    } else {\n      toggleSingleList(editor, parentList, listName, detail);\n    }\n  };\n  var DOM = global$3.DOM;\n  var normalizeList = function normalizeList(dom, list) {\n    var parentNode = list.parentNode;\n    if (parentNode.nodeName === 'LI' && parentNode.firstChild === list) {\n      var sibling = parentNode.previousSibling;\n      if (sibling && sibling.nodeName === 'LI') {\n        sibling.appendChild(list);\n        if (isEmpty(dom, parentNode)) {\n          DOM.remove(parentNode);\n        }\n      } else {\n        DOM.setStyle(parentNode, 'listStyleType', 'none');\n      }\n    }\n    if (isListNode(parentNode)) {\n      var sibling = parentNode.previousSibling;\n      if (sibling && sibling.nodeName === 'LI') {\n        sibling.appendChild(list);\n      }\n    }\n  };\n  var normalizeLists = function normalizeLists(dom, element) {\n    var lists = global$2.grep(dom.select('ol,ul', element));\n    global$2.each(lists, function (list) {\n      normalizeList(dom, list);\n    });\n  };\n  var findNextCaretContainer = function findNextCaretContainer(editor, rng, isForward, root) {\n    var node = rng.startContainer;\n    var offset = rng.startOffset;\n    if (isTextNode(node) && (isForward ? offset < node.data.length : offset > 0)) {\n      return node;\n    }\n    var nonEmptyBlocks = editor.schema.getNonEmptyElements();\n    if (node.nodeType === 1) {\n      node = global$6.getNode(node, offset);\n    }\n    var walker = new global$5(node, root);\n    if (isForward) {\n      if (isBogusBr(editor.dom, node)) {\n        walker.next();\n      }\n    }\n    while (node = walker[isForward ? 'next' : 'prev2']()) {\n      if (node.nodeName === 'LI' && !node.hasChildNodes()) {\n        return node;\n      }\n      if (nonEmptyBlocks[node.nodeName]) {\n        return node;\n      }\n      if (isTextNode(node) && node.data.length > 0) {\n        return node;\n      }\n    }\n  };\n  var hasOnlyOneBlockChild = function hasOnlyOneBlockChild(dom, elm) {\n    var childNodes = elm.childNodes;\n    return childNodes.length === 1 && !isListNode(childNodes[0]) && dom.isBlock(childNodes[0]);\n  };\n  var unwrapSingleBlockChild = function unwrapSingleBlockChild(dom, elm) {\n    if (hasOnlyOneBlockChild(dom, elm)) {\n      dom.remove(elm.firstChild, true);\n    }\n  };\n  var moveChildren = function moveChildren(dom, fromElm, toElm) {\n    var node;\n    var targetElm = hasOnlyOneBlockChild(dom, toElm) ? toElm.firstChild : toElm;\n    unwrapSingleBlockChild(dom, fromElm);\n    if (!isEmpty(dom, fromElm, true)) {\n      while (node = fromElm.firstChild) {\n        targetElm.appendChild(node);\n      }\n    }\n  };\n  var mergeLiElements = function mergeLiElements(dom, fromElm, toElm) {\n    var listNode;\n    var ul = fromElm.parentNode;\n    if (!isChildOfBody(dom, fromElm) || !isChildOfBody(dom, toElm)) {\n      return;\n    }\n    if (isListNode(toElm.lastChild)) {\n      listNode = toElm.lastChild;\n    }\n    if (ul === toElm.lastChild) {\n      if (isBr(ul.previousSibling)) {\n        dom.remove(ul.previousSibling);\n      }\n    }\n    var node = toElm.lastChild;\n    if (node && isBr(node) && fromElm.hasChildNodes()) {\n      dom.remove(node);\n    }\n    if (isEmpty(dom, toElm, true)) {\n      dom.$(toElm).empty();\n    }\n    moveChildren(dom, fromElm, toElm);\n    if (listNode) {\n      toElm.appendChild(listNode);\n    }\n    var contains$1 = contains(SugarElement.fromDom(toElm), SugarElement.fromDom(fromElm));\n    var nestedLists = contains$1 ? dom.getParents(fromElm, isListNode, toElm) : [];\n    dom.remove(fromElm);\n    each$1(nestedLists, function (list) {\n      if (isEmpty(dom, list) && list !== dom.getRoot()) {\n        dom.remove(list);\n      }\n    });\n  };\n  var mergeIntoEmptyLi = function mergeIntoEmptyLi(editor, fromLi, toLi) {\n    editor.dom.$(toLi).empty();\n    mergeLiElements(editor.dom, fromLi, toLi);\n    editor.selection.setCursorLocation(toLi, 0);\n  };\n  var mergeForward = function mergeForward(editor, rng, fromLi, toLi) {\n    var dom = editor.dom;\n    if (dom.isEmpty(toLi)) {\n      mergeIntoEmptyLi(editor, fromLi, toLi);\n    } else {\n      var bookmark = createBookmark(rng);\n      mergeLiElements(dom, fromLi, toLi);\n      editor.selection.setRng(resolveBookmark(bookmark));\n    }\n  };\n  var mergeBackward = function mergeBackward(editor, rng, fromLi, toLi) {\n    var bookmark = createBookmark(rng);\n    mergeLiElements(editor.dom, fromLi, toLi);\n    var resolvedBookmark = resolveBookmark(bookmark);\n    editor.selection.setRng(resolvedBookmark);\n  };\n  var backspaceDeleteFromListToListCaret = function backspaceDeleteFromListToListCaret(editor, isForward) {\n    var dom = editor.dom,\n      selection = editor.selection;\n    var selectionStartElm = selection.getStart();\n    var root = getClosestListRootElm(editor, selectionStartElm);\n    var li = dom.getParent(selection.getStart(), 'LI', root);\n    if (li) {\n      var ul = li.parentNode;\n      if (ul === editor.getBody() && isEmpty(dom, ul)) {\n        return true;\n      }\n      var rng_1 = normalizeRange(selection.getRng());\n      var otherLi_1 = dom.getParent(findNextCaretContainer(editor, rng_1, isForward, root), 'LI', root);\n      if (otherLi_1 && otherLi_1 !== li) {\n        editor.undoManager.transact(function () {\n          if (isForward) {\n            mergeForward(editor, rng_1, otherLi_1, li);\n          } else {\n            if (isFirstChild(li)) {\n              outdentListSelection(editor);\n            } else {\n              mergeBackward(editor, rng_1, li, otherLi_1);\n            }\n          }\n        });\n        return true;\n      } else if (!otherLi_1) {\n        if (!isForward && rng_1.startOffset === 0 && rng_1.endOffset === 0) {\n          editor.undoManager.transact(function () {\n            flattenListSelection(editor);\n          });\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n  var removeBlock = function removeBlock(dom, block, root) {\n    var parentBlock = dom.getParent(block.parentNode, dom.isBlock, root);\n    dom.remove(block);\n    if (parentBlock && dom.isEmpty(parentBlock)) {\n      dom.remove(parentBlock);\n    }\n  };\n  var backspaceDeleteIntoListCaret = function backspaceDeleteIntoListCaret(editor, isForward) {\n    var dom = editor.dom;\n    var selectionStartElm = editor.selection.getStart();\n    var root = getClosestListRootElm(editor, selectionStartElm);\n    var block = dom.getParent(selectionStartElm, dom.isBlock, root);\n    if (block && dom.isEmpty(block)) {\n      var rng = normalizeRange(editor.selection.getRng());\n      var otherLi_2 = dom.getParent(findNextCaretContainer(editor, rng, isForward, root), 'LI', root);\n      if (otherLi_2) {\n        editor.undoManager.transact(function () {\n          removeBlock(dom, block, root);\n          mergeWithAdjacentLists(dom, otherLi_2.parentNode);\n          editor.selection.select(otherLi_2, true);\n          editor.selection.collapse(isForward);\n        });\n        return true;\n      }\n    }\n    return false;\n  };\n  var backspaceDeleteCaret = function backspaceDeleteCaret(editor, isForward) {\n    return backspaceDeleteFromListToListCaret(editor, isForward) || backspaceDeleteIntoListCaret(editor, isForward);\n  };\n  var backspaceDeleteRange = function backspaceDeleteRange(editor) {\n    var selectionStartElm = editor.selection.getStart();\n    var root = getClosestListRootElm(editor, selectionStartElm);\n    var startListParent = editor.dom.getParent(selectionStartElm, 'LI,DT,DD', root);\n    if (startListParent || getSelectedListItems(editor).length > 0) {\n      editor.undoManager.transact(function () {\n        editor.execCommand('Delete');\n        normalizeLists(editor.dom, editor.getBody());\n      });\n      return true;\n    }\n    return false;\n  };\n  var _backspaceDelete = function backspaceDelete(editor, isForward) {\n    return editor.selection.isCollapsed() ? backspaceDeleteCaret(editor, isForward) : backspaceDeleteRange(editor);\n  };\n  var setup$1 = function setup$1(editor) {\n    editor.on('keydown', function (e) {\n      if (e.keyCode === global$4.BACKSPACE) {\n        if (_backspaceDelete(editor, false)) {\n          e.preventDefault();\n        }\n      } else if (e.keyCode === global$4.DELETE) {\n        if (_backspaceDelete(editor, true)) {\n          e.preventDefault();\n        }\n      }\n    });\n  };\n  var get = function get(editor) {\n    return {\n      backspaceDelete: function backspaceDelete(isForward) {\n        _backspaceDelete(editor, isForward);\n      }\n    };\n  };\n  var updateList = function updateList(editor, update) {\n    var parentList = getParentList(editor);\n    editor.undoManager.transact(function () {\n      if (isObject(update.styles)) {\n        editor.dom.setStyles(parentList, update.styles);\n      }\n      if (isObject(update.attrs)) {\n        each(update.attrs, function (v, k) {\n          return editor.dom.setAttrib(parentList, k, v);\n        });\n      }\n    });\n  };\n  var parseAlphabeticBase26 = function parseAlphabeticBase26(str) {\n    var chars = reverse(trim(str).split(''));\n    var values = map(chars, function (char, i) {\n      var charValue = char.toUpperCase().charCodeAt(0) - 'A'.charCodeAt(0) + 1;\n      return Math.pow(26, i) * charValue;\n    });\n    return foldl(values, function (sum, v) {\n      return sum + v;\n    }, 0);\n  };\n  var _composeAlphabeticBase = function composeAlphabeticBase26(value) {\n    value--;\n    if (value < 0) {\n      return '';\n    } else {\n      var remainder = value % 26;\n      var quotient = Math.floor(value / 26);\n      var rest = _composeAlphabeticBase(quotient);\n      var char = String.fromCharCode('A'.charCodeAt(0) + remainder);\n      return rest + char;\n    }\n  };\n  var isUppercase = function isUppercase(str) {\n    return /^[A-Z]+$/.test(str);\n  };\n  var isLowercase = function isLowercase(str) {\n    return /^[a-z]+$/.test(str);\n  };\n  var isNumeric = function isNumeric(str) {\n    return /^[0-9]+$/.test(str);\n  };\n  var deduceListType = function deduceListType(start) {\n    if (isNumeric(start)) {\n      return 2;\n    } else if (isUppercase(start)) {\n      return 0;\n    } else if (isLowercase(start)) {\n      return 1;\n    } else if (isEmpty$1(start)) {\n      return 3;\n    } else {\n      return 4;\n    }\n  };\n  var parseStartValue = function parseStartValue(start) {\n    switch (deduceListType(start)) {\n      case 2:\n        return Optional.some({\n          listStyleType: Optional.none(),\n          start: start\n        });\n      case 0:\n        return Optional.some({\n          listStyleType: Optional.some('upper-alpha'),\n          start: parseAlphabeticBase26(start).toString()\n        });\n      case 1:\n        return Optional.some({\n          listStyleType: Optional.some('lower-alpha'),\n          start: parseAlphabeticBase26(start).toString()\n        });\n      case 3:\n        return Optional.some({\n          listStyleType: Optional.none(),\n          start: ''\n        });\n      case 4:\n        return Optional.none();\n    }\n  };\n  var parseDetail = function parseDetail(detail) {\n    var start = parseInt(detail.start, 10);\n    if (is(detail.listStyleType, 'upper-alpha')) {\n      return _composeAlphabeticBase(start);\n    } else if (is(detail.listStyleType, 'lower-alpha')) {\n      return _composeAlphabeticBase(start).toLowerCase();\n    } else {\n      return detail.start;\n    }\n  };\n  var open = function open(editor) {\n    var currentList = getParentList(editor);\n    if (!isOlNode(currentList)) {\n      return;\n    }\n    editor.windowManager.open({\n      title: 'List Properties',\n      body: {\n        type: 'panel',\n        items: [{\n          type: 'input',\n          name: 'start',\n          label: 'Start list at number',\n          inputMode: 'numeric'\n        }]\n      },\n      initialData: {\n        start: parseDetail({\n          start: editor.dom.getAttrib(currentList, 'start', '1'),\n          listStyleType: Optional.some(editor.dom.getStyle(currentList, 'list-style-type'))\n        })\n      },\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      onSubmit: function onSubmit(api) {\n        var data = api.getData();\n        parseStartValue(data.start).each(function (detail) {\n          editor.execCommand('mceListUpdate', false, {\n            attrs: {\n              start: detail.start === '1' ? '' : detail.start\n            },\n            styles: {\n              'list-style-type': detail.listStyleType.getOr('')\n            }\n          });\n        });\n        api.close();\n      }\n    });\n  };\n  var queryListCommandState = function queryListCommandState(editor, listName) {\n    return function () {\n      var parentList = getParentList(editor);\n      return parentList && parentList.nodeName === listName;\n    };\n  };\n  var registerDialog = function registerDialog(editor) {\n    editor.addCommand('mceListProps', function () {\n      open(editor);\n    });\n  };\n  var register$2 = function register$2(editor) {\n    editor.on('BeforeExecCommand', function (e) {\n      var cmd = e.command.toLowerCase();\n      if (cmd === 'indent') {\n        indentListSelection(editor);\n      } else if (cmd === 'outdent') {\n        outdentListSelection(editor);\n      }\n    });\n    editor.addCommand('InsertUnorderedList', function (ui, detail) {\n      toggleList(editor, 'UL', detail);\n    });\n    editor.addCommand('InsertOrderedList', function (ui, detail) {\n      toggleList(editor, 'OL', detail);\n    });\n    editor.addCommand('InsertDefinitionList', function (ui, detail) {\n      toggleList(editor, 'DL', detail);\n    });\n    editor.addCommand('RemoveList', function () {\n      flattenListSelection(editor);\n    });\n    registerDialog(editor);\n    editor.addCommand('mceListUpdate', function (ui, detail) {\n      if (isObject(detail)) {\n        updateList(editor, detail);\n      }\n    });\n    editor.addQueryStateHandler('InsertUnorderedList', queryListCommandState(editor, 'UL'));\n    editor.addQueryStateHandler('InsertOrderedList', queryListCommandState(editor, 'OL'));\n    editor.addQueryStateHandler('InsertDefinitionList', queryListCommandState(editor, 'DL'));\n  };\n  var setupTabKey = function setupTabKey(editor) {\n    editor.on('keydown', function (e) {\n      if (e.keyCode !== global$4.TAB || global$4.metaKeyPressed(e)) {\n        return;\n      }\n      editor.undoManager.transact(function () {\n        if (e.shiftKey ? outdentListSelection(editor) : indentListSelection(editor)) {\n          e.preventDefault();\n        }\n      });\n    });\n  };\n  var setup = function setup(editor) {\n    if (shouldIndentOnTab(editor)) {\n      setupTabKey(editor);\n    }\n    setup$1(editor);\n  };\n  var register$1 = function register$1(editor) {\n    var exec = function exec(command) {\n      return function () {\n        return editor.execCommand(command);\n      };\n    };\n    if (!editor.hasPlugin('advlist')) {\n      editor.ui.registry.addToggleButton('numlist', {\n        icon: 'ordered-list',\n        active: false,\n        tooltip: 'Numbered list',\n        onAction: exec('InsertOrderedList'),\n        onSetup: function onSetup(api) {\n          return listState(editor, 'OL', api.setActive);\n        }\n      });\n      editor.ui.registry.addToggleButton('bullist', {\n        icon: 'unordered-list',\n        active: false,\n        tooltip: 'Bullet list',\n        onAction: exec('InsertUnorderedList'),\n        onSetup: function onSetup(api) {\n          return listState(editor, 'UL', api.setActive);\n        }\n      });\n    }\n  };\n  var register = function register(editor) {\n    var listProperties = {\n      text: 'List properties...',\n      icon: 'ordered-list',\n      onAction: function onAction() {\n        return editor.execCommand('mceListProps');\n      },\n      onSetup: function onSetup(api) {\n        return listState(editor, 'OL', function (active) {\n          return api.setDisabled(!active);\n        });\n      }\n    };\n    editor.ui.registry.addMenuItem('listprops', listProperties);\n    editor.ui.registry.addContextMenu('lists', {\n      update: function update(node) {\n        var parentList = getParentList(editor, node);\n        return isOlNode(parentList) ? ['listprops'] : [];\n      }\n    });\n  };\n  function Plugin() {\n    global$7.add('lists', function (editor) {\n      if (editor.hasPlugin('rtc', true) === false) {\n        setup(editor);\n        register$2(editor);\n      } else {\n        registerDialog(editor);\n      }\n      register$1(editor);\n      register(editor);\n      return get(editor);\n    });\n  }\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/lists/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/paste/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/paste/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"paste\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/paste')\n//   ES2015:\n//     import 'tinymce/plugins/paste'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/paste/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/paste/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/paste/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/paste/plugin.js ***!
  \******************************************************/
/***/ (() => {

eval("/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.9 (2023-11-15)\n */\n(function () {\n  'use strict';\n\n  var Cell = function Cell(initial) {\n    var value = initial;\n    var get = function get() {\n      return value;\n    };\n    var set = function set(v) {\n      value = v;\n    };\n    return {\n      get: get,\n      set: set\n    };\n  };\n  var global$b = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var hasProPlugin = function hasProPlugin(editor) {\n    if (editor.hasPlugin('powerpaste', true)) {\n      if (typeof window.console !== 'undefined' && window.console.log) {\n        window.console.log('PowerPaste is incompatible with Paste plugin! Remove \\'paste\\' from the \\'plugins\\' option.');\n      }\n      return true;\n    } else {\n      return false;\n    }\n  };\n  var get = function get(clipboard) {\n    return {\n      clipboard: clipboard\n    };\n  };\n  var typeOf = function typeOf(x) {\n    var t = typeof x;\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n  var isType = function isType(type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n  var isSimpleType = function isSimpleType(type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n  var isArray = isType('array');\n  var isNullable = function isNullable(a) {\n    return a === null || a === undefined;\n  };\n  var isNonNullable = function isNonNullable(a) {\n    return !isNullable(a);\n  };\n  var isFunction = isSimpleType('function');\n  var noop = function noop() {};\n  var constant = function constant(value) {\n    return function () {\n      return value;\n    };\n  };\n  var identity = function identity(x) {\n    return x;\n  };\n  var never = constant(false);\n  var always = constant(true);\n  var none = function none() {\n    return NONE;\n  };\n  var NONE = function () {\n    var call = function call(thunk) {\n      return thunk();\n    };\n    var id = identity;\n    var me = {\n      fold: function fold(n, _s) {\n        return n();\n      },\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function getOrDie(msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: function filter() {\n        return none();\n      },\n      toArray: function toArray() {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n  var _some = function some(a) {\n    var constant_a = constant(a);\n    var self = function self() {\n      return me;\n    };\n    var bind = function bind(f) {\n      return f(a);\n    };\n    var me = {\n      fold: function fold(n, s) {\n        return s(a);\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function map(f) {\n        return _some(f(a));\n      },\n      each: function each(f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function filter(f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function toArray() {\n        return [a];\n      },\n      toString: function toString() {\n        return 'some(' + a + ')';\n      }\n    };\n    return me;\n  };\n  var from$1 = function from$1(value) {\n    return value === null || value === undefined ? NONE : _some(value);\n  };\n  var Optional = {\n    some: _some,\n    none: none,\n    from: from$1\n  };\n  var nativeSlice = Array.prototype.slice;\n  var nativePush = Array.prototype.push;\n  var exists = function exists(xs, pred) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return true;\n      }\n    }\n    return false;\n  };\n  var map = function map(xs, f) {\n    var len = xs.length;\n    var r = new Array(len);\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n    return r;\n  };\n  var each = function each(xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n  var filter$1 = function filter$1(xs, pred) {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        r.push(x);\n      }\n    }\n    return r;\n  };\n  var foldl = function foldl(xs, f, acc) {\n    each(xs, function (x, i) {\n      acc = f(acc, x, i);\n    });\n    return acc;\n  };\n  var flatten = function flatten(xs) {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n      nativePush.apply(r, xs[i]);\n    }\n    return r;\n  };\n  var bind = function bind(xs, f) {\n    return flatten(map(xs, f));\n  };\n  var from = isFunction(Array.from) ? Array.from : function (x) {\n    return nativeSlice.call(x);\n  };\n  var _assign = function __assign() {\n    _assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n    };\n    return _assign.apply(this, arguments);\n  };\n  var singleton = function singleton(doRevoke) {\n    var subject = Cell(Optional.none());\n    var revoke = function revoke() {\n      return subject.get().each(doRevoke);\n    };\n    var clear = function clear() {\n      revoke();\n      subject.set(Optional.none());\n    };\n    var isSet = function isSet() {\n      return subject.get().isSome();\n    };\n    var get = function get() {\n      return subject.get();\n    };\n    var set = function set(s) {\n      revoke();\n      subject.set(Optional.some(s));\n    };\n    return {\n      clear: clear,\n      isSet: isSet,\n      get: get,\n      set: set\n    };\n  };\n  var value = function value() {\n    var subject = singleton(noop);\n    var on = function on(f) {\n      return subject.get().each(f);\n    };\n    return _assign(_assign({}, subject), {\n      on: on\n    });\n  };\n  var checkRange = function checkRange(str, substr, start) {\n    return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n  };\n  var startsWith = function startsWith(str, prefix) {\n    return checkRange(str, prefix, 0);\n  };\n  var endsWith = function endsWith(str, suffix) {\n    return checkRange(str, suffix, str.length - suffix.length);\n  };\n  var repeat = function repeat(s, count) {\n    return count <= 0 ? '' : new Array(count + 1).join(s);\n  };\n  var global$a = tinymce.util.Tools.resolve('tinymce.Env');\n  var global$9 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n  var global$8 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n  var global$7 = tinymce.util.Tools.resolve('tinymce.util.VK');\n  var firePastePreProcess = function firePastePreProcess(editor, html, internal, isWordHtml) {\n    return editor.fire('PastePreProcess', {\n      content: html,\n      internal: internal,\n      wordContent: isWordHtml\n    });\n  };\n  var firePastePostProcess = function firePastePostProcess(editor, node, internal, isWordHtml) {\n    return editor.fire('PastePostProcess', {\n      node: node,\n      internal: internal,\n      wordContent: isWordHtml\n    });\n  };\n  var firePastePlainTextToggle = function firePastePlainTextToggle(editor, state) {\n    return editor.fire('PastePlainTextToggle', {\n      state: state\n    });\n  };\n  var firePaste = function firePaste(editor, ieFake) {\n    return editor.fire('paste', {\n      ieFake: ieFake\n    });\n  };\n  var global$6 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var shouldBlockDrop = function shouldBlockDrop(editor) {\n    return editor.getParam('paste_block_drop', false);\n  };\n  var shouldPasteDataImages = function shouldPasteDataImages(editor) {\n    return editor.getParam('paste_data_images', false);\n  };\n  var shouldFilterDrop = function shouldFilterDrop(editor) {\n    return editor.getParam('paste_filter_drop', true);\n  };\n  var getPreProcess = function getPreProcess(editor) {\n    return editor.getParam('paste_preprocess');\n  };\n  var getPostProcess = function getPostProcess(editor) {\n    return editor.getParam('paste_postprocess');\n  };\n  var getWebkitStyles = function getWebkitStyles(editor) {\n    return editor.getParam('paste_webkit_styles');\n  };\n  var shouldRemoveWebKitStyles = function shouldRemoveWebKitStyles(editor) {\n    return editor.getParam('paste_remove_styles_if_webkit', true);\n  };\n  var shouldMergeFormats = function shouldMergeFormats(editor) {\n    return editor.getParam('paste_merge_formats', true);\n  };\n  var isSmartPasteEnabled = function isSmartPasteEnabled(editor) {\n    return editor.getParam('smart_paste', true);\n  };\n  var isPasteAsTextEnabled = function isPasteAsTextEnabled(editor) {\n    return editor.getParam('paste_as_text', false);\n  };\n  var getRetainStyleProps = function getRetainStyleProps(editor) {\n    return editor.getParam('paste_retain_style_properties');\n  };\n  var getWordValidElements = function getWordValidElements(editor) {\n    var defaultValidElements = '-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,' + '-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,' + 'td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody';\n    return editor.getParam('paste_word_valid_elements', defaultValidElements);\n  };\n  var shouldConvertWordFakeLists = function shouldConvertWordFakeLists(editor) {\n    return editor.getParam('paste_convert_word_fake_lists', true);\n  };\n  var shouldUseDefaultFilters = function shouldUseDefaultFilters(editor) {\n    return editor.getParam('paste_enable_default_filters', true);\n  };\n  var getValidate = function getValidate(editor) {\n    return editor.getParam('validate');\n  };\n  var getAllowHtmlDataUrls = function getAllowHtmlDataUrls(editor) {\n    return editor.getParam('allow_html_data_urls', false, 'boolean');\n  };\n  var getPasteDataImages = function getPasteDataImages(editor) {\n    return editor.getParam('paste_data_images', false, 'boolean');\n  };\n  var getImagesDataImgFilter = function getImagesDataImgFilter(editor) {\n    return editor.getParam('images_dataimg_filter');\n  };\n  var getImagesReuseFilename = function getImagesReuseFilename(editor) {\n    return editor.getParam('images_reuse_filename');\n  };\n  var getForcedRootBlock = function getForcedRootBlock(editor) {\n    return editor.getParam('forced_root_block');\n  };\n  var getForcedRootBlockAttrs = function getForcedRootBlockAttrs(editor) {\n    return editor.getParam('forced_root_block_attrs');\n  };\n  var getTabSpaces = function getTabSpaces(editor) {\n    return editor.getParam('paste_tab_spaces', 4, 'number');\n  };\n  var getAllowedImageFileTypes = function getAllowedImageFileTypes(editor) {\n    var defaultImageFileTypes = 'jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp';\n    return global$6.explode(editor.getParam('images_file_types', defaultImageFileTypes, 'string'));\n  };\n  var internalMimeType = 'x-tinymce/html';\n  var internalMark = '<!-- ' + internalMimeType + ' -->';\n  var mark = function mark(html) {\n    return internalMark + html;\n  };\n  var unmark = function unmark(html) {\n    return html.replace(internalMark, '');\n  };\n  var isMarked = function isMarked(html) {\n    return html.indexOf(internalMark) !== -1;\n  };\n  var internalHtmlMime = constant(internalMimeType);\n  var hasOwnProperty = Object.hasOwnProperty;\n  var has = function has(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n  var global$5 = tinymce.util.Tools.resolve('tinymce.html.Entities');\n  var isPlainText = function isPlainText(text) {\n    return !/<(?:\\/?(?!(?:div|p|br|span)>)\\w+|(?:(?!(?:span style=\"white-space:\\s?pre;?\">)|br\\s?\\/>))\\w+\\s[^>]+)>/i.test(text);\n  };\n  var toBRs = function toBRs(text) {\n    return text.replace(/\\r?\\n/g, '<br>');\n  };\n  var openContainer = function openContainer(rootTag, rootAttrs) {\n    var attrs = [];\n    var tag = '<' + rootTag;\n    if (typeof rootAttrs === 'object') {\n      for (var key in rootAttrs) {\n        if (has(rootAttrs, key)) {\n          attrs.push(key + '=\"' + global$5.encodeAllRaw(rootAttrs[key]) + '\"');\n        }\n      }\n      if (attrs.length) {\n        tag += ' ' + attrs.join(' ');\n      }\n    }\n    return tag + '>';\n  };\n  var toBlockElements = function toBlockElements(text, rootTag, rootAttrs) {\n    var blocks = text.split(/\\n\\n/);\n    var tagOpen = openContainer(rootTag, rootAttrs);\n    var tagClose = '</' + rootTag + '>';\n    var paragraphs = global$6.map(blocks, function (p) {\n      return p.split(/\\n/).join('<br />');\n    });\n    var stitch = function stitch(p) {\n      return tagOpen + p + tagClose;\n    };\n    return paragraphs.length === 1 ? paragraphs[0] : global$6.map(paragraphs, stitch).join('');\n  };\n  var convert = function convert(text, rootTag, rootAttrs) {\n    return rootTag ? toBlockElements(text, rootTag === true ? 'p' : rootTag, rootAttrs) : toBRs(text);\n  };\n  var global$4 = tinymce.util.Tools.resolve('tinymce.html.DomParser');\n  var global$3 = tinymce.util.Tools.resolve('tinymce.html.Serializer');\n  var nbsp = '\\xA0';\n  var global$2 = tinymce.util.Tools.resolve('tinymce.html.Node');\n  var global$1 = tinymce.util.Tools.resolve('tinymce.html.Schema');\n  var isRegExp = function isRegExp(val) {\n    return val.constructor === RegExp;\n  };\n  var filter = function filter(content, items) {\n    global$6.each(items, function (v) {\n      if (isRegExp(v)) {\n        content = content.replace(v, '');\n      } else {\n        content = content.replace(v[0], v[1]);\n      }\n    });\n    return content;\n  };\n  var innerText = function innerText(html) {\n    var schema = global$1();\n    var domParser = global$4({}, schema);\n    var text = '';\n    var shortEndedElements = schema.getShortEndedElements();\n    var ignoreElements = global$6.makeMap('script noscript style textarea video audio iframe object', ' ');\n    var blockElements = schema.getBlockElements();\n    var _walk = function walk(node) {\n      var name = node.name,\n        currentNode = node;\n      if (name === 'br') {\n        text += '\\n';\n        return;\n      }\n      if (name === 'wbr') {\n        return;\n      }\n      if (shortEndedElements[name]) {\n        text += ' ';\n      }\n      if (ignoreElements[name]) {\n        text += ' ';\n        return;\n      }\n      if (node.type === 3) {\n        text += node.value;\n      }\n      if (!node.shortEnded) {\n        if (node = node.firstChild) {\n          do {\n            _walk(node);\n          } while (node = node.next);\n        }\n      }\n      if (blockElements[name] && currentNode.next) {\n        text += '\\n';\n        if (name === 'p') {\n          text += '\\n';\n        }\n      }\n    };\n    html = filter(html, [/<!\\[[^\\]]+\\]>/g]);\n    _walk(domParser.parse(html));\n    return text;\n  };\n  var trimHtml = function trimHtml(html) {\n    var trimSpaces = function trimSpaces(all, s1, s2) {\n      if (!s1 && !s2) {\n        return ' ';\n      }\n      return nbsp;\n    };\n    html = filter(html, [/^[\\s\\S]*<body[^>]*>\\s*|\\s*<\\/body[^>]*>[\\s\\S]*$/ig, /<!--StartFragment-->|<!--EndFragment-->/g, [/( ?)<span class=\"Apple-converted-space\">\\u00a0<\\/span>( ?)/g, trimSpaces], /<br class=\"Apple-interchange-newline\">/g, /<br>$/i]);\n    return html;\n  };\n  var createIdGenerator = function createIdGenerator(prefix) {\n    var count = 0;\n    return function () {\n      return prefix + count++;\n    };\n  };\n  var getImageMimeType = function getImageMimeType(ext) {\n    var lowerExt = ext.toLowerCase();\n    var mimeOverrides = {\n      jpg: 'jpeg',\n      jpe: 'jpeg',\n      jfi: 'jpeg',\n      jif: 'jpeg',\n      jfif: 'jpeg',\n      pjpeg: 'jpeg',\n      pjp: 'jpeg',\n      svg: 'svg+xml'\n    };\n    return global$6.hasOwn(mimeOverrides, lowerExt) ? 'image/' + mimeOverrides[lowerExt] : 'image/' + lowerExt;\n  };\n  var isWordContent = function isWordContent(content) {\n    return /<font face=\"Times New Roman\"|class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^']*\\bmso-|w:WordDocument/i.test(content) || /class=\"OutlineElement/.test(content) || /id=\"?docs\\-internal\\-guid\\-/.test(content);\n  };\n  var isNumericList = function isNumericList(text) {\n    var found = false;\n    var patterns = [/^[IVXLMCD]+\\.[ \\u00a0]/, /^[ivxlmcd]+\\.[ \\u00a0]/, /^[a-z]{1,2}[\\.\\)][ \\u00a0]/, /^[A-Z]{1,2}[\\.\\)][ \\u00a0]/, /^[0-9]+\\.[ \\u00a0]/, /^[\\u3007\\u4e00\\u4e8c\\u4e09\\u56db\\u4e94\\u516d\\u4e03\\u516b\\u4e5d]+\\.[ \\u00a0]/, /^[\\u58f1\\u5f10\\u53c2\\u56db\\u4f0d\\u516d\\u4e03\\u516b\\u4e5d\\u62fe]+\\.[ \\u00a0]/];\n    text = text.replace(/^[\\u00a0 ]+/, '');\n    global$6.each(patterns, function (pattern) {\n      if (pattern.test(text)) {\n        found = true;\n        return false;\n      }\n    });\n    return found;\n  };\n  var isBulletList = function isBulletList(text) {\n    return /^[\\s\\u00a0]*[\\u2022\\u00b7\\u00a7\\u25CF]\\s*/.test(text);\n  };\n  var convertFakeListsToProperLists = function convertFakeListsToProperLists(node) {\n    var currentListNode,\n      prevListNode,\n      lastLevel = 1;\n    var _getText = function getText(node) {\n      var txt = '';\n      if (node.type === 3) {\n        return node.value;\n      }\n      if (node = node.firstChild) {\n        do {\n          txt += _getText(node);\n        } while (node = node.next);\n      }\n      return txt;\n    };\n    var _trimListStart = function trimListStart(node, regExp) {\n      if (node.type === 3) {\n        if (regExp.test(node.value)) {\n          node.value = node.value.replace(regExp, '');\n          return false;\n        }\n      }\n      if (node = node.firstChild) {\n        do {\n          if (!_trimListStart(node, regExp)) {\n            return false;\n          }\n        } while (node = node.next);\n      }\n      return true;\n    };\n    var _removeIgnoredNodes = function removeIgnoredNodes(node) {\n      if (node._listIgnore) {\n        node.remove();\n        return;\n      }\n      if (node = node.firstChild) {\n        do {\n          _removeIgnoredNodes(node);\n        } while (node = node.next);\n      }\n    };\n    var convertParagraphToLi = function convertParagraphToLi(paragraphNode, listName, start) {\n      var level = paragraphNode._listLevel || lastLevel;\n      if (level !== lastLevel) {\n        if (level < lastLevel) {\n          if (currentListNode) {\n            currentListNode = currentListNode.parent.parent;\n          }\n        } else {\n          prevListNode = currentListNode;\n          currentListNode = null;\n        }\n      }\n      if (!currentListNode || currentListNode.name !== listName) {\n        prevListNode = prevListNode || currentListNode;\n        currentListNode = new global$2(listName, 1);\n        if (start > 1) {\n          currentListNode.attr('start', '' + start);\n        }\n        paragraphNode.wrap(currentListNode);\n      } else {\n        currentListNode.append(paragraphNode);\n      }\n      paragraphNode.name = 'li';\n      if (level > lastLevel && prevListNode) {\n        prevListNode.lastChild.append(currentListNode);\n      }\n      lastLevel = level;\n      _removeIgnoredNodes(paragraphNode);\n      _trimListStart(paragraphNode, /^\\u00a0+/);\n      _trimListStart(paragraphNode, /^\\s*([\\u2022\\u00b7\\u00a7\\u25CF]|\\w+\\.)/);\n      _trimListStart(paragraphNode, /^\\u00a0+/);\n    };\n    var elements = [];\n    var child = node.firstChild;\n    while (typeof child !== 'undefined' && child !== null) {\n      elements.push(child);\n      child = child.walk();\n      if (child !== null) {\n        while (typeof child !== 'undefined' && child.parent !== node) {\n          child = child.walk();\n        }\n      }\n    }\n    for (var i = 0; i < elements.length; i++) {\n      node = elements[i];\n      if (node.name === 'p' && node.firstChild) {\n        var nodeText = _getText(node);\n        if (isBulletList(nodeText)) {\n          convertParagraphToLi(node, 'ul');\n          continue;\n        }\n        if (isNumericList(nodeText)) {\n          var matches = /([0-9]+)\\./.exec(nodeText);\n          var start = 1;\n          if (matches) {\n            start = parseInt(matches[1], 10);\n          }\n          convertParagraphToLi(node, 'ol', start);\n          continue;\n        }\n        if (node._listLevel) {\n          convertParagraphToLi(node, 'ul', 1);\n          continue;\n        }\n        currentListNode = null;\n      } else {\n        prevListNode = currentListNode;\n        currentListNode = null;\n      }\n    }\n  };\n  var filterStyles = function filterStyles(editor, validStyles, node, styleValue) {\n    var outputStyles = {};\n    var styles = editor.dom.parseStyle(styleValue);\n    global$6.each(styles, function (value, name) {\n      switch (name) {\n        case 'mso-list':\n          var matches = /\\w+ \\w+([0-9]+)/i.exec(styleValue);\n          if (matches) {\n            node._listLevel = parseInt(matches[1], 10);\n          }\n          if (/Ignore/i.test(value) && node.firstChild) {\n            node._listIgnore = true;\n            node.firstChild._listIgnore = true;\n          }\n          break;\n        case 'horiz-align':\n          name = 'text-align';\n          break;\n        case 'vert-align':\n          name = 'vertical-align';\n          break;\n        case 'font-color':\n        case 'mso-foreground':\n          name = 'color';\n          break;\n        case 'mso-background':\n        case 'mso-highlight':\n          name = 'background';\n          break;\n        case 'font-weight':\n        case 'font-style':\n          if (value !== 'normal') {\n            outputStyles[name] = value;\n          }\n          return;\n        case 'mso-element':\n          if (/^(comment|comment-list)$/i.test(value)) {\n            node.remove();\n            return;\n          }\n          break;\n      }\n      if (name.indexOf('mso-comment') === 0) {\n        node.remove();\n        return;\n      }\n      if (name.indexOf('mso-') === 0) {\n        return;\n      }\n      if (getRetainStyleProps(editor) === 'all' || validStyles && validStyles[name]) {\n        outputStyles[name] = value;\n      }\n    });\n    if (/(bold)/i.test(outputStyles['font-weight'])) {\n      delete outputStyles['font-weight'];\n      node.wrap(new global$2('b', 1));\n    }\n    if (/(italic)/i.test(outputStyles['font-style'])) {\n      delete outputStyles['font-style'];\n      node.wrap(new global$2('i', 1));\n    }\n    var outputStyle = editor.dom.serializeStyle(outputStyles, node.name);\n    if (outputStyle) {\n      return outputStyle;\n    }\n    return null;\n  };\n  var filterWordContent = function filterWordContent(editor, content) {\n    var validStyles;\n    var retainStyleProperties = getRetainStyleProps(editor);\n    if (retainStyleProperties) {\n      validStyles = global$6.makeMap(retainStyleProperties.split(/[, ]/));\n    }\n    content = filter(content, [/<br class=\"?Apple-interchange-newline\"?>/gi, /<b[^>]+id=\"?docs-internal-[^>]*>/gi, /<!--[\\s\\S]+?-->/gi, /<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|img|meta|link|style|\\w:\\w+)(?=[\\s\\/>]))[^>]*>/gi, [/<(\\/?)s>/gi, '<$1strike>'], [/&nbsp;/gi, nbsp], [/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi, function (str, spaces) {\n      return spaces.length > 0 ? spaces.replace(/./, ' ').slice(Math.floor(spaces.length / 2)).split('').join(nbsp) : '';\n    }]]);\n    var validElements = getWordValidElements(editor);\n    var schema = global$1({\n      valid_elements: validElements,\n      valid_children: '-li[p]'\n    });\n    global$6.each(schema.elements, function (rule) {\n      if (!rule.attributes.class) {\n        rule.attributes.class = {};\n        rule.attributesOrder.push('class');\n      }\n      if (!rule.attributes.style) {\n        rule.attributes.style = {};\n        rule.attributesOrder.push('style');\n      }\n    });\n    var domParser = global$4({}, schema);\n    domParser.addAttributeFilter('style', function (nodes) {\n      var i = nodes.length,\n        node;\n      while (i--) {\n        node = nodes[i];\n        node.attr('style', filterStyles(editor, validStyles, node, node.attr('style')));\n        if (node.name === 'span' && node.parent && !node.attributes.length) {\n          node.unwrap();\n        }\n      }\n    });\n    domParser.addAttributeFilter('class', function (nodes) {\n      var i = nodes.length,\n        node,\n        className;\n      while (i--) {\n        node = nodes[i];\n        className = node.attr('class');\n        if (/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(className)) {\n          node.remove();\n        }\n        node.attr('class', null);\n      }\n    });\n    domParser.addNodeFilter('del', function (nodes) {\n      var i = nodes.length;\n      while (i--) {\n        nodes[i].remove();\n      }\n    });\n    domParser.addNodeFilter('a', function (nodes) {\n      var i = nodes.length,\n        node,\n        href,\n        name;\n      while (i--) {\n        node = nodes[i];\n        href = node.attr('href');\n        name = node.attr('name');\n        if (href && href.indexOf('#_msocom_') !== -1) {\n          node.remove();\n          continue;\n        }\n        if (href && href.indexOf('file://') === 0) {\n          href = href.split('#')[1];\n          if (href) {\n            href = '#' + href;\n          }\n        }\n        if (!href && !name) {\n          node.unwrap();\n        } else {\n          if (name && !/^_?(?:toc|edn|ftn)/i.test(name)) {\n            node.unwrap();\n            continue;\n          }\n          node.attr({\n            href: href,\n            name: name\n          });\n        }\n      }\n    });\n    var rootNode = domParser.parse(content);\n    if (shouldConvertWordFakeLists(editor)) {\n      convertFakeListsToProperLists(rootNode);\n    }\n    content = global$3({\n      validate: getValidate(editor)\n    }, schema).serialize(rootNode);\n    return content;\n  };\n  var preProcess$1 = function preProcess$1(editor, content) {\n    return shouldUseDefaultFilters(editor) ? filterWordContent(editor, content) : content;\n  };\n  var preProcess = function preProcess(editor, html) {\n    var parser = global$4({}, editor.schema);\n    parser.addNodeFilter('meta', function (nodes) {\n      global$6.each(nodes, function (node) {\n        node.remove();\n      });\n    });\n    var fragment = parser.parse(html, {\n      forced_root_block: false,\n      isRootContent: true\n    });\n    return global$3({\n      validate: getValidate(editor)\n    }, editor.schema).serialize(fragment);\n  };\n  var processResult = function processResult(content, cancelled) {\n    return {\n      content: content,\n      cancelled: cancelled\n    };\n  };\n  var postProcessFilter = function postProcessFilter(editor, html, internal, isWordHtml) {\n    var tempBody = editor.dom.create('div', {\n      style: 'display:none'\n    }, html);\n    var postProcessArgs = firePastePostProcess(editor, tempBody, internal, isWordHtml);\n    return processResult(postProcessArgs.node.innerHTML, postProcessArgs.isDefaultPrevented());\n  };\n  var filterContent = function filterContent(editor, content, internal, isWordHtml) {\n    var preProcessArgs = firePastePreProcess(editor, content, internal, isWordHtml);\n    var filteredContent = preProcess(editor, preProcessArgs.content);\n    if (editor.hasEventListeners('PastePostProcess') && !preProcessArgs.isDefaultPrevented()) {\n      return postProcessFilter(editor, filteredContent, internal, isWordHtml);\n    } else {\n      return processResult(filteredContent, preProcessArgs.isDefaultPrevented());\n    }\n  };\n  var process = function process(editor, html, internal) {\n    var isWordHtml = isWordContent(html);\n    var content = isWordHtml ? preProcess$1(editor, html) : html;\n    return filterContent(editor, content, internal, isWordHtml);\n  };\n  var pasteHtml$1 = function pasteHtml$1(editor, html) {\n    editor.insertContent(html, {\n      merge: shouldMergeFormats(editor),\n      paste: true\n    });\n    return true;\n  };\n  var isAbsoluteUrl = function isAbsoluteUrl(url) {\n    return /^https?:\\/\\/[\\w\\-\\/+=.,!;:&%@^~(){}?#]+$/i.test(url);\n  };\n  var isImageUrl = function isImageUrl(editor, url) {\n    return isAbsoluteUrl(url) && exists(getAllowedImageFileTypes(editor), function (type) {\n      return endsWith(url.toLowerCase(), '.' + type.toLowerCase());\n    });\n  };\n  var createImage = function createImage(editor, url, pasteHtmlFn) {\n    editor.undoManager.extra(function () {\n      pasteHtmlFn(editor, url);\n    }, function () {\n      editor.insertContent('<img src=\"' + url + '\">');\n    });\n    return true;\n  };\n  var createLink = function createLink(editor, url, pasteHtmlFn) {\n    editor.undoManager.extra(function () {\n      pasteHtmlFn(editor, url);\n    }, function () {\n      editor.execCommand('mceInsertLink', false, url);\n    });\n    return true;\n  };\n  var linkSelection = function linkSelection(editor, html, pasteHtmlFn) {\n    return editor.selection.isCollapsed() === false && isAbsoluteUrl(html) ? createLink(editor, html, pasteHtmlFn) : false;\n  };\n  var insertImage = function insertImage(editor, html, pasteHtmlFn) {\n    return isImageUrl(editor, html) ? createImage(editor, html, pasteHtmlFn) : false;\n  };\n  var smartInsertContent = function smartInsertContent(editor, html) {\n    global$6.each([linkSelection, insertImage, pasteHtml$1], function (action) {\n      return action(editor, html, pasteHtml$1) !== true;\n    });\n  };\n  var insertContent = function insertContent(editor, html, pasteAsText) {\n    if (pasteAsText || isSmartPasteEnabled(editor) === false) {\n      pasteHtml$1(editor, html);\n    } else {\n      smartInsertContent(editor, html);\n    }\n  };\n  var isCollapsibleWhitespace = function isCollapsibleWhitespace(c) {\n    return ' \\f\\t\\x0B'.indexOf(c) !== -1;\n  };\n  var isNewLineChar = function isNewLineChar(c) {\n    return c === '\\n' || c === '\\r';\n  };\n  var isNewline = function isNewline(text, idx) {\n    return idx < text.length && idx >= 0 ? isNewLineChar(text[idx]) : false;\n  };\n  var normalizeWhitespace = function normalizeWhitespace(editor, text) {\n    var tabSpace = repeat(' ', getTabSpaces(editor));\n    var normalizedText = text.replace(/\\t/g, tabSpace);\n    var result = foldl(normalizedText, function (acc, c) {\n      if (isCollapsibleWhitespace(c) || c === nbsp) {\n        if (acc.pcIsSpace || acc.str === '' || acc.str.length === normalizedText.length - 1 || isNewline(normalizedText, acc.str.length + 1)) {\n          return {\n            pcIsSpace: false,\n            str: acc.str + nbsp\n          };\n        } else {\n          return {\n            pcIsSpace: true,\n            str: acc.str + ' '\n          };\n        }\n      } else {\n        return {\n          pcIsSpace: isNewLineChar(c),\n          str: acc.str + c\n        };\n      }\n    }, {\n      pcIsSpace: false,\n      str: ''\n    });\n    return result.str;\n  };\n  var doPaste = function doPaste(editor, content, internal, pasteAsText) {\n    var args = process(editor, content, internal);\n    if (args.cancelled === false) {\n      insertContent(editor, args.content, pasteAsText);\n    }\n  };\n  var _pasteHtml = function pasteHtml(editor, html, internalFlag) {\n    var internal = internalFlag ? internalFlag : isMarked(html);\n    doPaste(editor, unmark(html), internal, false);\n  };\n  var _pasteText = function pasteText(editor, text) {\n    var encodedText = editor.dom.encode(text).replace(/\\r\\n/g, '\\n');\n    var normalizedText = normalizeWhitespace(editor, encodedText);\n    var html = convert(normalizedText, getForcedRootBlock(editor), getForcedRootBlockAttrs(editor));\n    doPaste(editor, html, false, true);\n  };\n  var getDataTransferItems = function getDataTransferItems(dataTransfer) {\n    var items = {};\n    var mceInternalUrlPrefix = 'data:text/mce-internal,';\n    if (dataTransfer) {\n      if (dataTransfer.getData) {\n        var legacyText = dataTransfer.getData('Text');\n        if (legacyText && legacyText.length > 0) {\n          if (legacyText.indexOf(mceInternalUrlPrefix) === -1) {\n            items['text/plain'] = legacyText;\n          }\n        }\n      }\n      if (dataTransfer.types) {\n        for (var i = 0; i < dataTransfer.types.length; i++) {\n          var contentType = dataTransfer.types[i];\n          try {\n            items[contentType] = dataTransfer.getData(contentType);\n          } catch (ex) {\n            items[contentType] = '';\n          }\n        }\n      }\n    }\n    return items;\n  };\n  var getClipboardContent = function getClipboardContent(editor, clipboardEvent) {\n    return getDataTransferItems(clipboardEvent.clipboardData || editor.getDoc().dataTransfer);\n  };\n  var hasContentType = function hasContentType(clipboardContent, mimeType) {\n    return mimeType in clipboardContent && clipboardContent[mimeType].length > 0;\n  };\n  var hasHtmlOrText = function hasHtmlOrText(content) {\n    return hasContentType(content, 'text/html') || hasContentType(content, 'text/plain');\n  };\n  var parseDataUri = function parseDataUri(uri) {\n    var matches = /data:([^;]+);base64,([a-z0-9\\+\\/=]+)/i.exec(uri);\n    if (matches) {\n      return {\n        type: matches[1],\n        data: decodeURIComponent(matches[2])\n      };\n    } else {\n      return {\n        type: null,\n        data: null\n      };\n    }\n  };\n  var isValidDataUriImage = function isValidDataUriImage(editor, imgElm) {\n    var filter = getImagesDataImgFilter(editor);\n    return filter ? filter(imgElm) : true;\n  };\n  var extractFilename = function extractFilename(editor, str) {\n    var m = str.match(/([\\s\\S]+?)(?:\\.[a-z0-9.]+)$/i);\n    return isNonNullable(m) ? editor.dom.encode(m[1]) : null;\n  };\n  var uniqueId = createIdGenerator('mceclip');\n  var pasteImage = function pasteImage(editor, imageItem) {\n    var _a = parseDataUri(imageItem.uri),\n      base64 = _a.data,\n      type = _a.type;\n    var id = uniqueId();\n    var file = imageItem.blob;\n    var img = new Image();\n    img.src = imageItem.uri;\n    if (isValidDataUriImage(editor, img)) {\n      var blobCache = editor.editorUpload.blobCache;\n      var blobInfo = void 0;\n      var existingBlobInfo = blobCache.getByData(base64, type);\n      if (!existingBlobInfo) {\n        var useFileName = getImagesReuseFilename(editor) && isNonNullable(file.name);\n        var name_1 = useFileName ? extractFilename(editor, file.name) : id;\n        var filename = useFileName ? file.name : undefined;\n        blobInfo = blobCache.create(id, file, base64, name_1, filename);\n        blobCache.add(blobInfo);\n      } else {\n        blobInfo = existingBlobInfo;\n      }\n      _pasteHtml(editor, '<img src=\"' + blobInfo.blobUri() + '\">', false);\n    } else {\n      _pasteHtml(editor, '<img src=\"' + imageItem.uri + '\">', false);\n    }\n  };\n  var isClipboardEvent = function isClipboardEvent(event) {\n    return event.type === 'paste';\n  };\n  var isDataTransferItem = function isDataTransferItem(item) {\n    return isNonNullable(item.getAsFile);\n  };\n  var readFilesAsDataUris = function readFilesAsDataUris(items) {\n    return global$8.all(map(items, function (item) {\n      return new global$8(function (resolve) {\n        var blob = isDataTransferItem(item) ? item.getAsFile() : item;\n        var reader = new window.FileReader();\n        reader.onload = function () {\n          resolve({\n            blob: blob,\n            uri: reader.result\n          });\n        };\n        reader.readAsDataURL(blob);\n      });\n    }));\n  };\n  var isImage = function isImage(editor) {\n    var allowedExtensions = getAllowedImageFileTypes(editor);\n    return function (file) {\n      return startsWith(file.type, 'image/') && exists(allowedExtensions, function (extension) {\n        return getImageMimeType(extension) === file.type;\n      });\n    };\n  };\n  var getImagesFromDataTransfer = function getImagesFromDataTransfer(editor, dataTransfer) {\n    var items = dataTransfer.items ? bind(from(dataTransfer.items), function (item) {\n      return item.kind === 'file' ? [item.getAsFile()] : [];\n    }) : [];\n    var files = dataTransfer.files ? from(dataTransfer.files) : [];\n    return filter$1(items.length > 0 ? items : files, isImage(editor));\n  };\n  var _pasteImageData = function pasteImageData(editor, e, rng) {\n    var dataTransfer = isClipboardEvent(e) ? e.clipboardData : e.dataTransfer;\n    if (getPasteDataImages(editor) && dataTransfer) {\n      var images = getImagesFromDataTransfer(editor, dataTransfer);\n      if (images.length > 0) {\n        e.preventDefault();\n        readFilesAsDataUris(images).then(function (fileResults) {\n          if (rng) {\n            editor.selection.setRng(rng);\n          }\n          each(fileResults, function (result) {\n            pasteImage(editor, result);\n          });\n        });\n        return true;\n      }\n    }\n    return false;\n  };\n  var isBrokenAndroidClipboardEvent = function isBrokenAndroidClipboardEvent(e) {\n    var clipboardData = e.clipboardData;\n    return navigator.userAgent.indexOf('Android') !== -1 && clipboardData && clipboardData.items && clipboardData.items.length === 0;\n  };\n  var isKeyboardPasteEvent = function isKeyboardPasteEvent(e) {\n    return global$7.metaKeyPressed(e) && e.keyCode === 86 || e.shiftKey && e.keyCode === 45;\n  };\n  var registerEventHandlers = function registerEventHandlers(editor, pasteBin, pasteFormat) {\n    var keyboardPasteEvent = value();\n    var keyboardPastePressed = value();\n    var keyboardPastePlainTextState;\n    editor.on('keyup', keyboardPastePressed.clear);\n    editor.on('keydown', function (e) {\n      var removePasteBinOnKeyUp = function removePasteBinOnKeyUp(e) {\n        if (isKeyboardPasteEvent(e) && !e.isDefaultPrevented()) {\n          pasteBin.remove();\n        }\n      };\n      if (isKeyboardPasteEvent(e) && !e.isDefaultPrevented()) {\n        keyboardPastePlainTextState = e.shiftKey && e.keyCode === 86;\n        if (keyboardPastePlainTextState && global$a.webkit && navigator.userAgent.indexOf('Version/') !== -1) {\n          return;\n        }\n        e.stopImmediatePropagation();\n        keyboardPasteEvent.set(e);\n        keyboardPastePressed.set(true);\n        if (global$a.ie && keyboardPastePlainTextState) {\n          e.preventDefault();\n          firePaste(editor, true);\n          return;\n        }\n        pasteBin.remove();\n        pasteBin.create();\n        editor.once('keyup', removePasteBinOnKeyUp);\n        editor.once('paste', function () {\n          editor.off('keyup', removePasteBinOnKeyUp);\n        });\n      }\n    });\n    var insertClipboardContent = function insertClipboardContent(editor, clipboardContent, isKeyBoardPaste, plainTextMode, internal) {\n      var content;\n      if (hasContentType(clipboardContent, 'text/html')) {\n        content = clipboardContent['text/html'];\n      } else {\n        content = pasteBin.getHtml();\n        internal = internal ? internal : isMarked(content);\n        if (pasteBin.isDefaultContent(content)) {\n          plainTextMode = true;\n        }\n      }\n      content = trimHtml(content);\n      pasteBin.remove();\n      var isPlainTextHtml = internal === false && isPlainText(content);\n      var isAbsoluteUrl$1 = isAbsoluteUrl(content);\n      if (!content.length || isPlainTextHtml && !isAbsoluteUrl$1) {\n        plainTextMode = true;\n      }\n      if (plainTextMode || isAbsoluteUrl$1) {\n        if (hasContentType(clipboardContent, 'text/plain') && isPlainTextHtml) {\n          content = clipboardContent['text/plain'];\n        } else {\n          content = innerText(content);\n        }\n      }\n      if (pasteBin.isDefaultContent(content)) {\n        if (!isKeyBoardPaste) {\n          editor.windowManager.alert('Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.');\n        }\n        return;\n      }\n      if (plainTextMode) {\n        _pasteText(editor, content);\n      } else {\n        _pasteHtml(editor, content, internal);\n      }\n    };\n    var getLastRng = function getLastRng() {\n      return pasteBin.getLastRng() || editor.selection.getRng();\n    };\n    editor.on('paste', function (e) {\n      var isKeyboardPaste = keyboardPasteEvent.isSet() || keyboardPastePressed.isSet();\n      if (isKeyboardPaste) {\n        keyboardPasteEvent.clear();\n      }\n      var clipboardContent = getClipboardContent(editor, e);\n      var plainTextMode = pasteFormat.get() === 'text' || keyboardPastePlainTextState;\n      var internal = hasContentType(clipboardContent, internalHtmlMime());\n      keyboardPastePlainTextState = false;\n      if (e.isDefaultPrevented() || isBrokenAndroidClipboardEvent(e)) {\n        pasteBin.remove();\n        return;\n      }\n      if (!hasHtmlOrText(clipboardContent) && _pasteImageData(editor, e, getLastRng())) {\n        pasteBin.remove();\n        return;\n      }\n      if (!isKeyboardPaste) {\n        e.preventDefault();\n      }\n      if (global$a.ie && (!isKeyboardPaste || e.ieFake) && !hasContentType(clipboardContent, 'text/html')) {\n        pasteBin.create();\n        editor.dom.bind(pasteBin.getEl(), 'paste', function (e) {\n          e.stopPropagation();\n        });\n        editor.getDoc().execCommand('Paste', false, null);\n        clipboardContent['text/html'] = pasteBin.getHtml();\n      }\n      if (hasContentType(clipboardContent, 'text/html')) {\n        e.preventDefault();\n        if (!internal) {\n          internal = isMarked(clipboardContent['text/html']);\n        }\n        insertClipboardContent(editor, clipboardContent, isKeyboardPaste, plainTextMode, internal);\n      } else {\n        global$9.setEditorTimeout(editor, function () {\n          insertClipboardContent(editor, clipboardContent, isKeyboardPaste, plainTextMode, internal);\n        }, 0);\n      }\n    });\n  };\n  var registerEventsAndFilters = function registerEventsAndFilters(editor, pasteBin, pasteFormat) {\n    registerEventHandlers(editor, pasteBin, pasteFormat);\n    var src;\n    editor.parser.addNodeFilter('img', function (nodes, name, args) {\n      var isPasteInsert = function isPasteInsert(args) {\n        return args.data && args.data.paste === true;\n      };\n      var remove = function remove(node) {\n        if (!node.attr('data-mce-object') && src !== global$a.transparentSrc) {\n          node.remove();\n        }\n      };\n      var isWebKitFakeUrl = function isWebKitFakeUrl(src) {\n        return src.indexOf('webkit-fake-url') === 0;\n      };\n      var isDataUri = function isDataUri(src) {\n        return src.indexOf('data:') === 0;\n      };\n      if (!getPasteDataImages(editor) && isPasteInsert(args)) {\n        var i = nodes.length;\n        while (i--) {\n          src = nodes[i].attr('src');\n          if (!src) {\n            continue;\n          }\n          if (isWebKitFakeUrl(src)) {\n            remove(nodes[i]);\n          } else if (!getAllowHtmlDataUrls(editor) && isDataUri(src)) {\n            remove(nodes[i]);\n          }\n        }\n      }\n    });\n  };\n  var getPasteBinParent = function getPasteBinParent(editor) {\n    return global$a.ie && editor.inline ? document.body : editor.getBody();\n  };\n  var isExternalPasteBin = function isExternalPasteBin(editor) {\n    return getPasteBinParent(editor) !== editor.getBody();\n  };\n  var delegatePasteEvents = function delegatePasteEvents(editor, pasteBinElm, pasteBinDefaultContent) {\n    if (isExternalPasteBin(editor)) {\n      editor.dom.bind(pasteBinElm, 'paste keyup', function (_e) {\n        if (!_isDefault(editor, pasteBinDefaultContent)) {\n          editor.fire('paste');\n        }\n      });\n    }\n  };\n  var _create = function create(editor, lastRngCell, pasteBinDefaultContent) {\n    var dom = editor.dom,\n      body = editor.getBody();\n    lastRngCell.set(editor.selection.getRng());\n    var pasteBinElm = editor.dom.add(getPasteBinParent(editor), 'div', {\n      'id': 'mcepastebin',\n      'class': 'mce-pastebin',\n      'contentEditable': true,\n      'data-mce-bogus': 'all',\n      'style': 'position: fixed; top: 50%; width: 10px; height: 10px; overflow: hidden; opacity: 0'\n    }, pasteBinDefaultContent);\n    if (global$a.ie || global$a.gecko) {\n      dom.setStyle(pasteBinElm, 'left', dom.getStyle(body, 'direction', true) === 'rtl' ? 65535 : -65535);\n    }\n    dom.bind(pasteBinElm, 'beforedeactivate focusin focusout', function (e) {\n      e.stopPropagation();\n    });\n    delegatePasteEvents(editor, pasteBinElm, pasteBinDefaultContent);\n    pasteBinElm.focus();\n    editor.selection.select(pasteBinElm, true);\n  };\n  var _remove = function remove(editor, lastRngCell) {\n    if (_getEl(editor)) {\n      var pasteBinClone = void 0;\n      var lastRng = lastRngCell.get();\n      while (pasteBinClone = editor.dom.get('mcepastebin')) {\n        editor.dom.remove(pasteBinClone);\n        editor.dom.unbind(pasteBinClone);\n      }\n      if (lastRng) {\n        editor.selection.setRng(lastRng);\n      }\n    }\n    lastRngCell.set(null);\n  };\n  var _getEl = function getEl(editor) {\n    return editor.dom.get('mcepastebin');\n  };\n  var _getHtml = function getHtml(editor) {\n    var copyAndRemove = function copyAndRemove(toElm, fromElm) {\n      toElm.appendChild(fromElm);\n      editor.dom.remove(fromElm, true);\n    };\n    var pasteBinClones = global$6.grep(getPasteBinParent(editor).childNodes, function (elm) {\n      return elm.id === 'mcepastebin';\n    });\n    var pasteBinElm = pasteBinClones.shift();\n    global$6.each(pasteBinClones, function (pasteBinClone) {\n      copyAndRemove(pasteBinElm, pasteBinClone);\n    });\n    var dirtyWrappers = editor.dom.select('div[id=mcepastebin]', pasteBinElm);\n    for (var i = dirtyWrappers.length - 1; i >= 0; i--) {\n      var cleanWrapper = editor.dom.create('div');\n      pasteBinElm.insertBefore(cleanWrapper, dirtyWrappers[i]);\n      copyAndRemove(cleanWrapper, dirtyWrappers[i]);\n    }\n    return pasteBinElm ? pasteBinElm.innerHTML : '';\n  };\n  var _isDefaultContent = function isDefaultContent(pasteBinDefaultContent, content) {\n    return content === pasteBinDefaultContent;\n  };\n  var isPasteBin = function isPasteBin(elm) {\n    return elm && elm.id === 'mcepastebin';\n  };\n  var _isDefault = function isDefault(editor, pasteBinDefaultContent) {\n    var pasteBinElm = _getEl(editor);\n    return isPasteBin(pasteBinElm) && _isDefaultContent(pasteBinDefaultContent, pasteBinElm.innerHTML);\n  };\n  var PasteBin = function PasteBin(editor) {\n    var lastRng = Cell(null);\n    var pasteBinDefaultContent = '%MCEPASTEBIN%';\n    return {\n      create: function create() {\n        return _create(editor, lastRng, pasteBinDefaultContent);\n      },\n      remove: function remove() {\n        return _remove(editor, lastRng);\n      },\n      getEl: function getEl() {\n        return _getEl(editor);\n      },\n      getHtml: function getHtml() {\n        return _getHtml(editor);\n      },\n      getLastRng: lastRng.get,\n      isDefault: function isDefault() {\n        return _isDefault(editor, pasteBinDefaultContent);\n      },\n      isDefaultContent: function isDefaultContent(content) {\n        return _isDefaultContent(pasteBinDefaultContent, content);\n      }\n    };\n  };\n  var Clipboard = function Clipboard(editor, pasteFormat) {\n    var pasteBin = PasteBin(editor);\n    editor.on('PreInit', function () {\n      return registerEventsAndFilters(editor, pasteBin, pasteFormat);\n    });\n    return {\n      pasteFormat: pasteFormat,\n      pasteHtml: function pasteHtml(html, internalFlag) {\n        return _pasteHtml(editor, html, internalFlag);\n      },\n      pasteText: function pasteText(text) {\n        return _pasteText(editor, text);\n      },\n      pasteImageData: function pasteImageData(e, rng) {\n        return _pasteImageData(editor, e, rng);\n      },\n      getDataTransferItems: getDataTransferItems,\n      hasHtmlOrText: hasHtmlOrText,\n      hasContentType: hasContentType\n    };\n  };\n  var togglePlainTextPaste = function togglePlainTextPaste(editor, clipboard) {\n    if (clipboard.pasteFormat.get() === 'text') {\n      clipboard.pasteFormat.set('html');\n      firePastePlainTextToggle(editor, false);\n    } else {\n      clipboard.pasteFormat.set('text');\n      firePastePlainTextToggle(editor, true);\n    }\n    editor.focus();\n  };\n  var register$2 = function register$2(editor, clipboard) {\n    editor.addCommand('mceTogglePlainTextPaste', function () {\n      togglePlainTextPaste(editor, clipboard);\n    });\n    editor.addCommand('mceInsertClipboardContent', function (ui, value) {\n      if (value.content) {\n        clipboard.pasteHtml(value.content, value.internal);\n      }\n      if (value.text) {\n        clipboard.pasteText(value.text);\n      }\n    });\n  };\n  var hasWorkingClipboardApi = function hasWorkingClipboardApi(clipboardData) {\n    return global$a.iOS === false && typeof (clipboardData === null || clipboardData === void 0 ? void 0 : clipboardData.setData) === 'function';\n  };\n  var setHtml5Clipboard = function setHtml5Clipboard(clipboardData, html, text) {\n    if (hasWorkingClipboardApi(clipboardData)) {\n      try {\n        clipboardData.clearData();\n        clipboardData.setData('text/html', html);\n        clipboardData.setData('text/plain', text);\n        clipboardData.setData(internalHtmlMime(), html);\n        return true;\n      } catch (e) {\n        return false;\n      }\n    } else {\n      return false;\n    }\n  };\n  var setClipboardData = function setClipboardData(evt, data, fallback, done) {\n    if (setHtml5Clipboard(evt.clipboardData, data.html, data.text)) {\n      evt.preventDefault();\n      done();\n    } else {\n      fallback(data.html, done);\n    }\n  };\n  var fallback = function fallback(editor) {\n    return function (html, done) {\n      var markedHtml = mark(html);\n      var outer = editor.dom.create('div', {\n        'contenteditable': 'false',\n        'data-mce-bogus': 'all'\n      });\n      var inner = editor.dom.create('div', {\n        contenteditable: 'true'\n      }, markedHtml);\n      editor.dom.setStyles(outer, {\n        position: 'fixed',\n        top: '0',\n        left: '-3000px',\n        width: '1000px',\n        overflow: 'hidden'\n      });\n      outer.appendChild(inner);\n      editor.dom.add(editor.getBody(), outer);\n      var range = editor.selection.getRng();\n      inner.focus();\n      var offscreenRange = editor.dom.createRng();\n      offscreenRange.selectNodeContents(inner);\n      editor.selection.setRng(offscreenRange);\n      global$9.setTimeout(function () {\n        editor.selection.setRng(range);\n        outer.parentNode.removeChild(outer);\n        done();\n      }, 0);\n    };\n  };\n  var getData = function getData(editor) {\n    return {\n      html: editor.selection.getContent({\n        contextual: true\n      }),\n      text: editor.selection.getContent({\n        format: 'text'\n      })\n    };\n  };\n  var isTableSelection = function isTableSelection(editor) {\n    return !!editor.dom.getParent(editor.selection.getStart(), 'td[data-mce-selected],th[data-mce-selected]', editor.getBody());\n  };\n  var hasSelectedContent = function hasSelectedContent(editor) {\n    return !editor.selection.isCollapsed() || isTableSelection(editor);\n  };\n  var cut = function cut(editor) {\n    return function (evt) {\n      if (hasSelectedContent(editor)) {\n        setClipboardData(evt, getData(editor), fallback(editor), function () {\n          if (global$a.browser.isChrome() || global$a.browser.isFirefox()) {\n            var rng_1 = editor.selection.getRng();\n            global$9.setEditorTimeout(editor, function () {\n              editor.selection.setRng(rng_1);\n              editor.execCommand('Delete');\n            }, 0);\n          } else {\n            editor.execCommand('Delete');\n          }\n        });\n      }\n    };\n  };\n  var copy = function copy(editor) {\n    return function (evt) {\n      if (hasSelectedContent(editor)) {\n        setClipboardData(evt, getData(editor), fallback(editor), noop);\n      }\n    };\n  };\n  var register$1 = function register$1(editor) {\n    editor.on('cut', cut(editor));\n    editor.on('copy', copy(editor));\n  };\n  var global = tinymce.util.Tools.resolve('tinymce.dom.RangeUtils');\n  var getCaretRangeFromEvent = function getCaretRangeFromEvent(editor, e) {\n    return global.getCaretRangeFromPoint(e.clientX, e.clientY, editor.getDoc());\n  };\n  var isPlainTextFileUrl = function isPlainTextFileUrl(content) {\n    var plainTextContent = content['text/plain'];\n    return plainTextContent ? plainTextContent.indexOf('file://') === 0 : false;\n  };\n  var setFocusedRange = function setFocusedRange(editor, rng) {\n    editor.focus();\n    editor.selection.setRng(rng);\n  };\n  var setup$2 = function setup$2(editor, clipboard, draggingInternallyState) {\n    if (shouldBlockDrop(editor)) {\n      editor.on('dragend dragover draggesture dragdrop drop drag', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n      });\n    }\n    if (!shouldPasteDataImages(editor)) {\n      editor.on('drop', function (e) {\n        var dataTransfer = e.dataTransfer;\n        if (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\n          e.preventDefault();\n        }\n      });\n    }\n    editor.on('drop', function (e) {\n      var rng = getCaretRangeFromEvent(editor, e);\n      if (e.isDefaultPrevented() || draggingInternallyState.get()) {\n        return;\n      }\n      var dropContent = clipboard.getDataTransferItems(e.dataTransfer);\n      var internal = clipboard.hasContentType(dropContent, internalHtmlMime());\n      if ((!clipboard.hasHtmlOrText(dropContent) || isPlainTextFileUrl(dropContent)) && clipboard.pasteImageData(e, rng)) {\n        return;\n      }\n      if (rng && shouldFilterDrop(editor)) {\n        var content_1 = dropContent['mce-internal'] || dropContent['text/html'] || dropContent['text/plain'];\n        if (content_1) {\n          e.preventDefault();\n          global$9.setEditorTimeout(editor, function () {\n            editor.undoManager.transact(function () {\n              if (dropContent['mce-internal']) {\n                editor.execCommand('Delete');\n              }\n              setFocusedRange(editor, rng);\n              content_1 = trimHtml(content_1);\n              if (!dropContent['text/html']) {\n                clipboard.pasteText(content_1);\n              } else {\n                clipboard.pasteHtml(content_1, internal);\n              }\n            });\n          });\n        }\n      }\n    });\n    editor.on('dragstart', function (_e) {\n      draggingInternallyState.set(true);\n    });\n    editor.on('dragover dragend', function (e) {\n      if (shouldPasteDataImages(editor) && draggingInternallyState.get() === false) {\n        e.preventDefault();\n        setFocusedRange(editor, getCaretRangeFromEvent(editor, e));\n      }\n      if (e.type === 'dragend') {\n        draggingInternallyState.set(false);\n      }\n    });\n  };\n  var setup$1 = function setup$1(editor) {\n    var plugin = editor.plugins.paste;\n    var preProcess = getPreProcess(editor);\n    if (preProcess) {\n      editor.on('PastePreProcess', function (e) {\n        preProcess.call(plugin, plugin, e);\n      });\n    }\n    var postProcess = getPostProcess(editor);\n    if (postProcess) {\n      editor.on('PastePostProcess', function (e) {\n        postProcess.call(plugin, plugin, e);\n      });\n    }\n  };\n  var addPreProcessFilter = function addPreProcessFilter(editor, filterFunc) {\n    editor.on('PastePreProcess', function (e) {\n      e.content = filterFunc(editor, e.content, e.internal, e.wordContent);\n    });\n  };\n  var addPostProcessFilter = function addPostProcessFilter(editor, filterFunc) {\n    editor.on('PastePostProcess', function (e) {\n      filterFunc(editor, e.node);\n    });\n  };\n  var removeExplorerBrElementsAfterBlocks = function removeExplorerBrElementsAfterBlocks(editor, html) {\n    if (!isWordContent(html)) {\n      return html;\n    }\n    var blockElements = [];\n    global$6.each(editor.schema.getBlockElements(), function (block, blockName) {\n      blockElements.push(blockName);\n    });\n    var explorerBlocksRegExp = new RegExp('(?:<br>&nbsp;[\\\\s\\\\r\\\\n]+|<br>)*(<\\\\/?(' + blockElements.join('|') + ')[^>]*>)(?:<br>&nbsp;[\\\\s\\\\r\\\\n]+|<br>)*', 'g');\n    html = filter(html, [[explorerBlocksRegExp, '$1']]);\n    html = filter(html, [[/<br><br>/g, '<BR><BR>'], [/<br>/g, ' '], [/<BR><BR>/g, '<br>']]);\n    return html;\n  };\n  var removeWebKitStyles = function removeWebKitStyles(editor, content, internal, isWordHtml) {\n    if (isWordHtml || internal) {\n      return content;\n    }\n    var webKitStylesSetting = getWebkitStyles(editor);\n    var webKitStyles;\n    if (shouldRemoveWebKitStyles(editor) === false || webKitStylesSetting === 'all') {\n      return content;\n    }\n    if (webKitStylesSetting) {\n      webKitStyles = webKitStylesSetting.split(/[, ]/);\n    }\n    if (webKitStyles) {\n      var dom_1 = editor.dom,\n        node_1 = editor.selection.getNode();\n      content = content.replace(/(<[^>]+) style=\"([^\"]*)\"([^>]*>)/gi, function (all, before, value, after) {\n        var inputStyles = dom_1.parseStyle(dom_1.decode(value));\n        var outputStyles = {};\n        if (webKitStyles === 'none') {\n          return before + after;\n        }\n        for (var i = 0; i < webKitStyles.length; i++) {\n          var inputValue = inputStyles[webKitStyles[i]],\n            currentValue = dom_1.getStyle(node_1, webKitStyles[i], true);\n          if (/color/.test(webKitStyles[i])) {\n            inputValue = dom_1.toHex(inputValue);\n            currentValue = dom_1.toHex(currentValue);\n          }\n          if (currentValue !== inputValue) {\n            outputStyles[webKitStyles[i]] = inputValue;\n          }\n        }\n        var outputStyle = dom_1.serializeStyle(outputStyles, 'span');\n        if (outputStyle) {\n          return before + ' style=\"' + outputStyle + '\"' + after;\n        }\n        return before + after;\n      });\n    } else {\n      content = content.replace(/(<[^>]+) style=\"([^\"]*)\"([^>]*>)/gi, '$1$3');\n    }\n    content = content.replace(/(<[^>]+) data-mce-style=\"([^\"]+)\"([^>]*>)/gi, function (all, before, value, after) {\n      return before + ' style=\"' + value + '\"' + after;\n    });\n    return content;\n  };\n  var removeUnderlineAndFontInAnchor = function removeUnderlineAndFontInAnchor(editor, root) {\n    editor.$('a', root).find('font,u').each(function (i, node) {\n      editor.dom.remove(node, true);\n    });\n  };\n  var setup = function setup(editor) {\n    if (global$a.webkit) {\n      addPreProcessFilter(editor, removeWebKitStyles);\n    }\n    if (global$a.ie) {\n      addPreProcessFilter(editor, removeExplorerBrElementsAfterBlocks);\n      addPostProcessFilter(editor, removeUnderlineAndFontInAnchor);\n    }\n  };\n  var makeSetupHandler = function makeSetupHandler(editor, clipboard) {\n    return function (api) {\n      api.setActive(clipboard.pasteFormat.get() === 'text');\n      var pastePlainTextToggleHandler = function pastePlainTextToggleHandler(e) {\n        return api.setActive(e.state);\n      };\n      editor.on('PastePlainTextToggle', pastePlainTextToggleHandler);\n      return function () {\n        return editor.off('PastePlainTextToggle', pastePlainTextToggleHandler);\n      };\n    };\n  };\n  var register = function register(editor, clipboard) {\n    var onAction = function onAction() {\n      return editor.execCommand('mceTogglePlainTextPaste');\n    };\n    editor.ui.registry.addToggleButton('pastetext', {\n      active: false,\n      icon: 'paste-text',\n      tooltip: 'Paste as text',\n      onAction: onAction,\n      onSetup: makeSetupHandler(editor, clipboard)\n    });\n    editor.ui.registry.addToggleMenuItem('pastetext', {\n      text: 'Paste as text',\n      icon: 'paste-text',\n      onAction: onAction,\n      onSetup: makeSetupHandler(editor, clipboard)\n    });\n  };\n  function Plugin() {\n    global$b.add('paste', function (editor) {\n      if (hasProPlugin(editor) === false) {\n        var draggingInternallyState = Cell(false);\n        var pasteFormat = Cell(isPasteAsTextEnabled(editor) ? 'text' : 'html');\n        var clipboard = Clipboard(editor, pasteFormat);\n        setup(editor);\n        register(editor, clipboard);\n        register$2(editor, clipboard);\n        setup$1(editor);\n        register$1(editor);\n        setup$2(editor, clipboard, draggingInternallyState);\n        return get(clipboard);\n      }\n    });\n  }\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/paste/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/table/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/table/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"table\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/table')\n//   ES2015:\n//     import 'tinymce/plugins/table'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/table/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/table/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/table/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/table/plugin.js ***!
  \******************************************************/
/***/ (() => {

eval("/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.9 (2023-11-15)\n */\n(function () {\n  'use strict';\n\n  var typeOf = function typeOf(x) {\n    var t = typeof x;\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n  var isType$1 = function isType$1(type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n  var isSimpleType = function isSimpleType(type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n  var eq$2 = function eq$2(t) {\n    return function (a) {\n      return t === a;\n    };\n  };\n  var isString = isType$1('string');\n  var isObject = isType$1('object');\n  var isArray = isType$1('array');\n  var isNull = eq$2(null);\n  var isBoolean = isSimpleType('boolean');\n  var isUndefined = eq$2(undefined);\n  var isNullable = function isNullable(a) {\n    return a === null || a === undefined;\n  };\n  var isNonNullable = function isNonNullable(a) {\n    return !isNullable(a);\n  };\n  var isFunction = isSimpleType('function');\n  var isNumber = isSimpleType('number');\n  var noop = function noop() {};\n  var compose = function compose(fa, fb) {\n    return function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      return fa(fb.apply(null, args));\n    };\n  };\n  var compose1 = function compose1(fbc, fab) {\n    return function (a) {\n      return fbc(fab(a));\n    };\n  };\n  var constant = function constant(value) {\n    return function () {\n      return value;\n    };\n  };\n  var identity = function identity(x) {\n    return x;\n  };\n  var tripleEquals = function tripleEquals(a, b) {\n    return a === b;\n  };\n  function curry(fn) {\n    var initialArgs = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n      initialArgs[_i - 1] = arguments[_i];\n    }\n    return function () {\n      var restArgs = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        restArgs[_i] = arguments[_i];\n      }\n      var all = initialArgs.concat(restArgs);\n      return fn.apply(null, all);\n    };\n  }\n  var not = function not(f) {\n    return function (t) {\n      return !f(t);\n    };\n  };\n  var die = function die(msg) {\n    return function () {\n      throw new Error(msg);\n    };\n  };\n  var never = constant(false);\n  var always = constant(true);\n  var none$2 = function none$2() {\n    return NONE;\n  };\n  var NONE = function () {\n    var call = function call(thunk) {\n      return thunk();\n    };\n    var id = identity;\n    var me = {\n      fold: function fold(n, _s) {\n        return n();\n      },\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function getOrDie(msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none$2,\n      each: noop,\n      bind: none$2,\n      exists: never,\n      forall: always,\n      filter: function filter() {\n        return none$2();\n      },\n      toArray: function toArray() {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n  var _some = function some(a) {\n    var constant_a = constant(a);\n    var self = function self() {\n      return me;\n    };\n    var bind = function bind(f) {\n      return f(a);\n    };\n    var me = {\n      fold: function fold(n, s) {\n        return s(a);\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function map(f) {\n        return _some(f(a));\n      },\n      each: function each(f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function filter(f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function toArray() {\n        return [a];\n      },\n      toString: function toString() {\n        return 'some(' + a + ')';\n      }\n    };\n    return me;\n  };\n  var from$1 = function from$1(value) {\n    return value === null || value === undefined ? NONE : _some(value);\n  };\n  var Optional = {\n    some: _some,\n    none: none$2,\n    from: from$1\n  };\n  var nativeSlice = Array.prototype.slice;\n  var nativeIndexOf = Array.prototype.indexOf;\n  var nativePush = Array.prototype.push;\n  var rawIndexOf = function rawIndexOf(ts, t) {\n    return nativeIndexOf.call(ts, t);\n  };\n  var contains$2 = function contains$2(xs, x) {\n    return rawIndexOf(xs, x) > -1;\n  };\n  var exists = function exists(xs, pred) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return true;\n      }\n    }\n    return false;\n  };\n  var range$1 = function range$1(num, f) {\n    var r = [];\n    for (var i = 0; i < num; i++) {\n      r.push(f(i));\n    }\n    return r;\n  };\n  var map$1 = function map$1(xs, f) {\n    var len = xs.length;\n    var r = new Array(len);\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n    return r;\n  };\n  var each$2 = function each$2(xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n  var eachr = function eachr(xs, f) {\n    for (var i = xs.length - 1; i >= 0; i--) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n  var partition = function partition(xs, pred) {\n    var pass = [];\n    var fail = [];\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      var arr = pred(x, i) ? pass : fail;\n      arr.push(x);\n    }\n    return {\n      pass: pass,\n      fail: fail\n    };\n  };\n  var filter$2 = function filter$2(xs, pred) {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        r.push(x);\n      }\n    }\n    return r;\n  };\n  var foldr = function foldr(xs, f, acc) {\n    eachr(xs, function (x, i) {\n      acc = f(acc, x, i);\n    });\n    return acc;\n  };\n  var foldl = function foldl(xs, f, acc) {\n    each$2(xs, function (x, i) {\n      acc = f(acc, x, i);\n    });\n    return acc;\n  };\n  var findUntil = function findUntil(xs, pred, until) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return Optional.some(x);\n      } else if (until(x, i)) {\n        break;\n      }\n    }\n    return Optional.none();\n  };\n  var find$1 = function find$1(xs, pred) {\n    return findUntil(xs, pred, never);\n  };\n  var findIndex = function findIndex(xs, pred) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return Optional.some(i);\n      }\n    }\n    return Optional.none();\n  };\n  var flatten$1 = function flatten$1(xs) {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n      nativePush.apply(r, xs[i]);\n    }\n    return r;\n  };\n  var bind$2 = function bind$2(xs, f) {\n    return flatten$1(map$1(xs, f));\n  };\n  var forall = function forall(xs, pred) {\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      var x = xs[i];\n      if (pred(x, i) !== true) {\n        return false;\n      }\n    }\n    return true;\n  };\n  var reverse = function reverse(xs) {\n    var r = nativeSlice.call(xs, 0);\n    r.reverse();\n    return r;\n  };\n  var mapToObject = function mapToObject(xs, f) {\n    var r = {};\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      r[String(x)] = f(x, i);\n    }\n    return r;\n  };\n  var pure = function pure(x) {\n    return [x];\n  };\n  var sort$1 = function sort$1(xs, comparator) {\n    var copy = nativeSlice.call(xs, 0);\n    copy.sort(comparator);\n    return copy;\n  };\n  var get$d = function get$d(xs, i) {\n    return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  };\n  var head = function head(xs) {\n    return get$d(xs, 0);\n  };\n  var last$2 = function last$2(xs) {\n    return get$d(xs, xs.length - 1);\n  };\n  var findMap = function findMap(arr, f) {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n      if (r.isSome()) {\n        return r;\n      }\n    }\n    return Optional.none();\n  };\n  var _assign = function __assign() {\n    _assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n    };\n    return _assign.apply(this, arguments);\n  };\n  function __spreadArray(to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n        if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n        ar[i] = from[i];\n      }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n  }\n  var cached = function cached(f) {\n    var called = false;\n    var r;\n    return function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      if (!called) {\n        called = true;\n        r = f.apply(null, args);\n      }\n      return r;\n    };\n  };\n  var DeviceType = function DeviceType(os, browser, userAgent, mediaMatch) {\n    var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n    var isiPhone = os.isiOS() && !isiPad;\n    var isMobile = os.isiOS() || os.isAndroid();\n    var isTouch = isMobile || mediaMatch('(pointer:coarse)');\n    var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');\n    var isPhone = isiPhone || isMobile && !isTablet;\n    var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n    var isDesktop = !isPhone && !isTablet && !iOSwebview;\n    return {\n      isiPad: constant(isiPad),\n      isiPhone: constant(isiPhone),\n      isTablet: constant(isTablet),\n      isPhone: constant(isPhone),\n      isTouch: constant(isTouch),\n      isAndroid: os.isAndroid,\n      isiOS: os.isiOS,\n      isWebView: constant(iOSwebview),\n      isDesktop: constant(isDesktop)\n    };\n  };\n  var firstMatch = function firstMatch(regexes, s) {\n    for (var i = 0; i < regexes.length; i++) {\n      var x = regexes[i];\n      if (x.test(s)) {\n        return x;\n      }\n    }\n    return undefined;\n  };\n  var find = function find(regexes, agent) {\n    var r = firstMatch(regexes, agent);\n    if (!r) {\n      return {\n        major: 0,\n        minor: 0\n      };\n    }\n    var group = function group(i) {\n      return Number(agent.replace(r, '$' + i));\n    };\n    return nu$2(group(1), group(2));\n  };\n  var detect$6 = function detect$6(versionRegexes, agent) {\n    var cleanedAgent = String(agent).toLowerCase();\n    if (versionRegexes.length === 0) {\n      return unknown$2();\n    }\n    return find(versionRegexes, cleanedAgent);\n  };\n  var unknown$2 = function unknown$2() {\n    return nu$2(0, 0);\n  };\n  var nu$2 = function nu$2(major, minor) {\n    return {\n      major: major,\n      minor: minor\n    };\n  };\n  var Version = {\n    nu: nu$2,\n    detect: detect$6,\n    unknown: unknown$2\n  };\n  var detectBrowser$1 = function detectBrowser$1(browsers, userAgentData) {\n    return findMap(userAgentData.brands, function (uaBrand) {\n      var lcBrand = uaBrand.brand.toLowerCase();\n      return find$1(browsers, function (browser) {\n        var _a;\n        return lcBrand === ((_a = browser.brand) === null || _a === void 0 ? void 0 : _a.toLowerCase());\n      }).map(function (info) {\n        return {\n          current: info.name,\n          version: Version.nu(parseInt(uaBrand.version, 10), 0)\n        };\n      });\n    });\n  };\n  var detect$5 = function detect$5(candidates, userAgent) {\n    var agent = String(userAgent).toLowerCase();\n    return find$1(candidates, function (candidate) {\n      return candidate.search(agent);\n    });\n  };\n  var detectBrowser = function detectBrowser(browsers, userAgent) {\n    return detect$5(browsers, userAgent).map(function (browser) {\n      var version = Version.detect(browser.versionRegexes, userAgent);\n      return {\n        current: browser.name,\n        version: version\n      };\n    });\n  };\n  var detectOs = function detectOs(oses, userAgent) {\n    return detect$5(oses, userAgent).map(function (os) {\n      var version = Version.detect(os.versionRegexes, userAgent);\n      return {\n        current: os.name,\n        version: version\n      };\n    });\n  };\n  var removeFromStart = function removeFromStart(str, numChars) {\n    return str.substring(numChars);\n  };\n  var checkRange = function checkRange(str, substr, start) {\n    return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n  };\n  var removeLeading = function removeLeading(str, prefix) {\n    return startsWith(str, prefix) ? removeFromStart(str, prefix.length) : str;\n  };\n  var contains$1 = function contains$1(str, substr) {\n    return str.indexOf(substr) !== -1;\n  };\n  var startsWith = function startsWith(str, prefix) {\n    return checkRange(str, prefix, 0);\n  };\n  var endsWith = function endsWith(str, suffix) {\n    return checkRange(str, suffix, str.length - suffix.length);\n  };\n  var blank = function blank(r) {\n    return function (s) {\n      return s.replace(r, '');\n    };\n  };\n  var trim = blank(/^\\s+|\\s+$/g);\n  var isNotEmpty = function isNotEmpty(s) {\n    return s.length > 0;\n  };\n  var isEmpty$1 = function isEmpty$1(s) {\n    return !isNotEmpty(s);\n  };\n  var toFloat = function toFloat(value) {\n    var num = parseFloat(value);\n    return isNaN(num) ? Optional.none() : Optional.some(num);\n  };\n  var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n  var checkContains = function checkContains(target) {\n    return function (uastring) {\n      return contains$1(uastring, target);\n    };\n  };\n  var browsers = [{\n    name: 'Edge',\n    versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n    search: function search(uastring) {\n      return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');\n    }\n  }, {\n    name: 'Chrome',\n    brand: 'Chromium',\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/, normalVersionRegex],\n    search: function search(uastring) {\n      return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');\n    }\n  }, {\n    name: 'IE',\n    versionRegexes: [/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/, /.*?rv:([0-9]+)\\.([0-9]+).*/],\n    search: function search(uastring) {\n      return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');\n    }\n  }, {\n    name: 'Opera',\n    versionRegexes: [normalVersionRegex, /.*?opera\\/([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('opera')\n  }, {\n    name: 'Firefox',\n    versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('firefox')\n  }, {\n    name: 'Safari',\n    versionRegexes: [normalVersionRegex, /.*?cpu os ([0-9]+)_([0-9]+).*/],\n    search: function search(uastring) {\n      return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');\n    }\n  }];\n  var oses = [{\n    name: 'Windows',\n    search: checkContains('win'),\n    versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'iOS',\n    search: function search(uastring) {\n      return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');\n    },\n    versionRegexes: [/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/, /.*cpu iphone os ([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Android',\n    search: checkContains('android'),\n    versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'OSX',\n    search: checkContains('mac os x'),\n    versionRegexes: [/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Linux',\n    search: checkContains('linux'),\n    versionRegexes: []\n  }, {\n    name: 'Solaris',\n    search: checkContains('sunos'),\n    versionRegexes: []\n  }, {\n    name: 'FreeBSD',\n    search: checkContains('freebsd'),\n    versionRegexes: []\n  }, {\n    name: 'ChromeOS',\n    search: checkContains('cros'),\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]\n  }];\n  var PlatformInfo = {\n    browsers: constant(browsers),\n    oses: constant(oses)\n  };\n  var edge = 'Edge';\n  var chrome = 'Chrome';\n  var ie = 'IE';\n  var opera = 'Opera';\n  var firefox = 'Firefox';\n  var safari = 'Safari';\n  var unknown$1 = function unknown$1() {\n    return nu$1({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n  var nu$1 = function nu$1(info) {\n    var current = info.current;\n    var version = info.version;\n    var isBrowser = function isBrowser(name) {\n      return function () {\n        return current === name;\n      };\n    };\n    return {\n      current: current,\n      version: version,\n      isEdge: isBrowser(edge),\n      isChrome: isBrowser(chrome),\n      isIE: isBrowser(ie),\n      isOpera: isBrowser(opera),\n      isFirefox: isBrowser(firefox),\n      isSafari: isBrowser(safari)\n    };\n  };\n  var Browser = {\n    unknown: unknown$1,\n    nu: nu$1,\n    edge: constant(edge),\n    chrome: constant(chrome),\n    ie: constant(ie),\n    opera: constant(opera),\n    firefox: constant(firefox),\n    safari: constant(safari)\n  };\n  var windows = 'Windows';\n  var ios = 'iOS';\n  var android = 'Android';\n  var linux = 'Linux';\n  var osx = 'OSX';\n  var solaris = 'Solaris';\n  var freebsd = 'FreeBSD';\n  var chromeos = 'ChromeOS';\n  var unknown = function unknown() {\n    return nu({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n  var nu = function nu(info) {\n    var current = info.current;\n    var version = info.version;\n    var isOS = function isOS(name) {\n      return function () {\n        return current === name;\n      };\n    };\n    return {\n      current: current,\n      version: version,\n      isWindows: isOS(windows),\n      isiOS: isOS(ios),\n      isAndroid: isOS(android),\n      isOSX: isOS(osx),\n      isLinux: isOS(linux),\n      isSolaris: isOS(solaris),\n      isFreeBSD: isOS(freebsd),\n      isChromeOS: isOS(chromeos)\n    };\n  };\n  var OperatingSystem = {\n    unknown: unknown,\n    nu: nu,\n    windows: constant(windows),\n    ios: constant(ios),\n    android: constant(android),\n    linux: constant(linux),\n    osx: constant(osx),\n    solaris: constant(solaris),\n    freebsd: constant(freebsd),\n    chromeos: constant(chromeos)\n  };\n  var detect$4 = function detect$4(userAgent, userAgentDataOpt, mediaMatch) {\n    var browsers = PlatformInfo.browsers();\n    var oses = PlatformInfo.oses();\n    var browser = userAgentDataOpt.bind(function (userAgentData) {\n      return detectBrowser$1(browsers, userAgentData);\n    }).orThunk(function () {\n      return detectBrowser(browsers, userAgent);\n    }).fold(Browser.unknown, Browser.nu);\n    var os = detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n    var deviceType = DeviceType(os, browser, userAgent, mediaMatch);\n    return {\n      browser: browser,\n      os: os,\n      deviceType: deviceType\n    };\n  };\n  var PlatformDetection = {\n    detect: detect$4\n  };\n  var mediaMatch = function mediaMatch(query) {\n    return window.matchMedia(query).matches;\n  };\n  var platform = cached(function () {\n    return PlatformDetection.detect(navigator.userAgent, Optional.from(navigator.userAgentData), mediaMatch);\n  });\n  var detect$3 = function detect$3() {\n    return platform();\n  };\n  var compareDocumentPosition = function compareDocumentPosition(a, b, match) {\n    return (a.compareDocumentPosition(b) & match) !== 0;\n  };\n  var documentPositionContainedBy = function documentPositionContainedBy(a, b) {\n    return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);\n  };\n  var COMMENT = 8;\n  var DOCUMENT = 9;\n  var DOCUMENT_FRAGMENT = 11;\n  var ELEMENT = 1;\n  var TEXT = 3;\n  var fromHtml$1 = function fromHtml$1(html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      console.error('HTML does not have a single root node', html);\n      throw new Error('HTML must have a single root node');\n    }\n    return fromDom$1(div.childNodes[0]);\n  };\n  var fromTag = function fromTag(tag, scope) {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom$1(node);\n  };\n  var fromText = function fromText(text, scope) {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom$1(node);\n  };\n  var fromDom$1 = function fromDom$1(node) {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n    return {\n      dom: node\n    };\n  };\n  var fromPoint$1 = function fromPoint$1(docElm, x, y) {\n    return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom$1);\n  };\n  var SugarElement = {\n    fromHtml: fromHtml$1,\n    fromTag: fromTag,\n    fromText: fromText,\n    fromDom: fromDom$1,\n    fromPoint: fromPoint$1\n  };\n  var is$2 = function is$2(element, selector) {\n    var dom = element.dom;\n    if (dom.nodeType !== ELEMENT) {\n      return false;\n    } else {\n      var elem = dom;\n      if (elem.matches !== undefined) {\n        return elem.matches(selector);\n      } else if (elem.msMatchesSelector !== undefined) {\n        return elem.msMatchesSelector(selector);\n      } else if (elem.webkitMatchesSelector !== undefined) {\n        return elem.webkitMatchesSelector(selector);\n      } else if (elem.mozMatchesSelector !== undefined) {\n        return elem.mozMatchesSelector(selector);\n      } else {\n        throw new Error('Browser lacks native selectors');\n      }\n    }\n  };\n  var bypassSelector = function bypassSelector(dom) {\n    return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n  };\n  var all$1 = function all$1(selector, scope) {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? [] : map$1(base.querySelectorAll(selector), SugarElement.fromDom);\n  };\n  var one = function one(selector, scope) {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);\n  };\n  var eq$1 = function eq$1(e1, e2) {\n    return e1.dom === e2.dom;\n  };\n  var regularContains = function regularContains(e1, e2) {\n    var d1 = e1.dom;\n    var d2 = e2.dom;\n    return d1 === d2 ? false : d1.contains(d2);\n  };\n  var ieContains = function ieContains(e1, e2) {\n    return documentPositionContainedBy(e1.dom, e2.dom);\n  };\n  var contains = function contains(e1, e2) {\n    return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);\n  };\n  var is$1 = is$2;\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n  var each$1 = function each$1(obj, f) {\n    var props = keys(obj);\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n  var map = function map(obj, f) {\n    return tupleMap(obj, function (x, i) {\n      return {\n        k: i,\n        v: f(x, i)\n      };\n    });\n  };\n  var tupleMap = function tupleMap(obj, f) {\n    var r = {};\n    each$1(obj, function (x, i) {\n      var tuple = f(x, i);\n      r[tuple.k] = tuple.v;\n    });\n    return r;\n  };\n  var objAcc = function objAcc(r) {\n    return function (x, i) {\n      r[i] = x;\n    };\n  };\n  var internalFilter = function internalFilter(obj, pred, onTrue, onFalse) {\n    var r = {};\n    each$1(obj, function (x, i) {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n    return r;\n  };\n  var filter$1 = function filter$1(obj, pred) {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n  var mapToArray = function mapToArray(obj, f) {\n    var r = [];\n    each$1(obj, function (value, name) {\n      r.push(f(value, name));\n    });\n    return r;\n  };\n  var values = function values(obj) {\n    return mapToArray(obj, identity);\n  };\n  var size = function size(obj) {\n    return keys(obj).length;\n  };\n  var get$c = function get$c(obj, key) {\n    return has$1(obj, key) ? Optional.from(obj[key]) : Optional.none();\n  };\n  var has$1 = function has$1(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n  var hasNonNullableKey = function hasNonNullableKey(obj, key) {\n    return has$1(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  };\n  var isEmpty = function isEmpty(r) {\n    for (var x in r) {\n      if (hasOwnProperty.call(r, x)) {\n        return false;\n      }\n    }\n    return true;\n  };\n  var validSectionList = ['tfoot', 'thead', 'tbody', 'colgroup'];\n  var isValidSection = function isValidSection(parentName) {\n    return contains$2(validSectionList, parentName);\n  };\n  var grid = function grid(rows, columns) {\n    return {\n      rows: rows,\n      columns: columns\n    };\n  };\n  var address = function address(row, column) {\n    return {\n      row: row,\n      column: column\n    };\n  };\n  var detail = function detail(element, rowspan, colspan) {\n    return {\n      element: element,\n      rowspan: rowspan,\n      colspan: colspan\n    };\n  };\n  var detailnew = function detailnew(element, rowspan, colspan, isNew) {\n    return {\n      element: element,\n      rowspan: rowspan,\n      colspan: colspan,\n      isNew: isNew\n    };\n  };\n  var extended = function extended(element, rowspan, colspan, row, column, isLocked) {\n    return {\n      element: element,\n      rowspan: rowspan,\n      colspan: colspan,\n      row: row,\n      column: column,\n      isLocked: isLocked\n    };\n  };\n  var rowdetail = function rowdetail(element, cells, section) {\n    return {\n      element: element,\n      cells: cells,\n      section: section\n    };\n  };\n  var rowdetailnew = function rowdetailnew(element, cells, section, isNew) {\n    return {\n      element: element,\n      cells: cells,\n      section: section,\n      isNew: isNew\n    };\n  };\n  var elementnew = function elementnew(element, isNew, isLocked) {\n    return {\n      element: element,\n      isNew: isNew,\n      isLocked: isLocked\n    };\n  };\n  var rowcells = function rowcells(element, cells, section, isNew) {\n    return {\n      element: element,\n      cells: cells,\n      section: section,\n      isNew: isNew\n    };\n  };\n  var bounds = function bounds(startRow, startCol, finishRow, finishCol) {\n    return {\n      startRow: startRow,\n      startCol: startCol,\n      finishRow: finishRow,\n      finishCol: finishCol\n    };\n  };\n  var columnext = function columnext(element, colspan, column) {\n    return {\n      element: element,\n      colspan: colspan,\n      column: column\n    };\n  };\n  var colgroup = function colgroup(element, columns) {\n    return {\n      element: element,\n      columns: columns\n    };\n  };\n  typeof window !== 'undefined' ? window : Function('return this;')();\n  var name = function name(element) {\n    var r = element.dom.nodeName;\n    return r.toLowerCase();\n  };\n  var type$1 = function type$1(element) {\n    return element.dom.nodeType;\n  };\n  var isType = function isType(t) {\n    return function (element) {\n      return type$1(element) === t;\n    };\n  };\n  var isComment = function isComment(element) {\n    return type$1(element) === COMMENT || name(element) === '#comment';\n  };\n  var isElement = isType(ELEMENT);\n  var isText = isType(TEXT);\n  var isDocument = isType(DOCUMENT);\n  var isDocumentFragment = isType(DOCUMENT_FRAGMENT);\n  var isTag = function isTag(tag) {\n    return function (e) {\n      return isElement(e) && name(e) === tag;\n    };\n  };\n  var owner = function owner(element) {\n    return SugarElement.fromDom(element.dom.ownerDocument);\n  };\n  var documentOrOwner = function documentOrOwner(dos) {\n    return isDocument(dos) ? dos : owner(dos);\n  };\n  var defaultView = function defaultView(element) {\n    return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);\n  };\n  var parent = function parent(element) {\n    return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n  };\n  var parentElement = function parentElement(element) {\n    return Optional.from(element.dom.parentElement).map(SugarElement.fromDom);\n  };\n  var parents = function parents(element, isRoot) {\n    var stop = isFunction(isRoot) ? isRoot : never;\n    var dom = element.dom;\n    var ret = [];\n    while (dom.parentNode !== null && dom.parentNode !== undefined) {\n      var rawParent = dom.parentNode;\n      var p = SugarElement.fromDom(rawParent);\n      ret.push(p);\n      if (stop(p) === true) {\n        break;\n      } else {\n        dom = rawParent;\n      }\n    }\n    return ret;\n  };\n  var prevSibling = function prevSibling(element) {\n    return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);\n  };\n  var nextSibling = function nextSibling(element) {\n    return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);\n  };\n  var children$3 = function children$3(element) {\n    return map$1(element.dom.childNodes, SugarElement.fromDom);\n  };\n  var child$3 = function child$3(element, index) {\n    var cs = element.dom.childNodes;\n    return Optional.from(cs[index]).map(SugarElement.fromDom);\n  };\n  var firstChild = function firstChild(element) {\n    return child$3(element, 0);\n  };\n  var isShadowRoot = function isShadowRoot(dos) {\n    return isDocumentFragment(dos) && isNonNullable(dos.dom.host);\n  };\n  var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);\n  var isSupported$1 = constant(supported);\n  var getRootNode = supported ? function (e) {\n    return SugarElement.fromDom(e.dom.getRootNode());\n  } : documentOrOwner;\n  var getShadowRoot = function getShadowRoot(e) {\n    var r = getRootNode(e);\n    return isShadowRoot(r) ? Optional.some(r) : Optional.none();\n  };\n  var getShadowHost = function getShadowHost(e) {\n    return SugarElement.fromDom(e.dom.host);\n  };\n  var getOriginalEventTarget = function getOriginalEventTarget(event) {\n    if (isSupported$1() && isNonNullable(event.target)) {\n      var el = SugarElement.fromDom(event.target);\n      if (isElement(el) && isOpenShadowHost(el)) {\n        if (event.composed && event.composedPath) {\n          var composedPath = event.composedPath();\n          if (composedPath) {\n            return head(composedPath);\n          }\n        }\n      }\n    }\n    return Optional.from(event.target);\n  };\n  var isOpenShadowHost = function isOpenShadowHost(element) {\n    return isNonNullable(element.dom.shadowRoot);\n  };\n  var _inBody = function inBody(element) {\n    var dom = isText(element) ? element.dom.parentNode : element.dom;\n    if (dom === undefined || dom === null || dom.ownerDocument === null) {\n      return false;\n    }\n    var doc = dom.ownerDocument;\n    return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {\n      return doc.body.contains(dom);\n    }, compose1(_inBody, getShadowHost));\n  };\n  var body$1 = function body$1() {\n    return getBody$1(SugarElement.fromDom(document));\n  };\n  var getBody$1 = function getBody$1(doc) {\n    var b = doc.dom.body;\n    if (b === null || b === undefined) {\n      throw new Error('Body is not available yet');\n    }\n    return SugarElement.fromDom(b);\n  };\n  var ancestors$4 = function ancestors$4(scope, predicate, isRoot) {\n    return filter$2(parents(scope, isRoot), predicate);\n  };\n  var children$2 = function children$2(scope, predicate) {\n    return filter$2(children$3(scope), predicate);\n  };\n  var _descendants$ = function descendants$1(scope, predicate) {\n    var result = [];\n    each$2(children$3(scope), function (x) {\n      if (predicate(x)) {\n        result = result.concat([x]);\n      }\n      result = result.concat(_descendants$(x, predicate));\n    });\n    return result;\n  };\n  var ancestors$3 = function ancestors$3(scope, selector, isRoot) {\n    return ancestors$4(scope, function (e) {\n      return is$2(e, selector);\n    }, isRoot);\n  };\n  var children$1 = function children$1(scope, selector) {\n    return children$2(scope, function (e) {\n      return is$2(e, selector);\n    });\n  };\n  var descendants = function descendants(scope, selector) {\n    return all$1(selector, scope);\n  };\n  function ClosestOrAncestor(is, ancestor, scope, a, isRoot) {\n    if (is(scope, a)) {\n      return Optional.some(scope);\n    } else if (isFunction(isRoot) && isRoot(scope)) {\n      return Optional.none();\n    } else {\n      return ancestor(scope, a, isRoot);\n    }\n  }\n  var ancestor$2 = function ancestor$2(scope, predicate, isRoot) {\n    var element = scope.dom;\n    var stop = isFunction(isRoot) ? isRoot : never;\n    while (element.parentNode) {\n      element = element.parentNode;\n      var el = SugarElement.fromDom(element);\n      if (predicate(el)) {\n        return Optional.some(el);\n      } else if (stop(el)) {\n        break;\n      }\n    }\n    return Optional.none();\n  };\n  var closest$2 = function closest$2(scope, predicate, isRoot) {\n    var is = function is(s, test) {\n      return test(s);\n    };\n    return ClosestOrAncestor(is, ancestor$2, scope, predicate, isRoot);\n  };\n  var child$2 = function child$2(scope, predicate) {\n    var pred = function pred(node) {\n      return predicate(SugarElement.fromDom(node));\n    };\n    var result = find$1(scope.dom.childNodes, pred);\n    return result.map(SugarElement.fromDom);\n  };\n  var descendant$1 = function descendant$1(scope, predicate) {\n    var _descend = function descend(node) {\n      for (var i = 0; i < node.childNodes.length; i++) {\n        var child_1 = SugarElement.fromDom(node.childNodes[i]);\n        if (predicate(child_1)) {\n          return Optional.some(child_1);\n        }\n        var res = _descend(node.childNodes[i]);\n        if (res.isSome()) {\n          return res;\n        }\n      }\n      return Optional.none();\n    };\n    return _descend(scope.dom);\n  };\n  var ancestor$1 = function ancestor$1(scope, selector, isRoot) {\n    return ancestor$2(scope, function (e) {\n      return is$2(e, selector);\n    }, isRoot);\n  };\n  var child$1 = function child$1(scope, selector) {\n    return child$2(scope, function (e) {\n      return is$2(e, selector);\n    });\n  };\n  var descendant = function descendant(scope, selector) {\n    return one(selector, scope);\n  };\n  var closest$1 = function closest$1(scope, selector, isRoot) {\n    var is = function is(element, selector) {\n      return is$2(element, selector);\n    };\n    return ClosestOrAncestor(is, ancestor$1, scope, selector, isRoot);\n  };\n  var rawSet = function rawSet(dom, key, value) {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n  var set$2 = function set$2(element, key, value) {\n    rawSet(element.dom, key, value);\n  };\n  var setAll$1 = function setAll$1(element, attrs) {\n    var dom = element.dom;\n    each$1(attrs, function (v, k) {\n      rawSet(dom, k, v);\n    });\n  };\n  var setOptions = function setOptions(element, attrs) {\n    each$1(attrs, function (v, k) {\n      v.fold(function () {\n        remove$7(element, k);\n      }, function (value) {\n        rawSet(element.dom, k, value);\n      });\n    });\n  };\n  var get$b = function get$b(element, key) {\n    var v = element.dom.getAttribute(key);\n    return v === null ? undefined : v;\n  };\n  var getOpt = function getOpt(element, key) {\n    return Optional.from(get$b(element, key));\n  };\n  var remove$7 = function remove$7(element, key) {\n    element.dom.removeAttribute(key);\n  };\n  var clone$2 = function clone$2(element) {\n    return foldl(element.dom.attributes, function (acc, attr) {\n      acc[attr.name] = attr.value;\n      return acc;\n    }, {});\n  };\n  var is = function is(lhs, rhs, comparator) {\n    if (comparator === void 0) {\n      comparator = tripleEquals;\n    }\n    return lhs.exists(function (left) {\n      return comparator(left, rhs);\n    });\n  };\n  var cat = function cat(arr) {\n    var r = [];\n    var push = function push(x) {\n      r.push(x);\n    };\n    for (var i = 0; i < arr.length; i++) {\n      arr[i].each(push);\n    }\n    return r;\n  };\n  var lift2 = function lift2(oa, ob, f) {\n    return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();\n  };\n  var bindFrom = function bindFrom(a, f) {\n    return a !== undefined && a !== null ? f(a) : Optional.none();\n  };\n  var flatten = function flatten(oot) {\n    return oot.bind(identity);\n  };\n  var someIf = function someIf(b, a) {\n    return b ? Optional.some(a) : Optional.none();\n  };\n  var isSupported = function isSupported(dom) {\n    return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n  };\n  var internalSet = function internalSet(dom, property, value) {\n    if (!isString(value)) {\n      console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n      throw new Error('CSS value must be a string: ' + value);\n    }\n    if (isSupported(dom)) {\n      dom.style.setProperty(property, value);\n    }\n  };\n  var internalRemove = function internalRemove(dom, property) {\n    if (isSupported(dom)) {\n      dom.style.removeProperty(property);\n    }\n  };\n  var set$1 = function set$1(element, property, value) {\n    var dom = element.dom;\n    internalSet(dom, property, value);\n  };\n  var setAll = function setAll(element, css) {\n    var dom = element.dom;\n    each$1(css, function (v, k) {\n      internalSet(dom, k, v);\n    });\n  };\n  var get$a = function get$a(element, property) {\n    var dom = element.dom;\n    var styles = window.getComputedStyle(dom);\n    var r = styles.getPropertyValue(property);\n    return r === '' && !_inBody(element) ? getUnsafeProperty(dom, property) : r;\n  };\n  var getUnsafeProperty = function getUnsafeProperty(dom, property) {\n    return isSupported(dom) ? dom.style.getPropertyValue(property) : '';\n  };\n  var getRaw$2 = function getRaw$2(element, property) {\n    var dom = element.dom;\n    var raw = getUnsafeProperty(dom, property);\n    return Optional.from(raw).filter(function (r) {\n      return r.length > 0;\n    });\n  };\n  var remove$6 = function remove$6(element, property) {\n    var dom = element.dom;\n    internalRemove(dom, property);\n    if (is(getOpt(element, 'style').map(trim), '')) {\n      remove$7(element, 'style');\n    }\n  };\n  var copy$2 = function copy$2(source, target) {\n    var sourceDom = source.dom;\n    var targetDom = target.dom;\n    if (isSupported(sourceDom) && isSupported(targetDom)) {\n      targetDom.style.cssText = sourceDom.style.cssText;\n    }\n  };\n  var getAttrValue = function getAttrValue(cell, name, fallback) {\n    if (fallback === void 0) {\n      fallback = 0;\n    }\n    return getOpt(cell, name).map(function (value) {\n      return parseInt(value, 10);\n    }).getOr(fallback);\n  };\n  var getSpan = function getSpan(cell, type) {\n    return getAttrValue(cell, type, 1);\n  };\n  var hasColspan = function hasColspan(cellOrCol) {\n    if (isTag('col')(cellOrCol)) {\n      return getAttrValue(cellOrCol, 'span', 1) > 1;\n    } else {\n      return getSpan(cellOrCol, 'colspan') > 1;\n    }\n  };\n  var hasRowspan = function hasRowspan(cell) {\n    return getSpan(cell, 'rowspan') > 1;\n  };\n  var getCssValue = function getCssValue(element, property) {\n    return parseInt(get$a(element, property), 10);\n  };\n  var minWidth = constant(10);\n  var minHeight = constant(10);\n  var firstLayer = function firstLayer(scope, selector) {\n    return _filterFirstLayer(scope, selector, always);\n  };\n  var _filterFirstLayer = function filterFirstLayer(scope, selector, predicate) {\n    return bind$2(children$3(scope), function (x) {\n      if (is$2(x, selector)) {\n        return predicate(x) ? [x] : [];\n      } else {\n        return _filterFirstLayer(x, selector, predicate);\n      }\n    });\n  };\n  var lookup = function lookup(tags, element, isRoot) {\n    if (isRoot === void 0) {\n      isRoot = never;\n    }\n    if (isRoot(element)) {\n      return Optional.none();\n    }\n    if (contains$2(tags, name(element))) {\n      return Optional.some(element);\n    }\n    var isRootOrUpperTable = function isRootOrUpperTable(elm) {\n      return is$2(elm, 'table') || isRoot(elm);\n    };\n    return ancestor$1(element, tags.join(','), isRootOrUpperTable);\n  };\n  var cell = function cell(element, isRoot) {\n    return lookup(['td', 'th'], element, isRoot);\n  };\n  var cells$1 = function cells$1(ancestor) {\n    return firstLayer(ancestor, 'th,td');\n  };\n  var columns$1 = function columns$1(ancestor) {\n    if (is$2(ancestor, 'colgroup')) {\n      return children$1(ancestor, 'col');\n    } else {\n      return bind$2(columnGroups(ancestor), function (columnGroup) {\n        return children$1(columnGroup, 'col');\n      });\n    }\n  };\n  var table = function table(element, isRoot) {\n    return closest$1(element, 'table', isRoot);\n  };\n  var rows$1 = function rows$1(ancestor) {\n    return firstLayer(ancestor, 'tr');\n  };\n  var columnGroups = function columnGroups(ancestor) {\n    return table(ancestor).fold(constant([]), function (table) {\n      return children$1(table, 'colgroup');\n    });\n  };\n  var fromRowsOrColGroups = function fromRowsOrColGroups(elems, getSection) {\n    return map$1(elems, function (row) {\n      if (name(row) === 'colgroup') {\n        var cells = map$1(columns$1(row), function (column) {\n          var colspan = getAttrValue(column, 'span', 1);\n          return detail(column, 1, colspan);\n        });\n        return rowdetail(row, cells, 'colgroup');\n      } else {\n        var cells = map$1(cells$1(row), function (cell) {\n          var rowspan = getAttrValue(cell, 'rowspan', 1);\n          var colspan = getAttrValue(cell, 'colspan', 1);\n          return detail(cell, rowspan, colspan);\n        });\n        return rowdetail(row, cells, getSection(row));\n      }\n    });\n  };\n  var getParentSection = function getParentSection(group) {\n    return parent(group).map(function (parent) {\n      var parentName = name(parent);\n      return isValidSection(parentName) ? parentName : 'tbody';\n    }).getOr('tbody');\n  };\n  var fromTable$1 = function fromTable$1(table) {\n    var rows = rows$1(table);\n    var columnGroups$1 = columnGroups(table);\n    var elems = __spreadArray(__spreadArray([], columnGroups$1, true), rows, true);\n    return fromRowsOrColGroups(elems, getParentSection);\n  };\n  var fromPastedRows = function fromPastedRows(elems, section) {\n    return fromRowsOrColGroups(elems, function () {\n      return section;\n    });\n  };\n  var addCells = function addCells(gridRow, index, cells) {\n    var existingCells = gridRow.cells;\n    var before = existingCells.slice(0, index);\n    var after = existingCells.slice(index);\n    var newCells = before.concat(cells).concat(after);\n    return setCells(gridRow, newCells);\n  };\n  var addCell = function addCell(gridRow, index, cell) {\n    return addCells(gridRow, index, [cell]);\n  };\n  var mutateCell = function mutateCell(gridRow, index, cell) {\n    var cells = gridRow.cells;\n    cells[index] = cell;\n  };\n  var setCells = function setCells(gridRow, cells) {\n    return rowcells(gridRow.element, cells, gridRow.section, gridRow.isNew);\n  };\n  var mapCells = function mapCells(gridRow, f) {\n    var cells = gridRow.cells;\n    var r = map$1(cells, f);\n    return rowcells(gridRow.element, r, gridRow.section, gridRow.isNew);\n  };\n  var getCell = function getCell(gridRow, index) {\n    return gridRow.cells[index];\n  };\n  var getCellElement = function getCellElement(gridRow, index) {\n    return getCell(gridRow, index).element;\n  };\n  var cellLength = function cellLength(gridRow) {\n    return gridRow.cells.length;\n  };\n  var extractGridDetails = function extractGridDetails(grid) {\n    var result = partition(grid, function (row) {\n      return row.section === 'colgroup';\n    });\n    return {\n      rows: result.fail,\n      cols: result.pass\n    };\n  };\n  var clone$1 = function clone$1(gridRow, cloneRow, cloneCell) {\n    var newCells = map$1(gridRow.cells, cloneCell);\n    return rowcells(cloneRow(gridRow.element), newCells, gridRow.section, true);\n  };\n  var LOCKED_COL_ATTR = 'data-snooker-locked-cols';\n  var getLockedColumnsFromTable = function getLockedColumnsFromTable(table) {\n    return getOpt(table, LOCKED_COL_ATTR).bind(function (lockedColStr) {\n      return Optional.from(lockedColStr.match(/\\d+/g));\n    }).map(function (lockedCols) {\n      return mapToObject(lockedCols, always);\n    });\n  };\n  var getLockedColumnsFromGrid = function getLockedColumnsFromGrid(grid) {\n    var locked = foldl(extractGridDetails(grid).rows, function (acc, row) {\n      each$2(row.cells, function (cell, idx) {\n        if (cell.isLocked) {\n          acc[idx] = true;\n        }\n      });\n      return acc;\n    }, {});\n    var lockedArr = mapToArray(locked, function (_val, key) {\n      return parseInt(key, 10);\n    });\n    return sort$1(lockedArr);\n  };\n  var key = function key(row, column) {\n    return row + ',' + column;\n  };\n  var getAt = function getAt(warehouse, row, column) {\n    return Optional.from(warehouse.access[key(row, column)]);\n  };\n  var findItem = function findItem(warehouse, item, comparator) {\n    var filtered = filterItems(warehouse, function (detail) {\n      return comparator(item, detail.element);\n    });\n    return filtered.length > 0 ? Optional.some(filtered[0]) : Optional.none();\n  };\n  var filterItems = function filterItems(warehouse, predicate) {\n    var all = bind$2(warehouse.all, function (r) {\n      return r.cells;\n    });\n    return filter$2(all, predicate);\n  };\n  var generateColumns = function generateColumns(rowData) {\n    var columnsGroup = {};\n    var index = 0;\n    each$2(rowData.cells, function (column) {\n      var colspan = column.colspan;\n      range$1(colspan, function (columnIndex) {\n        var colIndex = index + columnIndex;\n        columnsGroup[colIndex] = columnext(column.element, colspan, colIndex);\n      });\n      index += colspan;\n    });\n    return columnsGroup;\n  };\n  var generate$1 = function generate$1(list) {\n    var access = {};\n    var cells = [];\n    var tableOpt = head(list).map(function (rowData) {\n      return rowData.element;\n    }).bind(table);\n    var lockedColumns = tableOpt.bind(getLockedColumnsFromTable).getOr({});\n    var maxRows = 0;\n    var maxColumns = 0;\n    var rowCount = 0;\n    var _a = partition(list, function (rowData) {\n        return rowData.section === 'colgroup';\n      }),\n      colgroupRows = _a.pass,\n      rows = _a.fail;\n    each$2(rows, function (rowData) {\n      var currentRow = [];\n      each$2(rowData.cells, function (rowCell) {\n        var start = 0;\n        while (access[key(rowCount, start)] !== undefined) {\n          start++;\n        }\n        var isLocked = hasNonNullableKey(lockedColumns, start.toString());\n        var current = extended(rowCell.element, rowCell.rowspan, rowCell.colspan, rowCount, start, isLocked);\n        for (var occupiedColumnPosition = 0; occupiedColumnPosition < rowCell.colspan; occupiedColumnPosition++) {\n          for (var occupiedRowPosition = 0; occupiedRowPosition < rowCell.rowspan; occupiedRowPosition++) {\n            var rowPosition = rowCount + occupiedRowPosition;\n            var columnPosition = start + occupiedColumnPosition;\n            var newpos = key(rowPosition, columnPosition);\n            access[newpos] = current;\n            maxColumns = Math.max(maxColumns, columnPosition + 1);\n          }\n        }\n        currentRow.push(current);\n      });\n      maxRows++;\n      cells.push(rowdetail(rowData.element, currentRow, rowData.section));\n      rowCount++;\n    });\n    var _b = last$2(colgroupRows).map(function (rowData) {\n        var columns = generateColumns(rowData);\n        var colgroup$1 = colgroup(rowData.element, values(columns));\n        return {\n          colgroups: [colgroup$1],\n          columns: columns\n        };\n      }).getOrThunk(function () {\n        return {\n          colgroups: [],\n          columns: {}\n        };\n      }),\n      columns = _b.columns,\n      colgroups = _b.colgroups;\n    var grid$1 = grid(maxRows, maxColumns);\n    return {\n      grid: grid$1,\n      access: access,\n      all: cells,\n      columns: columns,\n      colgroups: colgroups\n    };\n  };\n  var fromTable = function fromTable(table) {\n    var list = fromTable$1(table);\n    return generate$1(list);\n  };\n  var justCells = function justCells(warehouse) {\n    return bind$2(warehouse.all, function (w) {\n      return w.cells;\n    });\n  };\n  var justColumns = function justColumns(warehouse) {\n    return values(warehouse.columns);\n  };\n  var hasColumns = function hasColumns(warehouse) {\n    return keys(warehouse.columns).length > 0;\n  };\n  var getColumnAt = function getColumnAt(warehouse, columnIndex) {\n    return Optional.from(warehouse.columns[columnIndex]);\n  };\n  var Warehouse = {\n    fromTable: fromTable,\n    generate: generate$1,\n    getAt: getAt,\n    findItem: findItem,\n    filterItems: filterItems,\n    justCells: justCells,\n    justColumns: justColumns,\n    hasColumns: hasColumns,\n    getColumnAt: getColumnAt\n  };\n  var inSelection = function inSelection(bounds, detail) {\n    var leftEdge = detail.column;\n    var rightEdge = detail.column + detail.colspan - 1;\n    var topEdge = detail.row;\n    var bottomEdge = detail.row + detail.rowspan - 1;\n    return leftEdge <= bounds.finishCol && rightEdge >= bounds.startCol && topEdge <= bounds.finishRow && bottomEdge >= bounds.startRow;\n  };\n  var isWithin = function isWithin(bounds, detail) {\n    return detail.column >= bounds.startCol && detail.column + detail.colspan - 1 <= bounds.finishCol && detail.row >= bounds.startRow && detail.row + detail.rowspan - 1 <= bounds.finishRow;\n  };\n  var isRectangular = function isRectangular(warehouse, bounds) {\n    var isRect = true;\n    var detailIsWithin = curry(isWithin, bounds);\n    for (var i = bounds.startRow; i <= bounds.finishRow; i++) {\n      for (var j = bounds.startCol; j <= bounds.finishCol; j++) {\n        isRect = isRect && Warehouse.getAt(warehouse, i, j).exists(detailIsWithin);\n      }\n    }\n    return isRect ? Optional.some(bounds) : Optional.none();\n  };\n  var getBounds = function getBounds(detailA, detailB) {\n    return bounds(Math.min(detailA.row, detailB.row), Math.min(detailA.column, detailB.column), Math.max(detailA.row + detailA.rowspan - 1, detailB.row + detailB.rowspan - 1), Math.max(detailA.column + detailA.colspan - 1, detailB.column + detailB.colspan - 1));\n  };\n  var getAnyBox = function getAnyBox(warehouse, startCell, finishCell) {\n    var startCoords = Warehouse.findItem(warehouse, startCell, eq$1);\n    var finishCoords = Warehouse.findItem(warehouse, finishCell, eq$1);\n    return startCoords.bind(function (sc) {\n      return finishCoords.map(function (fc) {\n        return getBounds(sc, fc);\n      });\n    });\n  };\n  var getBox$1 = function getBox$1(warehouse, startCell, finishCell) {\n    return getAnyBox(warehouse, startCell, finishCell).bind(function (bounds) {\n      return isRectangular(warehouse, bounds);\n    });\n  };\n  var moveBy$1 = function moveBy$1(warehouse, cell, row, column) {\n    return Warehouse.findItem(warehouse, cell, eq$1).bind(function (detail) {\n      var startRow = row > 0 ? detail.row + detail.rowspan - 1 : detail.row;\n      var startCol = column > 0 ? detail.column + detail.colspan - 1 : detail.column;\n      var dest = Warehouse.getAt(warehouse, startRow + row, startCol + column);\n      return dest.map(function (d) {\n        return d.element;\n      });\n    });\n  };\n  var intercepts$1 = function intercepts$1(warehouse, start, finish) {\n    return getAnyBox(warehouse, start, finish).map(function (bounds) {\n      var inside = Warehouse.filterItems(warehouse, curry(inSelection, bounds));\n      return map$1(inside, function (detail) {\n        return detail.element;\n      });\n    });\n  };\n  var parentCell = function parentCell(warehouse, innerCell) {\n    var isContainedBy = function isContainedBy(c1, c2) {\n      return contains(c2, c1);\n    };\n    return Warehouse.findItem(warehouse, innerCell, isContainedBy).map(function (detail) {\n      return detail.element;\n    });\n  };\n  var moveBy = function moveBy(cell, deltaRow, deltaColumn) {\n    return table(cell).bind(function (table) {\n      var warehouse = getWarehouse(table);\n      return moveBy$1(warehouse, cell, deltaRow, deltaColumn);\n    });\n  };\n  var intercepts = function intercepts(table, first, last) {\n    var warehouse = getWarehouse(table);\n    return intercepts$1(warehouse, first, last);\n  };\n  var nestedIntercepts = function nestedIntercepts(table, first, firstTable, last, lastTable) {\n    var warehouse = getWarehouse(table);\n    var optStartCell = eq$1(table, firstTable) ? Optional.some(first) : parentCell(warehouse, first);\n    var optLastCell = eq$1(table, lastTable) ? Optional.some(last) : parentCell(warehouse, last);\n    return optStartCell.bind(function (startCell) {\n      return optLastCell.bind(function (lastCell) {\n        return intercepts$1(warehouse, startCell, lastCell);\n      });\n    });\n  };\n  var getBox = function getBox(table, first, last) {\n    var warehouse = getWarehouse(table);\n    return getBox$1(warehouse, first, last);\n  };\n  var getWarehouse = Warehouse.fromTable;\n  var before$4 = function before$4(marker, element) {\n    var parent$1 = parent(marker);\n    parent$1.each(function (v) {\n      v.dom.insertBefore(element.dom, marker.dom);\n    });\n  };\n  var after$5 = function after$5(marker, element) {\n    var sibling = nextSibling(marker);\n    sibling.fold(function () {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        append$1(v, element);\n      });\n    }, function (v) {\n      before$4(v, element);\n    });\n  };\n  var prepend = function prepend(parent, element) {\n    var firstChild$1 = firstChild(parent);\n    firstChild$1.fold(function () {\n      append$1(parent, element);\n    }, function (v) {\n      parent.dom.insertBefore(element.dom, v.dom);\n    });\n  };\n  var append$1 = function append$1(parent, element) {\n    parent.dom.appendChild(element.dom);\n  };\n  var appendAt = function appendAt(parent, element, index) {\n    child$3(parent, index).fold(function () {\n      append$1(parent, element);\n    }, function (v) {\n      before$4(v, element);\n    });\n  };\n  var wrap = function wrap(element, wrapper) {\n    before$4(element, wrapper);\n    append$1(wrapper, element);\n  };\n  var before$3 = function before$3(marker, elements) {\n    each$2(elements, function (x) {\n      before$4(marker, x);\n    });\n  };\n  var after$4 = function after$4(marker, elements) {\n    each$2(elements, function (x, i) {\n      var e = i === 0 ? marker : elements[i - 1];\n      after$5(e, x);\n    });\n  };\n  var append = function append(parent, elements) {\n    each$2(elements, function (x) {\n      append$1(parent, x);\n    });\n  };\n  var empty = function empty(element) {\n    element.dom.textContent = '';\n    each$2(children$3(element), function (rogue) {\n      remove$5(rogue);\n    });\n  };\n  var remove$5 = function remove$5(element) {\n    var dom = element.dom;\n    if (dom.parentNode !== null) {\n      dom.parentNode.removeChild(dom);\n    }\n  };\n  var unwrap = function unwrap(wrapper) {\n    var children = children$3(wrapper);\n    if (children.length > 0) {\n      before$3(wrapper, children);\n    }\n    remove$5(wrapper);\n  };\n  var NodeValue = function NodeValue(is, name) {\n    var get = function get(element) {\n      if (!is(element)) {\n        throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n      }\n      return getOption(element).getOr('');\n    };\n    var getOption = function getOption(element) {\n      return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n    };\n    var set = function set(element, value) {\n      if (!is(element)) {\n        throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n      }\n      element.dom.nodeValue = value;\n    };\n    return {\n      get: get,\n      getOption: getOption,\n      set: set\n    };\n  };\n  var api$2 = NodeValue(isText, 'text');\n  var get$9 = function get$9(element) {\n    return api$2.get(element);\n  };\n  var getOption = function getOption(element) {\n    return api$2.getOption(element);\n  };\n  var set = function set(element, value) {\n    return api$2.set(element, value);\n  };\n  var TagBoundaries = ['body', 'p', 'div', 'article', 'aside', 'figcaption', 'figure', 'footer', 'header', 'nav', 'section', 'ol', 'ul', 'li', 'table', 'thead', 'tbody', 'tfoot', 'caption', 'tr', 'td', 'th', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'address'];\n  function DomUniverse() {\n    var clone = function clone(element) {\n      return SugarElement.fromDom(element.dom.cloneNode(false));\n    };\n    var document = function document(element) {\n      return documentOrOwner(element).dom;\n    };\n    var isBoundary = function isBoundary(element) {\n      if (!isElement(element)) {\n        return false;\n      }\n      if (name(element) === 'body') {\n        return true;\n      }\n      return contains$2(TagBoundaries, name(element));\n    };\n    var isEmptyTag = function isEmptyTag(element) {\n      if (!isElement(element)) {\n        return false;\n      }\n      return contains$2(['br', 'img', 'hr', 'input'], name(element));\n    };\n    var isNonEditable = function isNonEditable(element) {\n      return isElement(element) && get$b(element, 'contenteditable') === 'false';\n    };\n    var comparePosition = function comparePosition(element, other) {\n      return element.dom.compareDocumentPosition(other.dom);\n    };\n    var copyAttributesTo = function copyAttributesTo(source, destination) {\n      var as = clone$2(source);\n      setAll$1(destination, as);\n    };\n    var isSpecial = function isSpecial(element) {\n      var tag = name(element);\n      return contains$2(['script', 'noscript', 'iframe', 'noframes', 'noembed', 'title', 'style', 'textarea', 'xmp'], tag);\n    };\n    var getLanguage = function getLanguage(element) {\n      return isElement(element) ? getOpt(element, 'lang') : Optional.none();\n    };\n    return {\n      up: constant({\n        selector: ancestor$1,\n        closest: closest$1,\n        predicate: ancestor$2,\n        all: parents\n      }),\n      down: constant({\n        selector: descendants,\n        predicate: _descendants$\n      }),\n      styles: constant({\n        get: get$a,\n        getRaw: getRaw$2,\n        set: set$1,\n        remove: remove$6\n      }),\n      attrs: constant({\n        get: get$b,\n        set: set$2,\n        remove: remove$7,\n        copyTo: copyAttributesTo\n      }),\n      insert: constant({\n        before: before$4,\n        after: after$5,\n        afterAll: after$4,\n        append: append$1,\n        appendAll: append,\n        prepend: prepend,\n        wrap: wrap\n      }),\n      remove: constant({\n        unwrap: unwrap,\n        remove: remove$5\n      }),\n      create: constant({\n        nu: SugarElement.fromTag,\n        clone: clone,\n        text: SugarElement.fromText\n      }),\n      query: constant({\n        comparePosition: comparePosition,\n        prevSibling: prevSibling,\n        nextSibling: nextSibling\n      }),\n      property: constant({\n        children: children$3,\n        name: name,\n        parent: parent,\n        document: document,\n        isText: isText,\n        isComment: isComment,\n        isElement: isElement,\n        isSpecial: isSpecial,\n        getLanguage: getLanguage,\n        getText: get$9,\n        setText: set,\n        isBoundary: isBoundary,\n        isEmptyTag: isEmptyTag,\n        isNonEditable: isNonEditable\n      }),\n      eq: eq$1,\n      is: is$1\n    };\n  }\n  var all = function all(universe, look, elements, f) {\n    var head = elements[0];\n    var tail = elements.slice(1);\n    return f(universe, look, head, tail);\n  };\n  var oneAll = function oneAll(universe, look, elements) {\n    return elements.length > 0 ? all(universe, look, elements, unsafeOne) : Optional.none();\n  };\n  var unsafeOne = function unsafeOne(universe, look, head, tail) {\n    var start = look(universe, head);\n    return foldr(tail, function (b, a) {\n      var current = look(universe, a);\n      return commonElement(universe, b, current);\n    }, start);\n  };\n  var commonElement = function commonElement(universe, start, end) {\n    return start.bind(function (s) {\n      return end.filter(curry(universe.eq, s));\n    });\n  };\n  var eq = function eq(universe, item) {\n    return curry(universe.eq, item);\n  };\n  var ancestors$2 = function ancestors$2(universe, start, end, isRoot) {\n    if (isRoot === void 0) {\n      isRoot = never;\n    }\n    var ps1 = [start].concat(universe.up().all(start));\n    var ps2 = [end].concat(universe.up().all(end));\n    var prune = function prune(path) {\n      var index = findIndex(path, isRoot);\n      return index.fold(function () {\n        return path;\n      }, function (ind) {\n        return path.slice(0, ind + 1);\n      });\n    };\n    var pruned1 = prune(ps1);\n    var pruned2 = prune(ps2);\n    var shared = find$1(pruned1, function (x) {\n      return exists(pruned2, eq(universe, x));\n    });\n    return {\n      firstpath: pruned1,\n      secondpath: pruned2,\n      shared: shared\n    };\n  };\n  var sharedOne$1 = oneAll;\n  var ancestors$1 = ancestors$2;\n  var universe$3 = DomUniverse();\n  var sharedOne = function sharedOne(look, elements) {\n    return sharedOne$1(universe$3, function (_universe, element) {\n      return look(element);\n    }, elements);\n  };\n  var ancestors = function ancestors(start, finish, isRoot) {\n    return ancestors$1(universe$3, start, finish, isRoot);\n  };\n  var lookupTable = function lookupTable(container) {\n    return ancestor$1(container, 'table');\n  };\n  var identify = function identify(start, finish, isRoot) {\n    var getIsRoot = function getIsRoot(rootTable) {\n      return function (element) {\n        return isRoot !== undefined && isRoot(element) || eq$1(element, rootTable);\n      };\n    };\n    if (eq$1(start, finish)) {\n      return Optional.some({\n        boxes: Optional.some([start]),\n        start: start,\n        finish: finish\n      });\n    } else {\n      return lookupTable(start).bind(function (startTable) {\n        return lookupTable(finish).bind(function (finishTable) {\n          if (eq$1(startTable, finishTable)) {\n            return Optional.some({\n              boxes: intercepts(startTable, start, finish),\n              start: start,\n              finish: finish\n            });\n          } else if (contains(startTable, finishTable)) {\n            var ancestorCells = ancestors$3(finish, 'td,th', getIsRoot(startTable));\n            var finishCell = ancestorCells.length > 0 ? ancestorCells[ancestorCells.length - 1] : finish;\n            return Optional.some({\n              boxes: nestedIntercepts(startTable, start, startTable, finish, finishTable),\n              start: start,\n              finish: finishCell\n            });\n          } else if (contains(finishTable, startTable)) {\n            var ancestorCells = ancestors$3(start, 'td,th', getIsRoot(finishTable));\n            var startCell = ancestorCells.length > 0 ? ancestorCells[ancestorCells.length - 1] : start;\n            return Optional.some({\n              boxes: nestedIntercepts(finishTable, start, startTable, finish, finishTable),\n              start: start,\n              finish: startCell\n            });\n          } else {\n            return ancestors(start, finish).shared.bind(function (lca) {\n              return closest$1(lca, 'table', isRoot).bind(function (lcaTable) {\n                var finishAncestorCells = ancestors$3(finish, 'td,th', getIsRoot(lcaTable));\n                var finishCell = finishAncestorCells.length > 0 ? finishAncestorCells[finishAncestorCells.length - 1] : finish;\n                var startAncestorCells = ancestors$3(start, 'td,th', getIsRoot(lcaTable));\n                var startCell = startAncestorCells.length > 0 ? startAncestorCells[startAncestorCells.length - 1] : start;\n                return Optional.some({\n                  boxes: nestedIntercepts(lcaTable, start, startTable, finish, finishTable),\n                  start: startCell,\n                  finish: finishCell\n                });\n              });\n            });\n          }\n        });\n      });\n    }\n  };\n  var retrieve$1 = function retrieve$1(container, selector) {\n    var sels = descendants(container, selector);\n    return sels.length > 0 ? Optional.some(sels) : Optional.none();\n  };\n  var getLast = function getLast(boxes, lastSelectedSelector) {\n    return find$1(boxes, function (box) {\n      return is$2(box, lastSelectedSelector);\n    });\n  };\n  var getEdges = function getEdges(container, firstSelectedSelector, lastSelectedSelector) {\n    return descendant(container, firstSelectedSelector).bind(function (first) {\n      return descendant(container, lastSelectedSelector).bind(function (last) {\n        return sharedOne(lookupTable, [first, last]).map(function (table) {\n          return {\n            first: first,\n            last: last,\n            table: table\n          };\n        });\n      });\n    });\n  };\n  var expandTo = function expandTo(finish, firstSelectedSelector) {\n    return ancestor$1(finish, 'table').bind(function (table) {\n      return descendant(table, firstSelectedSelector).bind(function (start) {\n        return identify(start, finish).bind(function (identified) {\n          return identified.boxes.map(function (boxes) {\n            return {\n              boxes: boxes,\n              start: identified.start,\n              finish: identified.finish\n            };\n          });\n        });\n      });\n    });\n  };\n  var shiftSelection = function shiftSelection(boxes, deltaRow, deltaColumn, firstSelectedSelector, lastSelectedSelector) {\n    return getLast(boxes, lastSelectedSelector).bind(function (last) {\n      return moveBy(last, deltaRow, deltaColumn).bind(function (finish) {\n        return expandTo(finish, firstSelectedSelector);\n      });\n    });\n  };\n  var retrieve = function retrieve(container, selector) {\n    return retrieve$1(container, selector);\n  };\n  var retrieveBox = function retrieveBox(container, firstSelectedSelector, lastSelectedSelector) {\n    return getEdges(container, firstSelectedSelector, lastSelectedSelector).bind(function (edges) {\n      var isRoot = function isRoot(ancestor) {\n        return eq$1(container, ancestor);\n      };\n      var sectionSelector = 'thead,tfoot,tbody,table';\n      var firstAncestor = ancestor$1(edges.first, sectionSelector, isRoot);\n      var lastAncestor = ancestor$1(edges.last, sectionSelector, isRoot);\n      return firstAncestor.bind(function (fA) {\n        return lastAncestor.bind(function (lA) {\n          return eq$1(fA, lA) ? getBox(edges.table, edges.first, edges.last) : Optional.none();\n        });\n      });\n    });\n  };\n  var generate = function generate(cases) {\n    if (!isArray(cases)) {\n      throw new Error('cases must be an array');\n    }\n    if (cases.length === 0) {\n      throw new Error('there must be at least one case');\n    }\n    var constructors = [];\n    var adt = {};\n    each$2(cases, function (acase, count) {\n      var keys$1 = keys(acase);\n      if (keys$1.length !== 1) {\n        throw new Error('one and only one name per case');\n      }\n      var key = keys$1[0];\n      var value = acase[key];\n      if (adt[key] !== undefined) {\n        throw new Error('duplicate key detected:' + key);\n      } else if (key === 'cata') {\n        throw new Error('cannot have a case named cata (sorry)');\n      } else if (!isArray(value)) {\n        throw new Error('case arguments must be an array');\n      }\n      constructors.push(key);\n      adt[key] = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        var argLength = args.length;\n        if (argLength !== value.length) {\n          throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n        }\n        var match = function match(branches) {\n          var branchKeys = keys(branches);\n          if (constructors.length !== branchKeys.length) {\n            throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n          }\n          var allReqd = forall(constructors, function (reqKey) {\n            return contains$2(branchKeys, reqKey);\n          });\n          if (!allReqd) {\n            throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n          }\n          return branches[key].apply(null, args);\n        };\n        return {\n          fold: function fold() {\n            var foldArgs = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n              foldArgs[_i] = arguments[_i];\n            }\n            if (foldArgs.length !== cases.length) {\n              throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + foldArgs.length);\n            }\n            var target = foldArgs[count];\n            return target.apply(null, args);\n          },\n          match: match,\n          log: function log(label) {\n            console.log(label, {\n              constructors: constructors,\n              constructor: key,\n              params: args\n            });\n          }\n        };\n      };\n    });\n    return adt;\n  };\n  var Adt = {\n    generate: generate\n  };\n  var type = Adt.generate([{\n    none: []\n  }, {\n    multiple: ['elements']\n  }, {\n    single: ['element']\n  }]);\n  var cata$2 = function cata$2(subject, onNone, onMultiple, onSingle) {\n    return subject.fold(onNone, onMultiple, onSingle);\n  };\n  var none$1 = type.none;\n  var multiple = type.multiple;\n  var single = type.single;\n  var Selections = function Selections(lazyRoot, getStart, selectedSelector) {\n    var get = function get() {\n      return retrieve(lazyRoot(), selectedSelector).fold(function () {\n        return getStart().fold(none$1, single);\n      }, function (cells) {\n        return multiple(cells);\n      });\n    };\n    return {\n      get: get\n    };\n  };\n  var global$3 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var clone = function clone(original, isDeep) {\n    return SugarElement.fromDom(original.dom.cloneNode(isDeep));\n  };\n  var shallow = function shallow(original) {\n    return clone(original, false);\n  };\n  var deep = function deep(original) {\n    return clone(original, true);\n  };\n  var shallowAs = function shallowAs(original, tag) {\n    var nu = SugarElement.fromTag(tag);\n    var attributes = clone$2(original);\n    setAll$1(nu, attributes);\n    return nu;\n  };\n  var copy$1 = function copy$1(original, tag) {\n    var nu = shallowAs(original, tag);\n    var cloneChildren = children$3(deep(original));\n    append(nu, cloneChildren);\n    return nu;\n  };\n  var mutate$1 = function mutate$1(original, tag) {\n    var nu = shallowAs(original, tag);\n    before$4(original, nu);\n    var children = children$3(original);\n    append(nu, children);\n    remove$5(original);\n    return nu;\n  };\n  var Dimension = function Dimension(name, getOffset) {\n    var set = function set(element, h) {\n      if (!isNumber(h) && !h.match(/^[0-9]+$/)) {\n        throw new Error(name + '.set accepts only positive integer values. Value was ' + h);\n      }\n      var dom = element.dom;\n      if (isSupported(dom)) {\n        dom.style[name] = h + 'px';\n      }\n    };\n    var get = function get(element) {\n      var r = getOffset(element);\n      if (r <= 0 || r === null) {\n        var css = get$a(element, name);\n        return parseFloat(css) || 0;\n      }\n      return r;\n    };\n    var getOuter = get;\n    var aggregate = function aggregate(element, properties) {\n      return foldl(properties, function (acc, property) {\n        var val = get$a(element, property);\n        var value = val === undefined ? 0 : parseInt(val, 10);\n        return isNaN(value) ? acc : acc + value;\n      }, 0);\n    };\n    var max = function max(element, value, properties) {\n      var cumulativeInclusions = aggregate(element, properties);\n      var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;\n      return absoluteMax;\n    };\n    return {\n      set: set,\n      get: get,\n      getOuter: getOuter,\n      aggregate: aggregate,\n      max: max\n    };\n  };\n  var needManualCalc = function needManualCalc() {\n    var browser = detect$3().browser;\n    return browser.isIE() || browser.isEdge();\n  };\n  var toNumber = function toNumber(px, fallback) {\n    return toFloat(px).getOr(fallback);\n  };\n  var getProp = function getProp(element, name, fallback) {\n    return toNumber(get$a(element, name), fallback);\n  };\n  var getBoxSizing = function getBoxSizing(element) {\n    return get$a(element, 'box-sizing');\n  };\n  var calcContentBoxSize = function calcContentBoxSize(element, size, upper, lower) {\n    var paddingUpper = getProp(element, 'padding-' + upper, 0);\n    var paddingLower = getProp(element, 'padding-' + lower, 0);\n    var borderUpper = getProp(element, 'border-' + upper + '-width', 0);\n    var borderLower = getProp(element, 'border-' + lower + '-width', 0);\n    return size - paddingUpper - paddingLower - borderUpper - borderLower;\n  };\n  var getCalculatedHeight = function getCalculatedHeight(element, boxSizing) {\n    var dom = element.dom;\n    var height = dom.getBoundingClientRect().height || dom.offsetHeight;\n    return boxSizing === 'border-box' ? height : calcContentBoxSize(element, height, 'top', 'bottom');\n  };\n  var getCalculatedWidth = function getCalculatedWidth(element, boxSizing) {\n    var dom = element.dom;\n    var width = dom.getBoundingClientRect().width || dom.offsetWidth;\n    return boxSizing === 'border-box' ? width : calcContentBoxSize(element, width, 'left', 'right');\n  };\n  var getHeight$1 = function getHeight$1(element) {\n    return needManualCalc() ? getCalculatedHeight(element, getBoxSizing(element)) : getProp(element, 'height', element.dom.offsetHeight);\n  };\n  var getWidth = function getWidth(element) {\n    return needManualCalc() ? getCalculatedWidth(element, getBoxSizing(element)) : getProp(element, 'width', element.dom.offsetWidth);\n  };\n  var getInnerWidth = function getInnerWidth(element) {\n    return getCalculatedWidth(element, 'content-box');\n  };\n  var api$1 = Dimension('width', function (element) {\n    return element.dom.offsetWidth;\n  });\n  var get$8 = function get$8(element) {\n    return api$1.get(element);\n  };\n  var getOuter$2 = function getOuter$2(element) {\n    return api$1.getOuter(element);\n  };\n  var getInner = getInnerWidth;\n  var getRuntime$1 = getWidth;\n  var columns = function columns(warehouse, isValidCell) {\n    if (isValidCell === void 0) {\n      isValidCell = always;\n    }\n    var grid = warehouse.grid;\n    var cols = range$1(grid.columns, identity);\n    var rowsArr = range$1(grid.rows, identity);\n    return map$1(cols, function (col) {\n      var getBlock = function getBlock() {\n        return bind$2(rowsArr, function (r) {\n          return Warehouse.getAt(warehouse, r, col).filter(function (detail) {\n            return detail.column === col;\n          }).toArray();\n        });\n      };\n      var isValid = function isValid(detail) {\n        return detail.colspan === 1 && isValidCell(detail.element);\n      };\n      var getFallback = function getFallback() {\n        return Warehouse.getAt(warehouse, 0, col);\n      };\n      return decide(getBlock, isValid, getFallback);\n    });\n  };\n  var decide = function decide(getBlock, isValid, getFallback) {\n    var inBlock = getBlock();\n    var validInBlock = find$1(inBlock, isValid);\n    var detailOption = validInBlock.orThunk(function () {\n      return Optional.from(inBlock[0]).orThunk(getFallback);\n    });\n    return detailOption.map(function (detail) {\n      return detail.element;\n    });\n  };\n  var rows = function rows(warehouse) {\n    var grid = warehouse.grid;\n    var rowsArr = range$1(grid.rows, identity);\n    var cols = range$1(grid.columns, identity);\n    return map$1(rowsArr, function (row) {\n      var getBlock = function getBlock() {\n        return bind$2(cols, function (c) {\n          return Warehouse.getAt(warehouse, row, c).filter(function (detail) {\n            return detail.row === row;\n          }).fold(constant([]), function (detail) {\n            return [detail];\n          });\n        });\n      };\n      var isSingle = function isSingle(detail) {\n        return detail.rowspan === 1;\n      };\n      var getFallback = function getFallback() {\n        return Warehouse.getAt(warehouse, row, 0);\n      };\n      return decide(getBlock, isSingle, getFallback);\n    });\n  };\n  var deduce = function deduce(xs, index) {\n    if (index < 0 || index >= xs.length - 1) {\n      return Optional.none();\n    }\n    var current = xs[index].fold(function () {\n      var rest = reverse(xs.slice(0, index));\n      return findMap(rest, function (a, i) {\n        return a.map(function (aa) {\n          return {\n            value: aa,\n            delta: i + 1\n          };\n        });\n      });\n    }, function (c) {\n      return Optional.some({\n        value: c,\n        delta: 0\n      });\n    });\n    var next = xs[index + 1].fold(function () {\n      var rest = xs.slice(index + 1);\n      return findMap(rest, function (a, i) {\n        return a.map(function (aa) {\n          return {\n            value: aa,\n            delta: i + 1\n          };\n        });\n      });\n    }, function (n) {\n      return Optional.some({\n        value: n,\n        delta: 1\n      });\n    });\n    return current.bind(function (c) {\n      return next.map(function (n) {\n        var extras = n.delta + c.delta;\n        return Math.abs(n.value - c.value) / extras;\n      });\n    });\n  };\n  var onDirection = function onDirection(isLtr, isRtl) {\n    return function (element) {\n      return getDirection(element) === 'rtl' ? isRtl : isLtr;\n    };\n  };\n  var getDirection = function getDirection(element) {\n    return get$a(element, 'direction') === 'rtl' ? 'rtl' : 'ltr';\n  };\n  var api = Dimension('height', function (element) {\n    var dom = element.dom;\n    return _inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;\n  });\n  var get$7 = function get$7(element) {\n    return api.get(element);\n  };\n  var getOuter$1 = function getOuter$1(element) {\n    return api.getOuter(element);\n  };\n  var getRuntime = getHeight$1;\n  var _r = function r(left, top) {\n    var translate = function translate(x, y) {\n      return _r(left + x, top + y);\n    };\n    return {\n      left: left,\n      top: top,\n      translate: translate\n    };\n  };\n  var SugarPosition = _r;\n  var boxPosition = function boxPosition(dom) {\n    var box = dom.getBoundingClientRect();\n    return SugarPosition(box.left, box.top);\n  };\n  var firstDefinedOrZero = function firstDefinedOrZero(a, b) {\n    if (a !== undefined) {\n      return a;\n    } else {\n      return b !== undefined ? b : 0;\n    }\n  };\n  var absolute = function absolute(element) {\n    var doc = element.dom.ownerDocument;\n    var body = doc.body;\n    var win = doc.defaultView;\n    var html = doc.documentElement;\n    if (body === element.dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n    var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);\n    var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);\n    var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);\n    var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);\n    return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);\n  };\n  var viewport = function viewport(element) {\n    var dom = element.dom;\n    var doc = dom.ownerDocument;\n    var body = doc.body;\n    if (body === dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n    if (!_inBody(element)) {\n      return SugarPosition(0, 0);\n    }\n    return boxPosition(dom);\n  };\n  var rowInfo = function rowInfo(row, y) {\n    return {\n      row: row,\n      y: y\n    };\n  };\n  var colInfo = function colInfo(col, x) {\n    return {\n      col: col,\n      x: x\n    };\n  };\n  var rtlEdge = function rtlEdge(cell) {\n    var pos = absolute(cell);\n    return pos.left + getOuter$2(cell);\n  };\n  var ltrEdge = function ltrEdge(cell) {\n    return absolute(cell).left;\n  };\n  var getLeftEdge = function getLeftEdge(index, cell) {\n    return colInfo(index, ltrEdge(cell));\n  };\n  var getRightEdge = function getRightEdge(index, cell) {\n    return colInfo(index, rtlEdge(cell));\n  };\n  var getTop$1 = function getTop$1(cell) {\n    return absolute(cell).top;\n  };\n  var getTopEdge = function getTopEdge(index, cell) {\n    return rowInfo(index, getTop$1(cell));\n  };\n  var getBottomEdge = function getBottomEdge(index, cell) {\n    return rowInfo(index, getTop$1(cell) + getOuter$1(cell));\n  };\n  var findPositions = function findPositions(getInnerEdge, getOuterEdge, array) {\n    if (array.length === 0) {\n      return [];\n    }\n    var lines = map$1(array.slice(1), function (cellOption, index) {\n      return cellOption.map(function (cell) {\n        return getInnerEdge(index, cell);\n      });\n    });\n    var lastLine = array[array.length - 1].map(function (cell) {\n      return getOuterEdge(array.length - 1, cell);\n    });\n    return lines.concat([lastLine]);\n  };\n  var negate = function negate(step) {\n    return -step;\n  };\n  var height = {\n    delta: identity,\n    positions: function positions(optElements) {\n      return findPositions(getTopEdge, getBottomEdge, optElements);\n    },\n    edge: getTop$1\n  };\n  var ltr$1 = {\n    delta: identity,\n    edge: ltrEdge,\n    positions: function positions(optElements) {\n      return findPositions(getLeftEdge, getRightEdge, optElements);\n    }\n  };\n  var rtl$1 = {\n    delta: negate,\n    edge: rtlEdge,\n    positions: function positions(optElements) {\n      return findPositions(getRightEdge, getLeftEdge, optElements);\n    }\n  };\n  var detect$2 = onDirection(ltr$1, rtl$1);\n  var width = {\n    delta: function delta(amount, table) {\n      return detect$2(table).delta(amount, table);\n    },\n    positions: function positions(cols, table) {\n      return detect$2(table).positions(cols, table);\n    },\n    edge: function edge(cell) {\n      return detect$2(cell).edge(cell);\n    }\n  };\n  var units = {\n    unsupportedLength: ['em', 'ex', 'cap', 'ch', 'ic', 'rem', 'lh', 'rlh', 'vw', 'vh', 'vi', 'vb', 'vmin', 'vmax', 'cm', 'mm', 'Q', 'in', 'pc', 'pt', 'px'],\n    fixed: ['px', 'pt'],\n    relative: ['%'],\n    empty: ['']\n  };\n  var pattern = function () {\n    var decimalDigits = '[0-9]+';\n    var signedInteger = '[+-]?' + decimalDigits;\n    var exponentPart = '[eE]' + signedInteger;\n    var dot = '\\\\.';\n    var opt = function opt(input) {\n      return '(?:' + input + ')?';\n    };\n    var unsignedDecimalLiteral = ['Infinity', decimalDigits + dot + opt(decimalDigits) + opt(exponentPart), dot + decimalDigits + opt(exponentPart), decimalDigits + opt(exponentPart)].join('|');\n    var float = '[+-]?(?:' + unsignedDecimalLiteral + ')';\n    return new RegExp('^(' + float + ')(.*)$');\n  }();\n  var isUnit = function isUnit(unit, accepted) {\n    return exists(accepted, function (acc) {\n      return exists(units[acc], function (check) {\n        return unit === check;\n      });\n    });\n  };\n  var parse = function parse(input, accepted) {\n    var match = Optional.from(pattern.exec(input));\n    return match.bind(function (array) {\n      var value = Number(array[1]);\n      var unitRaw = array[2];\n      if (isUnit(unitRaw, accepted)) {\n        return Optional.some({\n          value: value,\n          unit: unitRaw\n        });\n      } else {\n        return Optional.none();\n      }\n    });\n  };\n  var rPercentageBasedSizeRegex = /(\\d+(\\.\\d+)?)%/;\n  var rPixelBasedSizeRegex = /(\\d+(\\.\\d+)?)px|em/;\n  var isCol$2 = isTag('col');\n  var getPercentSize = function getPercentSize(elm, outerGetter, innerGetter) {\n    var relativeParent = parentElement(elm).getOrThunk(function () {\n      return getBody$1(owner(elm));\n    });\n    return outerGetter(elm) / innerGetter(relativeParent) * 100;\n  };\n  var setPixelWidth = function setPixelWidth(cell, amount) {\n    set$1(cell, 'width', amount + 'px');\n  };\n  var setPercentageWidth = function setPercentageWidth(cell, amount) {\n    set$1(cell, 'width', amount + '%');\n  };\n  var setHeight = function setHeight(cell, amount) {\n    set$1(cell, 'height', amount + 'px');\n  };\n  var getHeightValue = function getHeightValue(cell) {\n    return getRuntime(cell) + 'px';\n  };\n  var convert = function convert(cell, number, getter, setter) {\n    var newSize = table(cell).map(function (table) {\n      var total = getter(table);\n      return Math.floor(number / 100 * total);\n    }).getOr(number);\n    setter(cell, newSize);\n    return newSize;\n  };\n  var normalizePixelSize = function normalizePixelSize(value, cell, getter, setter) {\n    var number = parseFloat(value);\n    return endsWith(value, '%') && name(cell) !== 'table' ? convert(cell, number, getter, setter) : number;\n  };\n  var getTotalHeight = function getTotalHeight(cell) {\n    var value = getHeightValue(cell);\n    if (!value) {\n      return get$7(cell);\n    }\n    return normalizePixelSize(value, cell, get$7, setHeight);\n  };\n  var get$6 = function get$6(cell, type, f) {\n    var v = f(cell);\n    var span = getSpan(cell, type);\n    return v / span;\n  };\n  var getRaw$1 = function getRaw$1(element, prop) {\n    return getRaw$2(element, prop).orThunk(function () {\n      return getOpt(element, prop).map(function (val) {\n        return val + 'px';\n      });\n    });\n  };\n  var getRawWidth$1 = function getRawWidth$1(element) {\n    return getRaw$1(element, 'width');\n  };\n  var getRawHeight = function getRawHeight(element) {\n    return getRaw$1(element, 'height');\n  };\n  var getPercentageWidth = function getPercentageWidth(cell) {\n    return getPercentSize(cell, get$8, getInner);\n  };\n  var getPixelWidth$1 = function getPixelWidth$1(cell) {\n    return isCol$2(cell) ? get$8(cell) : getRuntime$1(cell);\n  };\n  var getHeight = function getHeight(cell) {\n    return get$6(cell, 'rowspan', getTotalHeight);\n  };\n  var getGenericWidth = function getGenericWidth(cell) {\n    var width = getRawWidth$1(cell);\n    return width.bind(function (w) {\n      return parse(w, ['fixed', 'relative', 'empty']);\n    });\n  };\n  var setGenericWidth = function setGenericWidth(cell, amount, unit) {\n    set$1(cell, 'width', amount + unit);\n  };\n  var getPixelTableWidth = function getPixelTableWidth(table) {\n    return get$8(table) + 'px';\n  };\n  var getPercentTableWidth = function getPercentTableWidth(table) {\n    return getPercentSize(table, get$8, getInner) + '%';\n  };\n  var isPercentSizing$1 = function isPercentSizing$1(table) {\n    return getRawWidth$1(table).exists(function (size) {\n      return rPercentageBasedSizeRegex.test(size);\n    });\n  };\n  var isPixelSizing$1 = function isPixelSizing$1(table) {\n    return getRawWidth$1(table).exists(function (size) {\n      return rPixelBasedSizeRegex.test(size);\n    });\n  };\n  var isNoneSizing$1 = function isNoneSizing$1(table) {\n    return getRawWidth$1(table).isNone();\n  };\n  var percentageBasedSizeRegex = constant(rPercentageBasedSizeRegex);\n  var isCol$1 = isTag('col');\n  var getRawW = function getRawW(cell) {\n    return getRawWidth$1(cell).getOrThunk(function () {\n      return getPixelWidth$1(cell) + 'px';\n    });\n  };\n  var getRawH = function getRawH(cell) {\n    return getRawHeight(cell).getOrThunk(function () {\n      return getHeight(cell) + 'px';\n    });\n  };\n  var justCols = function justCols(warehouse) {\n    return map$1(Warehouse.justColumns(warehouse), function (column) {\n      return Optional.from(column.element);\n    });\n  };\n  var isValidColumn = function isValidColumn(cell) {\n    var browser = detect$3().browser;\n    var supportsColWidths = browser.isChrome() || browser.isFirefox();\n    return isCol$1(cell) ? supportsColWidths : true;\n  };\n  var getDimension = function getDimension(cellOpt, index, backups, filter, getter, fallback) {\n    return cellOpt.filter(filter).fold(function () {\n      return fallback(deduce(backups, index));\n    }, function (cell) {\n      return getter(cell);\n    });\n  };\n  var getWidthFrom = function getWidthFrom(warehouse, table, getWidth, fallback) {\n    var columnCells = columns(warehouse);\n    var columns$1 = Warehouse.hasColumns(warehouse) ? justCols(warehouse) : columnCells;\n    var backups = [Optional.some(width.edge(table))].concat(map$1(width.positions(columnCells, table), function (pos) {\n      return pos.map(function (p) {\n        return p.x;\n      });\n    }));\n    var colFilter = not(hasColspan);\n    return map$1(columns$1, function (cellOption, c) {\n      return getDimension(cellOption, c, backups, colFilter, function (column) {\n        if (isValidColumn(column)) {\n          return getWidth(column);\n        } else {\n          var cell = bindFrom(columnCells[c], identity);\n          return getDimension(cell, c, backups, colFilter, function (cell) {\n            return fallback(Optional.some(get$8(cell)));\n          }, fallback);\n        }\n      }, fallback);\n    });\n  };\n  var getDeduced = function getDeduced(deduced) {\n    return deduced.map(function (d) {\n      return d + 'px';\n    }).getOr('');\n  };\n  var getRawWidths = function getRawWidths(warehouse, table) {\n    return getWidthFrom(warehouse, table, getRawW, getDeduced);\n  };\n  var getPercentageWidths = function getPercentageWidths(warehouse, table, tableSize) {\n    return getWidthFrom(warehouse, table, getPercentageWidth, function (deduced) {\n      return deduced.fold(function () {\n        return tableSize.minCellWidth();\n      }, function (cellWidth) {\n        return cellWidth / tableSize.pixelWidth() * 100;\n      });\n    });\n  };\n  var getPixelWidths = function getPixelWidths(warehouse, table, tableSize) {\n    return getWidthFrom(warehouse, table, getPixelWidth$1, function (deduced) {\n      return deduced.getOrThunk(tableSize.minCellWidth);\n    });\n  };\n  var getHeightFrom = function getHeightFrom(warehouse, table, direction, getHeight, fallback) {\n    var rows$1 = rows(warehouse);\n    var backups = [Optional.some(direction.edge(table))].concat(map$1(direction.positions(rows$1, table), function (pos) {\n      return pos.map(function (p) {\n        return p.y;\n      });\n    }));\n    return map$1(rows$1, function (cellOption, c) {\n      return getDimension(cellOption, c, backups, not(hasRowspan), getHeight, fallback);\n    });\n  };\n  var getPixelHeights = function getPixelHeights(warehouse, table, direction) {\n    return getHeightFrom(warehouse, table, direction, getHeight, function (deduced) {\n      return deduced.getOrThunk(minHeight);\n    });\n  };\n  var getRawHeights = function getRawHeights(warehouse, table, direction) {\n    return getHeightFrom(warehouse, table, direction, getRawH, getDeduced);\n  };\n  var widthLookup = function widthLookup(table, getter) {\n    return function () {\n      if (_inBody(table)) {\n        return getter(table);\n      } else {\n        return parseFloat(getRaw$2(table, 'width').getOr('0'));\n      }\n    };\n  };\n  var noneSize = function noneSize(table) {\n    var getWidth = widthLookup(table, get$8);\n    var zero = constant(0);\n    var getWidths = function getWidths(warehouse, tableSize) {\n      return getPixelWidths(warehouse, table, tableSize);\n    };\n    return {\n      width: getWidth,\n      pixelWidth: getWidth,\n      getWidths: getWidths,\n      getCellDelta: zero,\n      singleColumnWidth: constant([0]),\n      minCellWidth: zero,\n      setElementWidth: noop,\n      adjustTableWidth: noop,\n      isRelative: true,\n      label: 'none'\n    };\n  };\n  var percentageSize = function percentageSize(table) {\n    var getFloatWidth = widthLookup(table, function (elem) {\n      return parseFloat(getPercentTableWidth(elem));\n    });\n    var getWidth = widthLookup(table, get$8);\n    var getCellDelta = function getCellDelta(delta) {\n      return delta / getWidth() * 100;\n    };\n    var singleColumnWidth = function singleColumnWidth(w, _delta) {\n      return [100 - w];\n    };\n    var minCellWidth = function minCellWidth() {\n      return minWidth() / getWidth() * 100;\n    };\n    var adjustTableWidth = function adjustTableWidth(delta) {\n      var currentWidth = getFloatWidth();\n      var change = delta / 100 * currentWidth;\n      var newWidth = currentWidth + change;\n      setPercentageWidth(table, newWidth);\n    };\n    var getWidths = function getWidths(warehouse, tableSize) {\n      return getPercentageWidths(warehouse, table, tableSize);\n    };\n    return {\n      width: getFloatWidth,\n      pixelWidth: getWidth,\n      getWidths: getWidths,\n      getCellDelta: getCellDelta,\n      singleColumnWidth: singleColumnWidth,\n      minCellWidth: minCellWidth,\n      setElementWidth: setPercentageWidth,\n      adjustTableWidth: adjustTableWidth,\n      isRelative: true,\n      label: 'percent'\n    };\n  };\n  var pixelSize = function pixelSize(table) {\n    var getWidth = widthLookup(table, get$8);\n    var getCellDelta = identity;\n    var singleColumnWidth = function singleColumnWidth(w, delta) {\n      var newNext = Math.max(minWidth(), w + delta);\n      return [newNext - w];\n    };\n    var adjustTableWidth = function adjustTableWidth(delta) {\n      var newWidth = getWidth() + delta;\n      setPixelWidth(table, newWidth);\n    };\n    var getWidths = function getWidths(warehouse, tableSize) {\n      return getPixelWidths(warehouse, table, tableSize);\n    };\n    return {\n      width: getWidth,\n      pixelWidth: getWidth,\n      getWidths: getWidths,\n      getCellDelta: getCellDelta,\n      singleColumnWidth: singleColumnWidth,\n      minCellWidth: minWidth,\n      setElementWidth: setPixelWidth,\n      adjustTableWidth: adjustTableWidth,\n      isRelative: false,\n      label: 'pixel'\n    };\n  };\n  var chooseSize = function chooseSize(element, width) {\n    var percentMatch = percentageBasedSizeRegex().exec(width);\n    if (percentMatch !== null) {\n      return percentageSize(element);\n    } else {\n      return pixelSize(element);\n    }\n  };\n  var getTableSize = function getTableSize(table) {\n    var width = getRawWidth$1(table);\n    return width.fold(function () {\n      return noneSize(table);\n    }, function (w) {\n      return chooseSize(table, w);\n    });\n  };\n  var TableSize = {\n    getTableSize: getTableSize,\n    pixelSize: pixelSize,\n    percentageSize: percentageSize,\n    noneSize: noneSize\n  };\n  var statsStruct = function statsStruct(minRow, minCol, maxRow, maxCol, allCells, selectedCells) {\n    return {\n      minRow: minRow,\n      minCol: minCol,\n      maxRow: maxRow,\n      maxCol: maxCol,\n      allCells: allCells,\n      selectedCells: selectedCells\n    };\n  };\n  var findSelectedStats = function findSelectedStats(house, isSelected) {\n    var totalColumns = house.grid.columns;\n    var totalRows = house.grid.rows;\n    var minRow = totalRows;\n    var minCol = totalColumns;\n    var maxRow = 0;\n    var maxCol = 0;\n    var allCells = [];\n    var selectedCells = [];\n    each$1(house.access, function (detail) {\n      allCells.push(detail);\n      if (isSelected(detail)) {\n        selectedCells.push(detail);\n        var startRow = detail.row;\n        var endRow = startRow + detail.rowspan - 1;\n        var startCol = detail.column;\n        var endCol = startCol + detail.colspan - 1;\n        if (startRow < minRow) {\n          minRow = startRow;\n        } else if (endRow > maxRow) {\n          maxRow = endRow;\n        }\n        if (startCol < minCol) {\n          minCol = startCol;\n        } else if (endCol > maxCol) {\n          maxCol = endCol;\n        }\n      }\n    });\n    return statsStruct(minRow, minCol, maxRow, maxCol, allCells, selectedCells);\n  };\n  var makeCell = function makeCell(list, seenSelected, rowIndex) {\n    var row = list[rowIndex].element;\n    var td = SugarElement.fromTag('td');\n    append$1(td, SugarElement.fromTag('br'));\n    var f = seenSelected ? append$1 : prepend;\n    f(row, td);\n  };\n  var fillInGaps = function fillInGaps(list, house, stats, isSelected) {\n    var totalColumns = house.grid.columns;\n    var totalRows = house.grid.rows;\n    for (var i = 0; i < totalRows; i++) {\n      var seenSelected = false;\n      for (var j = 0; j < totalColumns; j++) {\n        if (!(i < stats.minRow || i > stats.maxRow || j < stats.minCol || j > stats.maxCol)) {\n          var needCell = Warehouse.getAt(house, i, j).filter(isSelected).isNone();\n          if (needCell) {\n            makeCell(list, seenSelected, i);\n          } else {\n            seenSelected = true;\n          }\n        }\n      }\n    }\n  };\n  var clean = function clean(replica, stats, house, widthDelta) {\n    each$1(house.columns, function (col) {\n      if (col.column < stats.minCol || col.column > stats.maxCol) {\n        remove$5(col.element);\n      }\n    });\n    var emptyRows = filter$2(firstLayer(replica, 'tr'), function (row) {\n      return row.dom.childElementCount === 0;\n    });\n    each$2(emptyRows, remove$5);\n    if (stats.minCol === stats.maxCol || stats.minRow === stats.maxRow) {\n      each$2(firstLayer(replica, 'th,td'), function (cell) {\n        remove$7(cell, 'rowspan');\n        remove$7(cell, 'colspan');\n      });\n    }\n    remove$7(replica, LOCKED_COL_ATTR);\n    remove$7(replica, 'data-snooker-col-series');\n    var tableSize = TableSize.getTableSize(replica);\n    tableSize.adjustTableWidth(widthDelta);\n  };\n  var getTableWidthDelta = function getTableWidthDelta(table, warehouse, tableSize, stats) {\n    if (stats.minCol === 0 && warehouse.grid.columns === stats.maxCol + 1) {\n      return 0;\n    }\n    var colWidths = getPixelWidths(warehouse, table, tableSize);\n    var allColsWidth = foldl(colWidths, function (acc, width) {\n      return acc + width;\n    }, 0);\n    var selectedColsWidth = foldl(colWidths.slice(stats.minCol, stats.maxCol + 1), function (acc, width) {\n      return acc + width;\n    }, 0);\n    var newWidth = selectedColsWidth / allColsWidth * tableSize.pixelWidth();\n    var delta = newWidth - tableSize.pixelWidth();\n    return tableSize.getCellDelta(delta);\n  };\n  var extract$1 = function extract$1(table, selectedSelector) {\n    var isSelected = function isSelected(detail) {\n      return is$2(detail.element, selectedSelector);\n    };\n    var replica = deep(table);\n    var list = fromTable$1(replica);\n    var tableSize = TableSize.getTableSize(table);\n    var replicaHouse = Warehouse.generate(list);\n    var replicaStats = findSelectedStats(replicaHouse, isSelected);\n    var selector = 'th:not(' + selectedSelector + ')' + ',td:not(' + selectedSelector + ')';\n    var unselectedCells = _filterFirstLayer(replica, 'th,td', function (cell) {\n      return is$2(cell, selector);\n    });\n    each$2(unselectedCells, remove$5);\n    fillInGaps(list, replicaHouse, replicaStats, isSelected);\n    var house = Warehouse.fromTable(table);\n    var widthDelta = getTableWidthDelta(table, house, tableSize, replicaStats);\n    clean(replica, replicaStats, replicaHouse, widthDelta);\n    return replica;\n  };\n  var nbsp = '\\xA0';\n  var getEnd = function getEnd(element) {\n    return name(element) === 'img' ? 1 : getOption(element).fold(function () {\n      return children$3(element).length;\n    }, function (v) {\n      return v.length;\n    });\n  };\n  var isTextNodeWithCursorPosition = function isTextNodeWithCursorPosition(el) {\n    return getOption(el).filter(function (text) {\n      return text.trim().length !== 0 || text.indexOf(nbsp) > -1;\n    }).isSome();\n  };\n  var elementsWithCursorPosition = ['img', 'br'];\n  var isCursorPosition = function isCursorPosition(elem) {\n    var hasCursorPosition = isTextNodeWithCursorPosition(elem);\n    return hasCursorPosition || contains$2(elementsWithCursorPosition, name(elem));\n  };\n  var first = function first(element) {\n    return descendant$1(element, isCursorPosition);\n  };\n  var last$1 = function last$1(element) {\n    return descendantRtl(element, isCursorPosition);\n  };\n  var descendantRtl = function descendantRtl(scope, predicate) {\n    var _descend2 = function descend(element) {\n      var children = children$3(element);\n      for (var i = children.length - 1; i >= 0; i--) {\n        var child = children[i];\n        if (predicate(child)) {\n          return Optional.some(child);\n        }\n        var res = _descend2(child);\n        if (res.isSome()) {\n          return res;\n        }\n      }\n      return Optional.none();\n    };\n    return _descend2(scope);\n  };\n  var transferableAttributes = {\n    scope: ['row', 'col']\n  };\n  var createCell = function createCell(doc) {\n    return function () {\n      var td = SugarElement.fromTag('td', doc.dom);\n      append$1(td, SugarElement.fromTag('br', doc.dom));\n      return td;\n    };\n  };\n  var createCol = function createCol(doc) {\n    return function () {\n      return SugarElement.fromTag('col', doc.dom);\n    };\n  };\n  var createColgroup = function createColgroup(doc) {\n    return function () {\n      return SugarElement.fromTag('colgroup', doc.dom);\n    };\n  };\n  var createRow$1 = function createRow$1(doc) {\n    return function () {\n      return SugarElement.fromTag('tr', doc.dom);\n    };\n  };\n  var replace$1 = function replace$1(cell, tag, attrs) {\n    var replica = copy$1(cell, tag);\n    each$1(attrs, function (v, k) {\n      if (v === null) {\n        remove$7(replica, k);\n      } else {\n        set$2(replica, k, v);\n      }\n    });\n    return replica;\n  };\n  var pasteReplace = function pasteReplace(cell) {\n    return cell;\n  };\n  var cloneFormats = function cloneFormats(oldCell, newCell, formats) {\n    var first$1 = first(oldCell);\n    return first$1.map(function (firstText) {\n      var formatSelector = formats.join(',');\n      var parents = ancestors$3(firstText, formatSelector, function (element) {\n        return eq$1(element, oldCell);\n      });\n      return foldr(parents, function (last, parent) {\n        var clonedFormat = shallow(parent);\n        remove$7(clonedFormat, 'contenteditable');\n        append$1(last, clonedFormat);\n        return clonedFormat;\n      }, newCell);\n    }).getOr(newCell);\n  };\n  var cloneAppropriateAttributes = function cloneAppropriateAttributes(original, clone) {\n    each$1(transferableAttributes, function (validAttributes, attributeName) {\n      return getOpt(original, attributeName).filter(function (attribute) {\n        return contains$2(validAttributes, attribute);\n      }).each(function (attribute) {\n        return set$2(clone, attributeName, attribute);\n      });\n    });\n  };\n  var cellOperations = function cellOperations(mutate, doc, formatsToClone) {\n    var cloneCss = function cloneCss(prev, clone) {\n      copy$2(prev.element, clone);\n      remove$6(clone, 'height');\n      if (prev.colspan !== 1) {\n        remove$6(clone, 'width');\n      }\n    };\n    var newCell = function newCell(prev) {\n      var td = SugarElement.fromTag(name(prev.element), doc.dom);\n      var formats = formatsToClone.getOr(['strong', 'em', 'b', 'i', 'span', 'font', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'div']);\n      var lastNode = formats.length > 0 ? cloneFormats(prev.element, td, formats) : td;\n      append$1(lastNode, SugarElement.fromTag('br'));\n      cloneCss(prev, td);\n      cloneAppropriateAttributes(prev.element, td);\n      mutate(prev.element, td);\n      return td;\n    };\n    var newCol = function newCol(prev) {\n      var col = SugarElement.fromTag(name(prev.element), doc.dom);\n      cloneCss(prev, col);\n      mutate(prev.element, col);\n      return col;\n    };\n    return {\n      col: newCol,\n      colgroup: createColgroup(doc),\n      row: createRow$1(doc),\n      cell: newCell,\n      replace: replace$1,\n      colGap: createCol(doc),\n      gap: createCell(doc)\n    };\n  };\n  var paste$1 = function paste$1(doc) {\n    return {\n      col: createCol(doc),\n      colgroup: createColgroup(doc),\n      row: createRow$1(doc),\n      cell: createCell(doc),\n      replace: pasteReplace,\n      colGap: createCol(doc),\n      gap: createCell(doc)\n    };\n  };\n  var fromHtml = function fromHtml(html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    return children$3(SugarElement.fromDom(div));\n  };\n  var fromDom = function fromDom(nodes) {\n    return map$1(nodes, SugarElement.fromDom);\n  };\n  var getNodeName = function getNodeName(elm) {\n    return elm.nodeName.toLowerCase();\n  };\n  var getBody = function getBody(editor) {\n    return SugarElement.fromDom(editor.getBody());\n  };\n  var getPixelWidth = function getPixelWidth(elm) {\n    return elm.getBoundingClientRect().width;\n  };\n  var getPixelHeight = function getPixelHeight(elm) {\n    return elm.getBoundingClientRect().height;\n  };\n  var getIsRoot = function getIsRoot(editor) {\n    return function (element) {\n      return eq$1(element, getBody(editor));\n    };\n  };\n  var removePxSuffix = function removePxSuffix(size) {\n    return size ? size.replace(/px$/, '') : '';\n  };\n  var addPxSuffix = function addPxSuffix(size) {\n    return /^\\d+(\\.\\d+)?$/.test(size) ? size + 'px' : size;\n  };\n  var removeDataStyle = function removeDataStyle(table) {\n    remove$7(table, 'data-mce-style');\n    var removeStyleAttribute = function removeStyleAttribute(element) {\n      return remove$7(element, 'data-mce-style');\n    };\n    each$2(cells$1(table), removeStyleAttribute);\n    each$2(columns$1(table), removeStyleAttribute);\n    each$2(rows$1(table), removeStyleAttribute);\n  };\n  var getRawWidth = function getRawWidth(editor, elm) {\n    var raw = editor.dom.getStyle(elm, 'width') || editor.dom.getAttrib(elm, 'width');\n    return Optional.from(raw).filter(isNotEmpty);\n  };\n  var isPercentage$1 = function isPercentage$1(value) {\n    return /^(\\d+(\\.\\d+)?)%$/.test(value);\n  };\n  var isPixel = function isPixel(value) {\n    return /^(\\d+(\\.\\d+)?)px$/.test(value);\n  };\n  var getSelectionStart = function getSelectionStart(editor) {\n    return SugarElement.fromDom(editor.selection.getStart());\n  };\n  var getSelectionEnd = function getSelectionEnd(editor) {\n    return SugarElement.fromDom(editor.selection.getEnd());\n  };\n  var selection = function selection(selections) {\n    return cata$2(selections.get(), constant([]), identity, pure);\n  };\n  var unmergable = function unmergable(selections) {\n    var hasSpan = function hasSpan(elem, type) {\n      return getOpt(elem, type).exists(function (span) {\n        return parseInt(span, 10) > 1;\n      });\n    };\n    var hasRowOrColSpan = function hasRowOrColSpan(elem) {\n      return hasSpan(elem, 'rowspan') || hasSpan(elem, 'colspan');\n    };\n    var candidates = selection(selections);\n    return candidates.length > 0 && forall(candidates, hasRowOrColSpan) ? Optional.some(candidates) : Optional.none();\n  };\n  var mergable = function mergable(table, selections, ephemera) {\n    return cata$2(selections.get(), Optional.none, function (cells) {\n      if (cells.length <= 1) {\n        return Optional.none();\n      } else {\n        return retrieveBox(table, ephemera.firstSelectedSelector, ephemera.lastSelectedSelector).map(function (bounds) {\n          return {\n            bounds: bounds,\n            cells: cells\n          };\n        });\n      }\n    }, Optional.none);\n  };\n  var strSelected = 'data-mce-selected';\n  var strSelectedSelector = 'td[' + strSelected + '],th[' + strSelected + ']';\n  var strAttributeSelector = '[' + strSelected + ']';\n  var strFirstSelected = 'data-mce-first-selected';\n  var strFirstSelectedSelector = 'td[' + strFirstSelected + '],th[' + strFirstSelected + ']';\n  var strLastSelected = 'data-mce-last-selected';\n  var strLastSelectedSelector = 'td[' + strLastSelected + '],th[' + strLastSelected + ']';\n  var attributeSelector = strAttributeSelector;\n  var ephemera = {\n    selected: strSelected,\n    selectedSelector: strSelectedSelector,\n    firstSelected: strFirstSelected,\n    firstSelectedSelector: strFirstSelectedSelector,\n    lastSelected: strLastSelected,\n    lastSelectedSelector: strLastSelectedSelector\n  };\n  var noMenu = function noMenu(cell) {\n    return {\n      element: cell,\n      mergable: Optional.none(),\n      unmergable: Optional.none(),\n      selection: [cell]\n    };\n  };\n  var forMenu = function forMenu(selections, table, cell) {\n    return {\n      element: cell,\n      mergable: mergable(table, selections, ephemera),\n      unmergable: unmergable(selections),\n      selection: selection(selections)\n    };\n  };\n  var paste = function paste(element, clipboard, generators) {\n    return {\n      element: element,\n      clipboard: clipboard,\n      generators: generators\n    };\n  };\n  var pasteRows = function pasteRows(selections, cell, clipboard, generators) {\n    return {\n      selection: selection(selections),\n      clipboard: clipboard,\n      generators: generators\n    };\n  };\n  var getSelectionCellFallback = function getSelectionCellFallback(element) {\n    return table(element).bind(function (table) {\n      return retrieve(table, ephemera.firstSelectedSelector);\n    }).fold(constant(element), function (cells) {\n      return cells[0];\n    });\n  };\n  var getSelectionFromSelector = function getSelectionFromSelector(selector) {\n    return function (initCell, isRoot) {\n      var cellName = name(initCell);\n      var cell = cellName === 'col' || cellName === 'colgroup' ? getSelectionCellFallback(initCell) : initCell;\n      return closest$1(cell, selector, isRoot);\n    };\n  };\n  var getSelectionCellOrCaption = getSelectionFromSelector('th,td,caption');\n  var getSelectionCell = getSelectionFromSelector('th,td');\n  var getCellsFromSelection = function getCellsFromSelection(selections) {\n    return selection(selections);\n  };\n  var getRowsFromSelection = function getRowsFromSelection(selected, selector) {\n    var cellOpt = getSelectionCell(selected);\n    var rowsOpt = cellOpt.bind(function (cell) {\n      return table(cell);\n    }).map(function (table) {\n      return rows$1(table);\n    });\n    return lift2(cellOpt, rowsOpt, function (cell, rows) {\n      return filter$2(rows, function (row) {\n        return exists(fromDom(row.dom.cells), function (rowCell) {\n          return get$b(rowCell, selector) === '1' || eq$1(rowCell, cell);\n        });\n      });\n    }).getOr([]);\n  };\n  var extractSelected = function extractSelected(cells) {\n    return table(cells[0]).map(function (table) {\n      var replica = extract$1(table, attributeSelector);\n      removeDataStyle(replica);\n      return [replica];\n    });\n  };\n  var serializeElements = function serializeElements(editor, elements) {\n    return map$1(elements, function (elm) {\n      return editor.selection.serializer.serialize(elm.dom, {});\n    }).join('');\n  };\n  var getTextContent = function getTextContent(elements) {\n    return map$1(elements, function (element) {\n      return element.dom.innerText;\n    }).join('');\n  };\n  var registerEvents = function registerEvents(editor, selections, actions) {\n    editor.on('BeforeGetContent', function (e) {\n      var multiCellContext = function multiCellContext(cells) {\n        e.preventDefault();\n        extractSelected(cells).each(function (elements) {\n          e.content = e.format === 'text' ? getTextContent(elements) : serializeElements(editor, elements);\n        });\n      };\n      if (e.selection === true) {\n        cata$2(selections.get(), noop, multiCellContext, noop);\n      }\n    });\n    editor.on('BeforeSetContent', function (e) {\n      if (e.selection === true && e.paste === true) {\n        var selectedCells = getCellsFromSelection(selections);\n        head(selectedCells).each(function (cell) {\n          table(cell).each(function (table) {\n            var elements = filter$2(fromHtml(e.content), function (content) {\n              return name(content) !== 'meta';\n            });\n            var isTable = isTag('table');\n            if (elements.length === 1 && isTable(elements[0])) {\n              e.preventDefault();\n              var doc = SugarElement.fromDom(editor.getDoc());\n              var generators = paste$1(doc);\n              var targets = paste(cell, elements[0], generators);\n              actions.pasteCells(table, targets).each(function () {\n                editor.focus();\n              });\n            }\n          });\n        });\n      }\n    });\n  };\n  var adt$7 = Adt.generate([{\n    none: []\n  }, {\n    only: ['index']\n  }, {\n    left: ['index', 'next']\n  }, {\n    middle: ['prev', 'index', 'next']\n  }, {\n    right: ['prev', 'index']\n  }]);\n  var ColumnContext = _assign({}, adt$7);\n  var neighbours = function neighbours(input, index) {\n    if (input.length === 0) {\n      return ColumnContext.none();\n    }\n    if (input.length === 1) {\n      return ColumnContext.only(0);\n    }\n    if (index === 0) {\n      return ColumnContext.left(0, 1);\n    }\n    if (index === input.length - 1) {\n      return ColumnContext.right(index - 1, index);\n    }\n    if (index > 0 && index < input.length - 1) {\n      return ColumnContext.middle(index - 1, index, index + 1);\n    }\n    return ColumnContext.none();\n  };\n  var determine = function determine(input, column, step, tableSize, resize) {\n    var result = input.slice(0);\n    var context = neighbours(input, column);\n    var onNone = constant(map$1(result, constant(0)));\n    var onOnly = function onOnly(index) {\n      return tableSize.singleColumnWidth(result[index], step);\n    };\n    var onLeft = function onLeft(index, next) {\n      return resize.calcLeftEdgeDeltas(result, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);\n    };\n    var onMiddle = function onMiddle(prev, index, next) {\n      return resize.calcMiddleDeltas(result, prev, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);\n    };\n    var onRight = function onRight(prev, index) {\n      return resize.calcRightEdgeDeltas(result, prev, index, step, tableSize.minCellWidth(), tableSize.isRelative);\n    };\n    return context.fold(onNone, onOnly, onLeft, onMiddle, onRight);\n  };\n  var total = function total(start, end, measures) {\n    var r = 0;\n    for (var i = start; i < end; i++) {\n      r += measures[i] !== undefined ? measures[i] : 0;\n    }\n    return r;\n  };\n  var recalculateWidthForCells = function recalculateWidthForCells(warehouse, widths) {\n    var all = Warehouse.justCells(warehouse);\n    return map$1(all, function (cell) {\n      var width = total(cell.column, cell.column + cell.colspan, widths);\n      return {\n        element: cell.element,\n        width: width,\n        colspan: cell.colspan\n      };\n    });\n  };\n  var recalculateWidthForColumns = function recalculateWidthForColumns(warehouse, widths) {\n    var groups = Warehouse.justColumns(warehouse);\n    return map$1(groups, function (column, index) {\n      return {\n        element: column.element,\n        width: widths[index],\n        colspan: column.colspan\n      };\n    });\n  };\n  var recalculateHeightForCells = function recalculateHeightForCells(warehouse, heights) {\n    var all = Warehouse.justCells(warehouse);\n    return map$1(all, function (cell) {\n      var height = total(cell.row, cell.row + cell.rowspan, heights);\n      return {\n        element: cell.element,\n        height: height,\n        rowspan: cell.rowspan\n      };\n    });\n  };\n  var matchRowHeight = function matchRowHeight(warehouse, heights) {\n    return map$1(warehouse.all, function (row, i) {\n      return {\n        element: row.element,\n        height: heights[i]\n      };\n    });\n  };\n  var sumUp = function sumUp(newSize) {\n    return foldr(newSize, function (b, a) {\n      return b + a;\n    }, 0);\n  };\n  var recalculate = function recalculate(warehouse, widths) {\n    if (Warehouse.hasColumns(warehouse)) {\n      return recalculateWidthForColumns(warehouse, widths);\n    } else {\n      return recalculateWidthForCells(warehouse, widths);\n    }\n  };\n  var recalculateAndApply = function recalculateAndApply(warehouse, widths, tableSize) {\n    var newSizes = recalculate(warehouse, widths);\n    each$2(newSizes, function (cell) {\n      tableSize.setElementWidth(cell.element, cell.width);\n    });\n  };\n  var adjustWidth = function adjustWidth(table, delta, index, resizing, tableSize) {\n    var warehouse = Warehouse.fromTable(table);\n    var step = tableSize.getCellDelta(delta);\n    var widths = tableSize.getWidths(warehouse, tableSize);\n    var isLastColumn = index === warehouse.grid.columns - 1;\n    var clampedStep = resizing.clampTableDelta(widths, index, step, tableSize.minCellWidth(), isLastColumn);\n    var deltas = determine(widths, index, clampedStep, tableSize, resizing);\n    var newWidths = map$1(deltas, function (dx, i) {\n      return dx + widths[i];\n    });\n    recalculateAndApply(warehouse, newWidths, tableSize);\n    resizing.resizeTable(tableSize.adjustTableWidth, clampedStep, isLastColumn);\n  };\n  var adjustHeight = function adjustHeight(table, delta, index, direction) {\n    var warehouse = Warehouse.fromTable(table);\n    var heights = getPixelHeights(warehouse, table, direction);\n    var newHeights = map$1(heights, function (dy, i) {\n      return index === i ? Math.max(delta + dy, minHeight()) : dy;\n    });\n    var newCellSizes = recalculateHeightForCells(warehouse, newHeights);\n    var newRowSizes = matchRowHeight(warehouse, newHeights);\n    each$2(newRowSizes, function (row) {\n      setHeight(row.element, row.height);\n    });\n    each$2(newCellSizes, function (cell) {\n      setHeight(cell.element, cell.height);\n    });\n    var total = sumUp(newHeights);\n    setHeight(table, total);\n  };\n  var adjustAndRedistributeWidths$1 = function adjustAndRedistributeWidths$1(_table, list, details, tableSize, resizeBehaviour) {\n    var warehouse = Warehouse.generate(list);\n    var sizes = tableSize.getWidths(warehouse, tableSize);\n    var tablePixelWidth = tableSize.pixelWidth();\n    var _a = resizeBehaviour.calcRedestributedWidths(sizes, tablePixelWidth, details.pixelDelta, tableSize.isRelative),\n      newSizes = _a.newSizes,\n      delta = _a.delta;\n    recalculateAndApply(warehouse, newSizes, tableSize);\n    tableSize.adjustTableWidth(delta);\n  };\n  var adjustWidthTo = function adjustWidthTo(_table, list, _info, tableSize) {\n    var warehouse = Warehouse.generate(list);\n    var widths = tableSize.getWidths(warehouse, tableSize);\n    recalculateAndApply(warehouse, widths, tableSize);\n  };\n  var zero = function zero(array) {\n    return map$1(array, constant(0));\n  };\n  var surround = function surround(sizes, startIndex, endIndex, results, f) {\n    return f(sizes.slice(0, startIndex)).concat(results).concat(f(sizes.slice(endIndex)));\n  };\n  var clampDeltaHelper = function clampDeltaHelper(predicate) {\n    return function (sizes, index, delta, minCellSize) {\n      if (!predicate(delta)) {\n        return delta;\n      } else {\n        var newSize = Math.max(minCellSize, sizes[index] - Math.abs(delta));\n        var diff = Math.abs(newSize - sizes[index]);\n        return delta >= 0 ? diff : -diff;\n      }\n    };\n  };\n  var clampNegativeDelta = clampDeltaHelper(function (delta) {\n    return delta < 0;\n  });\n  var clampDelta = clampDeltaHelper(always);\n  var resizeTable = function resizeTable() {\n    var calcFixedDeltas = function calcFixedDeltas(sizes, index, next, delta, minCellSize) {\n      var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);\n      return surround(sizes, index, next + 1, [clampedDelta, 0], zero);\n    };\n    var calcRelativeDeltas = function calcRelativeDeltas(sizes, index, delta, minCellSize) {\n      var ratio = (100 + delta) / 100;\n      var newThis = Math.max(minCellSize, (sizes[index] + delta) / ratio);\n      return map$1(sizes, function (size, idx) {\n        var newSize = idx === index ? newThis : size / ratio;\n        return newSize - size;\n      });\n    };\n    var calcLeftEdgeDeltas = function calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize, isRelative) {\n      if (isRelative) {\n        return calcRelativeDeltas(sizes, index, delta, minCellSize);\n      } else {\n        return calcFixedDeltas(sizes, index, next, delta, minCellSize);\n      }\n    };\n    var calcMiddleDeltas = function calcMiddleDeltas(sizes, _prev, index, next, delta, minCellSize, isRelative) {\n      return calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize, isRelative);\n    };\n    var resizeTable = function resizeTable(resizer, delta) {\n      return resizer(delta);\n    };\n    var calcRightEdgeDeltas = function calcRightEdgeDeltas(sizes, _prev, index, delta, minCellSize, isRelative) {\n      if (isRelative) {\n        return calcRelativeDeltas(sizes, index, delta, minCellSize);\n      } else {\n        var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);\n        return zero(sizes.slice(0, index)).concat([clampedDelta]);\n      }\n    };\n    var calcRedestributedWidths = function calcRedestributedWidths(sizes, totalWidth, pixelDelta, isRelative) {\n      if (isRelative) {\n        var tableWidth = totalWidth + pixelDelta;\n        var ratio_1 = tableWidth / totalWidth;\n        var newSizes = map$1(sizes, function (size) {\n          return size / ratio_1;\n        });\n        return {\n          delta: ratio_1 * 100 - 100,\n          newSizes: newSizes\n        };\n      } else {\n        return {\n          delta: pixelDelta,\n          newSizes: sizes\n        };\n      }\n    };\n    return {\n      resizeTable: resizeTable,\n      clampTableDelta: clampNegativeDelta,\n      calcLeftEdgeDeltas: calcLeftEdgeDeltas,\n      calcMiddleDeltas: calcMiddleDeltas,\n      calcRightEdgeDeltas: calcRightEdgeDeltas,\n      calcRedestributedWidths: calcRedestributedWidths\n    };\n  };\n  var preserveTable = function preserveTable() {\n    var calcLeftEdgeDeltas = function calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize) {\n      var idx = delta >= 0 ? next : index;\n      var clampedDelta = clampDelta(sizes, idx, delta, minCellSize);\n      return surround(sizes, index, next + 1, [clampedDelta, -clampedDelta], zero);\n    };\n    var calcMiddleDeltas = function calcMiddleDeltas(sizes, _prev, index, next, delta, minCellSize) {\n      return calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize);\n    };\n    var resizeTable = function resizeTable(resizer, delta, isLastColumn) {\n      if (isLastColumn) {\n        resizer(delta);\n      }\n    };\n    var calcRightEdgeDeltas = function calcRightEdgeDeltas(sizes, _prev, _index, delta, _minCellSize, isRelative) {\n      if (isRelative) {\n        return zero(sizes);\n      } else {\n        var diff = delta / sizes.length;\n        return map$1(sizes, constant(diff));\n      }\n    };\n    var clampTableDelta = function clampTableDelta(sizes, index, delta, minCellSize, isLastColumn) {\n      if (isLastColumn) {\n        if (delta >= 0) {\n          return delta;\n        } else {\n          var maxDelta = foldl(sizes, function (a, b) {\n            return a + b - minCellSize;\n          }, 0);\n          return Math.max(-maxDelta, delta);\n        }\n      } else {\n        return clampNegativeDelta(sizes, index, delta, minCellSize);\n      }\n    };\n    var calcRedestributedWidths = function calcRedestributedWidths(sizes, _totalWidth, _pixelDelta, _isRelative) {\n      return {\n        delta: 0,\n        newSizes: sizes\n      };\n    };\n    return {\n      resizeTable: resizeTable,\n      clampTableDelta: clampTableDelta,\n      calcLeftEdgeDeltas: calcLeftEdgeDeltas,\n      calcMiddleDeltas: calcMiddleDeltas,\n      calcRightEdgeDeltas: calcRightEdgeDeltas,\n      calcRedestributedWidths: calcRedestributedWidths\n    };\n  };\n  var only = function only(element, isResizable) {\n    var parent = Optional.from(element.dom.documentElement).map(SugarElement.fromDom).getOr(element);\n    return {\n      parent: constant(parent),\n      view: constant(element),\n      origin: constant(SugarPosition(0, 0)),\n      isResizable: isResizable\n    };\n  };\n  var detached = function detached(editable, chrome, isResizable) {\n    var origin = function origin() {\n      return absolute(chrome);\n    };\n    return {\n      parent: constant(chrome),\n      view: constant(editable),\n      origin: origin,\n      isResizable: isResizable\n    };\n  };\n  var body = function body(editable, chrome, isResizable) {\n    return {\n      parent: constant(chrome),\n      view: constant(editable),\n      origin: constant(SugarPosition(0, 0)),\n      isResizable: isResizable\n    };\n  };\n  var ResizeWire = {\n    only: only,\n    detached: detached,\n    body: body\n  };\n  var adt$6 = Adt.generate([{\n    invalid: ['raw']\n  }, {\n    pixels: ['value']\n  }, {\n    percent: ['value']\n  }]);\n  var validateFor = function validateFor(suffix, type, value) {\n    var rawAmount = value.substring(0, value.length - suffix.length);\n    var amount = parseFloat(rawAmount);\n    return rawAmount === amount.toString() ? type(amount) : adt$6.invalid(value);\n  };\n  var from = function from(value) {\n    if (endsWith(value, '%')) {\n      return validateFor('%', adt$6.percent, value);\n    }\n    if (endsWith(value, 'px')) {\n      return validateFor('px', adt$6.pixels, value);\n    }\n    return adt$6.invalid(value);\n  };\n  var Size = _assign(_assign({}, adt$6), {\n    from: from\n  });\n  var redistributeToPercent = function redistributeToPercent(widths, totalWidth) {\n    return map$1(widths, function (w) {\n      var colType = Size.from(w);\n      return colType.fold(function () {\n        return w;\n      }, function (px) {\n        var ratio = px / totalWidth * 100;\n        return ratio + '%';\n      }, function (pc) {\n        return pc + '%';\n      });\n    });\n  };\n  var redistributeToPx = function redistributeToPx(widths, totalWidth, newTotalWidth) {\n    var scale = newTotalWidth / totalWidth;\n    return map$1(widths, function (w) {\n      var colType = Size.from(w);\n      return colType.fold(function () {\n        return w;\n      }, function (px) {\n        return px * scale + 'px';\n      }, function (pc) {\n        return pc / 100 * newTotalWidth + 'px';\n      });\n    });\n  };\n  var redistributeEmpty = function redistributeEmpty(newWidthType, columns) {\n    var f = newWidthType.fold(function () {\n      return constant('');\n    }, function (pixels) {\n      var num = pixels / columns;\n      return constant(num + 'px');\n    }, function () {\n      var num = 100 / columns;\n      return constant(num + '%');\n    });\n    return range$1(columns, f);\n  };\n  var redistributeValues = function redistributeValues(newWidthType, widths, totalWidth) {\n    return newWidthType.fold(function () {\n      return widths;\n    }, function (px) {\n      return redistributeToPx(widths, totalWidth, px);\n    }, function (_pc) {\n      return redistributeToPercent(widths, totalWidth);\n    });\n  };\n  var redistribute$1 = function redistribute$1(widths, totalWidth, newWidth) {\n    var newType = Size.from(newWidth);\n    var floats = forall(widths, function (s) {\n      return s === '0px';\n    }) ? redistributeEmpty(newType, widths.length) : redistributeValues(newType, widths, totalWidth);\n    return normalize(floats);\n  };\n  var sum = function sum(values, fallback) {\n    if (values.length === 0) {\n      return fallback;\n    }\n    return foldr(values, function (rest, v) {\n      return Size.from(v).fold(constant(0), identity, identity) + rest;\n    }, 0);\n  };\n  var roundDown = function roundDown(num, unit) {\n    var floored = Math.floor(num);\n    return {\n      value: floored + unit,\n      remainder: num - floored\n    };\n  };\n  var add$3 = function add$3(value, amount) {\n    return Size.from(value).fold(constant(value), function (px) {\n      return px + amount + 'px';\n    }, function (pc) {\n      return pc + amount + '%';\n    });\n  };\n  var normalize = function normalize(values) {\n    if (values.length === 0) {\n      return values;\n    }\n    var scan = foldr(values, function (rest, value) {\n      var info = Size.from(value).fold(function () {\n        return {\n          value: value,\n          remainder: 0\n        };\n      }, function (num) {\n        return roundDown(num, 'px');\n      }, function (num) {\n        return {\n          value: num + '%',\n          remainder: 0\n        };\n      });\n      return {\n        output: [info.value].concat(rest.output),\n        remainder: rest.remainder + info.remainder\n      };\n    }, {\n      output: [],\n      remainder: 0\n    });\n    var r = scan.output;\n    return r.slice(0, r.length - 1).concat([add$3(r[r.length - 1], Math.round(scan.remainder))]);\n  };\n  var validate = Size.from;\n  var redistributeToW = function redistributeToW(newWidths, cells, unit) {\n    each$2(cells, function (cell) {\n      var widths = newWidths.slice(cell.column, cell.colspan + cell.column);\n      var w = sum(widths, minWidth());\n      set$1(cell.element, 'width', w + unit);\n    });\n  };\n  var redistributeToColumns = function redistributeToColumns(newWidths, columns, unit) {\n    each$2(columns, function (column, index) {\n      var width = sum([newWidths[index]], minWidth());\n      set$1(column.element, 'width', width + unit);\n    });\n  };\n  var redistributeToH = function redistributeToH(newHeights, rows, cells, unit) {\n    each$2(cells, function (cell) {\n      var heights = newHeights.slice(cell.row, cell.rowspan + cell.row);\n      var h = sum(heights, minHeight());\n      set$1(cell.element, 'height', h + unit);\n    });\n    each$2(rows, function (row, i) {\n      set$1(row.element, 'height', newHeights[i]);\n    });\n  };\n  var getUnit = function getUnit(newSize) {\n    return validate(newSize).fold(constant('px'), constant('px'), constant('%'));\n  };\n  var redistribute = function redistribute(table, optWidth, optHeight) {\n    var warehouse = Warehouse.fromTable(table);\n    var rows = warehouse.all;\n    var cells = Warehouse.justCells(warehouse);\n    var columns = Warehouse.justColumns(warehouse);\n    optWidth.each(function (newWidth) {\n      var widthUnit = getUnit(newWidth);\n      var totalWidth = get$8(table);\n      var oldWidths = getRawWidths(warehouse, table);\n      var nuWidths = redistribute$1(oldWidths, totalWidth, newWidth);\n      if (Warehouse.hasColumns(warehouse)) {\n        redistributeToColumns(nuWidths, columns, widthUnit);\n      } else {\n        redistributeToW(nuWidths, cells, widthUnit);\n      }\n      set$1(table, 'width', newWidth);\n    });\n    optHeight.each(function (newHeight) {\n      var hUnit = getUnit(newHeight);\n      var totalHeight = get$7(table);\n      var oldHeights = getRawHeights(warehouse, table, height);\n      var nuHeights = redistribute$1(oldHeights, totalHeight, newHeight);\n      redistributeToH(nuHeights, rows, cells, hUnit);\n      set$1(table, 'height', newHeight);\n    });\n  };\n  var isPercentSizing = isPercentSizing$1;\n  var isPixelSizing = isPixelSizing$1;\n  var isNoneSizing = isNoneSizing$1;\n  var getGridSize = function getGridSize(table) {\n    var warehouse = Warehouse.fromTable(table);\n    return warehouse.grid;\n  };\n  var Event = function Event(fields) {\n    var handlers = [];\n    var bind = function bind(handler) {\n      if (handler === undefined) {\n        throw new Error('Event bind error: undefined handler');\n      }\n      handlers.push(handler);\n    };\n    var unbind = function unbind(handler) {\n      handlers = filter$2(handlers, function (h) {\n        return h !== handler;\n      });\n    };\n    var trigger = function trigger() {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      var event = {};\n      each$2(fields, function (name, i) {\n        event[name] = args[i];\n      });\n      each$2(handlers, function (handler) {\n        handler(event);\n      });\n    };\n    return {\n      bind: bind,\n      unbind: unbind,\n      trigger: trigger\n    };\n  };\n  var create$4 = function create$4(typeDefs) {\n    var registry = map(typeDefs, function (event) {\n      return {\n        bind: event.bind,\n        unbind: event.unbind\n      };\n    });\n    var trigger = map(typeDefs, function (event) {\n      return event.trigger;\n    });\n    return {\n      registry: registry,\n      trigger: trigger\n    };\n  };\n  var last = function last(fn, rate) {\n    var timer = null;\n    var cancel = function cancel() {\n      if (!isNull(timer)) {\n        clearTimeout(timer);\n        timer = null;\n      }\n    };\n    var throttle = function throttle() {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      cancel();\n      timer = setTimeout(function () {\n        timer = null;\n        fn.apply(null, args);\n      }, rate);\n    };\n    return {\n      cancel: cancel,\n      throttle: throttle\n    };\n  };\n  var sort = function sort(arr) {\n    return arr.slice(0).sort();\n  };\n  var reqMessage = function reqMessage(required, keys) {\n    throw new Error('All required keys (' + sort(required).join(', ') + ') were not specified. Specified keys were: ' + sort(keys).join(', ') + '.');\n  };\n  var unsuppMessage = function unsuppMessage(unsupported) {\n    throw new Error('Unsupported keys for object: ' + sort(unsupported).join(', '));\n  };\n  var validateStrArr = function validateStrArr(label, array) {\n    if (!isArray(array)) {\n      throw new Error('The ' + label + ' fields must be an array. Was: ' + array + '.');\n    }\n    each$2(array, function (a) {\n      if (!isString(a)) {\n        throw new Error('The value ' + a + ' in the ' + label + ' fields was not a string.');\n      }\n    });\n  };\n  var invalidTypeMessage = function invalidTypeMessage(incorrect, type) {\n    throw new Error('All values need to be of type: ' + type + '. Keys (' + sort(incorrect).join(', ') + ') were not.');\n  };\n  var checkDupes = function checkDupes(everything) {\n    var sorted = sort(everything);\n    var dupe = find$1(sorted, function (s, i) {\n      return i < sorted.length - 1 && s === sorted[i + 1];\n    });\n    dupe.each(function (d) {\n      throw new Error('The field: ' + d + ' occurs more than once in the combined fields: [' + sorted.join(', ') + '].');\n    });\n  };\n  var base = function base(handleUnsupported, required) {\n    return baseWith(handleUnsupported, required, {\n      validate: isFunction,\n      label: 'function'\n    });\n  };\n  var baseWith = function baseWith(handleUnsupported, required, pred) {\n    if (required.length === 0) {\n      throw new Error('You must specify at least one required field.');\n    }\n    validateStrArr('required', required);\n    checkDupes(required);\n    return function (obj) {\n      var keys$1 = keys(obj);\n      var allReqd = forall(required, function (req) {\n        return contains$2(keys$1, req);\n      });\n      if (!allReqd) {\n        reqMessage(required, keys$1);\n      }\n      handleUnsupported(required, keys$1);\n      var invalidKeys = filter$2(required, function (key) {\n        return !pred.validate(obj[key], key);\n      });\n      if (invalidKeys.length > 0) {\n        invalidTypeMessage(invalidKeys, pred.label);\n      }\n      return obj;\n    };\n  };\n  var handleExact = function handleExact(required, keys) {\n    var unsupported = filter$2(keys, function (key) {\n      return !contains$2(required, key);\n    });\n    if (unsupported.length > 0) {\n      unsuppMessage(unsupported);\n    }\n  };\n  var exactly = function exactly(required) {\n    return base(handleExact, required);\n  };\n  var DragMode = exactly(['compare', 'extract', 'mutate', 'sink']);\n  var DragSink = exactly(['element', 'start', 'stop', 'destroy']);\n  var DragApi = exactly(['forceDrop', 'drop', 'move', 'delayDrop']);\n  var InDrag = function InDrag() {\n    var previous = Optional.none();\n    var reset = function reset() {\n      previous = Optional.none();\n    };\n    var update = function update(mode, nu) {\n      var result = previous.map(function (old) {\n        return mode.compare(old, nu);\n      });\n      previous = Optional.some(nu);\n      return result;\n    };\n    var onEvent = function onEvent(event, mode) {\n      var dataOption = mode.extract(event);\n      dataOption.each(function (data) {\n        var offset = update(mode, data);\n        offset.each(function (d) {\n          events.trigger.move(d);\n        });\n      });\n    };\n    var events = create$4({\n      move: Event(['info'])\n    });\n    return {\n      onEvent: onEvent,\n      reset: reset,\n      events: events.registry\n    };\n  };\n  var NoDrag = function NoDrag() {\n    var events = create$4({\n      move: Event(['info'])\n    });\n    return {\n      onEvent: noop,\n      reset: noop,\n      events: events.registry\n    };\n  };\n  var Movement = function Movement() {\n    var noDragState = NoDrag();\n    var inDragState = InDrag();\n    var dragState = noDragState;\n    var on = function on() {\n      dragState.reset();\n      dragState = inDragState;\n    };\n    var off = function off() {\n      dragState.reset();\n      dragState = noDragState;\n    };\n    var onEvent = function onEvent(event, mode) {\n      dragState.onEvent(event, mode);\n    };\n    var isOn = function isOn() {\n      return dragState === inDragState;\n    };\n    return {\n      on: on,\n      off: off,\n      isOn: isOn,\n      onEvent: onEvent,\n      events: inDragState.events\n    };\n  };\n  var setup = function setup(mutation, mode, settings) {\n    var active = false;\n    var events = create$4({\n      start: Event([]),\n      stop: Event([])\n    });\n    var movement = Movement();\n    var drop = function drop() {\n      sink.stop();\n      if (movement.isOn()) {\n        movement.off();\n        events.trigger.stop();\n      }\n    };\n    var throttledDrop = last(drop, 200);\n    var go = function go(parent) {\n      sink.start(parent);\n      movement.on();\n      events.trigger.start();\n    };\n    var mousemove = function mousemove(event) {\n      throttledDrop.cancel();\n      movement.onEvent(event, mode);\n    };\n    movement.events.move.bind(function (event) {\n      mode.mutate(mutation, event.info);\n    });\n    var on = function on() {\n      active = true;\n    };\n    var off = function off() {\n      active = false;\n    };\n    var runIfActive = function runIfActive(f) {\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (active) {\n          f.apply(null, args);\n        }\n      };\n    };\n    var sink = mode.sink(DragApi({\n      forceDrop: drop,\n      drop: runIfActive(drop),\n      move: runIfActive(mousemove),\n      delayDrop: runIfActive(throttledDrop.throttle)\n    }), settings);\n    var destroy = function destroy() {\n      sink.destroy();\n    };\n    return {\n      element: sink.element,\n      go: go,\n      on: on,\n      off: off,\n      destroy: destroy,\n      events: events.registry\n    };\n  };\n  var mkEvent = function mkEvent(target, x, y, stop, prevent, kill, raw) {\n    return {\n      target: target,\n      x: x,\n      y: y,\n      stop: stop,\n      prevent: prevent,\n      kill: kill,\n      raw: raw\n    };\n  };\n  var fromRawEvent$1 = function fromRawEvent$1(rawEvent) {\n    var target = SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));\n    var stop = function stop() {\n      return rawEvent.stopPropagation();\n    };\n    var prevent = function prevent() {\n      return rawEvent.preventDefault();\n    };\n    var kill = compose(prevent, stop);\n    return mkEvent(target, rawEvent.clientX, rawEvent.clientY, stop, prevent, kill, rawEvent);\n  };\n  var handle$2 = function handle$2(filter, handler) {\n    return function (rawEvent) {\n      if (filter(rawEvent)) {\n        handler(fromRawEvent$1(rawEvent));\n      }\n    };\n  };\n  var binder = function binder(element, event, filter, handler, useCapture) {\n    var wrapped = handle$2(filter, handler);\n    element.dom.addEventListener(event, wrapped, useCapture);\n    return {\n      unbind: curry(unbind, element, event, wrapped, useCapture)\n    };\n  };\n  var bind$1 = function bind$1(element, event, filter, handler) {\n    return binder(element, event, filter, handler, false);\n  };\n  var unbind = function unbind(element, event, handler, useCapture) {\n    element.dom.removeEventListener(event, handler, useCapture);\n  };\n  var filter = always;\n  var bind = function bind(element, event, handler) {\n    return bind$1(element, event, filter, handler);\n  };\n  var fromRawEvent = fromRawEvent$1;\n  var read = function read(element, attr) {\n    var value = get$b(element, attr);\n    return value === undefined || value === '' ? [] : value.split(' ');\n  };\n  var add$2 = function add$2(element, attr, id) {\n    var old = read(element, attr);\n    var nu = old.concat([id]);\n    set$2(element, attr, nu.join(' '));\n    return true;\n  };\n  var remove$4 = function remove$4(element, attr, id) {\n    var nu = filter$2(read(element, attr), function (v) {\n      return v !== id;\n    });\n    if (nu.length > 0) {\n      set$2(element, attr, nu.join(' '));\n    } else {\n      remove$7(element, attr);\n    }\n    return false;\n  };\n  var supports = function supports(element) {\n    return element.dom.classList !== undefined;\n  };\n  var get$5 = function get$5(element) {\n    return read(element, 'class');\n  };\n  var add$1 = function add$1(element, clazz) {\n    return add$2(element, 'class', clazz);\n  };\n  var remove$3 = function remove$3(element, clazz) {\n    return remove$4(element, 'class', clazz);\n  };\n  var add = function add(element, clazz) {\n    if (supports(element)) {\n      element.dom.classList.add(clazz);\n    } else {\n      add$1(element, clazz);\n    }\n  };\n  var cleanClass = function cleanClass(element) {\n    var classList = supports(element) ? element.dom.classList : get$5(element);\n    if (classList.length === 0) {\n      remove$7(element, 'class');\n    }\n  };\n  var remove$2 = function remove$2(element, clazz) {\n    if (supports(element)) {\n      var classList = element.dom.classList;\n      classList.remove(clazz);\n    } else {\n      remove$3(element, clazz);\n    }\n    cleanClass(element);\n  };\n  var has = function has(element, clazz) {\n    return supports(element) && element.dom.classList.contains(clazz);\n  };\n  var css = function css(namespace) {\n    var dashNamespace = namespace.replace(/\\./g, '-');\n    var resolve = function resolve(str) {\n      return dashNamespace + '-' + str;\n    };\n    return {\n      resolve: resolve\n    };\n  };\n  var styles$1 = css('ephox-dragster');\n  var resolve$1 = styles$1.resolve;\n  var Blocker = function Blocker(options) {\n    var settings = _assign({\n      layerClass: resolve$1('blocker')\n    }, options);\n    var div = SugarElement.fromTag('div');\n    set$2(div, 'role', 'presentation');\n    setAll(div, {\n      position: 'fixed',\n      left: '0px',\n      top: '0px',\n      width: '100%',\n      height: '100%'\n    });\n    add(div, resolve$1('blocker'));\n    add(div, settings.layerClass);\n    var element = constant(div);\n    var destroy = function destroy() {\n      remove$5(div);\n    };\n    return {\n      element: element,\n      destroy: destroy\n    };\n  };\n  var compare = function compare(old, nu) {\n    return SugarPosition(nu.left - old.left, nu.top - old.top);\n  };\n  var extract = function extract(event) {\n    return Optional.some(SugarPosition(event.x, event.y));\n  };\n  var mutate = function mutate(mutation, info) {\n    mutation.mutate(info.left, info.top);\n  };\n  var sink = function sink(dragApi, settings) {\n    var blocker = Blocker(settings);\n    var mdown = bind(blocker.element(), 'mousedown', dragApi.forceDrop);\n    var mup = bind(blocker.element(), 'mouseup', dragApi.drop);\n    var mmove = bind(blocker.element(), 'mousemove', dragApi.move);\n    var mout = bind(blocker.element(), 'mouseout', dragApi.delayDrop);\n    var destroy = function destroy() {\n      blocker.destroy();\n      mup.unbind();\n      mmove.unbind();\n      mout.unbind();\n      mdown.unbind();\n    };\n    var start = function start(parent) {\n      append$1(parent, blocker.element());\n    };\n    var stop = function stop() {\n      remove$5(blocker.element());\n    };\n    return DragSink({\n      element: blocker.element,\n      start: start,\n      stop: stop,\n      destroy: destroy\n    });\n  };\n  var MouseDrag = DragMode({\n    compare: compare,\n    extract: extract,\n    sink: sink,\n    mutate: mutate\n  });\n  var transform$1 = function transform$1(mutation, settings) {\n    if (settings === void 0) {\n      settings = {};\n    }\n    var mode = settings.mode !== undefined ? settings.mode : MouseDrag;\n    return setup(mutation, mode, settings);\n  };\n  var closest = function closest(target) {\n    return closest$1(target, '[contenteditable]');\n  };\n  var isEditable$1 = function isEditable$1(element, assumeEditable) {\n    if (assumeEditable === void 0) {\n      assumeEditable = false;\n    }\n    if (!detect$3().browser.isIE() && _inBody(element)) {\n      return element.dom.isContentEditable;\n    } else {\n      return closest(element).fold(constant(assumeEditable), function (editable) {\n        return getRaw(editable) === 'true';\n      });\n    }\n  };\n  var getRaw = function getRaw(element) {\n    return element.dom.contentEditable;\n  };\n  var styles = css('ephox-snooker');\n  var resolve = styles.resolve;\n  var Mutation = function Mutation() {\n    var events = create$4({\n      drag: Event(['xDelta', 'yDelta'])\n    });\n    var mutate = function mutate(x, y) {\n      events.trigger.drag(x, y);\n    };\n    return {\n      mutate: mutate,\n      events: events.registry\n    };\n  };\n  var BarMutation = function BarMutation() {\n    var events = create$4({\n      drag: Event(['xDelta', 'yDelta', 'target'])\n    });\n    var target = Optional.none();\n    var delegate = Mutation();\n    delegate.events.drag.bind(function (event) {\n      target.each(function (t) {\n        events.trigger.drag(event.xDelta, event.yDelta, t);\n      });\n    });\n    var assign = function assign(t) {\n      target = Optional.some(t);\n    };\n    var get = function get() {\n      return target;\n    };\n    return {\n      assign: assign,\n      get: get,\n      mutate: delegate.mutate,\n      events: events.registry\n    };\n  };\n  var col = function col(column, x, y, w, h) {\n    var bar = SugarElement.fromTag('div');\n    setAll(bar, {\n      position: 'absolute',\n      left: x - w / 2 + 'px',\n      top: y + 'px',\n      height: h + 'px',\n      width: w + 'px'\n    });\n    setAll$1(bar, {\n      'data-column': column,\n      'role': 'presentation'\n    });\n    return bar;\n  };\n  var row = function row(r, x, y, w, h) {\n    var bar = SugarElement.fromTag('div');\n    setAll(bar, {\n      position: 'absolute',\n      left: x + 'px',\n      top: y - h / 2 + 'px',\n      height: h + 'px',\n      width: w + 'px'\n    });\n    setAll$1(bar, {\n      'data-row': r,\n      'role': 'presentation'\n    });\n    return bar;\n  };\n  var resizeBar = resolve('resizer-bar');\n  var resizeRowBar = resolve('resizer-rows');\n  var resizeColBar = resolve('resizer-cols');\n  var BAR_THICKNESS = 7;\n  var resizableRows = function resizableRows(warehouse, isResizable) {\n    return bind$2(warehouse.all, function (row, i) {\n      return isResizable(row.element) ? [i] : [];\n    });\n  };\n  var resizableColumns = function resizableColumns(warehouse, isResizable) {\n    var resizableCols = [];\n    range$1(warehouse.grid.columns, function (index) {\n      var colElmOpt = Warehouse.getColumnAt(warehouse, index).map(function (col) {\n        return col.element;\n      });\n      if (colElmOpt.forall(isResizable)) {\n        resizableCols.push(index);\n      }\n    });\n    return filter$2(resizableCols, function (colIndex) {\n      var columnCells = Warehouse.filterItems(warehouse, function (cell) {\n        return cell.column === colIndex;\n      });\n      return forall(columnCells, function (cell) {\n        return isResizable(cell.element);\n      });\n    });\n  };\n  var destroy = function destroy(wire) {\n    var previous = descendants(wire.parent(), '.' + resizeBar);\n    each$2(previous, remove$5);\n  };\n  var drawBar = function drawBar(wire, positions, create) {\n    var origin = wire.origin();\n    each$2(positions, function (cpOption) {\n      cpOption.each(function (cp) {\n        var bar = create(origin, cp);\n        add(bar, resizeBar);\n        append$1(wire.parent(), bar);\n      });\n    });\n  };\n  var refreshCol = function refreshCol(wire, colPositions, position, tableHeight) {\n    drawBar(wire, colPositions, function (origin, cp) {\n      var colBar = col(cp.col, cp.x - origin.left, position.top - origin.top, BAR_THICKNESS, tableHeight);\n      add(colBar, resizeColBar);\n      return colBar;\n    });\n  };\n  var refreshRow = function refreshRow(wire, rowPositions, position, tableWidth) {\n    drawBar(wire, rowPositions, function (origin, cp) {\n      var rowBar = row(cp.row, position.left - origin.left, cp.y - origin.top, tableWidth, BAR_THICKNESS);\n      add(rowBar, resizeRowBar);\n      return rowBar;\n    });\n  };\n  var refreshGrid = function refreshGrid(warhouse, wire, table, rows, cols) {\n    var position = absolute(table);\n    var isResizable = wire.isResizable;\n    var rowPositions = rows.length > 0 ? height.positions(rows, table) : [];\n    var resizableRowBars = rowPositions.length > 0 ? resizableRows(warhouse, isResizable) : [];\n    var resizableRowPositions = filter$2(rowPositions, function (_pos, i) {\n      return exists(resizableRowBars, function (barIndex) {\n        return i === barIndex;\n      });\n    });\n    refreshRow(wire, resizableRowPositions, position, getOuter$2(table));\n    var colPositions = cols.length > 0 ? width.positions(cols, table) : [];\n    var resizableColBars = colPositions.length > 0 ? resizableColumns(warhouse, isResizable) : [];\n    var resizableColPositions = filter$2(colPositions, function (_pos, i) {\n      return exists(resizableColBars, function (barIndex) {\n        return i === barIndex;\n      });\n    });\n    refreshCol(wire, resizableColPositions, position, getOuter$1(table));\n  };\n  var refresh = function refresh(wire, table) {\n    destroy(wire);\n    if (wire.isResizable(table)) {\n      var warehouse = Warehouse.fromTable(table);\n      var rows$1 = rows(warehouse);\n      var cols = columns(warehouse);\n      refreshGrid(warehouse, wire, table, rows$1, cols);\n    }\n  };\n  var each = function each(wire, f) {\n    var bars = descendants(wire.parent(), '.' + resizeBar);\n    each$2(bars, f);\n  };\n  var hide = function hide(wire) {\n    each(wire, function (bar) {\n      set$1(bar, 'display', 'none');\n    });\n  };\n  var show = function show(wire) {\n    each(wire, function (bar) {\n      set$1(bar, 'display', 'block');\n    });\n  };\n  var isRowBar = function isRowBar(element) {\n    return has(element, resizeRowBar);\n  };\n  var isColBar = function isColBar(element) {\n    return has(element, resizeColBar);\n  };\n  var resizeBarDragging = resolve('resizer-bar-dragging');\n  var BarManager = function BarManager(wire) {\n    var mutation = BarMutation();\n    var resizing = transform$1(mutation, {});\n    var hoverTable = Optional.none();\n    var getResizer = function getResizer(element, type) {\n      return Optional.from(get$b(element, type));\n    };\n    mutation.events.drag.bind(function (event) {\n      getResizer(event.target, 'data-row').each(function (_dataRow) {\n        var currentRow = getCssValue(event.target, 'top');\n        set$1(event.target, 'top', currentRow + event.yDelta + 'px');\n      });\n      getResizer(event.target, 'data-column').each(function (_dataCol) {\n        var currentCol = getCssValue(event.target, 'left');\n        set$1(event.target, 'left', currentCol + event.xDelta + 'px');\n      });\n    });\n    var getDelta = function getDelta(target, dir) {\n      var newX = getCssValue(target, dir);\n      var oldX = getAttrValue(target, 'data-initial-' + dir, 0);\n      return newX - oldX;\n    };\n    resizing.events.stop.bind(function () {\n      mutation.get().each(function (target) {\n        hoverTable.each(function (table) {\n          getResizer(target, 'data-row').each(function (row) {\n            var delta = getDelta(target, 'top');\n            remove$7(target, 'data-initial-top');\n            events.trigger.adjustHeight(table, delta, parseInt(row, 10));\n          });\n          getResizer(target, 'data-column').each(function (column) {\n            var delta = getDelta(target, 'left');\n            remove$7(target, 'data-initial-left');\n            events.trigger.adjustWidth(table, delta, parseInt(column, 10));\n          });\n          refresh(wire, table);\n        });\n      });\n    });\n    var handler = function handler(target, dir) {\n      events.trigger.startAdjust();\n      mutation.assign(target);\n      set$2(target, 'data-initial-' + dir, getCssValue(target, dir));\n      add(target, resizeBarDragging);\n      set$1(target, 'opacity', '0.2');\n      resizing.go(wire.parent());\n    };\n    var mousedown = bind(wire.parent(), 'mousedown', function (event) {\n      if (isRowBar(event.target)) {\n        handler(event.target, 'top');\n      }\n      if (isColBar(event.target)) {\n        handler(event.target, 'left');\n      }\n    });\n    var isRoot = function isRoot(e) {\n      return eq$1(e, wire.view());\n    };\n    var findClosestEditableTable = function findClosestEditableTable(target) {\n      return closest$1(target, 'table', isRoot).filter(isEditable$1);\n    };\n    var mouseover = bind(wire.view(), 'mouseover', function (event) {\n      findClosestEditableTable(event.target).fold(function () {\n        if (_inBody(event.target)) {\n          destroy(wire);\n        }\n      }, function (table) {\n        hoverTable = Optional.some(table);\n        refresh(wire, table);\n      });\n    });\n    var destroy$1 = function destroy$1() {\n      mousedown.unbind();\n      mouseover.unbind();\n      resizing.destroy();\n      destroy(wire);\n    };\n    var refresh$1 = function refresh$1(tbl) {\n      refresh(wire, tbl);\n    };\n    var events = create$4({\n      adjustHeight: Event(['table', 'delta', 'row']),\n      adjustWidth: Event(['table', 'delta', 'column']),\n      startAdjust: Event([])\n    });\n    return {\n      destroy: destroy$1,\n      refresh: refresh$1,\n      on: resizing.on,\n      off: resizing.off,\n      hideBars: curry(hide, wire),\n      showBars: curry(show, wire),\n      events: events.registry\n    };\n  };\n  var create$3 = function create$3(wire, resizing, lazySizing) {\n    var hdirection = height;\n    var vdirection = width;\n    var manager = BarManager(wire);\n    var events = create$4({\n      beforeResize: Event(['table', 'type']),\n      afterResize: Event(['table', 'type']),\n      startDrag: Event([])\n    });\n    manager.events.adjustHeight.bind(function (event) {\n      var table = event.table;\n      events.trigger.beforeResize(table, 'row');\n      var delta = hdirection.delta(event.delta, table);\n      adjustHeight(table, delta, event.row, hdirection);\n      events.trigger.afterResize(table, 'row');\n    });\n    manager.events.startAdjust.bind(function (_event) {\n      events.trigger.startDrag();\n    });\n    manager.events.adjustWidth.bind(function (event) {\n      var table = event.table;\n      events.trigger.beforeResize(table, 'col');\n      var delta = vdirection.delta(event.delta, table);\n      var tableSize = lazySizing(table);\n      adjustWidth(table, delta, event.column, resizing, tableSize);\n      events.trigger.afterResize(table, 'col');\n    });\n    return {\n      on: manager.on,\n      off: manager.off,\n      hideBars: manager.hideBars,\n      showBars: manager.showBars,\n      destroy: manager.destroy,\n      events: events.registry\n    };\n  };\n  var TableResize = {\n    create: create$3\n  };\n  var fireNewRow = function fireNewRow(editor, row) {\n    return editor.fire('newrow', {\n      node: row\n    });\n  };\n  var fireNewCell = function fireNewCell(editor, cell) {\n    return editor.fire('newcell', {\n      node: cell\n    });\n  };\n  var fireObjectResizeStart = function fireObjectResizeStart(editor, target, width, height, origin) {\n    editor.fire('ObjectResizeStart', {\n      target: target,\n      width: width,\n      height: height,\n      origin: origin\n    });\n  };\n  var fireObjectResized = function fireObjectResized(editor, target, width, height, origin) {\n    editor.fire('ObjectResized', {\n      target: target,\n      width: width,\n      height: height,\n      origin: origin\n    });\n  };\n  var fireTableSelectionChange = function fireTableSelectionChange(editor, cells, start, finish, otherCells) {\n    editor.fire('TableSelectionChange', {\n      cells: cells,\n      start: start,\n      finish: finish,\n      otherCells: otherCells\n    });\n  };\n  var fireTableSelectionClear = function fireTableSelectionClear(editor) {\n    editor.fire('TableSelectionClear');\n  };\n  var fireTableModified = function fireTableModified(editor, table, data) {\n    editor.fire('TableModified', _assign(_assign({}, data), {\n      table: table\n    }));\n  };\n  var styleModified = {\n    structure: false,\n    style: true\n  };\n  var structureModified = {\n    structure: true,\n    style: false\n  };\n  var styleAndStructureModified = {\n    structure: true,\n    style: true\n  };\n  var defaultTableToolbar = 'tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol';\n  var defaultStyles = {\n    'border-collapse': 'collapse',\n    'width': '100%'\n  };\n  var defaultCellBorderWidths = range$1(5, function (i) {\n    var size = i + 1 + 'px';\n    return {\n      title: size,\n      value: size\n    };\n  });\n  var defaultCellBorderStyles = map$1(['Solid', 'Dotted', 'Dashed', 'Double', 'Groove', 'Ridge', 'Inset', 'Outset', 'None', 'Hidden'], function (type) {\n    return {\n      title: type,\n      value: type.toLowerCase()\n    };\n  });\n  var determineDefaultStyles = function determineDefaultStyles(editor) {\n    var _a;\n    if (isPixelsForced(editor)) {\n      var dom = editor.dom;\n      var parentBlock = (_a = dom.getParent(editor.selection.getStart(), dom.isBlock)) !== null && _a !== void 0 ? _a : editor.getBody();\n      var contentWidth = getInner(SugarElement.fromDom(parentBlock));\n      return _assign(_assign({}, defaultStyles), {\n        width: contentWidth + 'px'\n      });\n    } else if (isResponsiveForced(editor)) {\n      return filter$1(defaultStyles, function (_value, key) {\n        return key !== 'width';\n      });\n    } else {\n      return defaultStyles;\n    }\n  };\n  var defaultAttributes = {\n    border: '1'\n  };\n  var defaultColumnResizingBehaviour = 'preservetable';\n  var getTableSizingMode = function getTableSizingMode(editor) {\n    return editor.getParam('table_sizing_mode', 'auto');\n  };\n  var getTableResponseWidth = function getTableResponseWidth(editor) {\n    return editor.getParam('table_responsive_width');\n  };\n  var getTableBorderWidths = function getTableBorderWidths(editor) {\n    return editor.getParam('table_border_widths', defaultCellBorderWidths, 'array');\n  };\n  var getTableBorderStyles = function getTableBorderStyles(editor) {\n    return editor.getParam('table_border_styles', defaultCellBorderStyles, 'array');\n  };\n  var getDefaultAttributes = function getDefaultAttributes(editor) {\n    return editor.getParam('table_default_attributes', defaultAttributes, 'object');\n  };\n  var getDefaultStyles = function getDefaultStyles(editor) {\n    return editor.getParam('table_default_styles', determineDefaultStyles(editor), 'object');\n  };\n  var hasTableResizeBars = function hasTableResizeBars(editor) {\n    return editor.getParam('table_resize_bars', true, 'boolean');\n  };\n  var hasTabNavigation = function hasTabNavigation(editor) {\n    return editor.getParam('table_tab_navigation', true, 'boolean');\n  };\n  var hasAdvancedCellTab = function hasAdvancedCellTab(editor) {\n    return editor.getParam('table_cell_advtab', true, 'boolean');\n  };\n  var hasAdvancedRowTab = function hasAdvancedRowTab(editor) {\n    return editor.getParam('table_row_advtab', true, 'boolean');\n  };\n  var hasAdvancedTableTab = function hasAdvancedTableTab(editor) {\n    return editor.getParam('table_advtab', true, 'boolean');\n  };\n  var hasAppearanceOptions = function hasAppearanceOptions(editor) {\n    return editor.getParam('table_appearance_options', true, 'boolean');\n  };\n  var hasTableGrid = function hasTableGrid(editor) {\n    return editor.getParam('table_grid', true, 'boolean');\n  };\n  var shouldStyleWithCss = function shouldStyleWithCss(editor) {\n    return editor.getParam('table_style_by_css', false, 'boolean');\n  };\n  var getCellClassList = function getCellClassList(editor) {\n    return editor.getParam('table_cell_class_list', [], 'array');\n  };\n  var getRowClassList = function getRowClassList(editor) {\n    return editor.getParam('table_row_class_list', [], 'array');\n  };\n  var getTableClassList = function getTableClassList(editor) {\n    return editor.getParam('table_class_list', [], 'array');\n  };\n  var isPercentagesForced = function isPercentagesForced(editor) {\n    return getTableSizingMode(editor) === 'relative' || getTableResponseWidth(editor) === true;\n  };\n  var isPixelsForced = function isPixelsForced(editor) {\n    return getTableSizingMode(editor) === 'fixed' || getTableResponseWidth(editor) === false;\n  };\n  var isResponsiveForced = function isResponsiveForced(editor) {\n    return getTableSizingMode(editor) === 'responsive';\n  };\n  var getToolbar = function getToolbar(editor) {\n    return editor.getParam('table_toolbar', defaultTableToolbar);\n  };\n  var useColumnGroup = function useColumnGroup(editor) {\n    return editor.getParam('table_use_colgroups', false, 'boolean');\n  };\n  var getTableHeaderType = function getTableHeaderType(editor) {\n    var defaultValue = 'section';\n    var value = editor.getParam('table_header_type', defaultValue, 'string');\n    var validValues = ['section', 'cells', 'sectionCells', 'auto'];\n    if (!contains$2(validValues, value)) {\n      return defaultValue;\n    } else {\n      return value;\n    }\n  };\n  var getColumnResizingBehaviour = function getColumnResizingBehaviour(editor) {\n    var validModes = ['preservetable', 'resizetable'];\n    var givenMode = editor.getParam('table_column_resizing', defaultColumnResizingBehaviour, 'string');\n    return find$1(validModes, function (mode) {\n      return mode === givenMode;\n    }).getOr(defaultColumnResizingBehaviour);\n  };\n  var isPreserveTableColumnResizing = function isPreserveTableColumnResizing(editor) {\n    return getColumnResizingBehaviour(editor) === 'preservetable';\n  };\n  var isResizeTableColumnResizing = function isResizeTableColumnResizing(editor) {\n    return getColumnResizingBehaviour(editor) === 'resizetable';\n  };\n  var getCloneElements = function getCloneElements(editor) {\n    var cloneElements = editor.getParam('table_clone_elements');\n    if (isString(cloneElements)) {\n      return Optional.some(cloneElements.split(/[ ,]/));\n    } else if (Array.isArray(cloneElements)) {\n      return Optional.some(cloneElements);\n    } else {\n      return Optional.none();\n    }\n  };\n  var hasObjectResizing = function hasObjectResizing(editor) {\n    var objectResizing = editor.getParam('object_resizing', true);\n    return isString(objectResizing) ? objectResizing === 'table' : objectResizing;\n  };\n  var getTableBackgroundColorMap = function getTableBackgroundColorMap(editor) {\n    return editor.getParam('table_background_color_map', [], 'array');\n  };\n  var getTableBorderColorMap = function getTableBorderColorMap(editor) {\n    return editor.getParam('table_border_color_map', [], 'array');\n  };\n  var get$4 = function get$4(editor, table) {\n    if (isPercentagesForced(editor)) {\n      return TableSize.percentageSize(table);\n    } else if (isPixelsForced(editor)) {\n      return TableSize.pixelSize(table);\n    } else {\n      return TableSize.getTableSize(table);\n    }\n  };\n  var cleanupLegacyAttributes = function cleanupLegacyAttributes(element) {\n    remove$7(element, 'width');\n  };\n  var convertToPercentSize = function convertToPercentSize(table) {\n    var newWidth = getPercentTableWidth(table);\n    redistribute(table, Optional.some(newWidth), Optional.none());\n    cleanupLegacyAttributes(table);\n  };\n  var convertToPixelSize = function convertToPixelSize(table) {\n    var newWidth = getPixelTableWidth(table);\n    redistribute(table, Optional.some(newWidth), Optional.none());\n    cleanupLegacyAttributes(table);\n  };\n  var convertToNoneSize = function convertToNoneSize(table) {\n    remove$6(table, 'width');\n    var columns = columns$1(table);\n    var rowElements = columns.length > 0 ? columns : cells$1(table);\n    each$2(rowElements, function (cell) {\n      remove$6(cell, 'width');\n      cleanupLegacyAttributes(cell);\n    });\n    cleanupLegacyAttributes(table);\n  };\n  var enforcePercentage = convertToPercentSize;\n  var enforcePixels = convertToPixelSize;\n  var enforceNone = convertToNoneSize;\n  var syncPixels = function syncPixels(table) {\n    var warehouse = Warehouse.fromTable(table);\n    if (!Warehouse.hasColumns(warehouse)) {\n      each$2(cells$1(table), function (cell) {\n        var computedWidth = get$a(cell, 'width');\n        set$1(cell, 'width', computedWidth);\n        remove$7(cell, 'width');\n      });\n    }\n  };\n  var createContainer = function createContainer() {\n    var container = SugarElement.fromTag('div');\n    setAll(container, {\n      position: 'static',\n      height: '0',\n      width: '0',\n      padding: '0',\n      margin: '0',\n      border: '0'\n    });\n    append$1(body$1(), container);\n    return container;\n  };\n  var get$3 = function get$3(editor, isResizable) {\n    return editor.inline ? ResizeWire.body(getBody(editor), createContainer(), isResizable) : ResizeWire.only(SugarElement.fromDom(editor.getDoc()), isResizable);\n  };\n  var remove$1 = function remove$1(editor, wire) {\n    if (editor.inline) {\n      remove$5(wire.parent());\n    }\n  };\n  var barResizerPrefix = 'bar-';\n  var isResizable = function isResizable(elm) {\n    return get$b(elm, 'data-mce-resize') !== 'false';\n  };\n  var getResizeHandler = function getResizeHandler(editor) {\n    var selectionRng = Optional.none();\n    var resize = Optional.none();\n    var wire = Optional.none();\n    var startW;\n    var startRawW;\n    var isTable = function isTable(elm) {\n      return elm.nodeName === 'TABLE';\n    };\n    var lazyResize = function lazyResize() {\n      return resize;\n    };\n    var lazyWire = function lazyWire() {\n      return wire.getOr(ResizeWire.only(SugarElement.fromDom(editor.getBody()), isResizable));\n    };\n    var lazySizing = function lazySizing(table) {\n      return get$4(editor, table);\n    };\n    var lazyResizingBehaviour = function lazyResizingBehaviour() {\n      return isPreserveTableColumnResizing(editor) ? preserveTable() : resizeTable();\n    };\n    var getNumColumns = function getNumColumns(table) {\n      return getGridSize(table).columns;\n    };\n    var afterCornerResize = function afterCornerResize(table, origin, width) {\n      var isRightEdgeResize = endsWith(origin, 'e');\n      if (startRawW === '') {\n        enforcePercentage(table);\n      }\n      if (width !== startW && startRawW !== '') {\n        set$1(table, 'width', startRawW);\n        var resizing = lazyResizingBehaviour();\n        var tableSize = lazySizing(table);\n        var col = isPreserveTableColumnResizing(editor) || isRightEdgeResize ? getNumColumns(table) - 1 : 0;\n        adjustWidth(table, width - startW, col, resizing, tableSize);\n      } else if (isPercentage$1(startRawW)) {\n        var percentW = parseFloat(startRawW.replace('%', ''));\n        var targetPercentW = width * percentW / startW;\n        set$1(table, 'width', targetPercentW + '%');\n      }\n      if (isPixel(startRawW)) {\n        syncPixels(table);\n      }\n    };\n    var destroy = function destroy() {\n      resize.each(function (sz) {\n        sz.destroy();\n      });\n      wire.each(function (w) {\n        remove$1(editor, w);\n      });\n    };\n    editor.on('init', function () {\n      var rawWire = get$3(editor, isResizable);\n      wire = Optional.some(rawWire);\n      if (hasObjectResizing(editor) && hasTableResizeBars(editor)) {\n        var resizing = lazyResizingBehaviour();\n        var sz = TableResize.create(rawWire, resizing, lazySizing);\n        sz.on();\n        sz.events.startDrag.bind(function (_event) {\n          selectionRng = Optional.some(editor.selection.getRng());\n        });\n        sz.events.beforeResize.bind(function (event) {\n          var rawTable = event.table.dom;\n          fireObjectResizeStart(editor, rawTable, getPixelWidth(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);\n        });\n        sz.events.afterResize.bind(function (event) {\n          var table = event.table;\n          var rawTable = table.dom;\n          removeDataStyle(table);\n          selectionRng.each(function (rng) {\n            editor.selection.setRng(rng);\n            editor.focus();\n          });\n          fireObjectResized(editor, rawTable, getPixelWidth(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);\n          editor.undoManager.add();\n        });\n        resize = Optional.some(sz);\n      }\n    });\n    editor.on('ObjectResizeStart', function (e) {\n      var targetElm = e.target;\n      if (isTable(targetElm)) {\n        var table = SugarElement.fromDom(targetElm);\n        each$2(editor.dom.select('.mce-clonedresizable'), function (clone) {\n          editor.dom.addClass(clone, 'mce-' + getColumnResizingBehaviour(editor) + '-columns');\n        });\n        if (!isPixelSizing(table) && isPixelsForced(editor)) {\n          enforcePixels(table);\n        } else if (!isPercentSizing(table) && isPercentagesForced(editor)) {\n          enforcePercentage(table);\n        }\n        if (isNoneSizing(table) && startsWith(e.origin, barResizerPrefix)) {\n          enforcePercentage(table);\n        }\n        startW = e.width;\n        startRawW = isResponsiveForced(editor) ? '' : getRawWidth(editor, targetElm).getOr('');\n      }\n    });\n    editor.on('ObjectResized', function (e) {\n      var targetElm = e.target;\n      if (isTable(targetElm)) {\n        var table = SugarElement.fromDom(targetElm);\n        var origin_1 = e.origin;\n        if (startsWith(origin_1, 'corner-')) {\n          afterCornerResize(table, origin_1, e.width);\n        }\n        removeDataStyle(table);\n        fireTableModified(editor, table.dom, styleModified);\n      }\n    });\n    editor.on('SwitchMode', function () {\n      lazyResize().each(function (resize) {\n        if (editor.mode.isReadOnly()) {\n          resize.hideBars();\n        } else {\n          resize.showBars();\n        }\n      });\n    });\n    return {\n      lazyResize: lazyResize,\n      lazyWire: lazyWire,\n      destroy: destroy\n    };\n  };\n  var point = function point(element, offset) {\n    return {\n      element: element,\n      offset: offset\n    };\n  };\n  var _scan$ = function scan$1(universe, element, direction) {\n    if (universe.property().isText(element) && universe.property().getText(element).trim().length === 0 || universe.property().isComment(element)) {\n      return direction(element).bind(function (elem) {\n        return _scan$(universe, elem, direction).orThunk(function () {\n          return Optional.some(elem);\n        });\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n  var toEnd = function toEnd(universe, element) {\n    if (universe.property().isText(element)) {\n      return universe.property().getText(element).length;\n    }\n    var children = universe.property().children(element);\n    return children.length;\n  };\n  var _freefallRtl$ = function freefallRtl$2(universe, element) {\n    var candidate = _scan$(universe, element, universe.query().prevSibling).getOr(element);\n    if (universe.property().isText(candidate)) {\n      return point(candidate, toEnd(universe, candidate));\n    }\n    var children = universe.property().children(candidate);\n    return children.length > 0 ? _freefallRtl$(universe, children[children.length - 1]) : point(candidate, toEnd(universe, candidate));\n  };\n  var freefallRtl$1 = _freefallRtl$;\n  var universe$2 = DomUniverse();\n  var freefallRtl = function freefallRtl(element) {\n    return freefallRtl$1(universe$2, element);\n  };\n  var halve = function halve(main, other) {\n    var colspan = getSpan(main, 'colspan');\n    if (colspan === 1) {\n      var width = getGenericWidth(main);\n      width.each(function (w) {\n        var newWidth = w.value / 2;\n        setGenericWidth(main, newWidth, w.unit);\n        setGenericWidth(other, newWidth, w.unit);\n      });\n    }\n  };\n  var isHeaderCell = isTag('th');\n  var isHeaderCells = function isHeaderCells(cells) {\n    return forall(cells, function (cell) {\n      return isHeaderCell(cell.element);\n    });\n  };\n  var getRowHeaderType = function getRowHeaderType(isHeaderRow, isHeaderCells) {\n    if (isHeaderRow && isHeaderCells) {\n      return 'sectionCells';\n    } else if (isHeaderRow) {\n      return 'section';\n    } else {\n      return 'cells';\n    }\n  };\n  var getRowType$1 = function getRowType$1(row) {\n    var isHeaderRow = row.section === 'thead';\n    var isHeaderCells = is(findCommonCellType(row.cells), 'th');\n    if (isHeaderRow || isHeaderCells) {\n      return {\n        type: 'header',\n        subType: getRowHeaderType(isHeaderRow, isHeaderCells)\n      };\n    } else if (row.section === 'tfoot') {\n      return {\n        type: 'footer'\n      };\n    } else {\n      return {\n        type: 'body'\n      };\n    }\n  };\n  var findCommonCellType = function findCommonCellType(cells) {\n    var headerCells = filter$2(cells, function (cell) {\n      return isHeaderCell(cell.element);\n    });\n    if (headerCells.length === 0) {\n      return Optional.some('td');\n    } else if (headerCells.length === cells.length) {\n      return Optional.some('th');\n    } else {\n      return Optional.none();\n    }\n  };\n  var findCommonRowType = function findCommonRowType(rows) {\n    var rowTypes = map$1(rows, function (row) {\n      return getRowType$1(row).type;\n    });\n    var hasHeader = contains$2(rowTypes, 'header');\n    var hasFooter = contains$2(rowTypes, 'footer');\n    if (!hasHeader && !hasFooter) {\n      return Optional.some('body');\n    } else {\n      var hasBody = contains$2(rowTypes, 'body');\n      if (hasHeader && !hasBody && !hasFooter) {\n        return Optional.some('header');\n      } else if (!hasHeader && !hasBody && hasFooter) {\n        return Optional.some('footer');\n      } else {\n        return Optional.none();\n      }\n    }\n  };\n  var findTableRowHeaderType = function findTableRowHeaderType(warehouse) {\n    return findMap(warehouse.all, function (row) {\n      var rowType = getRowType$1(row);\n      return rowType.type === 'header' ? Optional.from(rowType.subType) : Optional.none();\n    });\n  };\n  var transformCell = function transformCell(cell, comparator, substitution) {\n    return elementnew(substitution(cell.element, comparator), true, cell.isLocked);\n  };\n  var _transformRow = function transformRow(row, section) {\n    return row.section !== section ? rowcells(row.element, row.cells, section, row.isNew) : row;\n  };\n  var section = function section() {\n    return {\n      transformRow: _transformRow,\n      transformCell: function transformCell(cell, comparator, substitution) {\n        var newCell = substitution(cell.element, comparator);\n        var fixedCell = name(newCell) !== 'td' ? mutate$1(newCell, 'td') : newCell;\n        return elementnew(fixedCell, cell.isNew, cell.isLocked);\n      }\n    };\n  };\n  var sectionCells = function sectionCells() {\n    return {\n      transformRow: _transformRow,\n      transformCell: transformCell\n    };\n  };\n  var cells = function cells() {\n    return {\n      transformRow: function transformRow(row, section) {\n        var newSection = section === 'thead' ? 'tbody' : section;\n        return _transformRow(row, newSection);\n      },\n      transformCell: transformCell\n    };\n  };\n  var fallback = function fallback() {\n    return {\n      transformRow: identity,\n      transformCell: transformCell\n    };\n  };\n  var getTableSectionType = function getTableSectionType(table, fallback) {\n    var warehouse = Warehouse.fromTable(table);\n    var type = findTableRowHeaderType(warehouse).getOr(fallback);\n    switch (type) {\n      case 'section':\n        return section();\n      case 'sectionCells':\n        return sectionCells();\n      case 'cells':\n        return cells();\n    }\n  };\n  var TableSection = {\n    getTableSectionType: getTableSectionType,\n    section: section,\n    sectionCells: sectionCells,\n    cells: cells,\n    fallback: fallback\n  };\n  var setIfNot = function setIfNot(element, property, value, ignore) {\n    if (value === ignore) {\n      remove$7(element, property);\n    } else {\n      set$2(element, property, value);\n    }\n  };\n  var insert$1 = function insert$1(table, selector, element) {\n    last$2(children$1(table, selector)).fold(function () {\n      return prepend(table, element);\n    }, function (child) {\n      return after$5(child, element);\n    });\n  };\n  var generateSection = function generateSection(table, sectionName) {\n    var section = child$1(table, sectionName).getOrThunk(function () {\n      var newSection = SugarElement.fromTag(sectionName, owner(table).dom);\n      if (sectionName === 'thead') {\n        insert$1(table, 'caption,colgroup', newSection);\n      } else if (sectionName === 'colgroup') {\n        insert$1(table, 'caption', newSection);\n      } else {\n        append$1(table, newSection);\n      }\n      return newSection;\n    });\n    empty(section);\n    return section;\n  };\n  var render$1 = function render$1(table, grid) {\n    var newRows = [];\n    var newCells = [];\n    var syncRows = function syncRows(gridSection) {\n      return map$1(gridSection, function (row) {\n        if (row.isNew) {\n          newRows.push(row.element);\n        }\n        var tr = row.element;\n        empty(tr);\n        each$2(row.cells, function (cell) {\n          if (cell.isNew) {\n            newCells.push(cell.element);\n          }\n          setIfNot(cell.element, 'colspan', cell.colspan, 1);\n          setIfNot(cell.element, 'rowspan', cell.rowspan, 1);\n          append$1(tr, cell.element);\n        });\n        return tr;\n      });\n    };\n    var syncColGroup = function syncColGroup(gridSection) {\n      return bind$2(gridSection, function (colGroup) {\n        return map$1(colGroup.cells, function (col) {\n          setIfNot(col.element, 'span', col.colspan, 1);\n          return col.element;\n        });\n      });\n    };\n    var renderSection = function renderSection(gridSection, sectionName) {\n      var section = generateSection(table, sectionName);\n      var sync = sectionName === 'colgroup' ? syncColGroup : syncRows;\n      var sectionElems = sync(gridSection);\n      append(section, sectionElems);\n    };\n    var removeSection = function removeSection(sectionName) {\n      child$1(table, sectionName).each(remove$5);\n    };\n    var renderOrRemoveSection = function renderOrRemoveSection(gridSection, sectionName) {\n      if (gridSection.length > 0) {\n        renderSection(gridSection, sectionName);\n      } else {\n        removeSection(sectionName);\n      }\n    };\n    var headSection = [];\n    var bodySection = [];\n    var footSection = [];\n    var columnGroupsSection = [];\n    each$2(grid, function (row) {\n      switch (row.section) {\n        case 'thead':\n          headSection.push(row);\n          break;\n        case 'tbody':\n          bodySection.push(row);\n          break;\n        case 'tfoot':\n          footSection.push(row);\n          break;\n        case 'colgroup':\n          columnGroupsSection.push(row);\n          break;\n      }\n    });\n    renderOrRemoveSection(columnGroupsSection, 'colgroup');\n    renderOrRemoveSection(headSection, 'thead');\n    renderOrRemoveSection(bodySection, 'tbody');\n    renderOrRemoveSection(footSection, 'tfoot');\n    return {\n      newRows: newRows,\n      newCells: newCells\n    };\n  };\n  var copy = function copy(grid) {\n    return map$1(grid, function (row) {\n      var tr = shallow(row.element);\n      each$2(row.cells, function (cell) {\n        var clonedCell = deep(cell.element);\n        setIfNot(clonedCell, 'colspan', cell.colspan, 1);\n        setIfNot(clonedCell, 'rowspan', cell.rowspan, 1);\n        append$1(tr, clonedCell);\n      });\n      return tr;\n    });\n  };\n  var getColumn = function getColumn(grid, index) {\n    return map$1(grid, function (row) {\n      return getCell(row, index);\n    });\n  };\n  var getRow = function getRow(grid, index) {\n    return grid[index];\n  };\n  var findDiff = function findDiff(xs, comp) {\n    if (xs.length === 0) {\n      return 0;\n    }\n    var first = xs[0];\n    var index = findIndex(xs, function (x) {\n      return !comp(first.element, x.element);\n    });\n    return index.getOr(xs.length);\n  };\n  var subgrid = function subgrid(grid, row, column, comparator) {\n    var gridRow = getRow(grid, row);\n    var isColRow = gridRow.section === 'colgroup';\n    var colspan = findDiff(gridRow.cells.slice(column), comparator);\n    var rowspan = isColRow ? 1 : findDiff(getColumn(grid.slice(row), column), comparator);\n    return {\n      colspan: colspan,\n      rowspan: rowspan\n    };\n  };\n  var toDetails = function toDetails(grid, comparator) {\n    var seen = map$1(grid, function (row) {\n      return map$1(row.cells, never);\n    });\n    var updateSeen = function updateSeen(rowIndex, columnIndex, rowspan, colspan) {\n      for (var row = rowIndex; row < rowIndex + rowspan; row++) {\n        for (var column = columnIndex; column < columnIndex + colspan; column++) {\n          seen[row][column] = true;\n        }\n      }\n    };\n    return map$1(grid, function (row, rowIndex) {\n      var details = bind$2(row.cells, function (cell, columnIndex) {\n        if (seen[rowIndex][columnIndex] === false) {\n          var result = subgrid(grid, rowIndex, columnIndex, comparator);\n          updateSeen(rowIndex, columnIndex, result.rowspan, result.colspan);\n          return [detailnew(cell.element, result.rowspan, result.colspan, cell.isNew)];\n        } else {\n          return [];\n        }\n      });\n      return rowdetailnew(row.element, details, row.section, row.isNew);\n    });\n  };\n  var toGrid = function toGrid(warehouse, generators, isNew) {\n    var grid = [];\n    each$2(warehouse.colgroups, function (colgroup) {\n      var colgroupCols = [];\n      for (var columnIndex = 0; columnIndex < warehouse.grid.columns; columnIndex++) {\n        var element = Warehouse.getColumnAt(warehouse, columnIndex).map(function (column) {\n          return elementnew(column.element, isNew, false);\n        }).getOrThunk(function () {\n          return elementnew(generators.colGap(), true, false);\n        });\n        colgroupCols.push(element);\n      }\n      grid.push(rowcells(colgroup.element, colgroupCols, 'colgroup', isNew));\n    });\n    for (var rowIndex = 0; rowIndex < warehouse.grid.rows; rowIndex++) {\n      var rowCells = [];\n      for (var columnIndex = 0; columnIndex < warehouse.grid.columns; columnIndex++) {\n        var element = Warehouse.getAt(warehouse, rowIndex, columnIndex).map(function (item) {\n          return elementnew(item.element, isNew, item.isLocked);\n        }).getOrThunk(function () {\n          return elementnew(generators.gap(), true, false);\n        });\n        rowCells.push(element);\n      }\n      var rowDetail = warehouse.all[rowIndex];\n      var row = rowcells(rowDetail.element, rowCells, rowDetail.section, isNew);\n      grid.push(row);\n    }\n    return grid;\n  };\n  var fromWarehouse = function fromWarehouse(warehouse, generators) {\n    return toGrid(warehouse, generators, false);\n  };\n  var toDetailList = function toDetailList(grid) {\n    return toDetails(grid, eq$1);\n  };\n  var findInWarehouse = function findInWarehouse(warehouse, element) {\n    return findMap(warehouse.all, function (r) {\n      return find$1(r.cells, function (e) {\n        return eq$1(element, e.element);\n      });\n    });\n  };\n  var extractCells = function extractCells(warehouse, target, predicate) {\n    var details = map$1(target.selection, function (cell$1) {\n      return cell(cell$1).bind(function (lc) {\n        return findInWarehouse(warehouse, lc);\n      }).filter(predicate);\n    });\n    var cells = cat(details);\n    return someIf(cells.length > 0, cells);\n  };\n  var run = function run(operation, extract, adjustment, postAction, genWrappers) {\n    return function (wire, table, target, generators, behaviours) {\n      var warehouse = Warehouse.fromTable(table);\n      var tableSection = Optional.from(behaviours === null || behaviours === void 0 ? void 0 : behaviours.section).getOrThunk(TableSection.fallback);\n      var output = extract(warehouse, target).map(function (info) {\n        var model = fromWarehouse(warehouse, generators);\n        var result = operation(model, info, eq$1, genWrappers(generators), tableSection);\n        var lockedColumns = getLockedColumnsFromGrid(result.grid);\n        var grid = toDetailList(result.grid);\n        return {\n          info: info,\n          grid: grid,\n          cursor: result.cursor,\n          lockedColumns: lockedColumns\n        };\n      });\n      return output.bind(function (out) {\n        var newElements = render$1(table, out.grid);\n        var tableSizing = Optional.from(behaviours === null || behaviours === void 0 ? void 0 : behaviours.sizing).getOrThunk(function () {\n          return TableSize.getTableSize(table);\n        });\n        var resizing = Optional.from(behaviours === null || behaviours === void 0 ? void 0 : behaviours.resize).getOrThunk(preserveTable);\n        adjustment(table, out.grid, out.info, {\n          sizing: tableSizing,\n          resize: resizing,\n          section: tableSection\n        });\n        postAction(table);\n        refresh(wire, table);\n        remove$7(table, LOCKED_COL_ATTR);\n        if (out.lockedColumns.length > 0) {\n          set$2(table, LOCKED_COL_ATTR, out.lockedColumns.join(','));\n        }\n        return Optional.some({\n          cursor: out.cursor,\n          newRows: newElements.newRows,\n          newCells: newElements.newCells\n        });\n      });\n    };\n  };\n  var onPaste = function onPaste(warehouse, target) {\n    return cell(target.element).bind(function (cell) {\n      return findInWarehouse(warehouse, cell).map(function (details) {\n        var value = _assign(_assign({}, details), {\n          generators: target.generators,\n          clipboard: target.clipboard\n        });\n        return value;\n      });\n    });\n  };\n  var onPasteByEditor = function onPasteByEditor(warehouse, target) {\n    return extractCells(warehouse, target, always).map(function (cells) {\n      return {\n        cells: cells,\n        generators: target.generators,\n        clipboard: target.clipboard\n      };\n    });\n  };\n  var onMergable = function onMergable(_warehouse, target) {\n    return target.mergable;\n  };\n  var onUnmergable = function onUnmergable(_warehouse, target) {\n    return target.unmergable;\n  };\n  var onCells = function onCells(warehouse, target) {\n    return extractCells(warehouse, target, always);\n  };\n  var onUnlockedCells = function onUnlockedCells(warehouse, target) {\n    return extractCells(warehouse, target, function (detail) {\n      return !detail.isLocked;\n    });\n  };\n  var isUnlockedTableCell = function isUnlockedTableCell(warehouse, cell) {\n    return findInWarehouse(warehouse, cell).exists(function (detail) {\n      return !detail.isLocked;\n    });\n  };\n  var allUnlocked = function allUnlocked(warehouse, cells) {\n    return forall(cells, function (cell) {\n      return isUnlockedTableCell(warehouse, cell);\n    });\n  };\n  var onUnlockedMergable = function onUnlockedMergable(warehouse, target) {\n    return onMergable(warehouse, target).filter(function (mergeable) {\n      return allUnlocked(warehouse, mergeable.cells);\n    });\n  };\n  var onUnlockedUnmergable = function onUnlockedUnmergable(warehouse, target) {\n    return onUnmergable(warehouse, target).filter(function (cells) {\n      return allUnlocked(warehouse, cells);\n    });\n  };\n  var merge$2 = function merge$2(grid, bounds, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n    if (rows.length === 0) {\n      return grid;\n    }\n    for (var i = bounds.startRow; i <= bounds.finishRow; i++) {\n      for (var j = bounds.startCol; j <= bounds.finishCol; j++) {\n        var row = rows[i];\n        var isLocked = getCell(row, j).isLocked;\n        mutateCell(row, j, elementnew(substitution(), false, isLocked));\n      }\n    }\n    return grid;\n  };\n  var unmerge = function unmerge(grid, target, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n    var first = true;\n    for (var i = 0; i < rows.length; i++) {\n      for (var j = 0; j < cellLength(rows[0]); j++) {\n        var row = rows[i];\n        var currentCell = getCell(row, j);\n        var currentCellElm = currentCell.element;\n        var isToReplace = comparator(currentCellElm, target);\n        if (isToReplace === true && first === false) {\n          mutateCell(row, j, elementnew(substitution(), true, currentCell.isLocked));\n        } else if (isToReplace === true) {\n          first = false;\n        }\n      }\n    }\n    return grid;\n  };\n  var uniqueCells = function uniqueCells(row, comparator) {\n    return foldl(row, function (rest, cell) {\n      return exists(rest, function (currentCell) {\n        return comparator(currentCell.element, cell.element);\n      }) ? rest : rest.concat([cell]);\n    }, []);\n  };\n  var splitCols = function splitCols(grid, index, comparator, substitution) {\n    if (index > 0 && index < grid[0].cells.length) {\n      each$2(grid, function (row) {\n        var prevCell = row.cells[index - 1];\n        var current = row.cells[index];\n        var isToReplace = comparator(current.element, prevCell.element);\n        if (isToReplace) {\n          mutateCell(row, index, elementnew(substitution(), true, current.isLocked));\n        }\n      });\n    }\n    return grid;\n  };\n  var splitRows = function splitRows(grid, index, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n    if (index > 0 && index < rows.length) {\n      var rowPrevCells = rows[index - 1].cells;\n      var cells = uniqueCells(rowPrevCells, comparator);\n      each$2(cells, function (cell) {\n        var replacement = Optional.none();\n        for (var i = index; i < rows.length; i++) {\n          var _loop_1 = function _loop_1(j) {\n            var row = rows[i];\n            var current = getCell(row, j);\n            var isToReplace = comparator(current.element, cell.element);\n            if (isToReplace) {\n              if (replacement.isNone()) {\n                replacement = Optional.some(substitution());\n              }\n              replacement.each(function (sub) {\n                mutateCell(row, j, elementnew(sub, true, current.isLocked));\n              });\n            }\n          };\n          for (var j = 0; j < cellLength(rows[0]); j++) {\n            _loop_1(j);\n          }\n        }\n      });\n    }\n    return grid;\n  };\n  var _value$ = function value$1(o) {\n    var or = function or(_opt) {\n      return _value$(o);\n    };\n    var orThunk = function orThunk(_f) {\n      return _value$(o);\n    };\n    var map = function map(f) {\n      return _value$(f(o));\n    };\n    var mapError = function mapError(_f) {\n      return _value$(o);\n    };\n    var each = function each(f) {\n      f(o);\n    };\n    var bind = function bind(f) {\n      return f(o);\n    };\n    var fold = function fold(_, onValue) {\n      return onValue(o);\n    };\n    var exists = function exists(f) {\n      return f(o);\n    };\n    var forall = function forall(f) {\n      return f(o);\n    };\n    var toOptional = function toOptional() {\n      return Optional.some(o);\n    };\n    return {\n      isValue: always,\n      isError: never,\n      getOr: constant(o),\n      getOrThunk: constant(o),\n      getOrDie: constant(o),\n      or: or,\n      orThunk: orThunk,\n      fold: fold,\n      map: map,\n      mapError: mapError,\n      each: each,\n      bind: bind,\n      exists: exists,\n      forall: forall,\n      toOptional: toOptional\n    };\n  };\n  var _error = function error(message) {\n    var getOrThunk = function getOrThunk(f) {\n      return f();\n    };\n    var getOrDie = function getOrDie() {\n      return die(String(message))();\n    };\n    var or = identity;\n    var orThunk = function orThunk(f) {\n      return f();\n    };\n    var map = function map(_f) {\n      return _error(message);\n    };\n    var mapError = function mapError(f) {\n      return _error(f(message));\n    };\n    var bind = function bind(_f) {\n      return _error(message);\n    };\n    var fold = function fold(onError, _) {\n      return onError(message);\n    };\n    return {\n      isValue: never,\n      isError: always,\n      getOr: identity,\n      getOrThunk: getOrThunk,\n      getOrDie: getOrDie,\n      or: or,\n      orThunk: orThunk,\n      fold: fold,\n      map: map,\n      mapError: mapError,\n      each: noop,\n      bind: bind,\n      exists: never,\n      forall: always,\n      toOptional: Optional.none\n    };\n  };\n  var fromOption = function fromOption(opt, err) {\n    return opt.fold(function () {\n      return _error(err);\n    }, _value$);\n  };\n  var Result = {\n    value: _value$,\n    error: _error,\n    fromOption: fromOption\n  };\n  var measure = function measure(startAddress, gridA, gridB) {\n    if (startAddress.row >= gridA.length || startAddress.column > cellLength(gridA[0])) {\n      return Result.error('invalid start address out of table bounds, row: ' + startAddress.row + ', column: ' + startAddress.column);\n    }\n    var rowRemainder = gridA.slice(startAddress.row);\n    var colRemainder = rowRemainder[0].cells.slice(startAddress.column);\n    var colRequired = cellLength(gridB[0]);\n    var rowRequired = gridB.length;\n    return Result.value({\n      rowDelta: rowRemainder.length - rowRequired,\n      colDelta: colRemainder.length - colRequired\n    });\n  };\n  var measureWidth = function measureWidth(gridA, gridB) {\n    var colLengthA = cellLength(gridA[0]);\n    var colLengthB = cellLength(gridB[0]);\n    return {\n      rowDelta: 0,\n      colDelta: colLengthA - colLengthB\n    };\n  };\n  var measureHeight = function measureHeight(gridA, gridB) {\n    var rowLengthA = gridA.length;\n    var rowLengthB = gridB.length;\n    return {\n      rowDelta: rowLengthA - rowLengthB,\n      colDelta: 0\n    };\n  };\n  var generateElements = function generateElements(amount, row, generators, isLocked) {\n    var generator = row.section === 'colgroup' ? generators.col : generators.cell;\n    return range$1(amount, function (idx) {\n      return elementnew(generator(), true, isLocked(idx));\n    });\n  };\n  var rowFill = function rowFill(grid, amount, generators, lockedColumns) {\n    var exampleRow = grid[grid.length - 1];\n    return grid.concat(range$1(amount, function () {\n      var generator = exampleRow.section === 'colgroup' ? generators.colgroup : generators.row;\n      var row = clone$1(exampleRow, generator, identity);\n      var elements = generateElements(row.cells.length, row, generators, function (idx) {\n        return has$1(lockedColumns, idx.toString());\n      });\n      return setCells(row, elements);\n    }));\n  };\n  var colFill = function colFill(grid, amount, generators, startIndex) {\n    return map$1(grid, function (row) {\n      var newChildren = generateElements(amount, row, generators, never);\n      return addCells(row, startIndex, newChildren);\n    });\n  };\n  var lockedColFill = function lockedColFill(grid, generators, lockedColumns) {\n    return map$1(grid, function (row) {\n      return foldl(lockedColumns, function (acc, colNum) {\n        var newChild = generateElements(1, row, generators, always)[0];\n        return addCell(acc, colNum, newChild);\n      }, row);\n    });\n  };\n  var tailor = function tailor(gridA, delta, generators) {\n    var fillCols = delta.colDelta < 0 ? colFill : identity;\n    var fillRows = delta.rowDelta < 0 ? rowFill : identity;\n    var lockedColumns = getLockedColumnsFromGrid(gridA);\n    var gridWidth = cellLength(gridA[0]);\n    var isLastColLocked = exists(lockedColumns, function (locked) {\n      return locked === gridWidth - 1;\n    });\n    var modifiedCols = fillCols(gridA, Math.abs(delta.colDelta), generators, isLastColLocked ? gridWidth - 1 : gridWidth);\n    var newLockedColumns = getLockedColumnsFromGrid(modifiedCols);\n    return fillRows(modifiedCols, Math.abs(delta.rowDelta), generators, mapToObject(newLockedColumns, always));\n  };\n  var isSpanning = function isSpanning(grid, row, col, comparator) {\n    var candidate = getCell(grid[row], col);\n    var matching = curry(comparator, candidate.element);\n    var currentRow = grid[row];\n    return grid.length > 1 && cellLength(currentRow) > 1 && (col > 0 && matching(getCellElement(currentRow, col - 1)) || col < currentRow.cells.length - 1 && matching(getCellElement(currentRow, col + 1)) || row > 0 && matching(getCellElement(grid[row - 1], col)) || row < grid.length - 1 && matching(getCellElement(grid[row + 1], col)));\n  };\n  var mergeTables = function mergeTables(startAddress, gridA, gridB, generator, comparator, lockedColumns) {\n    var startRow = startAddress.row;\n    var startCol = startAddress.column;\n    var mergeHeight = gridB.length;\n    var mergeWidth = cellLength(gridB[0]);\n    var endRow = startRow + mergeHeight;\n    var endCol = startCol + mergeWidth + lockedColumns.length;\n    var lockedColumnObj = mapToObject(lockedColumns, always);\n    for (var r = startRow; r < endRow; r++) {\n      var skippedCol = 0;\n      for (var c = startCol; c < endCol; c++) {\n        if (lockedColumnObj[c]) {\n          skippedCol++;\n          continue;\n        }\n        if (isSpanning(gridA, r, c, comparator)) {\n          unmerge(gridA, getCellElement(gridA[r], c), comparator, generator.cell);\n        }\n        var gridBColIndex = c - startCol - skippedCol;\n        var newCell = getCell(gridB[r - startRow], gridBColIndex);\n        var newCellElm = newCell.element;\n        var replacement = generator.replace(newCellElm);\n        mutateCell(gridA[r], c, elementnew(replacement, true, newCell.isLocked));\n      }\n    }\n    return gridA;\n  };\n  var getValidStartAddress = function getValidStartAddress(currentStartAddress, grid, lockedColumns) {\n    var gridColLength = cellLength(grid[0]);\n    var adjustedRowAddress = extractGridDetails(grid).cols.length + currentStartAddress.row;\n    var possibleColAddresses = range$1(gridColLength - currentStartAddress.column, function (num) {\n      return num + currentStartAddress.column;\n    });\n    var validColAddress = find$1(possibleColAddresses, function (num) {\n      return forall(lockedColumns, function (col) {\n        return col !== num;\n      });\n    }).getOr(gridColLength - 1);\n    return {\n      row: adjustedRowAddress,\n      column: validColAddress\n    };\n  };\n  var getLockedColumnsWithinBounds = function getLockedColumnsWithinBounds(startAddress, grid, lockedColumns) {\n    return filter$2(lockedColumns, function (colNum) {\n      return colNum >= startAddress.column && colNum <= cellLength(grid[0]) + startAddress.column;\n    });\n  };\n  var merge$1 = function merge$1(startAddress, gridA, gridB, generator, comparator) {\n    var lockedColumns = getLockedColumnsFromGrid(gridA);\n    var validStartAddress = getValidStartAddress(startAddress, gridA, lockedColumns);\n    var gridBRows = extractGridDetails(gridB).rows;\n    var lockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridBRows, lockedColumns);\n    var result = measure(validStartAddress, gridA, gridBRows);\n    return result.map(function (diff) {\n      var delta = _assign(_assign({}, diff), {\n        colDelta: diff.colDelta - lockedColumnsWithinBounds.length\n      });\n      var fittedGrid = tailor(gridA, delta, generator);\n      var newLockedColumns = getLockedColumnsFromGrid(fittedGrid);\n      var newLockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridBRows, newLockedColumns);\n      return mergeTables(validStartAddress, fittedGrid, gridBRows, generator, comparator, newLockedColumnsWithinBounds);\n    });\n  };\n  var insertCols = function insertCols(index, gridA, gridB, generator, comparator) {\n    splitCols(gridA, index, comparator, generator.cell);\n    var delta = measureHeight(gridB, gridA);\n    var fittedNewGrid = tailor(gridB, delta, generator);\n    var secondDelta = measureHeight(gridA, fittedNewGrid);\n    var fittedOldGrid = tailor(gridA, secondDelta, generator);\n    return map$1(fittedOldGrid, function (gridRow, i) {\n      return addCells(gridRow, index, fittedNewGrid[i].cells);\n    });\n  };\n  var insertRows = function insertRows(index, gridA, gridB, generator, comparator) {\n    splitRows(gridA, index, comparator, generator.cell);\n    var locked = getLockedColumnsFromGrid(gridA);\n    var diff = measureWidth(gridA, gridB);\n    var delta = _assign(_assign({}, diff), {\n      colDelta: diff.colDelta - locked.length\n    });\n    var fittedOldGrid = tailor(gridA, delta, generator);\n    var _a = extractGridDetails(fittedOldGrid),\n      oldCols = _a.cols,\n      oldRows = _a.rows;\n    var newLocked = getLockedColumnsFromGrid(fittedOldGrid);\n    var secondDiff = measureWidth(gridB, gridA);\n    var secondDelta = _assign(_assign({}, secondDiff), {\n      colDelta: secondDiff.colDelta + newLocked.length\n    });\n    var fittedGridB = lockedColFill(gridB, generator, newLocked);\n    var fittedNewGrid = tailor(fittedGridB, secondDelta, generator);\n    return oldCols.concat(oldRows.slice(0, index)).concat(fittedNewGrid).concat(oldRows.slice(index, oldRows.length));\n  };\n  var cloneRow = function cloneRow(row, cloneCell, comparator, substitution) {\n    return clone$1(row, function (elem) {\n      return substitution(elem, comparator);\n    }, cloneCell);\n  };\n  var insertRowAt = function insertRowAt(grid, index, example, comparator, substitution) {\n    var _a = extractGridDetails(grid),\n      rows = _a.rows,\n      cols = _a.cols;\n    var before = rows.slice(0, index);\n    var after = rows.slice(index);\n    var newRow = cloneRow(rows[example], function (ex, c) {\n      var withinSpan = index > 0 && index < rows.length && comparator(getCellElement(rows[index - 1], c), getCellElement(rows[index], c));\n      var ret = withinSpan ? getCell(rows[index], c) : elementnew(substitution(ex.element, comparator), true, ex.isLocked);\n      return ret;\n    }, comparator, substitution);\n    return cols.concat(before).concat([newRow]).concat(after);\n  };\n  var getElementFor = function getElementFor(row, column, section, withinSpan, example, comparator, substitution) {\n    if (section === 'colgroup' || !withinSpan) {\n      var cell = getCell(row, example);\n      return elementnew(substitution(cell.element, comparator), true, false);\n    } else {\n      return getCell(row, column);\n    }\n  };\n  var insertColumnAt = function insertColumnAt(grid, index, example, comparator, substitution) {\n    return map$1(grid, function (row) {\n      var withinSpan = index > 0 && index < cellLength(row) && comparator(getCellElement(row, index - 1), getCellElement(row, index));\n      var sub = getElementFor(row, index, row.section, withinSpan, example, comparator, substitution);\n      return addCell(row, index, sub);\n    });\n  };\n  var deleteColumnsAt = function deleteColumnsAt(grid, columns) {\n    return bind$2(grid, function (row) {\n      var existingCells = row.cells;\n      var cells = foldr(columns, function (acc, column) {\n        return column >= 0 && column < acc.length ? acc.slice(0, column).concat(acc.slice(column + 1)) : acc;\n      }, existingCells);\n      return cells.length > 0 ? [rowcells(row.element, cells, row.section, row.isNew)] : [];\n    });\n  };\n  var deleteRowsAt = function deleteRowsAt(grid, start, finish) {\n    var _a = extractGridDetails(grid),\n      rows = _a.rows,\n      cols = _a.cols;\n    return cols.concat(rows.slice(0, start)).concat(rows.slice(finish + 1));\n  };\n  var notInStartRow = function notInStartRow(grid, rowIndex, colIndex, comparator) {\n    return getCellElement(grid[rowIndex], colIndex) !== undefined && rowIndex > 0 && comparator(getCellElement(grid[rowIndex - 1], colIndex), getCellElement(grid[rowIndex], colIndex));\n  };\n  var notInStartColumn = function notInStartColumn(row, index, comparator) {\n    return index > 0 && comparator(getCellElement(row, index - 1), getCellElement(row, index));\n  };\n  var isDuplicatedCell = function isDuplicatedCell(grid, rowIndex, colIndex, comparator) {\n    return notInStartRow(grid, rowIndex, colIndex, comparator) || notInStartColumn(grid[rowIndex], colIndex, comparator);\n  };\n  var rowReplacerPredicate = function rowReplacerPredicate(targetRow, columnHeaders) {\n    var entireTableIsHeader = forall(columnHeaders, identity) && isHeaderCells(targetRow.cells);\n    return entireTableIsHeader ? always : function (cell, _rowIndex, colIndex) {\n      var type = name(cell.element);\n      return !(type === 'th' && columnHeaders[colIndex]);\n    };\n  };\n  var columnReplacePredicate = function columnReplacePredicate(targetColumn, rowHeaders) {\n    var entireTableIsHeader = forall(rowHeaders, identity) && isHeaderCells(targetColumn);\n    return entireTableIsHeader ? always : function (cell, rowIndex, _colIndex) {\n      var type = name(cell.element);\n      return !(type === 'th' && rowHeaders[rowIndex]);\n    };\n  };\n  var determineScope = function determineScope(applyScope, element, newScope, isInHeader) {\n    var hasSpan = function hasSpan(scope) {\n      return scope === 'row' ? hasRowspan(element) : hasColspan(element);\n    };\n    var getScope = function getScope(scope) {\n      return hasSpan(scope) ? scope + 'group' : scope;\n    };\n    if (applyScope) {\n      return isHeaderCell(element) ? getScope(newScope) : null;\n    } else if (isInHeader && isHeaderCell(element)) {\n      var oppositeScope = newScope === 'row' ? 'col' : 'row';\n      return getScope(oppositeScope);\n    } else {\n      return null;\n    }\n  };\n  var rowScopeGenerator = function rowScopeGenerator(applyScope, columnHeaders) {\n    return function (cell, rowIndex, columnIndex) {\n      return Optional.some(determineScope(applyScope, cell.element, 'col', columnHeaders[columnIndex]));\n    };\n  };\n  var columnScopeGenerator = function columnScopeGenerator(applyScope, rowHeaders) {\n    return function (cell, rowIndex) {\n      return Optional.some(determineScope(applyScope, cell.element, 'row', rowHeaders[rowIndex]));\n    };\n  };\n  var replace = function replace(cell, comparator, substitute) {\n    return elementnew(substitute(cell.element, comparator), true, cell.isLocked);\n  };\n  var replaceIn = function replaceIn(grid, targets, comparator, substitute, replacer, genScope, shouldReplace) {\n    var isTarget = function isTarget(cell) {\n      return exists(targets, function (target) {\n        return comparator(cell.element, target.element);\n      });\n    };\n    return map$1(grid, function (row, rowIndex) {\n      return mapCells(row, function (cell, colIndex) {\n        if (isTarget(cell)) {\n          var newCell_1 = shouldReplace(cell, rowIndex, colIndex) ? replacer(cell, comparator, substitute) : cell;\n          genScope(newCell_1, rowIndex, colIndex).each(function (scope) {\n            setOptions(newCell_1.element, {\n              scope: Optional.from(scope)\n            });\n          });\n          return newCell_1;\n        } else {\n          return cell;\n        }\n      });\n    });\n  };\n  var getColumnCells = function getColumnCells(rows, columnIndex, comparator) {\n    return bind$2(rows, function (row, i) {\n      return isDuplicatedCell(rows, i, columnIndex, comparator) ? [] : [getCell(row, columnIndex)];\n    });\n  };\n  var getRowCells = function getRowCells(rows, rowIndex, comparator) {\n    var targetRow = rows[rowIndex];\n    return bind$2(targetRow.cells, function (item, i) {\n      return isDuplicatedCell(rows, rowIndex, i, comparator) ? [] : [item];\n    });\n  };\n  var replaceColumns = function replaceColumns(grid, indexes, applyScope, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n    var targets = bind$2(indexes, function (index) {\n      return getColumnCells(rows, index, comparator);\n    });\n    var rowHeaders = map$1(grid, function (row) {\n      return isHeaderCells(row.cells);\n    });\n    var shouldReplaceCell = columnReplacePredicate(targets, rowHeaders);\n    var scopeGenerator = columnScopeGenerator(applyScope, rowHeaders);\n    return replaceIn(grid, targets, comparator, substitution, replace, scopeGenerator, shouldReplaceCell);\n  };\n  var replaceRows = function replaceRows(grid, indexes, section, applyScope, comparator, substitution, tableSection) {\n    var _a = extractGridDetails(grid),\n      cols = _a.cols,\n      rows = _a.rows;\n    var targetRow = rows[indexes[0]];\n    var targets = bind$2(indexes, function (index) {\n      return getRowCells(rows, index, comparator);\n    });\n    var columnHeaders = map$1(targetRow.cells, function (_cell, index) {\n      return isHeaderCells(getColumnCells(rows, index, comparator));\n    });\n    var newRows = __spreadArray([], rows, true);\n    each$2(indexes, function (index) {\n      newRows[index] = tableSection.transformRow(rows[index], section);\n    });\n    var newGrid = cols.concat(newRows);\n    var shouldReplaceCell = rowReplacerPredicate(targetRow, columnHeaders);\n    var scopeGenerator = rowScopeGenerator(applyScope, columnHeaders);\n    return replaceIn(newGrid, targets, comparator, substitution, tableSection.transformCell, scopeGenerator, shouldReplaceCell);\n  };\n  var replaceCells = function replaceCells(grid, details, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n    var targetCells = map$1(details, function (detail) {\n      return getCell(rows[detail.row], detail.column);\n    });\n    return replaceIn(grid, targetCells, comparator, substitution, replace, Optional.none, always);\n  };\n  var uniqueColumns = function uniqueColumns(details) {\n    var uniqueCheck = function uniqueCheck(rest, detail) {\n      var columnExists = exists(rest, function (currentDetail) {\n        return currentDetail.column === detail.column;\n      });\n      return columnExists ? rest : rest.concat([detail]);\n    };\n    return foldl(details, uniqueCheck, []).sort(function (detailA, detailB) {\n      return detailA.column - detailB.column;\n    });\n  };\n  var isCol = isTag('col');\n  var isColgroup = isTag('colgroup');\n  var isRow$1 = function isRow$1(element) {\n    return name(element) === 'tr' || isColgroup(element);\n  };\n  var elementToData = function elementToData(element) {\n    var colspan = getAttrValue(element, 'colspan', 1);\n    var rowspan = getAttrValue(element, 'rowspan', 1);\n    return {\n      element: element,\n      colspan: colspan,\n      rowspan: rowspan\n    };\n  };\n  var modification = function modification(generators, toData) {\n    if (toData === void 0) {\n      toData = elementToData;\n    }\n    var nuCell = function nuCell(data) {\n      return isCol(data.element) ? generators.col(data) : generators.cell(data);\n    };\n    var nuRow = function nuRow(data) {\n      return isColgroup(data.element) ? generators.colgroup(data) : generators.row(data);\n    };\n    var add = function add(element) {\n      if (isRow$1(element)) {\n        return nuRow({\n          element: element\n        });\n      } else {\n        var replacement = nuCell(toData(element));\n        recent = Optional.some({\n          item: element,\n          replacement: replacement\n        });\n        return replacement;\n      }\n    };\n    var recent = Optional.none();\n    var getOrInit = function getOrInit(element, comparator) {\n      return recent.fold(function () {\n        return add(element);\n      }, function (p) {\n        return comparator(element, p.item) ? p.replacement : add(element);\n      });\n    };\n    return {\n      getOrInit: getOrInit\n    };\n  };\n  var transform = function transform(tag) {\n    return function (generators) {\n      var list = [];\n      var find = function find(element, comparator) {\n        return find$1(list, function (x) {\n          return comparator(x.item, element);\n        });\n      };\n      var makeNew = function makeNew(element) {\n        var attrs = tag === 'td' ? {\n          scope: null\n        } : {};\n        var cell = generators.replace(element, tag, attrs);\n        list.push({\n          item: element,\n          sub: cell\n        });\n        return cell;\n      };\n      var replaceOrInit = function replaceOrInit(element, comparator) {\n        if (isRow$1(element) || isCol(element)) {\n          return element;\n        } else {\n          return find(element, comparator).fold(function () {\n            return makeNew(element);\n          }, function (p) {\n            return comparator(element, p.item) ? p.sub : makeNew(element);\n          });\n        }\n      };\n      return {\n        replaceOrInit: replaceOrInit\n      };\n    };\n  };\n  var getScopeAttribute = function getScopeAttribute(cell) {\n    return getOpt(cell, 'scope').map(function (attribute) {\n      return attribute.substr(0, 3);\n    });\n  };\n  var merging = function merging(generators) {\n    var unmerge = function unmerge(cell) {\n      var scope = getScopeAttribute(cell);\n      scope.each(function (attribute) {\n        return set$2(cell, 'scope', attribute);\n      });\n      return function () {\n        var raw = generators.cell({\n          element: cell,\n          colspan: 1,\n          rowspan: 1\n        });\n        remove$6(raw, 'width');\n        remove$6(cell, 'width');\n        scope.each(function (attribute) {\n          return set$2(raw, 'scope', attribute);\n        });\n        return raw;\n      };\n    };\n    var merge = function merge(cells) {\n      var getScopeProperty = function getScopeProperty() {\n        var stringAttributes = cat(map$1(cells, getScopeAttribute));\n        if (stringAttributes.length === 0) {\n          return Optional.none();\n        } else {\n          var baseScope_1 = stringAttributes[0];\n          var scopes_1 = ['row', 'col'];\n          var isMixed = exists(stringAttributes, function (attribute) {\n            return attribute !== baseScope_1 && contains$2(scopes_1, attribute);\n          });\n          return isMixed ? Optional.none() : Optional.from(baseScope_1);\n        }\n      };\n      remove$6(cells[0], 'width');\n      getScopeProperty().fold(function () {\n        return remove$7(cells[0], 'scope');\n      }, function (attribute) {\n        return set$2(cells[0], 'scope', attribute + 'group');\n      });\n      return constant(cells[0]);\n    };\n    return {\n      unmerge: unmerge,\n      merge: merge\n    };\n  };\n  var Generators = {\n    modification: modification,\n    transform: transform,\n    merging: merging\n  };\n  var blockList = ['body', 'p', 'div', 'article', 'aside', 'figcaption', 'figure', 'footer', 'header', 'nav', 'section', 'ol', 'ul', 'table', 'thead', 'tfoot', 'tbody', 'caption', 'tr', 'td', 'th', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'address'];\n  var isList$1 = function isList$1(universe, item) {\n    var tagName = universe.property().name(item);\n    return contains$2(['ol', 'ul'], tagName);\n  };\n  var isBlock$1 = function isBlock$1(universe, item) {\n    var tagName = universe.property().name(item);\n    return contains$2(blockList, tagName);\n  };\n  var isEmptyTag$1 = function isEmptyTag$1(universe, item) {\n    return contains$2(['br', 'img', 'hr', 'input'], universe.property().name(item));\n  };\n  var universe$1 = DomUniverse();\n  var isBlock = function isBlock(element) {\n    return isBlock$1(universe$1, element);\n  };\n  var isList = function isList(element) {\n    return isList$1(universe$1, element);\n  };\n  var isEmptyTag = function isEmptyTag(element) {\n    return isEmptyTag$1(universe$1, element);\n  };\n  var merge = function merge(cells) {\n    var isBr = function isBr(el) {\n      return name(el) === 'br';\n    };\n    var advancedBr = function advancedBr(children) {\n      return forall(children, function (c) {\n        return isBr(c) || isText(c) && get$9(c).trim().length === 0;\n      });\n    };\n    var isListItem = function isListItem(el) {\n      return name(el) === 'li' || ancestor$2(el, isList).isSome();\n    };\n    var siblingIsBlock = function siblingIsBlock(el) {\n      return nextSibling(el).map(function (rightSibling) {\n        if (isBlock(rightSibling)) {\n          return true;\n        }\n        if (isEmptyTag(rightSibling)) {\n          return name(rightSibling) === 'img' ? false : true;\n        }\n        return false;\n      }).getOr(false);\n    };\n    var markCell = function markCell(cell) {\n      return last$1(cell).bind(function (rightEdge) {\n        var rightSiblingIsBlock = siblingIsBlock(rightEdge);\n        return parent(rightEdge).map(function (parent) {\n          return rightSiblingIsBlock === true || isListItem(parent) || isBr(rightEdge) || isBlock(parent) && !eq$1(cell, parent) ? [] : [SugarElement.fromTag('br')];\n        });\n      }).getOr([]);\n    };\n    var markContent = function markContent() {\n      var content = bind$2(cells, function (cell) {\n        var children = children$3(cell);\n        return advancedBr(children) ? [] : children.concat(markCell(cell));\n      });\n      return content.length === 0 ? [SugarElement.fromTag('br')] : content;\n    };\n    var contents = markContent();\n    empty(cells[0]);\n    append(cells[0], contents);\n  };\n  var isEditable = function isEditable(elem) {\n    return isEditable$1(elem, true);\n  };\n  var prune = function prune(table) {\n    var cells = cells$1(table);\n    if (cells.length === 0) {\n      remove$5(table);\n    }\n  };\n  var outcome = function outcome(grid, cursor) {\n    return {\n      grid: grid,\n      cursor: cursor\n    };\n  };\n  var findEditableCursorPosition = function findEditableCursorPosition(rows) {\n    return findMap(rows, function (row) {\n      return findMap(row.cells, function (cell) {\n        var elem = cell.element;\n        return someIf(isEditable(elem), elem);\n      });\n    });\n  };\n  var elementFromGrid = function elementFromGrid(grid, row, column) {\n    var _a, _b;\n    var rows = extractGridDetails(grid).rows;\n    return Optional.from((_b = (_a = rows[row]) === null || _a === void 0 ? void 0 : _a.cells[column]) === null || _b === void 0 ? void 0 : _b.element).filter(isEditable).orThunk(function () {\n      return findEditableCursorPosition(rows);\n    });\n  };\n  var bundle = function bundle(grid, row, column) {\n    var cursorElement = elementFromGrid(grid, row, column);\n    return outcome(grid, cursorElement);\n  };\n  var uniqueRows = function uniqueRows(details) {\n    var rowCompilation = function rowCompilation(rest, detail) {\n      var rowExists = exists(rest, function (currentDetail) {\n        return currentDetail.row === detail.row;\n      });\n      return rowExists ? rest : rest.concat([detail]);\n    };\n    return foldl(details, rowCompilation, []).sort(function (detailA, detailB) {\n      return detailA.row - detailB.row;\n    });\n  };\n  var opInsertRowsBefore = function opInsertRowsBefore(grid, details, comparator, genWrappers) {\n    var targetIndex = details[0].row;\n    var rows = uniqueRows(details);\n    var newGrid = foldr(rows, function (acc, row) {\n      var newG = insertRowAt(acc.grid, targetIndex, row.row + acc.delta, comparator, genWrappers.getOrInit);\n      return {\n        grid: newG,\n        delta: acc.delta + 1\n      };\n    }, {\n      grid: grid,\n      delta: 0\n    }).grid;\n    return bundle(newGrid, targetIndex, details[0].column);\n  };\n  var opInsertRowsAfter = function opInsertRowsAfter(grid, details, comparator, genWrappers) {\n    var rows = uniqueRows(details);\n    var target = rows[rows.length - 1];\n    var targetIndex = target.row + target.rowspan;\n    var newGrid = foldr(rows, function (newG, row) {\n      return insertRowAt(newG, targetIndex, row.row, comparator, genWrappers.getOrInit);\n    }, grid);\n    return bundle(newGrid, targetIndex, details[0].column);\n  };\n  var opInsertColumnsBefore = function opInsertColumnsBefore(grid, extractDetail, comparator, genWrappers) {\n    var details = extractDetail.details;\n    var columns = uniqueColumns(details);\n    var targetIndex = columns[0].column;\n    var newGrid = foldr(columns, function (acc, col) {\n      var newG = insertColumnAt(acc.grid, targetIndex, col.column + acc.delta, comparator, genWrappers.getOrInit);\n      return {\n        grid: newG,\n        delta: acc.delta + 1\n      };\n    }, {\n      grid: grid,\n      delta: 0\n    }).grid;\n    return bundle(newGrid, details[0].row, targetIndex);\n  };\n  var opInsertColumnsAfter = function opInsertColumnsAfter(grid, extractDetail, comparator, genWrappers) {\n    var details = extractDetail.details;\n    var target = details[details.length - 1];\n    var targetIndex = target.column + target.colspan;\n    var columns = uniqueColumns(details);\n    var newGrid = foldr(columns, function (newG, col) {\n      return insertColumnAt(newG, targetIndex, col.column, comparator, genWrappers.getOrInit);\n    }, grid);\n    return bundle(newGrid, details[0].row, targetIndex);\n  };\n  var opMakeColumnsHeader = function opMakeColumnsHeader(initialGrid, details, comparator, genWrappers) {\n    var columns = uniqueColumns(details);\n    var columnIndexes = map$1(columns, function (detail) {\n      return detail.column;\n    });\n    var newGrid = replaceColumns(initialGrid, columnIndexes, true, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n  var opMakeCellsHeader = function opMakeCellsHeader(initialGrid, details, comparator, genWrappers) {\n    var newGrid = replaceCells(initialGrid, details, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n  var opUnmakeColumnsHeader = function opUnmakeColumnsHeader(initialGrid, details, comparator, genWrappers) {\n    var columns = uniqueColumns(details);\n    var columnIndexes = map$1(columns, function (detail) {\n      return detail.column;\n    });\n    var newGrid = replaceColumns(initialGrid, columnIndexes, false, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n  var opUnmakeCellsHeader = function opUnmakeCellsHeader(initialGrid, details, comparator, genWrappers) {\n    var newGrid = replaceCells(initialGrid, details, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n  var makeRowsSection = function makeRowsSection(section, applyScope) {\n    return function (initialGrid, details, comparator, genWrappers, tableSection) {\n      var rows = uniqueRows(details);\n      var rowIndexes = map$1(rows, function (detail) {\n        return detail.row;\n      });\n      var newGrid = replaceRows(initialGrid, rowIndexes, section, applyScope, comparator, genWrappers.replaceOrInit, tableSection);\n      return bundle(newGrid, details[0].row, details[0].column);\n    };\n  };\n  var opMakeRowsHeader = makeRowsSection('thead', true);\n  var opMakeRowsBody = makeRowsSection('tbody', false);\n  var opMakeRowsFooter = makeRowsSection('tfoot', false);\n  var opEraseColumns = function opEraseColumns(grid, extractDetail, _comparator, _genWrappers) {\n    var columns = uniqueColumns(extractDetail.details);\n    var newGrid = deleteColumnsAt(grid, map$1(columns, function (column) {\n      return column.column;\n    }));\n    var maxColIndex = newGrid.length > 0 ? newGrid[0].cells.length - 1 : 0;\n    return bundle(newGrid, columns[0].row, Math.min(columns[0].column, maxColIndex));\n  };\n  var opEraseRows = function opEraseRows(grid, details, _comparator, _genWrappers) {\n    var rows = uniqueRows(details);\n    var newGrid = deleteRowsAt(grid, rows[0].row, rows[rows.length - 1].row);\n    var maxRowIndex = newGrid.length > 0 ? newGrid.length - 1 : 0;\n    return bundle(newGrid, Math.min(details[0].row, maxRowIndex), details[0].column);\n  };\n  var opMergeCells = function opMergeCells(grid, mergable, comparator, genWrappers) {\n    var cells = mergable.cells;\n    merge(cells);\n    var newGrid = merge$2(grid, mergable.bounds, comparator, genWrappers.merge(cells));\n    return outcome(newGrid, Optional.from(cells[0]));\n  };\n  var opUnmergeCells = function opUnmergeCells(grid, unmergable, comparator, genWrappers) {\n    var unmerge$1 = function unmerge$1(b, cell) {\n      return unmerge(b, cell, comparator, genWrappers.unmerge(cell));\n    };\n    var newGrid = foldr(unmergable, unmerge$1, grid);\n    return outcome(newGrid, Optional.from(unmergable[0]));\n  };\n  var opPasteCells = function opPasteCells(grid, pasteDetails, comparator, _genWrappers) {\n    var gridify = function gridify(table, generators) {\n      var wh = Warehouse.fromTable(table);\n      return toGrid(wh, generators, true);\n    };\n    var gridB = gridify(pasteDetails.clipboard, pasteDetails.generators);\n    var startAddress = address(pasteDetails.row, pasteDetails.column);\n    var mergedGrid = merge$1(startAddress, grid, gridB, pasteDetails.generators, comparator);\n    return mergedGrid.fold(function () {\n      return outcome(grid, Optional.some(pasteDetails.element));\n    }, function (newGrid) {\n      return bundle(newGrid, pasteDetails.row, pasteDetails.column);\n    });\n  };\n  var gridifyRows = function gridifyRows(rows, generators, context) {\n    var pasteDetails = fromPastedRows(rows, context.section);\n    var wh = Warehouse.generate(pasteDetails);\n    return toGrid(wh, generators, true);\n  };\n  var opPasteColsBefore = function opPasteColsBefore(grid, pasteDetails, comparator, _genWrappers) {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[0].column;\n    var context = rows[pasteDetails.cells[0].row];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);\n    return bundle(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n  };\n  var opPasteColsAfter = function opPasteColsAfter(grid, pasteDetails, comparator, _genWrappers) {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[pasteDetails.cells.length - 1].column + pasteDetails.cells[pasteDetails.cells.length - 1].colspan;\n    var context = rows[pasteDetails.cells[0].row];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);\n    return bundle(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n  };\n  var opPasteRowsBefore = function opPasteRowsBefore(grid, pasteDetails, comparator, _genWrappers) {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[0].row;\n    var context = rows[index];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);\n    return bundle(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n  };\n  var opPasteRowsAfter = function opPasteRowsAfter(grid, pasteDetails, comparator, _genWrappers) {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[pasteDetails.cells.length - 1].row + pasteDetails.cells[pasteDetails.cells.length - 1].rowspan;\n    var context = rows[pasteDetails.cells[0].row];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);\n    return bundle(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n  };\n  var opGetColumnsType = function opGetColumnsType(table, target) {\n    var house = Warehouse.fromTable(table);\n    var details = onCells(house, target);\n    return details.bind(function (selectedCells) {\n      var lastSelectedCell = selectedCells[selectedCells.length - 1];\n      var minColRange = selectedCells[0].column;\n      var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;\n      var selectedColumnCells = flatten$1(map$1(house.all, function (row) {\n        return filter$2(row.cells, function (cell) {\n          return cell.column >= minColRange && cell.column < maxColRange;\n        });\n      }));\n      return findCommonCellType(selectedColumnCells);\n    }).getOr('');\n  };\n  var opGetCellsType = function opGetCellsType(table, target) {\n    var house = Warehouse.fromTable(table);\n    var details = onCells(house, target);\n    return details.bind(findCommonCellType).getOr('');\n  };\n  var opGetRowsType = function opGetRowsType(table, target) {\n    var house = Warehouse.fromTable(table);\n    var details = onCells(house, target);\n    return details.bind(function (selectedCells) {\n      var lastSelectedCell = selectedCells[selectedCells.length - 1];\n      var minRowRange = selectedCells[0].row;\n      var maxRowRange = lastSelectedCell.row + lastSelectedCell.rowspan;\n      var selectedRows = house.all.slice(minRowRange, maxRowRange);\n      return findCommonRowType(selectedRows);\n    }).getOr('');\n  };\n  var resize = function resize(table, list, details, behaviours) {\n    return adjustWidthTo(table, list, details, behaviours.sizing);\n  };\n  var adjustAndRedistributeWidths = function adjustAndRedistributeWidths(table, list, details, behaviours) {\n    return adjustAndRedistributeWidths$1(table, list, details, behaviours.sizing, behaviours.resize);\n  };\n  var firstColumnIsLocked = function firstColumnIsLocked(_warehouse, details) {\n    return exists(details, function (detail) {\n      return detail.column === 0 && detail.isLocked;\n    });\n  };\n  var lastColumnIsLocked = function lastColumnIsLocked(warehouse, details) {\n    return exists(details, function (detail) {\n      return detail.column + detail.colspan >= warehouse.grid.columns && detail.isLocked;\n    });\n  };\n  var getColumnsWidth = function getColumnsWidth(warehouse, details) {\n    var columns$1 = columns(warehouse);\n    var uniqueCols = uniqueColumns(details);\n    return foldl(uniqueCols, function (acc, detail) {\n      var column = columns$1[detail.column];\n      var colWidth = column.map(getOuter$2).getOr(0);\n      return acc + colWidth;\n    }, 0);\n  };\n  var insertColumnsExtractor = function insertColumnsExtractor(before) {\n    return function (warehouse, target) {\n      return onCells(warehouse, target).filter(function (details) {\n        var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;\n        return !checkLocked(warehouse, details);\n      }).map(function (details) {\n        return {\n          details: details,\n          pixelDelta: getColumnsWidth(warehouse, details)\n        };\n      });\n    };\n  };\n  var eraseColumnsExtractor = function eraseColumnsExtractor(warehouse, target) {\n    return onUnlockedCells(warehouse, target).map(function (details) {\n      return {\n        details: details,\n        pixelDelta: -getColumnsWidth(warehouse, details)\n      };\n    });\n  };\n  var pasteColumnsExtractor = function pasteColumnsExtractor(before) {\n    return function (warehouse, target) {\n      return onPasteByEditor(warehouse, target).filter(function (details) {\n        var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;\n        return !checkLocked(warehouse, details.cells);\n      });\n    };\n  };\n  var headerCellGenerator = Generators.transform('th');\n  var bodyCellGenerator = Generators.transform('td');\n  var insertRowsBefore = run(opInsertRowsBefore, onCells, noop, noop, Generators.modification);\n  var insertRowsAfter = run(opInsertRowsAfter, onCells, noop, noop, Generators.modification);\n  var insertColumnsBefore = run(opInsertColumnsBefore, insertColumnsExtractor(true), adjustAndRedistributeWidths, noop, Generators.modification);\n  var insertColumnsAfter = run(opInsertColumnsAfter, insertColumnsExtractor(false), adjustAndRedistributeWidths, noop, Generators.modification);\n  var eraseColumns = run(opEraseColumns, eraseColumnsExtractor, adjustAndRedistributeWidths, prune, Generators.modification);\n  var eraseRows = run(opEraseRows, onCells, noop, prune, Generators.modification);\n  var makeColumnsHeader = run(opMakeColumnsHeader, onUnlockedCells, noop, noop, headerCellGenerator);\n  var unmakeColumnsHeader = run(opUnmakeColumnsHeader, onUnlockedCells, noop, noop, bodyCellGenerator);\n  var makeRowsHeader = run(opMakeRowsHeader, onUnlockedCells, noop, noop, headerCellGenerator);\n  var makeRowsBody = run(opMakeRowsBody, onUnlockedCells, noop, noop, bodyCellGenerator);\n  var makeRowsFooter = run(opMakeRowsFooter, onUnlockedCells, noop, noop, bodyCellGenerator);\n  var makeCellsHeader = run(opMakeCellsHeader, onUnlockedCells, noop, noop, headerCellGenerator);\n  var unmakeCellsHeader = run(opUnmakeCellsHeader, onUnlockedCells, noop, noop, bodyCellGenerator);\n  var mergeCells = run(opMergeCells, onUnlockedMergable, resize, noop, Generators.merging);\n  var unmergeCells = run(opUnmergeCells, onUnlockedUnmergable, resize, noop, Generators.merging);\n  var pasteCells = run(opPasteCells, onPaste, resize, noop, Generators.modification);\n  var pasteColsBefore = run(opPasteColsBefore, pasteColumnsExtractor(true), noop, noop, Generators.modification);\n  var pasteColsAfter = run(opPasteColsAfter, pasteColumnsExtractor(false), noop, noop, Generators.modification);\n  var pasteRowsBefore = run(opPasteRowsBefore, onPasteByEditor, noop, noop, Generators.modification);\n  var pasteRowsAfter = run(opPasteRowsAfter, onPasteByEditor, noop, noop, Generators.modification);\n  var getColumnsType = opGetColumnsType;\n  var getCellsType = opGetCellsType;\n  var getRowsType = opGetRowsType;\n  var TableActions = function TableActions(editor, cellSelection, lazyWire) {\n    var isTableBody = function isTableBody(editor) {\n      return name(getBody(editor)) === 'table';\n    };\n    var lastRowGuard = function lastRowGuard(table) {\n      return isTableBody(editor) === false || getGridSize(table).rows > 1;\n    };\n    var lastColumnGuard = function lastColumnGuard(table) {\n      return isTableBody(editor) === false || getGridSize(table).columns > 1;\n    };\n    var cloneFormats = getCloneElements(editor);\n    var colMutationOp = isResizeTableColumnResizing(editor) ? noop : halve;\n    var getTableSectionType = function getTableSectionType(table) {\n      switch (getTableHeaderType(editor)) {\n        case 'section':\n          return TableSection.section();\n        case 'sectionCells':\n          return TableSection.sectionCells();\n        case 'cells':\n          return TableSection.cells();\n        default:\n          return TableSection.getTableSectionType(table, 'section');\n      }\n    };\n    var setSelectionFromAction = function setSelectionFromAction(table, result) {\n      return result.cursor.fold(function () {\n        var cells = cells$1(table);\n        return head(cells).filter(_inBody).map(function (firstCell) {\n          cellSelection.clear(table);\n          var rng = editor.dom.createRng();\n          rng.selectNode(firstCell.dom);\n          editor.selection.setRng(rng);\n          set$2(firstCell, 'data-mce-selected', '1');\n          return rng;\n        });\n      }, function (cell) {\n        var des = freefallRtl(cell);\n        var rng = editor.dom.createRng();\n        rng.setStart(des.element.dom, des.offset);\n        rng.setEnd(des.element.dom, des.offset);\n        editor.selection.setRng(rng);\n        cellSelection.clear(table);\n        return Optional.some(rng);\n      });\n    };\n    var execute = function execute(operation, guard, mutate, lazyWire, effect) {\n      return function (table, target, noEvents) {\n        if (noEvents === void 0) {\n          noEvents = false;\n        }\n        removeDataStyle(table);\n        var wire = lazyWire();\n        var doc = SugarElement.fromDom(editor.getDoc());\n        var generators = cellOperations(mutate, doc, cloneFormats);\n        var behaviours = {\n          sizing: get$4(editor, table),\n          resize: isResizeTableColumnResizing(editor) ? resizeTable() : preserveTable(),\n          section: getTableSectionType(table)\n        };\n        return guard(table) ? operation(wire, table, target, generators, behaviours).bind(function (result) {\n          each$2(result.newRows, function (row) {\n            fireNewRow(editor, row.dom);\n          });\n          each$2(result.newCells, function (cell) {\n            fireNewCell(editor, cell.dom);\n          });\n          var range = setSelectionFromAction(table, result);\n          if (_inBody(table)) {\n            removeDataStyle(table);\n            if (!noEvents) {\n              fireTableModified(editor, table.dom, effect);\n            }\n          }\n          return range.map(function (rng) {\n            return {\n              rng: rng,\n              effect: effect\n            };\n          });\n        }) : Optional.none();\n      };\n    };\n    var deleteRow = execute(eraseRows, lastRowGuard, noop, lazyWire, structureModified);\n    var deleteColumn = execute(eraseColumns, lastColumnGuard, noop, lazyWire, structureModified);\n    var insertRowsBefore$1 = execute(insertRowsBefore, always, noop, lazyWire, structureModified);\n    var insertRowsAfter$1 = execute(insertRowsAfter, always, noop, lazyWire, structureModified);\n    var insertColumnsBefore$1 = execute(insertColumnsBefore, always, colMutationOp, lazyWire, structureModified);\n    var insertColumnsAfter$1 = execute(insertColumnsAfter, always, colMutationOp, lazyWire, structureModified);\n    var mergeCells$1 = execute(mergeCells, always, noop, lazyWire, structureModified);\n    var unmergeCells$1 = execute(unmergeCells, always, noop, lazyWire, structureModified);\n    var pasteColsBefore$1 = execute(pasteColsBefore, always, noop, lazyWire, structureModified);\n    var pasteColsAfter$1 = execute(pasteColsAfter, always, noop, lazyWire, structureModified);\n    var pasteRowsBefore$1 = execute(pasteRowsBefore, always, noop, lazyWire, structureModified);\n    var pasteRowsAfter$1 = execute(pasteRowsAfter, always, noop, lazyWire, structureModified);\n    var pasteCells$1 = execute(pasteCells, always, noop, lazyWire, styleAndStructureModified);\n    var makeCellsHeader$1 = execute(makeCellsHeader, always, noop, lazyWire, structureModified);\n    var unmakeCellsHeader$1 = execute(unmakeCellsHeader, always, noop, lazyWire, structureModified);\n    var makeColumnsHeader$1 = execute(makeColumnsHeader, always, noop, lazyWire, structureModified);\n    var unmakeColumnsHeader$1 = execute(unmakeColumnsHeader, always, noop, lazyWire, structureModified);\n    var makeRowsHeader$1 = execute(makeRowsHeader, always, noop, lazyWire, structureModified);\n    var makeRowsBody$1 = execute(makeRowsBody, always, noop, lazyWire, structureModified);\n    var makeRowsFooter$1 = execute(makeRowsFooter, always, noop, lazyWire, structureModified);\n    var getTableCellType = getCellsType;\n    var getTableColType = getColumnsType;\n    var getTableRowType = getRowsType;\n    return {\n      deleteRow: deleteRow,\n      deleteColumn: deleteColumn,\n      insertRowsBefore: insertRowsBefore$1,\n      insertRowsAfter: insertRowsAfter$1,\n      insertColumnsBefore: insertColumnsBefore$1,\n      insertColumnsAfter: insertColumnsAfter$1,\n      mergeCells: mergeCells$1,\n      unmergeCells: unmergeCells$1,\n      pasteColsBefore: pasteColsBefore$1,\n      pasteColsAfter: pasteColsAfter$1,\n      pasteRowsBefore: pasteRowsBefore$1,\n      pasteRowsAfter: pasteRowsAfter$1,\n      pasteCells: pasteCells$1,\n      makeCellsHeader: makeCellsHeader$1,\n      unmakeCellsHeader: unmakeCellsHeader$1,\n      makeColumnsHeader: makeColumnsHeader$1,\n      unmakeColumnsHeader: unmakeColumnsHeader$1,\n      makeRowsHeader: makeRowsHeader$1,\n      makeRowsBody: makeRowsBody$1,\n      makeRowsFooter: makeRowsFooter$1,\n      getTableRowType: getTableRowType,\n      getTableCellType: getTableCellType,\n      getTableColType: getTableColType\n    };\n  };\n  var DefaultRenderOptions = {\n    styles: {\n      'border-collapse': 'collapse',\n      'width': '100%'\n    },\n    attributes: {\n      border: '1'\n    },\n    colGroups: false\n  };\n  var tableHeaderCell = function tableHeaderCell() {\n    return SugarElement.fromTag('th');\n  };\n  var tableCell = function tableCell() {\n    return SugarElement.fromTag('td');\n  };\n  var tableColumn = function tableColumn() {\n    return SugarElement.fromTag('col');\n  };\n  var createRow = function createRow(columns, rowHeaders, columnHeaders, rowIndex) {\n    var tr = SugarElement.fromTag('tr');\n    for (var j = 0; j < columns; j++) {\n      var td = rowIndex < rowHeaders || j < columnHeaders ? tableHeaderCell() : tableCell();\n      if (j < columnHeaders) {\n        set$2(td, 'scope', 'row');\n      }\n      if (rowIndex < rowHeaders) {\n        set$2(td, 'scope', 'col');\n      }\n      append$1(td, SugarElement.fromTag('br'));\n      append$1(tr, td);\n    }\n    return tr;\n  };\n  var createGroupRow = function createGroupRow(columns) {\n    var columnGroup = SugarElement.fromTag('colgroup');\n    range$1(columns, function () {\n      return append$1(columnGroup, tableColumn());\n    });\n    return columnGroup;\n  };\n  var createRows = function createRows(rows, columns, rowHeaders, columnHeaders) {\n    return range$1(rows, function (r) {\n      return createRow(columns, rowHeaders, columnHeaders, r);\n    });\n  };\n  var render = function render(rows, columns, rowHeaders, columnHeaders, headerType, renderOpts) {\n    if (renderOpts === void 0) {\n      renderOpts = DefaultRenderOptions;\n    }\n    var table = SugarElement.fromTag('table');\n    var rowHeadersGoInThead = headerType !== 'cells';\n    setAll(table, renderOpts.styles);\n    setAll$1(table, renderOpts.attributes);\n    if (renderOpts.colGroups) {\n      append$1(table, createGroupRow(columns));\n    }\n    var actualRowHeaders = Math.min(rows, rowHeaders);\n    if (rowHeadersGoInThead && rowHeaders > 0) {\n      var thead = SugarElement.fromTag('thead');\n      append$1(table, thead);\n      var theadRowHeaders = headerType === 'sectionCells' ? actualRowHeaders : 0;\n      var theadRows = createRows(rowHeaders, columns, theadRowHeaders, columnHeaders);\n      append(thead, theadRows);\n    }\n    var tbody = SugarElement.fromTag('tbody');\n    append$1(table, tbody);\n    var numRows = rowHeadersGoInThead ? rows - actualRowHeaders : rows;\n    var numRowHeaders = rowHeadersGoInThead ? 0 : rowHeaders;\n    var tbodyRows = createRows(numRows, columns, numRowHeaders, columnHeaders);\n    append(tbody, tbodyRows);\n    return table;\n  };\n  var get$2 = function get$2(element) {\n    return element.dom.innerHTML;\n  };\n  var getOuter = function getOuter(element) {\n    var container = SugarElement.fromTag('div');\n    var clone = SugarElement.fromDom(element.dom.cloneNode(true));\n    append$1(container, clone);\n    return get$2(container);\n  };\n  var placeCaretInCell = function placeCaretInCell(editor, cell) {\n    editor.selection.select(cell.dom, true);\n    editor.selection.collapse(true);\n  };\n  var selectFirstCellInTable = function selectFirstCellInTable(editor, tableElm) {\n    descendant(tableElm, 'td,th').each(curry(placeCaretInCell, editor));\n  };\n  var fireEvents = function fireEvents(editor, table) {\n    each$2(descendants(table, 'tr'), function (row) {\n      fireNewRow(editor, row.dom);\n      each$2(descendants(row, 'th,td'), function (cell) {\n        fireNewCell(editor, cell.dom);\n      });\n    });\n  };\n  var isPercentage = function isPercentage(width) {\n    return isString(width) && width.indexOf('%') !== -1;\n  };\n  var insert = function insert(editor, columns, rows, colHeaders, rowHeaders) {\n    var defaultStyles = getDefaultStyles(editor);\n    var options = {\n      styles: defaultStyles,\n      attributes: getDefaultAttributes(editor),\n      colGroups: useColumnGroup(editor)\n    };\n    editor.undoManager.ignore(function () {\n      var table = render(rows, columns, rowHeaders, colHeaders, getTableHeaderType(editor), options);\n      set$2(table, 'data-mce-id', '__mce');\n      var html = getOuter(table);\n      editor.insertContent(html);\n      editor.addVisual();\n    });\n    return descendant(getBody(editor), 'table[data-mce-id=\"__mce\"]').map(function (table) {\n      if (isPixelsForced(editor)) {\n        enforcePixels(table);\n      } else if (isResponsiveForced(editor)) {\n        enforceNone(table);\n      } else if (isPercentagesForced(editor) || isPercentage(defaultStyles.width)) {\n        enforcePercentage(table);\n      }\n      removeDataStyle(table);\n      remove$7(table, 'data-mce-id');\n      fireEvents(editor, table);\n      selectFirstCellInTable(editor, table);\n      return table.dom;\n    }).getOr(null);\n  };\n  var insertTableWithDataValidation = function insertTableWithDataValidation(editor, rows, columns, options, errorMsg) {\n    if (options === void 0) {\n      options = {};\n    }\n    var checkInput = function checkInput(val) {\n      return isNumber(val) && val > 0;\n    };\n    if (checkInput(rows) && checkInput(columns)) {\n      var headerRows = options.headerRows || 0;\n      var headerColumns = options.headerColumns || 0;\n      return insert(editor, columns, rows, headerColumns, headerRows);\n    } else {\n      console.error(errorMsg);\n      return null;\n    }\n  };\n  var getClipboardElements = function getClipboardElements(getClipboard) {\n    return function () {\n      return getClipboard().fold(function () {\n        return [];\n      }, function (elems) {\n        return map$1(elems, function (e) {\n          return e.dom;\n        });\n      });\n    };\n  };\n  var setClipboardElements = function setClipboardElements(setClipboard) {\n    return function (elems) {\n      var elmsOpt = elems.length > 0 ? Optional.some(fromDom(elems)) : Optional.none();\n      setClipboard(elmsOpt);\n    };\n  };\n  var insertTable = function insertTable(editor) {\n    return function (columns, rows, options) {\n      if (options === void 0) {\n        options = {};\n      }\n      var table = insertTableWithDataValidation(editor, rows, columns, options, 'Invalid values for insertTable - rows and columns values are required to insert a table.');\n      editor.undoManager.add();\n      return table;\n    };\n  };\n  var getApi = function getApi(editor, clipboard, resizeHandler, selectionTargets) {\n    return {\n      insertTable: insertTable(editor),\n      setClipboardRows: setClipboardElements(clipboard.setRows),\n      getClipboardRows: getClipboardElements(clipboard.getRows),\n      setClipboardCols: setClipboardElements(clipboard.setColumns),\n      getClipboardCols: getClipboardElements(clipboard.getColumns),\n      resizeHandler: resizeHandler,\n      selectionTargets: selectionTargets\n    };\n  };\n  var constrainSpan = function constrainSpan(element, property, value) {\n    var currentColspan = getAttrValue(element, property, 1);\n    if (value === 1 || currentColspan <= 1) {\n      remove$7(element, property);\n    } else {\n      set$2(element, property, Math.min(value, currentColspan));\n    }\n  };\n  var generateColGroup = function generateColGroup(house, minColRange, maxColRange) {\n    if (Warehouse.hasColumns(house)) {\n      var colsToCopy = filter$2(Warehouse.justColumns(house), function (col) {\n        return col.column >= minColRange && col.column < maxColRange;\n      });\n      var copiedCols = map$1(colsToCopy, function (c) {\n        var clonedCol = deep(c.element);\n        constrainSpan(clonedCol, 'span', maxColRange - minColRange);\n        return clonedCol;\n      });\n      var fakeColgroup = SugarElement.fromTag('colgroup');\n      append(fakeColgroup, copiedCols);\n      return [fakeColgroup];\n    } else {\n      return [];\n    }\n  };\n  var generateRows = function generateRows(house, minColRange, maxColRange) {\n    return map$1(house.all, function (row) {\n      var cellsToCopy = filter$2(row.cells, function (cell) {\n        return cell.column >= minColRange && cell.column < maxColRange;\n      });\n      var copiedCells = map$1(cellsToCopy, function (cell) {\n        var clonedCell = deep(cell.element);\n        constrainSpan(clonedCell, 'colspan', maxColRange - minColRange);\n        return clonedCell;\n      });\n      var fakeTR = SugarElement.fromTag('tr');\n      append(fakeTR, copiedCells);\n      return fakeTR;\n    });\n  };\n  var copyCols = function copyCols(table, target) {\n    var house = Warehouse.fromTable(table);\n    var details = onUnlockedCells(house, target);\n    return details.map(function (selectedCells) {\n      var lastSelectedCell = selectedCells[selectedCells.length - 1];\n      var minColRange = selectedCells[0].column;\n      var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;\n      var fakeColGroups = generateColGroup(house, minColRange, maxColRange);\n      var fakeRows = generateRows(house, minColRange, maxColRange);\n      return __spreadArray(__spreadArray([], fakeColGroups, true), fakeRows, true);\n    });\n  };\n  var copyRows = function copyRows(table, target, generators) {\n    var warehouse = Warehouse.fromTable(table);\n    var details = onCells(warehouse, target);\n    return details.bind(function (selectedCells) {\n      var grid = toGrid(warehouse, generators, false);\n      var rows = extractGridDetails(grid).rows;\n      var slicedGrid = rows.slice(selectedCells[0].row, selectedCells[selectedCells.length - 1].row + selectedCells[selectedCells.length - 1].rowspan);\n      var filteredGrid = bind$2(slicedGrid, function (row) {\n        var newCells = filter$2(row.cells, function (cell) {\n          return !cell.isLocked;\n        });\n        return newCells.length > 0 ? [_assign(_assign({}, row), {\n          cells: newCells\n        })] : [];\n      });\n      var slicedDetails = toDetailList(filteredGrid);\n      return someIf(slicedDetails.length > 0, slicedDetails);\n    }).map(function (slicedDetails) {\n      return copy(slicedDetails);\n    });\n  };\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var getTDTHOverallStyle = function getTDTHOverallStyle(dom, elm, name) {\n    var cells = dom.select('td,th', elm);\n    var firstChildStyle;\n    var checkChildren = function checkChildren(firstChildStyle, elms) {\n      for (var i = 0; i < elms.length; i++) {\n        var currentStyle = dom.getStyle(elms[i], name);\n        if (typeof firstChildStyle === 'undefined') {\n          firstChildStyle = currentStyle;\n        }\n        if (firstChildStyle !== currentStyle) {\n          return '';\n        }\n      }\n      return firstChildStyle;\n    };\n    return checkChildren(firstChildStyle, cells);\n  };\n  var applyAlign = function applyAlign(editor, elm, name) {\n    if (name) {\n      editor.formatter.apply('align' + name, {}, elm);\n    }\n  };\n  var applyVAlign = function applyVAlign(editor, elm, name) {\n    if (name) {\n      editor.formatter.apply('valign' + name, {}, elm);\n    }\n  };\n  var unApplyAlign = function unApplyAlign(editor, elm) {\n    global$2.each('left center right'.split(' '), function (name) {\n      editor.formatter.remove('align' + name, {}, elm);\n    });\n  };\n  var unApplyVAlign = function unApplyVAlign(editor, elm) {\n    global$2.each('top middle bottom'.split(' '), function (name) {\n      editor.formatter.remove('valign' + name, {}, elm);\n    });\n  };\n  var verticalAlignValues = [{\n    text: 'None',\n    value: ''\n  }, {\n    text: 'Top',\n    value: 'top'\n  }, {\n    text: 'Middle',\n    value: 'middle'\n  }, {\n    text: 'Bottom',\n    value: 'bottom'\n  }];\n  var hexColour = function hexColour(value) {\n    return {\n      value: value\n    };\n  };\n  var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n  var longformRegex = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i;\n  var isHexString = function isHexString(hex) {\n    return shorthandRegex.test(hex) || longformRegex.test(hex);\n  };\n  var normalizeHex = function normalizeHex(hex) {\n    return removeLeading(hex, '#').toUpperCase();\n  };\n  var fromString$1 = function fromString$1(hex) {\n    return isHexString(hex) ? Optional.some({\n      value: normalizeHex(hex)\n    }) : Optional.none();\n  };\n  var toHex = function toHex(component) {\n    var hex = component.toString(16);\n    return (hex.length === 1 ? '0' + hex : hex).toUpperCase();\n  };\n  var fromRgba = function fromRgba(rgbaColour) {\n    var value = toHex(rgbaColour.red) + toHex(rgbaColour.green) + toHex(rgbaColour.blue);\n    return hexColour(value);\n  };\n  var rgbRegex = /^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/;\n  var rgbaRegex = /^rgba\\((\\d+),\\s*(\\d+),\\s*(\\d+),\\s*(\\d?(?:\\.\\d+)?)\\)/;\n  var rgbaColour = function rgbaColour(red, green, blue, alpha) {\n    return {\n      red: red,\n      green: green,\n      blue: blue,\n      alpha: alpha\n    };\n  };\n  var fromStringValues = function fromStringValues(red, green, blue, alpha) {\n    var r = parseInt(red, 10);\n    var g = parseInt(green, 10);\n    var b = parseInt(blue, 10);\n    var a = parseFloat(alpha);\n    return rgbaColour(r, g, b, a);\n  };\n  var fromString = function fromString(rgbaString) {\n    if (rgbaString === 'transparent') {\n      return Optional.some(rgbaColour(0, 0, 0, 0));\n    }\n    var rgbMatch = rgbRegex.exec(rgbaString);\n    if (rgbMatch !== null) {\n      return Optional.some(fromStringValues(rgbMatch[1], rgbMatch[2], rgbMatch[3], '1'));\n    }\n    var rgbaMatch = rgbaRegex.exec(rgbaString);\n    if (rgbaMatch !== null) {\n      return Optional.some(fromStringValues(rgbaMatch[1], rgbaMatch[2], rgbaMatch[3], rgbaMatch[4]));\n    }\n    return Optional.none();\n  };\n  var anyToHex = function anyToHex(color) {\n    return fromString$1(color).orThunk(function () {\n      return fromString(color).map(fromRgba);\n    }).getOrThunk(function () {\n      var canvas = document.createElement('canvas');\n      canvas.height = 1;\n      canvas.width = 1;\n      var canvasContext = canvas.getContext('2d');\n      canvasContext.clearRect(0, 0, canvas.width, canvas.height);\n      canvasContext.fillStyle = '#FFFFFF';\n      canvasContext.fillStyle = color;\n      canvasContext.fillRect(0, 0, 1, 1);\n      var rgba = canvasContext.getImageData(0, 0, 1, 1).data;\n      var r = rgba[0];\n      var g = rgba[1];\n      var b = rgba[2];\n      var a = rgba[3];\n      return fromRgba(rgbaColour(r, g, b, a));\n    });\n  };\n  var Cell = function Cell(initial) {\n    var value = initial;\n    var get = function get() {\n      return value;\n    };\n    var set = function set(v) {\n      value = v;\n    };\n    return {\n      get: get,\n      set: set\n    };\n  };\n  var singleton = function singleton(doRevoke) {\n    var subject = Cell(Optional.none());\n    var revoke = function revoke() {\n      return subject.get().each(doRevoke);\n    };\n    var clear = function clear() {\n      revoke();\n      subject.set(Optional.none());\n    };\n    var isSet = function isSet() {\n      return subject.get().isSome();\n    };\n    var get = function get() {\n      return subject.get();\n    };\n    var set = function set(s) {\n      revoke();\n      subject.set(Optional.some(s));\n    };\n    return {\n      clear: clear,\n      isSet: isSet,\n      get: get,\n      set: set\n    };\n  };\n  var unbindable = function unbindable() {\n    return singleton(function (s) {\n      return s.unbind();\n    });\n  };\n  var value = function value() {\n    var subject = singleton(noop);\n    var on = function on(f) {\n      return subject.get().each(f);\n    };\n    return _assign(_assign({}, subject), {\n      on: on\n    });\n  };\n  var onSetupToggle = function onSetupToggle(editor, selections, formatName, formatValue) {\n    return function (api) {\n      var boundCallback = unbindable();\n      var isNone = isEmpty$1(formatValue);\n      var init = function init() {\n        var selectedCells = getCellsFromSelection(selections);\n        var checkNode = function checkNode(cell) {\n          return editor.formatter.match(formatName, {\n            value: formatValue\n          }, cell.dom, isNone);\n        };\n        if (isNone) {\n          api.setActive(!exists(selectedCells, checkNode));\n          boundCallback.set(editor.formatter.formatChanged(formatName, function (match) {\n            return api.setActive(!match);\n          }, true));\n        } else {\n          api.setActive(forall(selectedCells, checkNode));\n          boundCallback.set(editor.formatter.formatChanged(formatName, api.setActive, false, {\n            value: formatValue\n          }));\n        }\n      };\n      editor.initialized ? init() : editor.on('init', init);\n      return boundCallback.clear;\n    };\n  };\n  var isListGroup = function isListGroup(item) {\n    return hasNonNullableKey(item, 'menu');\n  };\n  var _buildListItems = function buildListItems(items) {\n    return map$1(items, function (item) {\n      var text = item.text || item.title;\n      if (isListGroup(item)) {\n        return {\n          text: text,\n          items: _buildListItems(item.menu)\n        };\n      } else {\n        return {\n          text: text,\n          value: item.value\n        };\n      }\n    });\n  };\n  var _buildMenuItems = function buildMenuItems(editor, selections, items, format, _onAction) {\n    return map$1(items, function (item) {\n      var text = item.text || item.title;\n      if (isListGroup(item)) {\n        return {\n          type: 'nestedmenuitem',\n          text: text,\n          getSubmenuItems: function getSubmenuItems() {\n            return _buildMenuItems(editor, selections, item.menu, format, _onAction);\n          }\n        };\n      } else {\n        return {\n          text: text,\n          type: 'togglemenuitem',\n          onAction: function onAction() {\n            return _onAction(item.value);\n          },\n          onSetup: onSetupToggle(editor, selections, format, item.value)\n        };\n      }\n    });\n  };\n  var applyTableCellStyle = function applyTableCellStyle(editor, style) {\n    return function (value) {\n      var _a;\n      editor.execCommand('mceTableApplyCellStyle', false, (_a = {}, _a[style] = value, _a));\n    };\n  };\n  var _filterNoneItem = function filterNoneItem(list) {\n    return bind$2(list, function (item) {\n      if (isListGroup(item)) {\n        return [_assign(_assign({}, item), {\n          menu: _filterNoneItem(item.menu)\n        })];\n      } else {\n        return isNotEmpty(item.value) ? [item] : [];\n      }\n    });\n  };\n  var generateMenuItemsCallback = function generateMenuItemsCallback(editor, selections, items, format, onAction) {\n    return function (callback) {\n      return callback(_buildMenuItems(editor, selections, items, format, onAction));\n    };\n  };\n  var buildColorMenu = function buildColorMenu(editor, colorList, style) {\n    var colorMap = map$1(colorList, function (entry) {\n      return {\n        text: entry.title,\n        value: '#' + anyToHex(entry.value).value,\n        type: 'choiceitem'\n      };\n    });\n    return [{\n      type: 'fancymenuitem',\n      fancytype: 'colorswatch',\n      initData: {\n        colors: colorMap.length > 0 ? colorMap : undefined,\n        allowCustomColors: false\n      },\n      onAction: function onAction(data) {\n        var _a;\n        var value = data.value === 'remove' ? '' : data.value;\n        editor.execCommand('mceTableApplyCellStyle', false, (_a = {}, _a[style] = value, _a));\n      }\n    }];\n  };\n  var changeRowHeader = function changeRowHeader(editor) {\n    return function () {\n      var currentType = editor.queryCommandValue('mceTableRowType');\n      var newType = currentType === 'header' ? 'body' : 'header';\n      editor.execCommand('mceTableRowType', false, {\n        type: newType\n      });\n    };\n  };\n  var changeColumnHeader = function changeColumnHeader(editor) {\n    return function () {\n      var currentType = editor.queryCommandValue('mceTableColType');\n      var newType = currentType === 'th' ? 'td' : 'th';\n      editor.execCommand('mceTableColType', false, {\n        type: newType\n      });\n    };\n  };\n  var getClassList$1 = function getClassList$1(editor) {\n    var classes = _buildListItems(getCellClassList(editor));\n    if (classes.length > 0) {\n      return Optional.some({\n        name: 'class',\n        type: 'listbox',\n        label: 'Class',\n        items: classes\n      });\n    }\n    return Optional.none();\n  };\n  var children = [{\n    name: 'width',\n    type: 'input',\n    label: 'Width'\n  }, {\n    name: 'height',\n    type: 'input',\n    label: 'Height'\n  }, {\n    name: 'celltype',\n    type: 'listbox',\n    label: 'Cell type',\n    items: [{\n      text: 'Cell',\n      value: 'td'\n    }, {\n      text: 'Header cell',\n      value: 'th'\n    }]\n  }, {\n    name: 'scope',\n    type: 'listbox',\n    label: 'Scope',\n    items: [{\n      text: 'None',\n      value: ''\n    }, {\n      text: 'Row',\n      value: 'row'\n    }, {\n      text: 'Column',\n      value: 'col'\n    }, {\n      text: 'Row group',\n      value: 'rowgroup'\n    }, {\n      text: 'Column group',\n      value: 'colgroup'\n    }]\n  }, {\n    name: 'halign',\n    type: 'listbox',\n    label: 'Horizontal align',\n    items: [{\n      text: 'None',\n      value: ''\n    }, {\n      text: 'Left',\n      value: 'left'\n    }, {\n      text: 'Center',\n      value: 'center'\n    }, {\n      text: 'Right',\n      value: 'right'\n    }]\n  }, {\n    name: 'valign',\n    type: 'listbox',\n    label: 'Vertical align',\n    items: verticalAlignValues\n  }];\n  var getItems$2 = function getItems$2(editor) {\n    return children.concat(getClassList$1(editor).toArray());\n  };\n  var getAdvancedTab = function getAdvancedTab(editor, dialogName) {\n    var emptyBorderStyle = [{\n      text: 'Select...',\n      value: ''\n    }];\n    var advTabItems = [{\n      name: 'borderstyle',\n      type: 'listbox',\n      label: 'Border style',\n      items: emptyBorderStyle.concat(_buildListItems(getTableBorderStyles(editor)))\n    }, {\n      name: 'bordercolor',\n      type: 'colorinput',\n      label: 'Border color'\n    }, {\n      name: 'backgroundcolor',\n      type: 'colorinput',\n      label: 'Background color'\n    }];\n    var borderWidth = {\n      name: 'borderwidth',\n      type: 'input',\n      label: 'Border width'\n    };\n    var items = dialogName === 'cell' ? [borderWidth].concat(advTabItems) : advTabItems;\n    return {\n      title: 'Advanced',\n      name: 'advanced',\n      items: items\n    };\n  };\n  var modifiers = function modifiers(testTruthy) {\n    return function (editor, node) {\n      var dom = editor.dom;\n      var setAttrib = function setAttrib(attr, value) {\n        if (!testTruthy || value) {\n          dom.setAttrib(node, attr, value);\n        }\n      };\n      var setStyle = function setStyle(prop, value) {\n        if (!testTruthy || value) {\n          dom.setStyle(node, prop, value);\n        }\n      };\n      var setFormat = function setFormat(formatName, value) {\n        if (!testTruthy || value) {\n          if (value === '') {\n            editor.formatter.remove(formatName, {\n              value: null\n            }, node, true);\n          } else {\n            editor.formatter.apply(formatName, {\n              value: value\n            }, node);\n          }\n        }\n      };\n      return {\n        setAttrib: setAttrib,\n        setStyle: setStyle,\n        setFormat: setFormat\n      };\n    };\n  };\n  var DomModifier = {\n    normal: modifiers(false),\n    ifTruthy: modifiers(true)\n  };\n  var rgbToHex = function rgbToHex(dom) {\n    return function (value) {\n      return startsWith(value, 'rgb') ? dom.toHex(value) : value;\n    };\n  };\n  var extractAdvancedStyles = function extractAdvancedStyles(dom, elm) {\n    var element = SugarElement.fromDom(elm);\n    return {\n      borderwidth: getRaw$2(element, 'border-width').getOr(''),\n      borderstyle: getRaw$2(element, 'border-style').getOr(''),\n      bordercolor: getRaw$2(element, 'border-color').map(rgbToHex(dom)).getOr(''),\n      backgroundcolor: getRaw$2(element, 'background-color').map(rgbToHex(dom)).getOr('')\n    };\n  };\n  var getSharedValues = function getSharedValues(data) {\n    var baseData = data[0];\n    var comparisonData = data.slice(1);\n    each$2(comparisonData, function (items) {\n      each$2(keys(baseData), function (key) {\n        each$1(items, function (itemValue, itemKey) {\n          var comparisonValue = baseData[key];\n          if (comparisonValue !== '' && key === itemKey) {\n            if (comparisonValue !== itemValue) {\n              baseData[key] = '';\n            }\n          }\n        });\n      });\n    });\n    return baseData;\n  };\n  var getAlignment = function getAlignment(formats, formatName, editor, elm) {\n    return find$1(formats, function (name) {\n      return !isUndefined(editor.formatter.matchNode(elm, formatName + name));\n    }).getOr('');\n  };\n  var getHAlignment = curry(getAlignment, ['left', 'center', 'right'], 'align');\n  var getVAlignment = curry(getAlignment, ['top', 'middle', 'bottom'], 'valign');\n  var extractDataFromSettings = function extractDataFromSettings(editor, hasAdvTableTab) {\n    var style = getDefaultStyles(editor);\n    var attrs = getDefaultAttributes(editor);\n    var extractAdvancedStyleData = function extractAdvancedStyleData(dom) {\n      return {\n        borderstyle: get$c(style, 'border-style').getOr(''),\n        bordercolor: rgbToHex(dom)(get$c(style, 'border-color').getOr('')),\n        backgroundcolor: rgbToHex(dom)(get$c(style, 'background-color').getOr(''))\n      };\n    };\n    var defaultData = {\n      height: '',\n      width: '100%',\n      cellspacing: '',\n      cellpadding: '',\n      caption: false,\n      class: '',\n      align: '',\n      border: ''\n    };\n    var getBorder = function getBorder() {\n      var borderWidth = style['border-width'];\n      if (shouldStyleWithCss(editor) && borderWidth) {\n        return {\n          border: borderWidth\n        };\n      }\n      return get$c(attrs, 'border').fold(function () {\n        return {};\n      }, function (border) {\n        return {\n          border: border\n        };\n      });\n    };\n    var advStyle = hasAdvTableTab ? extractAdvancedStyleData(editor.dom) : {};\n    var getCellPaddingCellSpacing = function getCellPaddingCellSpacing() {\n      var spacing = get$c(style, 'border-spacing').or(get$c(attrs, 'cellspacing')).fold(function () {\n        return {};\n      }, function (cellspacing) {\n        return {\n          cellspacing: cellspacing\n        };\n      });\n      var padding = get$c(style, 'border-padding').or(get$c(attrs, 'cellpadding')).fold(function () {\n        return {};\n      }, function (cellpadding) {\n        return {\n          cellpadding: cellpadding\n        };\n      });\n      return _assign(_assign({}, spacing), padding);\n    };\n    var data = _assign(_assign(_assign(_assign(_assign(_assign({}, defaultData), style), attrs), advStyle), getBorder()), getCellPaddingCellSpacing());\n    return data;\n  };\n  var getRowType = function getRowType(elm) {\n    return table(SugarElement.fromDom(elm)).map(function (table) {\n      var target = {\n        selection: fromDom(elm.cells)\n      };\n      return getRowsType(table, target);\n    }).getOr('');\n  };\n  var extractDataFromTableElement = function extractDataFromTableElement(editor, elm, hasAdvTableTab) {\n    var getBorder = function getBorder(dom, elm) {\n      var optBorderWidth = getRaw$2(SugarElement.fromDom(elm), 'border-width');\n      if (shouldStyleWithCss(editor) && optBorderWidth.isSome()) {\n        return optBorderWidth.getOr('');\n      }\n      return dom.getAttrib(elm, 'border') || getTDTHOverallStyle(editor.dom, elm, 'border-width') || getTDTHOverallStyle(editor.dom, elm, 'border');\n    };\n    var dom = editor.dom;\n    var cellspacing = shouldStyleWithCss(editor) ? dom.getStyle(elm, 'border-spacing') || dom.getAttrib(elm, 'cellspacing') : dom.getAttrib(elm, 'cellspacing') || dom.getStyle(elm, 'border-spacing');\n    var cellpadding = shouldStyleWithCss(editor) ? getTDTHOverallStyle(dom, elm, 'padding') || dom.getAttrib(elm, 'cellpadding') : dom.getAttrib(elm, 'cellpadding') || getTDTHOverallStyle(dom, elm, 'padding');\n    return _assign({\n      width: dom.getStyle(elm, 'width') || dom.getAttrib(elm, 'width'),\n      height: dom.getStyle(elm, 'height') || dom.getAttrib(elm, 'height'),\n      cellspacing: cellspacing,\n      cellpadding: cellpadding,\n      border: getBorder(dom, elm),\n      caption: !!dom.select('caption', elm)[0],\n      class: dom.getAttrib(elm, 'class', ''),\n      align: getHAlignment(editor, elm)\n    }, hasAdvTableTab ? extractAdvancedStyles(dom, elm) : {});\n  };\n  var extractDataFromRowElement = function extractDataFromRowElement(editor, elm, hasAdvancedRowTab) {\n    var dom = editor.dom;\n    return _assign({\n      height: dom.getStyle(elm, 'height') || dom.getAttrib(elm, 'height'),\n      class: dom.getAttrib(elm, 'class', ''),\n      type: getRowType(elm),\n      align: getHAlignment(editor, elm)\n    }, hasAdvancedRowTab ? extractAdvancedStyles(dom, elm) : {});\n  };\n  var extractDataFromCellElement = function extractDataFromCellElement(editor, cell, hasAdvancedCellTab, column) {\n    var dom = editor.dom;\n    var colElm = column.getOr(cell);\n    var getStyle = function getStyle(element, style) {\n      return dom.getStyle(element, style) || dom.getAttrib(element, style);\n    };\n    return _assign({\n      width: getStyle(colElm, 'width'),\n      height: getStyle(cell, 'height'),\n      scope: dom.getAttrib(cell, 'scope'),\n      celltype: getNodeName(cell),\n      class: dom.getAttrib(cell, 'class', ''),\n      halign: getHAlignment(editor, cell),\n      valign: getVAlignment(editor, cell)\n    }, hasAdvancedCellTab ? extractAdvancedStyles(dom, cell) : {});\n  };\n  var getSelectedCells = function getSelectedCells(table, cells) {\n    var warehouse = Warehouse.fromTable(table);\n    var allCells = Warehouse.justCells(warehouse);\n    var filtered = filter$2(allCells, function (cellA) {\n      return exists(cells, function (cellB) {\n        return eq$1(cellA.element, cellB);\n      });\n    });\n    return map$1(filtered, function (cell) {\n      return {\n        element: cell.element.dom,\n        column: Warehouse.getColumnAt(warehouse, cell.column).map(function (col) {\n          return col.element.dom;\n        })\n      };\n    });\n  };\n  var updateSimpleProps$1 = function updateSimpleProps$1(modifier, colModifier, data) {\n    modifier.setAttrib('scope', data.scope);\n    modifier.setAttrib('class', data.class);\n    modifier.setStyle('height', addPxSuffix(data.height));\n    colModifier.setStyle('width', addPxSuffix(data.width));\n  };\n  var updateAdvancedProps$1 = function updateAdvancedProps$1(modifier, data) {\n    modifier.setFormat('tablecellbackgroundcolor', data.backgroundcolor);\n    modifier.setFormat('tablecellbordercolor', data.bordercolor);\n    modifier.setFormat('tablecellborderstyle', data.borderstyle);\n    modifier.setFormat('tablecellborderwidth', addPxSuffix(data.borderwidth));\n  };\n  var applyStyleData$1 = function applyStyleData$1(editor, cells, data) {\n    var isSingleCell = cells.length === 1;\n    each$2(cells, function (item) {\n      var cellElm = item.element;\n      var modifier = isSingleCell ? DomModifier.normal(editor, cellElm) : DomModifier.ifTruthy(editor, cellElm);\n      var colModifier = item.column.map(function (col) {\n        return isSingleCell ? DomModifier.normal(editor, col) : DomModifier.ifTruthy(editor, col);\n      }).getOr(modifier);\n      updateSimpleProps$1(modifier, colModifier, data);\n      if (hasAdvancedCellTab(editor)) {\n        updateAdvancedProps$1(modifier, data);\n      }\n      if (isSingleCell) {\n        unApplyAlign(editor, cellElm);\n        unApplyVAlign(editor, cellElm);\n      }\n      if (data.halign) {\n        applyAlign(editor, cellElm, data.halign);\n      }\n      if (data.valign) {\n        applyVAlign(editor, cellElm, data.valign);\n      }\n    });\n  };\n  var applyStructureData$1 = function applyStructureData$1(editor, data) {\n    editor.execCommand('mceTableCellType', false, {\n      type: data.celltype,\n      no_events: true\n    });\n  };\n  var applyCellData = function applyCellData(editor, cells, oldData, data) {\n    var modifiedData = filter$1(data, function (value, key) {\n      return oldData[key] !== value;\n    });\n    if (size(modifiedData) > 0 && cells.length >= 1) {\n      table(cells[0]).each(function (table) {\n        var selectedCells = getSelectedCells(table, cells);\n        var styleModified = size(filter$1(modifiedData, function (_value, key) {\n          return key !== 'scope' && key !== 'celltype';\n        })) > 0;\n        var structureModified = has$1(modifiedData, 'celltype');\n        if (styleModified || has$1(modifiedData, 'scope')) {\n          applyStyleData$1(editor, selectedCells, data);\n        }\n        if (structureModified) {\n          applyStructureData$1(editor, data);\n        }\n        fireTableModified(editor, table.dom, {\n          structure: structureModified,\n          style: styleModified\n        });\n      });\n    }\n  };\n  var onSubmitCellForm = function onSubmitCellForm(editor, cells, oldData, api) {\n    var data = api.getData();\n    api.close();\n    editor.undoManager.transact(function () {\n      applyCellData(editor, cells, oldData, data);\n      editor.focus();\n    });\n  };\n  var getData = function getData(editor, cells) {\n    var cellsData = table(cells[0]).map(function (table) {\n      return map$1(getSelectedCells(table, cells), function (item) {\n        return extractDataFromCellElement(editor, item.element, hasAdvancedCellTab(editor), item.column);\n      });\n    });\n    return getSharedValues(cellsData.getOrDie());\n  };\n  var open$2 = function open$2(editor, selections) {\n    var cells = getCellsFromSelection(selections);\n    if (cells.length === 0) {\n      return;\n    }\n    var data = getData(editor, cells);\n    var dialogTabPanel = {\n      type: 'tabpanel',\n      tabs: [{\n        title: 'General',\n        name: 'general',\n        items: getItems$2(editor)\n      }, getAdvancedTab(editor, 'cell')]\n    };\n    var dialogPanel = {\n      type: 'panel',\n      items: [{\n        type: 'grid',\n        columns: 2,\n        items: getItems$2(editor)\n      }]\n    };\n    editor.windowManager.open({\n      title: 'Cell Properties',\n      size: 'normal',\n      body: hasAdvancedCellTab(editor) ? dialogTabPanel : dialogPanel,\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: data,\n      onSubmit: curry(onSubmitCellForm, editor, cells, data)\n    });\n  };\n  var getClassList = function getClassList(editor) {\n    var classes = _buildListItems(getRowClassList(editor));\n    if (classes.length > 0) {\n      return Optional.some({\n        name: 'class',\n        type: 'listbox',\n        label: 'Class',\n        items: classes\n      });\n    }\n    return Optional.none();\n  };\n  var formChildren = [{\n    type: 'listbox',\n    name: 'type',\n    label: 'Row type',\n    items: [{\n      text: 'Header',\n      value: 'header'\n    }, {\n      text: 'Body',\n      value: 'body'\n    }, {\n      text: 'Footer',\n      value: 'footer'\n    }]\n  }, {\n    type: 'listbox',\n    name: 'align',\n    label: 'Alignment',\n    items: [{\n      text: 'None',\n      value: ''\n    }, {\n      text: 'Left',\n      value: 'left'\n    }, {\n      text: 'Center',\n      value: 'center'\n    }, {\n      text: 'Right',\n      value: 'right'\n    }]\n  }, {\n    label: 'Height',\n    name: 'height',\n    type: 'input'\n  }];\n  var getItems$1 = function getItems$1(editor) {\n    return formChildren.concat(getClassList(editor).toArray());\n  };\n  var updateSimpleProps = function updateSimpleProps(modifier, data) {\n    modifier.setAttrib('class', data.class);\n    modifier.setStyle('height', addPxSuffix(data.height));\n  };\n  var updateAdvancedProps = function updateAdvancedProps(modifier, data) {\n    modifier.setStyle('background-color', data.backgroundcolor);\n    modifier.setStyle('border-color', data.bordercolor);\n    modifier.setStyle('border-style', data.borderstyle);\n  };\n  var applyStyleData = function applyStyleData(editor, rows, data, oldData) {\n    var isSingleRow = rows.length === 1;\n    each$2(rows, function (rowElm) {\n      var modifier = isSingleRow ? DomModifier.normal(editor, rowElm) : DomModifier.ifTruthy(editor, rowElm);\n      updateSimpleProps(modifier, data);\n      if (hasAdvancedRowTab(editor)) {\n        updateAdvancedProps(modifier, data);\n      }\n      if (data.align !== oldData.align) {\n        unApplyAlign(editor, rowElm);\n        applyAlign(editor, rowElm, data.align);\n      }\n    });\n  };\n  var applyStructureData = function applyStructureData(editor, data) {\n    editor.execCommand('mceTableRowType', false, {\n      type: data.type,\n      no_events: true\n    });\n  };\n  var applyRowData = function applyRowData(editor, rows, oldData, data) {\n    var modifiedData = filter$1(data, function (value, key) {\n      return oldData[key] !== value;\n    });\n    if (size(modifiedData) > 0) {\n      var typeModified_1 = has$1(modifiedData, 'type');\n      var styleModified_1 = typeModified_1 ? size(modifiedData) > 1 : true;\n      if (styleModified_1) {\n        applyStyleData(editor, rows, data, oldData);\n      }\n      if (typeModified_1) {\n        applyStructureData(editor, data);\n      }\n      table(SugarElement.fromDom(rows[0])).each(function (table) {\n        return fireTableModified(editor, table.dom, {\n          structure: typeModified_1,\n          style: styleModified_1\n        });\n      });\n    }\n  };\n  var onSubmitRowForm = function onSubmitRowForm(editor, rows, oldData, api) {\n    var data = api.getData();\n    api.close();\n    editor.undoManager.transact(function () {\n      applyRowData(editor, rows, oldData, data);\n      editor.focus();\n    });\n  };\n  var open$1 = function open$1(editor) {\n    var rows = getRowsFromSelection(getSelectionStart(editor), ephemera.selected);\n    if (rows.length === 0) {\n      return;\n    }\n    var rowsData = map$1(rows, function (rowElm) {\n      return extractDataFromRowElement(editor, rowElm.dom, hasAdvancedRowTab(editor));\n    });\n    var data = getSharedValues(rowsData);\n    var dialogTabPanel = {\n      type: 'tabpanel',\n      tabs: [{\n        title: 'General',\n        name: 'general',\n        items: getItems$1(editor)\n      }, getAdvancedTab(editor, 'row')]\n    };\n    var dialogPanel = {\n      type: 'panel',\n      items: [{\n        type: 'grid',\n        columns: 2,\n        items: getItems$1(editor)\n      }]\n    };\n    editor.windowManager.open({\n      title: 'Row Properties',\n      size: 'normal',\n      body: hasAdvancedRowTab(editor) ? dialogTabPanel : dialogPanel,\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: data,\n      onSubmit: curry(onSubmitRowForm, editor, map$1(rows, function (r) {\n        return r.dom;\n      }), data)\n    });\n  };\n  var getItems = function getItems(editor, classes, insertNewTable) {\n    var rowColCountItems = !insertNewTable ? [] : [{\n      type: 'input',\n      name: 'cols',\n      label: 'Cols',\n      inputMode: 'numeric'\n    }, {\n      type: 'input',\n      name: 'rows',\n      label: 'Rows',\n      inputMode: 'numeric'\n    }];\n    var alwaysItems = [{\n      type: 'input',\n      name: 'width',\n      label: 'Width'\n    }, {\n      type: 'input',\n      name: 'height',\n      label: 'Height'\n    }];\n    var appearanceItems = hasAppearanceOptions(editor) ? [{\n      type: 'input',\n      name: 'cellspacing',\n      label: 'Cell spacing',\n      inputMode: 'numeric'\n    }, {\n      type: 'input',\n      name: 'cellpadding',\n      label: 'Cell padding',\n      inputMode: 'numeric'\n    }, {\n      type: 'input',\n      name: 'border',\n      label: 'Border width'\n    }, {\n      type: 'label',\n      label: 'Caption',\n      items: [{\n        type: 'checkbox',\n        name: 'caption',\n        label: 'Show caption'\n      }]\n    }] : [];\n    var alignmentItem = [{\n      type: 'listbox',\n      name: 'align',\n      label: 'Alignment',\n      items: [{\n        text: 'None',\n        value: ''\n      }, {\n        text: 'Left',\n        value: 'left'\n      }, {\n        text: 'Center',\n        value: 'center'\n      }, {\n        text: 'Right',\n        value: 'right'\n      }]\n    }];\n    var classListItem = classes.length > 0 ? [{\n      type: 'listbox',\n      name: 'class',\n      label: 'Class',\n      items: classes\n    }] : [];\n    return rowColCountItems.concat(alwaysItems).concat(appearanceItems).concat(alignmentItem).concat(classListItem);\n  };\n  var _styleTDTH = function styleTDTH(dom, elm, name, value) {\n    if (elm.tagName === 'TD' || elm.tagName === 'TH') {\n      if (isString(name)) {\n        dom.setStyle(elm, name, value);\n      } else {\n        dom.setStyle(elm, name);\n      }\n    } else {\n      if (elm.children) {\n        for (var i = 0; i < elm.children.length; i++) {\n          _styleTDTH(dom, elm.children[i], name, value);\n        }\n      }\n    }\n  };\n  var applyDataToElement = function applyDataToElement(editor, tableElm, data) {\n    var dom = editor.dom;\n    var attrs = {};\n    var styles = {};\n    attrs.class = data.class;\n    styles.height = addPxSuffix(data.height);\n    if (dom.getAttrib(tableElm, 'width') && !shouldStyleWithCss(editor)) {\n      attrs.width = removePxSuffix(data.width);\n    } else {\n      styles.width = addPxSuffix(data.width);\n    }\n    if (shouldStyleWithCss(editor)) {\n      styles['border-width'] = addPxSuffix(data.border);\n      styles['border-spacing'] = addPxSuffix(data.cellspacing);\n    } else {\n      attrs.border = data.border;\n      attrs.cellpadding = data.cellpadding;\n      attrs.cellspacing = data.cellspacing;\n    }\n    if (shouldStyleWithCss(editor) && tableElm.children) {\n      for (var i = 0; i < tableElm.children.length; i++) {\n        _styleTDTH(dom, tableElm.children[i], {\n          'border-width': addPxSuffix(data.border),\n          'padding': addPxSuffix(data.cellpadding)\n        });\n        if (hasAdvancedTableTab(editor)) {\n          _styleTDTH(dom, tableElm.children[i], {\n            'border-color': data.bordercolor\n          });\n        }\n      }\n    }\n    if (hasAdvancedTableTab(editor)) {\n      styles['background-color'] = data.backgroundcolor;\n      styles['border-color'] = data.bordercolor;\n      styles['border-style'] = data.borderstyle;\n    }\n    attrs.style = dom.serializeStyle(_assign(_assign({}, getDefaultStyles(editor)), styles));\n    dom.setAttribs(tableElm, _assign(_assign({}, getDefaultAttributes(editor)), attrs));\n  };\n  var onSubmitTableForm = function onSubmitTableForm(editor, tableElm, oldData, api) {\n    var dom = editor.dom;\n    var data = api.getData();\n    var modifiedData = filter$1(data, function (value, key) {\n      return oldData[key] !== value;\n    });\n    api.close();\n    if (data.class === '') {\n      delete data.class;\n    }\n    editor.undoManager.transact(function () {\n      if (!tableElm) {\n        var cols = parseInt(data.cols, 10) || 1;\n        var rows = parseInt(data.rows, 10) || 1;\n        tableElm = insert(editor, cols, rows, 0, 0);\n      }\n      if (size(modifiedData) > 0) {\n        applyDataToElement(editor, tableElm, data);\n        var captionElm = dom.select('caption', tableElm)[0];\n        if (captionElm && !data.caption || !captionElm && data.caption) {\n          editor.execCommand('mceTableToggleCaption');\n        }\n        if (data.align === '') {\n          unApplyAlign(editor, tableElm);\n        } else {\n          applyAlign(editor, tableElm, data.align);\n        }\n      }\n      editor.focus();\n      editor.addVisual();\n      if (size(modifiedData) > 0) {\n        var captionModified = has$1(modifiedData, 'caption');\n        var styleModified = captionModified ? size(modifiedData) > 1 : true;\n        fireTableModified(editor, tableElm, {\n          structure: captionModified,\n          style: styleModified\n        });\n      }\n    });\n  };\n  var open = function open(editor, insertNewTable) {\n    var dom = editor.dom;\n    var tableElm;\n    var data = extractDataFromSettings(editor, hasAdvancedTableTab(editor));\n    if (insertNewTable === false) {\n      tableElm = dom.getParent(editor.selection.getStart(), 'table', editor.getBody());\n      if (tableElm) {\n        data = extractDataFromTableElement(editor, tableElm, hasAdvancedTableTab(editor));\n      } else {\n        if (hasAdvancedTableTab(editor)) {\n          data.borderstyle = '';\n          data.bordercolor = '';\n          data.backgroundcolor = '';\n        }\n      }\n    } else {\n      data.cols = '1';\n      data.rows = '1';\n      if (hasAdvancedTableTab(editor)) {\n        data.borderstyle = '';\n        data.bordercolor = '';\n        data.backgroundcolor = '';\n      }\n    }\n    var classes = _buildListItems(getTableClassList(editor));\n    if (classes.length > 0) {\n      if (data.class) {\n        data.class = data.class.replace(/\\s*mce\\-item\\-table\\s*/g, '');\n      }\n    }\n    var generalPanel = {\n      type: 'grid',\n      columns: 2,\n      items: getItems(editor, classes, insertNewTable)\n    };\n    var nonAdvancedForm = function nonAdvancedForm() {\n      return {\n        type: 'panel',\n        items: [generalPanel]\n      };\n    };\n    var advancedForm = function advancedForm() {\n      return {\n        type: 'tabpanel',\n        tabs: [{\n          title: 'General',\n          name: 'general',\n          items: [generalPanel]\n        }, getAdvancedTab(editor, 'table')]\n      };\n    };\n    var dialogBody = hasAdvancedTableTab(editor) ? advancedForm() : nonAdvancedForm();\n    editor.windowManager.open({\n      title: 'Table Properties',\n      size: 'normal',\n      body: dialogBody,\n      onSubmit: curry(onSubmitTableForm, editor, tableElm, data),\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: data\n    });\n  };\n  var getSelectionStartCellOrCaption = function getSelectionStartCellOrCaption(editor) {\n    return getSelectionCellOrCaption(getSelectionStart(editor), getIsRoot(editor));\n  };\n  var getSelectionStartCell = function getSelectionStartCell(editor) {\n    return getSelectionCell(getSelectionStart(editor), getIsRoot(editor));\n  };\n  var registerCommands = function registerCommands(editor, actions, cellSelection, selections, clipboard) {\n    var isRoot = getIsRoot(editor);\n    var eraseTable = function eraseTable() {\n      return getSelectionStartCellOrCaption(editor).each(function (cellOrCaption) {\n        table(cellOrCaption, isRoot).filter(not(isRoot)).each(function (table) {\n          var cursor = SugarElement.fromText('');\n          after$5(table, cursor);\n          remove$5(table);\n          if (editor.dom.isEmpty(editor.getBody())) {\n            editor.setContent('');\n            editor.selection.setCursorLocation();\n          } else {\n            var rng = editor.dom.createRng();\n            rng.setStart(cursor.dom, 0);\n            rng.setEnd(cursor.dom, 0);\n            editor.selection.setRng(rng);\n            editor.nodeChanged();\n          }\n        });\n      });\n    };\n    var setSizingMode = function setSizingMode(sizing) {\n      return getSelectionStartCellOrCaption(editor).each(function (cellOrCaption) {\n        var isForcedSizing = isResponsiveForced(editor) || isPixelsForced(editor) || isPercentagesForced(editor);\n        if (!isForcedSizing) {\n          table(cellOrCaption, isRoot).each(function (table) {\n            if (sizing === 'relative' && !isPercentSizing(table)) {\n              enforcePercentage(table);\n            } else if (sizing === 'fixed' && !isPixelSizing(table)) {\n              enforcePixels(table);\n            } else if (sizing === 'responsive' && !isNoneSizing(table)) {\n              enforceNone(table);\n            }\n            removeDataStyle(table);\n            fireTableModified(editor, table.dom, structureModified);\n          });\n        }\n      });\n    };\n    var getTableFromCell = function getTableFromCell(cell) {\n      return table(cell, isRoot);\n    };\n    var performActionOnSelection = function performActionOnSelection(action) {\n      return getSelectionStartCell(editor).bind(function (cell) {\n        return getTableFromCell(cell).map(function (table) {\n          return action(table, cell);\n        });\n      });\n    };\n    var toggleTableClass = function toggleTableClass(_ui, clazz) {\n      performActionOnSelection(function (table) {\n        editor.formatter.toggle('tableclass', {\n          value: clazz\n        }, table.dom);\n        fireTableModified(editor, table.dom, styleModified);\n      });\n    };\n    var toggleTableCellClass = function toggleTableCellClass(_ui, clazz) {\n      performActionOnSelection(function (table) {\n        var selectedCells = getCellsFromSelection(selections);\n        var allHaveClass = forall(selectedCells, function (cell) {\n          return editor.formatter.match('tablecellclass', {\n            value: clazz\n          }, cell.dom);\n        });\n        var formatterAction = allHaveClass ? editor.formatter.remove : editor.formatter.apply;\n        each$2(selectedCells, function (cell) {\n          return formatterAction('tablecellclass', {\n            value: clazz\n          }, cell.dom);\n        });\n        fireTableModified(editor, table.dom, styleModified);\n      });\n    };\n    var toggleCaption = function toggleCaption() {\n      getSelectionStartCellOrCaption(editor).each(function (cellOrCaption) {\n        table(cellOrCaption, isRoot).each(function (table) {\n          child$1(table, 'caption').fold(function () {\n            var caption = SugarElement.fromTag('caption');\n            append$1(caption, SugarElement.fromText('Caption'));\n            appendAt(table, caption, 0);\n            editor.selection.setCursorLocation(caption.dom, 0);\n          }, function (caption) {\n            if (isTag('caption')(cellOrCaption)) {\n              one('td', table).each(function (td) {\n                return editor.selection.setCursorLocation(td.dom, 0);\n              });\n            }\n            remove$5(caption);\n          });\n          fireTableModified(editor, table.dom, structureModified);\n        });\n      });\n    };\n    var postExecute = function postExecute(_data) {\n      editor.focus();\n    };\n    var actOnSelection = function actOnSelection(execute, noEvents) {\n      if (noEvents === void 0) {\n        noEvents = false;\n      }\n      return performActionOnSelection(function (table, startCell) {\n        var targets = forMenu(selections, table, startCell);\n        execute(table, targets, noEvents).each(postExecute);\n      });\n    };\n    var copyRowSelection = function copyRowSelection() {\n      return performActionOnSelection(function (table, startCell) {\n        var targets = forMenu(selections, table, startCell);\n        var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), Optional.none());\n        return copyRows(table, targets, generators);\n      });\n    };\n    var copyColSelection = function copyColSelection() {\n      return performActionOnSelection(function (table, startCell) {\n        var targets = forMenu(selections, table, startCell);\n        return copyCols(table, targets);\n      });\n    };\n    var pasteOnSelection = function pasteOnSelection(execute, getRows) {\n      return getRows().each(function (rows) {\n        var clonedRows = map$1(rows, function (row) {\n          return deep(row);\n        });\n        performActionOnSelection(function (table, startCell) {\n          var generators = paste$1(SugarElement.fromDom(editor.getDoc()));\n          var targets = pasteRows(selections, startCell, clonedRows, generators);\n          execute(table, targets).each(postExecute);\n        });\n      });\n    };\n    var actOnType = function actOnType(getAction) {\n      return function (_ui, args) {\n        return get$c(args, 'type').each(function (type) {\n          actOnSelection(getAction(type), args.no_events);\n        });\n      };\n    };\n    each$1({\n      mceTableSplitCells: function mceTableSplitCells() {\n        return actOnSelection(actions.unmergeCells);\n      },\n      mceTableMergeCells: function mceTableMergeCells() {\n        return actOnSelection(actions.mergeCells);\n      },\n      mceTableInsertRowBefore: function mceTableInsertRowBefore() {\n        return actOnSelection(actions.insertRowsBefore);\n      },\n      mceTableInsertRowAfter: function mceTableInsertRowAfter() {\n        return actOnSelection(actions.insertRowsAfter);\n      },\n      mceTableInsertColBefore: function mceTableInsertColBefore() {\n        return actOnSelection(actions.insertColumnsBefore);\n      },\n      mceTableInsertColAfter: function mceTableInsertColAfter() {\n        return actOnSelection(actions.insertColumnsAfter);\n      },\n      mceTableDeleteCol: function mceTableDeleteCol() {\n        return actOnSelection(actions.deleteColumn);\n      },\n      mceTableDeleteRow: function mceTableDeleteRow() {\n        return actOnSelection(actions.deleteRow);\n      },\n      mceTableCutCol: function mceTableCutCol() {\n        return copyColSelection().each(function (selection) {\n          clipboard.setColumns(selection);\n          actOnSelection(actions.deleteColumn);\n        });\n      },\n      mceTableCutRow: function mceTableCutRow() {\n        return copyRowSelection().each(function (selection) {\n          clipboard.setRows(selection);\n          actOnSelection(actions.deleteRow);\n        });\n      },\n      mceTableCopyCol: function mceTableCopyCol() {\n        return copyColSelection().each(function (selection) {\n          return clipboard.setColumns(selection);\n        });\n      },\n      mceTableCopyRow: function mceTableCopyRow() {\n        return copyRowSelection().each(function (selection) {\n          return clipboard.setRows(selection);\n        });\n      },\n      mceTablePasteColBefore: function mceTablePasteColBefore() {\n        return pasteOnSelection(actions.pasteColsBefore, clipboard.getColumns);\n      },\n      mceTablePasteColAfter: function mceTablePasteColAfter() {\n        return pasteOnSelection(actions.pasteColsAfter, clipboard.getColumns);\n      },\n      mceTablePasteRowBefore: function mceTablePasteRowBefore() {\n        return pasteOnSelection(actions.pasteRowsBefore, clipboard.getRows);\n      },\n      mceTablePasteRowAfter: function mceTablePasteRowAfter() {\n        return pasteOnSelection(actions.pasteRowsAfter, clipboard.getRows);\n      },\n      mceTableDelete: eraseTable,\n      mceTableCellToggleClass: toggleTableCellClass,\n      mceTableToggleClass: toggleTableClass,\n      mceTableToggleCaption: toggleCaption,\n      mceTableSizingMode: function mceTableSizingMode(_ui, sizing) {\n        return setSizingMode(sizing);\n      },\n      mceTableCellType: actOnType(function (type) {\n        return type === 'th' ? actions.makeCellsHeader : actions.unmakeCellsHeader;\n      }),\n      mceTableColType: actOnType(function (type) {\n        return type === 'th' ? actions.makeColumnsHeader : actions.unmakeColumnsHeader;\n      }),\n      mceTableRowType: actOnType(function (type) {\n        switch (type) {\n          case 'header':\n            return actions.makeRowsHeader;\n          case 'footer':\n            return actions.makeRowsFooter;\n          default:\n            return actions.makeRowsBody;\n        }\n      })\n    }, function (func, name) {\n      return editor.addCommand(name, func);\n    });\n    each$1({\n      mceTableProps: curry(open, editor, false),\n      mceTableRowProps: curry(open$1, editor),\n      mceTableCellProps: curry(open$2, editor, selections)\n    }, function (func, name) {\n      return editor.addCommand(name, function () {\n        return func();\n      });\n    });\n    editor.addCommand('mceInsertTable', function (_ui, args) {\n      if (isObject(args) && keys(args).length > 0) {\n        insertTableWithDataValidation(editor, args.rows, args.columns, args.options, 'Invalid values for mceInsertTable - rows and columns values are required to insert a table.');\n      } else {\n        open(editor, true);\n      }\n    });\n    editor.addCommand('mceTableApplyCellStyle', function (_ui, args) {\n      var getFormatName = function getFormatName(style) {\n        return 'tablecell' + style.toLowerCase().replace('-', '');\n      };\n      if (!isObject(args)) {\n        return;\n      }\n      var cells = getCellsFromSelection(selections);\n      if (cells.length === 0) {\n        return;\n      }\n      var validArgs = filter$1(args, function (value, style) {\n        return editor.formatter.has(getFormatName(style)) && isString(value);\n      });\n      if (isEmpty(validArgs)) {\n        return;\n      }\n      each$1(validArgs, function (value, style) {\n        each$2(cells, function (cell) {\n          DomModifier.normal(editor, cell.dom).setFormat(getFormatName(style), value);\n        });\n      });\n      getTableFromCell(cells[0]).each(function (table) {\n        return fireTableModified(editor, table.dom, styleModified);\n      });\n    });\n  };\n  var registerQueryCommands = function registerQueryCommands(editor, actions, selections) {\n    var isRoot = getIsRoot(editor);\n    var lookupOnSelection = function lookupOnSelection(action) {\n      return getSelectionCell(getSelectionStart(editor)).bind(function (cell) {\n        return table(cell, isRoot).map(function (table) {\n          var targets = forMenu(selections, table, cell);\n          return action(table, targets);\n        });\n      }).getOr('');\n    };\n    each$1({\n      mceTableRowType: function mceTableRowType() {\n        return lookupOnSelection(actions.getTableRowType);\n      },\n      mceTableCellType: function mceTableCellType() {\n        return lookupOnSelection(actions.getTableCellType);\n      },\n      mceTableColType: function mceTableColType() {\n        return lookupOnSelection(actions.getTableColType);\n      }\n    }, function (func, name) {\n      return editor.addQueryValueHandler(name, func);\n    });\n  };\n  var Clipboard = function Clipboard() {\n    var rows = value();\n    var cols = value();\n    return {\n      getRows: rows.get,\n      setRows: function setRows(r) {\n        r.fold(rows.clear, rows.set);\n        cols.clear();\n      },\n      clearRows: rows.clear,\n      getColumns: cols.get,\n      setColumns: function setColumns(c) {\n        c.fold(cols.clear, cols.set);\n        rows.clear();\n      },\n      clearColumns: cols.clear\n    };\n  };\n  var genericBase = {\n    remove_similar: true,\n    inherit: false\n  };\n  var cellBase = _assign({\n    selector: 'td,th'\n  }, genericBase);\n  var cellFormats = {\n    tablecellbackgroundcolor: _assign({\n      styles: {\n        backgroundColor: '%value'\n      }\n    }, cellBase),\n    tablecellverticalalign: _assign({\n      styles: {\n        'vertical-align': '%value'\n      }\n    }, cellBase),\n    tablecellbordercolor: _assign({\n      styles: {\n        borderColor: '%value'\n      }\n    }, cellBase),\n    tablecellclass: _assign({\n      classes: ['%value']\n    }, cellBase),\n    tableclass: _assign({\n      selector: 'table',\n      classes: ['%value']\n    }, genericBase),\n    tablecellborderstyle: _assign({\n      styles: {\n        borderStyle: '%value'\n      }\n    }, cellBase),\n    tablecellborderwidth: _assign({\n      styles: {\n        borderWidth: '%value'\n      }\n    }, cellBase)\n  };\n  var registerFormats = function registerFormats(editor) {\n    editor.formatter.register(cellFormats);\n  };\n  var adt$5 = Adt.generate([{\n    none: ['current']\n  }, {\n    first: ['current']\n  }, {\n    middle: ['current', 'target']\n  }, {\n    last: ['current']\n  }]);\n  var none = function none(current) {\n    if (current === void 0) {\n      current = undefined;\n    }\n    return adt$5.none(current);\n  };\n  var CellLocation = _assign(_assign({}, adt$5), {\n    none: none\n  });\n  var _walk = function walk(all, current, index, direction, isEligible) {\n    if (isEligible === void 0) {\n      isEligible = always;\n    }\n    var forwards = direction === 1;\n    if (!forwards && index <= 0) {\n      return CellLocation.first(all[0]);\n    } else if (forwards && index >= all.length - 1) {\n      return CellLocation.last(all[all.length - 1]);\n    } else {\n      var newIndex = index + direction;\n      var elem = all[newIndex];\n      return isEligible(elem) ? CellLocation.middle(current, elem) : _walk(all, current, newIndex, direction, isEligible);\n    }\n  };\n  var detect$1 = function detect$1(current, isRoot) {\n    return table(current, isRoot).bind(function (table) {\n      var all = cells$1(table);\n      var index = findIndex(all, function (x) {\n        return eq$1(current, x);\n      });\n      return index.map(function (index) {\n        return {\n          index: index,\n          all: all\n        };\n      });\n    });\n  };\n  var next = function next(current, isEligible, isRoot) {\n    var detection = detect$1(current, isRoot);\n    return detection.fold(function () {\n      return CellLocation.none(current);\n    }, function (info) {\n      return _walk(info.all, current, info.index, 1, isEligible);\n    });\n  };\n  var prev = function prev(current, isEligible, isRoot) {\n    var detection = detect$1(current, isRoot);\n    return detection.fold(function () {\n      return CellLocation.none();\n    }, function (info) {\n      return _walk(info.all, current, info.index, -1, isEligible);\n    });\n  };\n  var create$2 = function create$2(start, soffset, finish, foffset) {\n    return {\n      start: start,\n      soffset: soffset,\n      finish: finish,\n      foffset: foffset\n    };\n  };\n  var SimRange = {\n    create: create$2\n  };\n  var adt$4 = Adt.generate([{\n    before: ['element']\n  }, {\n    on: ['element', 'offset']\n  }, {\n    after: ['element']\n  }]);\n  var cata$1 = function cata$1(subject, onBefore, onOn, onAfter) {\n    return subject.fold(onBefore, onOn, onAfter);\n  };\n  var getStart$1 = function getStart$1(situ) {\n    return situ.fold(identity, identity, identity);\n  };\n  var before$2 = adt$4.before;\n  var on = adt$4.on;\n  var after$3 = adt$4.after;\n  var Situ = {\n    before: before$2,\n    on: on,\n    after: after$3,\n    cata: cata$1,\n    getStart: getStart$1\n  };\n  var adt$3 = Adt.generate([{\n    domRange: ['rng']\n  }, {\n    relative: ['startSitu', 'finishSitu']\n  }, {\n    exact: ['start', 'soffset', 'finish', 'foffset']\n  }]);\n  var exactFromRange = function exactFromRange(simRange) {\n    return adt$3.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);\n  };\n  var getStart = function getStart(selection) {\n    return selection.match({\n      domRange: function domRange(rng) {\n        return SugarElement.fromDom(rng.startContainer);\n      },\n      relative: function relative(startSitu, _finishSitu) {\n        return Situ.getStart(startSitu);\n      },\n      exact: function exact(start, _soffset, _finish, _foffset) {\n        return start;\n      }\n    });\n  };\n  var domRange = adt$3.domRange;\n  var relative = adt$3.relative;\n  var exact = adt$3.exact;\n  var getWin = function getWin(selection) {\n    var start = getStart(selection);\n    return defaultView(start);\n  };\n  var range = SimRange.create;\n  var SimSelection = {\n    domRange: domRange,\n    relative: relative,\n    exact: exact,\n    exactFromRange: exactFromRange,\n    getWin: getWin,\n    range: range\n  };\n  var selectNode = function selectNode(win, element) {\n    var rng = win.document.createRange();\n    rng.selectNode(element.dom);\n    return rng;\n  };\n  var selectNodeContents = function selectNodeContents(win, element) {\n    var rng = win.document.createRange();\n    selectNodeContentsUsing(rng, element);\n    return rng;\n  };\n  var selectNodeContentsUsing = function selectNodeContentsUsing(rng, element) {\n    return rng.selectNodeContents(element.dom);\n  };\n  var setStart = function setStart(rng, situ) {\n    situ.fold(function (e) {\n      rng.setStartBefore(e.dom);\n    }, function (e, o) {\n      rng.setStart(e.dom, o);\n    }, function (e) {\n      rng.setStartAfter(e.dom);\n    });\n  };\n  var setFinish = function setFinish(rng, situ) {\n    situ.fold(function (e) {\n      rng.setEndBefore(e.dom);\n    }, function (e, o) {\n      rng.setEnd(e.dom, o);\n    }, function (e) {\n      rng.setEndAfter(e.dom);\n    });\n  };\n  var relativeToNative = function relativeToNative(win, startSitu, finishSitu) {\n    var range = win.document.createRange();\n    setStart(range, startSitu);\n    setFinish(range, finishSitu);\n    return range;\n  };\n  var exactToNative = function exactToNative(win, start, soffset, finish, foffset) {\n    var rng = win.document.createRange();\n    rng.setStart(start.dom, soffset);\n    rng.setEnd(finish.dom, foffset);\n    return rng;\n  };\n  var toRect = function toRect(rect) {\n    return {\n      left: rect.left,\n      top: rect.top,\n      right: rect.right,\n      bottom: rect.bottom,\n      width: rect.width,\n      height: rect.height\n    };\n  };\n  var getFirstRect$1 = function getFirstRect$1(rng) {\n    var rects = rng.getClientRects();\n    var rect = rects.length > 0 ? rects[0] : rng.getBoundingClientRect();\n    return rect.width > 0 || rect.height > 0 ? Optional.some(rect).map(toRect) : Optional.none();\n  };\n  var adt$2 = Adt.generate([{\n    ltr: ['start', 'soffset', 'finish', 'foffset']\n  }, {\n    rtl: ['start', 'soffset', 'finish', 'foffset']\n  }]);\n  var fromRange = function fromRange(win, type, range) {\n    return type(SugarElement.fromDom(range.startContainer), range.startOffset, SugarElement.fromDom(range.endContainer), range.endOffset);\n  };\n  var getRanges = function getRanges(win, selection) {\n    return selection.match({\n      domRange: function domRange(rng) {\n        return {\n          ltr: constant(rng),\n          rtl: Optional.none\n        };\n      },\n      relative: function relative(startSitu, finishSitu) {\n        return {\n          ltr: cached(function () {\n            return relativeToNative(win, startSitu, finishSitu);\n          }),\n          rtl: cached(function () {\n            return Optional.some(relativeToNative(win, finishSitu, startSitu));\n          })\n        };\n      },\n      exact: function exact(start, soffset, finish, foffset) {\n        return {\n          ltr: cached(function () {\n            return exactToNative(win, start, soffset, finish, foffset);\n          }),\n          rtl: cached(function () {\n            return Optional.some(exactToNative(win, finish, foffset, start, soffset));\n          })\n        };\n      }\n    });\n  };\n  var doDiagnose = function doDiagnose(win, ranges) {\n    var rng = ranges.ltr();\n    if (rng.collapsed) {\n      var reversed = ranges.rtl().filter(function (rev) {\n        return rev.collapsed === false;\n      });\n      return reversed.map(function (rev) {\n        return adt$2.rtl(SugarElement.fromDom(rev.endContainer), rev.endOffset, SugarElement.fromDom(rev.startContainer), rev.startOffset);\n      }).getOrThunk(function () {\n        return fromRange(win, adt$2.ltr, rng);\n      });\n    } else {\n      return fromRange(win, adt$2.ltr, rng);\n    }\n  };\n  var diagnose = function diagnose(win, selection) {\n    var ranges = getRanges(win, selection);\n    return doDiagnose(win, ranges);\n  };\n  var asLtrRange = function asLtrRange(win, selection) {\n    var diagnosis = diagnose(win, selection);\n    return diagnosis.match({\n      ltr: function ltr(start, soffset, finish, foffset) {\n        var rng = win.document.createRange();\n        rng.setStart(start.dom, soffset);\n        rng.setEnd(finish.dom, foffset);\n        return rng;\n      },\n      rtl: function rtl(start, soffset, finish, foffset) {\n        var rng = win.document.createRange();\n        rng.setStart(finish.dom, foffset);\n        rng.setEnd(start.dom, soffset);\n        return rng;\n      }\n    });\n  };\n  adt$2.ltr;\n  adt$2.rtl;\n  var searchForPoint = function searchForPoint(rectForOffset, x, y, maxX, length) {\n    if (length === 0) {\n      return 0;\n    } else if (x === maxX) {\n      return length - 1;\n    }\n    var xDelta = maxX;\n    for (var i = 1; i < length; i++) {\n      var rect = rectForOffset(i);\n      var curDeltaX = Math.abs(x - rect.left);\n      if (y <= rect.bottom) {\n        if (y < rect.top || curDeltaX > xDelta) {\n          return i - 1;\n        } else {\n          xDelta = curDeltaX;\n        }\n      }\n    }\n    return 0;\n  };\n  var inRect = function inRect(rect, x, y) {\n    return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;\n  };\n  var locateOffset = function locateOffset(doc, textnode, x, y, rect) {\n    var rangeForOffset = function rangeForOffset(o) {\n      var r = doc.dom.createRange();\n      r.setStart(textnode.dom, o);\n      r.collapse(true);\n      return r;\n    };\n    var rectForOffset = function rectForOffset(o) {\n      var r = rangeForOffset(o);\n      return r.getBoundingClientRect();\n    };\n    var length = get$9(textnode).length;\n    var offset = searchForPoint(rectForOffset, x, y, rect.right, length);\n    return rangeForOffset(offset);\n  };\n  var locate$1 = function locate$1(doc, node, x, y) {\n    var r = doc.dom.createRange();\n    r.selectNode(node.dom);\n    var rects = r.getClientRects();\n    var foundRect = findMap(rects, function (rect) {\n      return inRect(rect, x, y) ? Optional.some(rect) : Optional.none();\n    });\n    return foundRect.map(function (rect) {\n      return locateOffset(doc, node, x, y, rect);\n    });\n  };\n  var searchInChildren = function searchInChildren(doc, node, x, y) {\n    var r = doc.dom.createRange();\n    var nodes = children$3(node);\n    return findMap(nodes, function (n) {\n      r.selectNode(n.dom);\n      return inRect(r.getBoundingClientRect(), x, y) ? locateNode(doc, n, x, y) : Optional.none();\n    });\n  };\n  var locateNode = function locateNode(doc, node, x, y) {\n    return isText(node) ? locate$1(doc, node, x, y) : searchInChildren(doc, node, x, y);\n  };\n  var locate = function locate(doc, node, x, y) {\n    var r = doc.dom.createRange();\n    r.selectNode(node.dom);\n    var rect = r.getBoundingClientRect();\n    var boundedX = Math.max(rect.left, Math.min(rect.right, x));\n    var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));\n    return locateNode(doc, node, boundedX, boundedY);\n  };\n  var COLLAPSE_TO_LEFT = true;\n  var COLLAPSE_TO_RIGHT = false;\n  var getCollapseDirection = function getCollapseDirection(rect, x) {\n    return x - rect.left < rect.right - x ? COLLAPSE_TO_LEFT : COLLAPSE_TO_RIGHT;\n  };\n  var createCollapsedNode = function createCollapsedNode(doc, target, collapseDirection) {\n    var r = doc.dom.createRange();\n    r.selectNode(target.dom);\n    r.collapse(collapseDirection);\n    return r;\n  };\n  var locateInElement = function locateInElement(doc, node, x) {\n    var cursorRange = doc.dom.createRange();\n    cursorRange.selectNode(node.dom);\n    var rect = cursorRange.getBoundingClientRect();\n    var collapseDirection = getCollapseDirection(rect, x);\n    var f = collapseDirection === COLLAPSE_TO_LEFT ? first : last$1;\n    return f(node).map(function (target) {\n      return createCollapsedNode(doc, target, collapseDirection);\n    });\n  };\n  var locateInEmpty = function locateInEmpty(doc, node, x) {\n    var rect = node.dom.getBoundingClientRect();\n    var collapseDirection = getCollapseDirection(rect, x);\n    return Optional.some(createCollapsedNode(doc, node, collapseDirection));\n  };\n  var search = function search(doc, node, x) {\n    var f = children$3(node).length === 0 ? locateInEmpty : locateInElement;\n    return f(doc, node, x);\n  };\n  var caretPositionFromPoint = function caretPositionFromPoint(doc, x, y) {\n    var _a, _b;\n    return Optional.from((_b = (_a = doc.dom).caretPositionFromPoint) === null || _b === void 0 ? void 0 : _b.call(_a, x, y)).bind(function (pos) {\n      if (pos.offsetNode === null) {\n        return Optional.none();\n      }\n      var r = doc.dom.createRange();\n      r.setStart(pos.offsetNode, pos.offset);\n      r.collapse();\n      return Optional.some(r);\n    });\n  };\n  var caretRangeFromPoint = function caretRangeFromPoint(doc, x, y) {\n    var _a, _b;\n    return Optional.from((_b = (_a = doc.dom).caretRangeFromPoint) === null || _b === void 0 ? void 0 : _b.call(_a, x, y));\n  };\n  var searchTextNodes = function searchTextNodes(doc, node, x, y) {\n    var r = doc.dom.createRange();\n    r.selectNode(node.dom);\n    var rect = r.getBoundingClientRect();\n    var boundedX = Math.max(rect.left, Math.min(rect.right, x));\n    var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));\n    return locate(doc, node, boundedX, boundedY);\n  };\n  var searchFromPoint = function searchFromPoint(doc, x, y) {\n    return SugarElement.fromPoint(doc, x, y).bind(function (elem) {\n      var fallback = function fallback() {\n        return search(doc, elem, x);\n      };\n      return children$3(elem).length === 0 ? fallback() : searchTextNodes(doc, elem, x, y).orThunk(fallback);\n    });\n  };\n  var availableSearch = function () {\n    if (document.caretPositionFromPoint) {\n      return caretPositionFromPoint;\n    } else if (document.caretRangeFromPoint) {\n      return caretRangeFromPoint;\n    } else {\n      return searchFromPoint;\n    }\n  }();\n  var fromPoint = function fromPoint(win, x, y) {\n    var doc = SugarElement.fromDom(win.document);\n    return availableSearch(doc, x, y).map(function (rng) {\n      return SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset);\n    });\n  };\n  var beforeSpecial = function beforeSpecial(element, offset) {\n    var name$1 = name(element);\n    if ('input' === name$1) {\n      return Situ.after(element);\n    } else if (!contains$2(['br', 'img'], name$1)) {\n      return Situ.on(element, offset);\n    } else {\n      return offset === 0 ? Situ.before(element) : Situ.after(element);\n    }\n  };\n  var preprocessRelative = function preprocessRelative(startSitu, finishSitu) {\n    var start = startSitu.fold(Situ.before, beforeSpecial, Situ.after);\n    var finish = finishSitu.fold(Situ.before, beforeSpecial, Situ.after);\n    return SimSelection.relative(start, finish);\n  };\n  var preprocessExact = function preprocessExact(start, soffset, finish, foffset) {\n    var startSitu = beforeSpecial(start, soffset);\n    var finishSitu = beforeSpecial(finish, foffset);\n    return SimSelection.relative(startSitu, finishSitu);\n  };\n  var preprocess = function preprocess(selection) {\n    return selection.match({\n      domRange: function domRange(rng) {\n        var start = SugarElement.fromDom(rng.startContainer);\n        var finish = SugarElement.fromDom(rng.endContainer);\n        return preprocessExact(start, rng.startOffset, finish, rng.endOffset);\n      },\n      relative: preprocessRelative,\n      exact: preprocessExact\n    });\n  };\n  var makeRange = function makeRange(start, soffset, finish, foffset) {\n    var doc = owner(start);\n    var rng = doc.dom.createRange();\n    rng.setStart(start.dom, soffset);\n    rng.setEnd(finish.dom, foffset);\n    return rng;\n  };\n  var after$2 = function after$2(start, soffset, finish, foffset) {\n    var r = makeRange(start, soffset, finish, foffset);\n    var same = eq$1(start, finish) && soffset === foffset;\n    return r.collapsed && !same;\n  };\n  var getNativeSelection = function getNativeSelection(win) {\n    return Optional.from(win.getSelection());\n  };\n  var doSetNativeRange = function doSetNativeRange(win, rng) {\n    getNativeSelection(win).each(function (selection) {\n      selection.removeAllRanges();\n      selection.addRange(rng);\n    });\n  };\n  var doSetRange = function doSetRange(win, start, soffset, finish, foffset) {\n    var rng = exactToNative(win, start, soffset, finish, foffset);\n    doSetNativeRange(win, rng);\n  };\n  var setLegacyRtlRange = function setLegacyRtlRange(win, selection, start, soffset, finish, foffset) {\n    selection.collapse(start.dom, soffset);\n    selection.extend(finish.dom, foffset);\n  };\n  var setRangeFromRelative = function setRangeFromRelative(win, relative) {\n    return diagnose(win, relative).match({\n      ltr: function ltr(start, soffset, finish, foffset) {\n        doSetRange(win, start, soffset, finish, foffset);\n      },\n      rtl: function rtl(start, soffset, finish, foffset) {\n        getNativeSelection(win).each(function (selection) {\n          if (selection.setBaseAndExtent) {\n            selection.setBaseAndExtent(start.dom, soffset, finish.dom, foffset);\n          } else if (selection.extend) {\n            try {\n              setLegacyRtlRange(win, selection, start, soffset, finish, foffset);\n            } catch (e) {\n              doSetRange(win, finish, foffset, start, soffset);\n            }\n          } else {\n            doSetRange(win, finish, foffset, start, soffset);\n          }\n        });\n      }\n    });\n  };\n  var setExact = function setExact(win, start, soffset, finish, foffset) {\n    var relative = preprocessExact(start, soffset, finish, foffset);\n    setRangeFromRelative(win, relative);\n  };\n  var setRelative = function setRelative(win, startSitu, finishSitu) {\n    var relative = preprocessRelative(startSitu, finishSitu);\n    setRangeFromRelative(win, relative);\n  };\n  var toNative = function toNative(selection) {\n    var win = SimSelection.getWin(selection).dom;\n    var getDomRange = function getDomRange(start, soffset, finish, foffset) {\n      return exactToNative(win, start, soffset, finish, foffset);\n    };\n    var filtered = preprocess(selection);\n    return diagnose(win, filtered).match({\n      ltr: getDomRange,\n      rtl: getDomRange\n    });\n  };\n  var readRange = function readRange(selection) {\n    if (selection.rangeCount > 0) {\n      var firstRng = selection.getRangeAt(0);\n      var lastRng = selection.getRangeAt(selection.rangeCount - 1);\n      return Optional.some(SimRange.create(SugarElement.fromDom(firstRng.startContainer), firstRng.startOffset, SugarElement.fromDom(lastRng.endContainer), lastRng.endOffset));\n    } else {\n      return Optional.none();\n    }\n  };\n  var doGetExact = function doGetExact(selection) {\n    if (selection.anchorNode === null || selection.focusNode === null) {\n      return readRange(selection);\n    } else {\n      var anchor = SugarElement.fromDom(selection.anchorNode);\n      var focus_1 = SugarElement.fromDom(selection.focusNode);\n      return after$2(anchor, selection.anchorOffset, focus_1, selection.focusOffset) ? Optional.some(SimRange.create(anchor, selection.anchorOffset, focus_1, selection.focusOffset)) : readRange(selection);\n    }\n  };\n  var setToElement = function setToElement(win, element, selectNodeContents$1) {\n    if (selectNodeContents$1 === void 0) {\n      selectNodeContents$1 = true;\n    }\n    var rngGetter = selectNodeContents$1 ? selectNodeContents : selectNode;\n    var rng = rngGetter(win, element);\n    doSetNativeRange(win, rng);\n  };\n  var getExact = function getExact(win) {\n    return getNativeSelection(win).filter(function (sel) {\n      return sel.rangeCount > 0;\n    }).bind(doGetExact);\n  };\n  var get$1 = function get$1(win) {\n    return getExact(win).map(function (range) {\n      return SimSelection.exact(range.start, range.soffset, range.finish, range.foffset);\n    });\n  };\n  var getFirstRect = function getFirstRect(win, selection) {\n    var rng = asLtrRange(win, selection);\n    return getFirstRect$1(rng);\n  };\n  var getAtPoint = function getAtPoint(win, x, y) {\n    return fromPoint(win, x, y);\n  };\n  var clear = function clear(win) {\n    getNativeSelection(win).each(function (selection) {\n      return selection.removeAllRanges();\n    });\n  };\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.VK');\n  var forward = function forward(editor, isRoot, cell) {\n    return go$1(editor, isRoot, next(cell, isEditable$1));\n  };\n  var backward = function backward(editor, isRoot, cell) {\n    return go$1(editor, isRoot, prev(cell, isEditable$1));\n  };\n  var getCellFirstCursorPosition = function getCellFirstCursorPosition(editor, cell) {\n    var selection = SimSelection.exact(cell, 0, cell, 0);\n    return toNative(selection);\n  };\n  var go$1 = function go$1(editor, isRoot, cell) {\n    return cell.fold(Optional.none, Optional.none, function (current, next) {\n      return first(next).map(function (cell) {\n        return getCellFirstCursorPosition(editor, cell);\n      });\n    }, function (current) {\n      editor.execCommand('mceTableInsertRowAfter');\n      return forward(editor, isRoot, current);\n    });\n  };\n  var rootElements = ['table', 'li', 'dl'];\n  var handle$1 = function handle$1(event, editor, cellSelection) {\n    if (event.keyCode === global$1.TAB) {\n      var body_1 = getBody(editor);\n      var isRoot_1 = function isRoot_1(element) {\n        var name$1 = name(element);\n        return eq$1(element, body_1) || contains$2(rootElements, name$1);\n      };\n      var rng = editor.selection.getRng();\n      var container = SugarElement.fromDom(event.shiftKey ? rng.startContainer : rng.endContainer);\n      cell(container, isRoot_1).each(function (cell) {\n        event.preventDefault();\n        table(cell, isRoot_1).each(cellSelection.clear);\n        editor.selection.collapse(event.shiftKey);\n        var navigation = event.shiftKey ? backward : forward;\n        var rng = navigation(editor, isRoot_1, cell);\n        rng.each(function (range) {\n          editor.selection.setRng(range);\n        });\n      });\n    }\n  };\n  var create$1 = function create$1(selection, kill) {\n    return {\n      selection: selection,\n      kill: kill\n    };\n  };\n  var Response = {\n    create: create$1\n  };\n  var create = function create(start, soffset, finish, foffset) {\n    return {\n      start: Situ.on(start, soffset),\n      finish: Situ.on(finish, foffset)\n    };\n  };\n  var Situs = {\n    create: create\n  };\n  var convertToRange = function convertToRange(win, selection) {\n    var rng = asLtrRange(win, selection);\n    return SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset);\n  };\n  var makeSitus = Situs.create;\n  var sync = function sync(container, isRoot, start, soffset, finish, foffset, selectRange) {\n    if (!(eq$1(start, finish) && soffset === foffset)) {\n      return closest$1(start, 'td,th', isRoot).bind(function (s) {\n        return closest$1(finish, 'td,th', isRoot).bind(function (f) {\n          return detect(container, isRoot, s, f, selectRange);\n        });\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n  var detect = function detect(container, isRoot, start, finish, selectRange) {\n    if (!eq$1(start, finish)) {\n      return identify(start, finish, isRoot).bind(function (cellSel) {\n        var boxes = cellSel.boxes.getOr([]);\n        if (boxes.length > 1) {\n          selectRange(container, boxes, cellSel.start, cellSel.finish);\n          return Optional.some(Response.create(Optional.some(makeSitus(start, 0, start, getEnd(start))), true));\n        } else {\n          return Optional.none();\n        }\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n  var update = function update(rows, columns, container, selected, annotations) {\n    var updateSelection = function updateSelection(newSels) {\n      annotations.clearBeforeUpdate(container);\n      annotations.selectRange(container, newSels.boxes, newSels.start, newSels.finish);\n      return newSels.boxes;\n    };\n    return shiftSelection(selected, rows, columns, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(updateSelection);\n  };\n  var traverse = function traverse(item, mode) {\n    return {\n      item: item,\n      mode: mode\n    };\n  };\n  var backtrack = function backtrack(universe, item, _direction, transition) {\n    if (transition === void 0) {\n      transition = sidestep;\n    }\n    return universe.property().parent(item).map(function (p) {\n      return traverse(p, transition);\n    });\n  };\n  var sidestep = function sidestep(universe, item, direction, transition) {\n    if (transition === void 0) {\n      transition = _advance;\n    }\n    return direction.sibling(universe, item).map(function (p) {\n      return traverse(p, transition);\n    });\n  };\n  var _advance = function advance(universe, item, direction, transition) {\n    if (transition === void 0) {\n      transition = _advance;\n    }\n    var children = universe.property().children(item);\n    var result = direction.first(children);\n    return result.map(function (r) {\n      return traverse(r, transition);\n    });\n  };\n  var successors = [{\n    current: backtrack,\n    next: sidestep,\n    fallback: Optional.none()\n  }, {\n    current: sidestep,\n    next: _advance,\n    fallback: Optional.some(backtrack)\n  }, {\n    current: _advance,\n    next: _advance,\n    fallback: Optional.some(sidestep)\n  }];\n  var _go = function go(universe, item, mode, direction, rules) {\n    if (rules === void 0) {\n      rules = successors;\n    }\n    var ruleOpt = find$1(rules, function (succ) {\n      return succ.current === mode;\n    });\n    return ruleOpt.bind(function (rule) {\n      return rule.current(universe, item, direction, rule.next).orThunk(function () {\n        return rule.fallback.bind(function (fb) {\n          return _go(universe, item, fb, direction);\n        });\n      });\n    });\n  };\n  var left$1 = function left$1() {\n    var sibling = function sibling(universe, item) {\n      return universe.query().prevSibling(item);\n    };\n    var first = function first(children) {\n      return children.length > 0 ? Optional.some(children[children.length - 1]) : Optional.none();\n    };\n    return {\n      sibling: sibling,\n      first: first\n    };\n  };\n  var right$1 = function right$1() {\n    var sibling = function sibling(universe, item) {\n      return universe.query().nextSibling(item);\n    };\n    var first = function first(children) {\n      return children.length > 0 ? Optional.some(children[0]) : Optional.none();\n    };\n    return {\n      sibling: sibling,\n      first: first\n    };\n  };\n  var Walkers = {\n    left: left$1,\n    right: right$1\n  };\n  var _hone = function hone(universe, item, predicate, mode, direction, isRoot) {\n    var next = _go(universe, item, mode, direction);\n    return next.bind(function (n) {\n      if (isRoot(n.item)) {\n        return Optional.none();\n      } else {\n        return predicate(n.item) ? Optional.some(n.item) : _hone(universe, n.item, predicate, n.mode, direction, isRoot);\n      }\n    });\n  };\n  var left = function left(universe, item, predicate, isRoot) {\n    return _hone(universe, item, predicate, sidestep, Walkers.left(), isRoot);\n  };\n  var right = function right(universe, item, predicate, isRoot) {\n    return _hone(universe, item, predicate, sidestep, Walkers.right(), isRoot);\n  };\n  var isLeaf = function isLeaf(universe) {\n    return function (element) {\n      return universe.property().children(element).length === 0;\n    };\n  };\n  var before$1 = function before$1(universe, item, isRoot) {\n    return seekLeft$1(universe, item, isLeaf(universe), isRoot);\n  };\n  var after$1 = function after$1(universe, item, isRoot) {\n    return seekRight$1(universe, item, isLeaf(universe), isRoot);\n  };\n  var seekLeft$1 = left;\n  var seekRight$1 = right;\n  var universe = DomUniverse();\n  var before = function before(element, isRoot) {\n    return before$1(universe, element, isRoot);\n  };\n  var after = function after(element, isRoot) {\n    return after$1(universe, element, isRoot);\n  };\n  var seekLeft = function seekLeft(element, predicate, isRoot) {\n    return seekLeft$1(universe, element, predicate, isRoot);\n  };\n  var seekRight = function seekRight(element, predicate, isRoot) {\n    return seekRight$1(universe, element, predicate, isRoot);\n  };\n  var ancestor = function ancestor(scope, predicate, isRoot) {\n    return ancestor$2(scope, predicate, isRoot).isSome();\n  };\n  var adt$1 = Adt.generate([{\n    none: ['message']\n  }, {\n    success: []\n  }, {\n    failedUp: ['cell']\n  }, {\n    failedDown: ['cell']\n  }]);\n  var isOverlapping = function isOverlapping(bridge, before, after) {\n    var beforeBounds = bridge.getRect(before);\n    var afterBounds = bridge.getRect(after);\n    return afterBounds.right > beforeBounds.left && afterBounds.left < beforeBounds.right;\n  };\n  var isRow = function isRow(elem) {\n    return closest$1(elem, 'tr');\n  };\n  var verify = function verify(bridge, before, beforeOffset, after, afterOffset, failure, isRoot) {\n    return closest$1(after, 'td,th', isRoot).bind(function (afterCell) {\n      return closest$1(before, 'td,th', isRoot).map(function (beforeCell) {\n        if (!eq$1(afterCell, beforeCell)) {\n          return sharedOne(isRow, [afterCell, beforeCell]).fold(function () {\n            return isOverlapping(bridge, beforeCell, afterCell) ? adt$1.success() : failure(beforeCell);\n          }, function (_sharedRow) {\n            return failure(beforeCell);\n          });\n        } else {\n          return eq$1(after, afterCell) && getEnd(afterCell) === afterOffset ? failure(beforeCell) : adt$1.none('in same cell');\n        }\n      });\n    }).getOr(adt$1.none('default'));\n  };\n  var cata = function cata(subject, onNone, onSuccess, onFailedUp, onFailedDown) {\n    return subject.fold(onNone, onSuccess, onFailedUp, onFailedDown);\n  };\n  var BeforeAfter = _assign(_assign({}, adt$1), {\n    verify: verify,\n    cata: cata\n  });\n  var inParent = function inParent(parent, children, element, index) {\n    return {\n      parent: parent,\n      children: children,\n      element: element,\n      index: index\n    };\n  };\n  var indexInParent = function indexInParent(element) {\n    return parent(element).bind(function (parent) {\n      var children = children$3(parent);\n      return indexOf(children, element).map(function (index) {\n        return inParent(parent, children, element, index);\n      });\n    });\n  };\n  var indexOf = function indexOf(elements, element) {\n    return findIndex(elements, curry(eq$1, element));\n  };\n  var isBr = function isBr(elem) {\n    return name(elem) === 'br';\n  };\n  var _gatherer = function gatherer(cand, gather, isRoot) {\n    return gather(cand, isRoot).bind(function (target) {\n      return isText(target) && get$9(target).trim().length === 0 ? _gatherer(target, gather, isRoot) : Optional.some(target);\n    });\n  };\n  var handleBr = function handleBr(isRoot, element, direction) {\n    return direction.traverse(element).orThunk(function () {\n      return _gatherer(element, direction.gather, isRoot);\n    }).map(direction.relative);\n  };\n  var findBr = function findBr(element, offset) {\n    return child$3(element, offset).filter(isBr).orThunk(function () {\n      return child$3(element, offset - 1).filter(isBr);\n    });\n  };\n  var handleParent = function handleParent(isRoot, element, offset, direction) {\n    return findBr(element, offset).bind(function (br) {\n      return direction.traverse(br).fold(function () {\n        return _gatherer(br, direction.gather, isRoot).map(direction.relative);\n      }, function (adjacent) {\n        return indexInParent(adjacent).map(function (info) {\n          return Situ.on(info.parent, info.index);\n        });\n      });\n    });\n  };\n  var tryBr = function tryBr(isRoot, element, offset, direction) {\n    var target = isBr(element) ? handleBr(isRoot, element, direction) : handleParent(isRoot, element, offset, direction);\n    return target.map(function (tgt) {\n      return {\n        start: tgt,\n        finish: tgt\n      };\n    });\n  };\n  var process = function process(analysis) {\n    return BeforeAfter.cata(analysis, function (_message) {\n      return Optional.none();\n    }, function () {\n      return Optional.none();\n    }, function (cell) {\n      return Optional.some(point(cell, 0));\n    }, function (cell) {\n      return Optional.some(point(cell, getEnd(cell)));\n    });\n  };\n  var moveDown = function moveDown(caret, amount) {\n    return {\n      left: caret.left,\n      top: caret.top + amount,\n      right: caret.right,\n      bottom: caret.bottom + amount\n    };\n  };\n  var moveUp = function moveUp(caret, amount) {\n    return {\n      left: caret.left,\n      top: caret.top - amount,\n      right: caret.right,\n      bottom: caret.bottom - amount\n    };\n  };\n  var translate = function translate(caret, xDelta, yDelta) {\n    return {\n      left: caret.left + xDelta,\n      top: caret.top + yDelta,\n      right: caret.right + xDelta,\n      bottom: caret.bottom + yDelta\n    };\n  };\n  var getTop = function getTop(caret) {\n    return caret.top;\n  };\n  var getBottom = function getBottom(caret) {\n    return caret.bottom;\n  };\n  var getPartialBox = function getPartialBox(bridge, element, offset) {\n    if (offset >= 0 && offset < getEnd(element)) {\n      return bridge.getRangedRect(element, offset, element, offset + 1);\n    } else if (offset > 0) {\n      return bridge.getRangedRect(element, offset - 1, element, offset);\n    }\n    return Optional.none();\n  };\n  var toCaret = function toCaret(rect) {\n    return {\n      left: rect.left,\n      top: rect.top,\n      right: rect.right,\n      bottom: rect.bottom\n    };\n  };\n  var getElemBox = function getElemBox(bridge, element) {\n    return Optional.some(bridge.getRect(element));\n  };\n  var getBoxAt = function getBoxAt(bridge, element, offset) {\n    if (isElement(element)) {\n      return getElemBox(bridge, element).map(toCaret);\n    } else if (isText(element)) {\n      return getPartialBox(bridge, element, offset).map(toCaret);\n    } else {\n      return Optional.none();\n    }\n  };\n  var getEntireBox = function getEntireBox(bridge, element) {\n    if (isElement(element)) {\n      return getElemBox(bridge, element).map(toCaret);\n    } else if (isText(element)) {\n      return bridge.getRangedRect(element, 0, element, getEnd(element)).map(toCaret);\n    } else {\n      return Optional.none();\n    }\n  };\n  var JUMP_SIZE = 5;\n  var NUM_RETRIES = 100;\n  var adt = Adt.generate([{\n    none: []\n  }, {\n    retry: ['caret']\n  }]);\n  var isOutside = function isOutside(caret, box) {\n    return caret.left < box.left || Math.abs(box.right - caret.left) < 1 || caret.left > box.right;\n  };\n  var inOutsideBlock = function inOutsideBlock(bridge, element, caret) {\n    return closest$2(element, isBlock).fold(never, function (cell) {\n      return getEntireBox(bridge, cell).exists(function (box) {\n        return isOutside(caret, box);\n      });\n    });\n  };\n  var adjustDown = function adjustDown(bridge, element, guessBox, original, caret) {\n    var lowerCaret = moveDown(caret, JUMP_SIZE);\n    if (Math.abs(guessBox.bottom - original.bottom) < 1) {\n      return adt.retry(lowerCaret);\n    } else if (guessBox.top > caret.bottom) {\n      return adt.retry(lowerCaret);\n    } else if (guessBox.top === caret.bottom) {\n      return adt.retry(moveDown(caret, 1));\n    } else {\n      return inOutsideBlock(bridge, element, caret) ? adt.retry(translate(lowerCaret, JUMP_SIZE, 0)) : adt.none();\n    }\n  };\n  var adjustUp = function adjustUp(bridge, element, guessBox, original, caret) {\n    var higherCaret = moveUp(caret, JUMP_SIZE);\n    if (Math.abs(guessBox.top - original.top) < 1) {\n      return adt.retry(higherCaret);\n    } else if (guessBox.bottom < caret.top) {\n      return adt.retry(higherCaret);\n    } else if (guessBox.bottom === caret.top) {\n      return adt.retry(moveUp(caret, 1));\n    } else {\n      return inOutsideBlock(bridge, element, caret) ? adt.retry(translate(higherCaret, JUMP_SIZE, 0)) : adt.none();\n    }\n  };\n  var upMovement = {\n    point: getTop,\n    adjuster: adjustUp,\n    move: moveUp,\n    gather: before\n  };\n  var downMovement = {\n    point: getBottom,\n    adjuster: adjustDown,\n    move: moveDown,\n    gather: after\n  };\n  var isAtTable = function isAtTable(bridge, x, y) {\n    return bridge.elementFromPoint(x, y).filter(function (elm) {\n      return name(elm) === 'table';\n    }).isSome();\n  };\n  var adjustForTable = function adjustForTable(bridge, movement, original, caret, numRetries) {\n    return _adjustTil(bridge, movement, original, movement.move(caret, JUMP_SIZE), numRetries);\n  };\n  var _adjustTil = function adjustTil(bridge, movement, original, caret, numRetries) {\n    if (numRetries === 0) {\n      return Optional.some(caret);\n    }\n    if (isAtTable(bridge, caret.left, movement.point(caret))) {\n      return adjustForTable(bridge, movement, original, caret, numRetries - 1);\n    }\n    return bridge.situsFromPoint(caret.left, movement.point(caret)).bind(function (guess) {\n      return guess.start.fold(Optional.none, function (element) {\n        return getEntireBox(bridge, element).bind(function (guessBox) {\n          return movement.adjuster(bridge, element, guessBox, original, caret).fold(Optional.none, function (newCaret) {\n            return _adjustTil(bridge, movement, original, newCaret, numRetries - 1);\n          });\n        }).orThunk(function () {\n          return Optional.some(caret);\n        });\n      }, Optional.none);\n    });\n  };\n  var ieTryDown = function ieTryDown(bridge, caret) {\n    return bridge.situsFromPoint(caret.left, caret.bottom + JUMP_SIZE);\n  };\n  var ieTryUp = function ieTryUp(bridge, caret) {\n    return bridge.situsFromPoint(caret.left, caret.top - JUMP_SIZE);\n  };\n  var checkScroll = function checkScroll(movement, adjusted, bridge) {\n    if (movement.point(adjusted) > bridge.getInnerHeight()) {\n      return Optional.some(movement.point(adjusted) - bridge.getInnerHeight());\n    } else if (movement.point(adjusted) < 0) {\n      return Optional.some(-movement.point(adjusted));\n    } else {\n      return Optional.none();\n    }\n  };\n  var retry = function retry(movement, bridge, caret) {\n    var moved = movement.move(caret, JUMP_SIZE);\n    var adjusted = _adjustTil(bridge, movement, caret, moved, NUM_RETRIES).getOr(moved);\n    return checkScroll(movement, adjusted, bridge).fold(function () {\n      return bridge.situsFromPoint(adjusted.left, movement.point(adjusted));\n    }, function (delta) {\n      bridge.scrollBy(0, delta);\n      return bridge.situsFromPoint(adjusted.left, movement.point(adjusted) - delta);\n    });\n  };\n  var Retries = {\n    tryUp: curry(retry, upMovement),\n    tryDown: curry(retry, downMovement),\n    ieTryUp: ieTryUp,\n    ieTryDown: ieTryDown,\n    getJumpSize: constant(JUMP_SIZE)\n  };\n  var MAX_RETRIES = 20;\n  var findSpot = function findSpot(bridge, isRoot, direction) {\n    return bridge.getSelection().bind(function (sel) {\n      return tryBr(isRoot, sel.finish, sel.foffset, direction).fold(function () {\n        return Optional.some(point(sel.finish, sel.foffset));\n      }, function (brNeighbour) {\n        var range = bridge.fromSitus(brNeighbour);\n        var analysis = BeforeAfter.verify(bridge, sel.finish, sel.foffset, range.finish, range.foffset, direction.failure, isRoot);\n        return process(analysis);\n      });\n    });\n  };\n  var _scan = function scan(bridge, isRoot, element, offset, direction, numRetries) {\n    if (numRetries === 0) {\n      return Optional.none();\n    }\n    return tryCursor(bridge, isRoot, element, offset, direction).bind(function (situs) {\n      var range = bridge.fromSitus(situs);\n      var analysis = BeforeAfter.verify(bridge, element, offset, range.finish, range.foffset, direction.failure, isRoot);\n      return BeforeAfter.cata(analysis, function () {\n        return Optional.none();\n      }, function () {\n        return Optional.some(situs);\n      }, function (cell) {\n        if (eq$1(element, cell) && offset === 0) {\n          return tryAgain(bridge, element, offset, moveUp, direction);\n        } else {\n          return _scan(bridge, isRoot, cell, 0, direction, numRetries - 1);\n        }\n      }, function (cell) {\n        if (eq$1(element, cell) && offset === getEnd(cell)) {\n          return tryAgain(bridge, element, offset, moveDown, direction);\n        } else {\n          return _scan(bridge, isRoot, cell, getEnd(cell), direction, numRetries - 1);\n        }\n      });\n    });\n  };\n  var tryAgain = function tryAgain(bridge, element, offset, move, direction) {\n    return getBoxAt(bridge, element, offset).bind(function (box) {\n      return tryAt(bridge, direction, move(box, Retries.getJumpSize()));\n    });\n  };\n  var tryAt = function tryAt(bridge, direction, box) {\n    var browser = detect$3().browser;\n    if (browser.isChrome() || browser.isSafari() || browser.isFirefox() || browser.isEdge()) {\n      return direction.otherRetry(bridge, box);\n    } else if (browser.isIE()) {\n      return direction.ieRetry(bridge, box);\n    } else {\n      return Optional.none();\n    }\n  };\n  var tryCursor = function tryCursor(bridge, isRoot, element, offset, direction) {\n    return getBoxAt(bridge, element, offset).bind(function (box) {\n      return tryAt(bridge, direction, box);\n    });\n  };\n  var handle = function handle(bridge, isRoot, direction) {\n    return findSpot(bridge, isRoot, direction).bind(function (spot) {\n      return _scan(bridge, isRoot, spot.element, spot.offset, direction, MAX_RETRIES).map(bridge.fromSitus);\n    });\n  };\n  var inSameTable = function inSameTable(elem, table) {\n    return ancestor(elem, function (e) {\n      return parent(e).exists(function (p) {\n        return eq$1(p, table);\n      });\n    });\n  };\n  var simulate = function simulate(bridge, isRoot, direction, initial, anchor) {\n    return closest$1(initial, 'td,th', isRoot).bind(function (start) {\n      return closest$1(start, 'table', isRoot).bind(function (table) {\n        if (!inSameTable(anchor, table)) {\n          return Optional.none();\n        }\n        return handle(bridge, isRoot, direction).bind(function (range) {\n          return closest$1(range.finish, 'td,th', isRoot).map(function (finish) {\n            return {\n              start: start,\n              finish: finish,\n              range: range\n            };\n          });\n        });\n      });\n    });\n  };\n  var navigate = function navigate(bridge, isRoot, direction, initial, anchor, precheck) {\n    if (detect$3().browser.isIE()) {\n      return Optional.none();\n    } else {\n      return precheck(initial, isRoot).orThunk(function () {\n        return simulate(bridge, isRoot, direction, initial, anchor).map(function (info) {\n          var range = info.range;\n          return Response.create(Optional.some(makeSitus(range.start, range.soffset, range.finish, range.foffset)), true);\n        });\n      });\n    }\n  };\n  var firstUpCheck = function firstUpCheck(initial, isRoot) {\n    return closest$1(initial, 'tr', isRoot).bind(function (startRow) {\n      return closest$1(startRow, 'table', isRoot).bind(function (table) {\n        var rows = descendants(table, 'tr');\n        if (eq$1(startRow, rows[0])) {\n          return seekLeft(table, function (element) {\n            return last$1(element).isSome();\n          }, isRoot).map(function (last) {\n            var lastOffset = getEnd(last);\n            return Response.create(Optional.some(makeSitus(last, lastOffset, last, lastOffset)), true);\n          });\n        } else {\n          return Optional.none();\n        }\n      });\n    });\n  };\n  var lastDownCheck = function lastDownCheck(initial, isRoot) {\n    return closest$1(initial, 'tr', isRoot).bind(function (startRow) {\n      return closest$1(startRow, 'table', isRoot).bind(function (table) {\n        var rows = descendants(table, 'tr');\n        if (eq$1(startRow, rows[rows.length - 1])) {\n          return seekRight(table, function (element) {\n            return first(element).isSome();\n          }, isRoot).map(function (first) {\n            return Response.create(Optional.some(makeSitus(first, 0, first, 0)), true);\n          });\n        } else {\n          return Optional.none();\n        }\n      });\n    });\n  };\n  var select = function select(bridge, container, isRoot, direction, initial, anchor, selectRange) {\n    return simulate(bridge, isRoot, direction, initial, anchor).bind(function (info) {\n      return detect(container, isRoot, info.start, info.finish, selectRange);\n    });\n  };\n  var findCell = function findCell(target, isRoot) {\n    return closest$1(target, 'td,th', isRoot);\n  };\n  var MouseSelection = function MouseSelection(bridge, container, isRoot, annotations) {\n    var cursor = value();\n    var clearstate = cursor.clear;\n    var applySelection = function applySelection(event) {\n      cursor.on(function (start) {\n        annotations.clearBeforeUpdate(container);\n        findCell(event.target, isRoot).each(function (finish) {\n          identify(start, finish, isRoot).each(function (cellSel) {\n            var boxes = cellSel.boxes.getOr([]);\n            if (boxes.length === 1) {\n              var singleCell = boxes[0];\n              var isNonEditableCell = getRaw(singleCell) === 'false';\n              var isCellClosestContentEditable = is(closest(event.target), singleCell, eq$1);\n              if (isNonEditableCell && isCellClosestContentEditable) {\n                annotations.selectRange(container, boxes, singleCell, singleCell);\n                bridge.selectContents(singleCell);\n              }\n            } else if (boxes.length > 1) {\n              annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);\n              bridge.selectContents(finish);\n            }\n          });\n        });\n      });\n    };\n    var mousedown = function mousedown(event) {\n      annotations.clear(container);\n      findCell(event.target, isRoot).each(cursor.set);\n    };\n    var mouseover = function mouseover(event) {\n      applySelection(event);\n    };\n    var mouseup = function mouseup(event) {\n      applySelection(event);\n      clearstate();\n    };\n    return {\n      clearstate: clearstate,\n      mousedown: mousedown,\n      mouseover: mouseover,\n      mouseup: mouseup\n    };\n  };\n  var down = {\n    traverse: nextSibling,\n    gather: after,\n    relative: Situ.before,\n    otherRetry: Retries.tryDown,\n    ieRetry: Retries.ieTryDown,\n    failure: BeforeAfter.failedDown\n  };\n  var up = {\n    traverse: prevSibling,\n    gather: before,\n    relative: Situ.before,\n    otherRetry: Retries.tryUp,\n    ieRetry: Retries.ieTryUp,\n    failure: BeforeAfter.failedUp\n  };\n  var isKey = function isKey(key) {\n    return function (keycode) {\n      return keycode === key;\n    };\n  };\n  var isUp = isKey(38);\n  var isDown = isKey(40);\n  var isNavigation = function isNavigation(keycode) {\n    return keycode >= 37 && keycode <= 40;\n  };\n  var ltr = {\n    isBackward: isKey(37),\n    isForward: isKey(39)\n  };\n  var rtl = {\n    isBackward: isKey(39),\n    isForward: isKey(37)\n  };\n  var get = function get(_DOC) {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;\n    var y = doc.body.scrollTop || doc.documentElement.scrollTop;\n    return SugarPosition(x, y);\n  };\n  var by = function by(x, y, _DOC) {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var win = doc.defaultView;\n    if (win) {\n      win.scrollBy(x, y);\n    }\n  };\n  var WindowBridge = function WindowBridge(win) {\n    var elementFromPoint = function elementFromPoint(x, y) {\n      return SugarElement.fromPoint(SugarElement.fromDom(win.document), x, y);\n    };\n    var getRect = function getRect(element) {\n      return element.dom.getBoundingClientRect();\n    };\n    var getRangedRect = function getRangedRect(start, soffset, finish, foffset) {\n      var sel = SimSelection.exact(start, soffset, finish, foffset);\n      return getFirstRect(win, sel);\n    };\n    var getSelection = function getSelection() {\n      return get$1(win).map(function (exactAdt) {\n        return convertToRange(win, exactAdt);\n      });\n    };\n    var fromSitus = function fromSitus(situs) {\n      var relative = SimSelection.relative(situs.start, situs.finish);\n      return convertToRange(win, relative);\n    };\n    var situsFromPoint = function situsFromPoint(x, y) {\n      return getAtPoint(win, x, y).map(function (exact) {\n        return Situs.create(exact.start, exact.soffset, exact.finish, exact.foffset);\n      });\n    };\n    var clearSelection = function clearSelection() {\n      clear(win);\n    };\n    var collapseSelection = function collapseSelection(toStart) {\n      if (toStart === void 0) {\n        toStart = false;\n      }\n      get$1(win).each(function (sel) {\n        return sel.fold(function (rng) {\n          return rng.collapse(toStart);\n        }, function (startSitu, finishSitu) {\n          var situ = toStart ? startSitu : finishSitu;\n          setRelative(win, situ, situ);\n        }, function (start, soffset, finish, foffset) {\n          var node = toStart ? start : finish;\n          var offset = toStart ? soffset : foffset;\n          setExact(win, node, offset, node, offset);\n        });\n      });\n    };\n    var selectNode = function selectNode(element) {\n      setToElement(win, element, false);\n    };\n    var selectContents = function selectContents(element) {\n      setToElement(win, element);\n    };\n    var setSelection = function setSelection(sel) {\n      setExact(win, sel.start, sel.soffset, sel.finish, sel.foffset);\n    };\n    var setRelativeSelection = function setRelativeSelection(start, finish) {\n      setRelative(win, start, finish);\n    };\n    var getInnerHeight = function getInnerHeight() {\n      return win.innerHeight;\n    };\n    var getScrollY = function getScrollY() {\n      var pos = get(SugarElement.fromDom(win.document));\n      return pos.top;\n    };\n    var scrollBy = function scrollBy(x, y) {\n      by(x, y, SugarElement.fromDom(win.document));\n    };\n    return {\n      elementFromPoint: elementFromPoint,\n      getRect: getRect,\n      getRangedRect: getRangedRect,\n      getSelection: getSelection,\n      fromSitus: fromSitus,\n      situsFromPoint: situsFromPoint,\n      clearSelection: clearSelection,\n      collapseSelection: collapseSelection,\n      setSelection: setSelection,\n      setRelativeSelection: setRelativeSelection,\n      selectNode: selectNode,\n      selectContents: selectContents,\n      getInnerHeight: getInnerHeight,\n      getScrollY: getScrollY,\n      scrollBy: scrollBy\n    };\n  };\n  var rc = function rc(rows, cols) {\n    return {\n      rows: rows,\n      cols: cols\n    };\n  };\n  var mouse = function mouse(win, container, isRoot, annotations) {\n    var bridge = WindowBridge(win);\n    var handlers = MouseSelection(bridge, container, isRoot, annotations);\n    return {\n      clearstate: handlers.clearstate,\n      mousedown: handlers.mousedown,\n      mouseover: handlers.mouseover,\n      mouseup: handlers.mouseup\n    };\n  };\n  var keyboard = function keyboard(win, container, isRoot, annotations) {\n    var bridge = WindowBridge(win);\n    var clearToNavigate = function clearToNavigate() {\n      annotations.clear(container);\n      return Optional.none();\n    };\n    var keydown = function keydown(event, start, soffset, finish, foffset, direction) {\n      var realEvent = event.raw;\n      var keycode = realEvent.which;\n      var shiftKey = realEvent.shiftKey === true;\n      var handler = retrieve$1(container, annotations.selectedSelector).fold(function () {\n        if (isNavigation(keycode) && !shiftKey) {\n          annotations.clearBeforeUpdate(container);\n        }\n        if (isDown(keycode) && shiftKey) {\n          return curry(select, bridge, container, isRoot, down, finish, start, annotations.selectRange);\n        } else if (isUp(keycode) && shiftKey) {\n          return curry(select, bridge, container, isRoot, up, finish, start, annotations.selectRange);\n        } else if (isDown(keycode)) {\n          return curry(navigate, bridge, isRoot, down, finish, start, lastDownCheck);\n        } else if (isUp(keycode)) {\n          return curry(navigate, bridge, isRoot, up, finish, start, firstUpCheck);\n        } else {\n          return Optional.none;\n        }\n      }, function (selected) {\n        var update$1 = function update$1(attempts) {\n          return function () {\n            var navigation = findMap(attempts, function (delta) {\n              return update(delta.rows, delta.cols, container, selected, annotations);\n            });\n            return navigation.fold(function () {\n              return getEdges(container, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(function (edges) {\n                var relative = isDown(keycode) || direction.isForward(keycode) ? Situ.after : Situ.before;\n                bridge.setRelativeSelection(Situ.on(edges.first, 0), relative(edges.table));\n                annotations.clear(container);\n                return Response.create(Optional.none(), true);\n              });\n            }, function (_) {\n              return Optional.some(Response.create(Optional.none(), true));\n            });\n          };\n        };\n        if (isDown(keycode) && shiftKey) {\n          return update$1([rc(+1, 0)]);\n        } else if (isUp(keycode) && shiftKey) {\n          return update$1([rc(-1, 0)]);\n        } else if (direction.isBackward(keycode) && shiftKey) {\n          return update$1([rc(0, -1), rc(-1, 0)]);\n        } else if (direction.isForward(keycode) && shiftKey) {\n          return update$1([rc(0, +1), rc(+1, 0)]);\n        } else if (isNavigation(keycode) && !shiftKey) {\n          return clearToNavigate;\n        } else {\n          return Optional.none;\n        }\n      });\n      return handler();\n    };\n    var keyup = function keyup(event, start, soffset, finish, foffset) {\n      return retrieve$1(container, annotations.selectedSelector).fold(function () {\n        var realEvent = event.raw;\n        var keycode = realEvent.which;\n        var shiftKey = realEvent.shiftKey === true;\n        if (!shiftKey) {\n          return Optional.none();\n        }\n        if (isNavigation(keycode)) {\n          return sync(container, isRoot, start, soffset, finish, foffset, annotations.selectRange);\n        } else {\n          return Optional.none();\n        }\n      }, Optional.none);\n    };\n    return {\n      keydown: keydown,\n      keyup: keyup\n    };\n  };\n  var external = function external(win, container, isRoot, annotations) {\n    var bridge = WindowBridge(win);\n    return function (start, finish) {\n      annotations.clearBeforeUpdate(container);\n      identify(start, finish, isRoot).each(function (cellSel) {\n        var boxes = cellSel.boxes.getOr([]);\n        annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);\n        bridge.selectContents(finish);\n        bridge.collapseSelection();\n      });\n    };\n  };\n  var remove = function remove(element, classes) {\n    each$2(classes, function (x) {\n      remove$2(element, x);\n    });\n  };\n  var addClass = function addClass(clazz) {\n    return function (element) {\n      add(element, clazz);\n    };\n  };\n  var removeClasses = function removeClasses(classes) {\n    return function (element) {\n      remove(element, classes);\n    };\n  };\n  var byClass = function byClass(ephemera) {\n    var addSelectionClass = addClass(ephemera.selected);\n    var removeSelectionClasses = removeClasses([ephemera.selected, ephemera.lastSelected, ephemera.firstSelected]);\n    var clear = function clear(container) {\n      var sels = descendants(container, ephemera.selectedSelector);\n      each$2(sels, removeSelectionClasses);\n    };\n    var selectRange = function selectRange(container, cells, start, finish) {\n      clear(container);\n      each$2(cells, addSelectionClass);\n      add(start, ephemera.firstSelected);\n      add(finish, ephemera.lastSelected);\n    };\n    return {\n      clearBeforeUpdate: clear,\n      clear: clear,\n      selectRange: selectRange,\n      selectedSelector: ephemera.selectedSelector,\n      firstSelectedSelector: ephemera.firstSelectedSelector,\n      lastSelectedSelector: ephemera.lastSelectedSelector\n    };\n  };\n  var byAttr = function byAttr(ephemera, onSelection, onClear) {\n    var removeSelectionAttributes = function removeSelectionAttributes(element) {\n      remove$7(element, ephemera.selected);\n      remove$7(element, ephemera.firstSelected);\n      remove$7(element, ephemera.lastSelected);\n    };\n    var addSelectionAttribute = function addSelectionAttribute(element) {\n      set$2(element, ephemera.selected, '1');\n    };\n    var clear = function clear(container) {\n      clearBeforeUpdate(container);\n      onClear();\n    };\n    var clearBeforeUpdate = function clearBeforeUpdate(container) {\n      var sels = descendants(container, ephemera.selectedSelector + ',' + ephemera.firstSelectedSelector + ',' + ephemera.lastSelectedSelector);\n      each$2(sels, removeSelectionAttributes);\n    };\n    var selectRange = function selectRange(container, cells, start, finish) {\n      clear(container);\n      each$2(cells, addSelectionAttribute);\n      set$2(start, ephemera.firstSelected, '1');\n      set$2(finish, ephemera.lastSelected, '1');\n      onSelection(cells, start, finish);\n    };\n    return {\n      clearBeforeUpdate: clearBeforeUpdate,\n      clear: clear,\n      selectRange: selectRange,\n      selectedSelector: ephemera.selectedSelector,\n      firstSelectedSelector: ephemera.firstSelectedSelector,\n      lastSelectedSelector: ephemera.lastSelectedSelector\n    };\n  };\n  var SelectionAnnotation = {\n    byClass: byClass,\n    byAttr: byAttr\n  };\n  var getUpOrLeftCells = function getUpOrLeftCells(grid, selectedCells) {\n    var upGrid = grid.slice(0, selectedCells[selectedCells.length - 1].row + 1);\n    var upDetails = toDetailList(upGrid);\n    return bind$2(upDetails, function (detail) {\n      var slicedCells = detail.cells.slice(0, selectedCells[selectedCells.length - 1].column + 1);\n      return map$1(slicedCells, function (cell) {\n        return cell.element;\n      });\n    });\n  };\n  var getDownOrRightCells = function getDownOrRightCells(grid, selectedCells) {\n    var downGrid = grid.slice(selectedCells[0].row + selectedCells[0].rowspan - 1, grid.length);\n    var downDetails = toDetailList(downGrid);\n    return bind$2(downDetails, function (detail) {\n      var slicedCells = detail.cells.slice(selectedCells[0].column + selectedCells[0].colspan - 1, detail.cells.length);\n      return map$1(slicedCells, function (cell) {\n        return cell.element;\n      });\n    });\n  };\n  var getOtherCells = function getOtherCells(table, target, generators) {\n    var warehouse = Warehouse.fromTable(table);\n    var details = onCells(warehouse, target);\n    return details.map(function (selectedCells) {\n      var grid = toGrid(warehouse, generators, false);\n      var upOrLeftCells = getUpOrLeftCells(grid, selectedCells);\n      var downOrRightCells = getDownOrRightCells(grid, selectedCells);\n      return {\n        upOrLeftCells: upOrLeftCells,\n        downOrRightCells: downOrRightCells\n      };\n    });\n  };\n  var global = tinymce.util.Tools.resolve('tinymce.Env');\n  var hasInternalTarget = function hasInternalTarget(e) {\n    return has(SugarElement.fromDom(e.target), 'ephox-snooker-resizer-bar') === false;\n  };\n  function CellSelection(editor, lazyResize, selectionTargets) {\n    var onSelection = function onSelection(cells, start, finish) {\n      selectionTargets.targets().each(function (targets) {\n        var tableOpt = table(start);\n        tableOpt.each(function (table) {\n          var cloneFormats = getCloneElements(editor);\n          var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), cloneFormats);\n          var otherCells = getOtherCells(table, targets, generators);\n          fireTableSelectionChange(editor, cells, start, finish, otherCells);\n        });\n      });\n    };\n    var onClear = function onClear() {\n      return fireTableSelectionClear(editor);\n    };\n    var annotations = SelectionAnnotation.byAttr(ephemera, onSelection, onClear);\n    editor.on('init', function (_e) {\n      var win = editor.getWin();\n      var body = getBody(editor);\n      var isRoot = getIsRoot(editor);\n      var syncSelection = function syncSelection() {\n        var sel = editor.selection;\n        var start = SugarElement.fromDom(sel.getStart());\n        var end = SugarElement.fromDom(sel.getEnd());\n        var shared = sharedOne(table, [start, end]);\n        shared.fold(function () {\n          return annotations.clear(body);\n        }, noop);\n      };\n      var mouseHandlers = mouse(win, body, isRoot, annotations);\n      var keyHandlers = keyboard(win, body, isRoot, annotations);\n      var external$1 = external(win, body, isRoot, annotations);\n      var hasShiftKey = function hasShiftKey(event) {\n        return event.raw.shiftKey === true;\n      };\n      editor.on('TableSelectorChange', function (e) {\n        return external$1(e.start, e.finish);\n      });\n      var handleResponse = function handleResponse(event, response) {\n        if (!hasShiftKey(event)) {\n          return;\n        }\n        if (response.kill) {\n          event.kill();\n        }\n        response.selection.each(function (ns) {\n          var relative = SimSelection.relative(ns.start, ns.finish);\n          var rng = asLtrRange(win, relative);\n          editor.selection.setRng(rng);\n        });\n      };\n      var keyup = function keyup(event) {\n        var wrappedEvent = fromRawEvent(event);\n        if (wrappedEvent.raw.shiftKey && isNavigation(wrappedEvent.raw.which)) {\n          var rng = editor.selection.getRng();\n          var start = SugarElement.fromDom(rng.startContainer);\n          var end = SugarElement.fromDom(rng.endContainer);\n          keyHandlers.keyup(wrappedEvent, start, rng.startOffset, end, rng.endOffset).each(function (response) {\n            handleResponse(wrappedEvent, response);\n          });\n        }\n      };\n      var keydown = function keydown(event) {\n        var wrappedEvent = fromRawEvent(event);\n        lazyResize().each(function (resize) {\n          return resize.hideBars();\n        });\n        var rng = editor.selection.getRng();\n        var start = SugarElement.fromDom(rng.startContainer);\n        var end = SugarElement.fromDom(rng.endContainer);\n        var direction = onDirection(ltr, rtl)(SugarElement.fromDom(editor.selection.getStart()));\n        keyHandlers.keydown(wrappedEvent, start, rng.startOffset, end, rng.endOffset, direction).each(function (response) {\n          handleResponse(wrappedEvent, response);\n        });\n        lazyResize().each(function (resize) {\n          return resize.showBars();\n        });\n      };\n      var isLeftMouse = function isLeftMouse(raw) {\n        return raw.button === 0;\n      };\n      var isLeftButtonPressed = function isLeftButtonPressed(raw) {\n        if (raw.buttons === undefined) {\n          return true;\n        }\n        if (global.browser.isEdge() && raw.buttons === 0) {\n          return true;\n        }\n        return (raw.buttons & 1) !== 0;\n      };\n      var dragStart = function dragStart(_e) {\n        mouseHandlers.clearstate();\n      };\n      var mouseDown = function mouseDown(e) {\n        if (isLeftMouse(e) && hasInternalTarget(e)) {\n          mouseHandlers.mousedown(fromRawEvent(e));\n        }\n      };\n      var mouseOver = function mouseOver(e) {\n        if (isLeftButtonPressed(e) && hasInternalTarget(e)) {\n          mouseHandlers.mouseover(fromRawEvent(e));\n        }\n      };\n      var mouseUp = function mouseUp(e) {\n        if (isLeftMouse(e) && hasInternalTarget(e)) {\n          mouseHandlers.mouseup(fromRawEvent(e));\n        }\n      };\n      var getDoubleTap = function getDoubleTap() {\n        var lastTarget = Cell(SugarElement.fromDom(body));\n        var lastTimeStamp = Cell(0);\n        var touchEnd = function touchEnd(t) {\n          var target = SugarElement.fromDom(t.target);\n          if (name(target) === 'td' || name(target) === 'th') {\n            var lT = lastTarget.get();\n            var lTS = lastTimeStamp.get();\n            if (eq$1(lT, target) && t.timeStamp - lTS < 300) {\n              t.preventDefault();\n              external$1(target, target);\n            }\n          }\n          lastTarget.set(target);\n          lastTimeStamp.set(t.timeStamp);\n        };\n        return {\n          touchEnd: touchEnd\n        };\n      };\n      var doubleTap = getDoubleTap();\n      editor.on('dragstart', dragStart);\n      editor.on('mousedown', mouseDown);\n      editor.on('mouseover', mouseOver);\n      editor.on('mouseup', mouseUp);\n      editor.on('touchend', doubleTap.touchEnd);\n      editor.on('keyup', keyup);\n      editor.on('keydown', keydown);\n      editor.on('NodeChange', syncSelection);\n    });\n    return {\n      clear: annotations.clear\n    };\n  }\n  var child = function child(scope, selector) {\n    return child$1(scope, selector).isSome();\n  };\n  var getSelectionTargets = function getSelectionTargets(editor, selections) {\n    var targets = Cell(Optional.none());\n    var changeHandlers = Cell([]);\n    var selectionDetails = Optional.none();\n    var isCaption = isTag('caption');\n    var isDisabledForSelection = function isDisabledForSelection(key) {\n      return selectionDetails.forall(function (details) {\n        return !details[key];\n      });\n    };\n    var getStart = function getStart() {\n      return getSelectionCellOrCaption(getSelectionStart(editor), getIsRoot(editor));\n    };\n    var getEnd = function getEnd() {\n      return getSelectionCellOrCaption(getSelectionEnd(editor), getIsRoot(editor));\n    };\n    var findTargets = function findTargets() {\n      return getStart().bind(function (startCellOrCaption) {\n        return flatten(lift2(table(startCellOrCaption), getEnd().bind(table), function (startTable, endTable) {\n          if (eq$1(startTable, endTable)) {\n            if (isCaption(startCellOrCaption)) {\n              return Optional.some(noMenu(startCellOrCaption));\n            } else {\n              return Optional.some(forMenu(selections, startTable, startCellOrCaption));\n            }\n          }\n          return Optional.none();\n        }));\n      });\n    };\n    var getExtractedDetails = function getExtractedDetails(targets) {\n      var tableOpt = table(targets.element);\n      return tableOpt.map(function (table) {\n        var warehouse = Warehouse.fromTable(table);\n        var selectedCells = onCells(warehouse, targets).getOr([]);\n        var locked = foldl(selectedCells, function (acc, cell) {\n          if (cell.isLocked) {\n            acc.onAny = true;\n            if (cell.column === 0) {\n              acc.onFirst = true;\n            } else if (cell.column + cell.colspan >= warehouse.grid.columns) {\n              acc.onLast = true;\n            }\n          }\n          return acc;\n        }, {\n          onAny: false,\n          onFirst: false,\n          onLast: false\n        });\n        return {\n          mergeable: onUnlockedMergable(warehouse, targets).isSome(),\n          unmergeable: onUnlockedUnmergable(warehouse, targets).isSome(),\n          locked: locked\n        };\n      });\n    };\n    var resetTargets = function resetTargets() {\n      targets.set(cached(findTargets)());\n      selectionDetails = targets.get().bind(getExtractedDetails);\n      each$2(changeHandlers.get(), function (handler) {\n        return handler();\n      });\n    };\n    var setupHandler = function setupHandler(handler) {\n      handler();\n      changeHandlers.set(changeHandlers.get().concat([handler]));\n      return function () {\n        changeHandlers.set(filter$2(changeHandlers.get(), function (h) {\n          return h !== handler;\n        }));\n      };\n    };\n    var onSetup = function onSetup(api, isDisabled) {\n      return setupHandler(function () {\n        return targets.get().fold(function () {\n          api.setDisabled(true);\n        }, function (targets) {\n          api.setDisabled(isDisabled(targets));\n        });\n      });\n    };\n    var onSetupWithToggle = function onSetupWithToggle(api, isDisabled, isActive) {\n      return setupHandler(function () {\n        return targets.get().fold(function () {\n          api.setDisabled(true);\n          api.setActive(false);\n        }, function (targets) {\n          api.setDisabled(isDisabled(targets));\n          api.setActive(isActive(targets));\n        });\n      });\n    };\n    var isDisabledFromLocked = function isDisabledFromLocked(lockedDisable) {\n      return selectionDetails.exists(function (details) {\n        return details.locked[lockedDisable];\n      });\n    };\n    var onSetupTable = function onSetupTable(api) {\n      return onSetup(api, function (_) {\n        return false;\n      });\n    };\n    var onSetupCellOrRow = function onSetupCellOrRow(api) {\n      return onSetup(api, function (targets) {\n        return isCaption(targets.element);\n      });\n    };\n    var onSetupColumn = function onSetupColumn(lockedDisable) {\n      return function (api) {\n        return onSetup(api, function (targets) {\n          return isCaption(targets.element) || isDisabledFromLocked(lockedDisable);\n        });\n      };\n    };\n    var onSetupPasteable = function onSetupPasteable(getClipboardData) {\n      return function (api) {\n        return onSetup(api, function (targets) {\n          return isCaption(targets.element) || getClipboardData().isNone();\n        });\n      };\n    };\n    var onSetupPasteableColumn = function onSetupPasteableColumn(getClipboardData, lockedDisable) {\n      return function (api) {\n        return onSetup(api, function (targets) {\n          return isCaption(targets.element) || getClipboardData().isNone() || isDisabledFromLocked(lockedDisable);\n        });\n      };\n    };\n    var onSetupMergeable = function onSetupMergeable(api) {\n      return onSetup(api, function (_targets) {\n        return isDisabledForSelection('mergeable');\n      });\n    };\n    var onSetupUnmergeable = function onSetupUnmergeable(api) {\n      return onSetup(api, function (_targets) {\n        return isDisabledForSelection('unmergeable');\n      });\n    };\n    var onSetupTableWithCaption = function onSetupTableWithCaption(api) {\n      return onSetupWithToggle(api, never, function (targets) {\n        var tableOpt = table(targets.element, getIsRoot(editor));\n        return tableOpt.exists(function (table) {\n          return child(table, 'caption');\n        });\n      });\n    };\n    var onSetupTableHeaders = function onSetupTableHeaders(command, headerType) {\n      return function (api) {\n        return onSetupWithToggle(api, function (targets) {\n          return isCaption(targets.element);\n        }, function () {\n          return editor.queryCommandValue(command) === headerType;\n        });\n      };\n    };\n    var onSetupTableRowHeaders = onSetupTableHeaders('mceTableRowType', 'header');\n    var onSetupTableColumnHeaders = onSetupTableHeaders('mceTableColType', 'th');\n    editor.on('NodeChange ExecCommand TableSelectorChange', resetTargets);\n    return {\n      onSetupTable: onSetupTable,\n      onSetupCellOrRow: onSetupCellOrRow,\n      onSetupColumn: onSetupColumn,\n      onSetupPasteable: onSetupPasteable,\n      onSetupPasteableColumn: onSetupPasteableColumn,\n      onSetupMergeable: onSetupMergeable,\n      onSetupUnmergeable: onSetupUnmergeable,\n      resetTargets: resetTargets,\n      onSetupTableWithCaption: onSetupTableWithCaption,\n      onSetupTableRowHeaders: onSetupTableRowHeaders,\n      onSetupTableColumnHeaders: onSetupTableColumnHeaders,\n      targets: targets.get\n    };\n  };\n  var addButtons = function addButtons(editor, selections, selectionTargets, clipboard) {\n    editor.ui.registry.addMenuButton('table', {\n      tooltip: 'Table',\n      icon: 'table',\n      fetch: function fetch(callback) {\n        return callback('inserttable | cell row column | advtablesort | tableprops deletetable');\n      }\n    });\n    var cmd = function cmd(command) {\n      return function () {\n        return editor.execCommand(command);\n      };\n    };\n    editor.ui.registry.addButton('tableprops', {\n      tooltip: 'Table properties',\n      onAction: cmd('mceTableProps'),\n      icon: 'table',\n      onSetup: selectionTargets.onSetupTable\n    });\n    editor.ui.registry.addButton('tabledelete', {\n      tooltip: 'Delete table',\n      onAction: cmd('mceTableDelete'),\n      icon: 'table-delete-table',\n      onSetup: selectionTargets.onSetupTable\n    });\n    editor.ui.registry.addButton('tablecellprops', {\n      tooltip: 'Cell properties',\n      onAction: cmd('mceTableCellProps'),\n      icon: 'table-cell-properties',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tablemergecells', {\n      tooltip: 'Merge cells',\n      onAction: cmd('mceTableMergeCells'),\n      icon: 'table-merge-cells',\n      onSetup: selectionTargets.onSetupMergeable\n    });\n    editor.ui.registry.addButton('tablesplitcells', {\n      tooltip: 'Split cell',\n      onAction: cmd('mceTableSplitCells'),\n      icon: 'table-split-cells',\n      onSetup: selectionTargets.onSetupUnmergeable\n    });\n    editor.ui.registry.addButton('tableinsertrowbefore', {\n      tooltip: 'Insert row before',\n      onAction: cmd('mceTableInsertRowBefore'),\n      icon: 'table-insert-row-above',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tableinsertrowafter', {\n      tooltip: 'Insert row after',\n      onAction: cmd('mceTableInsertRowAfter'),\n      icon: 'table-insert-row-after',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tabledeleterow', {\n      tooltip: 'Delete row',\n      onAction: cmd('mceTableDeleteRow'),\n      icon: 'table-delete-row',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tablerowprops', {\n      tooltip: 'Row properties',\n      onAction: cmd('mceTableRowProps'),\n      icon: 'table-row-properties',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tableinsertcolbefore', {\n      tooltip: 'Insert column before',\n      onAction: cmd('mceTableInsertColBefore'),\n      icon: 'table-insert-column-before',\n      onSetup: selectionTargets.onSetupColumn('onFirst')\n    });\n    editor.ui.registry.addButton('tableinsertcolafter', {\n      tooltip: 'Insert column after',\n      onAction: cmd('mceTableInsertColAfter'),\n      icon: 'table-insert-column-after',\n      onSetup: selectionTargets.onSetupColumn('onLast')\n    });\n    editor.ui.registry.addButton('tabledeletecol', {\n      tooltip: 'Delete column',\n      onAction: cmd('mceTableDeleteCol'),\n      icon: 'table-delete-column',\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addButton('tablecutrow', {\n      tooltip: 'Cut row',\n      icon: 'cut-row',\n      onAction: cmd('mceTableCutRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tablecopyrow', {\n      tooltip: 'Copy row',\n      icon: 'duplicate-row',\n      onAction: cmd('mceTableCopyRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tablepasterowbefore', {\n      tooltip: 'Paste row before',\n      icon: 'paste-row-before',\n      onAction: cmd('mceTablePasteRowBefore'),\n      onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n    });\n    editor.ui.registry.addButton('tablepasterowafter', {\n      tooltip: 'Paste row after',\n      icon: 'paste-row-after',\n      onAction: cmd('mceTablePasteRowAfter'),\n      onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n    });\n    editor.ui.registry.addButton('tablecutcol', {\n      tooltip: 'Cut column',\n      icon: 'cut-column',\n      onAction: cmd('mceTableCutCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addButton('tablecopycol', {\n      tooltip: 'Copy column',\n      icon: 'duplicate-column',\n      onAction: cmd('mceTableCopyCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addButton('tablepastecolbefore', {\n      tooltip: 'Paste column before',\n      icon: 'paste-column-before',\n      onAction: cmd('mceTablePasteColBefore'),\n      onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onFirst')\n    });\n    editor.ui.registry.addButton('tablepastecolafter', {\n      tooltip: 'Paste column after',\n      icon: 'paste-column-after',\n      onAction: cmd('mceTablePasteColAfter'),\n      onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onLast')\n    });\n    editor.ui.registry.addButton('tableinsertdialog', {\n      tooltip: 'Insert table',\n      onAction: cmd('mceInsertTable'),\n      icon: 'table'\n    });\n    var tableClassList = _filterNoneItem(getTableClassList(editor));\n    if (tableClassList.length !== 0) {\n      editor.ui.registry.addMenuButton('tableclass', {\n        icon: 'table-classes',\n        tooltip: 'Table styles',\n        fetch: generateMenuItemsCallback(editor, selections, tableClassList, 'tableclass', function (value) {\n          return editor.execCommand('mceTableToggleClass', false, value);\n        }),\n        onSetup: selectionTargets.onSetupTable\n      });\n    }\n    var tableCellClassList = _filterNoneItem(getCellClassList(editor));\n    if (tableCellClassList.length !== 0) {\n      editor.ui.registry.addMenuButton('tablecellclass', {\n        icon: 'table-cell-classes',\n        tooltip: 'Cell styles',\n        fetch: generateMenuItemsCallback(editor, selections, tableCellClassList, 'tablecellclass', function (value) {\n          return editor.execCommand('mceTableCellToggleClass', false, value);\n        }),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n    }\n    editor.ui.registry.addMenuButton('tablecellvalign', {\n      icon: 'vertical-align',\n      tooltip: 'Vertical align',\n      fetch: generateMenuItemsCallback(editor, selections, verticalAlignValues, 'tablecellverticalalign', applyTableCellStyle(editor, 'vertical-align')),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuButton('tablecellborderwidth', {\n      icon: 'border-width',\n      tooltip: 'Border width',\n      fetch: generateMenuItemsCallback(editor, selections, getTableBorderWidths(editor), 'tablecellborderwidth', applyTableCellStyle(editor, 'border-width')),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuButton('tablecellborderstyle', {\n      icon: 'border-style',\n      tooltip: 'Border style',\n      fetch: generateMenuItemsCallback(editor, selections, getTableBorderStyles(editor), 'tablecellborderstyle', applyTableCellStyle(editor, 'border-style')),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addToggleButton('tablecaption', {\n      tooltip: 'Table caption',\n      onAction: cmd('mceTableToggleCaption'),\n      icon: 'table-caption',\n      onSetup: selectionTargets.onSetupTableWithCaption\n    });\n    editor.ui.registry.addMenuButton('tablecellbackgroundcolor', {\n      icon: 'cell-background-color',\n      tooltip: 'Background color',\n      fetch: function fetch(callback) {\n        return callback(buildColorMenu(editor, getTableBackgroundColorMap(editor), 'background-color'));\n      },\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuButton('tablecellbordercolor', {\n      icon: 'cell-border-color',\n      tooltip: 'Border color',\n      fetch: function fetch(callback) {\n        return callback(buildColorMenu(editor, getTableBorderColorMap(editor), 'border-color'));\n      },\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addToggleButton('tablerowheader', {\n      tooltip: 'Row header',\n      icon: 'table-top-header',\n      onAction: changeRowHeader(editor),\n      onSetup: selectionTargets.onSetupTableRowHeaders\n    });\n    editor.ui.registry.addToggleButton('tablecolheader', {\n      tooltip: 'Column header',\n      icon: 'table-left-header',\n      onAction: changeColumnHeader(editor),\n      onSetup: selectionTargets.onSetupTableColumnHeaders\n    });\n  };\n  var addToolbars = function addToolbars(editor) {\n    var isTable = function isTable(table) {\n      return editor.dom.is(table, 'table') && editor.getBody().contains(table);\n    };\n    var toolbar = getToolbar(editor);\n    if (toolbar.length > 0) {\n      editor.ui.registry.addContextToolbar('table', {\n        predicate: isTable,\n        items: toolbar,\n        scope: 'node',\n        position: 'node'\n      });\n    }\n  };\n  var addMenuItems = function addMenuItems(editor, selections, selectionTargets, clipboard) {\n    var cmd = function cmd(command) {\n      return function () {\n        return editor.execCommand(command);\n      };\n    };\n    var insertTableAction = function insertTableAction(data) {\n      editor.execCommand('mceInsertTable', false, {\n        rows: data.numRows,\n        columns: data.numColumns\n      });\n    };\n    var tableProperties = {\n      text: 'Table properties',\n      onSetup: selectionTargets.onSetupTable,\n      onAction: cmd('mceTableProps')\n    };\n    var deleteTable = {\n      text: 'Delete table',\n      icon: 'table-delete-table',\n      onSetup: selectionTargets.onSetupTable,\n      onAction: cmd('mceTableDelete')\n    };\n    editor.ui.registry.addMenuItem('tableinsertrowbefore', {\n      text: 'Insert row before',\n      icon: 'table-insert-row-above',\n      onAction: cmd('mceTableInsertRowBefore'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tableinsertrowafter', {\n      text: 'Insert row after',\n      icon: 'table-insert-row-after',\n      onAction: cmd('mceTableInsertRowAfter'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tabledeleterow', {\n      text: 'Delete row',\n      icon: 'table-delete-row',\n      onAction: cmd('mceTableDeleteRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablerowprops', {\n      text: 'Row properties',\n      icon: 'table-row-properties',\n      onAction: cmd('mceTableRowProps'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablecutrow', {\n      text: 'Cut row',\n      icon: 'cut-row',\n      onAction: cmd('mceTableCutRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablecopyrow', {\n      text: 'Copy row',\n      icon: 'duplicate-row',\n      onAction: cmd('mceTableCopyRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablepasterowbefore', {\n      text: 'Paste row before',\n      icon: 'paste-row-before',\n      onAction: cmd('mceTablePasteRowBefore'),\n      onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n    });\n    editor.ui.registry.addMenuItem('tablepasterowafter', {\n      text: 'Paste row after',\n      icon: 'paste-row-after',\n      onAction: cmd('mceTablePasteRowAfter'),\n      onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n    });\n    var row = {\n      type: 'nestedmenuitem',\n      text: 'Row',\n      getSubmenuItems: constant('tableinsertrowbefore tableinsertrowafter tabledeleterow tablerowprops | tablecutrow tablecopyrow tablepasterowbefore tablepasterowafter')\n    };\n    editor.ui.registry.addMenuItem('tableinsertcolumnbefore', {\n      text: 'Insert column before',\n      icon: 'table-insert-column-before',\n      onAction: cmd('mceTableInsertColBefore'),\n      onSetup: selectionTargets.onSetupColumn('onFirst')\n    });\n    editor.ui.registry.addMenuItem('tableinsertcolumnafter', {\n      text: 'Insert column after',\n      icon: 'table-insert-column-after',\n      onAction: cmd('mceTableInsertColAfter'),\n      onSetup: selectionTargets.onSetupColumn('onLast')\n    });\n    editor.ui.registry.addMenuItem('tabledeletecolumn', {\n      text: 'Delete column',\n      icon: 'table-delete-column',\n      onAction: cmd('mceTableDeleteCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addMenuItem('tablecutcolumn', {\n      text: 'Cut column',\n      icon: 'cut-column',\n      onAction: cmd('mceTableCutCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addMenuItem('tablecopycolumn', {\n      text: 'Copy column',\n      icon: 'duplicate-column',\n      onAction: cmd('mceTableCopyCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addMenuItem('tablepastecolumnbefore', {\n      text: 'Paste column before',\n      icon: 'paste-column-before',\n      onAction: cmd('mceTablePasteColBefore'),\n      onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onFirst')\n    });\n    editor.ui.registry.addMenuItem('tablepastecolumnafter', {\n      text: 'Paste column after',\n      icon: 'paste-column-after',\n      onAction: cmd('mceTablePasteColAfter'),\n      onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onLast')\n    });\n    var column = {\n      type: 'nestedmenuitem',\n      text: 'Column',\n      getSubmenuItems: constant('tableinsertcolumnbefore tableinsertcolumnafter tabledeletecolumn | tablecutcolumn tablecopycolumn tablepastecolumnbefore tablepastecolumnafter')\n    };\n    editor.ui.registry.addMenuItem('tablecellprops', {\n      text: 'Cell properties',\n      icon: 'table-cell-properties',\n      onAction: cmd('mceTableCellProps'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablemergecells', {\n      text: 'Merge cells',\n      icon: 'table-merge-cells',\n      onAction: cmd('mceTableMergeCells'),\n      onSetup: selectionTargets.onSetupMergeable\n    });\n    editor.ui.registry.addMenuItem('tablesplitcells', {\n      text: 'Split cell',\n      icon: 'table-split-cells',\n      onAction: cmd('mceTableSplitCells'),\n      onSetup: selectionTargets.onSetupUnmergeable\n    });\n    var cell = {\n      type: 'nestedmenuitem',\n      text: 'Cell',\n      getSubmenuItems: constant('tablecellprops tablemergecells tablesplitcells')\n    };\n    if (hasTableGrid(editor) === false) {\n      editor.ui.registry.addMenuItem('inserttable', {\n        text: 'Table',\n        icon: 'table',\n        onAction: cmd('mceInsertTable')\n      });\n    } else {\n      editor.ui.registry.addNestedMenuItem('inserttable', {\n        text: 'Table',\n        icon: 'table',\n        getSubmenuItems: function getSubmenuItems() {\n          return [{\n            type: 'fancymenuitem',\n            fancytype: 'inserttable',\n            onAction: insertTableAction\n          }];\n        }\n      });\n    }\n    editor.ui.registry.addMenuItem('inserttabledialog', {\n      text: 'Insert table',\n      icon: 'table',\n      onAction: cmd('mceInsertTable')\n    });\n    editor.ui.registry.addMenuItem('tableprops', tableProperties);\n    editor.ui.registry.addMenuItem('deletetable', deleteTable);\n    editor.ui.registry.addNestedMenuItem('row', row);\n    editor.ui.registry.addNestedMenuItem('column', column);\n    editor.ui.registry.addNestedMenuItem('cell', cell);\n    editor.ui.registry.addContextMenu('table', {\n      update: function update() {\n        selectionTargets.resetTargets();\n        return selectionTargets.targets().fold(constant(''), function (targets) {\n          if (name(targets.element) === 'caption') {\n            return 'tableprops deletetable';\n          } else {\n            return 'cell row column | advtablesort | tableprops deletetable';\n          }\n        });\n      }\n    });\n    var tableClassList = _filterNoneItem(getTableClassList(editor));\n    if (tableClassList.length !== 0) {\n      editor.ui.registry.addNestedMenuItem('tableclass', {\n        icon: 'table-classes',\n        text: 'Table styles',\n        getSubmenuItems: function getSubmenuItems() {\n          return _buildMenuItems(editor, selections, tableClassList, 'tableclass', function (value) {\n            return editor.execCommand('mceTableToggleClass', false, value);\n          });\n        },\n        onSetup: selectionTargets.onSetupTable\n      });\n    }\n    var tableCellClassList = _filterNoneItem(getCellClassList(editor));\n    if (tableCellClassList.length !== 0) {\n      editor.ui.registry.addNestedMenuItem('tablecellclass', {\n        icon: 'table-cell-classes',\n        text: 'Cell styles',\n        getSubmenuItems: function getSubmenuItems() {\n          return _buildMenuItems(editor, selections, tableCellClassList, 'tablecellclass', function (value) {\n            return editor.execCommand('mceTableCellToggleClass', false, value);\n          });\n        },\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n    }\n    editor.ui.registry.addNestedMenuItem('tablecellvalign', {\n      icon: 'vertical-align',\n      text: 'Vertical align',\n      getSubmenuItems: function getSubmenuItems() {\n        return _buildMenuItems(editor, selections, verticalAlignValues, 'tablecellverticalalign', applyTableCellStyle(editor, 'vertical-align'));\n      },\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addNestedMenuItem('tablecellborderwidth', {\n      icon: 'border-width',\n      text: 'Border width',\n      getSubmenuItems: function getSubmenuItems() {\n        return _buildMenuItems(editor, selections, getTableBorderWidths(editor), 'tablecellborderwidth', applyTableCellStyle(editor, 'border-width'));\n      },\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addNestedMenuItem('tablecellborderstyle', {\n      icon: 'border-style',\n      text: 'Border style',\n      getSubmenuItems: function getSubmenuItems() {\n        return _buildMenuItems(editor, selections, getTableBorderStyles(editor), 'tablecellborderstyle', applyTableCellStyle(editor, 'border-style'));\n      },\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addToggleMenuItem('tablecaption', {\n      icon: 'table-caption',\n      text: 'Table caption',\n      onAction: cmd('mceTableToggleCaption'),\n      onSetup: selectionTargets.onSetupTableWithCaption\n    });\n    editor.ui.registry.addNestedMenuItem('tablecellbackgroundcolor', {\n      icon: 'cell-background-color',\n      text: 'Background color',\n      getSubmenuItems: function getSubmenuItems() {\n        return buildColorMenu(editor, getTableBackgroundColorMap(editor), 'background-color');\n      },\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addNestedMenuItem('tablecellbordercolor', {\n      icon: 'cell-border-color',\n      text: 'Border color',\n      getSubmenuItems: function getSubmenuItems() {\n        return buildColorMenu(editor, getTableBorderColorMap(editor), 'border-color');\n      },\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addToggleMenuItem('tablerowheader', {\n      text: 'Row header',\n      icon: 'table-top-header',\n      onAction: changeRowHeader(editor),\n      onSetup: selectionTargets.onSetupTableRowHeaders\n    });\n    editor.ui.registry.addToggleMenuItem('tablecolheader', {\n      text: 'Column header',\n      icon: 'table-left-header',\n      onAction: changeColumnHeader(editor),\n      onSetup: selectionTargets.onSetupTableColumnHeaders\n    });\n  };\n  var Plugin = function Plugin(editor) {\n    var selections = Selections(function () {\n      return getBody(editor);\n    }, function () {\n      return getSelectionCell(getSelectionStart(editor), getIsRoot(editor));\n    }, ephemera.selectedSelector);\n    var selectionTargets = getSelectionTargets(editor, selections);\n    var resizeHandler = getResizeHandler(editor);\n    var cellSelection = CellSelection(editor, resizeHandler.lazyResize, selectionTargets);\n    var actions = TableActions(editor, cellSelection, resizeHandler.lazyWire);\n    var clipboard = Clipboard();\n    registerCommands(editor, actions, cellSelection, selections, clipboard);\n    registerQueryCommands(editor, actions, selections);\n    registerEvents(editor, selections, actions);\n    addMenuItems(editor, selections, selectionTargets, clipboard);\n    addButtons(editor, selections, selectionTargets, clipboard);\n    addToolbars(editor);\n    editor.on('PreInit', function () {\n      editor.serializer.addTempAttr(ephemera.firstSelected);\n      editor.serializer.addTempAttr(ephemera.lastSelected);\n      registerFormats(editor);\n    });\n    if (hasTabNavigation(editor)) {\n      editor.on('keydown', function (e) {\n        handle$1(e, editor, cellSelection);\n      });\n    }\n    editor.on('remove', function () {\n      resizeHandler.destroy();\n    });\n    return getApi(editor, clipboard, resizeHandler, selectionTargets);\n  };\n  function Plugin$1() {\n    global$3.add('table', Plugin);\n  }\n  Plugin$1();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/table/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/themes/silver/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/themes/silver/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"silver\" theme for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/themes/silver')\n//   ES2015:\n//     import 'tinymce/themes/silver'\n__webpack_require__(/*! ./theme.js */ \"./node_modules/tinymce/themes/silver/theme.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/themes/silver/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/themes/silver/theme.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/themes/silver/theme.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.9 (2023-11-15)\n */(function(){'use strict';var typeOf=function typeOf(x){var t=typeof x;if(x===null){return'null';}else if(t==='object'&&(Array.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='Array')){return'array';}else if(t==='object'&&(String.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='String')){return'string';}else{return t;}};var isType$1=function isType$1(type){return function(value){return typeOf(value)===type;};};var isSimpleType=function isSimpleType(type){return function(value){return typeof value===type;};};var eq$1=function eq$1(t){return function(a){return t===a;};};var isString=isType$1('string');var isObject=isType$1('object');var isArray=isType$1('array');var isNull=eq$1(null);var isBoolean=isSimpleType('boolean');var isUndefined=eq$1(undefined);var isNullable=function isNullable(a){return a===null||a===undefined;};var isNonNullable=function isNonNullable(a){return!isNullable(a);};var isFunction=isSimpleType('function');var isNumber=isSimpleType('number');var isArrayOf=function isArrayOf(value,pred){if(isArray(value)){for(var i=0,len=value.length;i<len;++i){if(!pred(value[i])){return false;}}return true;}return false;};var noop=function noop(){};var noarg=function noarg(f){return function(){return f();};};var compose=function compose(fa,fb){return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}return fa(fb.apply(null,args));};};var compose1=function compose1(fbc,fab){return function(a){return fbc(fab(a));};};var constant$1=function constant$1(value){return function(){return value;};};var identity$1=function identity$1(x){return x;};var tripleEquals=function tripleEquals(a,b){return a===b;};function curry(fn){var initialArgs=[];for(var _i=1;_i<arguments.length;_i++){initialArgs[_i-1]=arguments[_i];}return function(){var restArgs=[];for(var _i=0;_i<arguments.length;_i++){restArgs[_i]=arguments[_i];}var all=initialArgs.concat(restArgs);return fn.apply(null,all);};}var not=function not(f){return function(t){return!f(t);};};var die=function die(msg){return function(){throw new Error(msg);};};var never=constant$1(false);var always=constant$1(true);var global$g=tinymce.util.Tools.resolve('tinymce.ThemeManager');var _assign=function __assign(){_assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return _assign.apply(this,arguments);};function __rest(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==='function')for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]];}return t;}function __spreadArray(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i];}}return to.concat(ar||Array.prototype.slice.call(from));}var none=function none(){return NONE;};var NONE=function(){var call=function call(thunk){return thunk();};var id=identity$1;var me={fold:function fold(n,_s){return n();},isSome:never,isNone:always,getOr:id,getOrThunk:call,getOrDie:function getOrDie(msg){throw new Error(msg||'error: getOrDie called on none.');},getOrNull:constant$1(null),getOrUndefined:constant$1(undefined),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function filter(){return none();},toArray:function toArray(){return[];},toString:constant$1('none()')};return me;}();var _some=function some(a){var constant_a=constant$1(a);var self=function self(){return me;};var bind=function bind(f){return f(a);};var me={fold:function fold(n,s){return s(a);},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function map(f){return _some(f(a));},each:function each(f){f(a);},bind:bind,exists:bind,forall:bind,filter:function filter(f){return f(a)?me:NONE;},toArray:function toArray(){return[a];},toString:function toString(){return'some('+a+')';}};return me;};var from$1=function from$1(value){return value===null||value===undefined?NONE:_some(value);};var Optional={some:_some,none:none,from:from$1};var nativeSlice=Array.prototype.slice;var nativeIndexOf=Array.prototype.indexOf;var nativePush=Array.prototype.push;var rawIndexOf=function rawIndexOf(ts,t){return nativeIndexOf.call(ts,t);};var indexOf=function indexOf(xs,x){var r=rawIndexOf(xs,x);return r===-1?Optional.none():Optional.some(r);};var contains$2=function contains$2(xs,x){return rawIndexOf(xs,x)>-1;};var exists=function exists(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return true;}}return false;};var range$2=function range$2(num,f){var r=[];for(var i=0;i<num;i++){r.push(f(i));}return r;};var chunk$1=function chunk$1(array,size){var r=[];for(var i=0;i<array.length;i+=size){var s=nativeSlice.call(array,i,i+size);r.push(s);}return r;};var map$2=function map$2(xs,f){var len=xs.length;var r=new Array(len);for(var i=0;i<len;i++){var x=xs[i];r[i]=f(x,i);}return r;};var each$1=function each$1(xs,f){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];f(x,i);}};var eachr=function eachr(xs,f){for(var i=xs.length-1;i>=0;i--){var x=xs[i];f(x,i);}};var partition$3=function partition$3(xs,pred){var pass=[];var fail=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];var arr=pred(x,i)?pass:fail;arr.push(x);}return{pass:pass,fail:fail};};var filter$2=function filter$2(xs,pred){var r=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){r.push(x);}}return r;};var foldr=function foldr(xs,f,acc){eachr(xs,function(x,i){acc=f(acc,x,i);});return acc;};var foldl=function foldl(xs,f,acc){each$1(xs,function(x,i){acc=f(acc,x,i);});return acc;};var findUntil=function findUntil(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(x);}else if(until(x,i)){break;}}return Optional.none();};var find$5=function find$5(xs,pred){return findUntil(xs,pred,never);};var findIndex$1=function findIndex$1(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(i);}}return Optional.none();};var flatten=function flatten(xs){var r=[];for(var i=0,len=xs.length;i<len;++i){if(!isArray(xs[i])){throw new Error('Arr.flatten item '+i+' was not an array, input: '+xs);}nativePush.apply(r,xs[i]);}return r;};var bind$3=function bind$3(xs,f){return flatten(map$2(xs,f));};var forall=function forall(xs,pred){for(var i=0,len=xs.length;i<len;++i){var x=xs[i];if(pred(x,i)!==true){return false;}}return true;};var reverse=function reverse(xs){var r=nativeSlice.call(xs,0);r.reverse();return r;};var difference=function difference(a1,a2){return filter$2(a1,function(x){return!contains$2(a2,x);});};var mapToObject=function mapToObject(xs,f){var r={};for(var i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i);}return r;};var pure$2=function pure$2(x){return[x];};var sort=function sort(xs,comparator){var copy=nativeSlice.call(xs,0);copy.sort(comparator);return copy;};var get$f=function get$f(xs,i){return i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none();};var head=function head(xs){return get$f(xs,0);};var last$2=function last$2(xs){return get$f(xs,xs.length-1);};var from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x);};var findMap=function findMap(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome()){return r;}}return Optional.none();};var keys=Object.keys;var hasOwnProperty$1=Object.hasOwnProperty;var each=function each(obj,f){var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];f(x,i);}};var map$1=function map$1(obj,f){return tupleMap(obj,function(x,i){return{k:i,v:f(x,i)};});};var tupleMap=function tupleMap(obj,f){var r={};each(obj,function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v;});return r;};var objAcc=function objAcc(r){return function(x,i){r[i]=x;};};var internalFilter=function internalFilter(obj,pred,onTrue,onFalse){var r={};each(obj,function(x,i){(pred(x,i)?onTrue:onFalse)(x,i);});return r;};var filter$1=function filter$1(obj,pred){var t={};internalFilter(obj,pred,objAcc(t),noop);return t;};var mapToArray=function mapToArray(obj,f){var r=[];each(obj,function(value,name){r.push(f(value,name));});return r;};var find$4=function find$4(obj,pred){var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];if(pred(x,i,obj)){return Optional.some(x);}}return Optional.none();};var values=function values(obj){return mapToArray(obj,identity$1);};var get$e=function get$e(obj,key){return has$2(obj,key)?Optional.from(obj[key]):Optional.none();};var has$2=function has$2(obj,key){return hasOwnProperty$1.call(obj,key);};var hasNonNullableKey=function hasNonNullableKey(obj,key){return has$2(obj,key)&&obj[key]!==undefined&&obj[key]!==null;};var is$1=function is$1(lhs,rhs,comparator){if(comparator===void 0){comparator=tripleEquals;}return lhs.exists(function(left){return comparator(left,rhs);});};var equals=function equals(lhs,rhs,comparator){if(comparator===void 0){comparator=tripleEquals;}return lift2(lhs,rhs,comparator).getOr(lhs.isNone()&&rhs.isNone());};var cat=function cat(arr){var r=[];var push=function push(x){r.push(x);};for(var i=0;i<arr.length;i++){arr[i].each(push);}return r;};var sequence=function sequence(arr){var r=[];for(var i=0;i<arr.length;i++){var x=arr[i];if(x.isSome()){r.push(x.getOrDie());}else{return Optional.none();}}return Optional.some(r);};var lift2=function lift2(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none();};var lift3=function lift3(oa,ob,oc,f){return oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none();};var mapFrom=function mapFrom(a,f){return a!==undefined&&a!==null?Optional.some(f(a)):Optional.none();};var someIf=function someIf(b,a){return b?Optional.some(a):Optional.none();};var addToEnd=function addToEnd(str,suffix){return str+suffix;};var removeFromStart=function removeFromStart(str,numChars){return str.substring(numChars);};var checkRange=function checkRange(str,substr,start){return substr===''||str.length>=substr.length&&str.substr(start,start+substr.length)===substr;};var removeLeading=function removeLeading(str,prefix){return startsWith(str,prefix)?removeFromStart(str,prefix.length):str;};var ensureTrailing=function ensureTrailing(str,suffix){return endsWith(str,suffix)?str:addToEnd(str,suffix);};var contains$1=function contains$1(str,substr){return str.indexOf(substr)!==-1;};var startsWith=function startsWith(str,prefix){return checkRange(str,prefix,0);};var endsWith=function endsWith(str,suffix){return checkRange(str,suffix,str.length-suffix.length);};var blank=function blank(r){return function(s){return s.replace(r,'');};};var trim$1=blank(/^\\s+|\\s+$/g);var isNotEmpty=function isNotEmpty(s){return s.length>0;};var isEmpty=function isEmpty(s){return!isNotEmpty(s);};var isSupported$1=function isSupported$1(dom){return dom.style!==undefined&&isFunction(dom.style.getPropertyValue);};var fromHtml$2=function fromHtml$2(html,scope){var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;if(!div.hasChildNodes()||div.childNodes.length>1){console.error('HTML does not have a single root node',html);throw new Error('HTML must have a single root node');}return fromDom(div.childNodes[0]);};var fromTag=function fromTag(tag,scope){var doc=scope||document;var node=doc.createElement(tag);return fromDom(node);};var fromText=function fromText(text,scope){var doc=scope||document;var node=doc.createTextNode(text);return fromDom(node);};var fromDom=function fromDom(node){if(node===null||node===undefined){throw new Error('Node cannot be null or undefined');}return{dom:node};};var fromPoint=function fromPoint(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom);};var SugarElement={fromHtml:fromHtml$2,fromTag:fromTag,fromText:fromText,fromDom:fromDom,fromPoint:fromPoint};typeof window!=='undefined'?window:Function('return this;')();var DOCUMENT=9;var DOCUMENT_FRAGMENT=11;var ELEMENT=1;var TEXT=3;var name$2=function name$2(element){var r=element.dom.nodeName;return r.toLowerCase();};var type=function type(element){return element.dom.nodeType;};var isType=function isType(t){return function(element){return type(element)===t;};};var isElement$2=isType(ELEMENT);var isText$1=isType(TEXT);var isDocument=isType(DOCUMENT);var isDocumentFragment=isType(DOCUMENT_FRAGMENT);var cached=function cached(f){var called=false;var r;return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}if(!called){called=true;r=f.apply(null,args);}return r;};};var DeviceType=function DeviceType(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&/ipad/i.test(userAgent)===true;var isiPhone=os.isiOS()&&!isiPad;var isMobile=os.isiOS()||os.isAndroid();var isTouch=isMobile||mediaMatch('(pointer:coarse)');var isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch('(min-device-width:768px)');var isPhone=isiPhone||isMobile&&!isTablet;var iOSwebview=browser.isSafari()&&os.isiOS()&&/safari/i.test(userAgent)===false;var isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant$1(isiPad),isiPhone:constant$1(isiPhone),isTablet:constant$1(isTablet),isPhone:constant$1(isPhone),isTouch:constant$1(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant$1(iOSwebview),isDesktop:constant$1(isDesktop)};};var firstMatch=function firstMatch(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s)){return x;}}return undefined;};var find$3=function find$3(regexes,agent){var r=firstMatch(regexes,agent);if(!r){return{major:0,minor:0};}var group=function group(i){return Number(agent.replace(r,'$'+i));};return nu$d(group(1),group(2));};var detect$4=function detect$4(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();if(versionRegexes.length===0){return unknown$3();}return find$3(versionRegexes,cleanedAgent);};var unknown$3=function unknown$3(){return nu$d(0,0);};var nu$d=function nu$d(major,minor){return{major:major,minor:minor};};var Version={nu:nu$d,detect:detect$4,unknown:unknown$3};var detectBrowser$1=function detectBrowser$1(browsers,userAgentData){return findMap(userAgentData.brands,function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$5(browsers,function(browser){var _a;return lcBrand===((_a=browser.brand)===null||_a===void 0?void 0:_a.toLowerCase());}).map(function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)};});});};var detect$3=function detect$3(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$5(candidates,function(candidate){return candidate.search(agent);});};var detectBrowser=function detectBrowser(browsers,userAgent){return detect$3(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version};});};var detectOs=function detectOs(oses,userAgent){return detect$3(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version};});};var normalVersionRegex=/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;var checkContains=function checkContains(target){return function(uastring){return contains$1(uastring,target);};};var browsers=[{name:'Edge',versionRegexes:[/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],search:function search(uastring){return contains$1(uastring,'edge/')&&contains$1(uastring,'chrome')&&contains$1(uastring,'safari')&&contains$1(uastring,'applewebkit');}},{name:'Chrome',brand:'Chromium',versionRegexes:[/.*?chrome\\/([0-9]+)\\.([0-9]+).*/,normalVersionRegex],search:function search(uastring){return contains$1(uastring,'chrome')&&!contains$1(uastring,'chromeframe');}},{name:'IE',versionRegexes:[/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,/.*?rv:([0-9]+)\\.([0-9]+).*/],search:function search(uastring){return contains$1(uastring,'msie')||contains$1(uastring,'trident');}},{name:'Opera',versionRegexes:[normalVersionRegex,/.*?opera\\/([0-9]+)\\.([0-9]+).*/],search:checkContains('opera')},{name:'Firefox',versionRegexes:[/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],search:checkContains('firefox')},{name:'Safari',versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function search(uastring){return(contains$1(uastring,'safari')||contains$1(uastring,'mobile/'))&&contains$1(uastring,'applewebkit');}}];var oses=[{name:'Windows',search:checkContains('win'),versionRegexes:[/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]},{name:'iOS',search:function search(uastring){return contains$1(uastring,'iphone')||contains$1(uastring,'ipad');},versionRegexes:[/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:'Android',search:checkContains('android'),versionRegexes:[/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]},{name:'OSX',search:checkContains('mac os x'),versionRegexes:[/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]},{name:'Linux',search:checkContains('linux'),versionRegexes:[]},{name:'Solaris',search:checkContains('sunos'),versionRegexes:[]},{name:'FreeBSD',search:checkContains('freebsd'),versionRegexes:[]},{name:'ChromeOS',search:checkContains('cros'),versionRegexes:[/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]}];var PlatformInfo={browsers:constant$1(browsers),oses:constant$1(oses)};var edge='Edge';var chrome='Chrome';var ie='IE';var opera='Opera';var firefox='Firefox';var safari='Safari';var unknown$2=function unknown$2(){return nu$c({current:undefined,version:Version.unknown()});};var nu$c=function nu$c(info){var current=info.current;var version=info.version;var isBrowser=function isBrowser(name){return function(){return current===name;};};return{current:current,version:version,isEdge:isBrowser(edge),isChrome:isBrowser(chrome),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)};};var Browser={unknown:unknown$2,nu:nu$c,edge:constant$1(edge),chrome:constant$1(chrome),ie:constant$1(ie),opera:constant$1(opera),firefox:constant$1(firefox),safari:constant$1(safari)};var windows='Windows';var ios='iOS';var android='Android';var linux='Linux';var osx='OSX';var solaris='Solaris';var freebsd='FreeBSD';var chromeos='ChromeOS';var unknown$1=function unknown$1(){return nu$b({current:undefined,version:Version.unknown()});};var nu$b=function nu$b(info){var current=info.current;var version=info.version;var isOS=function isOS(name){return function(){return current===name;};};return{current:current,version:version,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isOSX:isOS(osx),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)};};var OperatingSystem={unknown:unknown$1,nu:nu$b,windows:constant$1(windows),ios:constant$1(ios),android:constant$1(android),linux:constant$1(linux),osx:constant$1(osx),solaris:constant$1(solaris),freebsd:constant$1(freebsd),chromeos:constant$1(chromeos)};var detect$2=function detect$2(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers();var oses=PlatformInfo.oses();var browser=userAgentDataOpt.bind(function(userAgentData){return detectBrowser$1(browsers,userAgentData);}).orThunk(function(){return detectBrowser(browsers,userAgent);}).fold(Browser.unknown,Browser.nu);var os=detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu);var deviceType=DeviceType(os,browser,userAgent,mediaMatch);return{browser:browser,os:os,deviceType:deviceType};};var PlatformDetection={detect:detect$2};var mediaMatch=function mediaMatch(query){return window.matchMedia(query).matches;};var platform=cached(function(){return PlatformDetection.detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch);});var detect$1=function detect$1(){return platform();};var compareDocumentPosition=function compareDocumentPosition(a,b,match){return(a.compareDocumentPosition(b)&match)!==0;};var documentPositionContainedBy=function documentPositionContainedBy(a,b){return compareDocumentPosition(a,b,Node.DOCUMENT_POSITION_CONTAINED_BY);};var is=function is(element,selector){var dom=element.dom;if(dom.nodeType!==ELEMENT){return false;}else{var elem=dom;if(elem.matches!==undefined){return elem.matches(selector);}else if(elem.msMatchesSelector!==undefined){return elem.msMatchesSelector(selector);}else if(elem.webkitMatchesSelector!==undefined){return elem.webkitMatchesSelector(selector);}else if(elem.mozMatchesSelector!==undefined){return elem.mozMatchesSelector(selector);}else{throw new Error('Browser lacks native selectors');}}};var bypassSelector=function bypassSelector(dom){return dom.nodeType!==ELEMENT&&dom.nodeType!==DOCUMENT&&dom.nodeType!==DOCUMENT_FRAGMENT||dom.childElementCount===0;};var all$3=function all$3(selector,scope){var base=scope===undefined?document:scope.dom;return bypassSelector(base)?[]:map$2(base.querySelectorAll(selector),SugarElement.fromDom);};var one=function one(selector,scope){var base=scope===undefined?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);};var eq=function eq(e1,e2){return e1.dom===e2.dom;};var regularContains=function regularContains(e1,e2){var d1=e1.dom;var d2=e2.dom;return d1===d2?false:d1.contains(d2);};var ieContains=function ieContains(e1,e2){return documentPositionContainedBy(e1.dom,e2.dom);};var contains=function contains(e1,e2){return detect$1().browser.isIE()?ieContains(e1,e2):regularContains(e1,e2);};var owner$4=function owner$4(element){return SugarElement.fromDom(element.dom.ownerDocument);};var documentOrOwner=function documentOrOwner(dos){return isDocument(dos)?dos:owner$4(dos);};var documentElement=function documentElement(element){return SugarElement.fromDom(documentOrOwner(element).dom.documentElement);};var defaultView=function defaultView(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);};var parent=function parent(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);};var parentNode=function parentNode(element){return parent(element);};var offsetParent=function offsetParent(element){return Optional.from(element.dom.offsetParent).map(SugarElement.fromDom);};var nextSibling=function nextSibling(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);};var children=function children(element){return map$2(element.dom.childNodes,SugarElement.fromDom);};var child$2=function child$2(element,index){var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom);};var firstChild=function firstChild(element){return child$2(element,0);};var spot=function spot(element,offset){return{element:element,offset:offset};};var leaf=function leaf(element,offset){var cs=children(element);return cs.length>0&&offset<cs.length?spot(cs[offset],0):spot(element,offset);};var isShadowRoot=function isShadowRoot(dos){return isDocumentFragment(dos)&&isNonNullable(dos.dom.host);};var supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode);var isSupported=constant$1(supported);var getRootNode=supported?function(e){return SugarElement.fromDom(e.dom.getRootNode());}:documentOrOwner;var getContentContainer=function getContentContainer(dos){return isShadowRoot(dos)?dos:SugarElement.fromDom(documentOrOwner(dos).dom.body);};var isInShadowRoot=function isInShadowRoot(e){return getShadowRoot(e).isSome();};var getShadowRoot=function getShadowRoot(e){var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none();};var getShadowHost=function getShadowHost(e){return SugarElement.fromDom(e.dom.host);};var getOriginalEventTarget=function getOriginalEventTarget(event){if(isSupported()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$2(el)&&isOpenShadowHost(el)){if(event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath){return head(composedPath);}}}}return Optional.from(event.target);};var isOpenShadowHost=function isOpenShadowHost(element){return isNonNullable(element.dom.shadowRoot);};var _inBody=function inBody(element){var dom=isText$1(element)?element.dom.parentNode:element.dom;if(dom===undefined||dom===null||dom.ownerDocument===null){return false;}var doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold(function(){return doc.body.contains(dom);},compose1(_inBody,getShadowHost));};var body=function body(){return getBody(SugarElement.fromDom(document));};var getBody=function getBody(doc){var b=doc.dom.body;if(b===null||b===undefined){throw new Error('Body is not available yet');}return SugarElement.fromDom(b);};var rawSet=function rawSet(dom,key,value){if(isString(value)||isBoolean(value)||isNumber(value)){dom.setAttribute(key,value+'');}else{console.error('Invalid call to Attribute.set. Key ',key,':: Value ',value,':: Element ',dom);throw new Error('Attribute value was not simple');}};var set$8=function set$8(element,key,value){rawSet(element.dom,key,value);};var setAll$1=function setAll$1(element,attrs){var dom=element.dom;each(attrs,function(v,k){rawSet(dom,k,v);});};var get$d=function get$d(element,key){var v=element.dom.getAttribute(key);return v===null?undefined:v;};var getOpt=function getOpt(element,key){return Optional.from(get$d(element,key));};var has$1=function has$1(element,key){var dom=element.dom;return dom&&dom.hasAttribute?dom.hasAttribute(key):false;};var remove$7=function remove$7(element,key){element.dom.removeAttribute(key);};var internalSet=function internalSet(dom,property,value){if(!isString(value)){console.error('Invalid call to CSS.set. Property ',property,':: Value ',value,':: Element ',dom);throw new Error('CSS value must be a string: '+value);}if(isSupported$1(dom)){dom.style.setProperty(property,value);}};var internalRemove=function internalRemove(dom,property){if(isSupported$1(dom)){dom.style.removeProperty(property);}};var set$7=function set$7(element,property,value){var dom=element.dom;internalSet(dom,property,value);};var setAll=function setAll(element,css){var dom=element.dom;each(css,function(v,k){internalSet(dom,k,v);});};var setOptions=function setOptions(element,css){var dom=element.dom;each(css,function(v,k){v.fold(function(){internalRemove(dom,k);},function(value){internalSet(dom,k,value);});});};var get$c=function get$c(element,property){var dom=element.dom;var styles=window.getComputedStyle(dom);var r=styles.getPropertyValue(property);return r===''&&!_inBody(element)?getUnsafeProperty(dom,property):r;};var getUnsafeProperty=function getUnsafeProperty(dom,property){return isSupported$1(dom)?dom.style.getPropertyValue(property):'';};var getRaw=function getRaw(element,property){var dom=element.dom;var raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter(function(r){return r.length>0;});};var getAllRaw=function getAllRaw(element){var css={};var dom=element.dom;if(isSupported$1(dom)){for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName];}}return css;};var isValidValue=function isValidValue(tag,property,value){var element=SugarElement.fromTag(tag);set$7(element,property,value);var style=getRaw(element,property);return style.isSome();};var remove$6=function remove$6(element,property){var dom=element.dom;internalRemove(dom,property);if(is$1(getOpt(element,'style').map(trim$1),'')){remove$7(element,'style');}};var reflow=function reflow(e){return e.dom.offsetWidth;};var Dimension=function Dimension(name,getOffset){var set=function set(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/)){throw new Error(name+'.set accepts only positive integer values. Value was '+h);}var dom=element.dom;if(isSupported$1(dom)){dom.style[name]=h+'px';}};var get=function get(element){var r=getOffset(element);if(r<=0||r===null){var css=get$c(element,name);return parseFloat(css)||0;}return r;};var getOuter=get;var aggregate=function aggregate(element,properties){return foldl(properties,function(acc,property){var val=get$c(element,property);var value=val===undefined?0:parseInt(val,10);return isNaN(value)?acc:acc+value;},0);};var max=function max(element,value,properties){var cumulativeInclusions=aggregate(element,properties);var absoluteMax=value>cumulativeInclusions?value-cumulativeInclusions:0;return absoluteMax;};return{set:set,get:get,getOuter:getOuter,aggregate:aggregate,max:max};};var api$3=Dimension('height',function(element){var dom=element.dom;return _inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight;});var get$b=function get$b(element){return api$3.get(element);};var getOuter$2=function getOuter$2(element){return api$3.getOuter(element);};var setMax$1=function setMax$1(element,value){var inclusions=['margin-top','border-top-width','padding-top','padding-bottom','border-bottom-width','margin-bottom'];var absMax=api$3.max(element,value,inclusions);set$7(element,'max-height',absMax+'px');};var _r$=function r$1(left,top){var translate=function translate(x,y){return _r$(left+x,top+y);};return{left:left,top:top,translate:translate};};var SugarPosition=_r$;var boxPosition=function boxPosition(dom){var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top);};var firstDefinedOrZero=function firstDefinedOrZero(a,b){if(a!==undefined){return a;}else{return b!==undefined?b:0;}};var absolute$3=function absolute$3(element){var doc=element.dom.ownerDocument;var body=doc.body;var win=doc.defaultView;var html=doc.documentElement;if(body===element.dom){return SugarPosition(body.offsetLeft,body.offsetTop);}var scrollTop=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageYOffset,html.scrollTop);var scrollLeft=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageXOffset,html.scrollLeft);var clientTop=firstDefinedOrZero(html.clientTop,body.clientTop);var clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport$1(element).translate(scrollLeft-clientLeft,scrollTop-clientTop);};var viewport$1=function viewport$1(element){var dom=element.dom;var doc=dom.ownerDocument;var body=doc.body;if(body===dom){return SugarPosition(body.offsetLeft,body.offsetTop);}if(!_inBody(element)){return SugarPosition(0,0);}return boxPosition(dom);};var api$2=Dimension('width',function(element){return element.dom.offsetWidth;});var set$6=function set$6(element,h){return api$2.set(element,h);};var get$a=function get$a(element){return api$2.get(element);};var getOuter$1=function getOuter$1(element){return api$2.getOuter(element);};var setMax=function setMax(element,value){var inclusions=['margin-left','border-left-width','padding-left','padding-right','border-right-width','margin-right'];var absMax=api$2.max(element,value,inclusions);set$7(element,'max-width',absMax+'px');};var mkEvent=function mkEvent(target,x,y,stop,prevent,kill,raw){return{target:target,x:x,y:y,stop:stop,prevent:prevent,kill:kill,raw:raw};};var fromRawEvent$1=function fromRawEvent$1(rawEvent){var target=SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));var stop=function stop(){return rawEvent.stopPropagation();};var prevent=function prevent(){return rawEvent.preventDefault();};var kill=compose(prevent,stop);return mkEvent(target,rawEvent.clientX,rawEvent.clientY,stop,prevent,kill,rawEvent);};var handle=function handle(filter,handler){return function(rawEvent){if(filter(rawEvent)){handler(fromRawEvent$1(rawEvent));}};};var binder=function binder(element,event,filter,handler,useCapture){var wrapped=handle(filter,handler);element.dom.addEventListener(event,wrapped,useCapture);return{unbind:curry(unbind,element,event,wrapped,useCapture)};};var bind$2=function bind$2(element,event,filter,handler){return binder(element,event,filter,handler,false);};var capture$1=function capture$1(element,event,filter,handler){return binder(element,event,filter,handler,true);};var unbind=function unbind(element,event,handler,useCapture){element.dom.removeEventListener(event,handler,useCapture);};var before$2=function before$2(marker,element){var parent$1=parent(marker);parent$1.each(function(v){v.dom.insertBefore(element.dom,marker.dom);});};var after$2=function after$2(marker,element){var sibling=nextSibling(marker);sibling.fold(function(){var parent$1=parent(marker);parent$1.each(function(v){append$2(v,element);});},function(v){before$2(v,element);});};var prepend$1=function prepend$1(parent,element){var firstChild$1=firstChild(parent);firstChild$1.fold(function(){append$2(parent,element);},function(v){parent.dom.insertBefore(element.dom,v.dom);});};var append$2=function append$2(parent,element){parent.dom.appendChild(element.dom);};var appendAt=function appendAt(parent,element,index){child$2(parent,index).fold(function(){append$2(parent,element);},function(v){before$2(v,element);});};var before$1=function before$1(marker,elements){each$1(elements,function(x){before$2(marker,x);});};var append$1=function append$1(parent,elements){each$1(elements,function(x){append$2(parent,x);});};var empty=function empty(element){element.dom.textContent='';each$1(children(element),function(rogue){remove$5(rogue);});};var remove$5=function remove$5(element){var dom=element.dom;if(dom.parentNode!==null){dom.parentNode.removeChild(dom);}};var unwrap=function unwrap(wrapper){var children$1=children(wrapper);if(children$1.length>0){before$1(wrapper,children$1);}remove$5(wrapper);};var get$9=function get$9(_DOC){var doc=_DOC!==undefined?_DOC.dom:document;var x=doc.body.scrollLeft||doc.documentElement.scrollLeft;var y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y);};var to=function to(x,y,_DOC){var doc=_DOC!==undefined?_DOC.dom:document;var win=doc.defaultView;if(win){win.scrollTo(x,y);}};var get$8=function get$8(_win){var win=_win===undefined?window:_win;if(detect$1().browser.isFirefox()){return Optional.none();}else{return Optional.from(win['visualViewport']);}};var bounds$1=function bounds$1(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height};};var getBounds$3=function getBounds$3(_win){var win=_win===undefined?window:_win;var doc=win.document;var scroll=get$9(SugarElement.fromDom(doc));return get$8(win).fold(function(){var html=win.document.documentElement;var width=html.clientWidth;var height=html.clientHeight;return bounds$1(scroll.left,scroll.top,width,height);},function(visualViewport){return bounds$1(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height);});};var _walkUp=function walkUp(navigation,doc){var frame=navigation.view(doc);return frame.fold(constant$1([]),function(f){var parent=navigation.owner(f);var rest=_walkUp(navigation,parent);return[f].concat(rest);});};var pathTo=function pathTo(element,navigation){var d=navigation.owner(element);var paths=_walkUp(navigation,d);return Optional.some(paths);};var view=function view(doc){var _a;var element=doc.dom===document?Optional.none():Optional.from((_a=doc.dom.defaultView)===null||_a===void 0?void 0:_a.frameElement);return element.map(SugarElement.fromDom);};var owner$3=function owner$3(element){return owner$4(element);};var Navigation=/*#__PURE__*/Object.freeze({__proto__:null,view:view,owner:owner$3});var find$2=function find$2(element){var doc=SugarElement.fromDom(document);var scroll=get$9(doc);var path=pathTo(element,Navigation);return path.fold(curry(absolute$3,element),function(frames){var offset=viewport$1(element);var r=foldr(frames,function(b,a){var loc=viewport$1(a);return{left:b.left+loc.left,top:b.top+loc.top};},{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top);});};var pointed=function pointed(point,width,height){return{point:point,width:width,height:height};};var rect=function rect(x,y,width,height){return{x:x,y:y,width:width,height:height};};var bounds=function bounds(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height};};var box$1=function box$1(element){var xy=absolute$3(element);var w=getOuter$1(element);var h=getOuter$2(element);return bounds(xy.left,xy.top,w,h);};var absolute$2=function absolute$2(element){var position=find$2(element);var width=getOuter$1(element);var height=getOuter$2(element);return bounds(position.left,position.top,width,height);};var win=function win(){return getBounds$3(window);};var _value$=function value$3(o){var or=function or(_opt){return _value$(o);};var orThunk=function orThunk(_f){return _value$(o);};var map=function map(f){return _value$(f(o));};var mapError=function mapError(_f){return _value$(o);};var each=function each(f){f(o);};var bind=function bind(f){return f(o);};var fold=function fold(_,onValue){return onValue(o);};var exists=function exists(f){return f(o);};var forall=function forall(f){return f(o);};var toOptional=function toOptional(){return Optional.some(o);};return{isValue:always,isError:never,getOr:constant$1(o),getOrThunk:constant$1(o),getOrDie:constant$1(o),or:or,orThunk:orThunk,fold:fold,map:map,mapError:mapError,each:each,bind:bind,exists:exists,forall:forall,toOptional:toOptional};};var _error$=function error$1(message){var getOrThunk=function getOrThunk(f){return f();};var getOrDie=function getOrDie(){return die(String(message))();};var or=identity$1;var orThunk=function orThunk(f){return f();};var map=function map(_f){return _error$(message);};var mapError=function mapError(f){return _error$(f(message));};var bind=function bind(_f){return _error$(message);};var fold=function fold(onError,_){return onError(message);};return{isValue:never,isError:always,getOr:identity$1,getOrThunk:getOrThunk,getOrDie:getOrDie,or:or,orThunk:orThunk,fold:fold,map:map,mapError:mapError,each:noop,bind:bind,exists:never,forall:always,toOptional:Optional.none};};var fromOption=function fromOption(opt,err){return opt.fold(function(){return _error$(err);},_value$);};var Result={value:_value$,error:_error$,fromOption:fromOption};var SimpleResultType;(function(SimpleResultType){SimpleResultType[SimpleResultType['Error']=0]='Error';SimpleResultType[SimpleResultType['Value']=1]='Value';})(SimpleResultType||(SimpleResultType={}));var fold$1=function fold$1(res,onError,onValue){return res.stype===SimpleResultType.Error?onError(res.serror):onValue(res.svalue);};var partition$2=function partition$2(results){var values=[];var errors=[];each$1(results,function(obj){fold$1(obj,function(err){return errors.push(err);},function(val){return values.push(val);});});return{values:values,errors:errors};};var mapError=function mapError(res,f){if(res.stype===SimpleResultType.Error){return{stype:SimpleResultType.Error,serror:f(res.serror)};}else{return res;}};var map=function map(res,f){if(res.stype===SimpleResultType.Value){return{stype:SimpleResultType.Value,svalue:f(res.svalue)};}else{return res;}};var bind$1=function bind$1(res,f){if(res.stype===SimpleResultType.Value){return f(res.svalue);}else{return res;}};var bindError=function bindError(res,f){if(res.stype===SimpleResultType.Error){return f(res.serror);}else{return res;}};var svalue=function svalue(v){return{stype:SimpleResultType.Value,svalue:v};};var serror=function serror(e){return{stype:SimpleResultType.Error,serror:e};};var toResult$1=function toResult$1(res){return fold$1(res,Result.error,Result.value);};var fromResult$1=function fromResult$1(res){return res.fold(serror,svalue);};var SimpleResult={fromResult:fromResult$1,toResult:toResult$1,svalue:svalue,partition:partition$2,serror:serror,bind:bind$1,bindError:bindError,map:map,mapError:mapError,fold:fold$1};var field$2=function field$2(key,newKey,presence,prop){return{tag:'field',key:key,newKey:newKey,presence:presence,prop:prop};};var customField$1=function customField$1(newKey,instantiator){return{tag:'custom',newKey:newKey,instantiator:instantiator};};var fold=function fold(value,ifField,ifCustom){switch(value.tag){case'field':return ifField(value.key,value.newKey,value.presence,value.prop);case'custom':return ifCustom(value.newKey,value.instantiator);}};var shallow$1=function shallow$1(old,nu){return nu;};var deep=function deep(old,nu){var bothObjects=isObject(old)&&isObject(nu);return bothObjects?deepMerge(old,nu):nu;};var baseMerge=function baseMerge(merger){return function(){var objects=[];for(var _i=0;_i<arguments.length;_i++){objects[_i]=arguments[_i];}if(objects.length===0){throw new Error('Can\\'t merge zero objects');}var ret={};for(var j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject){if(has$2(curObject,key)){ret[key]=merger(ret[key],curObject[key]);}}}return ret;};};var deepMerge=baseMerge(deep);var merge$1=baseMerge(shallow$1);var required$2=function required$2(){return{tag:'required',process:{}};};var defaultedThunk=function defaultedThunk(fallbackThunk){return{tag:'defaultedThunk',process:fallbackThunk};};var defaulted$1=function defaulted$1(fallback){return defaultedThunk(constant$1(fallback));};var asOption=function asOption(){return{tag:'option',process:{}};};var mergeWithThunk=function mergeWithThunk(baseThunk){return{tag:'mergeWithThunk',process:baseThunk};};var mergeWith=function mergeWith(base){return mergeWithThunk(constant$1(base));};var mergeValues$1=function mergeValues$1(values,base){return values.length>0?SimpleResult.svalue(deepMerge(base,merge$1.apply(undefined,values))):SimpleResult.svalue(base);};var mergeErrors$1=function mergeErrors$1(errors){return compose(SimpleResult.serror,flatten)(errors);};var consolidateObj=function consolidateObj(objects,base){var partition=SimpleResult.partition(objects);return partition.errors.length>0?mergeErrors$1(partition.errors):mergeValues$1(partition.values,base);};var consolidateArr=function consolidateArr(objects){var partitions=SimpleResult.partition(objects);return partitions.errors.length>0?mergeErrors$1(partitions.errors):SimpleResult.svalue(partitions.values);};var ResultCombine={consolidateObj:consolidateObj,consolidateArr:consolidateArr};var formatObj=function formatObj(input){return isObject(input)&&keys(input).length>100?' removed due to size':JSON.stringify(input,null,2);};var formatErrors=function formatErrors(errors){var es=errors.length>10?errors.slice(0,10).concat([{path:[],getErrorInfo:constant$1('... (only showing first ten failures)')}]):errors;return map$2(es,function(e){return'Failed path: ('+e.path.join(' > ')+')\\n'+e.getErrorInfo();});};var nu$a=function nu$a(path,getErrorInfo){return SimpleResult.serror([{path:path,getErrorInfo:getErrorInfo}]);};var missingRequired=function missingRequired(path,key,obj){return nu$a(path,function(){return'Could not find valid *required* value for \"'+key+'\" in '+formatObj(obj);});};var missingKey=function missingKey(path,key){return nu$a(path,function(){return'Choice schema did not contain choice key: \"'+key+'\"';});};var missingBranch=function missingBranch(path,branches,branch){return nu$a(path,function(){return'The chosen schema: \"'+branch+'\" did not exist in branches: '+formatObj(branches);});};var unsupportedFields=function unsupportedFields(path,unsupported){return nu$a(path,function(){return'There are unsupported fields: ['+unsupported.join(', ')+'] specified';});};var custom=function custom(path,err){return nu$a(path,constant$1(err));};var value$2=function value$2(validator){var extract=function extract(path,val){return SimpleResult.bindError(validator(val),function(err){return custom(path,err);});};var toString=constant$1('val');return{extract:extract,toString:toString};};var anyValue$1=value$2(SimpleResult.svalue);var requiredAccess=function requiredAccess(path,obj,key,bundle){return get$e(obj,key).fold(function(){return missingRequired(path,key,obj);},bundle);};var fallbackAccess=function fallbackAccess(obj,key,fallback,bundle){var v=get$e(obj,key).getOrThunk(function(){return fallback(obj);});return bundle(v);};var optionAccess=function optionAccess(obj,key,bundle){return bundle(get$e(obj,key));};var optionDefaultedAccess=function optionDefaultedAccess(obj,key,fallback,bundle){var opt=get$e(obj,key).map(function(val){return val===true?fallback(obj):val;});return bundle(opt);};var extractField=function extractField(field,path,obj,key,prop){var bundle=function bundle(av){return prop.extract(path.concat([key]),av);};var bundleAsOption=function bundleAsOption(optValue){return optValue.fold(function(){return SimpleResult.svalue(Optional.none());},function(ov){var result=prop.extract(path.concat([key]),ov);return SimpleResult.map(result,Optional.some);});};switch(field.tag){case'required':return requiredAccess(path,obj,key,bundle);case'defaultedThunk':return fallbackAccess(obj,key,field.process,bundle);case'option':return optionAccess(obj,key,bundleAsOption);case'defaultedOptionThunk':return optionDefaultedAccess(obj,key,field.process,bundleAsOption);case'mergeWithThunk':{return fallbackAccess(obj,key,constant$1({}),function(v){var result=deepMerge(field.process(obj),v);return bundle(result);});}}};var extractFields=function extractFields(path,obj,fields){var success={};var errors=[];for(var _i=0,fields_1=fields;_i<fields_1.length;_i++){var field=fields_1[_i];fold(field,function(key,newKey,presence,prop){var result=extractField(presence,path,obj,key,prop);SimpleResult.fold(result,function(err){errors.push.apply(errors,err);},function(res){success[newKey]=res;});},function(newKey,instantiator){success[newKey]=instantiator(obj);});}return errors.length>0?SimpleResult.serror(errors):SimpleResult.svalue(success);};var valueThunk=function valueThunk(getDelegate){var extract=function extract(path,val){return getDelegate().extract(path,val);};var toString=function toString(){return getDelegate().toString();};return{extract:extract,toString:toString};};var getSetKeys=function getSetKeys(obj){return keys(filter$1(obj,isNonNullable));};var objOfOnly=function objOfOnly(fields){var delegate=objOf(fields);var fieldNames=foldr(fields,function(acc,value){return fold(value,function(key){var _a;return deepMerge(acc,(_a={},_a[key]=true,_a));},constant$1(acc));},{});var extract=function extract(path,o){var keys=isBoolean(o)?[]:getSetKeys(o);var extra=filter$2(keys,function(k){return!hasNonNullableKey(fieldNames,k);});return extra.length===0?delegate.extract(path,o):unsupportedFields(path,extra);};return{extract:extract,toString:delegate.toString};};var objOf=function objOf(values){var extract=function extract(path,o){return extractFields(path,o,values);};var toString=function toString(){var fieldStrings=map$2(values,function(value){return fold(value,function(key,_okey,_presence,prop){return key+' -> '+prop.toString();},function(newKey,_instantiator){return'state('+newKey+')';});});return'obj{\\n'+fieldStrings.join('\\n')+'}';};return{extract:extract,toString:toString};};var arrOf=function arrOf(prop){var extract=function extract(path,array){var results=map$2(array,function(a,i){return prop.extract(path.concat(['['+i+']']),a);});return ResultCombine.consolidateArr(results);};var toString=function toString(){return'array('+prop.toString()+')';};return{extract:extract,toString:toString};};var oneOf=function oneOf(props){var extract=function extract(path,val){var errors=[];for(var _i=0,props_1=props;_i<props_1.length;_i++){var prop=props_1[_i];var res=prop.extract(path,val);if(res.stype===SimpleResultType.Value){return res;}errors.push(res);}return ResultCombine.consolidateArr(errors);};var toString=function toString(){return'oneOf('+map$2(props,function(prop){return prop.toString();}).join(', ')+')';};return{extract:extract,toString:toString};};var setOf$1=function setOf$1(validator,prop){var validateKeys=function validateKeys(path,keys){return arrOf(value$2(validator)).extract(path,keys);};var extract=function extract(path,o){var keys$1=keys(o);var validatedKeys=validateKeys(path,keys$1);return SimpleResult.bind(validatedKeys,function(validKeys){var schema=map$2(validKeys,function(vk){return field$2(vk,vk,required$2(),prop);});return objOf(schema).extract(path,o);});};var toString=function toString(){return'setOf('+prop.toString()+')';};return{extract:extract,toString:toString};};var thunk=function thunk(_desc,processor){var getP=cached(processor);var extract=function extract(path,val){return getP().extract(path,val);};var toString=function toString(){return getP().toString();};return{extract:extract,toString:toString};};var arrOfObj=compose(arrOf,objOf);var anyValue=constant$1(anyValue$1);var typedValue=function typedValue(validator,expectedType){return value$2(function(a){var actualType=typeof a;return validator(a)?SimpleResult.svalue(a):SimpleResult.serror('Expected type: '+expectedType+' but got: '+actualType);});};var number=typedValue(isNumber,'number');var string=typedValue(isString,'string');var boolean=typedValue(isBoolean,'boolean');var functionProcessor=typedValue(isFunction,'function');var _isPostMessageable=function isPostMessageable(val){if(Object(val)!==val){return true;}switch({}.toString.call(val).slice(8,-1)){case'Boolean':case'Number':case'String':case'Date':case'RegExp':case'Blob':case'FileList':case'ImageData':case'ImageBitmap':case'ArrayBuffer':return true;case'Array':case'Object':return Object.keys(val).every(function(prop){return _isPostMessageable(val[prop]);});default:return false;}};var postMessageable=value$2(function(a){if(_isPostMessageable(a)){return SimpleResult.svalue(a);}else{return SimpleResult.serror('Expected value to be acceptable for sending via postMessage');}});var chooseFrom=function chooseFrom(path,input,branches,ch){var fields=get$e(branches,ch);return fields.fold(function(){return missingBranch(path,branches,ch);},function(vp){return vp.extract(path.concat(['branch: '+ch]),input);});};var choose$2=function choose$2(key,branches){var extract=function extract(path,input){var choice=get$e(input,key);return choice.fold(function(){return missingKey(path,key);},function(chosen){return chooseFrom(path,input,branches,chosen);});};var toString=function toString(){return'chooseOn('+key+'). Possible values: '+keys(branches);};return{extract:extract,toString:toString};};var arrOfVal=function arrOfVal(){return arrOf(anyValue$1);};var valueOf=function valueOf(validator){return value$2(function(v){return validator(v).fold(SimpleResult.serror,SimpleResult.svalue);});};var setOf=function setOf(validator,prop){return setOf$1(function(v){return SimpleResult.fromResult(validator(v));},prop);};var extractValue=function extractValue(label,prop,obj){var res=prop.extract([label],obj);return SimpleResult.mapError(res,function(errs){return{input:obj,errors:errs};});};var asRaw=function asRaw(label,prop,obj){return SimpleResult.toResult(extractValue(label,prop,obj));};var getOrDie=function getOrDie(extraction){return extraction.fold(function(errInfo){throw new Error(formatError(errInfo));},identity$1);};var asRawOrDie$1=function asRawOrDie$1(label,prop,obj){return getOrDie(asRaw(label,prop,obj));};var formatError=function formatError(errInfo){return'Errors: \\n'+formatErrors(errInfo.errors).join('\\n')+'\\n\\nInput object: '+formatObj(errInfo.input);};var choose$1=function choose$1(key,branches){return choose$2(key,map$1(branches,objOf));};var thunkOf=function thunkOf(desc,schema){return thunk(desc,schema);};var field$1=field$2;var customField=customField$1;var validateEnum=function validateEnum(values){return valueOf(function(value){return contains$2(values,value)?Result.value(value):Result.error('Unsupported value: \"'+value+'\", choose one of \"'+values.join(', ')+'\".');});};var required$1=function required$1(key){return field$1(key,key,required$2(),anyValue());};var requiredOf=function requiredOf(key,schema){return field$1(key,key,required$2(),schema);};var requiredNumber=function requiredNumber(key){return requiredOf(key,number);};var requiredString=function requiredString(key){return requiredOf(key,string);};var requiredStringEnum=function requiredStringEnum(key,values){return field$1(key,key,required$2(),validateEnum(values));};var requiredBoolean=function requiredBoolean(key){return requiredOf(key,boolean);};var requiredFunction=function requiredFunction(key){return requiredOf(key,functionProcessor);};var forbid=function forbid(key,message){return field$1(key,key,asOption(),value$2(function(_v){return SimpleResult.serror('The field: '+key+' is forbidden. '+message);}));};var requiredObjOf=function requiredObjOf(key,objSchema){return field$1(key,key,required$2(),objOf(objSchema));};var requiredArrayOfObj=function requiredArrayOfObj(key,objFields){return field$1(key,key,required$2(),arrOfObj(objFields));};var requiredArrayOf=function requiredArrayOf(key,schema){return field$1(key,key,required$2(),arrOf(schema));};var option=function option(key){return field$1(key,key,asOption(),anyValue());};var optionOf=function optionOf(key,schema){return field$1(key,key,asOption(),schema);};var optionNumber=function optionNumber(key){return optionOf(key,number);};var optionString=function optionString(key){return optionOf(key,string);};var optionFunction=function optionFunction(key){return optionOf(key,functionProcessor);};var optionArrayOf=function optionArrayOf(key,schema){return optionOf(key,arrOf(schema));};var optionObjOf=function optionObjOf(key,objSchema){return optionOf(key,objOf(objSchema));};var optionObjOfOnly=function optionObjOfOnly(key,objSchema){return optionOf(key,objOfOnly(objSchema));};var defaulted=function defaulted(key,fallback){return field$1(key,key,defaulted$1(fallback),anyValue());};var defaultedOf=function defaultedOf(key,fallback,schema){return field$1(key,key,defaulted$1(fallback),schema);};var defaultedNumber=function defaultedNumber(key,fallback){return defaultedOf(key,fallback,number);};var defaultedString=function defaultedString(key,fallback){return defaultedOf(key,fallback,string);};var defaultedStringEnum=function defaultedStringEnum(key,fallback,values){return defaultedOf(key,fallback,validateEnum(values));};var defaultedBoolean=function defaultedBoolean(key,fallback){return defaultedOf(key,fallback,boolean);};var defaultedFunction=function defaultedFunction(key,fallback){return defaultedOf(key,fallback,functionProcessor);};var defaultedPostMsg=function defaultedPostMsg(key,fallback){return defaultedOf(key,fallback,postMessageable);};var defaultedArrayOf=function defaultedArrayOf(key,fallback,schema){return defaultedOf(key,fallback,arrOf(schema));};var defaultedObjOf=function defaultedObjOf(key,fallback,objSchema){return defaultedOf(key,fallback,objOf(objSchema));};var Cell=function Cell(initial){var value=initial;var get=function get(){return value;};var set=function set(v){value=v;};return{get:get,set:set};};var generate$7=function generate$7(cases){if(!isArray(cases)){throw new Error('cases must be an array');}if(cases.length===0){throw new Error('there must be at least one case');}var constructors=[];var adt={};each$1(cases,function(acase,count){var keys$1=keys(acase);if(keys$1.length!==1){throw new Error('one and only one name per case');}var key=keys$1[0];var value=acase[key];if(adt[key]!==undefined){throw new Error('duplicate key detected:'+key);}else if(key==='cata'){throw new Error('cannot have a case named cata (sorry)');}else if(!isArray(value)){throw new Error('case arguments must be an array');}constructors.push(key);adt[key]=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}var argLength=args.length;if(argLength!==value.length){throw new Error('Wrong number of arguments to case '+key+'. Expected '+value.length+' ('+value+'), got '+argLength);}var match=function match(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length){throw new Error('Wrong number of arguments to match. Expected: '+constructors.join(',')+'\\nActual: '+branchKeys.join(','));}var allReqd=forall(constructors,function(reqKey){return contains$2(branchKeys,reqKey);});if(!allReqd){throw new Error('Not all branches were specified when using match. Specified: '+branchKeys.join(', ')+'\\nRequired: '+constructors.join(', '));}return branches[key].apply(null,args);};return{fold:function fold(){var foldArgs=[];for(var _i=0;_i<arguments.length;_i++){foldArgs[_i]=arguments[_i];}if(foldArgs.length!==cases.length){throw new Error('Wrong number of arguments to fold. Expected '+cases.length+', got '+foldArgs.length);}var target=foldArgs[count];return target.apply(null,args);},match:match,log:function log(label){console.log(label,{constructors:constructors,constructor:key,params:args});}};};});return adt;};var Adt={generate:generate$7};Adt.generate([{bothErrors:['error1','error2']},{firstError:['error1','value2']},{secondError:['value1','error2']},{bothValues:['value1','value2']}]);var partition$1=function partition$1(results){var errors=[];var values=[];each$1(results,function(result){result.fold(function(err){errors.push(err);},function(value){values.push(value);});});return{errors:errors,values:values};};var exclude$1=function exclude$1(obj,fields){var r={};each(obj,function(v,k){if(!contains$2(fields,k)){r[k]=v;}});return r;};var wrap$2=function wrap$2(key,value){var _a;return _a={},_a[key]=value,_a;};var wrapAll$1=function wrapAll$1(keyvalues){var r={};each$1(keyvalues,function(kv){r[kv.key]=kv.value;});return r;};var exclude=function exclude(obj,fields){return exclude$1(obj,fields);};var wrap$1=function wrap$1(key,value){return wrap$2(key,value);};var wrapAll=function wrapAll(keyvalues){return wrapAll$1(keyvalues);};var mergeValues=function mergeValues(values,base){return values.length===0?Result.value(base):Result.value(deepMerge(base,merge$1.apply(undefined,values)));};var mergeErrors=function mergeErrors(errors){return Result.error(flatten(errors));};var consolidate=function consolidate(objs,base){var partitions=partition$1(objs);return partitions.errors.length>0?mergeErrors(partitions.errors):mergeValues(partitions.values,base);};var ensureIsRoot=function ensureIsRoot(isRoot){return isFunction(isRoot)?isRoot:never;};var ancestor$2=function ancestor$2(scope,transform,isRoot){var element=scope.dom;var stop=ensureIsRoot(isRoot);while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);var transformed=transform(el);if(transformed.isSome()){return transformed;}else if(stop(el)){break;}}return Optional.none();};var closest$4=function closest$4(scope,transform,isRoot){var current=transform(scope);var stop=ensureIsRoot(isRoot);return current.orThunk(function(){return stop(scope)?Optional.none():ancestor$2(scope,transform,stop);});};var isSource=function isSource(component,simulatedEvent){return eq(component.element,simulatedEvent.event.target);};var defaultEventHandler={can:always,abort:never,run:noop};var nu$9=function nu$9(parts){if(!hasNonNullableKey(parts,'can')&&!hasNonNullableKey(parts,'abort')&&!hasNonNullableKey(parts,'run')){throw new Error('EventHandler defined by: '+JSON.stringify(parts,null,2)+' does not have can, abort, or run!');}return _assign(_assign({},defaultEventHandler),parts);};var all$2=function all$2(handlers,f){return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}return foldl(handlers,function(acc,handler){return acc&&f(handler).apply(undefined,args);},true);};};var any=function any(handlers,f){return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}return foldl(handlers,function(acc,handler){return acc||f(handler).apply(undefined,args);},false);};};var read$2=function read$2(handler){return isFunction(handler)?{can:always,abort:never,run:handler}:handler;};var fuse$1=function fuse$1(handlers){var can=all$2(handlers,function(handler){return handler.can;});var abort=any(handlers,function(handler){return handler.abort;});var run=function run(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}each$1(handlers,function(handler){handler.run.apply(undefined,args);});};return{can:can,abort:abort,run:run};};var constant=constant$1;var touchstart=constant('touchstart');var touchmove=constant('touchmove');var touchend=constant('touchend');var touchcancel=constant('touchcancel');var mousedown=constant('mousedown');var mousemove=constant('mousemove');var mouseout=constant('mouseout');var mouseup=constant('mouseup');var mouseover=constant('mouseover');var focusin=constant('focusin');var focusout=constant('focusout');var keydown=constant('keydown');var keyup=constant('keyup');var input=constant('input');var change=constant('change');var click=constant('click');var transitioncancel=constant('transitioncancel');var transitionend=constant('transitionend');var transitionstart=constant('transitionstart');var selectstart=constant('selectstart');var prefixName=function prefixName(name){return constant$1('alloy.'+name);};var alloy={tap:prefixName('tap')};var focus$4=prefixName('focus');var postBlur=prefixName('blur.post');var postPaste=prefixName('paste.post');var receive=prefixName('receive');var execute$5=prefixName('execute');var focusItem=prefixName('focus.item');var tap=alloy.tap;var longpress=prefixName('longpress');var sandboxClose=prefixName('sandbox.close');var typeaheadCancel=prefixName('typeahead.cancel');var systemInit=prefixName('system.init');var documentTouchmove=prefixName('system.touchmove');var documentTouchend=prefixName('system.touchend');var windowScroll=prefixName('system.scroll');var windowResize=prefixName('system.resize');var attachedToDom=prefixName('system.attached');var detachedFromDom=prefixName('system.detached');var dismissRequested=prefixName('system.dismissRequested');var repositionRequested=prefixName('system.repositionRequested');var focusShifted=prefixName('focusmanager.shifted');var slotVisibility=prefixName('slotcontainer.visibility');var changeTab=prefixName('change.tab');var dismissTab=prefixName('dismiss.tab');var highlight$1=prefixName('highlight');var dehighlight$1=prefixName('dehighlight');var emit=function emit(component,event){dispatchWith(component,component.element,event,{});};var emitWith=function emitWith(component,event,properties){dispatchWith(component,component.element,event,properties);};var emitExecute=function emitExecute(component){emit(component,execute$5());};var dispatch=function dispatch(component,target,event){dispatchWith(component,target,event,{});};var dispatchWith=function dispatchWith(component,target,event,properties){var data=_assign({target:target},properties);component.getSystem().triggerEvent(event,target,data);};var dispatchEvent=function dispatchEvent(component,target,event,simulatedEvent){component.getSystem().triggerEvent(event,target,simulatedEvent.event);};var derive$2=function derive$2(configs){return wrapAll(configs);};var abort=function abort(name,predicate){return{key:name,value:nu$9({abort:predicate})};};var can=function can(name,predicate){return{key:name,value:nu$9({can:predicate})};};var preventDefault=function preventDefault(name){return{key:name,value:nu$9({run:function run(component,simulatedEvent){simulatedEvent.event.prevent();}})};};var run$1=function run$1(name,handler){return{key:name,value:nu$9({run:handler})};};var runActionExtra=function runActionExtra(name,action,extra){return{key:name,value:nu$9({run:function run(component,simulatedEvent){action.apply(undefined,[component,simulatedEvent].concat(extra));}})};};var runOnName=function runOnName(name){return function(handler){return run$1(name,handler);};};var runOnSourceName=function runOnSourceName(name){return function(handler){return{key:name,value:nu$9({run:function run(component,simulatedEvent){if(isSource(component,simulatedEvent)){handler(component,simulatedEvent);}}})};};};var redirectToUid=function redirectToUid(name,uid){return run$1(name,function(component,simulatedEvent){component.getSystem().getByUid(uid).each(function(redirectee){dispatchEvent(redirectee,redirectee.element,name,simulatedEvent);});});};var redirectToPart=function redirectToPart(name,detail,partName){var uid=detail.partUids[partName];return redirectToUid(name,uid);};var runWithTarget=function runWithTarget(name,f){return run$1(name,function(component,simulatedEvent){var ev=simulatedEvent.event;var target=component.getSystem().getByDom(ev.target).getOrThunk(function(){var closest=closest$4(ev.target,function(el){return component.getSystem().getByDom(el).toOptional();},never);return closest.getOr(component);});f(component,target,simulatedEvent);});};var cutter=function cutter(name){return run$1(name,function(component,simulatedEvent){simulatedEvent.cut();});};var stopper=function stopper(name){return run$1(name,function(component,simulatedEvent){simulatedEvent.stop();});};var runOnSource=function runOnSource(name,f){return runOnSourceName(name)(f);};var runOnAttached=runOnSourceName(attachedToDom());var runOnDetached=runOnSourceName(detachedFromDom());var runOnInit=runOnSourceName(systemInit());var runOnExecute$1=runOnName(execute$5());var fromHtml$1=function fromHtml$1(html,scope){var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;return children(SugarElement.fromDom(div));};var get$7=function get$7(element){return element.dom.innerHTML;};var set$5=function set$5(element,content){var owner=owner$4(element);var docDom=owner.dom;var fragment=SugarElement.fromDom(docDom.createDocumentFragment());var contentElements=fromHtml$1(content,docDom);append$1(fragment,contentElements);empty(element);append$2(element,fragment);};var getOuter=function getOuter(element){var container=SugarElement.fromTag('div');var clone=SugarElement.fromDom(element.dom.cloneNode(true));append$2(container,clone);return get$7(container);};var clone$2=function clone$2(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep));};var shallow=function shallow(original){return clone$2(original,false);};var getHtml=function getHtml(element){if(isShadowRoot(element)){return'#shadow-root';}else{var clone=shallow(element);return getOuter(clone);}};var element=function element(elem){return getHtml(elem);};var isRecursive=function isRecursive(component,originator,target){return eq(originator,component.element)&&!eq(originator,target);};var events$i=derive$2([can(focus$4(),function(component,simulatedEvent){var event=simulatedEvent.event;var originator=event.originator;var target=event.target;if(isRecursive(component,originator,target)){console.warn(focus$4()+' did not get interpreted by the desired target. '+'\\nOriginator: '+element(originator)+'\\nTarget: '+element(target)+'\\nCheck the '+focus$4()+' event handlers');return false;}else{return true;}})]);var DefaultEvents=/*#__PURE__*/Object.freeze({__proto__:null,events:events$i});var unique=0;var generate$6=function generate$6(prefix){var date=new Date();var time=date.getTime();var random=Math.floor(Math.random()*1000000000);unique++;return prefix+'_'+random+unique+String(time);};var prefix$1=constant$1('alloy-id-');var idAttr$1=constant$1('data-alloy-id');var prefix=prefix$1();var idAttr=idAttr$1();var write=function write(label,elem){var id=generate$6(prefix+label);writeOnly(elem,id);return id;};var writeOnly=function writeOnly(elem,uid){Object.defineProperty(elem.dom,idAttr,{value:uid,writable:true});};var read$1=function read$1(elem){var id=isElement$2(elem)?elem.dom[idAttr]:null;return Optional.from(id);};var generate$5=function generate$5(prefix){return generate$6(prefix);};var make$8=identity$1;var NoContextApi=function NoContextApi(getComp){var getMessage=function getMessage(event){return'The component must be in a context to execute: '+event+(getComp?'\\n'+element(getComp().element)+' is not in context.':'');};var fail=function fail(event){return function(){throw new Error(getMessage(event));};};var warn=function warn(event){return function(){console.warn(getMessage(event));};};return{debugInfo:constant$1('fake'),triggerEvent:warn('triggerEvent'),triggerFocus:warn('triggerFocus'),triggerEscape:warn('triggerEscape'),broadcast:warn('broadcast'),broadcastOn:warn('broadcastOn'),broadcastEvent:warn('broadcastEvent'),build:fail('build'),addToWorld:fail('addToWorld'),removeFromWorld:fail('removeFromWorld'),addToGui:fail('addToGui'),removeFromGui:fail('removeFromGui'),getByUid:fail('getByUid'),getByDom:fail('getByDom'),isConnected:never};};var singleton$1=NoContextApi();var markAsBehaviourApi=function markAsBehaviourApi(f,apiName,apiFunction){var delegate=apiFunction.toString();var endIndex=delegate.indexOf(')')+1;var openBracketIndex=delegate.indexOf('(');var parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\\s*/);f.toFunctionAnnotation=function(){return{name:apiName,parameters:cleanParameters(parameters.slice(0,1).concat(parameters.slice(3)))};};return f;};var cleanParameters=function cleanParameters(parameters){return map$2(parameters,function(p){return endsWith(p,'/*')?p.substring(0,p.length-'/*'.length):p;});};var markAsExtraApi=function markAsExtraApi(f,extraName){var delegate=f.toString();var endIndex=delegate.indexOf(')')+1;var openBracketIndex=delegate.indexOf('(');var parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\\s*/);f.toFunctionAnnotation=function(){return{name:extraName,parameters:cleanParameters(parameters)};};return f;};var markAsSketchApi=function markAsSketchApi(f,apiFunction){var delegate=apiFunction.toString();var endIndex=delegate.indexOf(')')+1;var openBracketIndex=delegate.indexOf('(');var parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\\s*/);f.toFunctionAnnotation=function(){return{name:'OVERRIDE',parameters:cleanParameters(parameters.slice(1))};};return f;};var premadeTag=generate$6('alloy-premade');var premade$1=function premade$1(comp){return wrap$1(premadeTag,comp);};var getPremade=function getPremade(spec){return get$e(spec,premadeTag);};var makeApi=function makeApi(f){return markAsSketchApi(function(component){var rest=[];for(var _i=1;_i<arguments.length;_i++){rest[_i-1]=arguments[_i];}return f.apply(void 0,__spreadArray([component.getApis(),component],rest,false));},f);};var NoState={init:function init(){return nu$8({readState:constant$1('No State required')});}};var nu$8=function nu$8(spec){return spec;};var generateFrom$1=function generateFrom$1(spec,all){var schema=map$2(all,function(a){return optionObjOf(a.name(),[required$1('config'),defaulted('state',NoState)]);});var validated=asRaw('component.behaviours',objOf(schema),spec.behaviours).fold(function(errInfo){throw new Error(formatError(errInfo)+'\\nComplete spec:\\n'+JSON.stringify(spec,null,2));},identity$1);return{list:all,data:map$1(validated,function(optBlobThunk){var output=optBlobThunk.map(function(blob){return{config:blob.config,state:blob.state.init(blob.config)};});return constant$1(output);})};};var getBehaviours$3=function getBehaviours$3(bData){return bData.list;};var getData$2=function getData$2(bData){return bData.data;};var byInnerKey=function byInnerKey(data,tuple){var r={};each(data,function(detail,key){each(detail,function(value,indexKey){var chain=get$e(r,indexKey).getOr([]);r[indexKey]=chain.concat([tuple(key,value)]);});});return r;};var nu$7=function nu$7(s){return{classes:isUndefined(s.classes)?[]:s.classes,attributes:isUndefined(s.attributes)?{}:s.attributes,styles:isUndefined(s.styles)?{}:s.styles};};var merge=function merge(defnA,mod){return _assign(_assign({},defnA),{attributes:_assign(_assign({},defnA.attributes),mod.attributes),styles:_assign(_assign({},defnA.styles),mod.styles),classes:defnA.classes.concat(mod.classes)});};var combine$2=function combine$2(info,baseMod,behaviours,base){var modsByBehaviour=_assign({},baseMod);each$1(behaviours,function(behaviour){modsByBehaviour[behaviour.name()]=behaviour.exhibit(info,base);});var byAspect=byInnerKey(modsByBehaviour,function(name,modification){return{name:name,modification:modification};});var combineObjects=function combineObjects(objects){return foldr(objects,function(b,a){return _assign(_assign({},a.modification),b);},{});};var combinedClasses=foldr(byAspect.classes,function(b,a){return a.modification.concat(b);},[]);var combinedAttributes=combineObjects(byAspect.attributes);var combinedStyles=combineObjects(byAspect.styles);return nu$7({classes:combinedClasses,attributes:combinedAttributes,styles:combinedStyles});};var sortKeys=function sortKeys(label,keyName,array,order){try{var sorted=sort(array,function(a,b){var aKey=a[keyName];var bKey=b[keyName];var aIndex=order.indexOf(aKey);var bIndex=order.indexOf(bKey);if(aIndex===-1){throw new Error('The ordering for '+label+' does not have an entry for '+aKey+'.\\nOrder specified: '+JSON.stringify(order,null,2));}if(bIndex===-1){throw new Error('The ordering for '+label+' does not have an entry for '+bKey+'.\\nOrder specified: '+JSON.stringify(order,null,2));}if(aIndex<bIndex){return-1;}else if(bIndex<aIndex){return 1;}else{return 0;}});return Result.value(sorted);}catch(err){return Result.error([err]);}};var uncurried=function uncurried(handler,purpose){return{handler:handler,purpose:purpose};};var curried=function curried(handler,purpose){return{cHandler:handler,purpose:purpose};};var curryArgs=function curryArgs(descHandler,extraArgs){return curried(curry.apply(undefined,[descHandler.handler].concat(extraArgs)),descHandler.purpose);};var getCurried=function getCurried(descHandler){return descHandler.cHandler;};var behaviourTuple=function behaviourTuple(name,handler){return{name:name,handler:handler};};var nameToHandlers=function nameToHandlers(behaviours,info){var r={};each$1(behaviours,function(behaviour){r[behaviour.name()]=behaviour.handlers(info);});return r;};var groupByEvents=function groupByEvents(info,behaviours,base){var behaviourEvents=_assign(_assign({},base),nameToHandlers(behaviours,info));return byInnerKey(behaviourEvents,behaviourTuple);};var combine$1=function combine$1(info,eventOrder,behaviours,base){var byEventName=groupByEvents(info,behaviours,base);return combineGroups(byEventName,eventOrder);};var assemble=function assemble(rawHandler){var handler=read$2(rawHandler);return function(component,simulatedEvent){var rest=[];for(var _i=2;_i<arguments.length;_i++){rest[_i-2]=arguments[_i];}var args=[component,simulatedEvent].concat(rest);if(handler.abort.apply(undefined,args)){simulatedEvent.stop();}else if(handler.can.apply(undefined,args)){handler.run.apply(undefined,args);}};};var missingOrderError=function missingOrderError(eventName,tuples){return Result.error(['The event ('+eventName+') has more than one behaviour that listens to it.\\nWhen this occurs, you must '+'specify an event ordering for the behaviours in your spec (e.g. [ \"listing\", \"toggling\" ]).\\nThe behaviours that '+'can trigger it are: '+JSON.stringify(map$2(tuples,function(c){return c.name;}),null,2)]);};var fuse=function fuse(tuples,eventOrder,eventName){var order=eventOrder[eventName];if(!order){return missingOrderError(eventName,tuples);}else{return sortKeys('Event: '+eventName,'name',tuples,order).map(function(sortedTuples){var handlers=map$2(sortedTuples,function(tuple){return tuple.handler;});return fuse$1(handlers);});}};var combineGroups=function combineGroups(byEventName,eventOrder){var r=mapToArray(byEventName,function(tuples,eventName){var combined=tuples.length===1?Result.value(tuples[0].handler):fuse(tuples,eventOrder,eventName);return combined.map(function(handler){var assembled=assemble(handler);var purpose=tuples.length>1?filter$2(eventOrder[eventName],function(o){return exists(tuples,function(t){return t.name===o;});}).join(' > '):tuples[0].name;return wrap$1(eventName,uncurried(assembled,purpose));});});return consolidate(r,{});};var _a$2;var baseBehaviour='alloy.base.behaviour';var schema$z=objOf([field$1('dom','dom',required$2(),objOf([required$1('tag'),defaulted('styles',{}),defaulted('classes',[]),defaulted('attributes',{}),option('value'),option('innerHtml')])),required$1('components'),required$1('uid'),defaulted('events',{}),defaulted('apis',{}),field$1('eventOrder','eventOrder',mergeWith((_a$2={},_a$2[execute$5()]=['disabling',baseBehaviour,'toggling','typeaheadevents'],_a$2[focus$4()]=[baseBehaviour,'focusing','keying'],_a$2[systemInit()]=[baseBehaviour,'disabling','toggling','representing'],_a$2[input()]=[baseBehaviour,'representing','streaming','invalidating'],_a$2[detachedFromDom()]=[baseBehaviour,'representing','item-events','tooltipping'],_a$2[mousedown()]=['focusing',baseBehaviour,'item-type-events'],_a$2[touchstart()]=['focusing',baseBehaviour,'item-type-events'],_a$2[mouseover()]=['item-type-events','tooltipping'],_a$2[receive()]=['receiving','reflecting','tooltipping'],_a$2)),anyValue()),option('domModification')]);var toInfo=function toInfo(spec){return asRaw('custom.definition',schema$z,spec);};var toDefinition=function toDefinition(detail){return _assign(_assign({},detail.dom),{uid:detail.uid,domChildren:map$2(detail.components,function(comp){return comp.element;})});};var toModification=function toModification(detail){return detail.domModification.fold(function(){return nu$7({});},nu$7);};var toEvents=function toEvents(info){return info.events;};var read=function read(element,attr){var value=get$d(element,attr);return value===undefined||value===''?[]:value.split(' ');};var add$4=function add$4(element,attr,id){var old=read(element,attr);var nu=old.concat([id]);set$8(element,attr,nu.join(' '));return true;};var remove$4=function remove$4(element,attr,id){var nu=filter$2(read(element,attr),function(v){return v!==id;});if(nu.length>0){set$8(element,attr,nu.join(' '));}else{remove$7(element,attr);}return false;};var supports=function supports(element){return element.dom.classList!==undefined;};var get$6=function get$6(element){return read(element,'class');};var add$3=function add$3(element,clazz){return add$4(element,'class',clazz);};var remove$3=function remove$3(element,clazz){return remove$4(element,'class',clazz);};var add$2=function add$2(element,clazz){if(supports(element)){element.dom.classList.add(clazz);}else{add$3(element,clazz);}};var cleanClass=function cleanClass(element){var classList=supports(element)?element.dom.classList:get$6(element);if(classList.length===0){remove$7(element,'class');}};var remove$2=function remove$2(element,clazz){if(supports(element)){var classList=element.dom.classList;classList.remove(clazz);}else{remove$3(element,clazz);}cleanClass(element);};var has=function has(element,clazz){return supports(element)&&element.dom.classList.contains(clazz);};var add$1=function add$1(element,classes){each$1(classes,function(x){add$2(element,x);});};var remove$1=function remove$1(element,classes){each$1(classes,function(x){remove$2(element,x);});};var hasAll=function hasAll(element,classes){return forall(classes,function(clazz){return has(element,clazz);});};var get$5=function get$5(element){return element.dom.value;};var set$4=function set$4(element,value){if(value===undefined){throw new Error('Value.set was undefined');}element.dom.value=value;};var renderToDom=function renderToDom(definition){var subject=SugarElement.fromTag(definition.tag);setAll$1(subject,definition.attributes);add$1(subject,definition.classes);setAll(subject,definition.styles);definition.innerHtml.each(function(html){return set$5(subject,html);});var children=definition.domChildren;append$1(subject,children);definition.value.each(function(value){set$4(subject,value);});if(!definition.uid){debugger;}writeOnly(subject,definition.uid);return subject;};var getBehaviours$2=function getBehaviours$2(spec){var behaviours=get$e(spec,'behaviours').getOr({});return bind$3(keys(behaviours),function(name){var behaviour=behaviours[name];return isNonNullable(behaviour)?[behaviour.me]:[];});};var generateFrom=function generateFrom(spec,all){return generateFrom$1(spec,all);};var generate$4=function generate$4(spec){var all=getBehaviours$2(spec);return generateFrom(spec,all);};var getDomDefinition=function getDomDefinition(info,bList,bData){var definition=toDefinition(info);var infoModification=toModification(info);var baseModification={'alloy.base.modification':infoModification};var modification=bList.length>0?combine$2(bData,baseModification,bList,definition):infoModification;return merge(definition,modification);};var getEvents=function getEvents(info,bList,bData){var baseEvents={'alloy.base.behaviour':toEvents(info)};return combine$1(bData,info.eventOrder,bList,baseEvents).getOrDie();};var build$2=function build$2(spec){var getMe=function getMe(){return me;};var systemApi=Cell(singleton$1);var info=getOrDie(toInfo(spec));var bBlob=generate$4(spec);var bList=getBehaviours$3(bBlob);var bData=getData$2(bBlob);var modDefinition=getDomDefinition(info,bList,bData);var item=renderToDom(modDefinition);var events=getEvents(info,bList,bData);var subcomponents=Cell(info.components);var connect=function connect(newApi){systemApi.set(newApi);};var disconnect=function disconnect(){systemApi.set(NoContextApi(getMe));};var syncComponents=function syncComponents(){var children$1=children(item);var subs=bind$3(children$1,function(child){return systemApi.get().getByDom(child).fold(function(){return[];},pure$2);});subcomponents.set(subs);};var config=function config(behaviour){var b=bData;var f=isFunction(b[behaviour.name()])?b[behaviour.name()]:function(){throw new Error('Could not find '+behaviour.name()+' in '+JSON.stringify(spec,null,2));};return f();};var hasConfigured=function hasConfigured(behaviour){return isFunction(bData[behaviour.name()]);};var getApis=function getApis(){return info.apis;};var readState=function readState(behaviourName){return bData[behaviourName]().map(function(b){return b.state.readState();}).getOr('not enabled');};var me={uid:spec.uid,getSystem:systemApi.get,config:config,hasConfigured:hasConfigured,spec:spec,readState:readState,getApis:getApis,connect:connect,disconnect:disconnect,element:item,syncComponents:syncComponents,components:subcomponents.get,events:events};return me;};var buildSubcomponents=function buildSubcomponents(spec){var components=get$e(spec,'components').getOr([]);return map$2(components,build$1);};var buildFromSpec=function buildFromSpec(userSpec){var _a=make$8(userSpec),specEvents=_a.events,spec=__rest(_a,['events']);var components=buildSubcomponents(spec);var completeSpec=_assign(_assign({},spec),{events:_assign(_assign({},DefaultEvents),specEvents),components:components});return Result.value(build$2(completeSpec));};var text$1=function text$1(textContent){var element=SugarElement.fromText(textContent);return external$2({element:element});};var external$2=function external$2(spec){var extSpec=asRawOrDie$1('external.component',objOfOnly([required$1('element'),option('uid')]),spec);var systemApi=Cell(NoContextApi());var connect=function connect(newApi){systemApi.set(newApi);};var disconnect=function disconnect(){systemApi.set(NoContextApi(function(){return me;}));};var uid=extSpec.uid.getOrThunk(function(){return generate$5('external');});writeOnly(extSpec.element,uid);var me={uid:uid,getSystem:systemApi.get,config:Optional.none,hasConfigured:never,connect:connect,disconnect:disconnect,getApis:function getApis(){return{};},element:extSpec.element,spec:spec,readState:constant$1('No state'),syncComponents:noop,components:constant$1([]),events:{}};return premade$1(me);};var uids=generate$5;var isSketchSpec$1=function isSketchSpec$1(spec){return has$2(spec,'uid');};var build$1=function build$1(spec){return getPremade(spec).getOrThunk(function(){var userSpecWithUid=isSketchSpec$1(spec)?spec:_assign({uid:uids('')},spec);return buildFromSpec(userSpecWithUid).getOrDie();});};var premade=premade$1;function ClosestOrAncestor(is,ancestor,scope,a,isRoot){if(is(scope,a)){return Optional.some(scope);}else if(isFunction(isRoot)&&isRoot(scope)){return Optional.none();}else{return ancestor(scope,a,isRoot);}}var ancestor$1=function ancestor$1(scope,predicate,isRoot){var element=scope.dom;var stop=isFunction(isRoot)?isRoot:never;while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el)){return Optional.some(el);}else if(stop(el)){break;}}return Optional.none();};var closest$3=function closest$3(scope,predicate,isRoot){var is=function is(s,test){return test(s);};return ClosestOrAncestor(is,ancestor$1,scope,predicate,isRoot);};var child$1=function child$1(scope,predicate){var pred=function pred(node){return predicate(SugarElement.fromDom(node));};var result=find$5(scope.dom.childNodes,pred);return result.map(SugarElement.fromDom);};var descendant$1=function descendant$1(scope,predicate){var _descend=function descend(node){for(var i=0;i<node.childNodes.length;i++){var child_1=SugarElement.fromDom(node.childNodes[i]);if(predicate(child_1)){return Optional.some(child_1);}var res=_descend(node.childNodes[i]);if(res.isSome()){return res;}}return Optional.none();};return _descend(scope.dom);};var closest$2=function closest$2(scope,predicate,isRoot){return closest$3(scope,predicate,isRoot).isSome();};var ancestor=function ancestor(scope,selector,isRoot){return ancestor$1(scope,function(e){return is(e,selector);},isRoot);};var child=function child(scope,selector){return child$1(scope,function(e){return is(e,selector);});};var descendant=function descendant(scope,selector){return one(selector,scope);};var closest$1=function closest$1(scope,selector,isRoot){var is$1=function is$1(element,selector){return is(element,selector);};return ClosestOrAncestor(is$1,ancestor,scope,selector,isRoot);};var find$1=function find$1(queryElem){var dependent=closest$3(queryElem,function(elem){if(!isElement$2(elem)){return false;}var id=get$d(elem,'id');return id!==undefined&&id.indexOf('aria-owns')>-1;});return dependent.bind(function(dep){var id=get$d(dep,'id');var dos=getRootNode(dep);return descendant(dos,'[aria-owns=\"'+id+'\"]');});};var manager=function manager(){var ariaId=generate$6('aria-owns');var link=function link(elem){set$8(elem,'aria-owns',ariaId);};var unlink=function unlink(elem){remove$7(elem,'aria-owns');};return{id:ariaId,link:link,unlink:unlink};};var isAriaPartOf=function isAriaPartOf(component,queryElem){return find$1(queryElem).exists(function(owner){return isPartOf$1(component,owner);});};var isPartOf$1=function isPartOf$1(component,queryElem){return closest$2(queryElem,function(el){return eq(el,component.element);},never)||isAriaPartOf(component,queryElem);};var unknown='unknown';var EventConfiguration;(function(EventConfiguration){EventConfiguration[EventConfiguration['STOP']=0]='STOP';EventConfiguration[EventConfiguration['NORMAL']=1]='NORMAL';EventConfiguration[EventConfiguration['LOGGING']=2]='LOGGING';})(EventConfiguration||(EventConfiguration={}));var eventConfig=Cell({});var makeEventLogger=function makeEventLogger(eventName,initialTarget){var sequence=[];var startTime=new Date().getTime();return{logEventCut:function logEventCut(_name,target,purpose){sequence.push({outcome:'cut',target:target,purpose:purpose});},logEventStopped:function logEventStopped(_name,target,purpose){sequence.push({outcome:'stopped',target:target,purpose:purpose});},logNoParent:function logNoParent(_name,target,purpose){sequence.push({outcome:'no-parent',target:target,purpose:purpose});},logEventNoHandlers:function logEventNoHandlers(_name,target){sequence.push({outcome:'no-handlers-left',target:target});},logEventResponse:function logEventResponse(_name,target,purpose){sequence.push({outcome:'response',purpose:purpose,target:target});},write:function write(){var finishTime=new Date().getTime();if(contains$2(['mousemove','mouseover','mouseout',systemInit()],eventName)){return;}console.log(eventName,{event:eventName,time:finishTime-startTime,target:initialTarget.dom,sequence:map$2(sequence,function(s){if(!contains$2(['cut','stopped','response'],s.outcome)){return s.outcome;}else{return'{'+s.purpose+'} '+s.outcome+' at ('+element(s.target)+')';}})});}};};var processEvent=function processEvent(eventName,initialTarget,f){var status=get$e(eventConfig.get(),eventName).orThunk(function(){var patterns=keys(eventConfig.get());return findMap(patterns,function(p){return eventName.indexOf(p)>-1?Optional.some(eventConfig.get()[p]):Optional.none();});}).getOr(EventConfiguration.NORMAL);switch(status){case EventConfiguration.NORMAL:return f(noLogger());case EventConfiguration.LOGGING:{var logger=makeEventLogger(eventName,initialTarget);var output=f(logger);logger.write();return output;}case EventConfiguration.STOP:return true;}};var path=['alloy/data/Fields','alloy/debugging/Debugging'];var getTrace=function getTrace(){var err=new Error();if(err.stack!==undefined){var lines=err.stack.split('\\n');return find$5(lines,function(line){return line.indexOf('alloy')>0&&!exists(path,function(p){return line.indexOf(p)>-1;});}).getOr(unknown);}else{return unknown;}};var ignoreEvent={logEventCut:noop,logEventStopped:noop,logNoParent:noop,logEventNoHandlers:noop,logEventResponse:noop,write:noop};var monitorEvent=function monitorEvent(eventName,initialTarget,f){return processEvent(eventName,initialTarget,f);};var noLogger=constant$1(ignoreEvent);var menuFields=constant$1([required$1('menu'),required$1('selectedMenu')]);var itemFields=constant$1([required$1('item'),required$1('selectedItem')]);constant$1(objOf(itemFields().concat(menuFields())));var itemSchema$3=constant$1(objOf(itemFields()));var _initSize=requiredObjOf('initSize',[required$1('numColumns'),required$1('numRows')]);var itemMarkers=function itemMarkers(){return requiredOf('markers',itemSchema$3());};var tieredMenuMarkers=function tieredMenuMarkers(){return requiredObjOf('markers',[required$1('backgroundMenu')].concat(menuFields()).concat(itemFields()));};var markers$1=function markers$1(required){return requiredObjOf('markers',map$2(required,required$1));};var onPresenceHandler=function onPresenceHandler(label,fieldName,presence){getTrace();return field$1(fieldName,fieldName,presence,valueOf(function(f){return Result.value(function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}return f.apply(undefined,args);});}));};var onHandler=function onHandler(fieldName){return onPresenceHandler('onHandler',fieldName,defaulted$1(noop));};var onKeyboardHandler=function onKeyboardHandler(fieldName){return onPresenceHandler('onKeyboardHandler',fieldName,defaulted$1(Optional.none));};var onStrictHandler=function onStrictHandler(fieldName){return onPresenceHandler('onHandler',fieldName,required$2());};var onStrictKeyboardHandler=function onStrictKeyboardHandler(fieldName){return onPresenceHandler('onKeyboardHandler',fieldName,required$2());};var output$1=function output$1(name,value){return customField(name,constant$1(value));};var snapshot=function snapshot(name){return customField(name,identity$1);};var initSize=constant$1(_initSize);var nu$6=function nu$6(x,y,bubble,direction,placement,boundsRestriction,labelPrefix,alwaysFit){if(alwaysFit===void 0){alwaysFit=false;}return{x:x,y:y,bubble:bubble,direction:direction,placement:placement,restriction:boundsRestriction,label:labelPrefix+'-'+placement,alwaysFit:alwaysFit};};var adt$a=Adt.generate([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]);var cata$2=function cata$2(subject,southeast,southwest,northeast,northwest,south,north,east,west){return subject.fold(southeast,southwest,northeast,northwest,south,north,east,west);};var cataVertical=function cataVertical(subject,south,middle,north){return subject.fold(south,south,north,north,south,north,middle,middle);};var cataHorizontal=function cataHorizontal(subject,east,middle,west){return subject.fold(east,west,east,west,middle,middle,east,west);};var southeast$3=adt$a.southeast;var southwest$3=adt$a.southwest;var northeast$3=adt$a.northeast;var northwest$3=adt$a.northwest;var south$3=adt$a.south;var north$3=adt$a.north;var east$3=adt$a.east;var west$3=adt$a.west;var cycleBy=function cycleBy(value,delta,min,max){var r=value+delta;if(r>max){return min;}else if(r<min){return max;}else{return r;}};var clamp$1=function clamp$1(value,min,max){return Math.min(Math.max(value,min),max);};var getRestriction=function getRestriction(anchor,restriction){switch(restriction){case 1:return anchor.x;case 0:return anchor.x+anchor.width;case 2:return anchor.y;case 3:return anchor.y+anchor.height;}};var boundsRestriction=function boundsRestriction(anchor,restrictions){return mapToObject(['left','right','top','bottom'],function(dir){return get$e(restrictions,dir).map(function(restriction){return getRestriction(anchor,restriction);});});};var adjustBounds=function adjustBounds(bounds$1,restriction,bubbleOffset){var applyRestriction=function applyRestriction(dir,current){return restriction[dir].map(function(pos){var isVerticalAxis=dir==='top'||dir==='bottom';var offset=isVerticalAxis?bubbleOffset.top:bubbleOffset.left;var comparator=dir==='left'||dir==='top'?Math.max:Math.min;var newPos=comparator(pos,current)+offset;return isVerticalAxis?clamp$1(newPos,bounds$1.y,bounds$1.bottom):clamp$1(newPos,bounds$1.x,bounds$1.right);}).getOr(current);};var adjustedLeft=applyRestriction('left',bounds$1.x);var adjustedTop=applyRestriction('top',bounds$1.y);var adjustedRight=applyRestriction('right',bounds$1.right);var adjustedBottom=applyRestriction('bottom',bounds$1.bottom);return bounds(adjustedLeft,adjustedTop,adjustedRight-adjustedLeft,adjustedBottom-adjustedTop);};var labelPrefix$2='layout';var eastX$1=function eastX$1(anchor){return anchor.x;};var middleX$1=function middleX$1(anchor,element){return anchor.x+anchor.width/2-element.width/2;};var westX$1=function westX$1(anchor,element){return anchor.x+anchor.width-element.width;};var northY$2=function northY$2(anchor,element){return anchor.y-element.height;};var southY$2=function southY$2(anchor){return anchor.y+anchor.height;};var centreY$1=function centreY$1(anchor,element){return anchor.y+anchor.height/2-element.height/2;};var eastEdgeX$1=function eastEdgeX$1(anchor){return anchor.x+anchor.width;};var westEdgeX$1=function westEdgeX$1(anchor,element){return anchor.x-element.width;};var southeast$2=function southeast$2(anchor,element,bubbles){return nu$6(eastX$1(anchor),southY$2(anchor),bubbles.southeast(),southeast$3(),'southeast',boundsRestriction(anchor,{left:1,top:3}),labelPrefix$2);};var southwest$2=function southwest$2(anchor,element,bubbles){return nu$6(westX$1(anchor,element),southY$2(anchor),bubbles.southwest(),southwest$3(),'southwest',boundsRestriction(anchor,{right:0,top:3}),labelPrefix$2);};var northeast$2=function northeast$2(anchor,element,bubbles){return nu$6(eastX$1(anchor),northY$2(anchor,element),bubbles.northeast(),northeast$3(),'northeast',boundsRestriction(anchor,{left:1,bottom:2}),labelPrefix$2);};var northwest$2=function northwest$2(anchor,element,bubbles){return nu$6(westX$1(anchor,element),northY$2(anchor,element),bubbles.northwest(),northwest$3(),'northwest',boundsRestriction(anchor,{right:0,bottom:2}),labelPrefix$2);};var north$2=function north$2(anchor,element,bubbles){return nu$6(middleX$1(anchor,element),northY$2(anchor,element),bubbles.north(),north$3(),'north',boundsRestriction(anchor,{bottom:2}),labelPrefix$2);};var south$2=function south$2(anchor,element,bubbles){return nu$6(middleX$1(anchor,element),southY$2(anchor),bubbles.south(),south$3(),'south',boundsRestriction(anchor,{top:3}),labelPrefix$2);};var east$2=function east$2(anchor,element,bubbles){return nu$6(eastEdgeX$1(anchor),centreY$1(anchor,element),bubbles.east(),east$3(),'east',boundsRestriction(anchor,{left:0}),labelPrefix$2);};var west$2=function west$2(anchor,element,bubbles){return nu$6(westEdgeX$1(anchor,element),centreY$1(anchor,element),bubbles.west(),west$3(),'west',boundsRestriction(anchor,{right:1}),labelPrefix$2);};var all$1=function all$1(){return[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2,east$2,west$2];};var allRtl$1=function allRtl$1(){return[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2,east$2,west$2];};var aboveOrBelow=function aboveOrBelow(){return[northeast$2,northwest$2,southeast$2,southwest$2,north$2,south$2];};var aboveOrBelowRtl=function aboveOrBelowRtl(){return[northwest$2,northeast$2,southwest$2,southeast$2,north$2,south$2];};var belowOrAbove=function belowOrAbove(){return[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2];};var belowOrAboveRtl=function belowOrAboveRtl(){return[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2];};var chooseChannels=function chooseChannels(channels,message){return message.universal?channels:filter$2(channels,function(ch){return contains$2(message.channels,ch);});};var events$h=function events$h(receiveConfig){return derive$2([run$1(receive(),function(component,message){var channelMap=receiveConfig.channels;var channels=keys(channelMap);var receivingData=message;var targetChannels=chooseChannels(channels,receivingData);each$1(targetChannels,function(ch){var channelInfo=channelMap[ch];var channelSchema=channelInfo.schema;var data=asRawOrDie$1('channel['+ch+'] data\\nReceiver: '+element(component.element),channelSchema,receivingData.data);channelInfo.onReceive(component,data);});})]);};var ActiveReceiving=/*#__PURE__*/Object.freeze({__proto__:null,events:events$h});var ReceivingSchema=[requiredOf('channels',setOf(Result.value,objOfOnly([onStrictHandler('onReceive'),defaulted('schema',anyValue())])))];var executeEvent=function executeEvent(bConfig,bState,executor){return runOnExecute$1(function(component){executor(component,bConfig,bState);});};var loadEvent=function loadEvent(bConfig,bState,f){return runOnInit(function(component,_simulatedEvent){f(component,bConfig,bState);});};var create$9=function create$9(schema,name,active,apis,extra,state){var configSchema=objOfOnly(schema);var schemaSchema=optionObjOf(name,[optionObjOfOnly('config',schema)]);return doCreate(configSchema,schemaSchema,name,active,apis,extra,state);};var createModes$1=function createModes$1(modes,name,active,apis,extra,state){var configSchema=modes;var schemaSchema=optionObjOf(name,[optionOf('config',modes)]);return doCreate(configSchema,schemaSchema,name,active,apis,extra,state);};var wrapApi=function wrapApi(bName,apiFunction,apiName){var f=function f(component){var rest=[];for(var _i=1;_i<arguments.length;_i++){rest[_i-1]=arguments[_i];}var args=[component].concat(rest);return component.config({name:constant$1(bName)}).fold(function(){throw new Error('We could not find any behaviour configuration for: '+bName+'. Using API: '+apiName);},function(info){var rest=Array.prototype.slice.call(args,1);return apiFunction.apply(undefined,[component,info.config,info.state].concat(rest));});};return markAsBehaviourApi(f,apiName,apiFunction);};var revokeBehaviour=function revokeBehaviour(name){return{key:name,value:undefined};};var doCreate=function doCreate(configSchema,schemaSchema,name,active,apis,extra,state){var getConfig=function getConfig(info){return hasNonNullableKey(info,name)?info[name]():Optional.none();};var wrappedApis=map$1(apis,function(apiF,apiName){return wrapApi(name,apiF,apiName);});var wrappedExtra=map$1(extra,function(extraF,extraName){return markAsExtraApi(extraF,extraName);});var me=_assign(_assign(_assign({},wrappedExtra),wrappedApis),{revoke:curry(revokeBehaviour,name),config:function config(spec){var prepared=asRawOrDie$1(name+'-config',configSchema,spec);return{key:name,value:{config:prepared,me:me,configAsRaw:cached(function(){return asRawOrDie$1(name+'-config',configSchema,spec);}),initialConfig:spec,state:state}};},schema:constant$1(schemaSchema),exhibit:function exhibit(info,base){return lift2(getConfig(info),get$e(active,'exhibit'),function(behaviourInfo,exhibitor){return exhibitor(base,behaviourInfo.config,behaviourInfo.state);}).getOrThunk(function(){return nu$7({});});},name:constant$1(name),handlers:function handlers(info){return getConfig(info).map(function(behaviourInfo){var getEvents=get$e(active,'events').getOr(function(){return{};});return getEvents(behaviourInfo.config,behaviourInfo.state);}).getOr({});}});return me;};var derive$1=function derive$1(capabilities){return wrapAll(capabilities);};var simpleSchema=objOfOnly([required$1('fields'),required$1('name'),defaulted('active',{}),defaulted('apis',{}),defaulted('state',NoState),defaulted('extra',{})]);var create$8=function create$8(data){var value=asRawOrDie$1('Creating behaviour: '+data.name,simpleSchema,data);return create$9(value.fields,value.name,value.active,value.apis,value.extra,value.state);};var modeSchema=objOfOnly([required$1('branchKey'),required$1('branches'),required$1('name'),defaulted('active',{}),defaulted('apis',{}),defaulted('state',NoState),defaulted('extra',{})]);var createModes=function createModes(data){var value=asRawOrDie$1('Creating behaviour: '+data.name,modeSchema,data);return createModes$1(choose$1(value.branchKey,value.branches),value.name,value.active,value.apis,value.extra,value.state);};var revoke=constant$1(undefined);var Receiving=create$8({fields:ReceivingSchema,name:'receiving',active:ActiveReceiving});var exhibit$6=function exhibit$6(base,posConfig){return nu$7({classes:[],styles:posConfig.useFixed()?{}:{position:'relative'}});};var ActivePosition=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$6});var getDocument=function getDocument(){return SugarElement.fromDom(document);};var focus$3=function focus$3(element){return element.dom.focus();};var blur$1=function blur$1(element){return element.dom.blur();};var hasFocus=function hasFocus(element){var root=getRootNode(element).dom;return element.dom===root.activeElement;};var active=function active(root){if(root===void 0){root=getDocument();}return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);};var search=function search(element){return active(getRootNode(element)).filter(function(e){return element.dom.contains(e.dom);});};var preserve$1=function preserve$1(f,container){var dos=getRootNode(container);var refocus=active(dos).bind(function(focused){var hasFocus=function hasFocus(elem){return eq(focused,elem);};return hasFocus(container)?Optional.some(container):descendant$1(container,hasFocus);});var result=f(container);refocus.each(function(oldFocus){active(dos).filter(function(newFocus){return eq(newFocus,oldFocus);}).fold(function(){focus$3(oldFocus);},noop);});return result;};var NuPositionCss=function NuPositionCss(position,left,top,right,bottom){var toPx=function toPx(num){return num+'px';};return{position:position,left:left.map(toPx),top:top.map(toPx),right:right.map(toPx),bottom:bottom.map(toPx)};};var toOptions=function toOptions(position){return _assign(_assign({},position),{position:Optional.some(position.position)});};var applyPositionCss=function applyPositionCss(element,position){setOptions(element,toOptions(position));};var adt$9=Adt.generate([{none:[]},{relative:['x','y','width','height']},{fixed:['x','y','width','height']}]);var positionWithDirection=function positionWithDirection(posName,decision,x,y,width,height){var decisionRect=decision.rect;var decisionX=decisionRect.x-x;var decisionY=decisionRect.y-y;var decisionWidth=decisionRect.width;var decisionHeight=decisionRect.height;var decisionRight=width-(decisionX+decisionWidth);var decisionBottom=height-(decisionY+decisionHeight);var left=Optional.some(decisionX);var top=Optional.some(decisionY);var right=Optional.some(decisionRight);var bottom=Optional.some(decisionBottom);var none=Optional.none();return cata$2(decision.direction,function(){return NuPositionCss(posName,left,top,none,none);},function(){return NuPositionCss(posName,none,top,right,none);},function(){return NuPositionCss(posName,left,none,none,bottom);},function(){return NuPositionCss(posName,none,none,right,bottom);},function(){return NuPositionCss(posName,left,top,none,none);},function(){return NuPositionCss(posName,left,none,none,bottom);},function(){return NuPositionCss(posName,left,top,none,none);},function(){return NuPositionCss(posName,none,top,right,none);});};var reposition=function reposition(origin,decision){return origin.fold(function(){var decisionRect=decision.rect;return NuPositionCss('absolute',Optional.some(decisionRect.x),Optional.some(decisionRect.y),Optional.none(),Optional.none());},function(x,y,width,height){return positionWithDirection('absolute',decision,x,y,width,height);},function(x,y,width,height){return positionWithDirection('fixed',decision,x,y,width,height);});};var toBox=function toBox(origin,element){var rel=curry(find$2,element);var position=origin.fold(rel,rel,function(){var scroll=get$9();return find$2(element).translate(-scroll.left,-scroll.top);});var width=getOuter$1(element);var height=getOuter$2(element);return bounds(position.left,position.top,width,height);};var viewport=function viewport(origin,getBounds){return getBounds.fold(function(){return origin.fold(win,win,bounds);},function(b){return origin.fold(b,b,function(){var bounds$1=b();var pos=translate$2(origin,bounds$1.x,bounds$1.y);return bounds(pos.left,pos.top,bounds$1.width,bounds$1.height);});});};var translate$2=function translate$2(origin,x,y){var pos=SugarPosition(x,y);var removeScroll=function removeScroll(){var outerScroll=get$9();return pos.translate(-outerScroll.left,-outerScroll.top);};return origin.fold(constant$1(pos),constant$1(pos),removeScroll);};var cata$1=function cata$1(subject,onNone,onRelative,onFixed){return subject.fold(onNone,onRelative,onFixed);};adt$9.none;var relative$1=adt$9.relative;var fixed$1=adt$9.fixed;var anchor=function anchor(anchorBox,origin){return{anchorBox:anchorBox,origin:origin};};var box=function box(anchorBox,origin){return anchor(anchorBox,origin);};var placementAttribute='data-alloy-placement';var setPlacement$1=function setPlacement$1(element,placement){set$8(element,placementAttribute,placement);};var getPlacement=function getPlacement(element){return getOpt(element,placementAttribute);};var reset$2=function reset$2(element){return remove$7(element,placementAttribute);};var adt$8=Adt.generate([{fit:['reposition']},{nofit:['reposition','visibleW','visibleH','isVisible']}]);var determinePosition=function determinePosition(box,bounds){var boundsX=bounds.x,boundsY=bounds.y,boundsRight=bounds.right,boundsBottom=bounds.bottom;var x=box.x,y=box.y,right=box.right,bottom=box.bottom,width=box.width,height=box.height;var xInBounds=x>=boundsX&&x<=boundsRight;var yInBounds=y>=boundsY&&y<=boundsBottom;var originInBounds=xInBounds&&yInBounds;var rightInBounds=right<=boundsRight&&right>=boundsX;var bottomInBounds=bottom<=boundsBottom&&bottom>=boundsY;var sizeInBounds=rightInBounds&&bottomInBounds;var visibleW=Math.min(width,x>=boundsX?boundsRight-x:right-boundsX);var visibleH=Math.min(height,y>=boundsY?boundsBottom-y:bottom-boundsY);return{originInBounds:originInBounds,sizeInBounds:sizeInBounds,visibleW:visibleW,visibleH:visibleH};};var calcReposition=function calcReposition(box,bounds$1){var boundsX=bounds$1.x,boundsY=bounds$1.y,boundsRight=bounds$1.right,boundsBottom=bounds$1.bottom;var x=box.x,y=box.y,width=box.width,height=box.height;var maxX=Math.max(boundsX,boundsRight-width);var maxY=Math.max(boundsY,boundsBottom-height);var restrictedX=clamp$1(x,boundsX,maxX);var restrictedY=clamp$1(y,boundsY,maxY);var restrictedWidth=Math.min(restrictedX+width,boundsRight)-restrictedX;var restrictedHeight=Math.min(restrictedY+height,boundsBottom)-restrictedY;return bounds(restrictedX,restrictedY,restrictedWidth,restrictedHeight);};var calcMaxSizes=function calcMaxSizes(direction,box,bounds){var upAvailable=constant$1(box.bottom-bounds.y);var downAvailable=constant$1(bounds.bottom-box.y);var maxHeight=cataVertical(direction,downAvailable,downAvailable,upAvailable);var westAvailable=constant$1(box.right-bounds.x);var eastAvailable=constant$1(bounds.right-box.x);var maxWidth=cataHorizontal(direction,eastAvailable,eastAvailable,westAvailable);return{maxWidth:maxWidth,maxHeight:maxHeight};};var attempt=function attempt(candidate,width,height,bounds$1){var bubble=candidate.bubble;var bubbleOffset=bubble.offset;var adjustedBounds=adjustBounds(bounds$1,candidate.restriction,bubbleOffset);var newX=candidate.x+bubbleOffset.left;var newY=candidate.y+bubbleOffset.top;var box=bounds(newX,newY,width,height);var _a=determinePosition(box,adjustedBounds),originInBounds=_a.originInBounds,sizeInBounds=_a.sizeInBounds,visibleW=_a.visibleW,visibleH=_a.visibleH;var fits=originInBounds&&sizeInBounds;var fittedBox=fits?box:calcReposition(box,adjustedBounds);var isPartlyVisible=fittedBox.width>0&&fittedBox.height>0;var _b=calcMaxSizes(candidate.direction,fittedBox,bounds$1),maxWidth=_b.maxWidth,maxHeight=_b.maxHeight;var reposition={rect:fittedBox,maxHeight:maxHeight,maxWidth:maxWidth,direction:candidate.direction,placement:candidate.placement,classes:{on:bubble.classesOn,off:bubble.classesOff},layout:candidate.label,testY:newY};return fits||candidate.alwaysFit?adt$8.fit(reposition):adt$8.nofit(reposition,visibleW,visibleH,isPartlyVisible);};var attempts=function attempts(element,candidates,anchorBox,elementBox,bubbles,bounds){var panelWidth=elementBox.width;var panelHeight=elementBox.height;var attemptBestFit=function attemptBestFit(layout,reposition,visibleW,visibleH,isVisible){var next=layout(anchorBox,elementBox,bubbles,element,bounds);var attemptLayout=attempt(next,panelWidth,panelHeight,bounds);return attemptLayout.fold(constant$1(attemptLayout),function(newReposition,newVisibleW,newVisibleH,newIsVisible){var improved=isVisible===newIsVisible?newVisibleH>visibleH||newVisibleW>visibleW:!isVisible&&newIsVisible;return improved?attemptLayout:adt$8.nofit(reposition,visibleW,visibleH,isVisible);});};var abc=foldl(candidates,function(b,a){var bestNext=curry(attemptBestFit,a);return b.fold(constant$1(b),bestNext);},adt$8.nofit({rect:anchorBox,maxHeight:elementBox.height,maxWidth:elementBox.width,direction:southeast$3(),placement:'southeast',classes:{on:[],off:[]},layout:'none',testY:anchorBox.y},-1,-1,false));return abc.fold(identity$1,identity$1);};var singleton=function singleton(doRevoke){var subject=Cell(Optional.none());var revoke=function revoke(){return subject.get().each(doRevoke);};var clear=function clear(){revoke();subject.set(Optional.none());};var isSet=function isSet(){return subject.get().isSome();};var get=function get(){return subject.get();};var set=function set(s){revoke();subject.set(Optional.some(s));};return{clear:clear,isSet:isSet,get:get,set:set};};var destroyable=function destroyable(){return singleton(function(s){return s.destroy();});};var unbindable=function unbindable(){return singleton(function(s){return s.unbind();});};var api$1=function api$1(){var subject=destroyable();var run=function run(f){return subject.get().each(f);};return _assign(_assign({},subject),{run:run});};var value$1=function value$1(){var subject=singleton(noop);var on=function on(f){return subject.get().each(f);};return _assign(_assign({},subject),{on:on});};var filter=always;var bind=function bind(element,event,handler){return bind$2(element,event,filter,handler);};var capture=function capture(element,event,handler){return capture$1(element,event,filter,handler);};var fromRawEvent=fromRawEvent$1;var properties=['top','bottom','right','left'];var timerAttr='data-alloy-transition-timer';var isTransitioning$1=function isTransitioning$1(element,transition){return hasAll(element,transition.classes);};var shouldApplyTransitionCss=function shouldApplyTransitionCss(transition,decision,lastPlacement){return lastPlacement.exists(function(placer){var mode=transition.mode;return mode==='all'?true:placer[mode]!==decision[mode];});};var hasChanges=function hasChanges(position,intermediate){var round=function round(value){return parseFloat(value).toFixed(3);};return find$4(intermediate,function(value,key){var newValue=position[key].map(round);var val=value.map(round);return!equals(newValue,val);}).isSome();};var getTransitionDuration=function getTransitionDuration(element){var get=function get(name){var style=get$c(element,name);var times=isString(style)?style.split(/\\s*,\\s*/):[];return filter$2(times,isNotEmpty);};var parse=function parse(value){if(isString(value)&&/^[\\d.]+/.test(value)){var num=parseFloat(value);return endsWith(value,'ms')?num:num*1000;}else{return 0;}};var delay=get('transition-delay');var duration=get('transition-duration');return foldl(duration,function(acc,dur,i){var time=parse(delay[i])+parse(dur);return Math.max(acc,time);},0);};var setupTransitionListeners=function setupTransitionListeners(element,transition){var transitionEnd=unbindable();var transitionCancel=unbindable();var timer;var isSourceTransition=function isSourceTransition(e){var _a;var pseudoElement=(_a=e.raw.pseudoElement)!==null&&_a!==void 0?_a:'';return eq(e.target,element)&&isEmpty(pseudoElement)&&contains$2(properties,e.raw.propertyName);};var transitionDone=function transitionDone(e){if(isNullable(e)||isSourceTransition(e)){transitionEnd.clear();transitionCancel.clear();var type=e===null||e===void 0?void 0:e.raw.type;if(isNullable(type)||type===transitionend()){clearTimeout(timer);remove$7(element,timerAttr);remove$1(element,transition.classes);}}};var transitionStarted=function transitionStarted(){transitionEnd.set(bind(element,transitionend(),transitionDone));transitionCancel.set(bind(element,transitioncancel(),transitionDone));};if('ontransitionstart'in element.dom){var transitionStart_1=bind(element,transitionstart(),function(e){if(isSourceTransition(e)){transitionStart_1.unbind();transitionStarted();}});}else{transitionStarted();}var duration=getTransitionDuration(element);requestAnimationFrame(function(){timer=setTimeout(transitionDone,duration+17);set$8(element,timerAttr,timer);});};var startTransitioning=function startTransitioning(element,transition){add$1(element,transition.classes);getOpt(element,timerAttr).each(function(timerId){clearTimeout(parseInt(timerId,10));remove$7(element,timerAttr);});setupTransitionListeners(element,transition);};var applyTransitionCss=function applyTransitionCss(element,origin,position,transition,decision,lastPlacement){var shouldTransition=shouldApplyTransitionCss(transition,decision,lastPlacement);if(shouldTransition||isTransitioning$1(element,transition)){set$7(element,'position',position.position);var rect=toBox(origin,element);var intermediatePosition_1=reposition(origin,_assign(_assign({},decision),{rect:rect}));var intermediateCssOptions=mapToObject(properties,function(prop){return intermediatePosition_1[prop];});if(hasChanges(position,intermediateCssOptions)){setOptions(element,intermediateCssOptions);if(shouldTransition){startTransitioning(element,transition);}reflow(element);}}else{remove$1(element,transition.classes);}};var elementSize=function elementSize(p){return{width:getOuter$1(p),height:getOuter$2(p)};};var layout=function layout(anchorBox,element,bubbles,options){remove$6(element,'max-height');remove$6(element,'max-width');var elementBox=elementSize(element);return attempts(element,options.preference,anchorBox,elementBox,bubbles,options.bounds);};var setClasses=function setClasses(element,decision){var classInfo=decision.classes;remove$1(element,classInfo.off);add$1(element,classInfo.on);};var setHeight=function setHeight(element,decision,options){var maxHeightFunction=options.maxHeightFunction;maxHeightFunction(element,decision.maxHeight);};var setWidth=function setWidth(element,decision,options){var maxWidthFunction=options.maxWidthFunction;maxWidthFunction(element,decision.maxWidth);};var position$2=function position$2(element,decision,options){var positionCss=reposition(options.origin,decision);options.transition.each(function(transition){applyTransitionCss(element,options.origin,positionCss,transition,decision,options.lastPlacement);});applyPositionCss(element,positionCss);};var setPlacement=function setPlacement(element,decision){setPlacement$1(element,decision.placement);};var setMaxHeight=function setMaxHeight(element,maxHeight){setMax$1(element,Math.floor(maxHeight));};var anchored=constant$1(function(element,available){setMaxHeight(element,available);setAll(element,{'overflow-x':'hidden','overflow-y':'auto'});});var expandable$1=constant$1(function(element,available){setMaxHeight(element,available);});var defaultOr=function defaultOr(options,key,dephault){return options[key]===undefined?dephault:options[key];};var simple=function simple(anchor,element,bubble,layouts,lastPlacement,getBounds,overrideOptions,transition){var maxHeightFunction=defaultOr(overrideOptions,'maxHeightFunction',anchored());var maxWidthFunction=defaultOr(overrideOptions,'maxWidthFunction',noop);var anchorBox=anchor.anchorBox;var origin=anchor.origin;var options={bounds:viewport(origin,getBounds),origin:origin,preference:layouts,maxHeightFunction:maxHeightFunction,maxWidthFunction:maxWidthFunction,lastPlacement:lastPlacement,transition:transition};return go(anchorBox,element,bubble,options);};var go=function go(anchorBox,element,bubble,options){var decision=layout(anchorBox,element,bubble,options);position$2(element,decision,options);setPlacement(element,decision);setClasses(element,decision);setHeight(element,decision,options);setWidth(element,decision,options);return{layout:decision.layout,placement:decision.placement};};var allAlignments=['valignCentre','alignLeft','alignRight','alignCentre','top','bottom','left','right','inset'];var nu$5=function nu$5(xOffset,yOffset,classes,insetModifier){if(insetModifier===void 0){insetModifier=1;}var insetXOffset=xOffset*insetModifier;var insetYOffset=yOffset*insetModifier;var getClasses=function getClasses(prop){return get$e(classes,prop).getOr([]);};var make=function make(xDelta,yDelta,alignmentsOn){var alignmentsOff=difference(allAlignments,alignmentsOn);return{offset:SugarPosition(xDelta,yDelta),classesOn:bind$3(alignmentsOn,getClasses),classesOff:bind$3(alignmentsOff,getClasses)};};return{southeast:function southeast(){return make(-xOffset,yOffset,['top','alignLeft']);},southwest:function southwest(){return make(xOffset,yOffset,['top','alignRight']);},south:function south(){return make(-xOffset/2,yOffset,['top','alignCentre']);},northeast:function northeast(){return make(-xOffset,-yOffset,['bottom','alignLeft']);},northwest:function northwest(){return make(xOffset,-yOffset,['bottom','alignRight']);},north:function north(){return make(-xOffset/2,-yOffset,['bottom','alignCentre']);},east:function east(){return make(xOffset,-yOffset/2,['valignCentre','left']);},west:function west(){return make(-xOffset,-yOffset/2,['valignCentre','right']);},insetNortheast:function insetNortheast(){return make(insetXOffset,insetYOffset,['top','alignLeft','inset']);},insetNorthwest:function insetNorthwest(){return make(-insetXOffset,insetYOffset,['top','alignRight','inset']);},insetNorth:function insetNorth(){return make(-insetXOffset/2,insetYOffset,['top','alignCentre','inset']);},insetSoutheast:function insetSoutheast(){return make(insetXOffset,-insetYOffset,['bottom','alignLeft','inset']);},insetSouthwest:function insetSouthwest(){return make(-insetXOffset,-insetYOffset,['bottom','alignRight','inset']);},insetSouth:function insetSouth(){return make(-insetXOffset/2,-insetYOffset,['bottom','alignCentre','inset']);},insetEast:function insetEast(){return make(-insetXOffset,-insetYOffset/2,['valignCentre','right','inset']);},insetWest:function insetWest(){return make(insetXOffset,-insetYOffset/2,['valignCentre','left','inset']);}};};var fallback=function fallback(){return nu$5(0,0,{});};var nu$4=identity$1;var onDirection=function onDirection(isLtr,isRtl){return function(element){return getDirection(element)==='rtl'?isRtl:isLtr;};};var getDirection=function getDirection(element){return get$c(element,'direction')==='rtl'?'rtl':'ltr';};var AttributeValue;(function(AttributeValue){AttributeValue['TopToBottom']='toptobottom';AttributeValue['BottomToTop']='bottomtotop';})(AttributeValue||(AttributeValue={}));var Attribute='data-alloy-vertical-dir';var isBottomToTopDir=function isBottomToTopDir(el){return closest$2(el,function(current){return isElement$2(current)&&get$d(current,'data-alloy-vertical-dir')===AttributeValue.BottomToTop;});};var schema$y=function schema$y(){return optionObjOf('layouts',[required$1('onLtr'),required$1('onRtl'),option('onBottomLtr'),option('onBottomRtl')]);};var get$4=function get$4(elem,info,defaultLtr,defaultRtl,defaultBottomLtr,defaultBottomRtl,dirElement){var isBottomToTop=dirElement.map(isBottomToTopDir).getOr(false);var customLtr=info.layouts.map(function(ls){return ls.onLtr(elem);});var customRtl=info.layouts.map(function(ls){return ls.onRtl(elem);});var ltr=isBottomToTop?info.layouts.bind(function(ls){return ls.onBottomLtr.map(function(f){return f(elem);});}).or(customLtr).getOr(defaultBottomLtr):customLtr.getOr(defaultLtr);var rtl=isBottomToTop?info.layouts.bind(function(ls){return ls.onBottomRtl.map(function(f){return f(elem);});}).or(customRtl).getOr(defaultBottomRtl):customRtl.getOr(defaultRtl);var f=onDirection(ltr,rtl);return f(elem);};var placement$4=function placement$4(component,anchorInfo,origin){var hotspot=anchorInfo.hotspot;var anchorBox=toBox(origin,hotspot.element);var layouts=get$4(component.element,anchorInfo,belowOrAbove(),belowOrAboveRtl(),aboveOrBelow(),aboveOrBelowRtl(),Optional.some(anchorInfo.hotspot.element));return Optional.some(nu$4({anchorBox:anchorBox,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts:layouts,placer:Optional.none()}));};var HotspotAnchor=[required$1('hotspot'),option('bubble'),defaulted('overrides',{}),schema$y(),output$1('placement',placement$4)];var placement$3=function placement$3(component,anchorInfo,origin){var pos=translate$2(origin,anchorInfo.x,anchorInfo.y);var anchorBox=bounds(pos.left,pos.top,anchorInfo.width,anchorInfo.height);var layouts=get$4(component.element,anchorInfo,all$1(),allRtl$1(),all$1(),allRtl$1(),Optional.none());return Optional.some(nu$4({anchorBox:anchorBox,bubble:anchorInfo.bubble,overrides:anchorInfo.overrides,layouts:layouts,placer:Optional.none()}));};var MakeshiftAnchor=[required$1('x'),required$1('y'),defaulted('height',0),defaulted('width',0),defaulted('bubble',fallback()),defaulted('overrides',{}),schema$y(),output$1('placement',placement$3)];var adt$7=Adt.generate([{screen:['point']},{absolute:['point','scrollLeft','scrollTop']}]);var toFixed=function toFixed(pos){return pos.fold(identity$1,function(point,scrollLeft,scrollTop){return point.translate(-scrollLeft,-scrollTop);});};var toAbsolute=function toAbsolute(pos){return pos.fold(identity$1,identity$1);};var sum=function sum(points){return foldl(points,function(b,a){return b.translate(a.left,a.top);},SugarPosition(0,0));};var sumAsFixed=function sumAsFixed(positions){var points=map$2(positions,toFixed);return sum(points);};var sumAsAbsolute=function sumAsAbsolute(positions){var points=map$2(positions,toAbsolute);return sum(points);};var screen=adt$7.screen;var absolute$1=adt$7.absolute;var getOffset=function getOffset(component,origin,anchorInfo){var win=defaultView(anchorInfo.root).dom;var hasSameOwner=function hasSameOwner(frame){var frameOwner=owner$4(frame);var compOwner=owner$4(component.element);return eq(frameOwner,compOwner);};return Optional.from(win.frameElement).map(SugarElement.fromDom).filter(hasSameOwner).map(absolute$3);};var getRootPoint=function getRootPoint(component,origin,anchorInfo){var doc=owner$4(component.element);var outerScroll=get$9(doc);var offset=getOffset(component,origin,anchorInfo).getOr(outerScroll);return absolute$1(offset,outerScroll.left,outerScroll.top);};var getBox=function getBox(left,top,width,height){var point=screen(SugarPosition(left,top));return Optional.some(pointed(point,width,height));};var calcNewAnchor=function calcNewAnchor(optBox,rootPoint,anchorInfo,origin,elem){return optBox.map(function(box){var points=[rootPoint,box.point];var topLeft=cata$1(origin,function(){return sumAsAbsolute(points);},function(){return sumAsAbsolute(points);},function(){return sumAsFixed(points);});var anchorBox=rect(topLeft.left,topLeft.top,box.width,box.height);var layoutsLtr=anchorInfo.showAbove?aboveOrBelow():belowOrAbove();var layoutsRtl=anchorInfo.showAbove?aboveOrBelowRtl():belowOrAboveRtl();var layouts=get$4(elem,anchorInfo,layoutsLtr,layoutsRtl,layoutsLtr,layoutsRtl,Optional.none());return nu$4({anchorBox:anchorBox,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts:layouts,placer:Optional.none()});});};var placement$2=function placement$2(component,anchorInfo,origin){var rootPoint=getRootPoint(component,origin,anchorInfo);return anchorInfo.node.filter(_inBody).bind(function(target){var rect=target.dom.getBoundingClientRect();var nodeBox=getBox(rect.left,rect.top,rect.width,rect.height);var elem=anchorInfo.node.getOr(component.element);return calcNewAnchor(nodeBox,rootPoint,anchorInfo,origin,elem);});};var NodeAnchor=[required$1('node'),required$1('root'),option('bubble'),schema$y(),defaulted('overrides',{}),defaulted('showAbove',false),output$1('placement',placement$2)];var zeroWidth='\\uFEFF';var nbsp='\\xA0';var create$7=function create$7(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset};};var SimRange={create:create$7};var adt$6=Adt.generate([{before:['element']},{on:['element','offset']},{after:['element']}]);var cata=function cata(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter);};var getStart$1=function getStart$1(situ){return situ.fold(identity$1,identity$1,identity$1);};var before=adt$6.before;var on$1=adt$6.on;var after$1=adt$6.after;var Situ={before:before,on:on$1,after:after$1,cata:cata,getStart:getStart$1};var adt$5=Adt.generate([{domRange:['rng']},{relative:['startSitu','finishSitu']},{exact:['start','soffset','finish','foffset']}]);var exactFromRange=function exactFromRange(simRange){return adt$5.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset);};var getStart=function getStart(selection){return selection.match({domRange:function domRange(rng){return SugarElement.fromDom(rng.startContainer);},relative:function relative(startSitu,_finishSitu){return Situ.getStart(startSitu);},exact:function exact(start,_soffset,_finish,_foffset){return start;}});};var domRange=adt$5.domRange;var relative=adt$5.relative;var exact=adt$5.exact;var getWin=function getWin(selection){var start=getStart(selection);return defaultView(start);};var range$1=SimRange.create;var SimSelection={domRange:domRange,relative:relative,exact:exact,exactFromRange:exactFromRange,getWin:getWin,range:range$1};var setStart=function setStart(rng,situ){situ.fold(function(e){rng.setStartBefore(e.dom);},function(e,o){rng.setStart(e.dom,o);},function(e){rng.setStartAfter(e.dom);});};var setFinish=function setFinish(rng,situ){situ.fold(function(e){rng.setEndBefore(e.dom);},function(e,o){rng.setEnd(e.dom,o);},function(e){rng.setEndAfter(e.dom);});};var relativeToNative=function relativeToNative(win,startSitu,finishSitu){var range=win.document.createRange();setStart(range,startSitu);setFinish(range,finishSitu);return range;};var exactToNative=function exactToNative(win,start,soffset,finish,foffset){var rng=win.document.createRange();rng.setStart(start.dom,soffset);rng.setEnd(finish.dom,foffset);return rng;};var toRect=function toRect(rect){return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:rect.width,height:rect.height};};var getFirstRect$1=function getFirstRect$1(rng){var rects=rng.getClientRects();var rect=rects.length>0?rects[0]:rng.getBoundingClientRect();return rect.width>0||rect.height>0?Optional.some(rect).map(toRect):Optional.none();};var getBounds$2=function getBounds$2(rng){var rect=rng.getBoundingClientRect();return rect.width>0||rect.height>0?Optional.some(rect).map(toRect):Optional.none();};var adt$4=Adt.generate([{ltr:['start','soffset','finish','foffset']},{rtl:['start','soffset','finish','foffset']}]);var fromRange=function fromRange(win,type,range){return type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset);};var getRanges=function getRanges(win,selection){return selection.match({domRange:function domRange(rng){return{ltr:constant$1(rng),rtl:Optional.none};},relative:function relative(startSitu,finishSitu){return{ltr:cached(function(){return relativeToNative(win,startSitu,finishSitu);}),rtl:cached(function(){return Optional.some(relativeToNative(win,finishSitu,startSitu));})};},exact:function exact(start,soffset,finish,foffset){return{ltr:cached(function(){return exactToNative(win,start,soffset,finish,foffset);}),rtl:cached(function(){return Optional.some(exactToNative(win,finish,foffset,start,soffset));})};}});};var doDiagnose=function doDiagnose(win,ranges){var rng=ranges.ltr();if(rng.collapsed){var reversed=ranges.rtl().filter(function(rev){return rev.collapsed===false;});return reversed.map(function(rev){return adt$4.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset);}).getOrThunk(function(){return fromRange(win,adt$4.ltr,rng);});}else{return fromRange(win,adt$4.ltr,rng);}};var diagnose=function diagnose(win,selection){var ranges=getRanges(win,selection);return doDiagnose(win,ranges);};var asLtrRange=function asLtrRange(win,selection){var diagnosis=diagnose(win,selection);return diagnosis.match({ltr:function ltr(start,soffset,finish,foffset){var rng=win.document.createRange();rng.setStart(start.dom,soffset);rng.setEnd(finish.dom,foffset);return rng;},rtl:function rtl(start,soffset,finish,foffset){var rng=win.document.createRange();rng.setStart(finish.dom,foffset);rng.setEnd(start.dom,soffset);return rng;}});};adt$4.ltr;adt$4.rtl;var NodeValue=function NodeValue(is,name){var get=function get(element){if(!is(element)){throw new Error('Can only get '+name+' value of a '+name+' node');}return getOption(element).getOr('');};var getOption=function getOption(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none();};var set=function set(element,value){if(!is(element)){throw new Error('Can only set raw '+name+' value of a '+name+' node');}element.dom.nodeValue=value;};return{get:get,getOption:getOption,set:set};};var api=NodeValue(isText$1,'text');var get$3=function get$3(element){return api.get(element);};var getOption=function getOption(element){return api.getOption(element);};var getEnd=function getEnd(element){return name$2(element)==='img'?1:getOption(element).fold(function(){return children(element).length;},function(v){return v.length;});};var isTextNodeWithCursorPosition=function isTextNodeWithCursorPosition(el){return getOption(el).filter(function(text){return text.trim().length!==0||text.indexOf(nbsp)>-1;}).isSome();};var elementsWithCursorPosition=['img','br'];var isCursorPosition=function isCursorPosition(elem){var hasCursorPosition=isTextNodeWithCursorPosition(elem);return hasCursorPosition||contains$2(elementsWithCursorPosition,name$2(elem));};var last$1=function last$1(element){return descendantRtl(element,isCursorPosition);};var descendantRtl=function descendantRtl(scope,predicate){var _descend2=function descend(element){var children$1=children(element);for(var i=children$1.length-1;i>=0;i--){var child=children$1[i];if(predicate(child)){return Optional.some(child);}var res=_descend2(child);if(res.isSome()){return res;}}return Optional.none();};return _descend2(scope);};var descendants=function descendants(scope,selector){return all$3(selector,scope);};var makeRange=function makeRange(start,soffset,finish,foffset){var doc=owner$4(start);var rng=doc.dom.createRange();rng.setStart(start.dom,soffset);rng.setEnd(finish.dom,foffset);return rng;};var after=function after(start,soffset,finish,foffset){var r=makeRange(start,soffset,finish,foffset);var same=eq(start,finish)&&soffset===foffset;return r.collapsed&&!same;};var getNativeSelection=function getNativeSelection(win){return Optional.from(win.getSelection());};var readRange=function readRange(selection){if(selection.rangeCount>0){var firstRng=selection.getRangeAt(0);var lastRng=selection.getRangeAt(selection.rangeCount-1);return Optional.some(SimRange.create(SugarElement.fromDom(firstRng.startContainer),firstRng.startOffset,SugarElement.fromDom(lastRng.endContainer),lastRng.endOffset));}else{return Optional.none();}};var doGetExact=function doGetExact(selection){if(selection.anchorNode===null||selection.focusNode===null){return readRange(selection);}else{var anchor=SugarElement.fromDom(selection.anchorNode);var focus_1=SugarElement.fromDom(selection.focusNode);return after(anchor,selection.anchorOffset,focus_1,selection.focusOffset)?Optional.some(SimRange.create(anchor,selection.anchorOffset,focus_1,selection.focusOffset)):readRange(selection);}};var getExact=function getExact(win){return getNativeSelection(win).filter(function(sel){return sel.rangeCount>0;}).bind(doGetExact);};var getFirstRect=function getFirstRect(win,selection){var rng=asLtrRange(win,selection);return getFirstRect$1(rng);};var getBounds$1=function getBounds$1(win,selection){var rng=asLtrRange(win,selection);return getBounds$2(rng);};var point$1=function point$1(element,offset){return{element:element,offset:offset};};var descendOnce$1=function descendOnce$1(element,offset){var children$1=children(element);if(children$1.length===0){return point$1(element,offset);}else if(offset<children$1.length){return point$1(children$1[offset],0);}else{var last=children$1[children$1.length-1];var len=isText$1(last)?get$3(last).length:children(last).length;return point$1(last,len);}};var descendOnce=function descendOnce(element,offset){return isText$1(element)?point$1(element,offset):descendOnce$1(element,offset);};var getAnchorSelection=function getAnchorSelection(win,anchorInfo){var getSelection=anchorInfo.getSelection.getOrThunk(function(){return function(){return getExact(win);};});return getSelection().map(function(sel){var modStart=descendOnce(sel.start,sel.soffset);var modFinish=descendOnce(sel.finish,sel.foffset);return SimSelection.range(modStart.element,modStart.offset,modFinish.element,modFinish.offset);});};var placement$1=function placement$1(component,anchorInfo,origin){var win=defaultView(anchorInfo.root).dom;var rootPoint=getRootPoint(component,origin,anchorInfo);var selectionBox=getAnchorSelection(win,anchorInfo).bind(function(sel){var optRect=getBounds$1(win,SimSelection.exactFromRange(sel)).orThunk(function(){var x=SugarElement.fromText(zeroWidth);before$2(sel.start,x);var rect=getFirstRect(win,SimSelection.exact(x,0,x,1));remove$5(x);return rect;});return optRect.bind(function(rawRect){return getBox(rawRect.left,rawRect.top,rawRect.width,rawRect.height);});});var targetElement=getAnchorSelection(win,anchorInfo).bind(function(sel){return isElement$2(sel.start)?Optional.some(sel.start):parentNode(sel.start);});var elem=targetElement.getOr(component.element);return calcNewAnchor(selectionBox,rootPoint,anchorInfo,origin,elem);};var SelectionAnchor=[option('getSelection'),required$1('root'),option('bubble'),schema$y(),defaulted('overrides',{}),defaulted('showAbove',false),output$1('placement',placement$1)];var labelPrefix$1='link-layout';var eastX=function eastX(anchor){return anchor.x+anchor.width;};var westX=function westX(anchor,element){return anchor.x-element.width;};var northY$1=function northY$1(anchor,element){return anchor.y-element.height+anchor.height;};var southY$1=function southY$1(anchor){return anchor.y;};var southeast$1=function southeast$1(anchor,element,bubbles){return nu$6(eastX(anchor),southY$1(anchor),bubbles.southeast(),southeast$3(),'southeast',boundsRestriction(anchor,{left:0,top:2}),labelPrefix$1);};var southwest$1=function southwest$1(anchor,element,bubbles){return nu$6(westX(anchor,element),southY$1(anchor),bubbles.southwest(),southwest$3(),'southwest',boundsRestriction(anchor,{right:1,top:2}),labelPrefix$1);};var northeast$1=function northeast$1(anchor,element,bubbles){return nu$6(eastX(anchor),northY$1(anchor,element),bubbles.northeast(),northeast$3(),'northeast',boundsRestriction(anchor,{left:0,bottom:3}),labelPrefix$1);};var northwest$1=function northwest$1(anchor,element,bubbles){return nu$6(westX(anchor,element),northY$1(anchor,element),bubbles.northwest(),northwest$3(),'northwest',boundsRestriction(anchor,{right:1,bottom:3}),labelPrefix$1);};var all=function all(){return[southeast$1,southwest$1,northeast$1,northwest$1];};var allRtl=function allRtl(){return[southwest$1,southeast$1,northwest$1,northeast$1];};var placement=function placement(component,submenuInfo,origin){var anchorBox=toBox(origin,submenuInfo.item.element);var layouts=get$4(component.element,submenuInfo,all(),allRtl(),all(),allRtl(),Optional.none());return Optional.some(nu$4({anchorBox:anchorBox,bubble:fallback(),overrides:submenuInfo.overrides,layouts:layouts,placer:Optional.none()}));};var SubmenuAnchor=[required$1('item'),schema$y(),defaulted('overrides',{}),output$1('placement',placement)];var AnchorSchema=choose$1('type',{selection:SelectionAnchor,node:NodeAnchor,hotspot:HotspotAnchor,submenu:SubmenuAnchor,makeshift:MakeshiftAnchor});var TransitionSchema=[requiredArrayOf('classes',string),defaultedStringEnum('mode','all',['all','layout','placement'])];var PositionSchema=[defaulted('useFixed',never),option('getBounds')];var PlacementSchema=[requiredOf('anchor',AnchorSchema),optionObjOf('transition',TransitionSchema)];var getFixedOrigin=function getFixedOrigin(){var html=document.documentElement;return fixed$1(0,0,html.clientWidth,html.clientHeight);};var getRelativeOrigin=function getRelativeOrigin(component){var position=absolute$3(component.element);var bounds=component.element.dom.getBoundingClientRect();return relative$1(position.left,position.top,bounds.width,bounds.height);};var place=function place(component,origin,anchoring,getBounds,placee,lastPlace,transition){var anchor=box(anchoring.anchorBox,origin);return simple(anchor,placee.element,anchoring.bubble,anchoring.layouts,lastPlace,getBounds,anchoring.overrides,transition);};var position$1=function position$1(component,posConfig,posState,placee,placementSpec){positionWithin(component,posConfig,posState,placee,placementSpec,Optional.none());};var positionWithin=function positionWithin(component,posConfig,posState,placee,placementSpec,boxElement){var boundsBox=boxElement.map(box$1);return positionWithinBounds(component,posConfig,posState,placee,placementSpec,boundsBox);};var positionWithinBounds=function positionWithinBounds(component,posConfig,posState,placee,placementSpec,bounds){var placeeDetail=asRawOrDie$1('placement.info',objOf(PlacementSchema),placementSpec);var anchorage=placeeDetail.anchor;var element=placee.element;var placeeState=posState.get(placee.uid);preserve$1(function(){set$7(element,'position','fixed');var oldVisibility=getRaw(element,'visibility');set$7(element,'visibility','hidden');var origin=posConfig.useFixed()?getFixedOrigin():getRelativeOrigin(component);var placer=anchorage.placement;var getBounds=bounds.map(constant$1).or(posConfig.getBounds);placer(component,anchorage,origin).each(function(anchoring){var doPlace=anchoring.placer.getOr(place);var newState=doPlace(component,origin,anchoring,getBounds,placee,placeeState,placeeDetail.transition);posState.set(placee.uid,newState);});oldVisibility.fold(function(){remove$6(element,'visibility');},function(vis){set$7(element,'visibility',vis);});if(getRaw(element,'left').isNone()&&getRaw(element,'top').isNone()&&getRaw(element,'right').isNone()&&getRaw(element,'bottom').isNone()&&is$1(getRaw(element,'position'),'fixed')){remove$6(element,'position');}},element);};var getMode=function getMode(component,pConfig,_pState){return pConfig.useFixed()?'fixed':'absolute';};var reset$1=function reset$1(component,pConfig,posState,placee){var element=placee.element;each$1(['position','left','right','top','bottom'],function(prop){return remove$6(element,prop);});reset$2(element);posState.clear(placee.uid);};var PositionApis=/*#__PURE__*/Object.freeze({__proto__:null,position:position$1,positionWithin:positionWithin,positionWithinBounds:positionWithinBounds,getMode:getMode,reset:reset$1});var init$g=function init$g(){var state={};var set=function set(id,data){state[id]=data;};var get=function get(id){return get$e(state,id);};var clear=function clear(id){if(isNonNullable(id)){delete state[id];}else{state={};}};return nu$8({readState:function readState(){return state;},clear:clear,set:set,get:get});};var PositioningState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$g});var Positioning=create$8({fields:PositionSchema,name:'positioning',active:ActivePosition,apis:PositionApis,state:PositioningState});var _fireDetaching=function fireDetaching(component){emit(component,detachedFromDom());var children=component.components();each$1(children,_fireDetaching);};var _fireAttaching=function fireAttaching(component){var children=component.components();each$1(children,_fireAttaching);emit(component,attachedToDom());};var attach$1=function attach$1(parent,child){append$2(parent.element,child.element);};var detachChildren$1=function detachChildren$1(component){each$1(component.components(),function(childComp){return remove$5(childComp.element);});empty(component.element);component.syncComponents();};var replaceChildren=function replaceChildren(component,newChildren){var subs=component.components();detachChildren$1(component);var deleted=difference(subs,newChildren);each$1(deleted,function(comp){_fireDetaching(comp);component.getSystem().removeFromWorld(comp);});each$1(newChildren,function(childComp){if(!childComp.getSystem().isConnected()){component.getSystem().addToWorld(childComp);attach$1(component,childComp);if(_inBody(component.element)){_fireAttaching(childComp);}}else{attach$1(component,childComp);}component.syncComponents();});};var attach=function attach(parent,child){attachWith(parent,child,append$2);};var attachWith=function attachWith(parent,child,insertion){parent.getSystem().addToWorld(child);insertion(parent.element,child.element);if(_inBody(parent.element)){_fireAttaching(child);}parent.syncComponents();};var doDetach=function doDetach(component){_fireDetaching(component);remove$5(component.element);component.getSystem().removeFromWorld(component);};var detach=function detach(component){var parent$1=parent(component.element).bind(function(p){return component.getSystem().getByDom(p).toOptional();});doDetach(component);parent$1.each(function(p){p.syncComponents();});};var detachChildren=function detachChildren(component){var subs=component.components();each$1(subs,doDetach);empty(component.element);component.syncComponents();};var attachSystem=function attachSystem(element,guiSystem){attachSystemWith(element,guiSystem,append$2);};var attachSystemAfter=function attachSystemAfter(element,guiSystem){attachSystemWith(element,guiSystem,after$2);};var attachSystemWith=function attachSystemWith(element,guiSystem,inserter){inserter(element,guiSystem.element);var children$1=children(guiSystem.element);each$1(children$1,function(child){guiSystem.getByDom(child).each(_fireAttaching);});};var detachSystem=function detachSystem(guiSystem){var children$1=children(guiSystem.element);each$1(children$1,function(child){guiSystem.getByDom(child).each(_fireDetaching);});remove$5(guiSystem.element);};var rebuild=function rebuild(sandbox,sConfig,sState,data){sState.get().each(function(_data){detachChildren(sandbox);});var point=sConfig.getAttachPoint(sandbox);attach(point,sandbox);var built=sandbox.getSystem().build(data);attach(sandbox,built);sState.set(built);return built;};var open$1=function open$1(sandbox,sConfig,sState,data){var newState=rebuild(sandbox,sConfig,sState,data);sConfig.onOpen(sandbox,newState);return newState;};var setContent=function setContent(sandbox,sConfig,sState,data){return sState.get().map(function(){return rebuild(sandbox,sConfig,sState,data);});};var openWhileCloaked=function openWhileCloaked(sandbox,sConfig,sState,data,transaction){cloak(sandbox,sConfig);open$1(sandbox,sConfig,sState,data);transaction();decloak(sandbox,sConfig);};var close$1=function close$1(sandbox,sConfig,sState){sState.get().each(function(data){detachChildren(sandbox);detach(sandbox);sConfig.onClose(sandbox,data);sState.clear();});};var isOpen$1=function isOpen$1(_sandbox,_sConfig,sState){return sState.isOpen();};var isPartOf=function isPartOf(sandbox,sConfig,sState,queryElem){return isOpen$1(sandbox,sConfig,sState)&&sState.get().exists(function(data){return sConfig.isPartOf(sandbox,data,queryElem);});};var getState$2=function getState$2(_sandbox,_sConfig,sState){return sState.get();};var store=function store(sandbox,cssKey,attr,newValue){getRaw(sandbox.element,cssKey).fold(function(){remove$7(sandbox.element,attr);},function(v){set$8(sandbox.element,attr,v);});set$7(sandbox.element,cssKey,newValue);};var restore=function restore(sandbox,cssKey,attr){getOpt(sandbox.element,attr).fold(function(){return remove$6(sandbox.element,cssKey);},function(oldValue){return set$7(sandbox.element,cssKey,oldValue);});};var cloak=function cloak(sandbox,sConfig,_sState){var sink=sConfig.getAttachPoint(sandbox);set$7(sandbox.element,'position',Positioning.getMode(sink));store(sandbox,'visibility',sConfig.cloakVisibilityAttr,'hidden');};var hasPosition=function hasPosition(element){return exists(['top','left','right','bottom'],function(pos){return getRaw(element,pos).isSome();});};var decloak=function decloak(sandbox,sConfig,_sState){if(!hasPosition(sandbox.element)){remove$6(sandbox.element,'position');}restore(sandbox,'visibility',sConfig.cloakVisibilityAttr);};var SandboxApis=/*#__PURE__*/Object.freeze({__proto__:null,cloak:cloak,decloak:decloak,open:open$1,openWhileCloaked:openWhileCloaked,close:close$1,isOpen:isOpen$1,isPartOf:isPartOf,getState:getState$2,setContent:setContent});var events$g=function events$g(sandboxConfig,sandboxState){return derive$2([run$1(sandboxClose(),function(sandbox,_simulatedEvent){close$1(sandbox,sandboxConfig,sandboxState);})]);};var ActiveSandbox=/*#__PURE__*/Object.freeze({__proto__:null,events:events$g});var SandboxSchema=[onHandler('onOpen'),onHandler('onClose'),required$1('isPartOf'),required$1('getAttachPoint'),defaulted('cloakVisibilityAttr','data-precloak-visibility')];var init$f=function init$f(){var contents=value$1();var readState=constant$1('not-implemented');return nu$8({readState:readState,isOpen:contents.isSet,clear:contents.clear,set:contents.set,get:contents.get});};var SandboxState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$f});var Sandboxing=create$8({fields:SandboxSchema,name:'sandboxing',active:ActiveSandbox,apis:SandboxApis,state:SandboxState});var dismissPopups=constant$1('dismiss.popups');var repositionPopups=constant$1('reposition.popups');var mouseReleased=constant$1('mouse.released');var schema$x=objOfOnly([defaulted('isExtraPart',never),optionObjOf('fireEventInstead',[defaulted('event',dismissRequested())])]);var receivingChannel$1=function receivingChannel$1(rawSpec){var _a;var detail=asRawOrDie$1('Dismissal',schema$x,rawSpec);return _a={},_a[dismissPopups()]={schema:objOfOnly([required$1('target')]),onReceive:function onReceive(sandbox,data){if(Sandboxing.isOpen(sandbox)){var isPart=Sandboxing.isPartOf(sandbox,data.target)||detail.isExtraPart(sandbox,data.target);if(!isPart){detail.fireEventInstead.fold(function(){return Sandboxing.close(sandbox);},function(fe){return emit(sandbox,fe.event);});}}}},_a;};var schema$w=objOfOnly([optionObjOf('fireEventInstead',[defaulted('event',repositionRequested())]),requiredFunction('doReposition')]);var receivingChannel=function receivingChannel(rawSpec){var _a;var detail=asRawOrDie$1('Reposition',schema$w,rawSpec);return _a={},_a[repositionPopups()]={onReceive:function onReceive(sandbox){if(Sandboxing.isOpen(sandbox)){detail.fireEventInstead.fold(function(){return detail.doReposition(sandbox);},function(fe){return emit(sandbox,fe.event);});}}},_a;};var onLoad$5=function onLoad$5(component,repConfig,repState){repConfig.store.manager.onLoad(component,repConfig,repState);};var onUnload$2=function onUnload$2(component,repConfig,repState){repConfig.store.manager.onUnload(component,repConfig,repState);};var setValue$3=function setValue$3(component,repConfig,repState,data){repConfig.store.manager.setValue(component,repConfig,repState,data);};var getValue$3=function getValue$3(component,repConfig,repState){return repConfig.store.manager.getValue(component,repConfig,repState);};var getState$1=function getState$1(component,repConfig,repState){return repState;};var RepresentApis=/*#__PURE__*/Object.freeze({__proto__:null,onLoad:onLoad$5,onUnload:onUnload$2,setValue:setValue$3,getValue:getValue$3,getState:getState$1});var events$f=function events$f(repConfig,repState){var es=repConfig.resetOnDom?[runOnAttached(function(comp,_se){onLoad$5(comp,repConfig,repState);}),runOnDetached(function(comp,_se){onUnload$2(comp,repConfig,repState);})]:[loadEvent(repConfig,repState,onLoad$5)];return derive$2(es);};var ActiveRepresenting=/*#__PURE__*/Object.freeze({__proto__:null,events:events$f});var memory$1=function memory$1(){var data=Cell(null);var readState=function readState(){return{mode:'memory',value:data.get()};};var isNotSet=function isNotSet(){return data.get()===null;};var clear=function clear(){data.set(null);};return nu$8({set:data.set,get:data.get,isNotSet:isNotSet,clear:clear,readState:readState});};var manual=function manual(){var readState=noop;return nu$8({readState:readState});};var dataset=function dataset(){var dataByValue=Cell({});var dataByText=Cell({});var readState=function readState(){return{mode:'dataset',dataByValue:dataByValue.get(),dataByText:dataByText.get()};};var clear=function clear(){dataByValue.set({});dataByText.set({});};var lookup=function lookup(itemString){return get$e(dataByValue.get(),itemString).orThunk(function(){return get$e(dataByText.get(),itemString);});};var update=function update(items){var currentDataByValue=dataByValue.get();var currentDataByText=dataByText.get();var newDataByValue={};var newDataByText={};each$1(items,function(item){newDataByValue[item.value]=item;get$e(item,'meta').each(function(meta){get$e(meta,'text').each(function(text){newDataByText[text]=item;});});});dataByValue.set(_assign(_assign({},currentDataByValue),newDataByValue));dataByText.set(_assign(_assign({},currentDataByText),newDataByText));};return nu$8({readState:readState,lookup:lookup,update:update,clear:clear});};var init$e=function init$e(spec){return spec.store.manager.state(spec);};var RepresentState=/*#__PURE__*/Object.freeze({__proto__:null,memory:memory$1,dataset:dataset,manual:manual,init:init$e});var setValue$2=function setValue$2(component,repConfig,repState,data){var store=repConfig.store;repState.update([data]);store.setValue(component,data);repConfig.onSetValue(component,data);};var getValue$2=function getValue$2(component,repConfig,repState){var store=repConfig.store;var key=store.getDataKey(component);return repState.lookup(key).getOrThunk(function(){return store.getFallbackEntry(key);});};var onLoad$4=function onLoad$4(component,repConfig,repState){var store=repConfig.store;store.initialValue.each(function(data){setValue$2(component,repConfig,repState,data);});};var onUnload$1=function onUnload$1(component,repConfig,repState){repState.clear();};var DatasetStore=[option('initialValue'),required$1('getFallbackEntry'),required$1('getDataKey'),required$1('setValue'),output$1('manager',{setValue:setValue$2,getValue:getValue$2,onLoad:onLoad$4,onUnload:onUnload$1,state:dataset})];var getValue$1=function getValue$1(component,repConfig,_repState){return repConfig.store.getValue(component);};var setValue$1=function setValue$1(component,repConfig,_repState,data){repConfig.store.setValue(component,data);repConfig.onSetValue(component,data);};var onLoad$3=function onLoad$3(component,repConfig,_repState){repConfig.store.initialValue.each(function(data){repConfig.store.setValue(component,data);});};var ManualStore=[required$1('getValue'),defaulted('setValue',noop),option('initialValue'),output$1('manager',{setValue:setValue$1,getValue:getValue$1,onLoad:onLoad$3,onUnload:noop,state:NoState.init})];var setValue=function setValue(component,repConfig,repState,data){repState.set(data);repConfig.onSetValue(component,data);};var getValue=function getValue(component,repConfig,repState){return repState.get();};var onLoad$2=function onLoad$2(component,repConfig,repState){repConfig.store.initialValue.each(function(initVal){if(repState.isNotSet()){repState.set(initVal);}});};var onUnload=function onUnload(component,repConfig,repState){repState.clear();};var MemoryStore=[option('initialValue'),output$1('manager',{setValue:setValue,getValue:getValue,onLoad:onLoad$2,onUnload:onUnload,state:memory$1})];var RepresentSchema=[defaultedOf('store',{mode:'memory'},choose$1('mode',{memory:MemoryStore,manual:ManualStore,dataset:DatasetStore})),onHandler('onSetValue'),defaulted('resetOnDom',false)];var Representing=create$8({fields:RepresentSchema,name:'representing',active:ActiveRepresenting,apis:RepresentApis,extra:{setValueFrom:function setValueFrom(component,source){var value=Representing.getValue(source);Representing.setValue(component,value);}},state:RepresentState});var field=function field(name,forbidden){return defaultedObjOf(name,{},map$2(forbidden,function(f){return forbid(f.name(),'Cannot configure '+f.name()+' for '+name);}).concat([customField('dump',identity$1)]));};var get$2=function get$2(data){return data.dump;};var augment=function augment(data,original){return _assign(_assign({},derive$1(original)),data.dump);};var SketchBehaviours={field:field,augment:augment,get:get$2};var _placeholder='placeholder';var adt$3=Adt.generate([{single:['required','valueThunk']},{multiple:['required','valueThunks']}]);var isSubstituted=function isSubstituted(spec){return has$2(spec,'uiType');};var subPlaceholder=function subPlaceholder(owner,detail,compSpec,placeholders){if(owner.exists(function(o){return o!==compSpec.owner;})){return adt$3.single(true,constant$1(compSpec));}return get$e(placeholders,compSpec.name).fold(function(){throw new Error('Unknown placeholder component: '+compSpec.name+'\\nKnown: ['+keys(placeholders)+']\\nNamespace: '+owner.getOr('none')+'\\nSpec: '+JSON.stringify(compSpec,null,2));},function(newSpec){return newSpec.replace();});};var scan=function scan(owner,detail,compSpec,placeholders){if(isSubstituted(compSpec)&&compSpec.uiType===_placeholder){return subPlaceholder(owner,detail,compSpec,placeholders);}else{return adt$3.single(false,constant$1(compSpec));}};var _substitute=function substitute(owner,detail,compSpec,placeholders){var base=scan(owner,detail,compSpec,placeholders);return base.fold(function(req,valueThunk){var value=isSubstituted(compSpec)?valueThunk(detail,compSpec.config,compSpec.validated):valueThunk(detail);var childSpecs=get$e(value,'components').getOr([]);var substituted=bind$3(childSpecs,function(c){return _substitute(owner,detail,c,placeholders);});return[_assign(_assign({},value),{components:substituted})];},function(req,valuesThunk){if(isSubstituted(compSpec)){var values=valuesThunk(detail,compSpec.config,compSpec.validated);var preprocessor=compSpec.validated.preprocess.getOr(identity$1);return preprocessor(values);}else{return valuesThunk(detail);}});};var substituteAll=function substituteAll(owner,detail,components,placeholders){return bind$3(components,function(c){return _substitute(owner,detail,c,placeholders);});};var oneReplace=function oneReplace(label,replacements){var called=false;var used=function used(){return called;};var replace=function replace(){if(called){throw new Error('Trying to use the same placeholder more than once: '+label);}called=true;return replacements;};var required=function required(){return replacements.fold(function(req,_){return req;},function(req,_){return req;});};return{name:constant$1(label),required:required,used:used,replace:replace};};var substitutePlaces=function substitutePlaces(owner,detail,components,placeholders){var ps=map$1(placeholders,function(ph,name){return oneReplace(name,ph);});var outcome=substituteAll(owner,detail,components,ps);each(ps,function(p){if(p.used()===false&&p.required()){throw new Error('Placeholder: '+p.name()+' was not found in components list\\nNamespace: '+owner.getOr('none')+'\\nComponents: '+JSON.stringify(detail.components,null,2));}});return outcome;};var single$2=adt$3.single;var multiple=adt$3.multiple;var placeholder=constant$1(_placeholder);var adt$2=Adt.generate([{required:['data']},{external:['data']},{optional:['data']},{group:['data']}]);var fFactory=defaulted('factory',{sketch:identity$1});var fSchema=defaulted('schema',[]);var fName=required$1('name');var fPname=field$1('pname','pname',defaultedThunk(function(typeSpec){return'<alloy.'+generate$6(typeSpec.name)+'>';}),anyValue());var fGroupSchema=customField('schema',function(){return[option('preprocess')];});var fDefaults=defaulted('defaults',constant$1({}));var fOverrides=defaulted('overrides',constant$1({}));var requiredSpec=objOf([fFactory,fSchema,fName,fPname,fDefaults,fOverrides]);var externalSpec=objOf([fFactory,fSchema,fName,fDefaults,fOverrides]);var optionalSpec=objOf([fFactory,fSchema,fName,fPname,fDefaults,fOverrides]);var groupSpec=objOf([fFactory,fGroupSchema,fName,required$1('unit'),fPname,fDefaults,fOverrides]);var asNamedPart=function asNamedPart(part){return part.fold(Optional.some,Optional.none,Optional.some,Optional.some);};var name$1=function name$1(part){var get=function get(data){return data.name;};return part.fold(get,get,get,get);};var asCommon=function asCommon(part){return part.fold(identity$1,identity$1,identity$1,identity$1);};var convert=function convert(adtConstructor,partSchema){return function(spec){var data=asRawOrDie$1('Converting part type',partSchema,spec);return adtConstructor(data);};};var required=convert(adt$2.required,requiredSpec);var external$1=convert(adt$2.external,externalSpec);var optional=convert(adt$2.optional,optionalSpec);var group=convert(adt$2.group,groupSpec);var original=constant$1('entirety');var PartType=/*#__PURE__*/Object.freeze({__proto__:null,required:required,external:external$1,optional:optional,group:group,asNamedPart:asNamedPart,name:name$1,asCommon:asCommon,original:original});var combine=function combine(detail,data,partSpec,partValidated){return deepMerge(data.defaults(detail,partSpec,partValidated),partSpec,{uid:detail.partUids[data.name]},data.overrides(detail,partSpec,partValidated));};var subs=function subs(owner,detail,parts){var internals={};var externals={};each$1(parts,function(part){part.fold(function(data){internals[data.pname]=single$2(true,function(detail,partSpec,partValidated){return data.factory.sketch(combine(detail,data,partSpec,partValidated));});},function(data){var partSpec=detail.parts[data.name];externals[data.name]=constant$1(data.factory.sketch(combine(detail,data,partSpec[original()]),partSpec));},function(data){internals[data.pname]=single$2(false,function(detail,partSpec,partValidated){return data.factory.sketch(combine(detail,data,partSpec,partValidated));});},function(data){internals[data.pname]=multiple(true,function(detail,_partSpec,_partValidated){var units=detail[data.name];return map$2(units,function(u){return data.factory.sketch(deepMerge(data.defaults(detail,u,_partValidated),u,data.overrides(detail,u)));});});});});return{internals:constant$1(internals),externals:constant$1(externals)};};var generate$3=function generate$3(owner,parts){var r={};each$1(parts,function(part){asNamedPart(part).each(function(np){var g=doGenerateOne(owner,np.pname);r[np.name]=function(config){var validated=asRawOrDie$1('Part: '+np.name+' in '+owner,objOf(np.schema),config);return _assign(_assign({},g),{config:config,validated:validated});};});});return r;};var doGenerateOne=function doGenerateOne(owner,pname){return{uiType:placeholder(),owner:owner,name:pname};};var generateOne$1=function generateOne$1(owner,pname,config){return{uiType:placeholder(),owner:owner,name:pname,config:config,validated:{}};};var schemas=function schemas(parts){return bind$3(parts,function(part){return part.fold(Optional.none,Optional.some,Optional.none,Optional.none).map(function(data){return requiredObjOf(data.name,data.schema.concat([snapshot(original())]));}).toArray();});};var names=function names(parts){return map$2(parts,name$1);};var substitutes=function substitutes(owner,detail,parts){return subs(owner,detail,parts);};var components$1=function components$1(owner,detail,internals){return substitutePlaces(Optional.some(owner),detail,detail.components,internals);};var getPart=function getPart(component,detail,partKey){var uid=detail.partUids[partKey];return component.getSystem().getByUid(uid).toOptional();};var getPartOrDie=function getPartOrDie(component,detail,partKey){return getPart(component,detail,partKey).getOrDie('Could not find part: '+partKey);};var getParts=function getParts(component,detail,partKeys){var r={};var uids=detail.partUids;var system=component.getSystem();each$1(partKeys,function(pk){r[pk]=constant$1(system.getByUid(uids[pk]));});return r;};var getAllParts=function getAllParts(component,detail){var system=component.getSystem();return map$1(detail.partUids,function(pUid,_k){return constant$1(system.getByUid(pUid));});};var getAllPartNames=function getAllPartNames(detail){return keys(detail.partUids);};var getPartsOrDie=function getPartsOrDie(component,detail,partKeys){var r={};var uids=detail.partUids;var system=component.getSystem();each$1(partKeys,function(pk){r[pk]=constant$1(system.getByUid(uids[pk]).getOrDie());});return r;};var defaultUids=function defaultUids(baseUid,partTypes){var partNames=names(partTypes);return wrapAll(map$2(partNames,function(pn){return{key:pn,value:baseUid+'-'+pn};}));};var defaultUidsSchema=function defaultUidsSchema(partTypes){return field$1('partUids','partUids',mergeWithThunk(function(spec){return defaultUids(spec.uid,partTypes);}),anyValue());};var AlloyParts=/*#__PURE__*/Object.freeze({__proto__:null,generate:generate$3,generateOne:generateOne$1,schemas:schemas,names:names,substitutes:substitutes,components:components$1,defaultUids:defaultUids,defaultUidsSchema:defaultUidsSchema,getAllParts:getAllParts,getAllPartNames:getAllPartNames,getPart:getPart,getPartOrDie:getPartOrDie,getParts:getParts,getPartsOrDie:getPartsOrDie});var base=function base(partSchemas,partUidsSchemas){var ps=partSchemas.length>0?[requiredObjOf('parts',partSchemas)]:[];return ps.concat([required$1('uid'),defaulted('dom',{}),defaulted('components',[]),snapshot('originalSpec'),defaulted('debug.sketcher',{})]).concat(partUidsSchemas);};var asRawOrDie=function asRawOrDie(label,schema,spec,partSchemas,partUidsSchemas){var baseS=base(partSchemas,partUidsSchemas);return asRawOrDie$1(label+' [SpecSchema]',objOfOnly(baseS.concat(schema)),spec);};var single$1=function single$1(owner,schema,factory,spec){var specWithUid=supplyUid(spec);var detail=asRawOrDie(owner,schema,specWithUid,[],[]);return factory(detail,specWithUid);};var composite$1=function composite$1(owner,schema,partTypes,factory,spec){var specWithUid=supplyUid(spec);var partSchemas=schemas(partTypes);var partUidsSchema=defaultUidsSchema(partTypes);var detail=asRawOrDie(owner,schema,specWithUid,partSchemas,[partUidsSchema]);var subs=substitutes(owner,detail,partTypes);var components=components$1(owner,detail,subs.internals());return factory(detail,components,specWithUid,subs.externals());};var hasUid=function hasUid(spec){return has$2(spec,'uid');};var supplyUid=function supplyUid(spec){return hasUid(spec)?spec:_assign(_assign({},spec),{uid:generate$5('uid')});};var isSketchSpec=function isSketchSpec(spec){return spec.uid!==undefined;};var singleSchema=objOfOnly([required$1('name'),required$1('factory'),required$1('configFields'),defaulted('apis',{}),defaulted('extraApis',{})]);var compositeSchema=objOfOnly([required$1('name'),required$1('factory'),required$1('configFields'),required$1('partFields'),defaulted('apis',{}),defaulted('extraApis',{})]);var single=function single(rawConfig){var config=asRawOrDie$1('Sketcher for '+rawConfig.name,singleSchema,rawConfig);var sketch=function sketch(spec){return single$1(config.name,config.configFields,config.factory,spec);};var apis=map$1(config.apis,makeApi);var extraApis=map$1(config.extraApis,function(f,k){return markAsExtraApi(f,k);});return _assign(_assign({name:config.name,configFields:config.configFields,sketch:sketch},apis),extraApis);};var composite=function composite(rawConfig){var config=asRawOrDie$1('Sketcher for '+rawConfig.name,compositeSchema,rawConfig);var sketch=function sketch(spec){return composite$1(config.name,config.configFields,config.partFields,config.factory,spec);};var parts=generate$3(config.name,config.partFields);var apis=map$1(config.apis,makeApi);var extraApis=map$1(config.extraApis,function(f,k){return markAsExtraApi(f,k);});return _assign(_assign({name:config.name,partFields:config.partFields,configFields:config.configFields,sketch:sketch,parts:parts},apis),extraApis);};var inside=function inside(target){return name$2(target)==='input'&&get$d(target,'type')!=='radio'||name$2(target)==='textarea';};var getCurrent=function getCurrent(component,composeConfig,_composeState){return composeConfig.find(component);};var ComposeApis=/*#__PURE__*/Object.freeze({__proto__:null,getCurrent:getCurrent});var ComposeSchema=[required$1('find')];var Composing=create$8({fields:ComposeSchema,name:'composing',apis:ComposeApis});var nativeDisabled=['input','button','textarea','select'];var onLoad$1=function onLoad$1(component,disableConfig,disableState){var f=disableConfig.disabled()?disable$1:enable$1;f(component,disableConfig);};var hasNative=function hasNative(component,config){return config.useNative===true&&contains$2(nativeDisabled,name$2(component.element));};var nativeIsDisabled=function nativeIsDisabled(component){return has$1(component.element,'disabled');};var nativeDisable=function nativeDisable(component){set$8(component.element,'disabled','disabled');};var nativeEnable=function nativeEnable(component){remove$7(component.element,'disabled');};var ariaIsDisabled=function ariaIsDisabled(component){return get$d(component.element,'aria-disabled')==='true';};var ariaDisable=function ariaDisable(component){set$8(component.element,'aria-disabled','true');};var ariaEnable=function ariaEnable(component){set$8(component.element,'aria-disabled','false');};var disable$1=function disable$1(component,disableConfig,_disableState){disableConfig.disableClass.each(function(disableClass){add$2(component.element,disableClass);});var f=hasNative(component,disableConfig)?nativeDisable:ariaDisable;f(component);disableConfig.onDisabled(component);};var enable$1=function enable$1(component,disableConfig,_disableState){disableConfig.disableClass.each(function(disableClass){remove$2(component.element,disableClass);});var f=hasNative(component,disableConfig)?nativeEnable:ariaEnable;f(component);disableConfig.onEnabled(component);};var isDisabled=function isDisabled(component,disableConfig){return hasNative(component,disableConfig)?nativeIsDisabled(component):ariaIsDisabled(component);};var set$3=function set$3(component,disableConfig,disableState,disabled){var f=disabled?disable$1:enable$1;f(component,disableConfig);};var DisableApis=/*#__PURE__*/Object.freeze({__proto__:null,enable:enable$1,disable:disable$1,isDisabled:isDisabled,onLoad:onLoad$1,set:set$3});var exhibit$5=function exhibit$5(base,disableConfig){return nu$7({classes:disableConfig.disabled()?disableConfig.disableClass.toArray():[]});};var events$e=function events$e(disableConfig,disableState){return derive$2([abort(execute$5(),function(component,_simulatedEvent){return isDisabled(component,disableConfig);}),loadEvent(disableConfig,disableState,onLoad$1)]);};var ActiveDisable=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$5,events:events$e});var DisableSchema=[defaultedFunction('disabled',never),defaulted('useNative',true),option('disableClass'),onHandler('onDisabled'),onHandler('onEnabled')];var Disabling=create$8({fields:DisableSchema,name:'disabling',active:ActiveDisable,apis:DisableApis});var dehighlightAllExcept=function dehighlightAllExcept(component,hConfig,hState,skip){var highlighted=descendants(component.element,'.'+hConfig.highlightClass);each$1(highlighted,function(h){if(!exists(skip,function(skipComp){return skipComp.element===h;})){remove$2(h,hConfig.highlightClass);component.getSystem().getByDom(h).each(function(target){hConfig.onDehighlight(component,target);emit(target,dehighlight$1());});}});};var dehighlightAll=function dehighlightAll(component,hConfig,hState){return dehighlightAllExcept(component,hConfig,hState,[]);};var dehighlight=function dehighlight(component,hConfig,hState,target){if(isHighlighted(component,hConfig,hState,target)){remove$2(target.element,hConfig.highlightClass);hConfig.onDehighlight(component,target);emit(target,dehighlight$1());}};var highlight=function highlight(component,hConfig,hState,target){dehighlightAllExcept(component,hConfig,hState,[target]);if(!isHighlighted(component,hConfig,hState,target)){add$2(target.element,hConfig.highlightClass);hConfig.onHighlight(component,target);emit(target,highlight$1());}};var highlightFirst=function highlightFirst(component,hConfig,hState){getFirst(component,hConfig).each(function(firstComp){highlight(component,hConfig,hState,firstComp);});};var highlightLast=function highlightLast(component,hConfig,hState){getLast(component,hConfig).each(function(lastComp){highlight(component,hConfig,hState,lastComp);});};var highlightAt=function highlightAt(component,hConfig,hState,index){getByIndex(component,hConfig,hState,index).fold(function(err){throw err;},function(firstComp){highlight(component,hConfig,hState,firstComp);});};var highlightBy=function highlightBy(component,hConfig,hState,predicate){var candidates=getCandidates(component,hConfig);var targetComp=find$5(candidates,predicate);targetComp.each(function(c){highlight(component,hConfig,hState,c);});};var isHighlighted=function isHighlighted(component,hConfig,hState,queryTarget){return has(queryTarget.element,hConfig.highlightClass);};var getHighlighted=function getHighlighted(component,hConfig,_hState){return descendant(component.element,'.'+hConfig.highlightClass).bind(function(e){return component.getSystem().getByDom(e).toOptional();});};var getByIndex=function getByIndex(component,hConfig,hState,index){var items=descendants(component.element,'.'+hConfig.itemClass);return Optional.from(items[index]).fold(function(){return Result.error(new Error('No element found with index '+index));},component.getSystem().getByDom);};var getFirst=function getFirst(component,hConfig,_hState){return descendant(component.element,'.'+hConfig.itemClass).bind(function(e){return component.getSystem().getByDom(e).toOptional();});};var getLast=function getLast(component,hConfig,_hState){var items=descendants(component.element,'.'+hConfig.itemClass);var last=items.length>0?Optional.some(items[items.length-1]):Optional.none();return last.bind(function(c){return component.getSystem().getByDom(c).toOptional();});};var getDelta$2=function getDelta$2(component,hConfig,hState,delta){var items=descendants(component.element,'.'+hConfig.itemClass);var current=findIndex$1(items,function(item){return has(item,hConfig.highlightClass);});return current.bind(function(selected){var dest=cycleBy(selected,delta,0,items.length-1);return component.getSystem().getByDom(items[dest]).toOptional();});};var getPrevious=function getPrevious(component,hConfig,hState){return getDelta$2(component,hConfig,hState,-1);};var getNext=function getNext(component,hConfig,hState){return getDelta$2(component,hConfig,hState,+1);};var getCandidates=function getCandidates(component,hConfig,_hState){var items=descendants(component.element,'.'+hConfig.itemClass);return cat(map$2(items,function(i){return component.getSystem().getByDom(i).toOptional();}));};var HighlightApis=/*#__PURE__*/Object.freeze({__proto__:null,dehighlightAll:dehighlightAll,dehighlight:dehighlight,highlight:highlight,highlightFirst:highlightFirst,highlightLast:highlightLast,highlightAt:highlightAt,highlightBy:highlightBy,isHighlighted:isHighlighted,getHighlighted:getHighlighted,getFirst:getFirst,getLast:getLast,getPrevious:getPrevious,getNext:getNext,getCandidates:getCandidates});var HighlightSchema=[required$1('highlightClass'),required$1('itemClass'),onHandler('onHighlight'),onHandler('onDehighlight')];var Highlighting=create$8({fields:HighlightSchema,name:'highlighting',apis:HighlightApis});var BACKSPACE=[8];var TAB=[9];var ENTER=[13];var ESCAPE=[27];var SPACE=[32];var LEFT=[37];var UP=[38];var RIGHT=[39];var DOWN=[40];var cyclePrev=function cyclePrev(values,index,predicate){var before=reverse(values.slice(0,index));var after=reverse(values.slice(index+1));return find$5(before.concat(after),predicate);};var tryPrev=function tryPrev(values,index,predicate){var before=reverse(values.slice(0,index));return find$5(before,predicate);};var cycleNext=function cycleNext(values,index,predicate){var before=values.slice(0,index);var after=values.slice(index+1);return find$5(after.concat(before),predicate);};var tryNext=function tryNext(values,index,predicate){var after=values.slice(index+1);return find$5(after,predicate);};var inSet=function inSet(keys){return function(event){var raw=event.raw;return contains$2(keys,raw.which);};};var and=function and(preds){return function(event){return forall(preds,function(pred){return pred(event);});};};var isShift=function isShift(event){var raw=event.raw;return raw.shiftKey===true;};var isControl=function isControl(event){var raw=event.raw;return raw.ctrlKey===true;};var isNotShift=not(isShift);var rule=function rule(matches,action){return{matches:matches,classification:action};};var choose=function choose(transitions,event){var transition=find$5(transitions,function(t){return t.matches(event);});return transition.map(function(t){return t.classification;});};var reportFocusShifting=function reportFocusShifting(component,prevFocus,newFocus){var noChange=prevFocus.exists(function(p){return newFocus.exists(function(n){return eq(n,p);});});if(!noChange){emitWith(component,focusShifted(),{prevFocus:prevFocus,newFocus:newFocus});}};var dom$2=function dom$2(){var get=function get(component){return search(component.element);};var set=function set(component,focusee){var prevFocus=get(component);component.getSystem().triggerFocus(focusee,component.element);var newFocus=get(component);reportFocusShifting(component,prevFocus,newFocus);};return{get:get,set:set};};var highlights=function highlights(){var get=function get(component){return Highlighting.getHighlighted(component).map(function(item){return item.element;});};var set=function set(component,element){var prevFocus=get(component);component.getSystem().getByDom(element).fold(noop,function(item){Highlighting.highlight(component,item);});var newFocus=get(component);reportFocusShifting(component,prevFocus,newFocus);};return{get:get,set:set};};var FocusInsideModes;(function(FocusInsideModes){FocusInsideModes['OnFocusMode']='onFocus';FocusInsideModes['OnEnterOrSpaceMode']='onEnterOrSpace';FocusInsideModes['OnApiMode']='onApi';})(FocusInsideModes||(FocusInsideModes={}));var typical=function typical(infoSchema,stateInit,getKeydownRules,getKeyupRules,optFocusIn){var schema=function schema(){return infoSchema.concat([defaulted('focusManager',dom$2()),defaultedOf('focusInside','onFocus',valueOf(function(val){return contains$2(['onFocus','onEnterOrSpace','onApi'],val)?Result.value(val):Result.error('Invalid value for focusInside');})),output$1('handler',me),output$1('state',stateInit),output$1('sendFocusIn',optFocusIn)]);};var processKey=function processKey(component,simulatedEvent,getRules,keyingConfig,keyingState){var rules=getRules(component,simulatedEvent,keyingConfig,keyingState);return choose(rules,simulatedEvent.event).bind(function(rule){return rule(component,simulatedEvent,keyingConfig,keyingState);});};var toEvents=function toEvents(keyingConfig,keyingState){var onFocusHandler=keyingConfig.focusInside!==FocusInsideModes.OnFocusMode?Optional.none():optFocusIn(keyingConfig).map(function(focusIn){return run$1(focus$4(),function(component,simulatedEvent){focusIn(component,keyingConfig,keyingState);simulatedEvent.stop();});});var tryGoInsideComponent=function tryGoInsideComponent(component,simulatedEvent){var isEnterOrSpace=inSet(SPACE.concat(ENTER))(simulatedEvent.event);if(keyingConfig.focusInside===FocusInsideModes.OnEnterOrSpaceMode&&isEnterOrSpace&&isSource(component,simulatedEvent)){optFocusIn(keyingConfig).each(function(focusIn){focusIn(component,keyingConfig,keyingState);simulatedEvent.stop();});}};var keyboardEvents=[run$1(keydown(),function(component,simulatedEvent){processKey(component,simulatedEvent,getKeydownRules,keyingConfig,keyingState).fold(function(){tryGoInsideComponent(component,simulatedEvent);},function(_){simulatedEvent.stop();});}),run$1(keyup(),function(component,simulatedEvent){processKey(component,simulatedEvent,getKeyupRules,keyingConfig,keyingState).each(function(_){simulatedEvent.stop();});})];return derive$2(onFocusHandler.toArray().concat(keyboardEvents));};var me={schema:schema,processKey:processKey,toEvents:toEvents};return me;};var create$6=function create$6(cyclicField){var schema=[option('onEscape'),option('onEnter'),defaulted('selector','[data-alloy-tabstop=\"true\"]:not(:disabled)'),defaulted('firstTabstop',0),defaulted('useTabstopAt',always),option('visibilitySelector')].concat([cyclicField]);var isVisible=function isVisible(tabbingConfig,element){var target=tabbingConfig.visibilitySelector.bind(function(sel){return closest$1(element,sel);}).getOr(element);return get$b(target)>0;};var findInitial=function findInitial(component,tabbingConfig){var tabstops=descendants(component.element,tabbingConfig.selector);var visibles=filter$2(tabstops,function(elem){return isVisible(tabbingConfig,elem);});return Optional.from(visibles[tabbingConfig.firstTabstop]);};var findCurrent=function findCurrent(component,tabbingConfig){return tabbingConfig.focusManager.get(component).bind(function(elem){return closest$1(elem,tabbingConfig.selector);});};var isTabstop=function isTabstop(tabbingConfig,element){return isVisible(tabbingConfig,element)&&tabbingConfig.useTabstopAt(element);};var focusIn=function focusIn(component,tabbingConfig,_tabbingState){findInitial(component,tabbingConfig).each(function(target){tabbingConfig.focusManager.set(component,target);});};var goFromTabstop=function goFromTabstop(component,tabstops,stopIndex,tabbingConfig,cycle){return cycle(tabstops,stopIndex,function(elem){return isTabstop(tabbingConfig,elem);}).fold(function(){return tabbingConfig.cyclic?Optional.some(true):Optional.none();},function(target){tabbingConfig.focusManager.set(component,target);return Optional.some(true);});};var go=function go(component,_simulatedEvent,tabbingConfig,cycle){var tabstops=descendants(component.element,tabbingConfig.selector);return findCurrent(component,tabbingConfig).bind(function(tabstop){var optStopIndex=findIndex$1(tabstops,curry(eq,tabstop));return optStopIndex.bind(function(stopIndex){return goFromTabstop(component,tabstops,stopIndex,tabbingConfig,cycle);});});};var goBackwards=function goBackwards(component,simulatedEvent,tabbingConfig){var navigate=tabbingConfig.cyclic?cyclePrev:tryPrev;return go(component,simulatedEvent,tabbingConfig,navigate);};var goForwards=function goForwards(component,simulatedEvent,tabbingConfig){var navigate=tabbingConfig.cyclic?cycleNext:tryNext;return go(component,simulatedEvent,tabbingConfig,navigate);};var execute=function execute(component,simulatedEvent,tabbingConfig){return tabbingConfig.onEnter.bind(function(f){return f(component,simulatedEvent);});};var exit=function exit(component,simulatedEvent,tabbingConfig){return tabbingConfig.onEscape.bind(function(f){return f(component,simulatedEvent);});};var getKeydownRules=constant$1([rule(and([isShift,inSet(TAB)]),goBackwards),rule(inSet(TAB),goForwards),rule(inSet(ESCAPE),exit),rule(and([isNotShift,inSet(ENTER)]),execute)]);var getKeyupRules=constant$1([]);return typical(schema,NoState.init,getKeydownRules,getKeyupRules,function(){return Optional.some(focusIn);});};var AcyclicType=create$6(customField('cyclic',never));var CyclicType=create$6(customField('cyclic',always));var doDefaultExecute=function doDefaultExecute(component,_simulatedEvent,focused){dispatch(component,focused,execute$5());return Optional.some(true);};var defaultExecute=function defaultExecute(component,simulatedEvent,focused){var isComplex=inside(focused)&&inSet(SPACE)(simulatedEvent.event);return isComplex?Optional.none():doDefaultExecute(component,simulatedEvent,focused);};var stopEventForFirefox=function stopEventForFirefox(_component,_simulatedEvent){return Optional.some(true);};var schema$v=[defaulted('execute',defaultExecute),defaulted('useSpace',false),defaulted('useEnter',true),defaulted('useControlEnter',false),defaulted('useDown',false)];var execute$4=function execute$4(component,simulatedEvent,executeConfig){return executeConfig.execute(component,simulatedEvent,component.element);};var getKeydownRules$5=function getKeydownRules$5(component,_simulatedEvent,executeConfig,_executeState){var spaceExec=executeConfig.useSpace&&!inside(component.element)?SPACE:[];var enterExec=executeConfig.useEnter?ENTER:[];var downExec=executeConfig.useDown?DOWN:[];var execKeys=spaceExec.concat(enterExec).concat(downExec);return[rule(inSet(execKeys),execute$4)].concat(executeConfig.useControlEnter?[rule(and([isControl,inSet(ENTER)]),execute$4)]:[]);};var getKeyupRules$5=function getKeyupRules$5(component,_simulatedEvent,executeConfig,_executeState){return executeConfig.useSpace&&!inside(component.element)?[rule(inSet(SPACE),stopEventForFirefox)]:[];};var ExecutionType=typical(schema$v,NoState.init,getKeydownRules$5,getKeyupRules$5,function(){return Optional.none();});var flatgrid$1=function flatgrid$1(){var dimensions=value$1();var setGridSize=function setGridSize(numRows,numColumns){dimensions.set({numRows:numRows,numColumns:numColumns});};var getNumRows=function getNumRows(){return dimensions.get().map(function(d){return d.numRows;});};var getNumColumns=function getNumColumns(){return dimensions.get().map(function(d){return d.numColumns;});};return nu$8({readState:function readState(){return dimensions.get().map(function(d){return{numRows:String(d.numRows),numColumns:String(d.numColumns)};}).getOr({numRows:'?',numColumns:'?'});},setGridSize:setGridSize,getNumRows:getNumRows,getNumColumns:getNumColumns});};var init$d=function init$d(spec){return spec.state(spec);};var KeyingState=/*#__PURE__*/Object.freeze({__proto__:null,flatgrid:flatgrid$1,init:init$d});var useH=function useH(movement){return function(component,simulatedEvent,config,state){var move=movement(component.element);return use(move,component,simulatedEvent,config,state);};};var west$1=function west$1(moveLeft,moveRight){var movement=onDirection(moveLeft,moveRight);return useH(movement);};var east$1=function east$1(moveLeft,moveRight){var movement=onDirection(moveRight,moveLeft);return useH(movement);};var useV=function useV(move){return function(component,simulatedEvent,config,state){return use(move,component,simulatedEvent,config,state);};};var use=function use(move,component,simulatedEvent,config,state){var outcome=config.focusManager.get(component).bind(function(focused){return move(component.element,focused,config,state);});return outcome.map(function(newFocus){config.focusManager.set(component,newFocus);return true;});};var north$1=useV;var south$1=useV;var move$1=useV;var isHidden$1=function isHidden$1(dom){return dom.offsetWidth<=0&&dom.offsetHeight<=0;};var isVisible=function isVisible(element){return!isHidden$1(element.dom);};var locate=function locate(candidates,predicate){return findIndex$1(candidates,predicate).map(function(index){return{index:index,candidates:candidates};});};var locateVisible=function locateVisible(container,current,selector){var predicate=function predicate(x){return eq(x,current);};var candidates=descendants(container,selector);var visible=filter$2(candidates,isVisible);return locate(visible,predicate);};var findIndex=function findIndex(elements,target){return findIndex$1(elements,function(elem){return eq(target,elem);});};var withGrid=function withGrid(values,index,numCols,f){var oldRow=Math.floor(index/numCols);var oldColumn=index%numCols;return f(oldRow,oldColumn).bind(function(address){var newIndex=address.row*numCols+address.column;return newIndex>=0&&newIndex<values.length?Optional.some(values[newIndex]):Optional.none();});};var cycleHorizontal$1=function cycleHorizontal$1(values,index,numRows,numCols,delta){return withGrid(values,index,numCols,function(oldRow,oldColumn){var onLastRow=oldRow===numRows-1;var colsInRow=onLastRow?values.length-oldRow*numCols:numCols;var newColumn=cycleBy(oldColumn,delta,0,colsInRow-1);return Optional.some({row:oldRow,column:newColumn});});};var cycleVertical$1=function cycleVertical$1(values,index,numRows,numCols,delta){return withGrid(values,index,numCols,function(oldRow,oldColumn){var newRow=cycleBy(oldRow,delta,0,numRows-1);var onLastRow=newRow===numRows-1;var colsInRow=onLastRow?values.length-newRow*numCols:numCols;var newCol=clamp$1(oldColumn,0,colsInRow-1);return Optional.some({row:newRow,column:newCol});});};var cycleRight$1=function cycleRight$1(values,index,numRows,numCols){return cycleHorizontal$1(values,index,numRows,numCols,+1);};var cycleLeft$1=function cycleLeft$1(values,index,numRows,numCols){return cycleHorizontal$1(values,index,numRows,numCols,-1);};var cycleUp$1=function cycleUp$1(values,index,numRows,numCols){return cycleVertical$1(values,index,numRows,numCols,-1);};var cycleDown$1=function cycleDown$1(values,index,numRows,numCols){return cycleVertical$1(values,index,numRows,numCols,+1);};var schema$u=[required$1('selector'),defaulted('execute',defaultExecute),onKeyboardHandler('onEscape'),defaulted('captureTab',false),initSize()];var focusIn$3=function focusIn$3(component,gridConfig,_gridState){descendant(component.element,gridConfig.selector).each(function(first){gridConfig.focusManager.set(component,first);});};var findCurrent$1=function findCurrent$1(component,gridConfig){return gridConfig.focusManager.get(component).bind(function(elem){return closest$1(elem,gridConfig.selector);});};var execute$3=function execute$3(component,simulatedEvent,gridConfig,_gridState){return findCurrent$1(component,gridConfig).bind(function(focused){return gridConfig.execute(component,simulatedEvent,focused);});};var doMove$2=function doMove$2(cycle){return function(element,focused,gridConfig,gridState){return locateVisible(element,focused,gridConfig.selector).bind(function(identified){return cycle(identified.candidates,identified.index,gridState.getNumRows().getOr(gridConfig.initSize.numRows),gridState.getNumColumns().getOr(gridConfig.initSize.numColumns));});};};var handleTab=function handleTab(_component,_simulatedEvent,gridConfig){return gridConfig.captureTab?Optional.some(true):Optional.none();};var doEscape$1=function doEscape$1(component,simulatedEvent,gridConfig){return gridConfig.onEscape(component,simulatedEvent);};var moveLeft$3=doMove$2(cycleLeft$1);var moveRight$3=doMove$2(cycleRight$1);var moveNorth$1=doMove$2(cycleUp$1);var moveSouth$1=doMove$2(cycleDown$1);var getKeydownRules$4=constant$1([rule(inSet(LEFT),west$1(moveLeft$3,moveRight$3)),rule(inSet(RIGHT),east$1(moveLeft$3,moveRight$3)),rule(inSet(UP),north$1(moveNorth$1)),rule(inSet(DOWN),south$1(moveSouth$1)),rule(and([isShift,inSet(TAB)]),handleTab),rule(and([isNotShift,inSet(TAB)]),handleTab),rule(inSet(ESCAPE),doEscape$1),rule(inSet(SPACE.concat(ENTER)),execute$3)]);var getKeyupRules$4=constant$1([rule(inSet(SPACE),stopEventForFirefox)]);var FlatgridType=typical(schema$u,flatgrid$1,getKeydownRules$4,getKeyupRules$4,function(){return Optional.some(focusIn$3);});var horizontal=function horizontal(container,selector,current,delta){var isDisabledButton=function isDisabledButton(candidate){return name$2(candidate)==='button'&&get$d(candidate,'disabled')==='disabled';};var _tryCycle=function tryCycle(initial,index,candidates){var newIndex=cycleBy(index,delta,0,candidates.length-1);if(newIndex===initial){return Optional.none();}else{return isDisabledButton(candidates[newIndex])?_tryCycle(initial,newIndex,candidates):Optional.from(candidates[newIndex]);}};return locateVisible(container,current,selector).bind(function(identified){var index=identified.index;var candidates=identified.candidates;return _tryCycle(index,index,candidates);});};var schema$t=[required$1('selector'),defaulted('getInitial',Optional.none),defaulted('execute',defaultExecute),onKeyboardHandler('onEscape'),defaulted('executeOnMove',false),defaulted('allowVertical',true)];var findCurrent=function findCurrent(component,flowConfig){return flowConfig.focusManager.get(component).bind(function(elem){return closest$1(elem,flowConfig.selector);});};var execute$2=function execute$2(component,simulatedEvent,flowConfig){return findCurrent(component,flowConfig).bind(function(focused){return flowConfig.execute(component,simulatedEvent,focused);});};var focusIn$2=function focusIn$2(component,flowConfig,_state){flowConfig.getInitial(component).orThunk(function(){return descendant(component.element,flowConfig.selector);}).each(function(first){flowConfig.focusManager.set(component,first);});};var moveLeft$2=function moveLeft$2(element,focused,info){return horizontal(element,info.selector,focused,-1);};var moveRight$2=function moveRight$2(element,focused,info){return horizontal(element,info.selector,focused,+1);};var doMove$1=function doMove$1(movement){return function(component,simulatedEvent,flowConfig,flowState){return movement(component,simulatedEvent,flowConfig,flowState).bind(function(){return flowConfig.executeOnMove?execute$2(component,simulatedEvent,flowConfig):Optional.some(true);});};};var doEscape=function doEscape(component,simulatedEvent,flowConfig){return flowConfig.onEscape(component,simulatedEvent);};var getKeydownRules$3=function getKeydownRules$3(_component,_se,flowConfig,_flowState){var westMovers=LEFT.concat(flowConfig.allowVertical?UP:[]);var eastMovers=RIGHT.concat(flowConfig.allowVertical?DOWN:[]);return[rule(inSet(westMovers),doMove$1(west$1(moveLeft$2,moveRight$2))),rule(inSet(eastMovers),doMove$1(east$1(moveLeft$2,moveRight$2))),rule(inSet(ENTER),execute$2),rule(inSet(SPACE),execute$2),rule(inSet(ESCAPE),doEscape)];};var getKeyupRules$3=constant$1([rule(inSet(SPACE),stopEventForFirefox)]);var FlowType=typical(schema$t,NoState.init,getKeydownRules$3,getKeyupRules$3,function(){return Optional.some(focusIn$2);});var toCell=function toCell(matrix,rowIndex,columnIndex){return Optional.from(matrix[rowIndex]).bind(function(row){return Optional.from(row[columnIndex]).map(function(cell){return{rowIndex:rowIndex,columnIndex:columnIndex,cell:cell};});});};var cycleHorizontal=function cycleHorizontal(matrix,rowIndex,startCol,deltaCol){var row=matrix[rowIndex];var colsInRow=row.length;var newColIndex=cycleBy(startCol,deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,newColIndex);};var cycleVertical=function cycleVertical(matrix,colIndex,startRow,deltaRow){var nextRowIndex=cycleBy(startRow,deltaRow,0,matrix.length-1);var colsInNextRow=matrix[nextRowIndex].length;var nextColIndex=clamp$1(colIndex,0,colsInNextRow-1);return toCell(matrix,nextRowIndex,nextColIndex);};var moveHorizontal=function moveHorizontal(matrix,rowIndex,startCol,deltaCol){var row=matrix[rowIndex];var colsInRow=row.length;var newColIndex=clamp$1(startCol+deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,newColIndex);};var moveVertical=function moveVertical(matrix,colIndex,startRow,deltaRow){var nextRowIndex=clamp$1(startRow+deltaRow,0,matrix.length-1);var colsInNextRow=matrix[nextRowIndex].length;var nextColIndex=clamp$1(colIndex,0,colsInNextRow-1);return toCell(matrix,nextRowIndex,nextColIndex);};var cycleRight=function cycleRight(matrix,startRow,startCol){return cycleHorizontal(matrix,startRow,startCol,+1);};var cycleLeft=function cycleLeft(matrix,startRow,startCol){return cycleHorizontal(matrix,startRow,startCol,-1);};var cycleUp=function cycleUp(matrix,startRow,startCol){return cycleVertical(matrix,startCol,startRow,-1);};var cycleDown=function cycleDown(matrix,startRow,startCol){return cycleVertical(matrix,startCol,startRow,+1);};var moveLeft$1=function moveLeft$1(matrix,startRow,startCol){return moveHorizontal(matrix,startRow,startCol,-1);};var moveRight$1=function moveRight$1(matrix,startRow,startCol){return moveHorizontal(matrix,startRow,startCol,+1);};var moveUp$1=function moveUp$1(matrix,startRow,startCol){return moveVertical(matrix,startCol,startRow,-1);};var moveDown$1=function moveDown$1(matrix,startRow,startCol){return moveVertical(matrix,startCol,startRow,+1);};var schema$s=[requiredObjOf('selectors',[required$1('row'),required$1('cell')]),defaulted('cycles',true),defaulted('previousSelector',Optional.none),defaulted('execute',defaultExecute)];var focusIn$1=function focusIn$1(component,matrixConfig,_state){var focused=matrixConfig.previousSelector(component).orThunk(function(){var selectors=matrixConfig.selectors;return descendant(component.element,selectors.cell);});focused.each(function(cell){matrixConfig.focusManager.set(component,cell);});};var execute$1=function execute$1(component,simulatedEvent,matrixConfig){return search(component.element).bind(function(focused){return matrixConfig.execute(component,simulatedEvent,focused);});};var toMatrix=function toMatrix(rows,matrixConfig){return map$2(rows,function(row){return descendants(row,matrixConfig.selectors.cell);});};var doMove=function doMove(ifCycle,ifMove){return function(element,focused,matrixConfig){var move=matrixConfig.cycles?ifCycle:ifMove;return closest$1(focused,matrixConfig.selectors.row).bind(function(inRow){var cellsInRow=descendants(inRow,matrixConfig.selectors.cell);return findIndex(cellsInRow,focused).bind(function(colIndex){var allRows=descendants(element,matrixConfig.selectors.row);return findIndex(allRows,inRow).bind(function(rowIndex){var matrix=toMatrix(allRows,matrixConfig);return move(matrix,rowIndex,colIndex).map(function(next){return next.cell;});});});});};};var moveLeft=doMove(cycleLeft,moveLeft$1);var moveRight=doMove(cycleRight,moveRight$1);var moveNorth=doMove(cycleUp,moveUp$1);var moveSouth=doMove(cycleDown,moveDown$1);var getKeydownRules$2=constant$1([rule(inSet(LEFT),west$1(moveLeft,moveRight)),rule(inSet(RIGHT),east$1(moveLeft,moveRight)),rule(inSet(UP),north$1(moveNorth)),rule(inSet(DOWN),south$1(moveSouth)),rule(inSet(SPACE.concat(ENTER)),execute$1)]);var getKeyupRules$2=constant$1([rule(inSet(SPACE),stopEventForFirefox)]);var MatrixType=typical(schema$s,NoState.init,getKeydownRules$2,getKeyupRules$2,function(){return Optional.some(focusIn$1);});var schema$r=[required$1('selector'),defaulted('execute',defaultExecute),defaulted('moveOnTab',false)];var execute=function execute(component,simulatedEvent,menuConfig){return menuConfig.focusManager.get(component).bind(function(focused){return menuConfig.execute(component,simulatedEvent,focused);});};var focusIn=function focusIn(component,menuConfig,_state){descendant(component.element,menuConfig.selector).each(function(first){menuConfig.focusManager.set(component,first);});};var moveUp=function moveUp(element,focused,info){return horizontal(element,info.selector,focused,-1);};var moveDown=function moveDown(element,focused,info){return horizontal(element,info.selector,focused,+1);};var fireShiftTab=function fireShiftTab(component,simulatedEvent,menuConfig,menuState){return menuConfig.moveOnTab?move$1(moveUp)(component,simulatedEvent,menuConfig,menuState):Optional.none();};var fireTab=function fireTab(component,simulatedEvent,menuConfig,menuState){return menuConfig.moveOnTab?move$1(moveDown)(component,simulatedEvent,menuConfig,menuState):Optional.none();};var getKeydownRules$1=constant$1([rule(inSet(UP),move$1(moveUp)),rule(inSet(DOWN),move$1(moveDown)),rule(and([isShift,inSet(TAB)]),fireShiftTab),rule(and([isNotShift,inSet(TAB)]),fireTab),rule(inSet(ENTER),execute),rule(inSet(SPACE),execute)]);var getKeyupRules$1=constant$1([rule(inSet(SPACE),stopEventForFirefox)]);var MenuType=typical(schema$r,NoState.init,getKeydownRules$1,getKeyupRules$1,function(){return Optional.some(focusIn);});var schema$q=[onKeyboardHandler('onSpace'),onKeyboardHandler('onEnter'),onKeyboardHandler('onShiftEnter'),onKeyboardHandler('onLeft'),onKeyboardHandler('onRight'),onKeyboardHandler('onTab'),onKeyboardHandler('onShiftTab'),onKeyboardHandler('onUp'),onKeyboardHandler('onDown'),onKeyboardHandler('onEscape'),defaulted('stopSpaceKeyup',false),option('focusIn')];var getKeydownRules=function getKeydownRules(component,simulatedEvent,specialInfo){return[rule(inSet(SPACE),specialInfo.onSpace),rule(and([isNotShift,inSet(ENTER)]),specialInfo.onEnter),rule(and([isShift,inSet(ENTER)]),specialInfo.onShiftEnter),rule(and([isShift,inSet(TAB)]),specialInfo.onShiftTab),rule(and([isNotShift,inSet(TAB)]),specialInfo.onTab),rule(inSet(UP),specialInfo.onUp),rule(inSet(DOWN),specialInfo.onDown),rule(inSet(LEFT),specialInfo.onLeft),rule(inSet(RIGHT),specialInfo.onRight),rule(inSet(SPACE),specialInfo.onSpace),rule(inSet(ESCAPE),specialInfo.onEscape)];};var getKeyupRules=function getKeyupRules(component,simulatedEvent,specialInfo){return specialInfo.stopSpaceKeyup?[rule(inSet(SPACE),stopEventForFirefox)]:[];};var SpecialType=typical(schema$q,NoState.init,getKeydownRules,getKeyupRules,function(specialInfo){return specialInfo.focusIn;});var acyclic=AcyclicType.schema();var cyclic=CyclicType.schema();var flow=FlowType.schema();var flatgrid=FlatgridType.schema();var matrix=MatrixType.schema();var execution=ExecutionType.schema();var menu=MenuType.schema();var special=SpecialType.schema();var KeyboardBranches=/*#__PURE__*/Object.freeze({__proto__:null,acyclic:acyclic,cyclic:cyclic,flow:flow,flatgrid:flatgrid,matrix:matrix,execution:execution,menu:menu,special:special});var isFlatgridState=function isFlatgridState(keyState){return hasNonNullableKey(keyState,'setGridSize');};var Keying=createModes({branchKey:'mode',branches:KeyboardBranches,name:'keying',active:{events:function events(keyingConfig,keyingState){var handler=keyingConfig.handler;return handler.toEvents(keyingConfig,keyingState);}},apis:{focusIn:function focusIn(component,keyConfig,keyState){keyConfig.sendFocusIn(keyConfig).fold(function(){component.getSystem().triggerFocus(component.element,component.element);},function(sendFocusIn){sendFocusIn(component,keyConfig,keyState);});},setGridSize:function setGridSize(component,keyConfig,keyState,numRows,numColumns){if(!isFlatgridState(keyState)){console.error('Layout does not support setGridSize');}else{keyState.setGridSize(numRows,numColumns);}}},state:KeyingState});var set$2=function set$2(component,replaceConfig,replaceState,data){preserve$1(function(){var newChildren=map$2(data,component.getSystem().build);replaceChildren(component,newChildren);},component.element);};var insert=function insert(component,replaceConfig,insertion,childSpec){var child=component.getSystem().build(childSpec);attachWith(component,child,insertion);};var append=function append(component,replaceConfig,replaceState,appendee){insert(component,replaceConfig,append$2,appendee);};var prepend=function prepend(component,replaceConfig,replaceState,prependee){insert(component,replaceConfig,prepend$1,prependee);};var remove=function remove(component,replaceConfig,replaceState,removee){var children=contents(component);var foundChild=find$5(children,function(child){return eq(removee.element,child.element);});foundChild.each(detach);};var contents=function contents(component,_replaceConfig){return component.components();};var replaceAt=function replaceAt(component,replaceConfig,replaceState,replaceeIndex,replacer){var children=contents(component);return Optional.from(children[replaceeIndex]).map(function(replacee){remove(component,replaceConfig,replaceState,replacee);replacer.each(function(r){insert(component,replaceConfig,function(p,c){appendAt(p,c,replaceeIndex);},r);});return replacee;});};var replaceBy=function replaceBy(component,replaceConfig,replaceState,replaceePred,replacer){var children=contents(component);return findIndex$1(children,replaceePred).bind(function(replaceeIndex){return replaceAt(component,replaceConfig,replaceState,replaceeIndex,replacer);});};var ReplaceApis=/*#__PURE__*/Object.freeze({__proto__:null,append:append,prepend:prepend,remove:remove,replaceAt:replaceAt,replaceBy:replaceBy,set:set$2,contents:contents});var Replacing=create$8({fields:[],name:'replacing',apis:ReplaceApis});var events$d=function events$d(name,eventHandlers){var events=derive$2(eventHandlers);return create$8({fields:[required$1('enabled')],name:name,active:{events:constant$1(events)}});};var config=function config(name,eventHandlers){var me=events$d(name,eventHandlers);return{key:name,value:{config:{},me:me,configAsRaw:constant$1({}),initialConfig:{},state:NoState}};};var focus$2=function focus$2(component,focusConfig){if(!focusConfig.ignore){focus$3(component.element);focusConfig.onFocus(component);}};var blur=function blur(component,focusConfig){if(!focusConfig.ignore){blur$1(component.element);}};var isFocused=function isFocused(component){return hasFocus(component.element);};var FocusApis=/*#__PURE__*/Object.freeze({__proto__:null,focus:focus$2,blur:blur,isFocused:isFocused});var exhibit$4=function exhibit$4(base,focusConfig){var mod=focusConfig.ignore?{}:{attributes:{tabindex:'-1'}};return nu$7(mod);};var events$c=function events$c(focusConfig){return derive$2([run$1(focus$4(),function(component,simulatedEvent){focus$2(component,focusConfig);simulatedEvent.stop();})].concat(focusConfig.stopMousedown?[run$1(mousedown(),function(_,simulatedEvent){simulatedEvent.event.prevent();})]:[]));};var ActiveFocus=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$4,events:events$c});var FocusSchema=[onHandler('onFocus'),defaulted('stopMousedown',false),defaulted('ignore',false)];var Focusing=create$8({fields:FocusSchema,name:'focusing',active:ActiveFocus,apis:FocusApis});var SetupBehaviourCellState=function SetupBehaviourCellState(initialState){var init=function init(){var cell=Cell(initialState);var get=function get(){return cell.get();};var set=function set(newState){return cell.set(newState);};var clear=function clear(){return cell.set(initialState);};var readState=function readState(){return cell.get();};return{get:get,set:set,clear:clear,readState:readState};};return{init:init};};var updateAriaState=function updateAriaState(component,toggleConfig,toggleState){var ariaInfo=toggleConfig.aria;ariaInfo.update(component,ariaInfo,toggleState.get());};var updateClass=function updateClass(component,toggleConfig,toggleState){toggleConfig.toggleClass.each(function(toggleClass){if(toggleState.get()){add$2(component.element,toggleClass);}else{remove$2(component.element,toggleClass);}});};var toggle$2=function toggle$2(component,toggleConfig,toggleState){set$1(component,toggleConfig,toggleState,!toggleState.get());};var on=function on(component,toggleConfig,toggleState){toggleState.set(true);updateClass(component,toggleConfig,toggleState);updateAriaState(component,toggleConfig,toggleState);};var off=function off(component,toggleConfig,toggleState){toggleState.set(false);updateClass(component,toggleConfig,toggleState);updateAriaState(component,toggleConfig,toggleState);};var set$1=function set$1(component,toggleConfig,toggleState,state){var action=state?on:off;action(component,toggleConfig,toggleState);};var isOn=function isOn(component,toggleConfig,toggleState){return toggleState.get();};var onLoad=function onLoad(component,toggleConfig,toggleState){set$1(component,toggleConfig,toggleState,toggleConfig.selected);};var ToggleApis=/*#__PURE__*/Object.freeze({__proto__:null,onLoad:onLoad,toggle:toggle$2,isOn:isOn,on:on,off:off,set:set$1});var exhibit$3=function exhibit$3(){return nu$7({});};var events$b=function events$b(toggleConfig,toggleState){var execute=executeEvent(toggleConfig,toggleState,toggle$2);var load=loadEvent(toggleConfig,toggleState,onLoad);return derive$2(flatten([toggleConfig.toggleOnExecute?[execute]:[],[load]]));};var ActiveToggle=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$3,events:events$b});var updatePressed=function updatePressed(component,ariaInfo,status){set$8(component.element,'aria-pressed',status);if(ariaInfo.syncWithExpanded){updateExpanded(component,ariaInfo,status);}};var updateSelected=function updateSelected(component,ariaInfo,status){set$8(component.element,'aria-selected',status);};var updateChecked=function updateChecked(component,ariaInfo,status){set$8(component.element,'aria-checked',status);};var updateExpanded=function updateExpanded(component,ariaInfo,status){set$8(component.element,'aria-expanded',status);};var ToggleSchema=[defaulted('selected',false),option('toggleClass'),defaulted('toggleOnExecute',true),defaultedOf('aria',{mode:'none'},choose$1('mode',{pressed:[defaulted('syncWithExpanded',false),output$1('update',updatePressed)],checked:[output$1('update',updateChecked)],expanded:[output$1('update',updateExpanded)],selected:[output$1('update',updateSelected)],none:[output$1('update',noop)]}))];var Toggling=create$8({fields:ToggleSchema,name:'toggling',active:ActiveToggle,apis:ToggleApis,state:SetupBehaviourCellState(false)});var pointerEvents=function pointerEvents(){var onClick=function onClick(component,simulatedEvent){simulatedEvent.stop();emitExecute(component);};return[run$1(click(),onClick),run$1(tap(),onClick),cutter(touchstart()),cutter(mousedown())];};var events$a=function events$a(optAction){var executeHandler=function executeHandler(action){return runOnExecute$1(function(component,simulatedEvent){action(component);simulatedEvent.stop();});};return derive$2(flatten([optAction.map(executeHandler).toArray(),pointerEvents()]));};var hoverEvent='alloy.item-hover';var focusEvent='alloy.item-focus';var onHover=function onHover(item){if(search(item.element).isNone()||Focusing.isFocused(item)){if(!Focusing.isFocused(item)){Focusing.focus(item);}emitWith(item,hoverEvent,{item:item});}};var onFocus$1=function onFocus$1(item){emitWith(item,focusEvent,{item:item});};var hover=constant$1(hoverEvent);var focus$1=constant$1(focusEvent);var builder$2=function builder$2(detail){return{dom:detail.dom,domModification:_assign(_assign({},detail.domModification),{attributes:_assign(_assign(_assign({'role':detail.toggling.isSome()?'menuitemcheckbox':'menuitem'},detail.domModification.attributes),{'aria-haspopup':detail.hasSubmenu}),detail.hasSubmenu?{'aria-expanded':false}:{})}),behaviours:SketchBehaviours.augment(detail.itemBehaviours,[detail.toggling.fold(Toggling.revoke,function(tConfig){return Toggling.config(_assign({aria:{mode:'checked'}},tConfig));}),Focusing.config({ignore:detail.ignoreFocus,stopMousedown:detail.ignoreFocus,onFocus:function onFocus(component){onFocus$1(component);}}),Keying.config({mode:'execution'}),Representing.config({store:{mode:'memory',initialValue:detail.data}}),config('item-type-events',__spreadArray(__spreadArray([],pointerEvents(),true),[run$1(mouseover(),onHover),run$1(focusItem(),Focusing.focus)],false))]),components:detail.components,eventOrder:detail.eventOrder};};var schema$p=[required$1('data'),required$1('components'),required$1('dom'),defaulted('hasSubmenu',false),option('toggling'),SketchBehaviours.field('itemBehaviours',[Toggling,Focusing,Keying,Representing]),defaulted('ignoreFocus',false),defaulted('domModification',{}),output$1('builder',builder$2),defaulted('eventOrder',{})];var builder$1=function builder$1(detail){return{dom:detail.dom,components:detail.components,events:derive$2([stopper(focusItem())])};};var schema$o=[required$1('dom'),required$1('components'),output$1('builder',builder$1)];var owner$2=constant$1('item-widget');var parts$h=constant$1([required({name:'widget',overrides:function overrides(detail){return{behaviours:derive$1([Representing.config({store:{mode:'manual',getValue:function getValue(_component){return detail.data;},setValue:noop}})])};}})]);var builder=function builder(detail){var subs=substitutes(owner$2(),detail,parts$h());var components=components$1(owner$2(),detail,subs.internals());var focusWidget=function focusWidget(component){return getPart(component,detail,'widget').map(function(widget){Keying.focusIn(widget);return widget;});};var onHorizontalArrow=function onHorizontalArrow(component,simulatedEvent){return inside(simulatedEvent.event.target)?Optional.none():function(){if(detail.autofocus){simulatedEvent.setSource(component.element);return Optional.none();}else{return Optional.none();}}();};return{dom:detail.dom,components:components,domModification:detail.domModification,events:derive$2([runOnExecute$1(function(component,simulatedEvent){focusWidget(component).each(function(_widget){simulatedEvent.stop();});}),run$1(mouseover(),onHover),run$1(focusItem(),function(component,_simulatedEvent){if(detail.autofocus){focusWidget(component);}else{Focusing.focus(component);}})]),behaviours:SketchBehaviours.augment(detail.widgetBehaviours,[Representing.config({store:{mode:'memory',initialValue:detail.data}}),Focusing.config({ignore:detail.ignoreFocus,onFocus:function onFocus(component){onFocus$1(component);}}),Keying.config({mode:'special',focusIn:detail.autofocus?function(component){focusWidget(component);}:revoke(),onLeft:onHorizontalArrow,onRight:onHorizontalArrow,onEscape:function onEscape(component,simulatedEvent){if(!Focusing.isFocused(component)&&!detail.autofocus){Focusing.focus(component);return Optional.some(true);}else if(detail.autofocus){simulatedEvent.setSource(component.element);return Optional.none();}else{return Optional.none();}}})])};};var schema$n=[required$1('uid'),required$1('data'),required$1('components'),required$1('dom'),defaulted('autofocus',false),defaulted('ignoreFocus',false),SketchBehaviours.field('widgetBehaviours',[Representing,Focusing,Keying]),defaulted('domModification',{}),defaultUidsSchema(parts$h()),output$1('builder',builder)];var itemSchema$2=choose$1('type',{widget:schema$n,item:schema$p,separator:schema$o});var configureGrid=function configureGrid(detail,movementInfo){return{mode:'flatgrid',selector:'.'+detail.markers.item,initSize:{numColumns:movementInfo.initSize.numColumns,numRows:movementInfo.initSize.numRows},focusManager:detail.focusManager};};var configureMatrix=function configureMatrix(detail,movementInfo){return{mode:'matrix',selectors:{row:movementInfo.rowSelector,cell:'.'+detail.markers.item},focusManager:detail.focusManager};};var configureMenu=function configureMenu(detail,movementInfo){return{mode:'menu',selector:'.'+detail.markers.item,moveOnTab:movementInfo.moveOnTab,focusManager:detail.focusManager};};var parts$g=constant$1([group({factory:{sketch:function sketch(spec){var itemInfo=asRawOrDie$1('menu.spec item',itemSchema$2,spec);return itemInfo.builder(itemInfo);}},name:'items',unit:'item',defaults:function defaults(detail,u){return has$2(u,'uid')?u:_assign(_assign({},u),{uid:generate$5('item')});},overrides:function overrides(detail,u){return{type:u.type,ignoreFocus:detail.fakeFocus,domModification:{classes:[detail.markers.item]}};}})]);var schema$m=constant$1([required$1('value'),required$1('items'),required$1('dom'),required$1('components'),defaulted('eventOrder',{}),field('menuBehaviours',[Highlighting,Representing,Composing,Keying]),defaultedOf('movement',{mode:'menu',moveOnTab:true},choose$1('mode',{grid:[initSize(),output$1('config',configureGrid)],matrix:[output$1('config',configureMatrix),required$1('rowSelector')],menu:[defaulted('moveOnTab',true),output$1('config',configureMenu)]})),itemMarkers(),defaulted('fakeFocus',false),defaulted('focusManager',dom$2()),onHandler('onHighlight')]);var focus=constant$1('alloy.menu-focus');var make$7=function make$7(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.menuBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedItem,itemClass:detail.markers.item,onHighlight:detail.onHighlight}),Representing.config({store:{mode:'memory',initialValue:detail.value}}),Composing.config({find:Optional.some}),Keying.config(detail.movement.config(detail,detail.movement))]),events:derive$2([run$1(focus$1(),function(menu,simulatedEvent){var event=simulatedEvent.event;menu.getSystem().getByDom(event.target).each(function(item){Highlighting.highlight(menu,item);simulatedEvent.stop();emitWith(menu,focus(),{menu:menu,item:item});});}),run$1(hover(),function(menu,simulatedEvent){var item=simulatedEvent.event.item;Highlighting.highlight(menu,item);})]),components:components,eventOrder:detail.eventOrder,domModification:{attributes:{role:'menu'}}};};var Menu=composite({name:'Menu',configFields:schema$m(),partFields:parts$g(),factory:make$7});var transpose$1=function transpose$1(obj){return tupleMap(obj,function(v,k){return{k:v,v:k};});};var _trace=function trace(items,byItem,byMenu,finish){return get$e(byMenu,finish).bind(function(triggerItem){return get$e(items,triggerItem).bind(function(triggerMenu){var rest=_trace(items,byItem,byMenu,triggerMenu);return Optional.some([triggerMenu].concat(rest));});}).getOr([]);};var generate$2=function generate$2(menus,expansions){var items={};each(menus,function(menuItems,menu){each$1(menuItems,function(item){items[item]=menu;});});var byItem=expansions;var byMenu=transpose$1(expansions);var menuPaths=map$1(byMenu,function(_triggerItem,submenu){return[submenu].concat(_trace(items,byItem,byMenu,submenu));});return map$1(items,function(menu){return get$e(menuPaths,menu).getOr([menu]);});};var init$c=function init$c(){var expansions=Cell({});var menus=Cell({});var paths=Cell({});var primary=value$1();var directory=Cell({});var clear=function clear(){expansions.set({});menus.set({});paths.set({});primary.clear();};var isClear=function isClear(){return primary.get().isNone();};var setMenuBuilt=function setMenuBuilt(menuName,built){var _a;menus.set(_assign(_assign({},menus.get()),(_a={},_a[menuName]={type:'prepared',menu:built},_a)));};var setContents=function setContents(sPrimary,sMenus,sExpansions,dir){primary.set(sPrimary);expansions.set(sExpansions);menus.set(sMenus);directory.set(dir);var sPaths=generate$2(dir,sExpansions);paths.set(sPaths);};var getTriggeringItem=function getTriggeringItem(menuValue){return find$4(expansions.get(),function(v,_k){return v===menuValue;});};var getTriggerData=function getTriggerData(menuValue,getItemByValue,path){return getPreparedMenu(menuValue).bind(function(menu){return getTriggeringItem(menuValue).bind(function(triggeringItemValue){return getItemByValue(triggeringItemValue).map(function(triggeredItem){return{triggeredMenu:menu,triggeringItem:triggeredItem,triggeringPath:path};});});});};var getTriggeringPath=function getTriggeringPath(itemValue,getItemByValue){var extraPath=filter$2(lookupItem(itemValue).toArray(),function(menuValue){return getPreparedMenu(menuValue).isSome();});return get$e(paths.get(),itemValue).bind(function(path){var revPath=reverse(extraPath.concat(path));var triggers=bind$3(revPath,function(menuValue,menuIndex){return getTriggerData(menuValue,getItemByValue,revPath.slice(0,menuIndex+1)).fold(function(){return is$1(primary.get(),menuValue)?[]:[Optional.none()];},function(data){return[Optional.some(data)];});});return sequence(triggers);});};var expand=function expand(itemValue){return get$e(expansions.get(),itemValue).map(function(menu){var current=get$e(paths.get(),itemValue).getOr([]);return[menu].concat(current);});};var collapse=function collapse(itemValue){return get$e(paths.get(),itemValue).bind(function(path){return path.length>1?Optional.some(path.slice(1)):Optional.none();});};var refresh=function refresh(itemValue){return get$e(paths.get(),itemValue);};var getPreparedMenu=function getPreparedMenu(menuValue){return lookupMenu(menuValue).bind(extractPreparedMenu);};var lookupMenu=function lookupMenu(menuValue){return get$e(menus.get(),menuValue);};var lookupItem=function lookupItem(itemValue){return get$e(expansions.get(),itemValue);};var otherMenus=function otherMenus(path){var menuValues=directory.get();return difference(keys(menuValues),path);};var getPrimary=function getPrimary(){return primary.get().bind(getPreparedMenu);};var getMenus=function getMenus(){return menus.get();};return{setMenuBuilt:setMenuBuilt,setContents:setContents,expand:expand,refresh:refresh,collapse:collapse,lookupMenu:lookupMenu,lookupItem:lookupItem,otherMenus:otherMenus,getPrimary:getPrimary,getMenus:getMenus,clear:clear,isClear:isClear,getTriggeringPath:getTriggeringPath};};var extractPreparedMenu=function extractPreparedMenu(prep){return prep.type==='prepared'?Optional.some(prep.menu):Optional.none();};var LayeredState={init:init$c,extractPreparedMenu:extractPreparedMenu};var make$6=function make$6(detail,_rawUiSpec){var submenuParentItems=value$1();var buildMenus=function buildMenus(container,primaryName,menus){return map$1(menus,function(spec,name){var makeSketch=function makeSketch(){return Menu.sketch(_assign(_assign({},spec),{value:name,markers:detail.markers,fakeFocus:detail.fakeFocus,onHighlight:detail.onHighlight,focusManager:detail.fakeFocus?highlights():dom$2()}));};return name===primaryName?{type:'prepared',menu:container.getSystem().build(makeSketch())}:{type:'notbuilt',nbMenu:makeSketch};});};var layeredState=LayeredState.init();var setup=function setup(container){var componentMap=buildMenus(container,detail.data.primary,detail.data.menus);var directory=toDirectory();layeredState.setContents(detail.data.primary,componentMap,detail.data.expansions,directory);return layeredState.getPrimary();};var getItemValue=function getItemValue(item){return Representing.getValue(item).value;};var getItemByValue=function getItemByValue(_container,menus,itemValue){return findMap(menus,function(menu){if(!menu.getSystem().isConnected()){return Optional.none();}var candidates=Highlighting.getCandidates(menu);return find$5(candidates,function(c){return getItemValue(c)===itemValue;});});};var toDirectory=function toDirectory(_container){return map$1(detail.data.menus,function(data,_menuName){return bind$3(data.items,function(item){return item.type==='separator'?[]:[item.data.value];});});};var setActiveMenu=function setActiveMenu(container,menu){Highlighting.highlight(container,menu);Highlighting.getHighlighted(menu).orThunk(function(){return Highlighting.getFirst(menu);}).each(function(item){dispatch(container,item.element,focusItem());});};var getMenus=function getMenus(state,menuValues){return cat(map$2(menuValues,function(mv){return state.lookupMenu(mv).bind(function(prep){return prep.type==='prepared'?Optional.some(prep.menu):Optional.none();});}));};var closeOthers=function closeOthers(container,state,path){var others=getMenus(state,state.otherMenus(path));each$1(others,function(o){remove$1(o.element,[detail.markers.backgroundMenu]);if(!detail.stayInDom){Replacing.remove(container,o);}});};var getSubmenuParents=function getSubmenuParents(container){return submenuParentItems.get().getOrThunk(function(){var r={};var items=descendants(container.element,'.'+detail.markers.item);var parentItems=filter$2(items,function(i){return get$d(i,'aria-haspopup')==='true';});each$1(parentItems,function(i){container.getSystem().getByDom(i).each(function(itemComp){var key=getItemValue(itemComp);r[key]=itemComp;});});submenuParentItems.set(r);return r;});};var updateAriaExpansions=function updateAriaExpansions(container,path){var parentItems=getSubmenuParents(container);each(parentItems,function(v,k){var expanded=contains$2(path,k);set$8(v.element,'aria-expanded',expanded);});};var updateMenuPath=function updateMenuPath(container,state,path){return Optional.from(path[0]).bind(function(latestMenuName){return state.lookupMenu(latestMenuName).bind(function(menuPrep){if(menuPrep.type==='notbuilt'){return Optional.none();}else{var activeMenu=menuPrep.menu;var rest=getMenus(state,path.slice(1));each$1(rest,function(r){add$2(r.element,detail.markers.backgroundMenu);});if(!_inBody(activeMenu.element)){Replacing.append(container,premade(activeMenu));}remove$1(activeMenu.element,[detail.markers.backgroundMenu]);setActiveMenu(container,activeMenu);closeOthers(container,state,path);return Optional.some(activeMenu);}});});};var ExpandHighlightDecision;(function(ExpandHighlightDecision){ExpandHighlightDecision[ExpandHighlightDecision['HighlightSubmenu']=0]='HighlightSubmenu';ExpandHighlightDecision[ExpandHighlightDecision['HighlightParent']=1]='HighlightParent';})(ExpandHighlightDecision||(ExpandHighlightDecision={}));var buildIfRequired=function buildIfRequired(container,menuName,menuPrep){if(menuPrep.type==='notbuilt'){var menu=container.getSystem().build(menuPrep.nbMenu());layeredState.setMenuBuilt(menuName,menu);return menu;}else{return menuPrep.menu;}};var expandRight=function expandRight(container,item,decision){if(decision===void 0){decision=ExpandHighlightDecision.HighlightSubmenu;}if(item.hasConfigured(Disabling)&&Disabling.isDisabled(item)){return Optional.some(item);}else{var value=getItemValue(item);return layeredState.expand(value).bind(function(path){updateAriaExpansions(container,path);return Optional.from(path[0]).bind(function(menuName){return layeredState.lookupMenu(menuName).bind(function(activeMenuPrep){var activeMenu=buildIfRequired(container,menuName,activeMenuPrep);if(!_inBody(activeMenu.element)){Replacing.append(container,premade(activeMenu));}detail.onOpenSubmenu(container,item,activeMenu,reverse(path));if(decision===ExpandHighlightDecision.HighlightSubmenu){Highlighting.highlightFirst(activeMenu);return updateMenuPath(container,layeredState,path);}else{Highlighting.dehighlightAll(activeMenu);return Optional.some(item);}});});});}};var collapseLeft=function collapseLeft(container,item){var value=getItemValue(item);return layeredState.collapse(value).bind(function(path){updateAriaExpansions(container,path);return updateMenuPath(container,layeredState,path).map(function(activeMenu){detail.onCollapseMenu(container,item,activeMenu);return activeMenu;});});};var updateView=function updateView(container,item){var value=getItemValue(item);return layeredState.refresh(value).bind(function(path){updateAriaExpansions(container,path);return updateMenuPath(container,layeredState,path);});};var onRight=function onRight(container,item){return inside(item.element)?Optional.none():expandRight(container,item,ExpandHighlightDecision.HighlightSubmenu);};var onLeft=function onLeft(container,item){return inside(item.element)?Optional.none():collapseLeft(container,item);};var onEscape=function onEscape(container,item){return collapseLeft(container,item).orThunk(function(){return detail.onEscape(container,item).map(function(){return container;});});};var keyOnItem=function keyOnItem(f){return function(container,simulatedEvent){return closest$1(simulatedEvent.getSource(),'.'+detail.markers.item).bind(function(target){return container.getSystem().getByDom(target).toOptional().bind(function(item){return f(container,item).map(always);});});};};var events=derive$2([run$1(focus(),function(sandbox,simulatedEvent){var item=simulatedEvent.event.item;layeredState.lookupItem(getItemValue(item)).each(function(){var menu=simulatedEvent.event.menu;Highlighting.highlight(sandbox,menu);var value=getItemValue(simulatedEvent.event.item);layeredState.refresh(value).each(function(path){return closeOthers(sandbox,layeredState,path);});});}),runOnExecute$1(function(component,simulatedEvent){var target=simulatedEvent.event.target;component.getSystem().getByDom(target).each(function(item){var itemValue=getItemValue(item);if(itemValue.indexOf('collapse-item')===0){collapseLeft(component,item);}expandRight(component,item,ExpandHighlightDecision.HighlightSubmenu).fold(function(){detail.onExecute(component,item);},noop);});}),runOnAttached(function(container,_simulatedEvent){setup(container).each(function(primary){Replacing.append(container,premade(primary));detail.onOpenMenu(container,primary);if(detail.highlightImmediately){setActiveMenu(container,primary);}});})].concat(detail.navigateOnHover?[run$1(hover(),function(sandbox,simulatedEvent){var item=simulatedEvent.event.item;updateView(sandbox,item);expandRight(sandbox,item,ExpandHighlightDecision.HighlightParent);detail.onHover(sandbox,item);})]:[]));var getActiveItem=function getActiveItem(container){return Highlighting.getHighlighted(container).bind(Highlighting.getHighlighted);};var collapseMenuApi=function collapseMenuApi(container){getActiveItem(container).each(function(currentItem){collapseLeft(container,currentItem);});};var highlightPrimary=function highlightPrimary(container){layeredState.getPrimary().each(function(primary){setActiveMenu(container,primary);});};var extractMenuFromContainer=function extractMenuFromContainer(container){return Optional.from(container.components()[0]).filter(function(comp){return get$d(comp.element,'role')==='menu';});};var repositionMenus=function repositionMenus(container){var maybeActivePrimary=layeredState.getPrimary().bind(function(primary){return getActiveItem(container).bind(function(currentItem){var itemValue=getItemValue(currentItem);var allMenus=values(layeredState.getMenus());var preparedMenus=cat(map$2(allMenus,LayeredState.extractPreparedMenu));return layeredState.getTriggeringPath(itemValue,function(v){return getItemByValue(container,preparedMenus,v);});}).map(function(triggeringPath){return{primary:primary,triggeringPath:triggeringPath};});});maybeActivePrimary.fold(function(){extractMenuFromContainer(container).each(function(primaryMenu){detail.onRepositionMenu(container,primaryMenu,[]);});},function(_a){var primary=_a.primary,triggeringPath=_a.triggeringPath;detail.onRepositionMenu(container,primary,triggeringPath);});};var apis={collapseMenu:collapseMenuApi,highlightPrimary:highlightPrimary,repositionMenus:repositionMenus};return{uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.tmenuBehaviours,[Keying.config({mode:'special',onRight:keyOnItem(onRight),onLeft:keyOnItem(onLeft),onEscape:keyOnItem(onEscape),focusIn:function focusIn(container,_keyInfo){layeredState.getPrimary().each(function(primary){dispatch(container,primary.element,focusItem());});}}),Highlighting.config({highlightClass:detail.markers.selectedMenu,itemClass:detail.markers.menu}),Composing.config({find:function find(container){return Highlighting.getHighlighted(container);}}),Replacing.config({})]),eventOrder:detail.eventOrder,apis:apis,events:events};};var collapseItem$1=constant$1('collapse-item');var tieredData=function tieredData(primary,menus,expansions){return{primary:primary,menus:menus,expansions:expansions};};var singleData=function singleData(name,menu){return{primary:name,menus:wrap$1(name,menu),expansions:{}};};var collapseItem=function collapseItem(text){return{value:generate$6(collapseItem$1()),meta:{text:text}};};var tieredMenu=single({name:'TieredMenu',configFields:[onStrictKeyboardHandler('onExecute'),onStrictKeyboardHandler('onEscape'),onStrictHandler('onOpenMenu'),onStrictHandler('onOpenSubmenu'),onHandler('onRepositionMenu'),onHandler('onCollapseMenu'),defaulted('highlightImmediately',true),requiredObjOf('data',[required$1('primary'),required$1('menus'),required$1('expansions')]),defaulted('fakeFocus',false),onHandler('onHighlight'),onHandler('onHover'),tieredMenuMarkers(),required$1('dom'),defaulted('navigateOnHover',true),defaulted('stayInDom',false),field('tmenuBehaviours',[Keying,Highlighting,Composing,Replacing]),defaulted('eventOrder',{})],apis:{collapseMenu:function collapseMenu(apis,tmenu){apis.collapseMenu(tmenu);},highlightPrimary:function highlightPrimary(apis,tmenu){apis.highlightPrimary(tmenu);},repositionMenus:function repositionMenus(apis,tmenu){apis.repositionMenus(tmenu);}},factory:make$6,extraApis:{tieredData:tieredData,singleData:singleData,collapseItem:collapseItem}});var makeMenu=function makeMenu(detail,menuSandbox,placementSpec,menuSpec,getBounds){var lazySink=function lazySink(){return detail.lazySink(menuSandbox);};var layouts=menuSpec.type==='horizontal'?{layouts:{onLtr:function onLtr(){return belowOrAbove();},onRtl:function onRtl(){return belowOrAboveRtl();}}}:{};var isFirstTierSubmenu=function isFirstTierSubmenu(triggeringPaths){return triggeringPaths.length===2;};var getSubmenuLayouts=function getSubmenuLayouts(triggeringPaths){return isFirstTierSubmenu(triggeringPaths)?layouts:{};};return tieredMenu.sketch({dom:{tag:'div'},data:menuSpec.data,markers:menuSpec.menu.markers,highlightImmediately:menuSpec.menu.highlightImmediately,onEscape:function onEscape(){Sandboxing.close(menuSandbox);detail.onEscape.map(function(handler){return handler(menuSandbox);});return Optional.some(true);},onExecute:function onExecute(){return Optional.some(true);},onOpenMenu:function onOpenMenu(tmenu,menu){Positioning.positionWithinBounds(lazySink().getOrDie(),menu,placementSpec,getBounds());},onOpenSubmenu:function onOpenSubmenu(tmenu,item,submenu,triggeringPaths){var sink=lazySink().getOrDie();Positioning.position(sink,submenu,{anchor:_assign({type:'submenu',item:item},getSubmenuLayouts(triggeringPaths))});},onRepositionMenu:function onRepositionMenu(tmenu,primaryMenu,submenuTriggers){var sink=lazySink().getOrDie();Positioning.positionWithinBounds(sink,primaryMenu,placementSpec,getBounds());each$1(submenuTriggers,function(st){var submenuLayouts=getSubmenuLayouts(st.triggeringPath);Positioning.position(sink,st.triggeredMenu,{anchor:_assign({type:'submenu',item:st.triggeringItem},submenuLayouts)});});}});};var factory$m=function factory$m(detail,spec){var isPartOfRelated=function isPartOfRelated(sandbox,queryElem){var related=detail.getRelated(sandbox);return related.exists(function(rel){return isPartOf$1(rel,queryElem);});};var setContent=function setContent(sandbox,thing){Sandboxing.setContent(sandbox,thing);};var showAt=function showAt(sandbox,thing,placementSpec){showWithin(sandbox,thing,placementSpec,Optional.none());};var showWithin=function showWithin(sandbox,thing,placementSpec,boxElement){showWithinBounds(sandbox,thing,placementSpec,function(){return boxElement.map(function(elem){return box$1(elem);});});};var showWithinBounds=function showWithinBounds(sandbox,thing,placementSpec,getBounds){var sink=detail.lazySink(sandbox).getOrDie();Sandboxing.openWhileCloaked(sandbox,thing,function(){return Positioning.positionWithinBounds(sink,sandbox,placementSpec,getBounds());});Representing.setValue(sandbox,Optional.some({mode:'position',config:placementSpec,getBounds:getBounds}));};var showMenuAt=function showMenuAt(sandbox,placementSpec,menuSpec){showMenuWithinBounds(sandbox,placementSpec,menuSpec,Optional.none);};var showMenuWithinBounds=function showMenuWithinBounds(sandbox,placementSpec,menuSpec,getBounds){var menu=makeMenu(detail,sandbox,placementSpec,menuSpec,getBounds);Sandboxing.open(sandbox,menu);Representing.setValue(sandbox,Optional.some({mode:'menu',menu:menu}));};var hide=function hide(sandbox){if(Sandboxing.isOpen(sandbox)){Representing.setValue(sandbox,Optional.none());Sandboxing.close(sandbox);}};var getContent=function getContent(sandbox){return Sandboxing.getState(sandbox);};var reposition=function reposition(sandbox){if(Sandboxing.isOpen(sandbox)){Representing.getValue(sandbox).each(function(state){switch(state.mode){case'menu':Sandboxing.getState(sandbox).each(tieredMenu.repositionMenus);break;case'position':var sink=detail.lazySink(sandbox).getOrDie();Positioning.positionWithinBounds(sink,sandbox,state.config,state.getBounds());break;}});}};var apis={setContent:setContent,showAt:showAt,showWithin:showWithin,showWithinBounds:showWithinBounds,showMenuAt:showMenuAt,showMenuWithinBounds:showMenuWithinBounds,hide:hide,getContent:getContent,reposition:reposition,isOpen:Sandboxing.isOpen};return{uid:detail.uid,dom:detail.dom,behaviours:augment(detail.inlineBehaviours,[Sandboxing.config({isPartOf:function isPartOf(sandbox,data,queryElem){return isPartOf$1(data,queryElem)||isPartOfRelated(sandbox,queryElem);},getAttachPoint:function getAttachPoint(sandbox){return detail.lazySink(sandbox).getOrDie();},onOpen:function onOpen(sandbox){detail.onShow(sandbox);},onClose:function onClose(sandbox){detail.onHide(sandbox);}}),Representing.config({store:{mode:'memory',initialValue:Optional.none()}}),Receiving.config({channels:_assign(_assign({},receivingChannel$1(_assign({isExtraPart:spec.isExtraPart},detail.fireDismissalEventInstead.map(function(fe){return{fireEventInstead:{event:fe.event}};}).getOr({})))),receivingChannel(_assign(_assign({},detail.fireRepositionEventInstead.map(function(fe){return{fireEventInstead:{event:fe.event}};}).getOr({})),{doReposition:reposition})))})]),eventOrder:detail.eventOrder,apis:apis};};var InlineView=single({name:'InlineView',configFields:[required$1('lazySink'),onHandler('onShow'),onHandler('onHide'),optionFunction('onEscape'),field('inlineBehaviours',[Sandboxing,Representing,Receiving]),optionObjOf('fireDismissalEventInstead',[defaulted('event',dismissRequested())]),optionObjOf('fireRepositionEventInstead',[defaulted('event',repositionRequested())]),defaulted('getRelated',Optional.none),defaulted('isExtraPart',never),defaulted('eventOrder',Optional.none)],factory:factory$m,apis:{showAt:function showAt(apis,component,anchor,thing){apis.showAt(component,anchor,thing);},showWithin:function showWithin(apis,component,anchor,thing,boxElement){apis.showWithin(component,anchor,thing,boxElement);},showWithinBounds:function showWithinBounds(apis,component,anchor,thing,bounds){apis.showWithinBounds(component,anchor,thing,bounds);},showMenuAt:function showMenuAt(apis,component,anchor,menuSpec){apis.showMenuAt(component,anchor,menuSpec);},showMenuWithinBounds:function showMenuWithinBounds(apis,component,anchor,menuSpec,bounds){apis.showMenuWithinBounds(component,anchor,menuSpec,bounds);},hide:function hide(apis,component){apis.hide(component);},isOpen:function isOpen(apis,component){return apis.isOpen(component);},getContent:function getContent(apis,component){return apis.getContent(component);},setContent:function setContent(apis,component,thing){apis.setContent(component,thing);},reposition:function reposition(apis,component){apis.reposition(component);}}});var labelPrefix='layout-inset';var westEdgeX=function westEdgeX(anchor){return anchor.x;};var middleX=function middleX(anchor,element){return anchor.x+anchor.width/2-element.width/2;};var eastEdgeX=function eastEdgeX(anchor,element){return anchor.x+anchor.width-element.width;};var northY=function northY(anchor){return anchor.y;};var southY=function southY(anchor,element){return anchor.y+anchor.height-element.height;};var centreY=function centreY(anchor,element){return anchor.y+anchor.height/2-element.height/2;};var southwest=function southwest(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),southY(anchor,element),bubbles.insetSouthwest(),northwest$3(),'southwest',boundsRestriction(anchor,{right:0,bottom:3}),labelPrefix);};var southeast=function southeast(anchor,element,bubbles){return nu$6(westEdgeX(anchor),southY(anchor,element),bubbles.insetSoutheast(),northeast$3(),'southeast',boundsRestriction(anchor,{left:1,bottom:3}),labelPrefix);};var northwest=function northwest(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),northY(anchor),bubbles.insetNorthwest(),southwest$3(),'northwest',boundsRestriction(anchor,{right:0,top:2}),labelPrefix);};var northeast=function northeast(anchor,element,bubbles){return nu$6(westEdgeX(anchor),northY(anchor),bubbles.insetNortheast(),southeast$3(),'northeast',boundsRestriction(anchor,{left:1,top:2}),labelPrefix);};var north=function north(anchor,element,bubbles){return nu$6(middleX(anchor,element),northY(anchor),bubbles.insetNorth(),south$3(),'north',boundsRestriction(anchor,{top:2}),labelPrefix);};var south=function south(anchor,element,bubbles){return nu$6(middleX(anchor,element),southY(anchor,element),bubbles.insetSouth(),north$3(),'south',boundsRestriction(anchor,{bottom:3}),labelPrefix);};var east=function east(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),centreY(anchor,element),bubbles.insetEast(),west$3(),'east',boundsRestriction(anchor,{right:0}),labelPrefix);};var west=function west(anchor,element,bubbles){return nu$6(westEdgeX(anchor),centreY(anchor,element),bubbles.insetWest(),east$3(),'west',boundsRestriction(anchor,{left:1}),labelPrefix);};var lookupPreserveLayout=function lookupPreserveLayout(lastPlacement){switch(lastPlacement){case'north':return north;case'northeast':return northeast;case'northwest':return northwest;case'south':return south;case'southeast':return southeast;case'southwest':return southwest;case'east':return east;case'west':return west;}};var preserve=function preserve(anchor,element,bubbles,placee,bounds){var layout=getPlacement(placee).map(lookupPreserveLayout).getOr(north);return layout(anchor,element,bubbles,placee,bounds);};var lookupFlippedLayout=function lookupFlippedLayout(lastPlacement){switch(lastPlacement){case'north':return south;case'northeast':return southeast;case'northwest':return southwest;case'south':return north;case'southeast':return northeast;case'southwest':return northwest;case'east':return west;case'west':return east;}};var flip$2=function flip$2(anchor,element,bubbles,placee,bounds){var layout=getPlacement(placee).map(lookupFlippedLayout).getOr(north);return layout(anchor,element,bubbles,placee,bounds);};var global$f=tinymce.util.Tools.resolve('tinymce.util.Delay');var factory$l=function factory$l(detail){var events=events$a(detail.action);var tag=detail.dom.tag;var lookupAttr=function lookupAttr(attr){return get$e(detail.dom,'attributes').bind(function(attrs){return get$e(attrs,attr);});};var getModAttributes=function getModAttributes(){if(tag==='button'){var type=lookupAttr('type').getOr('button');var roleAttrs=lookupAttr('role').map(function(role){return{role:role};}).getOr({});return _assign({type:type},roleAttrs);}else{var role=lookupAttr('role').getOr('button');return{role:role};}};return{uid:detail.uid,dom:detail.dom,components:detail.components,events:events,behaviours:SketchBehaviours.augment(detail.buttonBehaviours,[Focusing.config({}),Keying.config({mode:'execution',useSpace:true,useEnter:true})]),domModification:{attributes:getModAttributes()},eventOrder:detail.eventOrder};};var Button=single({name:'Button',factory:factory$l,configFields:[defaulted('uid',undefined),required$1('dom'),defaulted('components',[]),SketchBehaviours.field('buttonBehaviours',[Focusing,Keying]),option('action'),option('role'),defaulted('eventOrder',{})]});var getAttrs=function getAttrs(elem){var attributes=elem.dom.attributes!==undefined?elem.dom.attributes:[];return foldl(attributes,function(b,attr){var _a;if(attr.name==='class'){return b;}else{return _assign(_assign({},b),(_a={},_a[attr.name]=attr.value,_a));}},{});};var getClasses=function getClasses(elem){return Array.prototype.slice.call(elem.dom.classList,0);};var fromHtml=function fromHtml(html){var elem=SugarElement.fromHtml(html);var children$1=children(elem);var attrs=getAttrs(elem);var classes=getClasses(elem);var contents=children$1.length===0?{}:{innerHtml:get$7(elem)};return _assign({tag:name$2(elem),classes:classes,attributes:attrs},contents);};var record=function record(spec){var uid=isSketchSpec(spec)&&hasNonNullableKey(spec,'uid')?spec.uid:generate$5('memento');var get=function get(anyInSystem){return anyInSystem.getSystem().getByUid(uid).getOrDie();};var getOpt=function getOpt(anyInSystem){return anyInSystem.getSystem().getByUid(uid).toOptional();};var asSpec=function asSpec(){return _assign(_assign({},spec),{uid:uid});};return{get:get,getOpt:getOpt,asSpec:asSpec};};function _typeof(obj){'@babel/helpers - typeof';return _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj;},_typeof(obj);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _isNativeReflectConstruct(){if(typeof Reflect==='undefined'||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==='function')return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _iterableToArray(iter){if(typeof Symbol!=='undefined'&&iter[Symbol.iterator]!=null||iter['@@iterator']!=null)return Array.from(iter);}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==='string')return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==='Object'&&o.constructor)n=o.constructor.name;if(n==='Map'||n==='Set')return Array.from(o);if(n==='Arguments'||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}function _nonIterableSpread(){throw new TypeError('Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.');}var hasOwnProperty=Object.hasOwnProperty,setPrototypeOf=Object.setPrototypeOf,isFrozen=Object.isFrozen,getPrototypeOf=Object.getPrototypeOf,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;var freeze=Object.freeze,seal=Object.seal,create$5=Object.create;var _ref=typeof Reflect!=='undefined'&&Reflect,apply$1=_ref.apply,construct=_ref.construct;if(!apply$1){apply$1=function apply(fun,thisValue,args){return fun.apply(thisValue,args);};}if(!freeze){freeze=function freeze(x){return x;};}if(!seal){seal=function seal(x){return x;};}if(!construct){construct=function construct(Func,args){return _construct(Func,_toConsumableArray(args));};}var arrayForEach=unapply(Array.prototype.forEach);var arrayPop=unapply(Array.prototype.pop);var arrayPush=unapply(Array.prototype.push);var stringToLowerCase=unapply(String.prototype.toLowerCase);var stringMatch=unapply(String.prototype.match);var stringReplace=unapply(String.prototype.replace);var stringIndexOf=unapply(String.prototype.indexOf);var stringTrim=unapply(String.prototype.trim);var regExpTest=unapply(RegExp.prototype.test);var typeErrorCreate=unconstruct(TypeError);function unapply(func){return function(thisArg){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}return apply$1(func,thisArg,args);};}function unconstruct(func){return function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return construct(func,args);};}function addToSet(set,array){if(setPrototypeOf){setPrototypeOf(set,null);}var l=array.length;while(l--){var element=array[l];if(typeof element==='string'){var lcElement=stringToLowerCase(element);if(lcElement!==element){if(!isFrozen(array)){array[l]=lcElement;}element=lcElement;}}set[element]=true;}return set;}function clone$1(object){var newObject=create$5(null);var property;for(property in object){if(apply$1(hasOwnProperty,object,[property])){newObject[property]=object[property];}}return newObject;}function lookupGetter(object,prop){while(object!==null){var desc=getOwnPropertyDescriptor(object,prop);if(desc){if(desc.get){return unapply(desc.get);}if(typeof desc.value==='function'){return unapply(desc.value);}}object=getPrototypeOf(object);}function fallbackValue(element){console.warn('fallback value for',element);return null;}return fallbackValue;}var html$1=freeze(['a','abbr','acronym','address','area','article','aside','audio','b','bdi','bdo','big','blink','blockquote','body','br','button','canvas','caption','center','cite','code','col','colgroup','content','data','datalist','dd','decorator','del','details','dfn','dialog','dir','div','dl','dt','element','em','fieldset','figcaption','figure','font','footer','form','h1','h2','h3','h4','h5','h6','head','header','hgroup','hr','html','i','img','input','ins','kbd','label','legend','li','main','map','mark','marquee','menu','menuitem','meter','nav','nobr','ol','optgroup','option','output','p','picture','pre','progress','q','rp','rt','ruby','s','samp','section','select','shadow','small','source','spacer','span','strike','strong','style','sub','summary','sup','table','tbody','td','template','textarea','tfoot','th','thead','time','tr','track','tt','u','ul','var','video','wbr']);var svg$1=freeze(['svg','a','altglyph','altglyphdef','altglyphitem','animatecolor','animatemotion','animatetransform','circle','clippath','defs','desc','ellipse','filter','font','g','glyph','glyphref','hkern','image','line','lineargradient','marker','mask','metadata','mpath','path','pattern','polygon','polyline','radialgradient','rect','stop','style','switch','symbol','text','textpath','title','tref','tspan','view','vkern']);var svgFilters=freeze(['feBlend','feColorMatrix','feComponentTransfer','feComposite','feConvolveMatrix','feDiffuseLighting','feDisplacementMap','feDistantLight','feFlood','feFuncA','feFuncB','feFuncG','feFuncR','feGaussianBlur','feImage','feMerge','feMergeNode','feMorphology','feOffset','fePointLight','feSpecularLighting','feSpotLight','feTile','feTurbulence']);var svgDisallowed=freeze(['animate','color-profile','cursor','discard','fedropshadow','font-face','font-face-format','font-face-name','font-face-src','font-face-uri','foreignobject','hatch','hatchpath','mesh','meshgradient','meshpatch','meshrow','missing-glyph','script','set','solidcolor','unknown','use']);var mathMl$1=freeze(['math','menclose','merror','mfenced','mfrac','mglyph','mi','mlabeledtr','mmultiscripts','mn','mo','mover','mpadded','mphantom','mroot','mrow','ms','mspace','msqrt','mstyle','msub','msup','msubsup','mtable','mtd','mtext','mtr','munder','munderover']);var mathMlDisallowed=freeze(['maction','maligngroup','malignmark','mlongdiv','mscarries','mscarry','msgroup','mstack','msline','msrow','semantics','annotation','annotation-xml','mprescripts','none']);var text=freeze(['#text']);var html=freeze(['accept','action','align','alt','autocapitalize','autocomplete','autopictureinpicture','autoplay','background','bgcolor','border','capture','cellpadding','cellspacing','checked','cite','class','clear','color','cols','colspan','controls','controlslist','coords','crossorigin','datetime','decoding','default','dir','disabled','disablepictureinpicture','disableremoteplayback','download','draggable','enctype','enterkeyhint','face','for','headers','height','hidden','high','href','hreflang','id','inputmode','integrity','ismap','kind','label','lang','list','loading','loop','low','max','maxlength','media','method','min','minlength','multiple','muted','name','nonce','noshade','novalidate','nowrap','open','optimum','pattern','placeholder','playsinline','poster','preload','pubdate','radiogroup','readonly','rel','required','rev','reversed','role','rows','rowspan','spellcheck','scope','selected','shape','size','sizes','span','srclang','start','src','srcset','step','style','summary','tabindex','title','translate','type','usemap','valign','value','width','xmlns','slot']);var svg=freeze(['accent-height','accumulate','additive','alignment-baseline','ascent','attributename','attributetype','azimuth','basefrequency','baseline-shift','begin','bias','by','class','clip','clippathunits','clip-path','clip-rule','color','color-interpolation','color-interpolation-filters','color-profile','color-rendering','cx','cy','d','dx','dy','diffuseconstant','direction','display','divisor','dur','edgemode','elevation','end','fill','fill-opacity','fill-rule','filter','filterunits','flood-color','flood-opacity','font-family','font-size','font-size-adjust','font-stretch','font-style','font-variant','font-weight','fx','fy','g1','g2','glyph-name','glyphref','gradientunits','gradienttransform','height','href','id','image-rendering','in','in2','k','k1','k2','k3','k4','kerning','keypoints','keysplines','keytimes','lang','lengthadjust','letter-spacing','kernelmatrix','kernelunitlength','lighting-color','local','marker-end','marker-mid','marker-start','markerheight','markerunits','markerwidth','maskcontentunits','maskunits','max','mask','media','method','mode','min','name','numoctaves','offset','operator','opacity','order','orient','orientation','origin','overflow','paint-order','path','pathlength','patterncontentunits','patterntransform','patternunits','points','preservealpha','preserveaspectratio','primitiveunits','r','rx','ry','radius','refx','refy','repeatcount','repeatdur','restart','result','rotate','scale','seed','shape-rendering','specularconstant','specularexponent','spreadmethod','startoffset','stddeviation','stitchtiles','stop-color','stop-opacity','stroke-dasharray','stroke-dashoffset','stroke-linecap','stroke-linejoin','stroke-miterlimit','stroke-opacity','stroke','stroke-width','style','surfacescale','systemlanguage','tabindex','targetx','targety','transform','transform-origin','text-anchor','text-decoration','text-rendering','textlength','type','u1','u2','unicode','values','viewbox','visibility','version','vert-adv-y','vert-origin-x','vert-origin-y','width','word-spacing','wrap','writing-mode','xchannelselector','ychannelselector','x','x1','x2','xmlns','y','y1','y2','z','zoomandpan']);var mathMl=freeze(['accent','accentunder','align','bevelled','close','columnsalign','columnlines','columnspan','denomalign','depth','dir','display','displaystyle','encoding','fence','frame','height','href','id','largeop','length','linethickness','lspace','lquote','mathbackground','mathcolor','mathsize','mathvariant','maxsize','minsize','movablelimits','notation','numalign','open','rowalign','rowlines','rowspacing','rowspan','rspace','rquote','scriptlevel','scriptminsize','scriptsizemultiplier','selection','separator','separators','stretchy','subscriptshift','supscriptshift','symmetric','voffset','width','xmlns']);var xml=freeze(['xlink:href','xml:id','xlink:title','xml:space','xmlns:xlink']);var MUSTACHE_EXPR=seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm);var ERB_EXPR=seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);var DATA_ATTR=seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]/);var ARIA_ATTR=seal(/^aria-[\\-\\w]+$/);var IS_ALLOWED_URI=seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i);var IS_SCRIPT_OR_DATA=seal(/^(?:\\w+script|data):/i);var ATTR_WHITESPACE=seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g);var DOCTYPE_NAME=seal(/^html$/i);var getGlobal=function getGlobal(){return typeof window==='undefined'?null:window;};var _createTrustedTypesPolicy=function _createTrustedTypesPolicy(trustedTypes,document){if(_typeof(trustedTypes)!=='object'||typeof trustedTypes.createPolicy!=='function'){return null;}var suffix=null;var ATTR_NAME='data-tt-policy-suffix';if(document.currentScript&&document.currentScript.hasAttribute(ATTR_NAME)){suffix=document.currentScript.getAttribute(ATTR_NAME);}var policyName='dompurify'+(suffix?'#'+suffix:'');try{return trustedTypes.createPolicy(policyName,{createHTML:function createHTML(html){return html;}});}catch(_){console.warn('TrustedTypes policy '+policyName+' could not be created.');return null;}};function createDOMPurify(){var window=arguments.length>0&&arguments[0]!==undefined?arguments[0]:getGlobal();var DOMPurify=function DOMPurify(root){return createDOMPurify(root);};DOMPurify.version='2.3.8';DOMPurify.removed=[];if(!window||!window.document||window.document.nodeType!==9){DOMPurify.isSupported=false;return DOMPurify;}var originalDocument=window.document;var document=window.document;var DocumentFragment=window.DocumentFragment,HTMLTemplateElement=window.HTMLTemplateElement,Node=window.Node,Element=window.Element,NodeFilter=window.NodeFilter,_window$NamedNodeMap=window.NamedNodeMap,NamedNodeMap=_window$NamedNodeMap===void 0?window.NamedNodeMap||window.MozNamedAttrMap:_window$NamedNodeMap,HTMLFormElement=window.HTMLFormElement,DOMParser=window.DOMParser,trustedTypes=window.trustedTypes;var ElementPrototype=Element.prototype;var cloneNode=lookupGetter(ElementPrototype,'cloneNode');var getNextSibling=lookupGetter(ElementPrototype,'nextSibling');var getChildNodes=lookupGetter(ElementPrototype,'childNodes');var getParentNode=lookupGetter(ElementPrototype,'parentNode');if(typeof HTMLTemplateElement==='function'){var template=document.createElement('template');if(template.content&&template.content.ownerDocument){document=template.content.ownerDocument;}}var trustedTypesPolicy=_createTrustedTypesPolicy(trustedTypes,originalDocument);var emptyHTML=trustedTypesPolicy?trustedTypesPolicy.createHTML(''):'';var _document=document,implementation=_document.implementation,createNodeIterator=_document.createNodeIterator,createDocumentFragment=_document.createDocumentFragment,getElementsByTagName=_document.getElementsByTagName;var importNode=originalDocument.importNode;var documentMode={};try{documentMode=clone$1(document).documentMode?document.documentMode:{};}catch(_){}var hooks={};DOMPurify.isSupported=typeof getParentNode==='function'&&implementation&&typeof implementation.createHTMLDocument!=='undefined'&&documentMode!==9;var MUSTACHE_EXPR$1=MUSTACHE_EXPR,ERB_EXPR$1=ERB_EXPR,DATA_ATTR$1=DATA_ATTR,ARIA_ATTR$1=ARIA_ATTR,IS_SCRIPT_OR_DATA$1=IS_SCRIPT_OR_DATA,ATTR_WHITESPACE$1=ATTR_WHITESPACE;var IS_ALLOWED_URI$1=IS_ALLOWED_URI;var ALLOWED_TAGS=null;var DEFAULT_ALLOWED_TAGS=addToSet({},[].concat(_toConsumableArray(html$1),_toConsumableArray(svg$1),_toConsumableArray(svgFilters),_toConsumableArray(mathMl$1),_toConsumableArray(text)));var ALLOWED_ATTR=null;var DEFAULT_ALLOWED_ATTR=addToSet({},[].concat(_toConsumableArray(html),_toConsumableArray(svg),_toConsumableArray(mathMl),_toConsumableArray(xml)));var CUSTOM_ELEMENT_HANDLING=Object.seal(Object.create(null,{tagNameCheck:{writable:true,configurable:false,enumerable:true,value:null},attributeNameCheck:{writable:true,configurable:false,enumerable:true,value:null},allowCustomizedBuiltInElements:{writable:true,configurable:false,enumerable:true,value:false}}));var FORBID_TAGS=null;var FORBID_ATTR=null;var ALLOW_ARIA_ATTR=true;var ALLOW_DATA_ATTR=true;var ALLOW_UNKNOWN_PROTOCOLS=false;var SAFE_FOR_TEMPLATES=false;var WHOLE_DOCUMENT=false;var SET_CONFIG=false;var FORCE_BODY=false;var RETURN_DOM=false;var RETURN_DOM_FRAGMENT=false;var RETURN_TRUSTED_TYPE=false;var SANITIZE_DOM=true;var KEEP_CONTENT=true;var IN_PLACE=false;var USE_PROFILES={};var FORBID_CONTENTS=null;var DEFAULT_FORBID_CONTENTS=addToSet({},['annotation-xml','audio','colgroup','desc','foreignobject','head','iframe','math','mi','mn','mo','ms','mtext','noembed','noframes','noscript','plaintext','script','style','svg','template','thead','title','video','xmp']);var DATA_URI_TAGS=null;var DEFAULT_DATA_URI_TAGS=addToSet({},['audio','video','img','source','image','track']);var URI_SAFE_ATTRIBUTES=null;var DEFAULT_URI_SAFE_ATTRIBUTES=addToSet({},['alt','class','for','id','label','name','pattern','placeholder','role','summary','title','value','style','xmlns']);var MATHML_NAMESPACE='http://www.w3.org/1998/Math/MathML';var SVG_NAMESPACE='http://www.w3.org/2000/svg';var HTML_NAMESPACE='http://www.w3.org/1999/xhtml';var NAMESPACE=HTML_NAMESPACE;var IS_EMPTY_INPUT=false;var PARSER_MEDIA_TYPE;var SUPPORTED_PARSER_MEDIA_TYPES=['application/xhtml+xml','text/html'];var DEFAULT_PARSER_MEDIA_TYPE='text/html';var transformCaseFunc;var CONFIG=null;var formElement=document.createElement('form');var isRegexOrFunction=function isRegexOrFunction(testValue){return testValue instanceof RegExp||testValue instanceof Function;};var _parseConfig=function _parseConfig(cfg){if(CONFIG&&CONFIG===cfg){return;}if(!cfg||_typeof(cfg)!=='object'){cfg={};}cfg=clone$1(cfg);ALLOWED_TAGS='ALLOWED_TAGS'in cfg?addToSet({},cfg.ALLOWED_TAGS):DEFAULT_ALLOWED_TAGS;ALLOWED_ATTR='ALLOWED_ATTR'in cfg?addToSet({},cfg.ALLOWED_ATTR):DEFAULT_ALLOWED_ATTR;URI_SAFE_ATTRIBUTES='ADD_URI_SAFE_ATTR'in cfg?addToSet(clone$1(DEFAULT_URI_SAFE_ATTRIBUTES),cfg.ADD_URI_SAFE_ATTR):DEFAULT_URI_SAFE_ATTRIBUTES;DATA_URI_TAGS='ADD_DATA_URI_TAGS'in cfg?addToSet(clone$1(DEFAULT_DATA_URI_TAGS),cfg.ADD_DATA_URI_TAGS):DEFAULT_DATA_URI_TAGS;FORBID_CONTENTS='FORBID_CONTENTS'in cfg?addToSet({},cfg.FORBID_CONTENTS):DEFAULT_FORBID_CONTENTS;FORBID_TAGS='FORBID_TAGS'in cfg?addToSet({},cfg.FORBID_TAGS):{};FORBID_ATTR='FORBID_ATTR'in cfg?addToSet({},cfg.FORBID_ATTR):{};USE_PROFILES='USE_PROFILES'in cfg?cfg.USE_PROFILES:false;ALLOW_ARIA_ATTR=cfg.ALLOW_ARIA_ATTR!==false;ALLOW_DATA_ATTR=cfg.ALLOW_DATA_ATTR!==false;ALLOW_UNKNOWN_PROTOCOLS=cfg.ALLOW_UNKNOWN_PROTOCOLS||false;SAFE_FOR_TEMPLATES=cfg.SAFE_FOR_TEMPLATES||false;WHOLE_DOCUMENT=cfg.WHOLE_DOCUMENT||false;RETURN_DOM=cfg.RETURN_DOM||false;RETURN_DOM_FRAGMENT=cfg.RETURN_DOM_FRAGMENT||false;RETURN_TRUSTED_TYPE=cfg.RETURN_TRUSTED_TYPE||false;FORCE_BODY=cfg.FORCE_BODY||false;SANITIZE_DOM=cfg.SANITIZE_DOM!==false;KEEP_CONTENT=cfg.KEEP_CONTENT!==false;IN_PLACE=cfg.IN_PLACE||false;IS_ALLOWED_URI$1=cfg.ALLOWED_URI_REGEXP||IS_ALLOWED_URI$1;NAMESPACE=cfg.NAMESPACE||HTML_NAMESPACE;if(cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)){CUSTOM_ELEMENT_HANDLING.tagNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;}if(cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)){CUSTOM_ELEMENT_HANDLING.attributeNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;}if(cfg.CUSTOM_ELEMENT_HANDLING&&typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements==='boolean'){CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;}PARSER_MEDIA_TYPE=SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE)===-1?PARSER_MEDIA_TYPE=DEFAULT_PARSER_MEDIA_TYPE:PARSER_MEDIA_TYPE=cfg.PARSER_MEDIA_TYPE;transformCaseFunc=PARSER_MEDIA_TYPE==='application/xhtml+xml'?function(x){return x;}:stringToLowerCase;if(SAFE_FOR_TEMPLATES){ALLOW_DATA_ATTR=false;}if(RETURN_DOM_FRAGMENT){RETURN_DOM=true;}if(USE_PROFILES){ALLOWED_TAGS=addToSet({},_toConsumableArray(text));ALLOWED_ATTR=[];if(USE_PROFILES.html===true){addToSet(ALLOWED_TAGS,html$1);addToSet(ALLOWED_ATTR,html);}if(USE_PROFILES.svg===true){addToSet(ALLOWED_TAGS,svg$1);addToSet(ALLOWED_ATTR,svg);addToSet(ALLOWED_ATTR,xml);}if(USE_PROFILES.svgFilters===true){addToSet(ALLOWED_TAGS,svgFilters);addToSet(ALLOWED_ATTR,svg);addToSet(ALLOWED_ATTR,xml);}if(USE_PROFILES.mathMl===true){addToSet(ALLOWED_TAGS,mathMl$1);addToSet(ALLOWED_ATTR,mathMl);addToSet(ALLOWED_ATTR,xml);}}if(cfg.ADD_TAGS){if(ALLOWED_TAGS===DEFAULT_ALLOWED_TAGS){ALLOWED_TAGS=clone$1(ALLOWED_TAGS);}addToSet(ALLOWED_TAGS,cfg.ADD_TAGS);}if(cfg.ADD_ATTR){if(ALLOWED_ATTR===DEFAULT_ALLOWED_ATTR){ALLOWED_ATTR=clone$1(ALLOWED_ATTR);}addToSet(ALLOWED_ATTR,cfg.ADD_ATTR);}if(cfg.ADD_URI_SAFE_ATTR){addToSet(URI_SAFE_ATTRIBUTES,cfg.ADD_URI_SAFE_ATTR);}if(cfg.FORBID_CONTENTS){if(FORBID_CONTENTS===DEFAULT_FORBID_CONTENTS){FORBID_CONTENTS=clone$1(FORBID_CONTENTS);}addToSet(FORBID_CONTENTS,cfg.FORBID_CONTENTS);}if(KEEP_CONTENT){ALLOWED_TAGS['#text']=true;}if(WHOLE_DOCUMENT){addToSet(ALLOWED_TAGS,['html','head','body']);}if(ALLOWED_TAGS.table){addToSet(ALLOWED_TAGS,['tbody']);delete FORBID_TAGS.tbody;}if(freeze){freeze(cfg);}CONFIG=cfg;};var MATHML_TEXT_INTEGRATION_POINTS=addToSet({},['mi','mo','mn','ms','mtext']);var HTML_INTEGRATION_POINTS=addToSet({},['foreignobject','desc','title','annotation-xml']);var COMMON_SVG_AND_HTML_ELEMENTS=addToSet({},['title','style','font','a','script']);var ALL_SVG_TAGS=addToSet({},svg$1);addToSet(ALL_SVG_TAGS,svgFilters);addToSet(ALL_SVG_TAGS,svgDisallowed);var ALL_MATHML_TAGS=addToSet({},mathMl$1);addToSet(ALL_MATHML_TAGS,mathMlDisallowed);var _checkValidNamespace=function _checkValidNamespace(element){var parent=getParentNode(element);if(!parent||!parent.tagName){parent={namespaceURI:HTML_NAMESPACE,tagName:'template'};}var tagName=stringToLowerCase(element.tagName);var parentTagName=stringToLowerCase(parent.tagName);if(element.namespaceURI===SVG_NAMESPACE){if(parent.namespaceURI===HTML_NAMESPACE){return tagName==='svg';}if(parent.namespaceURI===MATHML_NAMESPACE){return tagName==='svg'&&(parentTagName==='annotation-xml'||MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);}return Boolean(ALL_SVG_TAGS[tagName]);}if(element.namespaceURI===MATHML_NAMESPACE){if(parent.namespaceURI===HTML_NAMESPACE){return tagName==='math';}if(parent.namespaceURI===SVG_NAMESPACE){return tagName==='math'&&HTML_INTEGRATION_POINTS[parentTagName];}return Boolean(ALL_MATHML_TAGS[tagName]);}if(element.namespaceURI===HTML_NAMESPACE){if(parent.namespaceURI===SVG_NAMESPACE&&!HTML_INTEGRATION_POINTS[parentTagName]){return false;}if(parent.namespaceURI===MATHML_NAMESPACE&&!MATHML_TEXT_INTEGRATION_POINTS[parentTagName]){return false;}return!ALL_MATHML_TAGS[tagName]&&(COMMON_SVG_AND_HTML_ELEMENTS[tagName]||!ALL_SVG_TAGS[tagName]);}return false;};var _forceRemove=function _forceRemove(node){arrayPush(DOMPurify.removed,{element:node});try{node.parentNode.removeChild(node);}catch(_){try{node.outerHTML=emptyHTML;}catch(_){node.remove();}}};var _removeAttribute=function _removeAttribute(name,node){try{arrayPush(DOMPurify.removed,{attribute:node.getAttributeNode(name),from:node});}catch(_){arrayPush(DOMPurify.removed,{attribute:null,from:node});}node.removeAttribute(name);if(name==='is'&&!ALLOWED_ATTR[name]){if(RETURN_DOM||RETURN_DOM_FRAGMENT){try{_forceRemove(node);}catch(_){}}else{try{node.setAttribute(name,'');}catch(_){}}}};var _initDocument=function _initDocument(dirty){var doc;var leadingWhitespace;if(FORCE_BODY){dirty='<remove></remove>'+dirty;}else{var matches=stringMatch(dirty,/^[\\r\\n\\t ]+/);leadingWhitespace=matches&&matches[0];}if(PARSER_MEDIA_TYPE==='application/xhtml+xml'){dirty='<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>'+dirty+'</body></html>';}var dirtyPayload=trustedTypesPolicy?trustedTypesPolicy.createHTML(dirty):dirty;if(NAMESPACE===HTML_NAMESPACE){try{doc=new DOMParser().parseFromString(dirtyPayload,PARSER_MEDIA_TYPE);}catch(_){}}if(!doc||!doc.documentElement){doc=implementation.createDocument(NAMESPACE,'template',null);try{doc.documentElement.innerHTML=IS_EMPTY_INPUT?'':dirtyPayload;}catch(_){}}var body=doc.body||doc.documentElement;if(dirty&&leadingWhitespace){body.insertBefore(document.createTextNode(leadingWhitespace),body.childNodes[0]||null);}if(NAMESPACE===HTML_NAMESPACE){return getElementsByTagName.call(doc,WHOLE_DOCUMENT?'html':'body')[0];}return WHOLE_DOCUMENT?doc.documentElement:body;};var _createIterator=function _createIterator(root){return createNodeIterator.call(root.ownerDocument||root,root,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,null,false);};var _isClobbered=function _isClobbered(elm){return elm instanceof HTMLFormElement&&(typeof elm.nodeName!=='string'||typeof elm.textContent!=='string'||typeof elm.removeChild!=='function'||!(elm.attributes instanceof NamedNodeMap)||typeof elm.removeAttribute!=='function'||typeof elm.setAttribute!=='function'||typeof elm.namespaceURI!=='string'||typeof elm.insertBefore!=='function');};var _isNode=function _isNode(object){return _typeof(Node)==='object'?object instanceof Node:object&&_typeof(object)==='object'&&typeof object.nodeType==='number'&&typeof object.nodeName==='string';};var _executeHook=function _executeHook(entryPoint,currentNode,data){if(!hooks[entryPoint]){return;}arrayForEach(hooks[entryPoint],function(hook){hook.call(DOMPurify,currentNode,data,CONFIG);});};var _sanitizeElements=function _sanitizeElements(currentNode){var content;_executeHook('beforeSanitizeElements',currentNode,null);if(_isClobbered(currentNode)){_forceRemove(currentNode);return true;}if(regExpTest(/[\\u0080-\\uFFFF]/,currentNode.nodeName)){_forceRemove(currentNode);return true;}var tagName=transformCaseFunc(currentNode.nodeName);_executeHook('uponSanitizeElement',currentNode,{tagName:tagName,allowedTags:ALLOWED_TAGS});if(currentNode.hasChildNodes()&&!_isNode(currentNode.firstElementChild)&&(!_isNode(currentNode.content)||!_isNode(currentNode.content.firstElementChild))&&regExpTest(/<[/\\w]/g,currentNode.innerHTML)&&regExpTest(/<[/\\w]/g,currentNode.textContent)){_forceRemove(currentNode);return true;}if(tagName==='select'&&regExpTest(/<template/i,currentNode.innerHTML)){_forceRemove(currentNode);return true;}if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){if(!FORBID_TAGS[tagName]&&_basicCustomElementTest(tagName)){if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,tagName))return false;if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName))return false;}if(KEEP_CONTENT&&!FORBID_CONTENTS[tagName]){var parentNode=getParentNode(currentNode)||currentNode.parentNode;var childNodes=getChildNodes(currentNode)||currentNode.childNodes;if(childNodes&&parentNode){var childCount=childNodes.length;for(var i=childCount-1;i>=0;--i){parentNode.insertBefore(cloneNode(childNodes[i],true),getNextSibling(currentNode));}}}_forceRemove(currentNode);return true;}if(currentNode instanceof Element&&!_checkValidNamespace(currentNode)){_forceRemove(currentNode);return true;}if((tagName==='noscript'||tagName==='noembed')&&regExpTest(/<\\/no(script|embed)/i,currentNode.innerHTML)){_forceRemove(currentNode);return true;}if(SAFE_FOR_TEMPLATES&&currentNode.nodeType===3){content=currentNode.textContent;content=stringReplace(content,MUSTACHE_EXPR$1,' ');content=stringReplace(content,ERB_EXPR$1,' ');if(currentNode.textContent!==content){arrayPush(DOMPurify.removed,{element:currentNode.cloneNode()});currentNode.textContent=content;}}_executeHook('afterSanitizeElements',currentNode,null);return false;};var _isValidAttribute=function _isValidAttribute(lcTag,lcName,value){if(SANITIZE_DOM&&(lcName==='id'||lcName==='name')&&(value in document||value in formElement)){return false;}if(ALLOW_DATA_ATTR&&!FORBID_ATTR[lcName]&&regExpTest(DATA_ATTR$1,lcName));else if(ALLOW_ARIA_ATTR&&regExpTest(ARIA_ATTR$1,lcName));else if(!ALLOWED_ATTR[lcName]||FORBID_ATTR[lcName]){if(_basicCustomElementTest(lcTag)&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,lcTag)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag))&&(CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck,lcName)||CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName))||lcName==='is'&&CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,value)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(value)));else{return false;}}else if(URI_SAFE_ATTRIBUTES[lcName]);else if(regExpTest(IS_ALLOWED_URI$1,stringReplace(value,ATTR_WHITESPACE$1,'')));else if((lcName==='src'||lcName==='xlink:href'||lcName==='href')&&lcTag!=='script'&&stringIndexOf(value,'data:')===0&&DATA_URI_TAGS[lcTag]);else if(ALLOW_UNKNOWN_PROTOCOLS&&!regExpTest(IS_SCRIPT_OR_DATA$1,stringReplace(value,ATTR_WHITESPACE$1,'')));else if(!value);else{return false;}return true;};var _basicCustomElementTest=function _basicCustomElementTest(tagName){return tagName.indexOf('-')>0;};var _sanitizeAttributes=function _sanitizeAttributes(currentNode){var attr;var value;var lcName;var l;_executeHook('beforeSanitizeAttributes',currentNode,null);var attributes=currentNode.attributes;if(!attributes){return;}var hookEvent={attrName:'',attrValue:'',keepAttr:true,allowedAttributes:ALLOWED_ATTR};l=attributes.length;while(l--){attr=attributes[l];var _attr=attr,name=_attr.name,namespaceURI=_attr.namespaceURI;value=name==='value'?attr.value:stringTrim(attr.value);lcName=transformCaseFunc(name);hookEvent.attrName=lcName;hookEvent.attrValue=value;hookEvent.keepAttr=true;hookEvent.forceKeepAttr=undefined;_executeHook('uponSanitizeAttribute',currentNode,hookEvent);value=hookEvent.attrValue;if(hookEvent.forceKeepAttr){continue;}_removeAttribute(name,currentNode);if(!hookEvent.keepAttr){continue;}if(regExpTest(/\\/>/i,value)){_removeAttribute(name,currentNode);continue;}if(SAFE_FOR_TEMPLATES){value=stringReplace(value,MUSTACHE_EXPR$1,' ');value=stringReplace(value,ERB_EXPR$1,' ');}var lcTag=transformCaseFunc(currentNode.nodeName);if(!_isValidAttribute(lcTag,lcName,value)){continue;}try{if(namespaceURI){currentNode.setAttributeNS(namespaceURI,name,value);}else{currentNode.setAttribute(name,value);}arrayPop(DOMPurify.removed);}catch(_){}}_executeHook('afterSanitizeAttributes',currentNode,null);};var _sanitizeShadowDOM=function _sanitizeShadowDOM(fragment){var shadowNode;var shadowIterator=_createIterator(fragment);_executeHook('beforeSanitizeShadowDOM',fragment,null);while(shadowNode=shadowIterator.nextNode()){_executeHook('uponSanitizeShadowNode',shadowNode,null);if(_sanitizeElements(shadowNode)){continue;}if(shadowNode.content instanceof DocumentFragment){_sanitizeShadowDOM(shadowNode.content);}_sanitizeAttributes(shadowNode);}_executeHook('afterSanitizeShadowDOM',fragment,null);};DOMPurify.sanitize=function(dirty,cfg){var body;var importedNode;var currentNode;var oldNode;var returnNode;IS_EMPTY_INPUT=!dirty;if(IS_EMPTY_INPUT){dirty='<!-->';}if(typeof dirty!=='string'&&!_isNode(dirty)){if(typeof dirty.toString!=='function'){throw typeErrorCreate('toString is not a function');}else{dirty=dirty.toString();if(typeof dirty!=='string'){throw typeErrorCreate('dirty is not a string, aborting');}}}if(!DOMPurify.isSupported){if(_typeof(window.toStaticHTML)==='object'||typeof window.toStaticHTML==='function'){if(typeof dirty==='string'){return window.toStaticHTML(dirty);}if(_isNode(dirty)){return window.toStaticHTML(dirty.outerHTML);}}return dirty;}if(!SET_CONFIG){_parseConfig(cfg);}DOMPurify.removed=[];if(typeof dirty==='string'){IN_PLACE=false;}if(IN_PLACE){if(dirty.nodeName){var tagName=transformCaseFunc(dirty.nodeName);if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');}}}else if(dirty instanceof Node){body=_initDocument('<!---->');importedNode=body.ownerDocument.importNode(dirty,true);if(importedNode.nodeType===1&&importedNode.nodeName==='BODY'){body=importedNode;}else if(importedNode.nodeName==='HTML'){body=importedNode;}else{body.appendChild(importedNode);}}else{if(!RETURN_DOM&&!SAFE_FOR_TEMPLATES&&!WHOLE_DOCUMENT&&dirty.indexOf('<')===-1){return trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(dirty):dirty;}body=_initDocument(dirty);if(!body){return RETURN_DOM?null:RETURN_TRUSTED_TYPE?emptyHTML:'';}}if(body&&FORCE_BODY){_forceRemove(body.firstChild);}var nodeIterator=_createIterator(IN_PLACE?dirty:body);while(currentNode=nodeIterator.nextNode()){if(currentNode.nodeType===3&&currentNode===oldNode){continue;}if(_sanitizeElements(currentNode)){continue;}if(currentNode.content instanceof DocumentFragment){_sanitizeShadowDOM(currentNode.content);}_sanitizeAttributes(currentNode);oldNode=currentNode;}oldNode=null;if(IN_PLACE){return dirty;}if(RETURN_DOM){if(RETURN_DOM_FRAGMENT){returnNode=createDocumentFragment.call(body.ownerDocument);while(body.firstChild){returnNode.appendChild(body.firstChild);}}else{returnNode=body;}if(ALLOWED_ATTR.shadowroot){returnNode=importNode.call(originalDocument,returnNode,true);}return returnNode;}var serializedHTML=WHOLE_DOCUMENT?body.outerHTML:body.innerHTML;if(WHOLE_DOCUMENT&&ALLOWED_TAGS['!doctype']&&body.ownerDocument&&body.ownerDocument.doctype&&body.ownerDocument.doctype.name&&regExpTest(DOCTYPE_NAME,body.ownerDocument.doctype.name)){serializedHTML='<!DOCTYPE '+body.ownerDocument.doctype.name+'>\\n'+serializedHTML;}if(SAFE_FOR_TEMPLATES){serializedHTML=stringReplace(serializedHTML,MUSTACHE_EXPR$1,' ');serializedHTML=stringReplace(serializedHTML,ERB_EXPR$1,' ');}return trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(serializedHTML):serializedHTML;};DOMPurify.setConfig=function(cfg){_parseConfig(cfg);SET_CONFIG=true;};DOMPurify.clearConfig=function(){CONFIG=null;SET_CONFIG=false;};DOMPurify.isValidAttribute=function(tag,attr,value){if(!CONFIG){_parseConfig({});}var lcTag=transformCaseFunc(tag);var lcName=transformCaseFunc(attr);return _isValidAttribute(lcTag,lcName,value);};DOMPurify.addHook=function(entryPoint,hookFunction){if(typeof hookFunction!=='function'){return;}hooks[entryPoint]=hooks[entryPoint]||[];arrayPush(hooks[entryPoint],hookFunction);};DOMPurify.removeHook=function(entryPoint){if(hooks[entryPoint]){return arrayPop(hooks[entryPoint]);}};DOMPurify.removeHooks=function(entryPoint){if(hooks[entryPoint]){hooks[entryPoint]=[];}};DOMPurify.removeAllHooks=function(){hooks={};};return DOMPurify;}var purify=createDOMPurify();var sanitizeHtmlString=function sanitizeHtmlString(html){return purify().sanitize(html);};var global$e=tinymce.util.Tools.resolve('tinymce.util.I18n');var rtlTransform={'indent':true,'outdent':true,'table-insert-column-after':true,'table-insert-column-before':true,'paste-column-after':true,'paste-column-before':true,'unordered-list':true,'list-bull-circle':true,'list-bull-default':true,'list-bull-square':true};var defaultIconName='temporary-placeholder';var defaultIcon=function defaultIcon(icons){return function(){return get$e(icons,defaultIconName).getOr('!not found!');};};var getIconName=function getIconName(name,icons){var lcName=name.toLowerCase();if(global$e.isRtl()){var rtlName=ensureTrailing(lcName,'-rtl');return has$2(icons,rtlName)?rtlName:lcName;}else{return lcName;}};var lookupIcon=function lookupIcon(name,icons){return get$e(icons,getIconName(name,icons));};var get$1=function get$1(name,iconProvider){var icons=iconProvider();return lookupIcon(name,icons).getOrThunk(defaultIcon(icons));};var getOr=function getOr(name,iconProvider,fallbackIcon){var icons=iconProvider();return lookupIcon(name,icons).or(fallbackIcon).getOrThunk(defaultIcon(icons));};var needsRtlTransform=function needsRtlTransform(iconName){return global$e.isRtl()?has$2(rtlTransform,iconName):false;};var addFocusableBehaviour=function addFocusableBehaviour(){return config('add-focusable',[runOnAttached(function(comp){child(comp.element,'svg').each(function(svg){return set$8(svg,'focusable','false');});})]);};var renderIcon$2=function renderIcon$2(spec,iconName,icons,fallbackIcon){var _a,_b;var rtlIconClasses=needsRtlTransform(iconName)?['tox-icon--flip']:[];var iconHtml=get$e(icons,getIconName(iconName,icons)).or(fallbackIcon).getOrThunk(defaultIcon(icons));return{dom:{tag:spec.tag,attributes:(_a=spec.attributes)!==null&&_a!==void 0?_a:{},classes:spec.classes.concat(rtlIconClasses),innerHtml:iconHtml},behaviours:derive$1(__spreadArray(__spreadArray([],(_b=spec.behaviours)!==null&&_b!==void 0?_b:[],true),[addFocusableBehaviour()],false))};};var render$3=function render$3(iconName,spec,iconProvider,fallbackIcon){if(fallbackIcon===void 0){fallbackIcon=Optional.none();}return renderIcon$2(spec,iconName,iconProvider(),fallbackIcon);};var renderFirst=function renderFirst(iconNames,spec,iconProvider){var icons=iconProvider();var iconName=find$5(iconNames,function(name){return has$2(icons,getIconName(name,icons));});return renderIcon$2(spec,iconName.getOr(defaultIconName),icons,Optional.none());};var notificationIconMap={success:'checkmark',error:'warning',err:'error',warning:'warning',warn:'warning',info:'info'};var factory$k=function factory$k(detail){var memBannerText=record({dom:fromHtml('<p>'+sanitizeHtmlString(detail.translationProvider(detail.text))+'</p>'),behaviours:derive$1([Replacing.config({})])});var renderPercentBar=function renderPercentBar(percent){return{dom:{tag:'div',classes:['tox-bar'],attributes:{style:'width: '+percent+'%'}}};};var renderPercentText=function renderPercentText(percent){return{dom:{tag:'div',classes:['tox-text'],innerHtml:percent+'%'}};};var memBannerProgress=record({dom:{tag:'div',classes:detail.progress?['tox-progress-bar','tox-progress-indicator']:['tox-progress-bar']},components:[{dom:{tag:'div',classes:['tox-bar-container']},components:[renderPercentBar(0)]},renderPercentText(0)],behaviours:derive$1([Replacing.config({})])});var updateProgress=function updateProgress(comp,percent){if(comp.getSystem().isConnected()){memBannerProgress.getOpt(comp).each(function(progress){Replacing.set(progress,[{dom:{tag:'div',classes:['tox-bar-container']},components:[renderPercentBar(percent)]},renderPercentText(percent)]);});}};var updateText=function updateText(comp,text){if(comp.getSystem().isConnected()){var banner=memBannerText.get(comp);Replacing.set(banner,[text$1(text)]);}};var apis={updateProgress:updateProgress,updateText:updateText};var iconChoices=flatten([detail.icon.toArray(),detail.level.toArray(),detail.level.bind(function(level){return Optional.from(notificationIconMap[level]);}).toArray()]);var memButton=record(Button.sketch({dom:{tag:'button',classes:['tox-notification__dismiss','tox-button','tox-button--naked','tox-button--icon']},components:[render$3('close',{tag:'div',classes:['tox-icon'],attributes:{'aria-label':detail.translationProvider('Close')}},detail.iconProvider)],action:function action(comp){detail.onAction(comp);}}));var notificationIconSpec=renderFirst(iconChoices,{tag:'div',classes:['tox-notification__icon']},detail.iconProvider);var notificationBodySpec={dom:{tag:'div',classes:['tox-notification__body']},components:[memBannerText.asSpec()],behaviours:derive$1([Replacing.config({})])};var components=[notificationIconSpec,notificationBodySpec];return{uid:detail.uid,dom:{tag:'div',attributes:{role:'alert'},classes:detail.level.map(function(level){return['tox-notification','tox-notification--in','tox-notification--'+level];}).getOr(['tox-notification','tox-notification--in'])},behaviours:derive$1([Focusing.config({}),config('notification-events',[run$1(focusin(),function(comp){memButton.getOpt(comp).each(Focusing.focus);})])]),components:components.concat(detail.progress?[memBannerProgress.asSpec()]:[]).concat(!detail.closeButton?[]:[memButton.asSpec()]),apis:apis};};var Notification=single({name:'Notification',factory:factory$k,configFields:[option('level'),required$1('progress'),required$1('icon'),required$1('onAction'),required$1('text'),required$1('iconProvider'),required$1('translationProvider'),defaultedBoolean('closeButton',true)],apis:{updateProgress:function updateProgress(apis,comp,percent){apis.updateProgress(comp,percent);},updateText:function updateText(apis,comp,text){apis.updateText(comp,text);}}});function NotificationManagerImpl(editor,extras,uiMothership){var sharedBackstage=extras.backstage.shared;var getLayoutDirection=function getLayoutDirection(rel){switch(rel){case'bc-bc':return south;case'tc-tc':return north;case'tc-bc':return north$2;case'bc-tc':default:return south$2;}};var reposition=function reposition(notifications){if(notifications.length>0){each$1(notifications,function(notification,index){if(index===0){notification.moveRel(null,'banner');}else{notification.moveRel(notifications[index-1].getEl(),'bc-tc');}});}};var open=function open(settings,closeCallback){var hideCloseButton=!settings.closeButton&&settings.timeout&&(settings.timeout>0||settings.timeout<0);var close=function close(){closeCallback();InlineView.hide(notificationWrapper);};var notification=build$1(Notification.sketch({text:settings.text,level:contains$2(['success','error','warning','warn','info'],settings.type)?settings.type:undefined,progress:settings.progressBar===true,icon:Optional.from(settings.icon),closeButton:!hideCloseButton,onAction:close,iconProvider:sharedBackstage.providers.icons,translationProvider:sharedBackstage.providers.translate}));var notificationWrapper=build$1(InlineView.sketch(_assign({dom:{tag:'div',classes:['tox-notifications-container']},lazySink:sharedBackstage.getSink,fireDismissalEventInstead:{}},sharedBackstage.header.isPositionedAtTop()?{}:{fireRepositionEventInstead:{}})));uiMothership.add(notificationWrapper);if(settings.timeout>0){global$f.setTimeout(function(){close();},settings.timeout);}var getBounds=function getBounds(){var contentArea=box$1(SugarElement.fromDom(editor.getContentAreaContainer()));var win$1=win();var x=clamp$1(win$1.x,contentArea.x,contentArea.right);var y=clamp$1(win$1.y,contentArea.y,contentArea.bottom);var right=Math.max(contentArea.right,win$1.right);var bottom=Math.max(contentArea.bottom,win$1.bottom);return Optional.some(bounds(x,y,right-x,bottom-y));};return{close:close,moveTo:function moveTo(x,y){InlineView.showAt(notificationWrapper,premade(notification),{anchor:{type:'makeshift',x:x,y:y}});},moveRel:function moveRel(element,rel){var notificationSpec=premade(notification);var anchorOverrides={maxHeightFunction:expandable$1()};if(rel!=='banner'&&isNonNullable(element)){var layoutDirection_1=getLayoutDirection(rel);var nodeAnchor={type:'node',root:body(),node:Optional.some(SugarElement.fromDom(element)),overrides:anchorOverrides,layouts:{onRtl:function onRtl(){return[layoutDirection_1];},onLtr:function onLtr(){return[layoutDirection_1];}}};InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:nodeAnchor},getBounds);}else{var anchor=_assign(_assign({},sharedBackstage.anchors.banner()),{overrides:anchorOverrides});InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:anchor},getBounds);}},text:function text(nuText){Notification.updateText(notification,nuText);},settings:settings,getEl:function getEl(){return notification.element.dom;},progressBar:{value:function value(percent){Notification.updateProgress(notification,percent);}}};};var close=function close(notification){notification.close();};var getArgs=function getArgs(notification){return notification.settings;};return{open:open,close:close,reposition:reposition,getArgs:getArgs};}var first=function first(fn,rate){var timer=null;var cancel=function cancel(){if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}if(isNull(timer)){timer=setTimeout(function(){timer=null;fn.apply(null,args);},rate);}};return{cancel:cancel,throttle:throttle};};var last=function last(fn,rate){var timer=null;var cancel=function cancel(){if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}cancel();timer=setTimeout(function(){timer=null;fn.apply(null,args);},rate);};return{cancel:cancel,throttle:throttle};};var global$d=tinymce.util.Tools.resolve('tinymce.dom.TextSeeker');var isBoundary=function isBoundary(dom,node){return dom.isBlock(node)||contains$2(['BR','IMG','HR','INPUT'],node.nodeName)||dom.getContentEditable(node)==='false';};var repeatLeft=function repeatLeft(dom,node,offset,process,rootNode){var search=global$d(dom,function(node){return isBoundary(dom,node);});return Optional.from(search.backwards(node,offset,process,rootNode));};var autocompleteSelector='[data-mce-autocompleter]';var create$4=function create$4(editor,range){return detect(SugarElement.fromDom(editor.selection.getNode())).getOrThunk(function(){var wrapper=SugarElement.fromHtml('<span data-mce-autocompleter=\"1\" data-mce-bogus=\"1\"></span>',editor.getDoc());append$2(wrapper,SugarElement.fromDom(range.extractContents()));range.insertNode(wrapper.dom);parent(wrapper).each(function(elm){return elm.dom.normalize();});last$1(wrapper).map(function(last){editor.selection.setCursorLocation(last.dom,getEnd(last));});return wrapper;});};var detect=function detect(elm){return closest$1(elm,autocompleteSelector);};var isValidTextRange=function isValidTextRange(rng){return rng.collapsed&&rng.startContainer.nodeType===3;};var getText=function getText(rng){return rng.toString().replace(/\\u00A0/g,' ').replace(/\\uFEFF/g,'');};var isWhitespace=function isWhitespace(chr){return chr!==''&&' \\xA0\\f\\n\\r\\t\\x0B'.indexOf(chr)!==-1;};var stripTriggerChar=function stripTriggerChar(text,triggerCh){return text.substring(triggerCh.length);};var findChar=function findChar(text,index,ch){var i;for(i=index-1;i>=0;i--){var char=text.charAt(i);if(isWhitespace(char)){return Optional.none();}if(char===ch){break;}}return Optional.some(i);};var findStart=function findStart(dom,initRange,ch,minChars){if(minChars===void 0){minChars=0;}if(!isValidTextRange(initRange)){return Optional.none();}var findTriggerChIndex=function findTriggerChIndex(element,offset,text){return findChar(text,offset,ch).getOr(offset);};var root=dom.getParent(initRange.startContainer,dom.isBlock)||dom.getRoot();return repeatLeft(dom,initRange.startContainer,initRange.startOffset,findTriggerChIndex,root).bind(function(spot){var range=initRange.cloneRange();range.setStart(spot.container,spot.offset);range.setEnd(initRange.endContainer,initRange.endOffset);if(range.collapsed){return Optional.none();}var text=getText(range);var triggerCharIndex=text.lastIndexOf(ch);if(triggerCharIndex!==0||stripTriggerChar(text,ch).length<minChars){return Optional.none();}else{return Optional.some({text:stripTriggerChar(text,ch),range:range,triggerChar:ch});}});};var getContext=function getContext(dom,initRange,ch,minChars){if(minChars===void 0){minChars=0;}return detect(SugarElement.fromDom(initRange.startContainer)).fold(function(){return findStart(dom,initRange,ch,minChars);},function(elm){var range=dom.createRng();range.selectNode(elm.dom);var text=getText(range);return Optional.some({range:range,text:stripTriggerChar(text,ch),triggerChar:ch});});};var setup$e=function setup$e(api,editor){editor.on('keypress compositionend',api.onKeypress.throttle);editor.on('remove',api.onKeypress.cancel);var redirectKeyToItem=function redirectKeyToItem(item,e){emitWith(item,keydown(),{raw:e});};editor.on('keydown',function(e){var getItem=function getItem(){return api.getView().bind(Highlighting.getHighlighted);};if(e.which===8){api.onKeypress.throttle(e);}if(api.isActive()){if(e.which===27){api.cancelIfNecessary();}if(api.isMenuOpen()){if(e.which===13){getItem().each(emitExecute);e.preventDefault();}else if(e.which===40){getItem().fold(function(){api.getView().each(Highlighting.highlightFirst);},function(item){redirectKeyToItem(item,e);});e.preventDefault();e.stopImmediatePropagation();}else if(e.which===37||e.which===38||e.which===39){getItem().each(function(item){redirectKeyToItem(item,e);e.preventDefault();e.stopImmediatePropagation();});}}else{if(e.which===13||e.which===38||e.which===40){api.cancelIfNecessary();}}}});editor.on('NodeChange',function(e){if(api.isActive()&&!api.isProcessingAction()&&detect(SugarElement.fromDom(e.element)).isNone()){api.cancelIfNecessary();}});};var AutocompleterEditorEvents={setup:setup$e};var global$c=tinymce.util.Tools.resolve('tinymce.util.Promise');var point=function point(container,offset){return{container:container,offset:offset};};var isText=function isText(node){return node.nodeType===TEXT;};var isElement$1=function isElement$1(node){return node.nodeType===ELEMENT;};var _toLast=function toLast(node){if(isText(node)){return point(node,node.data.length);}else{var children=node.childNodes;return children.length>0?_toLast(children[children.length-1]):point(node,children.length);}};var _toLeaf=function toLeaf(node,offset){var children=node.childNodes;if(children.length>0&&offset<children.length){return _toLeaf(children[offset],0);}else if(children.length>0&&isElement$1(node)&&children.length===offset){return _toLast(children[children.length-1]);}else{return point(node,offset);}};var isPreviousCharContent=function isPreviousCharContent(dom,leaf){return repeatLeft(dom,leaf.container,leaf.offset,function(element,offset){return offset===0?-1:offset;},dom.getRoot()).filter(function(spot){var char=spot.container.data.charAt(spot.offset-1);return!isWhitespace(char);}).isSome();};var isStartOfWord=function isStartOfWord(dom){return function(rng){var leaf=_toLeaf(rng.startContainer,rng.startOffset);return!isPreviousCharContent(dom,leaf);};};var getTriggerContext=function getTriggerContext(dom,initRange,database){return findMap(database.triggerChars,function(ch){return getContext(dom,initRange,ch);});};var lookup$2=function lookup$2(editor,getDatabase){var database=getDatabase();var rng=editor.selection.getRng();return getTriggerContext(editor.dom,rng,database).bind(function(context){return lookupWithContext(editor,getDatabase,context);});};var lookupWithContext=function lookupWithContext(editor,getDatabase,context,fetchOptions){if(fetchOptions===void 0){fetchOptions={};}var database=getDatabase();var rng=editor.selection.getRng();var startText=rng.startContainer.nodeValue;var autocompleters=filter$2(database.lookupByChar(context.triggerChar),function(autocompleter){return context.text.length>=autocompleter.minChars&&autocompleter.matches.getOrThunk(function(){return isStartOfWord(editor.dom);})(context.range,startText,context.text);});if(autocompleters.length===0){return Optional.none();}var lookupData=global$c.all(map$2(autocompleters,function(ac){var fetchResult=ac.fetch(context.text,ac.maxResults,fetchOptions);return fetchResult.then(function(results){return{matchText:context.text,items:results,columns:ac.columns,onAction:ac.onAction,highlightOn:ac.highlightOn};});}));return Optional.some({lookupData:lookupData,context:context});};var separatorMenuItemSchema=objOf([requiredString('type'),optionString('text')]);var createSeparatorMenuItem=function createSeparatorMenuItem(spec){return asRaw('separatormenuitem',separatorMenuItemSchema,spec);};var autocompleterItemSchema=objOf([defaulted('type','autocompleteitem'),defaulted('active',false),defaulted('disabled',false),defaulted('meta',{}),requiredString('value'),optionString('text'),optionString('icon')]);var autocompleterSchema=objOf([requiredString('type'),requiredString('ch'),defaultedNumber('minChars',1),defaulted('columns',1),defaultedNumber('maxResults',10),optionFunction('matches'),requiredFunction('fetch'),requiredFunction('onAction'),defaultedArrayOf('highlightOn',[],string)]);var createSeparatorItem=function createSeparatorItem(spec){return asRaw('Autocompleter.Separator',separatorMenuItemSchema,spec);};var createAutocompleterItem=function createAutocompleterItem(spec){return asRaw('Autocompleter.Item',autocompleterItemSchema,spec);};var createAutocompleter=function createAutocompleter(spec){return asRaw('Autocompleter',autocompleterSchema,spec);};var baseToolbarButtonFields=[defaultedBoolean('disabled',false),optionString('tooltip'),optionString('icon'),optionString('text'),defaultedFunction('onSetup',function(){return noop;})];var toolbarButtonSchema=objOf([requiredString('type'),requiredFunction('onAction')].concat(baseToolbarButtonFields));var createToolbarButton=function createToolbarButton(spec){return asRaw('toolbarbutton',toolbarButtonSchema,spec);};var baseToolbarToggleButtonFields=[defaultedBoolean('active',false)].concat(baseToolbarButtonFields);var toggleButtonSchema=objOf(baseToolbarToggleButtonFields.concat([requiredString('type'),requiredFunction('onAction')]));var createToggleButton=function createToggleButton(spec){return asRaw('ToggleButton',toggleButtonSchema,spec);};var contextBarFields=[defaultedFunction('predicate',never),defaultedStringEnum('scope','node',['node','editor']),defaultedStringEnum('position','selection',['node','selection','line'])];var contextButtonFields=baseToolbarButtonFields.concat([defaulted('type','contextformbutton'),defaulted('primary',false),requiredFunction('onAction'),customField('original',identity$1)]);var contextToggleButtonFields=baseToolbarToggleButtonFields.concat([defaulted('type','contextformbutton'),defaulted('primary',false),requiredFunction('onAction'),customField('original',identity$1)]);var launchButtonFields=baseToolbarButtonFields.concat([defaulted('type','contextformbutton')]);var launchToggleButtonFields=baseToolbarToggleButtonFields.concat([defaulted('type','contextformtogglebutton')]);var toggleOrNormal=choose$1('type',{contextformbutton:contextButtonFields,contextformtogglebutton:contextToggleButtonFields});var contextFormSchema=objOf([defaulted('type','contextform'),defaultedFunction('initValue',constant$1('')),optionString('label'),requiredArrayOf('commands',toggleOrNormal),optionOf('launch',choose$1('type',{contextformbutton:launchButtonFields,contextformtogglebutton:launchToggleButtonFields}))].concat(contextBarFields));var createContextForm=function createContextForm(spec){return asRaw('ContextForm',contextFormSchema,spec);};var contextToolbarSchema=objOf([defaulted('type','contexttoolbar'),requiredString('items')].concat(contextBarFields));var createContextToolbar=function createContextToolbar(spec){return asRaw('ContextToolbar',contextToolbarSchema,spec);};var stringArray=function stringArray(a){var all={};each$1(a,function(key){all[key]={};});return keys(all);};var register$b=function register$b(editor){var popups=editor.ui.registry.getAll().popups;var dataset=map$1(popups,function(popup){return createAutocompleter(popup).fold(function(err){throw new Error(formatError(err));},identity$1);});var triggerChars=stringArray(mapToArray(dataset,function(v){return v.ch;}));var datasetValues=values(dataset);var lookupByChar=function lookupByChar(ch){return filter$2(datasetValues,function(dv){return dv.ch===ch;});};return{dataset:dataset,triggerChars:triggerChars,lookupByChar:lookupByChar};};var ItemResponse;(function(ItemResponse){ItemResponse[ItemResponse['CLOSE_ON_EXECUTE']=0]='CLOSE_ON_EXECUTE';ItemResponse[ItemResponse['BUBBLE_TO_SANDBOX']=1]='BUBBLE_TO_SANDBOX';})(ItemResponse||(ItemResponse={}));var ItemResponse$1=ItemResponse;var navClass='tox-menu-nav__js';var selectableClass='tox-collection__item';var colorClass='tox-swatch';var presetClasses={normal:navClass,color:colorClass};var tickedClass='tox-collection__item--enabled';var groupHeadingClass='tox-collection__group-heading';var iconClass='tox-collection__item-icon';var textClass='tox-collection__item-label';var accessoryClass='tox-collection__item-accessory';var caretClass='tox-collection__item-caret';var checkmarkClass='tox-collection__item-checkmark';var activeClass='tox-collection__item--active';var containerClass='tox-collection__item-container';var containerColumnClass='tox-collection__item-container--column';var containerRowClass='tox-collection__item-container--row';var containerAlignRightClass='tox-collection__item-container--align-right';var containerAlignLeftClass='tox-collection__item-container--align-left';var containerValignTopClass='tox-collection__item-container--valign-top';var containerValignMiddleClass='tox-collection__item-container--valign-middle';var containerValignBottomClass='tox-collection__item-container--valign-bottom';var classForPreset=function classForPreset(presets){return get$e(presetClasses,presets).getOr(navClass);};var forMenu=function forMenu(presets){if(presets==='color'){return'tox-swatches';}else{return'tox-menu';}};var classes=function classes(presets){return{backgroundMenu:'tox-background-menu',selectedMenu:'tox-selected-menu',selectedItem:'tox-collection__item--active',hasIcons:'tox-menu--has-icons',menu:forMenu(presets),tieredMenu:'tox-tiered-menu'};};var markers=function markers(presets){var menuClasses=classes(presets);return{backgroundMenu:menuClasses.backgroundMenu,selectedMenu:menuClasses.selectedMenu,menu:menuClasses.menu,selectedItem:menuClasses.selectedItem,item:classForPreset(presets)};};var dom$1=function dom$1(hasIcons,columns,presets){var menuClasses=classes(presets);return{tag:'div',classes:flatten([[menuClasses.menu,'tox-menu-'+columns+'-column'],hasIcons?[menuClasses.hasIcons]:[]])};};var components=[Menu.parts.items({})];var part=function part(hasIcons,columns,presets){var menuClasses=classes(presets);var d={tag:'div',classes:flatten([[menuClasses.tieredMenu]])};return{dom:d,markers:markers(presets)};};var chunk=function chunk(rowDom,numColumns){return function(items){var chunks=chunk$1(items,numColumns);return map$2(chunks,function(c){return{dom:rowDom,components:c};});};};var forSwatch=function forSwatch(columns){return{dom:{tag:'div',classes:['tox-menu','tox-swatches-menu']},components:[{dom:{tag:'div',classes:['tox-swatches']},components:[Menu.parts.items({preprocess:columns!=='auto'?chunk({tag:'div',classes:['tox-swatches__row']},columns):identity$1})]}]};};var forToolbar=function forToolbar(columns){return{dom:{tag:'div',classes:['tox-menu','tox-collection','tox-collection--toolbar','tox-collection--toolbar-lg']},components:[Menu.parts.items({preprocess:chunk({tag:'div',classes:['tox-collection__group']},columns)})]};};var preprocessCollection=function preprocessCollection(items,isSeparator){var allSplits=[];var currentSplit=[];each$1(items,function(item,i){if(isSeparator(item,i)){if(currentSplit.length>0){allSplits.push(currentSplit);}currentSplit=[];if(has$2(item.dom,'innerHtml')){currentSplit.push(item);}}else{currentSplit.push(item);}});if(currentSplit.length>0){allSplits.push(currentSplit);}return map$2(allSplits,function(s){return{dom:{tag:'div',classes:['tox-collection__group']},components:s};});};var forCollection=function forCollection(columns,initItems,_hasIcons){return{dom:{tag:'div',classes:['tox-menu','tox-collection'].concat(columns===1?['tox-collection--list']:['tox-collection--grid'])},components:[Menu.parts.items({preprocess:function preprocess(items){if(columns!=='auto'&&columns>1){return chunk({tag:'div',classes:['tox-collection__group']},columns)(items);}else{return preprocessCollection(items,function(_item,i){return initItems[i].type==='separator';});}}})]};};var forHorizontalCollection=function forHorizontalCollection(initItems,_hasIcons){return{dom:{tag:'div',classes:['tox-collection','tox-collection--horizontal']},components:[Menu.parts.items({preprocess:function preprocess(items){return preprocessCollection(items,function(_item,i){return initItems[i].type==='separator';});}})]};};var menuHasIcons=function menuHasIcons(xs){return exists(xs,function(item){return'icon'in item&&item.icon!==undefined;});};var handleError=function handleError(error){console.error(formatError(error));console.log(error);return Optional.none();};var createHorizontalPartialMenuWithAlloyItems=function createHorizontalPartialMenuWithAlloyItems(value,_hasIcons,items,_columns,_presets){var structure=forHorizontalCollection(items);return{value:value,dom:structure.dom,components:structure.components,items:items};};var createPartialMenuWithAlloyItems=function createPartialMenuWithAlloyItems(value,hasIcons,items,columns,presets){if(presets==='color'){var structure=forSwatch(columns);return{value:value,dom:structure.dom,components:structure.components,items:items};}if(presets==='normal'&&columns==='auto'){var structure=forCollection(columns,items);return{value:value,dom:structure.dom,components:structure.components,items:items};}if(presets==='normal'&&columns===1){var structure=forCollection(1,items);return{value:value,dom:structure.dom,components:structure.components,items:items};}if(presets==='normal'){var structure=forCollection(columns,items);return{value:value,dom:structure.dom,components:structure.components,items:items};}if(presets==='listpreview'&&columns!=='auto'){var structure=forToolbar(columns);return{value:value,dom:structure.dom,components:structure.components,items:items};}return{value:value,dom:dom$1(hasIcons,columns,presets),components:components,items:items};};var cardImageFields=[requiredString('type'),requiredString('src'),optionString('alt'),defaultedArrayOf('classes',[],string)];var cardImageSchema=objOf(cardImageFields);var cardTextFields=[requiredString('type'),requiredString('text'),optionString('name'),defaultedArrayOf('classes',['tox-collection__item-label'],string)];var cardTextSchema=objOf(cardTextFields);var itemSchema$1=valueThunk(function(){return choose$2('type',{cardimage:cardImageSchema,cardtext:cardTextSchema,cardcontainer:cardContainerSchema});});var cardContainerSchema=objOf([requiredString('type'),defaultedString('direction','horizontal'),defaultedString('align','left'),defaultedString('valign','middle'),requiredArrayOf('items',itemSchema$1)]);var commonMenuItemFields=[defaultedBoolean('disabled',false),optionString('text'),optionString('shortcut'),field$1('value','value',defaultedThunk(function(){return generate$6('menuitem-value');}),anyValue()),defaulted('meta',{})];var cardMenuItemSchema=objOf([requiredString('type'),optionString('label'),requiredArrayOf('items',itemSchema$1),defaultedFunction('onSetup',function(){return noop;}),defaultedFunction('onAction',noop)].concat(commonMenuItemFields));var createCardMenuItem=function createCardMenuItem(spec){return asRaw('cardmenuitem',cardMenuItemSchema,spec);};var choiceMenuItemSchema=objOf([requiredString('type'),defaultedBoolean('active',false),optionString('icon')].concat(commonMenuItemFields));var createChoiceMenuItem=function createChoiceMenuItem(spec){return asRaw('choicemenuitem',choiceMenuItemSchema,spec);};var baseFields=[requiredString('type'),requiredString('fancytype'),defaultedFunction('onAction',noop)];var insertTableFields=[defaulted('initData',{})].concat(baseFields);var colorSwatchFields=[defaultedObjOf('initData',{},[defaultedBoolean('allowCustomColors',true),optionArrayOf('colors',anyValue())])].concat(baseFields);var fancyMenuItemSchema=choose$1('fancytype',{inserttable:insertTableFields,colorswatch:colorSwatchFields});var createFancyMenuItem=function createFancyMenuItem(spec){return asRaw('fancymenuitem',fancyMenuItemSchema,spec);};var menuItemSchema=objOf([requiredString('type'),defaultedFunction('onSetup',function(){return noop;}),defaultedFunction('onAction',noop),optionString('icon')].concat(commonMenuItemFields));var createMenuItem=function createMenuItem(spec){return asRaw('menuitem',menuItemSchema,spec);};var nestedMenuItemSchema=objOf([requiredString('type'),requiredFunction('getSubmenuItems'),defaultedFunction('onSetup',function(){return noop;}),optionString('icon')].concat(commonMenuItemFields));var createNestedMenuItem=function createNestedMenuItem(spec){return asRaw('nestedmenuitem',nestedMenuItemSchema,spec);};var toggleMenuItemSchema=objOf([requiredString('type'),optionString('icon'),defaultedBoolean('active',false),defaultedFunction('onSetup',function(){return noop;}),requiredFunction('onAction')].concat(commonMenuItemFields));var createToggleMenuItem=function createToggleMenuItem(spec){return asRaw('togglemenuitem',toggleMenuItemSchema,spec);};var detectSize=function detectSize(comp,margin,selectorClass){var descendants$1=descendants(comp.element,'.'+selectorClass);if(descendants$1.length>0){var columnLength=findIndex$1(descendants$1,function(c){var thisTop=c.dom.getBoundingClientRect().top;var cTop=descendants$1[0].dom.getBoundingClientRect().top;return Math.abs(thisTop-cTop)>margin;}).getOr(descendants$1.length);return Optional.some({numColumns:columnLength,numRows:Math.ceil(descendants$1.length/columnLength)});}else{return Optional.none();}};var namedEvents=function namedEvents(name,handlers){return derive$1([config(name,handlers)]);};var unnamedEvents=function unnamedEvents(handlers){return namedEvents(generate$6('unnamed-events'),handlers);};var SimpleBehaviours={namedEvents:namedEvents,unnamedEvents:unnamedEvents};var ExclusivityChannel=generate$6('tooltip.exclusive');var ShowTooltipEvent=generate$6('tooltip.show');var HideTooltipEvent=generate$6('tooltip.hide');var hideAllExclusive=function hideAllExclusive(component,_tConfig,_tState){component.getSystem().broadcastOn([ExclusivityChannel],{});};var setComponents=function setComponents(component,tConfig,tState,specs){tState.getTooltip().each(function(tooltip){if(tooltip.getSystem().isConnected()){Replacing.set(tooltip,specs);}});};var TooltippingApis=/*#__PURE__*/Object.freeze({__proto__:null,hideAllExclusive:hideAllExclusive,setComponents:setComponents});var events$9=function events$9(tooltipConfig,state){var hide=function hide(comp){state.getTooltip().each(function(p){detach(p);tooltipConfig.onHide(comp,p);state.clearTooltip();});state.clearTimer();};var show=function show(comp){if(!state.isShowing()){hideAllExclusive(comp);var sink=tooltipConfig.lazySink(comp).getOrDie();var popup=comp.getSystem().build({dom:tooltipConfig.tooltipDom,components:tooltipConfig.tooltipComponents,events:derive$2(tooltipConfig.mode==='normal'?[run$1(mouseover(),function(_){emit(comp,ShowTooltipEvent);}),run$1(mouseout(),function(_){emit(comp,HideTooltipEvent);})]:[]),behaviours:derive$1([Replacing.config({})])});state.setTooltip(popup);attach(sink,popup);tooltipConfig.onShow(comp,popup);Positioning.position(sink,popup,{anchor:tooltipConfig.anchor(comp)});}};return derive$2(flatten([[run$1(ShowTooltipEvent,function(comp){state.resetTimer(function(){show(comp);},tooltipConfig.delay);}),run$1(HideTooltipEvent,function(comp){state.resetTimer(function(){hide(comp);},tooltipConfig.delay);}),run$1(receive(),function(comp,message){var receivingData=message;if(!receivingData.universal){if(contains$2(receivingData.channels,ExclusivityChannel)){hide(comp);}}}),runOnDetached(function(comp){hide(comp);})],tooltipConfig.mode==='normal'?[run$1(focusin(),function(comp){emit(comp,ShowTooltipEvent);}),run$1(postBlur(),function(comp){emit(comp,HideTooltipEvent);}),run$1(mouseover(),function(comp){emit(comp,ShowTooltipEvent);}),run$1(mouseout(),function(comp){emit(comp,HideTooltipEvent);})]:[run$1(highlight$1(),function(comp,_se){emit(comp,ShowTooltipEvent);}),run$1(dehighlight$1(),function(comp){emit(comp,HideTooltipEvent);})]]));};var ActiveTooltipping=/*#__PURE__*/Object.freeze({__proto__:null,events:events$9});var TooltippingSchema=[required$1('lazySink'),required$1('tooltipDom'),defaulted('exclusive',true),defaulted('tooltipComponents',[]),defaulted('delay',300),defaultedStringEnum('mode','normal',['normal','follow-highlight']),defaulted('anchor',function(comp){return{type:'hotspot',hotspot:comp,layouts:{onLtr:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2]),onRtl:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2])}};}),onHandler('onHide'),onHandler('onShow')];var init$b=function init$b(){var timer=value$1();var popup=value$1();var clearTimer=function clearTimer(){timer.on(clearTimeout);};var resetTimer=function resetTimer(f,delay){clearTimer();timer.set(setTimeout(f,delay));};var readState=constant$1('not-implemented');return nu$8({getTooltip:popup.get,isShowing:popup.isSet,setTooltip:popup.set,clearTooltip:popup.clear,clearTimer:clearTimer,resetTimer:resetTimer,readState:readState});};var TooltippingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$b});var Tooltipping=create$8({fields:TooltippingSchema,name:'tooltipping',active:ActiveTooltipping,state:TooltippingState,apis:TooltippingApis});var escape=function escape(text){return text.replace(/[.*+?^${}()|[\\]\\\\]/g,'\\\\$&');};var global$b=tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');var global$a=tinymce.util.Tools.resolve('tinymce.EditorManager');var getSkinUrl=function getSkinUrl(editor){var skin=editor.getParam('skin');var skinUrl=editor.getParam('skin_url');if(skin!==false){var skinName=skin?skin:'oxide';if(skinUrl){skinUrl=editor.documentBaseURI.toAbsolute(skinUrl);}else{skinUrl=global$a.baseURL+'/skins/ui/'+skinName;}}return skinUrl;};var isReadOnly=function isReadOnly(editor){return editor.getParam('readonly',false,'boolean');};var isSkinDisabled=function isSkinDisabled(editor){return editor.getParam('skin')===false;};var getHeightSetting=function getHeightSetting(editor){return editor.getParam('height',Math.max(editor.getElement().offsetHeight,200));};var getWidthSetting=function getWidthSetting(editor){return editor.getParam('width',global$b.DOM.getStyle(editor.getElement(),'width'));};var getMinWidthSetting=function getMinWidthSetting(editor){return Optional.from(editor.getParam('min_width')).filter(isNumber);};var getMinHeightSetting=function getMinHeightSetting(editor){return Optional.from(editor.getParam('min_height')).filter(isNumber);};var getMaxWidthSetting=function getMaxWidthSetting(editor){return Optional.from(editor.getParam('max_width')).filter(isNumber);};var getMaxHeightSetting=function getMaxHeightSetting(editor){return Optional.from(editor.getParam('max_height')).filter(isNumber);};var getUserStyleFormats=function getUserStyleFormats(editor){return Optional.from(editor.getParam('style_formats')).filter(isArray);};var isMergeStyleFormats=function isMergeStyleFormats(editor){return editor.getParam('style_formats_merge',false,'boolean');};var getLineHeightFormats=function getLineHeightFormats(editor){return editor.getParam('lineheight_formats','1 1.1 1.2 1.3 1.4 1.5 2','string').split(' ');};var getContentLanguages=function getContentLanguages(editor){return editor.getParam('content_langs',undefined,'array');};var getRemovedMenuItems=function getRemovedMenuItems(editor){return editor.getParam('removed_menuitems','');};var isMenubarEnabled=function isMenubarEnabled(editor){return editor.getParam('menubar',true,'boolean')!==false;};var isToolbarEnabled=function isToolbarEnabled(editor){var toolbar=editor.getParam('toolbar',true);var isToolbarTrue=toolbar===true;var isToolbarString=isString(toolbar);var isToolbarObjectArray=isArray(toolbar)&&toolbar.length>0;return!isMultipleToolbars(editor)&&(isToolbarObjectArray||isToolbarString||isToolbarTrue);};var getMultipleToolbarsSetting=function getMultipleToolbarsSetting(editor){var toolbars=range$2(9,function(num){return editor.getParam('toolbar'+(num+1),false,'string');});var toolbarArray=filter$2(toolbars,function(toolbar){return typeof toolbar==='string';});return toolbarArray.length>0?Optional.some(toolbarArray):Optional.none();};var isMultipleToolbars=function isMultipleToolbars(editor){return getMultipleToolbarsSetting(editor).fold(function(){var toolbar=editor.getParam('toolbar',[],'string[]');return toolbar.length>0;},always);};var ToolbarMode;(function(ToolbarMode){ToolbarMode['default']='wrap';ToolbarMode['floating']='floating';ToolbarMode['sliding']='sliding';ToolbarMode['scrolling']='scrolling';})(ToolbarMode||(ToolbarMode={}));var getToolbarMode=function getToolbarMode(editor){return editor.getParam('toolbar_mode','','string');};var ToolbarLocation;(function(ToolbarLocation){ToolbarLocation['auto']='auto';ToolbarLocation['top']='top';ToolbarLocation['bottom']='bottom';})(ToolbarLocation||(ToolbarLocation={}));var getToolbarGroups=function getToolbarGroups(editor){return editor.getParam('toolbar_groups',{},'object');};var getToolbarLocation=function getToolbarLocation(editor){return editor.getParam('toolbar_location',ToolbarLocation.auto,'string');};var isToolbarLocationBottom=function isToolbarLocationBottom(editor){return getToolbarLocation(editor)===ToolbarLocation.bottom;};var fixedContainerSelector=function fixedContainerSelector(editor){return editor.getParam('fixed_toolbar_container','','string');};var fixedToolbarContainerTarget=function fixedToolbarContainerTarget(editor){return editor.getParam('fixed_toolbar_container_target');};var isToolbarPersist=function isToolbarPersist(editor){return editor.getParam('toolbar_persist',false,'boolean');};var fixedContainerTarget=function fixedContainerTarget(editor){if(!editor.inline){return Optional.none();}var selector=fixedContainerSelector(editor);if(selector.length>0){return descendant(body(),selector);}var element=fixedToolbarContainerTarget(editor);if(isNonNullable(element)){return Optional.some(SugarElement.fromDom(element));}return Optional.none();};var useFixedContainer=function useFixedContainer(editor){return editor.inline&&fixedContainerTarget(editor).isSome();};var getUiContainer=function getUiContainer(editor){var fixedContainer=fixedContainerTarget(editor);return fixedContainer.getOrThunk(function(){return getContentContainer(getRootNode(SugarElement.fromDom(editor.getElement())));});};var isDistractionFree=function isDistractionFree(editor){return editor.inline&&!isMenubarEnabled(editor)&&!isToolbarEnabled(editor)&&!isMultipleToolbars(editor);};var isStickyToolbar=function isStickyToolbar(editor){var isStickyToolbar=editor.getParam('toolbar_sticky',false,'boolean');return(isStickyToolbar||editor.inline)&&!useFixedContainer(editor)&&!isDistractionFree(editor);};var getStickyToolbarOffset=function getStickyToolbarOffset(editor){return editor.getParam('toolbar_sticky_offset',0,'number');};var isDraggableModal$1=function isDraggableModal$1(editor){return editor.getParam('draggable_modal',false,'boolean');};var getMenus=function getMenus(editor){var menu=editor.getParam('menu');if(menu){return map$1(menu,function(menu){return _assign(_assign({},menu),{items:menu.items});});}else{return{};}};var getMenubar=function getMenubar(editor){return editor.getParam('menubar');};var getToolbar=function getToolbar(editor){return editor.getParam('toolbar',true);};var getFilePickerCallback=function getFilePickerCallback(editor){return editor.getParam('file_picker_callback');};var getFilePickerTypes=function getFilePickerTypes(editor){return editor.getParam('file_picker_types');};var getFileBrowserCallbackTypes=function getFileBrowserCallbackTypes(editor){return editor.getParam('file_browser_callback_types');};var noTypeaheadUrls=function noTypeaheadUrls(editor){return editor.getParam('typeahead_urls')===false;};var getAnchorTop=function getAnchorTop(editor){return editor.getParam('anchor_top','#top');};var getAnchorBottom=function getAnchorBottom(editor){return editor.getParam('anchor_bottom','#bottom');};var getFilePickerValidatorHandler=function getFilePickerValidatorHandler(editor){var handler=editor.getParam('file_picker_validator_handler',undefined,'function');if(handler===undefined){return editor.getParam('filepicker_validator_handler',undefined,'function');}else{return handler;}};var ReadOnlyChannel='silver.readonly';var ReadOnlyDataSchema=objOf([requiredBoolean('readonly')]);var broadcastReadonly=function broadcastReadonly(uiComponents,readonly){var outerContainer=uiComponents.outerContainer;var target=outerContainer.element;if(readonly){uiComponents.mothership.broadcastOn([dismissPopups()],{target:target});uiComponents.uiMothership.broadcastOn([dismissPopups()],{target:target});}uiComponents.mothership.broadcastOn([ReadOnlyChannel],{readonly:readonly});uiComponents.uiMothership.broadcastOn([ReadOnlyChannel],{readonly:readonly});};var setupReadonlyModeSwitch=function setupReadonlyModeSwitch(editor,uiComponents){editor.on('init',function(){if(editor.mode.isReadOnly()){broadcastReadonly(uiComponents,true);}});editor.on('SwitchMode',function(){return broadcastReadonly(uiComponents,editor.mode.isReadOnly());});if(isReadOnly(editor)){editor.setMode('readonly');}};var receivingConfig=function receivingConfig(){var _a;return Receiving.config({channels:(_a={},_a[ReadOnlyChannel]={schema:ReadOnlyDataSchema,onReceive:function onReceive(comp,data){Disabling.set(comp,data.readonly);}},_a)});};var item=function item(disabled){return Disabling.config({disabled:disabled,disableClass:'tox-collection__item--state-disabled'});};var button=function button(disabled){return Disabling.config({disabled:disabled});};var splitButton=function splitButton(disabled){return Disabling.config({disabled:disabled,disableClass:'tox-tbtn--disabled'});};var toolbarButton=function toolbarButton(disabled){return Disabling.config({disabled:disabled,disableClass:'tox-tbtn--disabled',useNative:false});};var DisablingConfigs={item:item,button:button,splitButton:splitButton,toolbarButton:toolbarButton};var runWithApi=function runWithApi(info,comp){var api=info.getApi(comp);return function(f){f(api);};};var onControlAttached=function onControlAttached(info,editorOffCell){return runOnAttached(function(comp){var run=runWithApi(info,comp);run(function(api){var onDestroy=info.onSetup(api);if(isFunction(onDestroy)){editorOffCell.set(onDestroy);}});});};var onControlDetached=function onControlDetached(getApi,editorOffCell){return runOnDetached(function(comp){return runWithApi(getApi,comp)(editorOffCell.get());});};var _a$1;var onMenuItemExecute=function onMenuItemExecute(info,itemResponse){return runOnExecute$1(function(comp,simulatedEvent){runWithApi(info,comp)(info.onAction);if(!info.triggersSubmenu&&itemResponse===ItemResponse$1.CLOSE_ON_EXECUTE){emit(comp,sandboxClose());simulatedEvent.stop();}});};var menuItemEventOrder=(_a$1={},_a$1[execute$5()]=['disabling','alloy.base.behaviour','toggling','item-events'],_a$1);var componentRenderPipeline=cat;var renderCommonItem=function renderCommonItem(spec,structure,itemResponse,providersbackstage){var editorOffCell=Cell(noop);return{type:'item',dom:structure.dom,components:componentRenderPipeline(structure.optComponents),data:spec.data,eventOrder:menuItemEventOrder,hasSubmenu:spec.triggersSubmenu,itemBehaviours:derive$1([config('item-events',[onMenuItemExecute(spec,itemResponse),onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),DisablingConfigs.item(function(){return spec.disabled||providersbackstage.isDisabled();}),receivingConfig(),Replacing.config({})].concat(spec.itemBehaviours))};};var buildData=function buildData(source){return{value:source.value,meta:_assign({text:source.text.getOr('')},source.meta)};};var global$9=tinymce.util.Tools.resolve('tinymce.Env');var convertText=function convertText(source){var mac={alt:'&#x2325;',ctrl:'&#x2303;',shift:'&#x21E7;',meta:'&#x2318;',access:'&#x2303;&#x2325;'};var other={meta:'Ctrl',access:'Shift+Alt'};var replace=global$9.mac?mac:other;var shortcut=source.split('+');var updated=map$2(shortcut,function(segment){var search=segment.toLowerCase().trim();return has$2(replace,search)?replace[search]:segment;});return global$9.mac?updated.join(''):updated.join('+');};var renderIcon$1=function renderIcon$1(name,icons,classes){if(classes===void 0){classes=[iconClass];}return render$3(name,{tag:'div',classes:classes},icons);};var renderText=function renderText(text){return{dom:{tag:'div',classes:[textClass]},components:[text$1(global$e.translate(text))]};};var renderHtml=function renderHtml(html,classes){return{dom:{tag:'div',classes:classes,innerHtml:html}};};var renderStyledText=function renderStyledText(style,text){return{dom:{tag:'div',classes:[textClass]},components:[{dom:{tag:style.tag,styles:style.styles},components:[text$1(global$e.translate(text))]}]};};var renderShortcut=function renderShortcut(shortcut){return{dom:{tag:'div',classes:[accessoryClass],innerHtml:convertText(shortcut)}};};var renderCheckmark=function renderCheckmark(icons){return renderIcon$1('checkmark',icons,[checkmarkClass]);};var renderSubmenuCaret=function renderSubmenuCaret(icons){return renderIcon$1('chevron-right',icons,[caretClass]);};var renderDownwardsCaret=function renderDownwardsCaret(icons){return renderIcon$1('chevron-down',icons,[caretClass]);};var renderContainer=function renderContainer(container,components){var directionClass=container.direction==='vertical'?containerColumnClass:containerRowClass;var alignClass=container.align==='left'?containerAlignLeftClass:containerAlignRightClass;var getValignClass=function getValignClass(){switch(container.valign){case'top':return containerValignTopClass;case'middle':return containerValignMiddleClass;case'bottom':return containerValignBottomClass;}};return{dom:{tag:'div',classes:[containerClass,directionClass,alignClass,getValignClass()]},components:components};};var renderImage=function renderImage(src,classes,alt){return{dom:{tag:'img',classes:classes,attributes:{src:src,alt:alt.getOr('')}}};};var renderColorStructure=function renderColorStructure(item,providerBackstage,fallbackIcon){var colorPickerCommand='custom';var removeColorCommand='remove';var itemText=item.ariaLabel;var itemValue=item.value;var iconSvg=item.iconContent.map(function(name){return getOr(name,providerBackstage.icons,fallbackIcon);});var getDom=function getDom(){var common=colorClass;var icon=iconSvg.getOr('');var attributes=itemText.map(function(text){return{title:providerBackstage.translate(text)};}).getOr({});var baseDom={tag:'div',attributes:attributes,classes:[common]};if(itemValue===colorPickerCommand){return _assign(_assign({},baseDom),{tag:'button',classes:__spreadArray(__spreadArray([],baseDom.classes,true),['tox-swatches__picker-btn'],false),innerHtml:icon});}else if(itemValue===removeColorCommand){return _assign(_assign({},baseDom),{classes:__spreadArray(__spreadArray([],baseDom.classes,true),['tox-swatch--remove'],false),innerHtml:icon});}else{return _assign(_assign({},baseDom),{attributes:_assign(_assign({},baseDom.attributes),{'data-mce-color':itemValue}),styles:{'background-color':itemValue}});}};return{dom:getDom(),optComponents:[]};};var renderItemDomStructure=function renderItemDomStructure(ariaLabel){var domTitle=ariaLabel.map(function(label){return{attributes:{title:global$e.translate(label)}};}).getOr({});return _assign({tag:'div',classes:[navClass,selectableClass]},domTitle);};var renderNormalItemStructure=function renderNormalItemStructure(info,providersBackstage,renderIcons,fallbackIcon){var iconSpec={tag:'div',classes:[iconClass]};var renderIcon=function renderIcon(iconName){return render$3(iconName,iconSpec,providersBackstage.icons,fallbackIcon);};var renderEmptyIcon=function renderEmptyIcon(){return Optional.some({dom:iconSpec});};var leftIcon=renderIcons?info.iconContent.map(renderIcon).orThunk(renderEmptyIcon):Optional.none();var checkmark=info.checkMark;var textRender=Optional.from(info.meta).fold(function(){return renderText;},function(meta){return has$2(meta,'style')?curry(renderStyledText,meta.style):renderText;});var content=info.htmlContent.fold(function(){return info.textContent.map(textRender);},function(html){return Optional.some(renderHtml(html,[textClass]));});var menuItem={dom:renderItemDomStructure(info.ariaLabel),optComponents:[leftIcon,content,info.shortcutContent.map(renderShortcut),checkmark,info.caret]};return menuItem;};var renderItemStructure=function renderItemStructure(info,providersBackstage,renderIcons,fallbackIcon){if(fallbackIcon===void 0){fallbackIcon=Optional.none();}if(info.presets==='color'){return renderColorStructure(info,providersBackstage,fallbackIcon);}else{return renderNormalItemStructure(info,providersBackstage,renderIcons,fallbackIcon);}};var tooltipBehaviour=function tooltipBehaviour(meta,sharedBackstage){return get$e(meta,'tooltipWorker').map(function(tooltipWorker){return[Tooltipping.config({lazySink:sharedBackstage.getSink,tooltipDom:{tag:'div',classes:['tox-tooltip-worker-container']},tooltipComponents:[],anchor:function anchor(comp){return{type:'submenu',item:comp,overrides:{maxHeightFunction:expandable$1}};},mode:'follow-highlight',onShow:function onShow(component,_tooltip){tooltipWorker(function(elm){Tooltipping.setComponents(component,[external$2({element:SugarElement.fromDom(elm)})]);});}})];}).getOr([]);};var encodeText=function encodeText(text){return global$b.DOM.encode(text);};var replaceText=function replaceText(text,matchText){var translated=global$e.translate(text);var encoded=encodeText(translated);if(matchText.length>0){var escapedMatchRegex=new RegExp(escape(matchText),'gi');return encoded.replace(escapedMatchRegex,function(match){return'<span class=\"tox-autocompleter-highlight\">'+match+'</span>';});}else{return encoded;}};var renderAutocompleteItem=function renderAutocompleteItem(spec,matchText,useText,presets,onItemValueHandler,itemResponse,sharedBackstage,renderIcons){if(renderIcons===void 0){renderIcons=true;}var structure=renderItemStructure({presets:presets,textContent:Optional.none(),htmlContent:useText?spec.text.map(function(text){return replaceText(text,matchText);}):Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:Optional.none(),checkMark:Optional.none(),caret:Optional.none(),value:spec.value},sharedBackstage.providers,renderIcons,spec.icon);return renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:constant$1({}),onAction:function onAction(_api){return onItemValueHandler(spec.value,spec.meta);},onSetup:constant$1(noop),triggersSubmenu:false,itemBehaviours:tooltipBehaviour(spec.meta,sharedBackstage)},structure,itemResponse,sharedBackstage.providers);};var _render$=function render$2(items,extras){return map$2(items,function(item){switch(item.type){case'cardcontainer':return renderContainer(item,_render$(item.items,extras));case'cardimage':return renderImage(item.src,item.classes,item.alt);case'cardtext':var shouldHighlight=item.name.exists(function(name){return contains$2(extras.cardText.highlightOn,name);});var matchText=shouldHighlight?Optional.from(extras.cardText.matchText).getOr(''):'';return renderHtml(replaceText(item.text,matchText),item.classes);}});};var renderCardMenuItem=function renderCardMenuItem(spec,itemResponse,sharedBackstage,extras){var getApi=function getApi(component){return{isDisabled:function isDisabled(){return Disabling.isDisabled(component);},setDisabled:function setDisabled(state){Disabling.set(component,state);each$1(descendants(component.element,'*'),function(elm){component.getSystem().getByDom(elm).each(function(comp){if(comp.hasConfigured(Disabling)){Disabling.set(comp,state);}});});}};};var structure={dom:renderItemDomStructure(spec.label),optComponents:[Optional.some({dom:{tag:'div',classes:[containerClass,containerRowClass]},components:_render$(spec.items,extras)})]};return renderCommonItem({data:buildData(_assign({text:Optional.none()},spec)),disabled:spec.disabled,getApi:getApi,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:false,itemBehaviours:Optional.from(extras.itemBehaviours).getOr([])},structure,itemResponse,sharedBackstage.providers);};var renderChoiceItem=function renderChoiceItem(spec,useText,presets,onItemValueHandler,isSelected,itemResponse,providersBackstage,renderIcons){if(renderIcons===void 0){renderIcons=true;}var getApi=function getApi(component){return{setActive:function setActive(state){Toggling.set(component,state);},isActive:function isActive(){return Toggling.isOn(component);},isDisabled:function isDisabled(){return Disabling.isDisabled(component);},setDisabled:function setDisabled(state){return Disabling.set(component,state);}};};var structure=renderItemStructure({presets:presets,textContent:useText?spec.text:Optional.none(),htmlContent:Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:useText?spec.shortcut:Optional.none(),checkMark:useText?Optional.some(renderCheckmark(providersBackstage.icons)):Optional.none(),caret:Optional.none(),value:spec.value},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:getApi,onAction:function onAction(_api){return onItemValueHandler(spec.value);},onSetup:function onSetup(api){api.setActive(isSelected);return noop;},triggersSubmenu:false,itemBehaviours:[]},structure,itemResponse,providersBackstage),{toggling:{toggleClass:tickedClass,toggleOnExecute:false,selected:spec.active}});};var parts$f=generate$3(owner$2(),parts$h());var hexColour=function hexColour(value){return{value:value};};var shorthandRegex=/^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;var longformRegex=/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i;var isHexString=function isHexString(hex){return shorthandRegex.test(hex)||longformRegex.test(hex);};var normalizeHex=function normalizeHex(hex){return removeLeading(hex,'#').toUpperCase();};var fromString$1=function fromString$1(hex){return isHexString(hex)?Optional.some({value:normalizeHex(hex)}):Optional.none();};var getLongForm=function getLongForm(hex){var hexString=hex.value.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b;});return{value:hexString};};var extractValues=function extractValues(hex){var longForm=getLongForm(hex);var splitForm=longformRegex.exec(longForm.value);return splitForm===null?['FFFFFF','FF','FF','FF']:splitForm;};var toHex=function toHex(component){var hex=component.toString(16);return(hex.length===1?'0'+hex:hex).toUpperCase();};var fromRgba=function fromRgba(rgbaColour){var value=toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue);return hexColour(value);};var min=Math.min;var max=Math.max;var round$1=Math.round;var rgbRegex=/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/;var rgbaRegex=/^rgba\\((\\d+),\\s*(\\d+),\\s*(\\d+),\\s*(\\d?(?:\\.\\d+)?)\\)/;var rgbaColour=function rgbaColour(red,green,blue,alpha){return{red:red,green:green,blue:blue,alpha:alpha};};var isRgbaComponent=function isRgbaComponent(value){var num=parseInt(value,10);return num.toString()===value&&num>=0&&num<=255;};var fromHsv=function fromHsv(hsv){var r;var g;var b;var hue=(hsv.hue||0)%360;var saturation=hsv.saturation/100;var brightness=hsv.value/100;saturation=max(0,min(saturation,1));brightness=max(0,min(brightness,1));if(saturation===0){r=g=b=round$1(255*brightness);return rgbaColour(r,g,b,1);}var side=hue/60;var chroma=brightness*saturation;var x=chroma*(1-Math.abs(side%2-1));var match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma;g=x;b=0;break;case 1:r=x;g=chroma;b=0;break;case 2:r=0;g=chroma;b=x;break;case 3:r=0;g=x;b=chroma;break;case 4:r=x;g=0;b=chroma;break;case 5:r=chroma;g=0;b=x;break;default:r=g=b=0;}r=round$1(255*(r+match));g=round$1(255*(g+match));b=round$1(255*(b+match));return rgbaColour(r,g,b,1);};var fromHex=function fromHex(hexColour){var result=extractValues(hexColour);var red=parseInt(result[1],16);var green=parseInt(result[2],16);var blue=parseInt(result[3],16);return rgbaColour(red,green,blue,1);};var fromStringValues=function fromStringValues(red,green,blue,alpha){var r=parseInt(red,10);var g=parseInt(green,10);var b=parseInt(blue,10);var a=parseFloat(alpha);return rgbaColour(r,g,b,a);};var fromString=function fromString(rgbaString){if(rgbaString==='transparent'){return Optional.some(rgbaColour(0,0,0,0));}var rgbMatch=rgbRegex.exec(rgbaString);if(rgbMatch!==null){return Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],'1'));}var rgbaMatch=rgbaRegex.exec(rgbaString);if(rgbaMatch!==null){return Optional.some(fromStringValues(rgbaMatch[1],rgbaMatch[2],rgbaMatch[3],rgbaMatch[4]));}return Optional.none();};var toString=function toString(rgba){return'rgba('+rgba.red+','+rgba.green+','+rgba.blue+','+rgba.alpha+')';};var red=rgbaColour(255,0,0,1);var fireSkinLoaded$1=function fireSkinLoaded$1(editor){return editor.fire('SkinLoaded');};var fireSkinLoadError$1=function fireSkinLoadError$1(editor,error){return editor.fire('SkinLoadError',error);};var fireResizeEditor=function fireResizeEditor(editor){return editor.fire('ResizeEditor');};var fireResizeContent=function fireResizeContent(editor,e){return editor.fire('ResizeContent',e);};var fireScrollContent=function fireScrollContent(editor,e){return editor.fire('ScrollContent',e);};var fireTextColorChange=function fireTextColorChange(editor,data){return editor.fire('TextColorChange',data);};var hsvColour=function hsvColour(hue,saturation,value){return{hue:hue,saturation:saturation,value:value};};var fromRgb=function fromRgb(rgbaColour){var h=0;var s=0;var v=0;var r=rgbaColour.red/255;var g=rgbaColour.green/255;var b=rgbaColour.blue/255;var minRGB=Math.min(r,Math.min(g,b));var maxRGB=Math.max(r,Math.max(g,b));if(minRGB===maxRGB){v=minRGB;return hsvColour(0,0,v*100);}var d=r===minRGB?g-b:b===minRGB?r-g:b-r;h=r===minRGB?3:b===minRGB?1:5;h=60*(h-d/(maxRGB-minRGB));s=(maxRGB-minRGB)/maxRGB;v=maxRGB;return hsvColour(Math.round(h),Math.round(s*100),Math.round(v*100));};var hexToHsv=function hexToHsv(hex){return fromRgb(fromHex(hex));};var hsvToHex=function hsvToHex(hsv){return fromRgba(fromHsv(hsv));};var anyToHex=function anyToHex(color){return fromString$1(color).orThunk(function(){return fromString(color).map(fromRgba);}).getOrThunk(function(){var canvas=document.createElement('canvas');canvas.height=1;canvas.width=1;var canvasContext=canvas.getContext('2d');canvasContext.clearRect(0,0,canvas.width,canvas.height);canvasContext.fillStyle='#FFFFFF';canvasContext.fillStyle=color;canvasContext.fillRect(0,0,1,1);var rgba=canvasContext.getImageData(0,0,1,1).data;var r=rgba[0];var g=rgba[1];var b=rgba[2];var a=rgba[3];return fromRgba(rgbaColour(r,g,b,a));});};var global$8=tinymce.util.Tools.resolve('tinymce.util.LocalStorage');var storageName='tinymce-custom-colors';function ColorCache(max){if(max===void 0){max=10;}var storageString=global$8.getItem(storageName);var localstorage=isString(storageString)?JSON.parse(storageString):[];var prune=function prune(list){var diff=max-list.length;return diff<0?list.slice(0,max):list;};var cache=prune(localstorage);var add=function add(key){indexOf(cache,key).each(remove);cache.unshift(key);if(cache.length>max){cache.pop();}global$8.setItem(storageName,JSON.stringify(cache));};var remove=function remove(idx){cache.splice(idx,1);};var state=function state(){return cache.slice(0);};return{add:add,state:state};}var choiceItem='choiceitem';var defaultColors=[{type:choiceItem,text:'Light Green',value:'#BFEDD2'},{type:choiceItem,text:'Light Yellow',value:'#FBEEB8'},{type:choiceItem,text:'Light Red',value:'#F8CAC6'},{type:choiceItem,text:'Light Purple',value:'#ECCAFA'},{type:choiceItem,text:'Light Blue',value:'#C2E0F4'},{type:choiceItem,text:'Green',value:'#2DC26B'},{type:choiceItem,text:'Yellow',value:'#F1C40F'},{type:choiceItem,text:'Red',value:'#E03E2D'},{type:choiceItem,text:'Purple',value:'#B96AD9'},{type:choiceItem,text:'Blue',value:'#3598DB'},{type:choiceItem,text:'Dark Turquoise',value:'#169179'},{type:choiceItem,text:'Orange',value:'#E67E23'},{type:choiceItem,text:'Dark Red',value:'#BA372A'},{type:choiceItem,text:'Dark Purple',value:'#843FA1'},{type:choiceItem,text:'Dark Blue',value:'#236FA1'},{type:choiceItem,text:'Light Gray',value:'#ECF0F1'},{type:choiceItem,text:'Medium Gray',value:'#CED4D9'},{type:choiceItem,text:'Gray',value:'#95A5A6'},{type:choiceItem,text:'Dark Gray',value:'#7E8C8D'},{type:choiceItem,text:'Navy Blue',value:'#34495E'},{type:choiceItem,text:'Black',value:'#000000'},{type:choiceItem,text:'White',value:'#ffffff'}];var colorCache=ColorCache(10);var mapColors=function mapColors(colorMap){var colors=[];for(var i=0;i<colorMap.length;i+=2){colors.push({text:colorMap[i+1],value:'#'+anyToHex(colorMap[i]).value,type:'choiceitem'});}return colors;};var getColorCols$2=function getColorCols$2(editor,defaultCols){return editor.getParam('color_cols',defaultCols,'number');};var hasCustomColors$1=function hasCustomColors$1(editor){return editor.getParam('custom_colors')!==false;};var getColorMap=function getColorMap(editor){return editor.getParam('color_map');};var getColors$2=function getColors$2(editor){var unmapped=getColorMap(editor);return unmapped!==undefined?mapColors(unmapped):defaultColors;};var getCurrentColors=function getCurrentColors(){return map$2(colorCache.state(),function(color){return{type:choiceItem,text:color,value:color};});};var addColor=function addColor(color){colorCache.add(color);};var fallbackColor='#000000';var getCurrentColor=function getCurrentColor(editor,format){var color;editor.dom.getParents(editor.selection.getStart(),function(elm){var value;if(value=elm.style[format==='forecolor'?'color':'background-color']){color=color?color:value;}});return Optional.from(color);};var applyFormat=function applyFormat(editor,format,value){editor.undoManager.transact(function(){editor.focus();editor.formatter.apply(format,{value:value});editor.nodeChanged();});};var removeFormat=function removeFormat(editor,format){editor.undoManager.transact(function(){editor.focus();editor.formatter.remove(format,{value:null},null,true);editor.nodeChanged();});};var registerCommands=function registerCommands(editor){editor.addCommand('mceApplyTextcolor',function(format,value){applyFormat(editor,format,value);});editor.addCommand('mceRemoveTextcolor',function(format){removeFormat(editor,format);});};var calcCols=function calcCols(colors){return Math.max(5,Math.ceil(Math.sqrt(colors)));};var getColorCols$1=function getColorCols$1(editor){var colors=getColors$2(editor);var defaultCols=calcCols(colors.length);return getColorCols$2(editor,defaultCols);};var getAdditionalColors=function getAdditionalColors(hasCustom){var type='choiceitem';var remove={type:type,text:'Remove color',icon:'color-swatch-remove-color',value:'remove'};var custom={type:type,text:'Custom color',icon:'color-picker',value:'custom'};return hasCustom?[remove,custom]:[remove];};var applyColor=function applyColor(editor,format,value,onChoice){if(value==='custom'){var dialog=colorPickerDialog(editor);dialog(function(colorOpt){colorOpt.each(function(color){addColor(color);editor.execCommand('mceApplyTextcolor',format,color);onChoice(color);});},fallbackColor);}else if(value==='remove'){onChoice('');editor.execCommand('mceRemoveTextcolor',format);}else{onChoice(value);editor.execCommand('mceApplyTextcolor',format,value);}};var getColors$1=function getColors$1(colors,hasCustom){return colors.concat(getCurrentColors().concat(getAdditionalColors(hasCustom)));};var getFetch$1=function getFetch$1(colors,hasCustom){return function(callback){callback(getColors$1(colors,hasCustom));};};var setIconColor=function setIconColor(splitButtonApi,name,newColor){var id=name==='forecolor'?'tox-icon-text-color__color':'tox-icon-highlight-bg-color__color';splitButtonApi.setIconFill(id,newColor);};var registerTextColorButton=function registerTextColorButton(editor,name,format,tooltip,lastColor){editor.ui.registry.addSplitButton(name,{tooltip:tooltip,presets:'color',icon:name==='forecolor'?'text-color':'highlight-bg-color',select:function select(value){var optCurrentRgb=getCurrentColor(editor,format);return optCurrentRgb.bind(function(currentRgb){return fromString(currentRgb).map(function(rgba){var currentHex=fromRgba(rgba).value;return contains$1(value.toLowerCase(),currentHex);});}).getOr(false);},columns:getColorCols$1(editor),fetch:getFetch$1(getColors$2(editor),hasCustomColors$1(editor)),onAction:function onAction(_splitButtonApi){applyColor(editor,format,lastColor.get(),noop);},onItemAction:function onItemAction(_splitButtonApi,value){applyColor(editor,format,value,function(newColor){lastColor.set(newColor);fireTextColorChange(editor,{name:name,color:newColor});});},onSetup:function onSetup(splitButtonApi){setIconColor(splitButtonApi,name,lastColor.get());var handler=function handler(e){if(e.name===name){setIconColor(splitButtonApi,e.name,e.color);}};editor.on('TextColorChange',handler);return function(){editor.off('TextColorChange',handler);};}});};var registerTextColorMenuItem=function registerTextColorMenuItem(editor,name,format,text){editor.ui.registry.addNestedMenuItem(name,{text:text,icon:name==='forecolor'?'text-color':'highlight-bg-color',getSubmenuItems:function getSubmenuItems(){return[{type:'fancymenuitem',fancytype:'colorswatch',onAction:function onAction(data){applyColor(editor,format,data.value,noop);}}];}});};var colorPickerDialog=function colorPickerDialog(editor){return function(callback,value){var isValid=false;var onSubmit=function onSubmit(api){var data=api.getData();var hex=data.colorpicker;if(isValid){callback(Optional.from(hex));api.close();}else{editor.windowManager.alert(editor.translate(['Invalid hex color code: {0}',hex]));}};var onAction=function onAction(_api,details){if(details.name==='hex-valid'){isValid=details.value;}};var initialData={colorpicker:value};editor.windowManager.open({title:'Color Picker',size:'normal',body:{type:'panel',items:[{type:'colorpicker',name:'colorpicker',label:'Color'}]},buttons:[{type:'cancel',name:'cancel',text:'Cancel'},{type:'submit',name:'save',text:'Save',primary:true}],initialData:initialData,onAction:onAction,onSubmit:onSubmit,onClose:noop,onCancel:function onCancel(){callback(Optional.none());}});};};var register$a=function register$a(editor){registerCommands(editor);var lastForeColor=Cell(fallbackColor);var lastBackColor=Cell(fallbackColor);registerTextColorButton(editor,'forecolor','forecolor','Text color',lastForeColor);registerTextColorButton(editor,'backcolor','hilitecolor','Background color',lastBackColor);registerTextColorMenuItem(editor,'forecolor','forecolor','Text color');registerTextColorMenuItem(editor,'backcolor','hilitecolor','Background color');};var createPartialChoiceMenu=function createPartialChoiceMenu(value,items,onItemValueHandler,columns,presets,itemResponse,select,providersBackstage){var hasIcons=menuHasIcons(items);var presetItemTypes=presets!=='color'?'normal':'color';var alloyItems=createChoiceItems(items,onItemValueHandler,columns,presetItemTypes,itemResponse,select,providersBackstage);return createPartialMenuWithAlloyItems(value,hasIcons,alloyItems,columns,presets);};var createChoiceItems=function createChoiceItems(items,onItemValueHandler,columns,itemPresets,itemResponse,select,providersBackstage){return cat(map$2(items,function(item){if(item.type==='choiceitem'){return createChoiceMenuItem(item).fold(handleError,function(d){return Optional.some(renderChoiceItem(d,columns===1,itemPresets,onItemValueHandler,select(item.value),itemResponse,providersBackstage,menuHasIcons(items)));});}else{return Optional.none();}}));};var deriveMenuMovement=function deriveMenuMovement(columns,presets){var menuMarkers=markers(presets);if(columns===1){return{mode:'menu',moveOnTab:true};}else if(columns==='auto'){return{mode:'grid',selector:'.'+menuMarkers.item,initSize:{numColumns:1,numRows:1}};}else{var rowClass=presets==='color'?'tox-swatches__row':'tox-collection__group';return{mode:'matrix',rowSelector:'.'+rowClass};}};var deriveCollectionMovement=function deriveCollectionMovement(columns,presets){if(columns===1){return{mode:'menu',moveOnTab:false,selector:'.tox-collection__item'};}else if(columns==='auto'){return{mode:'flatgrid',selector:'.'+'tox-collection__item',initSize:{numColumns:1,numRows:1}};}else{return{mode:'matrix',selectors:{row:presets==='color'?'.tox-swatches__row':'.tox-collection__group',cell:presets==='color'?'.'+colorClass:'.'+selectableClass}};}};var renderColorSwatchItem=function renderColorSwatchItem(spec,backstage){var items=getColorItems(spec,backstage);var columns=backstage.colorinput.getColorCols();var presets='color';var menuSpec=createPartialChoiceMenu(generate$6('menu-value'),items,function(value){spec.onAction({value:value});},columns,presets,ItemResponse$1.CLOSE_ON_EXECUTE,never,backstage.shared.providers);var widgetSpec=_assign(_assign({},menuSpec),{markers:markers(presets),movement:deriveMenuMovement(columns,presets)});return{type:'widget',data:{value:generate$6('widget-id')},dom:{tag:'div',classes:['tox-fancymenuitem']},autofocus:true,components:[parts$f.widget(Menu.sketch(widgetSpec))]};};var getColorItems=function getColorItems(spec,backstage){var useCustomColors=spec.initData.allowCustomColors&&backstage.colorinput.hasCustomColors();return spec.initData.colors.fold(function(){return getColors$1(backstage.colorinput.getColors(),useCustomColors);},function(colors){return colors.concat(getAdditionalColors(useCustomColors));});};var cellOverEvent=generate$6('cell-over');var cellExecuteEvent=generate$6('cell-execute');var makeCell=function makeCell(row,col,labelId){var _a;var emitCellOver=function emitCellOver(c){return emitWith(c,cellOverEvent,{row:row,col:col});};var emitExecute=function emitExecute(c){return emitWith(c,cellExecuteEvent,{row:row,col:col});};var onClick=function onClick(c,se){se.stop();emitExecute(c);};return build$1({dom:{tag:'div',attributes:(_a={role:'button'},_a['aria-labelledby']=labelId,_a)},behaviours:derive$1([config('insert-table-picker-cell',[run$1(mouseover(),Focusing.focus),run$1(execute$5(),emitExecute),run$1(click(),onClick),run$1(tap(),onClick)]),Toggling.config({toggleClass:'tox-insert-table-picker__selected',toggleOnExecute:false}),Focusing.config({onFocus:emitCellOver})])});};var makeCells=function makeCells(labelId,numRows,numCols){var cells=[];for(var i=0;i<numRows;i++){var row=[];for(var j=0;j<numCols;j++){row.push(makeCell(i,j,labelId));}cells.push(row);}return cells;};var selectCells=function selectCells(cells,selectedRow,selectedColumn,numRows,numColumns){for(var i=0;i<numRows;i++){for(var j=0;j<numColumns;j++){Toggling.set(cells[i][j],i<=selectedRow&&j<=selectedColumn);}}};var makeComponents=function makeComponents(cells){return bind$3(cells,function(cellRow){return map$2(cellRow,premade);});};var makeLabelText=function makeLabelText(row,col){return text$1(col+'x'+row);};var renderInsertTableMenuItem=function renderInsertTableMenuItem(spec){var numRows=10;var numColumns=10;var sizeLabelId=generate$6('size-label');var cells=makeCells(sizeLabelId,numRows,numColumns);var emptyLabelText=makeLabelText(0,0);var memLabel=record({dom:{tag:'span',classes:['tox-insert-table-picker__label'],attributes:{id:sizeLabelId}},components:[emptyLabelText],behaviours:derive$1([Replacing.config({})])});return{type:'widget',data:{value:generate$6('widget-id')},dom:{tag:'div',classes:['tox-fancymenuitem']},autofocus:true,components:[parts$f.widget({dom:{tag:'div',classes:['tox-insert-table-picker']},components:makeComponents(cells).concat(memLabel.asSpec()),behaviours:derive$1([config('insert-table-picker',[runOnAttached(function(c){Replacing.set(memLabel.get(c),[emptyLabelText]);}),runWithTarget(cellOverEvent,function(c,t,e){var _a=e.event,row=_a.row,col=_a.col;selectCells(cells,row,col,numRows,numColumns);Replacing.set(memLabel.get(c),[makeLabelText(row+1,col+1)]);}),runWithTarget(cellExecuteEvent,function(c,_,e){var _a=e.event,row=_a.row,col=_a.col;spec.onAction({numRows:row+1,numColumns:col+1});emit(c,sandboxClose());})]),Keying.config({initSize:{numRows:numRows,numColumns:numColumns},mode:'flatgrid',selector:'[role=\"button\"]'})])})]};};var fancyMenuItems={inserttable:renderInsertTableMenuItem,colorswatch:renderColorSwatchItem};var renderFancyMenuItem=function renderFancyMenuItem(spec,backstage){return get$e(fancyMenuItems,spec.fancytype).map(function(render){return render(spec,backstage);});};var renderNestedItem=function renderNestedItem(spec,itemResponse,providersBackstage,renderIcons,downwardsCaret){if(renderIcons===void 0){renderIcons=true;}if(downwardsCaret===void 0){downwardsCaret=false;}var caret=downwardsCaret?renderDownwardsCaret(providersBackstage.icons):renderSubmenuCaret(providersBackstage.icons);var getApi=function getApi(component){return{isDisabled:function isDisabled(){return Disabling.isDisabled(component);},setDisabled:function setDisabled(state){return Disabling.set(component,state);}};};var structure=renderItemStructure({presets:'normal',iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.some(caret),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi:getApi,disabled:spec.disabled,onAction:noop,onSetup:spec.onSetup,triggersSubmenu:true,itemBehaviours:[]},structure,itemResponse,providersBackstage);};var renderNormalItem=function renderNormalItem(spec,itemResponse,providersBackstage,renderIcons){if(renderIcons===void 0){renderIcons=true;}var getApi=function getApi(component){return{isDisabled:function isDisabled(){return Disabling.isDisabled(component);},setDisabled:function setDisabled(state){return Disabling.set(component,state);}};};var structure=renderItemStructure({presets:'normal',iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.none(),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi:getApi,disabled:spec.disabled,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:false,itemBehaviours:[]},structure,itemResponse,providersBackstage);};var renderSeparatorItem=function renderSeparatorItem(spec){var innerHtml=spec.text.fold(function(){return{};},function(text){return{innerHtml:text};});return{type:'separator',dom:_assign({tag:'div',classes:[selectableClass,groupHeadingClass]},innerHtml),components:[]};};var renderToggleMenuItem=function renderToggleMenuItem(spec,itemResponse,providersBackstage,renderIcons){if(renderIcons===void 0){renderIcons=true;}var getApi=function getApi(component){return{setActive:function setActive(state){Toggling.set(component,state);},isActive:function isActive(){return Toggling.isOn(component);},isDisabled:function isDisabled(){return Disabling.isDisabled(component);},setDisabled:function setDisabled(state){return Disabling.set(component,state);}};};var structure=renderItemStructure({iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,checkMark:Optional.some(renderCheckmark(providersBackstage.icons)),caret:Optional.none(),shortcutContent:spec.shortcut,presets:'normal',meta:spec.meta},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:getApi,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:false,itemBehaviours:[]},structure,itemResponse,providersBackstage),{toggling:{toggleClass:tickedClass,toggleOnExecute:false,selected:spec.active}});};var autocomplete=renderAutocompleteItem;var separator$3=renderSeparatorItem;var normal=renderNormalItem;var nested=renderNestedItem;var toggle$1=renderToggleMenuItem;var fancy=renderFancyMenuItem;var card=renderCardMenuItem;var FocusMode;(function(FocusMode){FocusMode[FocusMode['ContentFocus']=0]='ContentFocus';FocusMode[FocusMode['UiFocus']=1]='UiFocus';})(FocusMode||(FocusMode={}));var createMenuItemFromBridge=function createMenuItemFromBridge(item,itemResponse,backstage,menuHasIcons,isHorizontalMenu){var providersBackstage=backstage.shared.providers;var parseForHorizontalMenu=function parseForHorizontalMenu(menuitem){return!isHorizontalMenu?menuitem:_assign(_assign({},menuitem),{shortcut:Optional.none(),icon:menuitem.text.isSome()?Optional.none():menuitem.icon});};switch(item.type){case'menuitem':return createMenuItem(item).fold(handleError,function(d){return Optional.some(normal(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons));});case'nestedmenuitem':return createNestedMenuItem(item).fold(handleError,function(d){return Optional.some(nested(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons,isHorizontalMenu));});case'togglemenuitem':return createToggleMenuItem(item).fold(handleError,function(d){return Optional.some(toggle$1(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons));});case'separator':return createSeparatorMenuItem(item).fold(handleError,function(d){return Optional.some(separator$3(d));});case'fancymenuitem':return createFancyMenuItem(item).fold(handleError,function(d){return fancy(parseForHorizontalMenu(d),backstage);});default:{console.error('Unknown item in general menu',item);return Optional.none();}}};var createAutocompleteItems=function createAutocompleteItems(items,matchText,onItemValueHandler,columns,itemResponse,sharedBackstage,highlightOn){var renderText=columns===1;var renderIcons=!renderText||menuHasIcons(items);return cat(map$2(items,function(item){switch(item.type){case'separator':return createSeparatorItem(item).fold(handleError,function(d){return Optional.some(separator$3(d));});case'cardmenuitem':return createCardMenuItem(item).fold(handleError,function(d){return Optional.some(card(_assign(_assign({},d),{onAction:function onAction(api){d.onAction(api);onItemValueHandler(d.value,d.meta);}}),itemResponse,sharedBackstage,{itemBehaviours:tooltipBehaviour(d.meta,sharedBackstage),cardText:{matchText:matchText,highlightOn:highlightOn}}));});case'autocompleteitem':default:return createAutocompleterItem(item).fold(handleError,function(d){return Optional.some(autocomplete(d,matchText,renderText,'normal',onItemValueHandler,itemResponse,sharedBackstage,renderIcons));});}}));};var createPartialMenu=function createPartialMenu(value,items,itemResponse,backstage,isHorizontalMenu){var hasIcons=menuHasIcons(items);var alloyItems=cat(map$2(items,function(item){var itemHasIcon=function itemHasIcon(i){return isHorizontalMenu?!has$2(i,'text'):hasIcons;};var createItem=function createItem(i){return createMenuItemFromBridge(i,itemResponse,backstage,itemHasIcon(i),isHorizontalMenu);};if(item.type==='nestedmenuitem'&&item.getSubmenuItems().length<=0){return createItem(_assign(_assign({},item),{disabled:true}));}else{return createItem(item);}}));var createPartial=isHorizontalMenu?createHorizontalPartialMenuWithAlloyItems:createPartialMenuWithAlloyItems;return createPartial(value,hasIcons,alloyItems,1,'normal');};var createTieredDataFrom=function createTieredDataFrom(partialMenu){return tieredMenu.singleData(partialMenu.value,partialMenu);};var createMenuFrom=function createMenuFrom(partialMenu,columns,focusMode,presets){var focusManager=focusMode===FocusMode.ContentFocus?highlights():dom$2();var movement=deriveMenuMovement(columns,presets);var menuMarkers=markers(presets);return{dom:partialMenu.dom,components:partialMenu.components,items:partialMenu.items,value:partialMenu.value,markers:{selectedItem:menuMarkers.selectedItem,item:menuMarkers.item},movement:movement,fakeFocus:focusMode===FocusMode.ContentFocus,focusManager:focusManager,menuBehaviours:SimpleBehaviours.unnamedEvents(columns!=='auto'?[]:[runOnAttached(function(comp,_se){detectSize(comp,4,menuMarkers.item).each(function(_a){var numColumns=_a.numColumns,numRows=_a.numRows;Keying.setGridSize(comp,numRows,numColumns);});})])};};var register$9=function register$9(editor,sharedBackstage){var activeAutocompleter=value$1();var processingAction=Cell(false);var autocompleter=build$1(InlineView.sketch({dom:{tag:'div',classes:['tox-autocompleter']},components:[],fireDismissalEventInstead:{},inlineBehaviours:derive$1([config('dismissAutocompleter',[run$1(dismissRequested(),function(){return cancelIfNecessary();})])]),lazySink:sharedBackstage.getSink}));var isMenuOpen=function isMenuOpen(){return InlineView.isOpen(autocompleter);};var isActive=function isActive(){return activeAutocompleter.get().isSome();};var hideIfNecessary=function hideIfNecessary(){if(isActive()){InlineView.hide(autocompleter);}};var cancelIfNecessary=function cancelIfNecessary(){if(isActive()){var lastElement=activeAutocompleter.get().map(function(ac){return ac.element;});detect(lastElement.getOr(SugarElement.fromDom(editor.selection.getNode()))).each(unwrap);hideIfNecessary();activeAutocompleter.clear();processingAction.set(false);}};var getAutocompleters=cached(function(){return register$b(editor);});var getCombinedItems=function getCombinedItems(triggerChar,matches){var columns=findMap(matches,function(m){return Optional.from(m.columns);}).getOr(1);return bind$3(matches,function(match){var choices=match.items;return createAutocompleteItems(choices,match.matchText,function(itemValue,itemMeta){var nr=editor.selection.getRng();getContext(editor.dom,nr,triggerChar).fold(function(){return console.error('Lost context. Cursor probably moved');},function(_a){var range=_a.range;var autocompleterApi={hide:function hide(){cancelIfNecessary();},reload:function reload(fetchOptions){hideIfNecessary();load(fetchOptions);}};processingAction.set(true);match.onAction(autocompleterApi,range,itemValue,itemMeta);processingAction.set(false);});},columns,ItemResponse$1.BUBBLE_TO_SANDBOX,sharedBackstage,match.highlightOn);});};var commenceIfNecessary=function commenceIfNecessary(context){if(!isActive()){var wrapper=create$4(editor,context.range);activeAutocompleter.set({triggerChar:context.triggerChar,element:wrapper,matchLength:context.text.length});processingAction.set(false);}};var display=function display(ac,context,lookupData,items){ac.matchLength=context.text.length;var columns=findMap(lookupData,function(ld){return Optional.from(ld.columns);}).getOr(1);InlineView.showAt(autocompleter,Menu.sketch(createMenuFrom(createPartialMenuWithAlloyItems('autocompleter-value',true,items,columns,'normal'),columns,FocusMode.ContentFocus,'normal')),{anchor:{type:'node',root:SugarElement.fromDom(editor.getBody()),node:Optional.from(ac.element)}});InlineView.getContent(autocompleter).each(Highlighting.highlightFirst);};var doLookup=function doLookup(fetchOptions){return activeAutocompleter.get().map(function(ac){return getContext(editor.dom,editor.selection.getRng(),ac.triggerChar).bind(function(newContext){return lookupWithContext(editor,getAutocompleters,newContext,fetchOptions);});}).getOrThunk(function(){return lookup$2(editor,getAutocompleters);});};var load=function load(fetchOptions){doLookup(fetchOptions).fold(cancelIfNecessary,function(lookupInfo){commenceIfNecessary(lookupInfo.context);lookupInfo.lookupData.then(function(lookupData){activeAutocompleter.get().map(function(ac){var context=lookupInfo.context;if(ac.triggerChar===context.triggerChar){var combinedItems=getCombinedItems(context.triggerChar,lookupData);if(combinedItems.length>0){display(ac,context,lookupData,combinedItems);}else if(context.text.length-ac.matchLength>=10){cancelIfNecessary();}else{hideIfNecessary();}}});});});};var onKeypress=last(function(e){if(e.which===27){return;}load();},50);var autocompleterUiApi={onKeypress:onKeypress,cancelIfNecessary:cancelIfNecessary,isMenuOpen:isMenuOpen,isActive:isActive,isProcessingAction:processingAction.get,getView:function getView(){return InlineView.getContent(autocompleter);}};if(editor.hasPlugin('rtc')===false){AutocompleterEditorEvents.setup(autocompleterUiApi,editor);}};var Autocompleter={register:register$9};var closest=function closest(scope,selector,isRoot){return closest$1(scope,selector,isRoot).isSome();};var DelayedFunction=function DelayedFunction(fun,delay){var ref=null;var schedule=function schedule(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}ref=setTimeout(function(){fun.apply(null,args);ref=null;},delay);};var cancel=function cancel(){if(ref!==null){clearTimeout(ref);ref=null;}};return{cancel:cancel,schedule:schedule};};var SIGNIFICANT_MOVE=5;var LONGPRESS_DELAY=400;var getTouch=function getTouch(event){var raw=event.raw;if(raw.touches===undefined||raw.touches.length!==1){return Optional.none();}return Optional.some(raw.touches[0]);};var isFarEnough=function isFarEnough(touch,data){var distX=Math.abs(touch.clientX-data.x);var distY=Math.abs(touch.clientY-data.y);return distX>SIGNIFICANT_MOVE||distY>SIGNIFICANT_MOVE;};var monitor=function monitor(settings){var startData=value$1();var longpressFired=Cell(false);var longpress$1=DelayedFunction(function(event){settings.triggerEvent(longpress(),event);longpressFired.set(true);},LONGPRESS_DELAY);var handleTouchstart=function handleTouchstart(event){getTouch(event).each(function(touch){longpress$1.cancel();var data={x:touch.clientX,y:touch.clientY,target:event.target};longpress$1.schedule(event);longpressFired.set(false);startData.set(data);});return Optional.none();};var handleTouchmove=function handleTouchmove(event){longpress$1.cancel();getTouch(event).each(function(touch){startData.on(function(data){if(isFarEnough(touch,data)){startData.clear();}});});return Optional.none();};var handleTouchend=function handleTouchend(event){longpress$1.cancel();var isSame=function isSame(data){return eq(data.target,event.target);};return startData.get().filter(isSame).map(function(_data){if(longpressFired.get()){event.prevent();return false;}else{return settings.triggerEvent(tap(),event);}});};var handlers=wrapAll([{key:touchstart(),value:handleTouchstart},{key:touchmove(),value:handleTouchmove},{key:touchend(),value:handleTouchend}]);var fireIfReady=function fireIfReady(event,type){return get$e(handlers,type).bind(function(handler){return handler(event);});};return{fireIfReady:fireIfReady};};var isDangerous=function isDangerous(event){var keyEv=event.raw;return keyEv.which===BACKSPACE[0]&&!contains$2(['input','textarea'],name$2(event.target))&&!closest(event.target,'[contenteditable=\"true\"]');};var isFirefox=function isFirefox(){return detect$1().browser.isFirefox();};var bindFocus=function bindFocus(container,handler){if(isFirefox()){return capture(container,'focus',handler);}else{return bind(container,'focusin',handler);}};var bindBlur=function bindBlur(container,handler){if(isFirefox()){return capture(container,'blur',handler);}else{return bind(container,'focusout',handler);}};var setup$d=function setup$d(container,rawSettings){var settings=_assign({stopBackspace:true},rawSettings);var pointerEvents=['touchstart','touchmove','touchend','touchcancel','gesturestart','mousedown','mouseup','mouseover','mousemove','mouseout','click'];var tapEvent=monitor(settings);var simpleEvents=map$2(pointerEvents.concat(['selectstart','input','contextmenu','change','transitionend','transitioncancel','drag','dragstart','dragend','dragenter','dragleave','dragover','drop','keyup']),function(type){return bind(container,type,function(event){tapEvent.fireIfReady(event,type).each(function(tapStopped){if(tapStopped){event.kill();}});var stopped=settings.triggerEvent(type,event);if(stopped){event.kill();}});});var pasteTimeout=value$1();var onPaste=bind(container,'paste',function(event){tapEvent.fireIfReady(event,'paste').each(function(tapStopped){if(tapStopped){event.kill();}});var stopped=settings.triggerEvent('paste',event);if(stopped){event.kill();}pasteTimeout.set(setTimeout(function(){settings.triggerEvent(postPaste(),event);},0));});var onKeydown=bind(container,'keydown',function(event){var stopped=settings.triggerEvent('keydown',event);if(stopped){event.kill();}else if(settings.stopBackspace&&isDangerous(event)){event.prevent();}});var onFocusIn=bindFocus(container,function(event){var stopped=settings.triggerEvent('focusin',event);if(stopped){event.kill();}});var focusoutTimeout=value$1();var onFocusOut=bindBlur(container,function(event){var stopped=settings.triggerEvent('focusout',event);if(stopped){event.kill();}focusoutTimeout.set(setTimeout(function(){settings.triggerEvent(postBlur(),event);},0));});var unbind=function unbind(){each$1(simpleEvents,function(e){e.unbind();});onKeydown.unbind();onFocusIn.unbind();onFocusOut.unbind();onPaste.unbind();pasteTimeout.on(clearTimeout);focusoutTimeout.on(clearTimeout);};return{unbind:unbind};};var derive=function derive(rawEvent,rawTarget){var source=get$e(rawEvent,'target').getOr(rawTarget);return Cell(source);};var fromSource=function fromSource(event,source){var stopper=Cell(false);var cutter=Cell(false);var stop=function stop(){stopper.set(true);};var cut=function cut(){cutter.set(true);};return{stop:stop,cut:cut,isStopped:stopper.get,isCut:cutter.get,event:event,setSource:source.set,getSource:source.get};};var fromExternal=function fromExternal(event){var stopper=Cell(false);var stop=function stop(){stopper.set(true);};return{stop:stop,cut:noop,isStopped:stopper.get,isCut:never,event:event,setSource:die('Cannot set source of a broadcasted event'),getSource:die('Cannot get source of a broadcasted event')};};var adt$1=Adt.generate([{stopped:[]},{resume:['element']},{complete:[]}]);var doTriggerHandler=function doTriggerHandler(lookup,eventType,rawEvent,target,source,logger){var handler=lookup(eventType,target);var simulatedEvent=fromSource(rawEvent,source);return handler.fold(function(){logger.logEventNoHandlers(eventType,target);return adt$1.complete();},function(handlerInfo){var descHandler=handlerInfo.descHandler;var eventHandler=getCurried(descHandler);eventHandler(simulatedEvent);if(simulatedEvent.isStopped()){logger.logEventStopped(eventType,handlerInfo.element,descHandler.purpose);return adt$1.stopped();}else if(simulatedEvent.isCut()){logger.logEventCut(eventType,handlerInfo.element,descHandler.purpose);return adt$1.complete();}else{return parent(handlerInfo.element).fold(function(){logger.logNoParent(eventType,handlerInfo.element,descHandler.purpose);return adt$1.complete();},function(parent){logger.logEventResponse(eventType,handlerInfo.element,descHandler.purpose);return adt$1.resume(parent);});}});};var _doTriggerOnUntilStopped=function doTriggerOnUntilStopped(lookup,eventType,rawEvent,rawTarget,source,logger){return doTriggerHandler(lookup,eventType,rawEvent,rawTarget,source,logger).fold(always,function(parent){return _doTriggerOnUntilStopped(lookup,eventType,rawEvent,parent,source,logger);},never);};var triggerHandler=function triggerHandler(lookup,eventType,rawEvent,target,logger){var source=derive(rawEvent,target);return doTriggerHandler(lookup,eventType,rawEvent,target,source,logger);};var broadcast=function broadcast(listeners,rawEvent,_logger){var simulatedEvent=fromExternal(rawEvent);each$1(listeners,function(listener){var descHandler=listener.descHandler;var handler=getCurried(descHandler);handler(simulatedEvent);});return simulatedEvent.isStopped();};var triggerUntilStopped=function triggerUntilStopped(lookup,eventType,rawEvent,logger){return triggerOnUntilStopped(lookup,eventType,rawEvent,rawEvent.target,logger);};var triggerOnUntilStopped=function triggerOnUntilStopped(lookup,eventType,rawEvent,rawTarget,logger){var source=derive(rawEvent,rawTarget);return _doTriggerOnUntilStopped(lookup,eventType,rawEvent,rawTarget,source,logger);};var eventHandler=function eventHandler(element,descHandler){return{element:element,descHandler:descHandler};};var broadcastHandler=function broadcastHandler(id,handler){return{id:id,descHandler:handler};};var EventRegistry=function EventRegistry(){var registry={};var registerId=function registerId(extraArgs,id,events){each(events,function(v,k){var handlers=registry[k]!==undefined?registry[k]:{};handlers[id]=curryArgs(v,extraArgs);registry[k]=handlers;});};var findHandler=function findHandler(handlers,elem){return read$1(elem).bind(function(id){return get$e(handlers,id);}).map(function(descHandler){return eventHandler(elem,descHandler);});};var filterByType=function filterByType(type){return get$e(registry,type).map(function(handlers){return mapToArray(handlers,function(f,id){return broadcastHandler(id,f);});}).getOr([]);};var find=function find(isAboveRoot,type,target){return get$e(registry,type).bind(function(handlers){return closest$4(target,function(elem){return findHandler(handlers,elem);},isAboveRoot);});};var unregisterId=function unregisterId(id){each(registry,function(handlersById,_eventName){if(has$2(handlersById,id)){delete handlersById[id];}});};return{registerId:registerId,unregisterId:unregisterId,filterByType:filterByType,find:find};};var Registry=function Registry(){var events=EventRegistry();var components={};var readOrTag=function readOrTag(component){var elem=component.element;return read$1(elem).getOrThunk(function(){return write('uid-',component.element);});};var failOnDuplicate=function failOnDuplicate(component,tagId){var conflict=components[tagId];if(conflict===component){unregister(component);}else{throw new Error('The tagId \"'+tagId+'\" is already used by: '+element(conflict.element)+'\\nCannot use it for: '+element(component.element)+'\\n'+'The conflicting element is'+(_inBody(conflict.element)?' ':' not ')+'already in the DOM');}};var register=function register(component){var tagId=readOrTag(component);if(hasNonNullableKey(components,tagId)){failOnDuplicate(component,tagId);}var extraArgs=[component];events.registerId(extraArgs,tagId,component.events);components[tagId]=component;};var unregister=function unregister(component){read$1(component.element).each(function(tagId){delete components[tagId];events.unregisterId(tagId);});};var filter=function filter(type){return events.filterByType(type);};var find=function find(isAboveRoot,type,target){return events.find(isAboveRoot,type,target);};var getById=function getById(id){return get$e(components,id);};return{find:find,filter:filter,register:register,unregister:unregister,getById:getById};};var factory$j=function factory$j(detail){var _a=detail.dom,attributes=_a.attributes,domWithoutAttributes=__rest(_a,['attributes']);return{uid:detail.uid,dom:_assign({tag:'div',attributes:_assign({role:'presentation'},attributes)},domWithoutAttributes),components:detail.components,behaviours:get$2(detail.containerBehaviours),events:detail.events,domModification:detail.domModification,eventOrder:detail.eventOrder};};var Container=single({name:'Container',factory:factory$j,configFields:[defaulted('components',[]),field('containerBehaviours',[]),defaulted('events',{}),defaulted('domModification',{}),defaulted('eventOrder',{})]});var takeover=function takeover(root){var isAboveRoot=function isAboveRoot(el){return parent(root.element).fold(always,function(parent){return eq(el,parent);});};var registry=Registry();var lookup=function lookup(eventName,target){return registry.find(isAboveRoot,eventName,target);};var domEvents=setup$d(root.element,{triggerEvent:function triggerEvent(eventName,event){return monitorEvent(eventName,event.target,function(logger){return triggerUntilStopped(lookup,eventName,event,logger);});}});var systemApi={debugInfo:constant$1('real'),triggerEvent:function triggerEvent(eventName,target,data){monitorEvent(eventName,target,function(logger){return triggerOnUntilStopped(lookup,eventName,data,target,logger);});},triggerFocus:function triggerFocus(target,originator){read$1(target).fold(function(){focus$3(target);},function(_alloyId){monitorEvent(focus$4(),target,function(logger){triggerHandler(lookup,focus$4(),{originator:originator,kill:noop,prevent:noop,target:target},target,logger);return false;});});},triggerEscape:function triggerEscape(comp,simulatedEvent){systemApi.triggerEvent('keydown',comp.element,simulatedEvent.event);},getByUid:function getByUid(uid){return _getByUid(uid);},getByDom:function getByDom(elem){return _getByDom(elem);},build:build$1,addToGui:function addToGui(c){add(c);},removeFromGui:function removeFromGui(c){remove(c);},addToWorld:function addToWorld(c){_addToWorld2(c);},removeFromWorld:function removeFromWorld(c){_removeFromWorld2(c);},broadcast:function broadcast(message){broadcast$1(message);},broadcastOn:function broadcastOn(channels,message){_broadcastOn(channels,message);},broadcastEvent:function broadcastEvent(eventName,event){_broadcastEvent(eventName,event);},isConnected:always};var _addToWorld2=function _addToWorld(component){component.connect(systemApi);if(!isText$1(component.element)){registry.register(component);each$1(component.components(),_addToWorld2);systemApi.triggerEvent(systemInit(),component.element,{target:component.element});}};var _removeFromWorld2=function _removeFromWorld(component){if(!isText$1(component.element)){each$1(component.components(),_removeFromWorld2);registry.unregister(component);}component.disconnect();};var add=function add(component){attach(root,component);};var remove=function remove(component){detach(component);};var destroy=function destroy(){domEvents.unbind();remove$5(root.element);};var broadcastData=function broadcastData(data){var receivers=registry.filter(receive());each$1(receivers,function(receiver){var descHandler=receiver.descHandler;var handler=getCurried(descHandler);handler(data);});};var broadcast$1=function broadcast$1(message){broadcastData({universal:true,data:message});};var _broadcastOn=function _broadcastOn(channels,message){broadcastData({universal:false,channels:channels,data:message});};var _broadcastEvent=function _broadcastEvent(eventName,event){var listeners=registry.filter(eventName);return broadcast(listeners,event);};var _getByUid=function _getByUid(uid){return registry.getById(uid).fold(function(){return Result.error(new Error('Could not find component with uid: \"'+uid+'\" in system.'));},Result.value);};var _getByDom=function _getByDom(elem){var uid=read$1(elem).getOr('not found');return _getByUid(uid);};_addToWorld2(root);return{root:root,element:root.element,destroy:destroy,add:add,remove:remove,getByUid:_getByUid,getByDom:_getByDom,addToWorld:_addToWorld2,removeFromWorld:_removeFromWorld2,broadcast:broadcast$1,broadcastOn:_broadcastOn,broadcastEvent:_broadcastEvent};};var renderBar=function renderBar(spec,backstage){return{dom:{tag:'div',classes:['tox-bar','tox-form__controls-h-stack']},components:map$2(spec.items,backstage.interpreter)};};var schema$l=constant$1([defaulted('prefix','form-field'),field('fieldBehaviours',[Composing,Representing])]);var parts$e=constant$1([optional({schema:[required$1('dom')],name:'label'}),optional({factory:{sketch:function sketch(spec){return{uid:spec.uid,dom:{tag:'span',styles:{display:'none'},attributes:{'aria-hidden':'true'},innerHtml:spec.text}};}},schema:[required$1('text')],name:'aria-descriptor'}),required({factory:{sketch:function sketch(spec){var excludeFactory=exclude(spec,['factory']);return spec.factory.sketch(excludeFactory);}},schema:[required$1('factory')],name:'field'})]);var factory$i=function factory$i(detail,components,_spec,_externals){var behaviours=augment(detail.fieldBehaviours,[Composing.config({find:function find(container){return getPart(container,detail,'field');}}),Representing.config({store:{mode:'manual',getValue:function getValue(field){return Composing.getCurrent(field).bind(Representing.getValue);},setValue:function setValue(field,value){Composing.getCurrent(field).each(function(current){Representing.setValue(current,value);});}}})]);var events=derive$2([runOnAttached(function(component,_simulatedEvent){var ps=getParts(component,detail,['label','field','aria-descriptor']);ps.field().each(function(field){var id=generate$6(detail.prefix);ps.label().each(function(label){set$8(label.element,'for',id);set$8(field.element,'id',id);});ps['aria-descriptor']().each(function(descriptor){var descriptorId=generate$6(detail.prefix);set$8(descriptor.element,'id',descriptorId);set$8(field.element,'aria-describedby',descriptorId);});});})]);var apis={getField:function getField(container){return getPart(container,detail,'field');},getLabel:function getLabel(container){return getPart(container,detail,'label');}};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:behaviours,events:events,apis:apis};};var FormField=composite({name:'FormField',configFields:schema$l(),partFields:parts$e(),factory:factory$i,apis:{getField:function getField(apis,comp){return apis.getField(comp);},getLabel:function getLabel(apis,comp){return apis.getLabel(comp);}}});var exhibit$2=function exhibit$2(base,tabConfig){return nu$7({attributes:wrapAll([{key:tabConfig.tabAttr,value:'true'}])});};var ActiveTabstopping=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$2});var TabstopSchema=[defaulted('tabAttr','data-alloy-tabstop')];var Tabstopping=create$8({fields:TabstopSchema,name:'tabstopping',active:ActiveTabstopping});var global$7=tinymce.util.Tools.resolve('tinymce.html.Entities');var renderFormFieldWith=function renderFormFieldWith(pLabel,pField,extraClasses,extraBehaviours){var spec=renderFormFieldSpecWith(pLabel,pField,extraClasses,extraBehaviours);return FormField.sketch(spec);};var renderFormField=function renderFormField(pLabel,pField){return renderFormFieldWith(pLabel,pField,[],[]);};var renderFormFieldSpecWith=function renderFormFieldSpecWith(pLabel,pField,extraClasses,extraBehaviours){return{dom:renderFormFieldDomWith(extraClasses),components:pLabel.toArray().concat([pField]),fieldBehaviours:derive$1(extraBehaviours)};};var renderFormFieldDom=function renderFormFieldDom(){return renderFormFieldDomWith([]);};var renderFormFieldDomWith=function renderFormFieldDomWith(extraClasses){return{tag:'div',classes:['tox-form__group'].concat(extraClasses)};};var renderLabel$2=function renderLabel$2(label,providersBackstage){return FormField.parts.label({dom:{tag:'label',classes:['tox-label'],innerHtml:providersBackstage.translate(label)}});};var formChangeEvent=generate$6('form-component-change');var formCloseEvent=generate$6('form-close');var formCancelEvent=generate$6('form-cancel');var formActionEvent=generate$6('form-action');var formSubmitEvent=generate$6('form-submit');var formBlockEvent=generate$6('form-block');var formUnblockEvent=generate$6('form-unblock');var formTabChangeEvent=generate$6('form-tabchange');var formResizeEvent=generate$6('form-resize');var renderCollection=function renderCollection(spec,providersBackstage){var _a;var pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage);});var runOnItem=function runOnItem(f){return function(comp,se){closest$1(se.event.target,'[data-collection-item-value]').each(function(target){f(comp,se,target,get$d(target,'data-collection-item-value'));});};};var setContents=function setContents(comp,items){var htmlLines=map$2(items,function(item){var itemText=global$e.translate(item.text);var textContent=spec.columns===1?'<div class=\"tox-collection__item-label\">'+itemText+'</div>':'';var iconContent='<div class=\"tox-collection__item-icon\">'+item.icon+'</div>';var mapItemName={'_':' ',' - ':' ','-':' '};var ariaLabel=itemText.replace(/\\_| \\- |\\-/g,function(match){return mapItemName[match];});var disabledClass=providersBackstage.isDisabled()?' tox-collection__item--state-disabled':'';return'<div class=\"tox-collection__item'+disabledClass+'\" tabindex=\"-1\" data-collection-item-value=\"'+global$7.encodeAllRaw(item.value)+'\" title=\"'+ariaLabel+'\" aria-label=\"'+ariaLabel+'\">'+iconContent+textContent+'</div>';});var chunks=spec.columns!=='auto'&&spec.columns>1?chunk$1(htmlLines,spec.columns):[htmlLines];var html=map$2(chunks,function(ch){return'<div class=\"tox-collection__group\">'+ch.join('')+'</div>';});set$5(comp.element,html.join(''));};var onClick=runOnItem(function(comp,se,tgt,itemValue){se.stop();if(!providersBackstage.isDisabled()){emitWith(comp,formActionEvent,{name:spec.name,value:itemValue});}});var collectionEvents=[run$1(mouseover(),runOnItem(function(comp,se,tgt){focus$3(tgt);})),run$1(click(),onClick),run$1(tap(),onClick),run$1(focusin(),runOnItem(function(comp,se,tgt){descendant(comp.element,'.'+activeClass).each(function(currentActive){remove$2(currentActive,activeClass);});add$2(tgt,activeClass);})),run$1(focusout(),runOnItem(function(comp){descendant(comp.element,'.'+activeClass).each(function(currentActive){remove$2(currentActive,activeClass);});})),runOnExecute$1(runOnItem(function(comp,se,tgt,itemValue){emitWith(comp,formActionEvent,{name:spec.name,value:itemValue});}))];var iterCollectionItems=function iterCollectionItems(comp,applyAttributes){return map$2(descendants(comp.element,'.tox-collection__item'),applyAttributes);};var pField=FormField.parts.field({dom:{tag:'div',classes:['tox-collection'].concat(spec.columns!==1?['tox-collection--grid']:['tox-collection--list'])},components:[],factory:{sketch:identity$1},behaviours:derive$1([Disabling.config({disabled:providersBackstage.isDisabled,onDisabled:function onDisabled(comp){iterCollectionItems(comp,function(childElm){add$2(childElm,'tox-collection__item--state-disabled');set$8(childElm,'aria-disabled',true);});},onEnabled:function onEnabled(comp){iterCollectionItems(comp,function(childElm){remove$2(childElm,'tox-collection__item--state-disabled');remove$7(childElm,'aria-disabled');});}}),receivingConfig(),Replacing.config({}),Representing.config({store:{mode:'memory',initialValue:[]},onSetValue:function onSetValue(comp,items){setContents(comp,items);if(spec.columns==='auto'){detectSize(comp,5,'tox-collection__item').each(function(_a){var numRows=_a.numRows,numColumns=_a.numColumns;Keying.setGridSize(comp,numRows,numColumns);});}emit(comp,formResizeEvent);}}),Tabstopping.config({}),Keying.config(deriveCollectionMovement(spec.columns,'normal')),config('collection-events',collectionEvents)]),eventOrder:(_a={},_a[execute$5()]=['disabling','alloy.base.behaviour','collection-events'],_a)});var extraClasses=['tox-form__group--collection'];return renderFormFieldWith(pLabel,pField,extraClasses,[]);};var schema$k=constant$1([option('data'),defaulted('inputAttributes',{}),defaulted('inputStyles',{}),defaulted('tag','input'),defaulted('inputClasses',[]),onHandler('onSetValue'),defaulted('styles',{}),defaulted('eventOrder',{}),field('inputBehaviours',[Representing,Focusing]),defaulted('selectOnFocus',true)]);var focusBehaviours=function focusBehaviours(detail){return derive$1([Focusing.config({onFocus:!detail.selectOnFocus?noop:function(component){var input=component.element;var value=get$5(input);input.dom.setSelectionRange(0,value.length);}})]);};var behaviours=function behaviours(detail){return _assign(_assign({},focusBehaviours(detail)),augment(detail.inputBehaviours,[Representing.config({store:_assign(_assign({mode:'manual'},detail.data.map(function(data){return{initialValue:data};}).getOr({})),{getValue:function getValue(input){return get$5(input.element);},setValue:function setValue(input,data){var current=get$5(input.element);if(current!==data){set$4(input.element,data);}}}),onSetValue:detail.onSetValue})]));};var dom=function dom(detail){return{tag:detail.tag,attributes:_assign({type:'text'},detail.inputAttributes),styles:detail.inputStyles,classes:detail.inputClasses};};var factory$h=function factory$h(detail,_spec){return{uid:detail.uid,dom:dom(detail),components:[],behaviours:behaviours(detail),eventOrder:detail.eventOrder};};var Input=single({name:'Input',configFields:schema$k(),factory:factory$h});var exports$1={},module={exports:exports$1};(function(define,exports,module,require){(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):(global=typeof globalThis!=='undefined'?globalThis:global||self,global.EphoxContactWrapper=factory());})(this,function(){var commonjsGlobal=typeof globalThis!=='undefined'?globalThis:typeof window!=='undefined'?window:typeof __webpack_require__.g!=='undefined'?__webpack_require__.g:typeof self!=='undefined'?self:{};var promise={exports:{}};(function(module){(function(root){var setTimeoutFunc=setTimeout;function noop(){}function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments);};}function Promise(fn){if(typeof this!=='object')throw new TypeError('Promises must be constructed via new');if(typeof fn!=='function')throw new TypeError('not a function');this._state=0;this._handled=false;this._value=undefined;this._deferreds=[];doResolve(fn,this);}function handle(self,deferred){while(self._state===3){self=self._value;}if(self._state===0){self._deferreds.push(deferred);return;}self._handled=true;Promise._immediateFn(function(){var cb=self._state===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){(self._state===1?resolve:reject)(deferred.promise,self._value);return;}var ret;try{ret=cb(self._value);}catch(e){reject(deferred.promise,e);return;}resolve(deferred.promise,ret);});}function resolve(self,newValue){try{if(newValue===self)throw new TypeError('A promise cannot be resolved with itself.');if(newValue&&(typeof newValue==='object'||typeof newValue==='function')){var then=newValue.then;if(newValue instanceof Promise){self._state=3;self._value=newValue;finale(self);return;}else if(typeof then==='function'){doResolve(bind(then,newValue),self);return;}}self._state=1;self._value=newValue;finale(self);}catch(e){reject(self,e);}}function reject(self,newValue){self._state=2;self._value=newValue;finale(self);}function finale(self){if(self._state===2&&self._deferreds.length===0){Promise._immediateFn(function(){if(!self._handled){Promise._unhandledRejectionFn(self._value);}});}for(var i=0,len=self._deferreds.length;i<len;i++){handle(self,self._deferreds[i]);}self._deferreds=null;}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled==='function'?onFulfilled:null;this.onRejected=typeof onRejected==='function'?onRejected:null;this.promise=promise;}function doResolve(fn,self){var done=false;try{fn(function(value){if(done)return;done=true;resolve(self,value);},function(reason){if(done)return;done=true;reject(self,reason);});}catch(ex){if(done)return;done=true;reject(self,ex);}}Promise.prototype['catch']=function(onRejected){return this.then(null,onRejected);};Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);handle(this,new Handler(onFulfilled,onRejected,prom));return prom;};Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&(typeof val==='object'||typeof val==='function')){var then=val.then;if(typeof then==='function'){then.call(val,function(val){res(i,val);},reject);return;}}args[i]=val;if(--remaining===0){resolve(args);}}catch(ex){reject(ex);}}for(var i=0;i<args.length;i++){res(i,args[i]);}});};Promise.resolve=function(value){if(value&&typeof value==='object'&&value.constructor===Promise){return value;}return new Promise(function(resolve){resolve(value);});};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value);});};Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++){values[i].then(resolve,reject);}});};Promise._immediateFn=typeof setImmediate==='function'?function(fn){setImmediate(fn);}:function(fn){setTimeoutFunc(fn,0);};Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){if(typeof console!=='undefined'&&console){console.warn('Possible Unhandled Promise Rejection:',err);}};Promise._setImmediateFn=function _setImmediateFn(fn){Promise._immediateFn=fn;};Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){Promise._unhandledRejectionFn=fn;};if(module.exports){module.exports=Promise;}else if(!root.Promise){root.Promise=Promise;}})(commonjsGlobal);})(promise);var promisePolyfill=promise.exports;var Global=function(){if(typeof window!=='undefined'){return window;}else{return Function('return this;')();}}();var promisePolyfill_1={boltExport:Global.Promise||promisePolyfill};return promisePolyfill_1;});})(undefined,exports$1,module);var Promise$1=module.exports.boltExport;var _nu$=function nu$3(baseFn){var data=Optional.none();var callbacks=[];var map=function map(f){return _nu$(function(nCallback){get(function(data){nCallback(f(data));});});};var get=function get(nCallback){if(isReady()){call(nCallback);}else{callbacks.push(nCallback);}};var set=function set(x){if(!isReady()){data=Optional.some(x);run(callbacks);callbacks=[];}};var isReady=function isReady(){return data.isSome();};var run=function run(cbs){each$1(cbs,call);};var call=function call(cb){data.each(function(x){setTimeout(function(){cb(x);},0);});};baseFn(set);return{get:get,map:map,isReady:isReady};};var pure$1=function pure$1(a){return _nu$(function(callback){callback(a);});};var LazyValue={nu:_nu$,pure:pure$1};var errorReporter=function errorReporter(err){setTimeout(function(){throw err;},0);};var _make$=function make$5(run){var get=function get(callback){run().then(callback,errorReporter);};var map=function map(fab){return _make$(function(){return run().then(fab);});};var bind=function bind(aFutureB){return _make$(function(){return run().then(function(v){return aFutureB(v).toPromise();});});};var anonBind=function anonBind(futureB){return _make$(function(){return run().then(function(){return futureB.toPromise();});});};var toLazy=function toLazy(){return LazyValue.nu(get);};var toCached=function toCached(){var cache=null;return _make$(function(){if(cache===null){cache=run();}return cache;});};var toPromise=run;return{map:map,bind:bind,anonBind:anonBind,toLazy:toLazy,toCached:toCached,toPromise:toPromise,get:get};};var nu$2=function nu$2(baseFn){return _make$(function(){return new Promise$1(baseFn);});};var pure=function pure(a){return _make$(function(){return Promise$1.resolve(a);});};var Future={nu:nu$2,pure:pure};var ariaElements=['input','textarea'];var isAriaElement=function isAriaElement(elem){var name=name$2(elem);return contains$2(ariaElements,name);};var markValid=function markValid(component,invalidConfig){var elem=invalidConfig.getRoot(component).getOr(component.element);remove$2(elem,invalidConfig.invalidClass);invalidConfig.notify.each(function(notifyInfo){if(isAriaElement(component.element)){set$8(component.element,'aria-invalid',false);}notifyInfo.getContainer(component).each(function(container){set$5(container,notifyInfo.validHtml);});notifyInfo.onValid(component);});};var markInvalid=function markInvalid(component,invalidConfig,invalidState,text){var elem=invalidConfig.getRoot(component).getOr(component.element);add$2(elem,invalidConfig.invalidClass);invalidConfig.notify.each(function(notifyInfo){if(isAriaElement(component.element)){set$8(component.element,'aria-invalid',true);}notifyInfo.getContainer(component).each(function(container){set$5(container,text);});notifyInfo.onInvalid(component,text);});};var query=function query(component,invalidConfig,_invalidState){return invalidConfig.validator.fold(function(){return Future.pure(Result.value(true));},function(validatorInfo){return validatorInfo.validate(component);});};var run=function run(component,invalidConfig,invalidState){invalidConfig.notify.each(function(notifyInfo){notifyInfo.onValidate(component);});return query(component,invalidConfig).map(function(valid){if(component.getSystem().isConnected()){return valid.fold(function(err){markInvalid(component,invalidConfig,invalidState,err);return Result.error(err);},function(v){markValid(component,invalidConfig);return Result.value(v);});}else{return Result.error('No longer in system');}});};var isInvalid=function isInvalid(component,invalidConfig){var elem=invalidConfig.getRoot(component).getOr(component.element);return has(elem,invalidConfig.invalidClass);};var InvalidateApis=/*#__PURE__*/Object.freeze({__proto__:null,markValid:markValid,markInvalid:markInvalid,query:query,run:run,isInvalid:isInvalid});var events$8=function events$8(invalidConfig,invalidState){return invalidConfig.validator.map(function(validatorInfo){return derive$2([run$1(validatorInfo.onEvent,function(component){run(component,invalidConfig,invalidState).get(identity$1);})].concat(validatorInfo.validateOnLoad?[runOnAttached(function(component){run(component,invalidConfig,invalidState).get(noop);})]:[]));}).getOr({});};var ActiveInvalidate=/*#__PURE__*/Object.freeze({__proto__:null,events:events$8});var InvalidateSchema=[required$1('invalidClass'),defaulted('getRoot',Optional.none),optionObjOf('notify',[defaulted('aria','alert'),defaulted('getContainer',Optional.none),defaulted('validHtml',''),onHandler('onValid'),onHandler('onInvalid'),onHandler('onValidate')]),optionObjOf('validator',[required$1('validate'),defaulted('onEvent','input'),defaulted('validateOnLoad',true)])];var Invalidating=create$8({fields:InvalidateSchema,name:'invalidating',active:ActiveInvalidate,apis:InvalidateApis,extra:{validation:function validation(validator){return function(component){var v=Representing.getValue(component);return Future.pure(validator(v));};}}});var getCoupled=function getCoupled(component,coupleConfig,coupleState,name){return coupleState.getOrCreate(component,coupleConfig,name);};var CouplingApis=/*#__PURE__*/Object.freeze({__proto__:null,getCoupled:getCoupled});var CouplingSchema=[requiredOf('others',setOf(Result.value,anyValue()))];var init$a=function init$a(){var coupled={};var getOrCreate=function getOrCreate(component,coupleConfig,name){var available=keys(coupleConfig.others);if(!available){throw new Error('Cannot find coupled component: '+name+'. Known coupled components: '+JSON.stringify(available,null,2));}else{return get$e(coupled,name).getOrThunk(function(){var builder=get$e(coupleConfig.others,name).getOrDie('No information found for coupled component: '+name);var spec=builder(component);var built=component.getSystem().build(spec);coupled[name]=built;return built;});}};var readState=constant$1({});return nu$8({readState:readState,getOrCreate:getOrCreate});};var CouplingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$a});var Coupling=create$8({fields:CouplingSchema,name:'coupling',apis:CouplingApis,state:CouplingState});var suffix=constant$1('sink');var partType$1=constant$1(optional({name:suffix(),overrides:constant$1({dom:{tag:'div'},behaviours:derive$1([Positioning.config({useFixed:always})]),events:derive$2([cutter(keydown()),cutter(mousedown()),cutter(click())])})}));var HighlightOnOpen;(function(HighlightOnOpen){HighlightOnOpen[HighlightOnOpen['HighlightFirst']=0]='HighlightFirst';HighlightOnOpen[HighlightOnOpen['HighlightNone']=1]='HighlightNone';})(HighlightOnOpen||(HighlightOnOpen={}));var getAnchor=function getAnchor(detail,component){var hotspot=detail.getHotspot(component).getOr(component);var type='hotspot';var overrides=detail.getAnchorOverrides();return detail.layouts.fold(function(){return{type:type,hotspot:hotspot,overrides:overrides};},function(layouts){return{type:type,hotspot:hotspot,overrides:overrides,layouts:layouts};});};var fetch=function fetch(detail,mapFetch,component){var fetcher=detail.fetch;return fetcher(component).map(mapFetch);};var openF=function openF(detail,mapFetch,anchor,component,sandbox,externals,highlightOnOpen){var futureData=fetch(detail,mapFetch,component);var getLazySink=getSink(component,detail);return futureData.map(function(tdata){return tdata.bind(function(data){return Optional.from(tieredMenu.sketch(_assign(_assign({},externals.menu()),{uid:generate$5(''),data:data,highlightImmediately:highlightOnOpen===HighlightOnOpen.HighlightFirst,onOpenMenu:function onOpenMenu(tmenu,menu){var sink=getLazySink().getOrDie();Positioning.position(sink,menu,{anchor:anchor});Sandboxing.decloak(sandbox);},onOpenSubmenu:function onOpenSubmenu(tmenu,item,submenu){var sink=getLazySink().getOrDie();Positioning.position(sink,submenu,{anchor:{type:'submenu',item:item}});Sandboxing.decloak(sandbox);},onRepositionMenu:function onRepositionMenu(tmenu,primaryMenu,submenuTriggers){var sink=getLazySink().getOrDie();Positioning.position(sink,primaryMenu,{anchor:anchor});each$1(submenuTriggers,function(st){Positioning.position(sink,st.triggeredMenu,{anchor:{type:'submenu',item:st.triggeringItem}});});},onEscape:function onEscape(){Focusing.focus(component);Sandboxing.close(sandbox);return Optional.some(true);}})));});});};var open=function open(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen){var anchor=getAnchor(detail,hotspot);var processed=openF(detail,mapFetch,anchor,hotspot,sandbox,externals,highlightOnOpen);return processed.map(function(tdata){tdata.fold(function(){if(Sandboxing.isOpen(sandbox)){Sandboxing.close(sandbox);}},function(data){Sandboxing.cloak(sandbox);Sandboxing.open(sandbox,data);onOpenSync(sandbox);});return sandbox;});};var close=function close(detail,mapFetch,component,sandbox,_externals,_onOpenSync,_highlightOnOpen){Sandboxing.close(sandbox);return Future.pure(sandbox);};var togglePopup=function togglePopup(detail,mapFetch,hotspot,externals,onOpenSync,highlightOnOpen){var sandbox=Coupling.getCoupled(hotspot,'sandbox');var showing=Sandboxing.isOpen(sandbox);var action=showing?close:open;return action(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen);};var matchWidth=function matchWidth(hotspot,container,useMinWidth){var menu=Composing.getCurrent(container).getOr(container);var buttonWidth=get$a(hotspot.element);if(useMinWidth){set$7(menu.element,'min-width',buttonWidth+'px');}else{set$6(menu.element,buttonWidth);}};var getSink=function getSink(anyInSystem,sinkDetail){return anyInSystem.getSystem().getByUid(sinkDetail.uid+'-'+suffix()).map(function(internalSink){return function(){return Result.value(internalSink);};}).getOrThunk(function(){return sinkDetail.lazySink.fold(function(){return function(){return Result.error(new Error('No internal sink is specified, nor could an external sink be found'));};},function(lazySinkFn){return function(){return lazySinkFn(anyInSystem);};});});};var doRepositionMenus=function doRepositionMenus(sandbox){Sandboxing.getState(sandbox).each(function(tmenu){tieredMenu.repositionMenus(tmenu);});};var makeSandbox$1=function makeSandbox$1(detail,hotspot,extras){var ariaOwner=manager();var onOpen=function onOpen(component,menu){var anchor=getAnchor(detail,hotspot);ariaOwner.link(hotspot.element);if(detail.matchWidth){matchWidth(anchor.hotspot,menu,detail.useMinWidth);}detail.onOpen(anchor,component,menu);if(extras!==undefined&&extras.onOpen!==undefined){extras.onOpen(component,menu);}};var onClose=function onClose(component,menu){ariaOwner.unlink(hotspot.element);if(extras!==undefined&&extras.onClose!==undefined){extras.onClose(component,menu);}};var lazySink=getSink(hotspot,detail);return{dom:{tag:'div',classes:detail.sandboxClasses,attributes:{id:ariaOwner.id,role:'listbox'}},behaviours:SketchBehaviours.augment(detail.sandboxBehaviours,[Representing.config({store:{mode:'memory',initialValue:hotspot}}),Sandboxing.config({onOpen:onOpen,onClose:onClose,isPartOf:function isPartOf(container,data,queryElem){return isPartOf$1(data,queryElem)||isPartOf$1(hotspot,queryElem);},getAttachPoint:function getAttachPoint(){return lazySink().getOrDie();}}),Composing.config({find:function find(sandbox){return Sandboxing.getState(sandbox).bind(function(menu){return Composing.getCurrent(menu);});}}),Receiving.config({channels:_assign(_assign({},receivingChannel$1({isExtraPart:never})),receivingChannel({doReposition:doRepositionMenus}))})])};};var _repositionMenus=function repositionMenus(comp){var sandbox=Coupling.getCoupled(comp,'sandbox');doRepositionMenus(sandbox);};var sandboxFields=function sandboxFields(){return[defaulted('sandboxClasses',[]),SketchBehaviours.field('sandboxBehaviours',[Composing,Receiving,Sandboxing,Representing])];};var schema$j=constant$1([required$1('dom'),required$1('fetch'),onHandler('onOpen'),onKeyboardHandler('onExecute'),defaulted('getHotspot',Optional.some),defaulted('getAnchorOverrides',constant$1({})),schema$y(),field('dropdownBehaviours',[Toggling,Coupling,Keying,Focusing]),required$1('toggleClass'),defaulted('eventOrder',{}),option('lazySink'),defaulted('matchWidth',false),defaulted('useMinWidth',false),option('role')].concat(sandboxFields()));var parts$d=constant$1([external$1({schema:[tieredMenuMarkers()],name:'menu',defaults:function defaults(detail){return{onExecute:detail.onExecute};}}),partType$1()]);var factory$g=function factory$g(detail,components,_spec,externals){var _a;var lookupAttr=function lookupAttr(attr){return get$e(detail.dom,'attributes').bind(function(attrs){return get$e(attrs,attr);});};var switchToMenu=function switchToMenu(sandbox){Sandboxing.getState(sandbox).each(function(tmenu){tieredMenu.highlightPrimary(tmenu);});};var action=function action(component){var onOpenSync=switchToMenu;togglePopup(detail,identity$1,component,externals,onOpenSync,HighlightOnOpen.HighlightFirst).get(noop);};var apis={expand:function expand(comp){if(!Toggling.isOn(comp)){togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightNone).get(noop);}},open:function open(comp){if(!Toggling.isOn(comp)){togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightFirst).get(noop);}},isOpen:Toggling.isOn,close:function close(comp){if(Toggling.isOn(comp)){togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightFirst).get(noop);}},repositionMenus:function repositionMenus(comp){if(Toggling.isOn(comp)){_repositionMenus(comp);}}};var triggerExecute=function triggerExecute(comp,_se){emitExecute(comp);return Optional.some(true);};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.dropdownBehaviours,[Toggling.config({toggleClass:detail.toggleClass,aria:{mode:'expanded'}}),Coupling.config({others:{sandbox:function sandbox(hotspot){return makeSandbox$1(detail,hotspot,{onOpen:function onOpen(){return Toggling.on(hotspot);},onClose:function onClose(){return Toggling.off(hotspot);}});}}}),Keying.config({mode:'special',onSpace:triggerExecute,onEnter:triggerExecute,onDown:function onDown(comp,_se){if(Dropdown.isOpen(comp)){var sandbox=Coupling.getCoupled(comp,'sandbox');switchToMenu(sandbox);}else{Dropdown.open(comp);}return Optional.some(true);},onEscape:function onEscape(comp,_se){if(Dropdown.isOpen(comp)){Dropdown.close(comp);return Optional.some(true);}else{return Optional.none();}}}),Focusing.config({})]),events:events$a(Optional.some(action)),eventOrder:_assign(_assign({},detail.eventOrder),(_a={},_a[execute$5()]=['disabling','toggling','alloy.base.behaviour'],_a)),apis:apis,domModification:{attributes:_assign(_assign({'aria-haspopup':'true'},detail.role.fold(function(){return{};},function(role){return{role:role};})),detail.dom.tag==='button'?{type:lookupAttr('type').getOr('button')}:{})}};};var Dropdown=composite({name:'Dropdown',configFields:schema$j(),partFields:parts$d(),factory:factory$g,apis:{open:function open(apis,comp){return apis.open(comp);},expand:function expand(apis,comp){return apis.expand(comp);},close:function close(apis,comp){return apis.close(comp);},isOpen:function isOpen(apis,comp){return apis.isOpen(comp);},repositionMenus:function repositionMenus(apis,comp){return apis.repositionMenus(comp);}}});var exhibit$1=function exhibit$1(){return nu$7({styles:{'-webkit-user-select':'none','user-select':'none','-ms-user-select':'none','-moz-user-select':'-moz-none'},attributes:{unselectable:'on'}});};var events$7=function events$7(){return derive$2([abort(selectstart(),always)]);};var ActiveUnselecting=/*#__PURE__*/Object.freeze({__proto__:null,events:events$7,exhibit:exhibit$1});var Unselecting=create$8({fields:[],name:'unselecting',active:ActiveUnselecting});var renderPanelButton=function renderPanelButton(spec,sharedBackstage){return Dropdown.sketch({dom:spec.dom,components:spec.components,toggleClass:'mce-active',dropdownBehaviours:derive$1([DisablingConfigs.button(sharedBackstage.providers.isDisabled),receivingConfig(),Unselecting.config({}),Tabstopping.config({})]),layouts:spec.layouts,sandboxClasses:['tox-dialog__popups'],lazySink:sharedBackstage.getSink,fetch:function fetch(comp){return Future.nu(function(callback){return spec.fetch(callback);}).map(function(items){return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6('menu-value'),items,function(value){spec.onItemAction(comp,value);},spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,never,sharedBackstage.providers),{movement:deriveMenuMovement(spec.columns,spec.presets)})));});},parts:{menu:part(false,1,spec.presets)}});};var colorInputChangeEvent=generate$6('color-input-change');var colorSwatchChangeEvent=generate$6('color-swatch-change');var colorPickerCancelEvent=generate$6('color-picker-cancel');var renderColorInput=function renderColorInput(spec,sharedBackstage,colorInputBackstage){var pField=FormField.parts.field({factory:Input,inputClasses:['tox-textfield'],onSetValue:function onSetValue(c){return Invalidating.run(c).get(noop);},inputBehaviours:derive$1([Disabling.config({disabled:sharedBackstage.providers.isDisabled}),receivingConfig(),Tabstopping.config({}),Invalidating.config({invalidClass:'tox-textbox-field-invalid',getRoot:function getRoot(comp){return parent(comp.element);},notify:{onValid:function onValid(comp){var val=Representing.getValue(comp);emitWith(comp,colorInputChangeEvent,{color:val});}},validator:{validateOnLoad:false,validate:function validate(input){var inputValue=Representing.getValue(input);if(inputValue.length===0){return Future.pure(Result.value(true));}else{var span=SugarElement.fromTag('span');set$7(span,'background-color',inputValue);var res=getRaw(span,'background-color').fold(function(){return Result.error('blah');},function(_){return Result.value(inputValue);});return Future.pure(res);}}}})]),selectOnFocus:false});var pLabel=spec.label.map(function(label){return renderLabel$2(label,sharedBackstage.providers);});var emitSwatchChange=function emitSwatchChange(colorBit,value){emitWith(colorBit,colorSwatchChangeEvent,{value:value});};var onItemAction=function onItemAction(comp,value){memColorButton.getOpt(comp).each(function(colorBit){if(value==='custom'){colorInputBackstage.colorPicker(function(valueOpt){valueOpt.fold(function(){return emit(colorBit,colorPickerCancelEvent);},function(value){emitSwatchChange(colorBit,value);addColor(value);});},'#ffffff');}else if(value==='remove'){emitSwatchChange(colorBit,'');}else{emitSwatchChange(colorBit,value);}});};var memColorButton=record(renderPanelButton({dom:{tag:'span',attributes:{'aria-label':sharedBackstage.providers.translate('Color swatch')}},layouts:{onRtl:function onRtl(){return[southwest$2,southeast$2,south$2];},onLtr:function onLtr(){return[southeast$2,southwest$2,south$2];}},components:[],fetch:getFetch$1(colorInputBackstage.getColors(),colorInputBackstage.hasCustomColors()),columns:colorInputBackstage.getColorCols(),presets:'color',onItemAction:onItemAction},sharedBackstage));return FormField.sketch({dom:{tag:'div',classes:['tox-form__group']},components:pLabel.toArray().concat([{dom:{tag:'div',classes:['tox-color-input']},components:[pField,memColorButton.asSpec()]}]),fieldBehaviours:derive$1([config('form-field-events',[run$1(colorInputChangeEvent,function(comp,se){memColorButton.getOpt(comp).each(function(colorButton){set$7(colorButton.element,'background-color',se.event.color);});emitWith(comp,formChangeEvent,{name:spec.name});}),run$1(colorSwatchChangeEvent,function(comp,se){FormField.getField(comp).each(function(field){Representing.setValue(field,se.event.value);Composing.getCurrent(comp).each(Focusing.focus);});}),run$1(colorPickerCancelEvent,function(comp,_se){FormField.getField(comp).each(function(_field){Composing.getCurrent(comp).each(Focusing.focus);});})])])});};var labelPart=optional({schema:[required$1('dom')],name:'label'});var edgePart=function edgePart(name){return optional({name:''+name+'-edge',overrides:function overrides(detail){var action=detail.model.manager.edgeActions[name];return action.fold(function(){return{};},function(a){return{events:derive$2([runActionExtra(touchstart(),function(comp,se,d){return a(comp,d);},[detail]),runActionExtra(mousedown(),function(comp,se,d){return a(comp,d);},[detail]),runActionExtra(mousemove(),function(comp,se,det){if(det.mouseIsDown.get()){a(comp,det);}},[detail])])};});}});};var tlEdgePart=edgePart('top-left');var tedgePart=edgePart('top');var trEdgePart=edgePart('top-right');var redgePart=edgePart('right');var brEdgePart=edgePart('bottom-right');var bedgePart=edgePart('bottom');var blEdgePart=edgePart('bottom-left');var ledgePart=edgePart('left');var thumbPart=required({name:'thumb',defaults:constant$1({dom:{styles:{position:'absolute'}}}),overrides:function overrides(detail){return{events:derive$2([redirectToPart(touchstart(),detail,'spectrum'),redirectToPart(touchmove(),detail,'spectrum'),redirectToPart(touchend(),detail,'spectrum'),redirectToPart(mousedown(),detail,'spectrum'),redirectToPart(mousemove(),detail,'spectrum'),redirectToPart(mouseup(),detail,'spectrum')])};}});var spectrumPart=required({schema:[customField('mouseIsDown',function(){return Cell(false);})],name:'spectrum',overrides:function overrides(detail){var modelDetail=detail.model;var model=modelDetail.manager;var setValueFrom=function setValueFrom(component,simulatedEvent){return model.getValueFromEvent(simulatedEvent).map(function(value){return model.setValueFrom(component,detail,value);});};return{behaviours:derive$1([Keying.config({mode:'special',onLeft:function onLeft(spectrum){return model.onLeft(spectrum,detail);},onRight:function onRight(spectrum){return model.onRight(spectrum,detail);},onUp:function onUp(spectrum){return model.onUp(spectrum,detail);},onDown:function onDown(spectrum){return model.onDown(spectrum,detail);}}),Focusing.config({})]),events:derive$2([run$1(touchstart(),setValueFrom),run$1(touchmove(),setValueFrom),run$1(mousedown(),setValueFrom),run$1(mousemove(),function(spectrum,se){if(detail.mouseIsDown.get()){setValueFrom(spectrum,se);}})])};}});var SliderParts=[labelPart,ledgePart,redgePart,tedgePart,bedgePart,tlEdgePart,trEdgePart,blEdgePart,brEdgePart,thumbPart,spectrumPart];var _sliderChangeEvent='slider.change.value';var sliderChangeEvent=constant$1(_sliderChangeEvent);var isTouchEvent$2=function isTouchEvent$2(evt){return evt.type.indexOf('touch')!==-1;};var getEventSource=function getEventSource(simulatedEvent){var evt=simulatedEvent.event.raw;if(isTouchEvent$2(evt)){var touchEvent=evt;return touchEvent.touches!==undefined&&touchEvent.touches.length===1?Optional.some(touchEvent.touches[0]).map(function(t){return SugarPosition(t.clientX,t.clientY);}):Optional.none();}else{var mouseEvent=evt;return mouseEvent.clientX!==undefined?Optional.some(mouseEvent).map(function(me){return SugarPosition(me.clientX,me.clientY);}):Optional.none();}};var t='top',r='right',b='bottom',l='left';var minX=function minX(detail){return detail.model.minX;};var minY=function minY(detail){return detail.model.minY;};var min1X=function min1X(detail){return detail.model.minX-1;};var min1Y=function min1Y(detail){return detail.model.minY-1;};var maxX=function maxX(detail){return detail.model.maxX;};var maxY=function maxY(detail){return detail.model.maxY;};var max1X=function max1X(detail){return detail.model.maxX+1;};var max1Y=function max1Y(detail){return detail.model.maxY+1;};var range=function range(detail,max,min){return max(detail)-min(detail);};var xRange=function xRange(detail){return range(detail,maxX,minX);};var yRange=function yRange(detail){return range(detail,maxY,minY);};var halfX=function halfX(detail){return xRange(detail)/2;};var halfY=function halfY(detail){return yRange(detail)/2;};var step=function step(detail){return detail.stepSize;};var snap=function snap(detail){return detail.snapToGrid;};var snapStart=function snapStart(detail){return detail.snapStart;};var rounded=function rounded(detail){return detail.rounded;};var hasEdge=function hasEdge(detail,edgeName){return detail[edgeName+'-edge']!==undefined;};var hasLEdge=function hasLEdge(detail){return hasEdge(detail,l);};var hasREdge=function hasREdge(detail){return hasEdge(detail,r);};var hasTEdge=function hasTEdge(detail){return hasEdge(detail,t);};var hasBEdge=function hasBEdge(detail){return hasEdge(detail,b);};var currentValue=function currentValue(detail){return detail.model.value.get();};var xValue=function xValue(x){return{x:x};};var yValue=function yValue(y){return{y:y};};var xyValue=function xyValue(x,y){return{x:x,y:y};};var fireSliderChange$3=function fireSliderChange$3(component,value){emitWith(component,sliderChangeEvent(),{value:value});};var setToTLEdgeXY=function setToTLEdgeXY(edge,detail){fireSliderChange$3(edge,xyValue(min1X(detail),min1Y(detail)));};var setToTEdge=function setToTEdge(edge,detail){fireSliderChange$3(edge,yValue(min1Y(detail)));};var setToTEdgeXY=function setToTEdgeXY(edge,detail){fireSliderChange$3(edge,xyValue(halfX(detail),min1Y(detail)));};var setToTREdgeXY=function setToTREdgeXY(edge,detail){fireSliderChange$3(edge,xyValue(max1X(detail),min1Y(detail)));};var setToREdge=function setToREdge(edge,detail){fireSliderChange$3(edge,xValue(max1X(detail)));};var setToREdgeXY=function setToREdgeXY(edge,detail){fireSliderChange$3(edge,xyValue(max1X(detail),halfY(detail)));};var setToBREdgeXY=function setToBREdgeXY(edge,detail){fireSliderChange$3(edge,xyValue(max1X(detail),max1Y(detail)));};var setToBEdge=function setToBEdge(edge,detail){fireSliderChange$3(edge,yValue(max1Y(detail)));};var setToBEdgeXY=function setToBEdgeXY(edge,detail){fireSliderChange$3(edge,xyValue(halfX(detail),max1Y(detail)));};var setToBLEdgeXY=function setToBLEdgeXY(edge,detail){fireSliderChange$3(edge,xyValue(min1X(detail),max1Y(detail)));};var setToLEdge=function setToLEdge(edge,detail){fireSliderChange$3(edge,xValue(min1X(detail)));};var setToLEdgeXY=function setToLEdgeXY(edge,detail){fireSliderChange$3(edge,xyValue(min1X(detail),halfY(detail)));};var reduceBy=function reduceBy(value,min,max,step){if(value<min){return value;}else if(value>max){return max;}else if(value===min){return min-1;}else{return Math.max(min,value-step);}};var increaseBy=function increaseBy(value,min,max,step){if(value>max){return value;}else if(value<min){return min;}else if(value===max){return max+1;}else{return Math.min(max,value+step);}};var capValue=function capValue(value,min,max){return Math.max(min,Math.min(max,value));};var snapValueOf=function snapValueOf(value,min,max,step,snapStart){return snapStart.fold(function(){var initValue=value-min;var extraValue=Math.round(initValue/step)*step;return capValue(min+extraValue,min-1,max+1);},function(start){var remainder=(value-start)%step;var adjustment=Math.round(remainder/step);var rawSteps=Math.floor((value-start)/step);var maxSteps=Math.floor((max-start)/step);var numSteps=Math.min(maxSteps,rawSteps+adjustment);var r=start+numSteps*step;return Math.max(start,r);});};var findOffsetOf=function findOffsetOf(value,min,max){return Math.min(max,Math.max(value,min))-min;};var findValueOf=function findValueOf(args){var min=args.min,max=args.max,range=args.range,value=args.value,step=args.step,snap=args.snap,snapStart=args.snapStart,rounded=args.rounded,hasMinEdge=args.hasMinEdge,hasMaxEdge=args.hasMaxEdge,minBound=args.minBound,maxBound=args.maxBound,screenRange=args.screenRange;var capMin=hasMinEdge?min-1:min;var capMax=hasMaxEdge?max+1:max;if(value<minBound){return capMin;}else if(value>maxBound){return capMax;}else{var offset=findOffsetOf(value,minBound,maxBound);var newValue=capValue(offset/screenRange*range+min,capMin,capMax);if(snap&&newValue>=min&&newValue<=max){return snapValueOf(newValue,min,max,step,snapStart);}else if(rounded){return Math.round(newValue);}else{return newValue;}}};var findOffsetOfValue$2=function findOffsetOfValue$2(args){var min=args.min,max=args.max,range=args.range,value=args.value,hasMinEdge=args.hasMinEdge,hasMaxEdge=args.hasMaxEdge,maxBound=args.maxBound,maxOffset=args.maxOffset,centerMinEdge=args.centerMinEdge,centerMaxEdge=args.centerMaxEdge;if(value<min){return hasMinEdge?0:centerMinEdge;}else if(value>max){return hasMaxEdge?maxBound:centerMaxEdge;}else{return(value-min)/range*maxOffset;}};var top='top',right='right',bottom='bottom',left='left',width='width',height='height';var getBounds=function getBounds(component){return component.element.dom.getBoundingClientRect();};var getBoundsProperty=function getBoundsProperty(bounds,property){return bounds[property];};var getMinXBounds=function getMinXBounds(component){var bounds=getBounds(component);return getBoundsProperty(bounds,left);};var getMaxXBounds=function getMaxXBounds(component){var bounds=getBounds(component);return getBoundsProperty(bounds,right);};var getMinYBounds=function getMinYBounds(component){var bounds=getBounds(component);return getBoundsProperty(bounds,top);};var getMaxYBounds=function getMaxYBounds(component){var bounds=getBounds(component);return getBoundsProperty(bounds,bottom);};var getXScreenRange=function getXScreenRange(component){var bounds=getBounds(component);return getBoundsProperty(bounds,width);};var getYScreenRange=function getYScreenRange(component){var bounds=getBounds(component);return getBoundsProperty(bounds,height);};var getCenterOffsetOf=function getCenterOffsetOf(componentMinEdge,componentMaxEdge,spectrumMinEdge){return(componentMinEdge+componentMaxEdge)/2-spectrumMinEdge;};var getXCenterOffSetOf=function getXCenterOffSetOf(component,spectrum){var componentBounds=getBounds(component);var spectrumBounds=getBounds(spectrum);var componentMinEdge=getBoundsProperty(componentBounds,left);var componentMaxEdge=getBoundsProperty(componentBounds,right);var spectrumMinEdge=getBoundsProperty(spectrumBounds,left);return getCenterOffsetOf(componentMinEdge,componentMaxEdge,spectrumMinEdge);};var getYCenterOffSetOf=function getYCenterOffSetOf(component,spectrum){var componentBounds=getBounds(component);var spectrumBounds=getBounds(spectrum);var componentMinEdge=getBoundsProperty(componentBounds,top);var componentMaxEdge=getBoundsProperty(componentBounds,bottom);var spectrumMinEdge=getBoundsProperty(spectrumBounds,top);return getCenterOffsetOf(componentMinEdge,componentMaxEdge,spectrumMinEdge);};var fireSliderChange$2=function fireSliderChange$2(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value});};var sliderValue$2=function sliderValue$2(x){return{x:x};};var findValueOfOffset$1=function findValueOfOffset$1(spectrum,detail,left){var args={min:minX(detail),max:maxX(detail),range:xRange(detail),value:left,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),maxBound:getMaxXBounds(spectrum),screenRange:getXScreenRange(spectrum)};return findValueOf(args);};var setValueFrom$2=function setValueFrom$2(spectrum,detail,value){var xValue=findValueOfOffset$1(spectrum,detail,value);var sliderVal=sliderValue$2(xValue);fireSliderChange$2(spectrum,sliderVal);return xValue;};var setToMin$2=function setToMin$2(spectrum,detail){var min=minX(detail);fireSliderChange$2(spectrum,sliderValue$2(min));};var setToMax$2=function setToMax$2(spectrum,detail){var max=maxX(detail);fireSliderChange$2(spectrum,sliderValue$2(max));};var moveBy$2=function moveBy$2(direction,spectrum,detail){var f=direction>0?increaseBy:reduceBy;var xValue=f(currentValue(detail).x,minX(detail),maxX(detail),step(detail));fireSliderChange$2(spectrum,sliderValue$2(xValue));return Optional.some(xValue);};var handleMovement$2=function handleMovement$2(direction){return function(spectrum,detail){return moveBy$2(direction,spectrum,detail).map(always);};};var getValueFromEvent$2=function getValueFromEvent$2(simulatedEvent){var pos=getEventSource(simulatedEvent);return pos.map(function(p){return p.left;});};var findOffsetOfValue$1=function findOffsetOfValue$1(spectrum,detail,value,minEdge,maxEdge){var minOffset=0;var maxOffset=getXScreenRange(spectrum);var centerMinEdge=minEdge.bind(function(edge){return Optional.some(getXCenterOffSetOf(edge,spectrum));}).getOr(minOffset);var centerMaxEdge=maxEdge.bind(function(edge){return Optional.some(getXCenterOffSetOf(edge,spectrum));}).getOr(maxOffset);var args={min:minX(detail),max:maxX(detail),range:xRange(detail),value:value,hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),minOffset:minOffset,maxBound:getMaxXBounds(spectrum),maxOffset:maxOffset,centerMinEdge:centerMinEdge,centerMaxEdge:centerMaxEdge};return findOffsetOfValue$2(args);};var findPositionOfValue$1=function findPositionOfValue$1(slider,spectrum,value,minEdge,maxEdge,detail){var offset=findOffsetOfValue$1(spectrum,detail,value,minEdge,maxEdge);return getMinXBounds(spectrum)-getMinXBounds(slider)+offset;};var setPositionFromValue$2=function setPositionFromValue$2(slider,thumb,detail,edges){var value=currentValue(detail);var pos=findPositionOfValue$1(slider,edges.getSpectrum(slider),value.x,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail);var thumbRadius=get$a(thumb.element)/2;set$7(thumb.element,'left',pos-thumbRadius+'px');};var onLeft$2=handleMovement$2(-1);var onRight$2=handleMovement$2(1);var onUp$2=Optional.none;var onDown$2=Optional.none;var edgeActions$2={'top-left':Optional.none(),'top':Optional.none(),'top-right':Optional.none(),'right':Optional.some(setToREdge),'bottom-right':Optional.none(),'bottom':Optional.none(),'bottom-left':Optional.none(),'left':Optional.some(setToLEdge)};var HorizontalModel=/*#__PURE__*/Object.freeze({__proto__:null,setValueFrom:setValueFrom$2,setToMin:setToMin$2,setToMax:setToMax$2,findValueOfOffset:findValueOfOffset$1,getValueFromEvent:getValueFromEvent$2,findPositionOfValue:findPositionOfValue$1,setPositionFromValue:setPositionFromValue$2,onLeft:onLeft$2,onRight:onRight$2,onUp:onUp$2,onDown:onDown$2,edgeActions:edgeActions$2});var fireSliderChange$1=function fireSliderChange$1(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value});};var sliderValue$1=function sliderValue$1(y){return{y:y};};var findValueOfOffset=function findValueOfOffset(spectrum,detail,top){var args={min:minY(detail),max:maxY(detail),range:yRange(detail),value:top,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),maxBound:getMaxYBounds(spectrum),screenRange:getYScreenRange(spectrum)};return findValueOf(args);};var setValueFrom$1=function setValueFrom$1(spectrum,detail,value){var yValue=findValueOfOffset(spectrum,detail,value);var sliderVal=sliderValue$1(yValue);fireSliderChange$1(spectrum,sliderVal);return yValue;};var setToMin$1=function setToMin$1(spectrum,detail){var min=minY(detail);fireSliderChange$1(spectrum,sliderValue$1(min));};var setToMax$1=function setToMax$1(spectrum,detail){var max=maxY(detail);fireSliderChange$1(spectrum,sliderValue$1(max));};var moveBy$1=function moveBy$1(direction,spectrum,detail){var f=direction>0?increaseBy:reduceBy;var yValue=f(currentValue(detail).y,minY(detail),maxY(detail),step(detail));fireSliderChange$1(spectrum,sliderValue$1(yValue));return Optional.some(yValue);};var handleMovement$1=function handleMovement$1(direction){return function(spectrum,detail){return moveBy$1(direction,spectrum,detail).map(always);};};var getValueFromEvent$1=function getValueFromEvent$1(simulatedEvent){var pos=getEventSource(simulatedEvent);return pos.map(function(p){return p.top;});};var findOffsetOfValue=function findOffsetOfValue(spectrum,detail,value,minEdge,maxEdge){var minOffset=0;var maxOffset=getYScreenRange(spectrum);var centerMinEdge=minEdge.bind(function(edge){return Optional.some(getYCenterOffSetOf(edge,spectrum));}).getOr(minOffset);var centerMaxEdge=maxEdge.bind(function(edge){return Optional.some(getYCenterOffSetOf(edge,spectrum));}).getOr(maxOffset);var args={min:minY(detail),max:maxY(detail),range:yRange(detail),value:value,hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),minOffset:minOffset,maxBound:getMaxYBounds(spectrum),maxOffset:maxOffset,centerMinEdge:centerMinEdge,centerMaxEdge:centerMaxEdge};return findOffsetOfValue$2(args);};var findPositionOfValue=function findPositionOfValue(slider,spectrum,value,minEdge,maxEdge,detail){var offset=findOffsetOfValue(spectrum,detail,value,minEdge,maxEdge);return getMinYBounds(spectrum)-getMinYBounds(slider)+offset;};var setPositionFromValue$1=function setPositionFromValue$1(slider,thumb,detail,edges){var value=currentValue(detail);var pos=findPositionOfValue(slider,edges.getSpectrum(slider),value.y,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail);var thumbRadius=get$b(thumb.element)/2;set$7(thumb.element,'top',pos-thumbRadius+'px');};var onLeft$1=Optional.none;var onRight$1=Optional.none;var onUp$1=handleMovement$1(-1);var onDown$1=handleMovement$1(1);var edgeActions$1={'top-left':Optional.none(),'top':Optional.some(setToTEdge),'top-right':Optional.none(),'right':Optional.none(),'bottom-right':Optional.none(),'bottom':Optional.some(setToBEdge),'bottom-left':Optional.none(),'left':Optional.none()};var VerticalModel=/*#__PURE__*/Object.freeze({__proto__:null,setValueFrom:setValueFrom$1,setToMin:setToMin$1,setToMax:setToMax$1,findValueOfOffset:findValueOfOffset,getValueFromEvent:getValueFromEvent$1,findPositionOfValue:findPositionOfValue,setPositionFromValue:setPositionFromValue$1,onLeft:onLeft$1,onRight:onRight$1,onUp:onUp$1,onDown:onDown$1,edgeActions:edgeActions$1});var fireSliderChange=function fireSliderChange(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value});};var sliderValue=function sliderValue(x,y){return{x:x,y:y};};var setValueFrom=function setValueFrom(spectrum,detail,value){var xValue=findValueOfOffset$1(spectrum,detail,value.left);var yValue=findValueOfOffset(spectrum,detail,value.top);var val=sliderValue(xValue,yValue);fireSliderChange(spectrum,val);return val;};var moveBy=function moveBy(direction,isVerticalMovement,spectrum,detail){var f=direction>0?increaseBy:reduceBy;var xValue=isVerticalMovement?currentValue(detail).x:f(currentValue(detail).x,minX(detail),maxX(detail),step(detail));var yValue=!isVerticalMovement?currentValue(detail).y:f(currentValue(detail).y,minY(detail),maxY(detail),step(detail));fireSliderChange(spectrum,sliderValue(xValue,yValue));return Optional.some(xValue);};var handleMovement=function handleMovement(direction,isVerticalMovement){return function(spectrum,detail){return moveBy(direction,isVerticalMovement,spectrum,detail).map(always);};};var setToMin=function setToMin(spectrum,detail){var mX=minX(detail);var mY=minY(detail);fireSliderChange(spectrum,sliderValue(mX,mY));};var setToMax=function setToMax(spectrum,detail){var mX=maxX(detail);var mY=maxY(detail);fireSliderChange(spectrum,sliderValue(mX,mY));};var getValueFromEvent=function getValueFromEvent(simulatedEvent){return getEventSource(simulatedEvent);};var setPositionFromValue=function setPositionFromValue(slider,thumb,detail,edges){var value=currentValue(detail);var xPos=findPositionOfValue$1(slider,edges.getSpectrum(slider),value.x,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail);var yPos=findPositionOfValue(slider,edges.getSpectrum(slider),value.y,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail);var thumbXRadius=get$a(thumb.element)/2;var thumbYRadius=get$b(thumb.element)/2;set$7(thumb.element,'left',xPos-thumbXRadius+'px');set$7(thumb.element,'top',yPos-thumbYRadius+'px');};var onLeft=handleMovement(-1,false);var onRight=handleMovement(1,false);var onUp=handleMovement(-1,true);var onDown=handleMovement(1,true);var edgeActions={'top-left':Optional.some(setToTLEdgeXY),'top':Optional.some(setToTEdgeXY),'top-right':Optional.some(setToTREdgeXY),'right':Optional.some(setToREdgeXY),'bottom-right':Optional.some(setToBREdgeXY),'bottom':Optional.some(setToBEdgeXY),'bottom-left':Optional.some(setToBLEdgeXY),'left':Optional.some(setToLEdgeXY)};var TwoDModel=/*#__PURE__*/Object.freeze({__proto__:null,setValueFrom:setValueFrom,setToMin:setToMin,setToMax:setToMax,getValueFromEvent:getValueFromEvent,setPositionFromValue:setPositionFromValue,onLeft:onLeft,onRight:onRight,onUp:onUp,onDown:onDown,edgeActions:edgeActions});var SliderSchema=[defaulted('stepSize',1),defaulted('onChange',noop),defaulted('onChoose',noop),defaulted('onInit',noop),defaulted('onDragStart',noop),defaulted('onDragEnd',noop),defaulted('snapToGrid',false),defaulted('rounded',true),option('snapStart'),requiredOf('model',choose$1('mode',{x:[defaulted('minX',0),defaulted('maxX',100),customField('value',function(spec){return Cell(spec.mode.minX);}),required$1('getInitialValue'),output$1('manager',HorizontalModel)],y:[defaulted('minY',0),defaulted('maxY',100),customField('value',function(spec){return Cell(spec.mode.minY);}),required$1('getInitialValue'),output$1('manager',VerticalModel)],xy:[defaulted('minX',0),defaulted('maxX',100),defaulted('minY',0),defaulted('maxY',100),customField('value',function(spec){return Cell({x:spec.mode.minX,y:spec.mode.minY});}),required$1('getInitialValue'),output$1('manager',TwoDModel)]})),field('sliderBehaviours',[Keying,Representing]),customField('mouseIsDown',function(){return Cell(false);})];var sketch$2=function sketch$2(detail,components,_spec,_externals){var _a;var getThumb=function getThumb(component){return getPartOrDie(component,detail,'thumb');};var getSpectrum=function getSpectrum(component){return getPartOrDie(component,detail,'spectrum');};var getLeftEdge=function getLeftEdge(component){return getPart(component,detail,'left-edge');};var getRightEdge=function getRightEdge(component){return getPart(component,detail,'right-edge');};var getTopEdge=function getTopEdge(component){return getPart(component,detail,'top-edge');};var getBottomEdge=function getBottomEdge(component){return getPart(component,detail,'bottom-edge');};var modelDetail=detail.model;var model=modelDetail.manager;var refresh=function refresh(slider,thumb){model.setPositionFromValue(slider,thumb,detail,{getLeftEdge:getLeftEdge,getRightEdge:getRightEdge,getTopEdge:getTopEdge,getBottomEdge:getBottomEdge,getSpectrum:getSpectrum});};var setValue=function setValue(slider,newValue){modelDetail.value.set(newValue);var thumb=getThumb(slider);refresh(slider,thumb);};var changeValue=function changeValue(slider,newValue){setValue(slider,newValue);var thumb=getThumb(slider);detail.onChange(slider,thumb,newValue);return Optional.some(true);};var resetToMin=function resetToMin(slider){model.setToMin(slider,detail);};var resetToMax=function resetToMax(slider){model.setToMax(slider,detail);};var choose=function choose(slider){var fireOnChoose=function fireOnChoose(){getPart(slider,detail,'thumb').each(function(thumb){var value=modelDetail.value.get();detail.onChoose(slider,thumb,value);});};var wasDown=detail.mouseIsDown.get();detail.mouseIsDown.set(false);if(wasDown){fireOnChoose();}};var onDragStart=function onDragStart(slider,simulatedEvent){simulatedEvent.stop();detail.mouseIsDown.set(true);detail.onDragStart(slider,getThumb(slider));};var onDragEnd=function onDragEnd(slider,simulatedEvent){simulatedEvent.stop();detail.onDragEnd(slider,getThumb(slider));choose(slider);};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.sliderBehaviours,[Keying.config({mode:'special',focusIn:function focusIn(slider){return getPart(slider,detail,'spectrum').map(Keying.focusIn).map(always);}}),Representing.config({store:{mode:'manual',getValue:function getValue(_){return modelDetail.value.get();}}}),Receiving.config({channels:(_a={},_a[mouseReleased()]={onReceive:choose},_a)})]),events:derive$2([run$1(sliderChangeEvent(),function(slider,simulatedEvent){changeValue(slider,simulatedEvent.event.value);}),runOnAttached(function(slider,_simulatedEvent){var getInitial=modelDetail.getInitialValue();modelDetail.value.set(getInitial);var thumb=getThumb(slider);refresh(slider,thumb);var spectrum=getSpectrum(slider);detail.onInit(slider,thumb,spectrum,modelDetail.value.get());}),run$1(touchstart(),onDragStart),run$1(touchend(),onDragEnd),run$1(mousedown(),onDragStart),run$1(mouseup(),onDragEnd)]),apis:{resetToMin:resetToMin,resetToMax:resetToMax,setValue:setValue,refresh:refresh},domModification:{styles:{position:'relative'}}};};var Slider=composite({name:'Slider',configFields:SliderSchema,partFields:SliderParts,factory:sketch$2,apis:{setValue:function setValue(apis,slider,value){apis.setValue(slider,value);},resetToMin:function resetToMin(apis,slider){apis.resetToMin(slider);},resetToMax:function resetToMax(apis,slider){apis.resetToMax(slider);},refresh:function refresh(apis,slider){apis.refresh(slider);}}});var fieldsUpdate=generate$6('rgb-hex-update');var sliderUpdate=generate$6('slider-update');var paletteUpdate=generate$6('palette-update');var sliderFactory=function sliderFactory(translate,getClass){var spectrum=Slider.parts.spectrum({dom:{tag:'div',classes:[getClass('hue-slider-spectrum')],attributes:{role:'presentation'}}});var thumb=Slider.parts.thumb({dom:{tag:'div',classes:[getClass('hue-slider-thumb')],attributes:{role:'presentation'}}});return Slider.sketch({dom:{tag:'div',classes:[getClass('hue-slider')],attributes:{role:'presentation'}},rounded:false,model:{mode:'y',getInitialValue:constant$1({y:0})},components:[spectrum,thumb],sliderBehaviours:derive$1([Focusing.config({})]),onChange:function onChange(slider,_thumb,value){emitWith(slider,sliderUpdate,{value:value});}});};var owner$1='form';var schema$i=[field('formBehaviours',[Representing])];var getPartName$1=function getPartName$1(name){return'<alloy.field.'+name+'>';};var sketch$1=function sketch$1(fSpec){var parts=function(){var record=[];var field=function field(name,config){record.push(name);return generateOne$1(owner$1,getPartName$1(name),config);};return{field:field,record:constant$1(record)};}();var spec=fSpec(parts);var partNames=parts.record();var fieldParts=map$2(partNames,function(n){return required({name:n,pname:getPartName$1(n)});});return composite$1(owner$1,schema$i,fieldParts,make$4,spec);};var toResult=function toResult(o,e){return o.fold(function(){return Result.error(e);},Result.value);};var make$4=function make$4(detail,components){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.formBehaviours,[Representing.config({store:{mode:'manual',getValue:function getValue(form){var resPs=getAllParts(form,detail);return map$1(resPs,function(resPThunk,pName){return resPThunk().bind(function(v){var opt=Composing.getCurrent(v);return toResult(opt,new Error('Cannot find a current component to extract the value from for form part \\''+pName+'\\': '+element(v.element)));}).map(Representing.getValue);});},setValue:function setValue(form,values){each(values,function(newValue,key){getPart(form,detail,key).each(function(wrapper){Composing.getCurrent(wrapper).each(function(field){Representing.setValue(field,newValue);});});});}}})]),apis:{getField:function getField(form,key){return getPart(form,detail,key).bind(Composing.getCurrent);}}};};var Form={getField:makeApi(function(apis,component,key){return apis.getField(component,key);}),sketch:sketch$1};var validInput=generate$6('valid-input');var invalidInput=generate$6('invalid-input');var validatingInput=generate$6('validating-input');var translatePrefix='colorcustom.rgb.';var rgbFormFactory=function rgbFormFactory(translate,getClass,onValidHexx,onInvalidHexx){var invalidation=function invalidation(label,isValid){return Invalidating.config({invalidClass:getClass('invalid'),notify:{onValidate:function onValidate(comp){emitWith(comp,validatingInput,{type:label});},onValid:function onValid(comp){emitWith(comp,validInput,{type:label,value:Representing.getValue(comp)});},onInvalid:function onInvalid(comp){emitWith(comp,invalidInput,{type:label,value:Representing.getValue(comp)});}},validator:{validate:function validate(comp){var value=Representing.getValue(comp);var res=isValid(value)?Result.value(true):Result.error(translate('aria.input.invalid'));return Future.pure(res);},validateOnLoad:false}});};var renderTextField=function renderTextField(isValid,name,label,description,data){var helptext=translate(translatePrefix+'range');var pLabel=FormField.parts.label({dom:{tag:'label',innerHtml:label,attributes:{'aria-label':description}}});var pField=FormField.parts.field({data:data,factory:Input,inputAttributes:_assign({type:'text'},name==='hex'?{'aria-live':'polite'}:{}),inputClasses:[getClass('textfield')],inputBehaviours:derive$1([invalidation(name,isValid),Tabstopping.config({})]),onSetValue:function onSetValue(input){if(Invalidating.isInvalid(input)){var run=Invalidating.run(input);run.get(noop);}}});var comps=[pLabel,pField];var concats=name!=='hex'?[FormField.parts['aria-descriptor']({text:helptext})]:[];var components=comps.concat(concats);return{dom:{tag:'div',attributes:{role:'presentation'}},components:components};};var copyRgbToHex=function copyRgbToHex(form,rgba){var hex=fromRgba(rgba);Form.getField(form,'hex').each(function(hexField){if(!Focusing.isFocused(hexField)){Representing.setValue(form,{hex:hex.value});}});return hex;};var copyRgbToForm=function copyRgbToForm(form,rgb){var red=rgb.red;var green=rgb.green;var blue=rgb.blue;Representing.setValue(form,{red:red,green:green,blue:blue});};var memPreview=record({dom:{tag:'div',classes:[getClass('rgba-preview')],styles:{'background-color':'white'},attributes:{role:'presentation'}}});var updatePreview=function updatePreview(anyInSystem,hex){memPreview.getOpt(anyInSystem).each(function(preview){set$7(preview.element,'background-color','#'+hex.value);});};var factory=function factory(){var state={red:Cell(Optional.some(255)),green:Cell(Optional.some(255)),blue:Cell(Optional.some(255)),hex:Cell(Optional.some('ffffff'))};var copyHexToRgb=function copyHexToRgb(form,hex){var rgb=fromHex(hex);copyRgbToForm(form,rgb);setValueRgb(rgb);};var get=function get(prop){return state[prop].get();};var set=function set(prop,value){state[prop].set(value);};var getValueRgb=function getValueRgb(){return get('red').bind(function(red){return get('green').bind(function(green){return get('blue').map(function(blue){return rgbaColour(red,green,blue,1);});});});};var setValueRgb=function setValueRgb(rgb){var red=rgb.red;var green=rgb.green;var blue=rgb.blue;set('red',Optional.some(red));set('green',Optional.some(green));set('blue',Optional.some(blue));};var onInvalidInput=function onInvalidInput(form,simulatedEvent){var data=simulatedEvent.event;if(data.type!=='hex'){set(data.type,Optional.none());}else{onInvalidHexx(form);}};var onValidHex=function onValidHex(form,value){onValidHexx(form);var hex=hexColour(value);set('hex',Optional.some(value));var rgb=fromHex(hex);copyRgbToForm(form,rgb);setValueRgb(rgb);emitWith(form,fieldsUpdate,{hex:hex});updatePreview(form,hex);};var onValidRgb=function onValidRgb(form,prop,value){var val=parseInt(value,10);set(prop,Optional.some(val));getValueRgb().each(function(rgb){var hex=copyRgbToHex(form,rgb);emitWith(form,fieldsUpdate,{hex:hex});updatePreview(form,hex);});};var isHexInputEvent=function isHexInputEvent(data){return data.type==='hex';};var onValidInput=function onValidInput(form,simulatedEvent){var data=simulatedEvent.event;if(isHexInputEvent(data)){onValidHex(form,data.value);}else{onValidRgb(form,data.type,data.value);}};var formPartStrings=function formPartStrings(key){return{label:translate(translatePrefix+key+'.label'),description:translate(translatePrefix+key+'.description')};};var redStrings=formPartStrings('red');var greenStrings=formPartStrings('green');var blueStrings=formPartStrings('blue');var hexStrings=formPartStrings('hex');return deepMerge(Form.sketch(function(parts){return{dom:{tag:'form',classes:[getClass('rgb-form')],attributes:{'aria-label':translate('aria.color.picker')}},components:[parts.field('red',FormField.sketch(renderTextField(isRgbaComponent,'red',redStrings.label,redStrings.description,255))),parts.field('green',FormField.sketch(renderTextField(isRgbaComponent,'green',greenStrings.label,greenStrings.description,255))),parts.field('blue',FormField.sketch(renderTextField(isRgbaComponent,'blue',blueStrings.label,blueStrings.description,255))),parts.field('hex',FormField.sketch(renderTextField(isHexString,'hex',hexStrings.label,hexStrings.description,'ffffff'))),memPreview.asSpec()],formBehaviours:derive$1([Invalidating.config({invalidClass:getClass('form-invalid')}),config('rgb-form-events',[run$1(validInput,onValidInput),run$1(invalidInput,onInvalidInput),run$1(validatingInput,onInvalidInput)])])};}),{apis:{updateHex:function updateHex(form,hex){Representing.setValue(form,{hex:hex.value});copyHexToRgb(form,hex);updatePreview(form,hex);}}});};var rgbFormSketcher=single({factory:factory,name:'RgbForm',configFields:[],apis:{updateHex:function updateHex(apis,form,hex){apis.updateHex(form,hex);}},extraApis:{}});return rgbFormSketcher;};var paletteFactory=function paletteFactory(_translate,getClass){var spectrumPart=Slider.parts.spectrum({dom:{tag:'canvas',attributes:{role:'presentation'},classes:[getClass('sv-palette-spectrum')]}});var thumbPart=Slider.parts.thumb({dom:{tag:'div',attributes:{role:'presentation'},classes:[getClass('sv-palette-thumb')],innerHtml:'<div class='+getClass('sv-palette-inner-thumb')+' role=\"presentation\"></div>'}});var setColour=function setColour(canvas,rgba){var width=canvas.width,height=canvas.height;var ctx=canvas.getContext('2d');if(ctx===null){return;}ctx.fillStyle=rgba;ctx.fillRect(0,0,width,height);var grdWhite=ctx.createLinearGradient(0,0,width,0);grdWhite.addColorStop(0,'rgba(255,255,255,1)');grdWhite.addColorStop(1,'rgba(255,255,255,0)');ctx.fillStyle=grdWhite;ctx.fillRect(0,0,width,height);var grdBlack=ctx.createLinearGradient(0,0,0,height);grdBlack.addColorStop(0,'rgba(0,0,0,0)');grdBlack.addColorStop(1,'rgba(0,0,0,1)');ctx.fillStyle=grdBlack;ctx.fillRect(0,0,width,height);};var setPaletteHue=function setPaletteHue(slider,hue){var canvas=slider.components()[0].element.dom;var hsv=hsvColour(hue,100,100);var rgba=fromHsv(hsv);setColour(canvas,toString(rgba));};var setPaletteThumb=function setPaletteThumb(slider,hex){var hsv=fromRgb(fromHex(hex));Slider.setValue(slider,{x:hsv.saturation,y:100-hsv.value});};var factory=function factory(_detail){var getInitialValue=constant$1({x:0,y:0});var onChange=function onChange(slider,_thumb,value){emitWith(slider,paletteUpdate,{value:value});};var onInit=function onInit(_slider,_thumb,spectrum,_value){setColour(spectrum.element.dom,toString(red));};var sliderBehaviours=derive$1([Composing.config({find:Optional.some}),Focusing.config({})]);return Slider.sketch({dom:{tag:'div',attributes:{role:'presentation'},classes:[getClass('sv-palette')]},model:{mode:'xy',getInitialValue:getInitialValue},rounded:false,components:[spectrumPart,thumbPart],onChange:onChange,onInit:onInit,sliderBehaviours:sliderBehaviours});};var saturationBrightnessPaletteSketcher=single({factory:factory,name:'SaturationBrightnessPalette',configFields:[],apis:{setHue:function setHue(_apis,slider,hue){setPaletteHue(slider,hue);},setThumb:function setThumb(_apis,slider,hex){setPaletteThumb(slider,hex);}},extraApis:{}});return saturationBrightnessPaletteSketcher;};var makeFactory=function makeFactory(translate,getClass){var factory=function factory(detail){var rgbForm=rgbFormFactory(translate,getClass,detail.onValidHex,detail.onInvalidHex);var sbPalette=paletteFactory(translate,getClass);var hueSliderToDegrees=function hueSliderToDegrees(hue){return(100-hue)/100*360;};var hueDegreesToSlider=function hueDegreesToSlider(hue){return 100-hue/360*100;};var state={paletteRgba:Cell(red),paletteHue:Cell(0)};var memSlider=record(sliderFactory(translate,getClass));var memPalette=record(sbPalette.sketch({}));var memRgb=record(rgbForm.sketch({}));var updatePalette=function updatePalette(anyInSystem,_hex,hue){memPalette.getOpt(anyInSystem).each(function(palette){sbPalette.setHue(palette,hue);});};var updateFields=function updateFields(anyInSystem,hex){memRgb.getOpt(anyInSystem).each(function(form){rgbForm.updateHex(form,hex);});};var updateSlider=function updateSlider(anyInSystem,_hex,hue){memSlider.getOpt(anyInSystem).each(function(slider){Slider.setValue(slider,{y:hueDegreesToSlider(hue)});});};var updatePaletteThumb=function updatePaletteThumb(anyInSystem,hex){memPalette.getOpt(anyInSystem).each(function(palette){sbPalette.setThumb(palette,hex);});};var updateState=function updateState(hex,hue){var rgba=fromHex(hex);state.paletteRgba.set(rgba);state.paletteHue.set(hue);};var runUpdates=function runUpdates(anyInSystem,hex,hue,updates){updateState(hex,hue);each$1(updates,function(update){update(anyInSystem,hex,hue);});};var onPaletteUpdate=function onPaletteUpdate(){var updates=[updateFields];return function(form,simulatedEvent){var value=simulatedEvent.event.value;var oldHue=state.paletteHue.get();var newHsv=hsvColour(oldHue,value.x,100-value.y);var newHex=hsvToHex(newHsv);runUpdates(form,newHex,oldHue,updates);};};var onSliderUpdate=function onSliderUpdate(){var updates=[updatePalette,updateFields];return function(form,simulatedEvent){var hue=hueSliderToDegrees(simulatedEvent.event.value.y);var oldRgb=state.paletteRgba.get();var oldHsv=fromRgb(oldRgb);var newHsv=hsvColour(hue,oldHsv.saturation,oldHsv.value);var newHex=hsvToHex(newHsv);runUpdates(form,newHex,hue,updates);};};var onFieldsUpdate=function onFieldsUpdate(){var updates=[updatePalette,updateSlider,updatePaletteThumb];return function(form,simulatedEvent){var hex=simulatedEvent.event.hex;var hsv=hexToHsv(hex);runUpdates(form,hex,hsv.hue,updates);};};return{uid:detail.uid,dom:detail.dom,components:[memPalette.asSpec(),memSlider.asSpec(),memRgb.asSpec()],behaviours:derive$1([config('colour-picker-events',[run$1(fieldsUpdate,onFieldsUpdate()),run$1(paletteUpdate,onPaletteUpdate()),run$1(sliderUpdate,onSliderUpdate())]),Composing.config({find:function find(comp){return memRgb.getOpt(comp);}}),Keying.config({mode:'acyclic'})])};};var colourPickerSketcher=single({name:'ColourPicker',configFields:[required$1('dom'),defaulted('onValidHex',noop),defaulted('onInvalidHex',noop)],factory:factory});return colourPickerSketcher;};var self$1=function self$1(){return Composing.config({find:Optional.some});};var memento$1=function memento$1(mem){return Composing.config({find:mem.getOpt});};var childAt=function childAt(index){return Composing.config({find:function find(comp){return child$2(comp.element,index).bind(function(element){return comp.getSystem().getByDom(element).toOptional();});}});};var ComposingConfigs={self:self$1,memento:memento$1,childAt:childAt};var english={'colorcustom.rgb.red.label':'R','colorcustom.rgb.red.description':'Red component','colorcustom.rgb.green.label':'G','colorcustom.rgb.green.description':'Green component','colorcustom.rgb.blue.label':'B','colorcustom.rgb.blue.description':'Blue component','colorcustom.rgb.hex.label':'#','colorcustom.rgb.hex.description':'Hex color code','colorcustom.rgb.range':'Range 0 to 255','colorcustom.sb.saturation':'Saturation','colorcustom.sb.brightness':'Brightness','colorcustom.sb.picker':'Saturation and Brightness Picker','colorcustom.sb.palette':'Saturation and Brightness Palette','colorcustom.sb.instructions':'Use arrow keys to select saturation and brightness, on x and y axes','colorcustom.hue.hue':'Hue','colorcustom.hue.slider':'Hue Slider','colorcustom.hue.palette':'Hue Palette','colorcustom.hue.instructions':'Use arrow keys to select a hue','aria.color.picker':'Color Picker','aria.input.invalid':'Invalid input'};var getEnglishText=function getEnglishText(key){return english[key];};var translate$1=function translate$1(key){return getEnglishText(key);};var renderColorPicker=function renderColorPicker(_spec){var getClass=function getClass(key){return'tox-'+key;};var colourPickerFactory=makeFactory(translate$1,getClass);var onValidHex=function onValidHex(form){emitWith(form,formActionEvent,{name:'hex-valid',value:true});};var onInvalidHex=function onInvalidHex(form){emitWith(form,formActionEvent,{name:'hex-valid',value:false});};var memPicker=record(colourPickerFactory.sketch({dom:{tag:'div',classes:[getClass('color-picker-container')],attributes:{role:'presentation'}},onValidHex:onValidHex,onInvalidHex:onInvalidHex}));return{dom:{tag:'div'},components:[memPicker.asSpec()],behaviours:derive$1([Representing.config({store:{mode:'manual',getValue:function getValue(comp){var picker=memPicker.get(comp);var optRgbForm=Composing.getCurrent(picker);var optHex=optRgbForm.bind(function(rgbForm){var formValues=Representing.getValue(rgbForm);return formValues.hex;});return optHex.map(function(hex){return'#'+hex;}).getOr('');},setValue:function setValue(comp,newValue){var pattern=/^#([a-fA-F0-9]{3}(?:[a-fA-F0-9]{3})?)/;var m=pattern.exec(newValue);var picker=memPicker.get(comp);var optRgbForm=Composing.getCurrent(picker);optRgbForm.fold(function(){console.log('Can not find form');},function(rgbForm){Representing.setValue(rgbForm,{hex:Optional.from(m[1]).getOr('')});Form.getField(rgbForm,'hex').each(function(hexField){emit(hexField,input());});});}}}),ComposingConfigs.self()])};};var global$6=tinymce.util.Tools.resolve('tinymce.Resource');var isOldCustomEditor=function isOldCustomEditor(spec){return has$2(spec,'init');};var renderCustomEditor=function renderCustomEditor(spec){var editorApi=value$1();var memReplaced=record({dom:{tag:spec.tag}});var initialValue=value$1();return{dom:{tag:'div',classes:['tox-custom-editor']},behaviours:derive$1([config('custom-editor-events',[runOnAttached(function(component){memReplaced.getOpt(component).each(function(ta){(isOldCustomEditor(spec)?spec.init(ta.element.dom):global$6.load(spec.scriptId,spec.scriptUrl).then(function(init){return init(ta.element.dom,spec.settings);})).then(function(ea){initialValue.on(function(cvalue){ea.setValue(cvalue);});initialValue.clear();editorApi.set(ea);});});})]),Representing.config({store:{mode:'manual',getValue:function getValue(){return editorApi.get().fold(function(){return initialValue.get().getOr('');},function(ed){return ed.getValue();});},setValue:function setValue(component,value){editorApi.get().fold(function(){initialValue.set(value);},function(ed){return ed.setValue(value);});}}}),ComposingConfigs.self()]),components:[memReplaced.asSpec()]};};var global$5=tinymce.util.Tools.resolve('tinymce.util.Tools');var processors=objOf([defaulted('preprocess',identity$1),defaulted('postprocess',identity$1)]);var memento=function memento(mem,rawProcessors){var ps=asRawOrDie$1('RepresentingConfigs.memento processors',processors,rawProcessors);return Representing.config({store:{mode:'manual',getValue:function getValue(comp){var other=mem.get(comp);var rawValue=Representing.getValue(other);return ps.postprocess(rawValue);},setValue:function setValue(comp,rawValue){var newValue=ps.preprocess(rawValue);var other=mem.get(comp);Representing.setValue(other,newValue);}}});};var withComp=function withComp(optInitialValue,getter,setter){return Representing.config(deepMerge({store:{mode:'manual',getValue:getter,setValue:setter}},optInitialValue.map(function(initialValue){return{store:{initialValue:initialValue}};}).getOr({})));};var withElement=function withElement(initialValue,getter,setter){return withComp(initialValue,function(c){return getter(c.element);},function(c,v){return setter(c.element,v);});};var domValue=function domValue(optInitialValue){return withElement(optInitialValue,get$5,set$4);};var domHtml=function domHtml(optInitialValue){return withElement(optInitialValue,get$7,set$5);};var memory=function memory(initialValue){return Representing.config({store:{mode:'memory',initialValue:initialValue}});};var RepresentingConfigs={memento:memento,withElement:withElement,withComp:withComp,domValue:domValue,domHtml:domHtml,memory:memory};var defaultImageFileTypes='jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp';var filterByExtension=function filterByExtension(files,providersBackstage){var allowedImageFileTypes=global$5.explode(providersBackstage.getSetting('images_file_types',defaultImageFileTypes,'string'));var isFileInAllowedTypes=function isFileInAllowedTypes(file){return exists(allowedImageFileTypes,function(type){return endsWith(file.name.toLowerCase(),'.'+type.toLowerCase());});};return filter$2(from(files),isFileInAllowedTypes);};var renderDropZone=function renderDropZone(spec,providersBackstage){var stopper=function stopper(_,se){se.stop();};var sequence=function sequence(actions){return function(comp,se){each$1(actions,function(a){a(comp,se);});};};var onDrop=function onDrop(comp,se){if(!Disabling.isDisabled(comp)){var transferEvent=se.event.raw;handleFiles(comp,transferEvent.dataTransfer.files);}};var onSelect=function onSelect(component,simulatedEvent){var input=simulatedEvent.event.raw.target;handleFiles(component,input.files);};var handleFiles=function handleFiles(component,files){Representing.setValue(component,filterByExtension(files,providersBackstage));emitWith(component,formChangeEvent,{name:spec.name});};var memInput=record({dom:{tag:'input',attributes:{type:'file',accept:'image/*'},styles:{display:'none'}},behaviours:derive$1([config('input-file-events',[cutter(click()),cutter(tap())])])});var renderField=function renderField(s){return{uid:s.uid,dom:{tag:'div',classes:['tox-dropzone-container']},behaviours:derive$1([RepresentingConfigs.memory([]),ComposingConfigs.self(),Disabling.config({}),Toggling.config({toggleClass:'dragenter',toggleOnExecute:false}),config('dropzone-events',[run$1('dragenter',sequence([stopper,Toggling.toggle])),run$1('dragleave',sequence([stopper,Toggling.toggle])),run$1('dragover',stopper),run$1('drop',sequence([stopper,onDrop])),run$1(change(),onSelect)])]),components:[{dom:{tag:'div',classes:['tox-dropzone'],styles:{}},components:[{dom:{tag:'p',innerHtml:providersBackstage.translate('Drop an image here')}},Button.sketch({dom:{tag:'button',innerHtml:providersBackstage.translate('Browse for an image'),styles:{position:'relative'},classes:['tox-button','tox-button--secondary']},components:[memInput.asSpec()],action:function action(comp){var inputComp=memInput.get(comp);inputComp.element.dom.click();},buttonBehaviours:derive$1([Tabstopping.config({}),DisablingConfigs.button(providersBackstage.isDisabled),receivingConfig()])})]}]};};var pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage);});var pField=FormField.parts.field({factory:{sketch:renderField}});return renderFormFieldWith(pLabel,pField,['tox-form__group--stretched'],[]);};var renderGrid=function renderGrid(spec,backstage){return{dom:{tag:'div',classes:['tox-form__grid','tox-form__grid--'+spec.columns+'col']},components:map$2(spec.items,backstage.interpreter)};};var beforeObject=generate$6('alloy-fake-before-tabstop');var afterObject=generate$6('alloy-fake-after-tabstop');var craftWithClasses=function craftWithClasses(classes){return{dom:{tag:'div',styles:{width:'1px',height:'1px',outline:'none'},attributes:{tabindex:'0'},classes:classes},behaviours:derive$1([Focusing.config({ignore:true}),Tabstopping.config({})])};};var craft=function craft(spec){return{dom:{tag:'div',classes:['tox-navobj']},components:[craftWithClasses([beforeObject]),spec,craftWithClasses([afterObject])],behaviours:derive$1([ComposingConfigs.childAt(1)])};};var triggerTab=function triggerTab(placeholder,shiftKey){emitWith(placeholder,keydown(),{raw:{which:9,shiftKey:shiftKey}});};var onFocus=function onFocus(container,targetComp){var target=targetComp.element;if(has(target,beforeObject)){triggerTab(container,true);}else if(has(target,afterObject)){triggerTab(container,false);}};var isPseudoStop=function isPseudoStop(element){return closest(element,['.'+beforeObject,'.'+afterObject].join(','),never);};var platformNeedsSandboxing=!(detect$1().browser.isIE()||detect$1().browser.isEdge());var getDynamicSource=function getDynamicSource(isSandbox){var cachedValue=Cell('');return{getValue:function getValue(_frameComponent){return cachedValue.get();},setValue:function setValue(frameComponent,html){if(!isSandbox){set$8(frameComponent.element,'src','javascript:\\'\\'');var doc=frameComponent.element.dom.contentWindow.document;doc.open();doc.write(html);doc.close();}else{set$8(frameComponent.element,'srcdoc',html);}cachedValue.set(html);}};};var renderIFrame=function renderIFrame(spec,providersBackstage){var isSandbox=platformNeedsSandboxing&&spec.sandboxed;var attributes=_assign(_assign({},spec.label.map(function(title){return{title:title};}).getOr({})),isSandbox?{sandbox:'allow-scripts allow-same-origin'}:{});var sourcing=getDynamicSource(isSandbox);var pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage);});var factory=function factory(newSpec){return craft({uid:newSpec.uid,dom:{tag:'iframe',attributes:attributes},behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),RepresentingConfigs.withComp(Optional.none(),sourcing.getValue,sourcing.setValue)])});};var pField=FormField.parts.field({factory:{sketch:factory}});return renderFormFieldWith(pLabel,pField,['tox-form__group--stretched'],[]);};var create$3=function create$3(width,height){return resize$3(document.createElement('canvas'),width,height);};var clone=function clone(canvas){var tCanvas=create$3(canvas.width,canvas.height);var ctx=get2dContext(tCanvas);ctx.drawImage(canvas,0,0);return tCanvas;};var get2dContext=function get2dContext(canvas){return canvas.getContext('2d');};var resize$3=function resize$3(canvas,width,height){canvas.width=width;canvas.height=height;return canvas;};var getWidth$1=function getWidth$1(image){return image.naturalWidth||image.width;};var getHeight$1=function getHeight$1(image){return image.naturalHeight||image.height;};var blobToImage=function blobToImage(blob){return new Promise$1(function(resolve,reject){var blobUrl=URL.createObjectURL(blob);var image=new Image();var removeListeners=function removeListeners(){image.removeEventListener('load',loaded);image.removeEventListener('error',error);};var loaded=function loaded(){removeListeners();resolve(image);};var error=function error(){removeListeners();reject('Unable to load data of type '+blob.type+': '+blobUrl);};image.addEventListener('load',loaded);image.addEventListener('error',error);image.src=blobUrl;if(image.complete){setTimeout(loaded,0);}});};var dataUriToBlobSync=function dataUriToBlobSync(uri){var data=uri.split(',');var matches=/data:([^;]+)/.exec(data[0]);if(!matches){return Optional.none();}var mimetype=matches[1];var base64=data[1];var sliceSize=1024;var byteCharacters=atob(base64);var bytesLength=byteCharacters.length;var slicesCount=Math.ceil(bytesLength/sliceSize);var byteArrays=new Array(slicesCount);for(var sliceIndex=0;sliceIndex<slicesCount;++sliceIndex){var begin=sliceIndex*sliceSize;var end=Math.min(begin+sliceSize,bytesLength);var bytes=new Array(end-begin);for(var offset=begin,i=0;offset<end;++i,++offset){bytes[i]=byteCharacters[offset].charCodeAt(0);}byteArrays[sliceIndex]=new Uint8Array(bytes);}return Optional.some(new Blob(byteArrays,{type:mimetype}));};var dataUriToBlob=function dataUriToBlob(uri){return new Promise$1(function(resolve,reject){dataUriToBlobSync(uri).fold(function(){reject('uri is not base64: '+uri);},resolve);});};var canvasToBlob=function canvasToBlob(canvas,type,quality){type=type||'image/png';if(isFunction(HTMLCanvasElement.prototype.toBlob)){return new Promise$1(function(resolve,reject){canvas.toBlob(function(blob){if(blob){resolve(blob);}else{reject();}},type,quality);});}else{return dataUriToBlob(canvas.toDataURL(type,quality));}};var canvasToDataURL=function canvasToDataURL(canvas,type,quality){type=type||'image/png';return canvas.toDataURL(type,quality);};var blobToCanvas=function blobToCanvas(blob){return blobToImage(blob).then(function(image){revokeImageUrl(image);var canvas=create$3(getWidth$1(image),getHeight$1(image));var context=get2dContext(canvas);context.drawImage(image,0,0);return canvas;});};var blobToDataUri=function blobToDataUri(blob){return new Promise$1(function(resolve){var reader=new FileReader();reader.onloadend=function(){resolve(reader.result);};reader.readAsDataURL(blob);});};var revokeImageUrl=function revokeImageUrl(image){URL.revokeObjectURL(image.src);};var create$2=function create$2(getCanvas,blob,uri){var initialType=blob.type;var getType=constant$1(initialType);var toBlob=function toBlob(){return Promise$1.resolve(blob);};var toDataURL=constant$1(uri);var toBase64=function toBase64(){return uri.split(',')[1];};var toAdjustedBlob=function toAdjustedBlob(type,quality){return getCanvas.then(function(canvas){return canvasToBlob(canvas,type,quality);});};var toAdjustedDataURL=function toAdjustedDataURL(type,quality){return getCanvas.then(function(canvas){return canvasToDataURL(canvas,type,quality);});};var toAdjustedBase64=function toAdjustedBase64(type,quality){return toAdjustedDataURL(type,quality).then(function(dataurl){return dataurl.split(',')[1];});};var toCanvas=function toCanvas(){return getCanvas.then(clone);};return{getType:getType,toBlob:toBlob,toDataURL:toDataURL,toBase64:toBase64,toAdjustedBlob:toAdjustedBlob,toAdjustedDataURL:toAdjustedDataURL,toAdjustedBase64:toAdjustedBase64,toCanvas:toCanvas};};var fromBlob=function fromBlob(blob){return blobToDataUri(blob).then(function(uri){return create$2(blobToCanvas(blob),blob,uri);});};var fromCanvas=function fromCanvas(canvas,type){return canvasToBlob(canvas,type).then(function(blob){return create$2(Promise$1.resolve(canvas),blob,canvas.toDataURL());});};var blobToImageResult=function blobToImageResult(blob){return fromBlob(blob);};var clamp=function clamp(value,min,max){var parsedValue=typeof value==='string'?parseFloat(value):value;if(parsedValue>max){parsedValue=max;}else if(parsedValue<min){parsedValue=min;}return parsedValue;};var identity=function identity(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1];};var DELTA_INDEX=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];var multiply=function multiply(matrix1,matrix2){var col=[];var out=new Array(25);var val;for(var i=0;i<5;i++){for(var j=0;j<5;j++){col[j]=matrix2[j+i*5];}for(var j=0;j<5;j++){val=0;for(var k=0;k<5;k++){val+=matrix1[j+k*5]*col[k];}out[j+i*5]=val;}}return out;};var adjustContrast=function adjustContrast(matrix,value){var x;value=clamp(value,-1,1);value*=100;if(value<0){x=127+value/100*127;}else{x=value%1;if(x===0){x=DELTA_INDEX[value];}else{x=DELTA_INDEX[Math.floor(value)]*(1-x)+DELTA_INDEX[Math.floor(value)+1]*x;}x=x*127+127;}return multiply(matrix,[x/127,0,0,0,0.5*(127-x),0,x/127,0,0,0.5*(127-x),0,0,x/127,0,0.5*(127-x),0,0,0,1,0,0,0,0,0,1]);};var adjustBrightness=function adjustBrightness(matrix,value){value=clamp(255*value,-255,255);return multiply(matrix,[1,0,0,0,value,0,1,0,0,value,0,0,1,0,value,0,0,0,1,0,0,0,0,0,1]);};var adjustColors=function adjustColors(matrix,adjustR,adjustG,adjustB){adjustR=clamp(adjustR,0,2);adjustG=clamp(adjustG,0,2);adjustB=clamp(adjustB,0,2);return multiply(matrix,[adjustR,0,0,0,0,0,adjustG,0,0,0,0,0,adjustB,0,0,0,0,0,1,0,0,0,0,0,1]);};var colorFilter=function colorFilter(ir,matrix){return ir.toCanvas().then(function(canvas){return applyColorFilter(canvas,ir.getType(),matrix);});};var applyColorFilter=function applyColorFilter(canvas,type,matrix){var context=get2dContext(canvas);var applyMatrix=function applyMatrix(pixelsData,m){var r,g,b,a;var data=pixelsData.data,m0=m[0],m1=m[1],m2=m[2],m3=m[3],m4=m[4],m5=m[5],m6=m[6],m7=m[7],m8=m[8],m9=m[9],m10=m[10],m11=m[11],m12=m[12],m13=m[13],m14=m[14],m15=m[15],m16=m[16],m17=m[17],m18=m[18],m19=m[19];for(var i=0;i<data.length;i+=4){r=data[i];g=data[i+1];b=data[i+2];a=data[i+3];data[i]=r*m0+g*m1+b*m2+a*m3+m4;data[i+1]=r*m5+g*m6+b*m7+a*m8+m9;data[i+2]=r*m10+g*m11+b*m12+a*m13+m14;data[i+3]=r*m15+g*m16+b*m17+a*m18+m19;}return pixelsData;};var pixels=applyMatrix(context.getImageData(0,0,canvas.width,canvas.height),matrix);context.putImageData(pixels,0,0);return fromCanvas(canvas,type);};var convoluteFilter=function convoluteFilter(ir,matrix){return ir.toCanvas().then(function(canvas){return applyConvoluteFilter(canvas,ir.getType(),matrix);});};var applyConvoluteFilter=function applyConvoluteFilter(canvas,type,matrix){var context=get2dContext(canvas);var applyMatrix=function applyMatrix(pIn,pOut,aMatrix){var clamp=function clamp(value,min,max){if(value>max){value=max;}else if(value<min){value=min;}return value;};var side=Math.round(Math.sqrt(aMatrix.length));var halfSide=Math.floor(side/2);var rgba=pIn.data;var drgba=pOut.data;var w=pIn.width;var h=pIn.height;for(var y=0;y<h;y++){for(var x=0;x<w;x++){var r=0;var g=0;var b=0;for(var cy=0;cy<side;cy++){for(var cx=0;cx<side;cx++){var scx=clamp(x+cx-halfSide,0,w-1);var scy=clamp(y+cy-halfSide,0,h-1);var innerOffset=(scy*w+scx)*4;var wt=aMatrix[cy*side+cx];r+=rgba[innerOffset]*wt;g+=rgba[innerOffset+1]*wt;b+=rgba[innerOffset+2]*wt;}}var offset=(y*w+x)*4;drgba[offset]=clamp(r,0,255);drgba[offset+1]=clamp(g,0,255);drgba[offset+2]=clamp(b,0,255);}}return pOut;};var pixelsIn=context.getImageData(0,0,canvas.width,canvas.height);var pixelsOut=context.getImageData(0,0,canvas.width,canvas.height);pixelsOut=applyMatrix(pixelsIn,pixelsOut,matrix);context.putImageData(pixelsOut,0,0);return fromCanvas(canvas,type);};var functionColorFilter=function functionColorFilter(colorFn){var filterImpl=function filterImpl(canvas,type,value){var context=get2dContext(canvas);var lookup=new Array(256);var applyLookup=function applyLookup(pixelsData,lookupData){var data=pixelsData.data;for(var i=0;i<data.length;i+=4){data[i]=lookupData[data[i]];data[i+1]=lookupData[data[i+1]];data[i+2]=lookupData[data[i+2]];}return pixelsData;};for(var i=0;i<lookup.length;i++){lookup[i]=colorFn(i,value);}var pixels=applyLookup(context.getImageData(0,0,canvas.width,canvas.height),lookup);context.putImageData(pixels,0,0);return fromCanvas(canvas,type);};return function(ir,value){return ir.toCanvas().then(function(canvas){return filterImpl(canvas,ir.getType(),value);});};};var complexAdjustableColorFilter=function complexAdjustableColorFilter(matrixAdjustFn){return function(ir,adjust){return colorFilter(ir,matrixAdjustFn(identity(),adjust));};};var basicColorFilter=function basicColorFilter(matrix){return function(ir){return colorFilter(ir,matrix);};};var basicConvolutionFilter=function basicConvolutionFilter(kernel){return function(ir){return convoluteFilter(ir,kernel);};};var invert$1=basicColorFilter([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0,0,0,0,0,1]);var brightness$1=complexAdjustableColorFilter(adjustBrightness);var contrast$1=complexAdjustableColorFilter(adjustContrast);var colorize$1=function colorize$1(ir,adjustR,adjustG,adjustB){return colorFilter(ir,adjustColors(identity(),adjustR,adjustG,adjustB));};var sharpen$1=basicConvolutionFilter([0,-1,0,-1,5,-1,0,-1,0]);var gamma$1=functionColorFilter(function(color,value){return Math.pow(color/255,1-value)*255;});var _scale2=function scale(image,dW,dH){var sW=getWidth$1(image);var sH=getHeight$1(image);var wRatio=dW/sW;var hRatio=dH/sH;var scaleCapped=false;if(wRatio<0.5||wRatio>2){wRatio=wRatio<0.5?0.5:2;scaleCapped=true;}if(hRatio<0.5||hRatio>2){hRatio=hRatio<0.5?0.5:2;scaleCapped=true;}var scaled=_scale(image,wRatio,hRatio);return!scaleCapped?scaled:scaled.then(function(tCanvas){return _scale2(tCanvas,dW,dH);});};var _scale=function _scale(image,wRatio,hRatio){return new Promise$1(function(resolve){var sW=getWidth$1(image);var sH=getHeight$1(image);var dW=Math.floor(sW*wRatio);var dH=Math.floor(sH*hRatio);var canvas=create$3(dW,dH);var context=get2dContext(canvas);context.drawImage(image,0,0,sW,sH,0,0,dW,dH);resolve(canvas);});};var ceilWithPrecision=function ceilWithPrecision(num,precision){if(precision===void 0){precision=2;}var mul=Math.pow(10,precision);var upper=Math.round(num*mul);return Math.ceil(upper/mul);};var rotate$1=function rotate$1(ir,angle){return ir.toCanvas().then(function(canvas){return applyRotate(canvas,ir.getType(),angle);});};var applyRotate=function applyRotate(image,type,angle){var degrees=angle<0?360+angle:angle;var rad=degrees*Math.PI/180;var width=image.width;var height=image.height;var sin=Math.sin(rad);var cos=Math.cos(rad);var newWidth=ceilWithPrecision(Math.abs(width*cos)+Math.abs(height*sin));var newHeight=ceilWithPrecision(Math.abs(width*sin)+Math.abs(height*cos));var canvas=create$3(newWidth,newHeight);var context=get2dContext(canvas);context.translate(newWidth/2,newHeight/2);context.rotate(rad);context.drawImage(image,-width/2,-height/2);return fromCanvas(canvas,type);};var flip$1=function flip$1(ir,axis){return ir.toCanvas().then(function(canvas){return applyFlip(canvas,ir.getType(),axis);});};var applyFlip=function applyFlip(image,type,axis){var canvas=create$3(image.width,image.height);var context=get2dContext(canvas);if(axis==='v'){context.scale(1,-1);context.drawImage(image,0,-canvas.height);}else{context.scale(-1,1);context.drawImage(image,-canvas.width,0);}return fromCanvas(canvas,type);};var crop$1=function crop$1(ir,x,y,w,h){return ir.toCanvas().then(function(canvas){return applyCrop(canvas,ir.getType(),x,y,w,h);});};var applyCrop=function applyCrop(image,type,x,y,w,h){var canvas=create$3(w,h);var context=get2dContext(canvas);context.drawImage(image,-x,-y);return fromCanvas(canvas,type);};var resize$2=function resize$2(ir,w,h){return ir.toCanvas().then(function(canvas){return _scale2(canvas,w,h).then(function(newCanvas){return fromCanvas(newCanvas,ir.getType());});});};var invert=function invert(ir){return invert$1(ir);};var sharpen=function sharpen(ir){return sharpen$1(ir);};var gamma=function gamma(ir,value){return gamma$1(ir,value);};var colorize=function colorize(ir,adjustR,adjustG,adjustB){return colorize$1(ir,adjustR,adjustG,adjustB);};var brightness=function brightness(ir,adjust){return brightness$1(ir,adjust);};var contrast=function contrast(ir,adjust){return contrast$1(ir,adjust);};var flip=function flip(ir,axis){return flip$1(ir,axis);};var crop=function crop(ir,x,y,w,h){return crop$1(ir,x,y,w,h);};var resize$1=function resize$1(ir,w,h){return resize$2(ir,w,h);};var rotate=function rotate(ir,angle){return rotate$1(ir,angle);};var renderIcon=function renderIcon(iconName,iconsProvider,behaviours){return render$3(iconName,{tag:'span',classes:['tox-icon','tox-tbtn__icon-wrap'],behaviours:behaviours},iconsProvider);};var renderIconFromPack=function renderIconFromPack(iconName,iconsProvider){return renderIcon(iconName,iconsProvider,[]);};var renderReplacableIconFromPack=function renderReplacableIconFromPack(iconName,iconsProvider){return renderIcon(iconName,iconsProvider,[Replacing.config({})]);};var renderLabel$1=function renderLabel$1(text,prefix,providersBackstage){return{dom:{tag:'span',innerHtml:providersBackstage.translate(text),classes:[prefix+'__select-label']},behaviours:derive$1([Replacing.config({})])};};var _a;var internalToolbarButtonExecute=generate$6('toolbar.button.execute');var onToolbarButtonExecute=function onToolbarButtonExecute(info){return runOnExecute$1(function(comp,_simulatedEvent){runWithApi(info,comp)(function(itemApi){emitWith(comp,internalToolbarButtonExecute,{buttonApi:itemApi});info.onAction(itemApi);});});};var toolbarButtonEventOrder=(_a={},_a[execute$5()]=['disabling','alloy.base.behaviour','toggling','toolbar-button-events'],_a);var updateMenuText=generate$6('update-menu-text');var updateMenuIcon=generate$6('update-menu-icon');var renderCommonDropdown=function renderCommonDropdown(spec,prefix,sharedBackstage){var editorOffCell=Cell(noop);var optMemDisplayText=spec.text.map(function(text){return record(renderLabel$1(text,prefix,sharedBackstage.providers));});var optMemDisplayIcon=spec.icon.map(function(iconName){return record(renderReplacableIconFromPack(iconName,sharedBackstage.providers.icons));});var onLeftOrRightInMenu=function onLeftOrRightInMenu(comp,se){var dropdown=Representing.getValue(comp);Focusing.focus(dropdown);emitWith(dropdown,'keydown',{raw:se.event.raw});Dropdown.close(dropdown);return Optional.some(true);};var role=spec.role.fold(function(){return{};},function(role){return{role:role};});var tooltipAttributes=spec.tooltip.fold(function(){return{};},function(tooltip){var translatedTooltip=sharedBackstage.providers.translate(tooltip);return{'title':translatedTooltip,'aria-label':translatedTooltip};});var iconSpec=render$3('chevron-down',{tag:'div',classes:[prefix+'__select-chevron']},sharedBackstage.providers.icons);var memDropdown=record(Dropdown.sketch(_assign(_assign(_assign({},spec.uid?{uid:spec.uid}:{}),role),{dom:{tag:'button',classes:[prefix,prefix+'--select'].concat(map$2(spec.classes,function(c){return prefix+'--'+c;})),attributes:_assign({},tooltipAttributes)},components:componentRenderPipeline([optMemDisplayIcon.map(function(mem){return mem.asSpec();}),optMemDisplayText.map(function(mem){return mem.asSpec();}),Optional.some(iconSpec)]),matchWidth:true,useMinWidth:true,dropdownBehaviours:derive$1(__spreadArray(__spreadArray([],spec.dropdownBehaviours,true),[DisablingConfigs.button(function(){return spec.disabled||sharedBackstage.providers.isDisabled();}),receivingConfig(),Unselecting.config({}),Replacing.config({}),config('dropdown-events',[onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),config('menubutton-update-display-text',[run$1(updateMenuText,function(comp,se){optMemDisplayText.bind(function(mem){return mem.getOpt(comp);}).each(function(displayText){Replacing.set(displayText,[text$1(sharedBackstage.providers.translate(se.event.text))]);});}),run$1(updateMenuIcon,function(comp,se){optMemDisplayIcon.bind(function(mem){return mem.getOpt(comp);}).each(function(displayIcon){Replacing.set(displayIcon,[renderReplacableIconFromPack(se.event.icon,sharedBackstage.providers.icons)]);});})])],false)),eventOrder:deepMerge(toolbarButtonEventOrder,{mousedown:['focusing','alloy.base.behaviour','item-type-events','normal-dropdown-events']}),sandboxBehaviours:derive$1([Keying.config({mode:'special',onLeft:onLeftOrRightInMenu,onRight:onLeftOrRightInMenu})]),lazySink:sharedBackstage.getSink,toggleClass:prefix+'--active',parts:{menu:part(false,spec.columns,spec.presets)},fetch:function fetch(comp){return Future.nu(curry(spec.fetch,comp));}})));return memDropdown.asSpec();};var isMenuItemReference=function isMenuItemReference(item){return isString(item);};var isSeparator$1=function isSeparator$1(item){return item.type==='separator';};var isExpandingMenuItem=function isExpandingMenuItem(item){return has$2(item,'getSubmenuItems');};var separator$2={type:'separator'};var unwrapReferences=function unwrapReferences(items,menuItems){var realItems=foldl(items,function(acc,item){if(isMenuItemReference(item)){if(item===''){return acc;}else if(item==='|'){return acc.length>0&&!isSeparator$1(acc[acc.length-1])?acc.concat([separator$2]):acc;}else if(has$2(menuItems,item.toLowerCase())){return acc.concat([menuItems[item.toLowerCase()]]);}else{return acc;}}else{return acc.concat([item]);}},[]);if(realItems.length>0&&isSeparator$1(realItems[realItems.length-1])){realItems.pop();}return realItems;};var getFromExpandingItem=function getFromExpandingItem(item,menuItems){var submenuItems=item.getSubmenuItems();var rest=expand(submenuItems,menuItems);var newMenus=deepMerge(rest.menus,wrap$1(item.value,rest.items));var newExpansions=deepMerge(rest.expansions,wrap$1(item.value,item.value));return{item:item,menus:newMenus,expansions:newExpansions};};var getFromItem=function getFromItem(item,menuItems){return isExpandingMenuItem(item)?getFromExpandingItem(item,menuItems):{item:item,menus:{},expansions:{}};};var generateValueIfRequired=function generateValueIfRequired(item){if(isSeparator$1(item)){return item;}else{var itemValue=get$e(item,'value').getOrThunk(function(){return generate$6('generated-menu-item');});return deepMerge({value:itemValue},item);}};var expand=function expand(items,menuItems){var realItems=unwrapReferences(isString(items)?items.split(' '):items,menuItems);return foldr(realItems,function(acc,item){var itemWithValue=generateValueIfRequired(item);var newData=getFromItem(itemWithValue,menuItems);return{menus:deepMerge(acc.menus,newData.menus),items:[newData.item].concat(acc.items),expansions:deepMerge(acc.expansions,newData.expansions)};},{menus:{},expansions:{},items:[]});};var build=function build(items,itemResponse,backstage,isHorizontalMenu){var primary=generate$6('primary-menu');var data=expand(items,backstage.shared.providers.menuItems());if(data.items.length===0){return Optional.none();}var mainMenu=createPartialMenu(primary,data.items,itemResponse,backstage,isHorizontalMenu);var submenus=map$1(data.menus,function(menuItems,menuName){return createPartialMenu(menuName,menuItems,itemResponse,backstage,false);});var menus=deepMerge(submenus,wrap$1(primary,mainMenu));return Optional.from(tieredMenu.tieredData(primary,menus,data.expansions));};var getMenuButtonApi=function getMenuButtonApi(component){return{isDisabled:function isDisabled(){return Disabling.isDisabled(component);},setDisabled:function setDisabled(state){return Disabling.set(component,state);},setActive:function setActive(state){var elm=component.element;if(state){add$2(elm,'tox-tbtn--enabled');set$8(elm,'aria-pressed',true);}else{remove$2(elm,'tox-tbtn--enabled');remove$7(elm,'aria-pressed');}},isActive:function isActive(){return has(component.element,'tox-tbtn--enabled');}};};var renderMenuButton=function renderMenuButton(spec,prefix,backstage,role){return renderCommonDropdown({text:spec.text,icon:spec.icon,tooltip:spec.tooltip,role:role,fetch:function fetch(_comp,callback){spec.fetch(function(items){callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,false));});},onSetup:spec.onSetup,getApi:getMenuButtonApi,columns:1,presets:'normal',classes:[],dropdownBehaviours:[Tabstopping.config({})]},prefix,backstage.shared);};var getFetch=function getFetch(items,getButton,backstage){var getMenuItemAction=function getMenuItemAction(item){return function(api){var newValue=!api.isActive();api.setActive(newValue);item.storage.set(newValue);backstage.shared.getSink().each(function(sink){getButton().getOpt(sink).each(function(orig){focus$3(orig.element);emitWith(orig,formActionEvent,{name:item.name,value:item.storage.get()});});});};};var getMenuItemSetup=function getMenuItemSetup(item){return function(api){api.setActive(item.storage.get());};};return function(success){success(map$2(items,function(item){var text=item.text.fold(function(){return{};},function(text){return{text:text};});return _assign(_assign({type:item.type,active:false},text),{onAction:getMenuItemAction(item),onSetup:getMenuItemSetup(item)});}));};};var renderCommonSpec=function renderCommonSpec(spec,actionOpt,extraBehaviours,dom,components,providersBackstage){if(extraBehaviours===void 0){extraBehaviours=[];}var action=actionOpt.fold(function(){return{};},function(action){return{action:action};});var common=_assign({buttonBehaviours:derive$1([DisablingConfigs.button(function(){return spec.disabled||providersBackstage.isDisabled();}),receivingConfig(),Tabstopping.config({}),config('button press',[preventDefault('click'),preventDefault('mousedown')])].concat(extraBehaviours)),eventOrder:{click:['button press','alloy.base.behaviour'],mousedown:['button press','alloy.base.behaviour']}},action);var domFinal=deepMerge(common,{dom:dom});return deepMerge(domFinal,{components:components});};var renderIconButtonSpec=function renderIconButtonSpec(spec,action,providersBackstage,extraBehaviours){if(extraBehaviours===void 0){extraBehaviours=[];}var tooltipAttributes=spec.tooltip.map(function(tooltip){return{'aria-label':providersBackstage.translate(tooltip),'title':providersBackstage.translate(tooltip)};}).getOr({});var dom={tag:'button',classes:['tox-tbtn'],attributes:tooltipAttributes};var icon=spec.icon.map(function(iconName){return renderIconFromPack(iconName,providersBackstage.icons);});var components=componentRenderPipeline([icon]);return renderCommonSpec(spec,action,extraBehaviours,dom,components,providersBackstage);};var renderIconButton=function renderIconButton(spec,action,providersBackstage,extraBehaviours){if(extraBehaviours===void 0){extraBehaviours=[];}var iconButtonSpec=renderIconButtonSpec(spec,Optional.some(action),providersBackstage,extraBehaviours);return Button.sketch(iconButtonSpec);};var renderButtonSpec=function renderButtonSpec(spec,action,providersBackstage,extraBehaviours,extraClasses){if(extraBehaviours===void 0){extraBehaviours=[];}if(extraClasses===void 0){extraClasses=[];}var translatedText=providersBackstage.translate(spec.text);var icon=spec.icon?spec.icon.map(function(iconName){return renderIconFromPack(iconName,providersBackstage.icons);}):Optional.none();var components=icon.isSome()?componentRenderPipeline([icon]):[];var innerHtml=icon.isSome()?{}:{innerHtml:translatedText};var classes=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],!spec.primary&&!spec.borderless?['tox-button','tox-button--secondary']:['tox-button'],true),icon.isSome()?['tox-button--icon']:[],true),spec.borderless?['tox-button--naked']:[],true),extraClasses,true);var dom=_assign(_assign({tag:'button',classes:classes},innerHtml),{attributes:{title:translatedText}});return renderCommonSpec(spec,action,extraBehaviours,dom,components,providersBackstage);};var renderButton=function renderButton(spec,action,providersBackstage,extraBehaviours,extraClasses){if(extraBehaviours===void 0){extraBehaviours=[];}if(extraClasses===void 0){extraClasses=[];}var buttonSpec=renderButtonSpec(spec,Optional.some(action),providersBackstage,extraBehaviours,extraClasses);return Button.sketch(buttonSpec);};var getAction=function getAction(name,buttonType){return function(comp){if(buttonType==='custom'){emitWith(comp,formActionEvent,{name:name,value:{}});}else if(buttonType==='submit'){emit(comp,formSubmitEvent);}else if(buttonType==='cancel'){emit(comp,formCancelEvent);}else{console.error('Unknown button type: ',buttonType);}};};var isMenuFooterButtonSpec=function isMenuFooterButtonSpec(spec,buttonType){return buttonType==='menu';};var isNormalFooterButtonSpec=function isNormalFooterButtonSpec(spec,buttonType){return buttonType==='custom'||buttonType==='cancel'||buttonType==='submit';};var renderFooterButton=function renderFooterButton(spec,buttonType,backstage){if(isMenuFooterButtonSpec(spec,buttonType)){var getButton=function getButton(){return memButton_1;};var menuButtonSpec=spec;var fixedSpec=_assign(_assign({},spec),{onSetup:function onSetup(api){api.setDisabled(spec.disabled);return noop;},fetch:getFetch(menuButtonSpec.items,getButton,backstage)});var memButton_1=record(renderMenuButton(fixedSpec,'tox-tbtn',backstage,Optional.none()));return memButton_1.asSpec();}else if(isNormalFooterButtonSpec(spec,buttonType)){var action=getAction(spec.name,buttonType);var buttonSpec=_assign(_assign({},spec),{borderless:false});return renderButton(buttonSpec,action,backstage.shared.providers,[]);}else{console.error('Unknown footer button type: ',buttonType);}};var renderDialogButton=function renderDialogButton(spec,providersBackstage){var action=getAction(spec.name,'custom');return renderFormField(Optional.none(),FormField.parts.field(_assign({factory:Button},renderButtonSpec(spec,Optional.some(action),providersBackstage,[RepresentingConfigs.memory(''),ComposingConfigs.self()]))));};var schema$h=constant$1([defaulted('field1Name','field1'),defaulted('field2Name','field2'),onStrictHandler('onLockedChange'),markers$1(['lockClass']),defaulted('locked',false),SketchBehaviours.field('coupledFieldBehaviours',[Composing,Representing])]);var getField=function getField(comp,detail,partName){return getPart(comp,detail,partName).bind(Composing.getCurrent);};var coupledPart=function coupledPart(selfName,otherName){return required({factory:FormField,name:selfName,overrides:function overrides(detail){return{fieldBehaviours:derive$1([config('coupled-input-behaviour',[run$1(input(),function(me){getField(me,detail,otherName).each(function(other){getPart(me,detail,'lock').each(function(lock){if(Toggling.isOn(lock)){detail.onLockedChange(me,other,lock);}});});})])])};}});};var parts$c=constant$1([coupledPart('field1','field2'),coupledPart('field2','field1'),required({factory:Button,schema:[required$1('dom')],name:'lock',overrides:function overrides(detail){return{buttonBehaviours:derive$1([Toggling.config({selected:detail.locked,toggleClass:detail.markers.lockClass,aria:{mode:'pressed'}})])};}})]);var factory$f=function factory$f(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:SketchBehaviours.augment(detail.coupledFieldBehaviours,[Composing.config({find:Optional.some}),Representing.config({store:{mode:'manual',getValue:function getValue(comp){var _a;var parts=getPartsOrDie(comp,detail,['field1','field2']);return _a={},_a[detail.field1Name]=Representing.getValue(parts.field1()),_a[detail.field2Name]=Representing.getValue(parts.field2()),_a;},setValue:function setValue(comp,value){var parts=getPartsOrDie(comp,detail,['field1','field2']);if(hasNonNullableKey(value,detail.field1Name)){Representing.setValue(parts.field1(),value[detail.field1Name]);}if(hasNonNullableKey(value,detail.field2Name)){Representing.setValue(parts.field2(),value[detail.field2Name]);}}}})]),apis:{getField1:function getField1(component){return getPart(component,detail,'field1');},getField2:function getField2(component){return getPart(component,detail,'field2');},getLock:function getLock(component){return getPart(component,detail,'lock');}}};};var FormCoupledInputs=composite({name:'FormCoupledInputs',configFields:schema$h(),partFields:parts$c(),factory:factory$f,apis:{getField1:function getField1(apis,component){return apis.getField1(component);},getField2:function getField2(apis,component){return apis.getField2(component);},getLock:function getLock(apis,component){return apis.getLock(component);}}});var formatSize=function formatSize(size){var unitDec={'':0,'px':0,'pt':1,'mm':1,'pc':2,'ex':2,'em':2,'ch':2,'rem':2,'cm':3,'in':4,'%':4};var maxDecimal=function maxDecimal(unit){return unit in unitDec?unitDec[unit]:1;};var numText=size.value.toFixed(maxDecimal(size.unit));if(numText.indexOf('.')!==-1){numText=numText.replace(/\\.?0*$/,'');}return numText+size.unit;};var parseSize=function parseSize(sizeText){var numPattern=/^\\s*(\\d+(?:\\.\\d+)?)\\s*(|cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|%)\\s*$/;var match=numPattern.exec(sizeText);if(match!==null){var value=parseFloat(match[1]);var unit=match[2];return Result.value({value:value,unit:unit});}else{return Result.error(sizeText);}};var convertUnit=function convertUnit(size,unit){var inInch={'':96,'px':96,'pt':72,'cm':2.54,'pc':12,'mm':25.4,'in':1};var supported=function supported(u){return has$2(inInch,u);};if(size.unit===unit){return Optional.some(size.value);}else if(supported(size.unit)&&supported(unit)){if(inInch[size.unit]===inInch[unit]){return Optional.some(size.value);}else{return Optional.some(size.value/inInch[size.unit]*inInch[unit]);}}else{return Optional.none();}};var noSizeConversion=function noSizeConversion(_input){return Optional.none();};var ratioSizeConversion=function ratioSizeConversion(scale,unit){return function(size){return convertUnit(size,unit).map(function(value){return{value:value*scale,unit:unit};});};};var makeRatioConverter=function makeRatioConverter(currentFieldText,otherFieldText){var cValue=parseSize(currentFieldText).toOptional();var oValue=parseSize(otherFieldText).toOptional();return lift2(cValue,oValue,function(cSize,oSize){return convertUnit(cSize,oSize.unit).map(function(val){return oSize.value/val;}).map(function(r){return ratioSizeConversion(r,oSize.unit);}).getOr(noSizeConversion);}).getOr(noSizeConversion);};var renderSizeInput=function renderSizeInput(spec,providersBackstage){var converter=noSizeConversion;var ratioEvent=generate$6('ratio-event');var makeIcon=function makeIcon(iconName){return render$3(iconName,{tag:'span',classes:['tox-icon','tox-lock-icon__'+iconName]},providersBackstage.icons);};var pLock=FormCoupledInputs.parts.lock({dom:{tag:'button',classes:['tox-lock','tox-button','tox-button--naked','tox-button--icon'],attributes:{title:providersBackstage.translate(spec.label.getOr('Constrain proportions'))}},components:[makeIcon('lock'),makeIcon('unlock')],buttonBehaviours:derive$1([Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();}}),receivingConfig(),Tabstopping.config({})])});var formGroup=function formGroup(components){return{dom:{tag:'div',classes:['tox-form__group']},components:components};};var getFieldPart=function getFieldPart(isField1){return FormField.parts.field({factory:Input,inputClasses:['tox-textfield'],inputBehaviours:derive$1([Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();}}),receivingConfig(),Tabstopping.config({}),config('size-input-events',[run$1(focusin(),function(component,_simulatedEvent){emitWith(component,ratioEvent,{isField1:isField1});}),run$1(change(),function(component,_simulatedEvent){emitWith(component,formChangeEvent,{name:spec.name});})])]),selectOnFocus:false});};var getLabel=function getLabel(label){return{dom:{tag:'label',classes:['tox-label'],innerHtml:providersBackstage.translate(label)}};};var widthField=FormCoupledInputs.parts.field1(formGroup([FormField.parts.label(getLabel('Width')),getFieldPart(true)]));var heightField=FormCoupledInputs.parts.field2(formGroup([FormField.parts.label(getLabel('Height')),getFieldPart(false)]));return FormCoupledInputs.sketch({dom:{tag:'div',classes:['tox-form__group']},components:[{dom:{tag:'div',classes:['tox-form__controls-h-stack']},components:[widthField,heightField,formGroup([getLabel('&nbsp;'),pLock])]}],field1Name:'width',field2Name:'height',locked:true,markers:{lockClass:'tox-locked'},onLockedChange:function onLockedChange(current,other,_lock){parseSize(Representing.getValue(current)).each(function(size){converter(size).each(function(newSize){Representing.setValue(other,formatSize(newSize));});});},coupledFieldBehaviours:derive$1([Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();},onDisabled:function onDisabled(comp){FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.disable);FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.disable);FormCoupledInputs.getLock(comp).each(Disabling.disable);},onEnabled:function onEnabled(comp){FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.enable);FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.enable);FormCoupledInputs.getLock(comp).each(Disabling.enable);}}),receivingConfig(),config('size-input-events2',[run$1(ratioEvent,function(component,simulatedEvent){var isField1=simulatedEvent.event.isField1;var optCurrent=isField1?FormCoupledInputs.getField1(component):FormCoupledInputs.getField2(component);var optOther=isField1?FormCoupledInputs.getField2(component):FormCoupledInputs.getField1(component);var value1=optCurrent.map(Representing.getValue).getOr('');var value2=optOther.map(Representing.getValue).getOr('');converter=makeRatioConverter(value1,value2);})])])});};var undo=constant$1(generate$6('undo'));var redo=constant$1(generate$6('redo'));var zoom=constant$1(generate$6('zoom'));var back=constant$1(generate$6('back'));var apply=constant$1(generate$6('apply'));var swap=constant$1(generate$6('swap'));var transform$1=constant$1(generate$6('transform'));var tempTransform=constant$1(generate$6('temp-transform'));var transformApply=constant$1(generate$6('transform-apply'));var internal={undo:undo,redo:redo,zoom:zoom,back:back,apply:apply,swap:swap,transform:transform$1,tempTransform:tempTransform,transformApply:transformApply};var saveState=constant$1('save-state');var disable=constant$1('disable');var enable=constant$1('enable');var external={formActionEvent:formActionEvent,saveState:saveState,disable:disable,enable:enable};var renderEditPanel=function renderEditPanel(imagePanel,providersBackstage){var createButton=function createButton(text,action,disabled,primary){return record(renderButton({name:text,text:text,disabled:disabled,primary:primary,icon:Optional.none(),borderless:false},action,providersBackstage));};var createIconButton=function createIconButton(icon,tooltip,action,disabled){return record(renderIconButton({name:icon,icon:Optional.some(icon),tooltip:Optional.some(tooltip),disabled:disabled,primary:false,borderless:false},action,providersBackstage));};var disableAllComponents=function disableAllComponents(comps,eventcomp){comps.map(function(mem){var component=mem.get(eventcomp);if(component.hasConfigured(Disabling)){Disabling.disable(component);}});};var enableAllComponents=function enableAllComponents(comps,eventcomp){comps.map(function(mem){var component=mem.get(eventcomp);if(component.hasConfigured(Disabling)){Disabling.enable(component);}});};var panelDom={tag:'div',classes:['tox-image-tools__toolbar','tox-image-tools-edit-panel']};var noop$1=noop;var emit$1=function emit$1(comp,event,data){emitWith(comp,event,data);};var emitDisable=function emitDisable(component){return emit(component,external.disable());};var emitEnable=function emitEnable(component){return emit(component,external.enable());};var emitTransform=function emitTransform(comp,transform){emitDisable(comp);emit$1(comp,internal.transform(),{transform:transform});emitEnable(comp);};var emitTempTransform=function emitTempTransform(comp,transform){emitDisable(comp);emit$1(comp,internal.tempTransform(),{transform:transform});emitEnable(comp);};var getBackSwap=function getBackSwap(anyInSystem){return function(){memContainer.getOpt(anyInSystem).each(function(container){Replacing.set(container,[ButtonPanel]);});};};var emitTransformApply=function emitTransformApply(comp,transform){emitDisable(comp);emit$1(comp,internal.transformApply(),{transform:transform,swap:getBackSwap(comp)});emitEnable(comp);};var createBackButton=function createBackButton(){return createButton('Back',function(button){return emit$1(button,internal.back(),{swap:getBackSwap(button)});},false,false);};var createSpacer=function createSpacer(){return record({dom:{tag:'div',classes:['tox-spacer']},behaviours:derive$1([Disabling.config({})])});};var createApplyButton=function createApplyButton(){return createButton('Apply',function(button){return emit$1(button,internal.apply(),{swap:getBackSwap(button)});},true,true);};var makeCropTransform=function makeCropTransform(){return function(ir){var rect=imagePanel.getRect();return crop(ir,rect.x,rect.y,rect.w,rect.h);};};var cropPanelComponents=[createBackButton(),createSpacer(),createButton('Apply',function(button){var transform=makeCropTransform();emitTransformApply(button,transform);imagePanel.hideCrop();},false,true)];var CropPanel=Container.sketch({dom:panelDom,components:cropPanelComponents.map(function(mem){return mem.asSpec();}),containerBehaviours:derive$1([config('image-tools-crop-buttons-events',[run$1(external.disable(),function(comp,_se){disableAllComponents(cropPanelComponents,comp);}),run$1(external.enable(),function(comp,_se){enableAllComponents(cropPanelComponents,comp);})])])});var memSize=record(renderSizeInput({name:'size',label:Optional.none(),constrain:true,disabled:false},providersBackstage));var makeResizeTransform=function makeResizeTransform(width,height){return function(ir){return resize$1(ir,width,height);};};var resizePanelComponents=[createBackButton(),createSpacer(),memSize,createSpacer(),createButton('Apply',function(button){memSize.getOpt(button).each(function(sizeInput){var value=Representing.getValue(sizeInput);var width=parseInt(value.width,10);var height=parseInt(value.height,10);var transform=makeResizeTransform(width,height);emitTransformApply(button,transform);});},false,true)];var ResizePanel=Container.sketch({dom:panelDom,components:resizePanelComponents.map(function(mem){return mem.asSpec();}),containerBehaviours:derive$1([config('image-tools-resize-buttons-events',[run$1(external.disable(),function(comp,_se){disableAllComponents(resizePanelComponents,comp);}),run$1(external.enable(),function(comp,_se){enableAllComponents(resizePanelComponents,comp);})])])});var makeValueTransform=function makeValueTransform(transform,value){return function(ir){return transform(ir,value);};};var horizontalFlip=makeValueTransform(flip,'h');var verticalFlip=makeValueTransform(flip,'v');var counterclockwiseRotate=makeValueTransform(rotate,-90);var clockwiseRotate=makeValueTransform(rotate,90);var flipRotateOnAction=function flipRotateOnAction(comp,operation){emitTempTransform(comp,operation);};var flipRotateComponents=[createBackButton(),createSpacer(),createIconButton('flip-horizontally','Flip horizontally',function(button){flipRotateOnAction(button,horizontalFlip);},false),createIconButton('flip-vertically','Flip vertically',function(button){flipRotateOnAction(button,verticalFlip);},false),createIconButton('rotate-left','Rotate counterclockwise',function(button){flipRotateOnAction(button,counterclockwiseRotate);},false),createIconButton('rotate-right','Rotate clockwise',function(button){flipRotateOnAction(button,clockwiseRotate);},false),createSpacer(),createApplyButton()];var FlipRotatePanel=Container.sketch({dom:panelDom,components:flipRotateComponents.map(function(mem){return mem.asSpec();}),containerBehaviours:derive$1([config('image-tools-fliprotate-buttons-events',[run$1(external.disable(),function(comp,_se){disableAllComponents(flipRotateComponents,comp);}),run$1(external.enable(),function(comp,_se){enableAllComponents(flipRotateComponents,comp);})])])});var makeSlider=function makeSlider(label,onChoose,min,value,max){var labelPart=Slider.parts.label({dom:{tag:'label',classes:['tox-label'],innerHtml:providersBackstage.translate(label)}});var spectrum=Slider.parts.spectrum({dom:{tag:'div',classes:['tox-slider__rail'],attributes:{role:'presentation'}}});var thumb=Slider.parts.thumb({dom:{tag:'div',classes:['tox-slider__handle'],attributes:{role:'presentation'}}});return record(Slider.sketch({dom:{tag:'div',classes:['tox-slider'],attributes:{role:'presentation'}},model:{mode:'x',minX:min,maxX:max,getInitialValue:constant$1({x:value})},components:[labelPart,spectrum,thumb],sliderBehaviours:derive$1([Focusing.config({})]),onChoose:onChoose}));};var makeVariableSlider=function makeVariableSlider(label,transform,min,value,max){var onChoose=function onChoose(slider,_thumb,value){var valTransform=makeValueTransform(transform,value.x/100);emitTransform(slider,valTransform);};return makeSlider(label,onChoose,min,value,max);};var variableFilterPanelComponents=function variableFilterPanelComponents(label,transform,min,value,max){return[createBackButton(),makeVariableSlider(label,transform,min,value,max),createApplyButton()];};var createVariableFilterPanel=function createVariableFilterPanel(label,transform,min,value,max){var filterPanelComponents=variableFilterPanelComponents(label,transform,min,value,max);return Container.sketch({dom:panelDom,components:filterPanelComponents.map(function(mem){return mem.asSpec();}),containerBehaviours:derive$1([config('image-tools-filter-panel-buttons-events',[run$1(external.disable(),function(comp,_se){disableAllComponents(filterPanelComponents,comp);}),run$1(external.enable(),function(comp,_se){enableAllComponents(filterPanelComponents,comp);})])])});};var filterPanelComponents=[createBackButton(),createSpacer(),createApplyButton()];var FilterPanel=Container.sketch({dom:panelDom,components:filterPanelComponents.map(function(mem){return mem.asSpec();})});var BrightnessPanel=createVariableFilterPanel('Brightness',brightness,-100,0,100);var ContrastPanel=createVariableFilterPanel('Contrast',contrast,-100,0,100);var GammaPanel=createVariableFilterPanel('Gamma',gamma,-100,0,100);var makeColorTransform=function makeColorTransform(red,green,blue){return function(ir){return colorize(ir,red,green,blue);};};var makeColorSlider=function makeColorSlider(label){var onChoose=function onChoose(slider,_thumb,_value){var redOpt=memRed.getOpt(slider);var blueOpt=memBlue.getOpt(slider);var greenOpt=memGreen.getOpt(slider);redOpt.each(function(red){blueOpt.each(function(blue){greenOpt.each(function(green){var r=Representing.getValue(red).x/100;var g=Representing.getValue(green).x/100;var b=Representing.getValue(blue).x/100;var transform=makeColorTransform(r,g,b);emitTransform(slider,transform);});});});};return makeSlider(label,onChoose,0,100,200);};var memRed=makeColorSlider('R');var memGreen=makeColorSlider('G');var memBlue=makeColorSlider('B');var colorizePanelComponents=[createBackButton(),memRed,memGreen,memBlue,createApplyButton()];var ColorizePanel=Container.sketch({dom:panelDom,components:colorizePanelComponents.map(function(mem){return mem.asSpec();})});var getTransformPanelEvent=function getTransformPanelEvent(panel,transform,update){return function(button){var swap=function swap(){memContainer.getOpt(button).each(function(container){Replacing.set(container,[panel]);update(container);});};emit$1(button,internal.swap(),{transform:transform,swap:swap});};};var cropPanelUpdate=function cropPanelUpdate(_anyInSystem){imagePanel.showCrop();};var resizePanelUpdate=function resizePanelUpdate(anyInSystem){memSize.getOpt(anyInSystem).each(function(sizeInput){var measurements=imagePanel.getMeasurements();var width=measurements.width;var height=measurements.height;Representing.setValue(sizeInput,{width:width,height:height});});};var sharpenTransform=Optional.some(sharpen);var invertTransform=Optional.some(invert);var buttonPanelComponents=[createIconButton('crop','Crop',getTransformPanelEvent(CropPanel,Optional.none(),cropPanelUpdate),false),createIconButton('resize','Resize',getTransformPanelEvent(ResizePanel,Optional.none(),resizePanelUpdate),false),createIconButton('orientation','Orientation',getTransformPanelEvent(FlipRotatePanel,Optional.none(),noop$1),false),createIconButton('brightness','Brightness',getTransformPanelEvent(BrightnessPanel,Optional.none(),noop$1),false),createIconButton('sharpen','Sharpen',getTransformPanelEvent(FilterPanel,sharpenTransform,noop$1),false),createIconButton('contrast','Contrast',getTransformPanelEvent(ContrastPanel,Optional.none(),noop$1),false),createIconButton('color-levels','Color levels',getTransformPanelEvent(ColorizePanel,Optional.none(),noop$1),false),createIconButton('gamma','Gamma',getTransformPanelEvent(GammaPanel,Optional.none(),noop$1),false),createIconButton('invert','Invert',getTransformPanelEvent(FilterPanel,invertTransform,noop$1),false)];var ButtonPanel=Container.sketch({dom:panelDom,components:buttonPanelComponents.map(function(mem){return mem.asSpec();})});var container=Container.sketch({dom:{tag:'div'},components:[ButtonPanel],containerBehaviours:derive$1([Replacing.config({})])});var memContainer=record(container);var getApplyButton=function getApplyButton(anyInSystem){return memContainer.getOpt(anyInSystem).map(function(container){var panel=container.components()[0];return panel.components()[panel.components().length-1];});};return{memContainer:memContainer,getApplyButton:getApplyButton};};var global$4=tinymce.util.Tools.resolve('tinymce.geom.Rect');var global$3=tinymce.util.Tools.resolve('tinymce.util.Observable');var global$2=tinymce.util.Tools.resolve('tinymce.util.VK');var getDocumentSize=function getDocumentSize(doc){var max=Math.max;var documentElement=doc.documentElement;var body=doc.body;var scrollWidth=max(documentElement.scrollWidth,body.scrollWidth);var clientWidth=max(documentElement.clientWidth,body.clientWidth);var offsetWidth=max(documentElement.offsetWidth,body.offsetWidth);var scrollHeight=max(documentElement.scrollHeight,body.scrollHeight);var clientHeight=max(documentElement.clientHeight,body.clientHeight);var offsetHeight=max(documentElement.offsetHeight,body.offsetHeight);return{width:scrollWidth<offsetWidth?clientWidth:scrollWidth,height:scrollHeight<offsetHeight?clientHeight:scrollHeight};};var isTouchEvent$1=function isTouchEvent$1(e){return isNonNullable(e.changedTouches);};var updateWithTouchData=function updateWithTouchData(e){if(isTouchEvent$1(e)){var keys='screenX screenY pageX pageY clientX clientY'.split(' ');for(var i=0;i<keys.length;i++){e[keys[i]]=e.changedTouches[0][keys[i]];}}};function DragHelper(id,settings){var _a,_b,_c;var eventOverlay;var handleEvents=[];var overlayEvents=[];var doc=(_a=settings.document)!==null&&_a!==void 0?_a:document;var root=(_b=settings.root)!==null&&_b!==void 0?_b:doc;var sugarDoc=SugarElement.fromDom(doc);var downButton;var startX;var startY;var handleElement=SugarElement.fromDom(root.getElementById((_c=settings.handle)!==null&&_c!==void 0?_c:id));var start=function start(e){var rawEvent=e.raw;var docSize=getDocumentSize(doc);updateWithTouchData(rawEvent);e.prevent();downButton=rawEvent.button;startX=rawEvent.screenX;startY=rawEvent.screenY;var cursor=get$c(handleElement,'cursor');eventOverlay=SugarElement.fromTag('div',doc);setAll(eventOverlay,{'position':'absolute','top':'0','left':'0','width':docSize.width+'px','height':docSize.height+'px','z-index':2147483647+'','opacity':'0.0001',cursor:cursor});append$2(getBody(sugarDoc),eventOverlay);overlayEvents.push(bind(sugarDoc,'mousemove',drag),bind(sugarDoc,'touchmove',drag),bind(sugarDoc,'mouseup',stop),bind(sugarDoc,'touchend',stop));settings.start(rawEvent);};var drag=function drag(e){var rawEvent=e.raw;updateWithTouchData(rawEvent);if(rawEvent.button!==downButton){return stop(e);}rawEvent.deltaX=rawEvent.screenX-startX;rawEvent.deltaY=rawEvent.screenY-startY;e.prevent();settings.drag(rawEvent);};var stop=function stop(e){updateWithTouchData(e.raw);each$1(overlayEvents,function(e){return e.unbind();});overlayEvents=[];remove$5(eventOverlay);if(settings.stop){settings.stop(e.raw);}};var destroy=function destroy(){each$1(overlayEvents.concat(handleEvents),function(e){return e.unbind();});overlayEvents=[];handleEvents=[];if(isNonNullable(eventOverlay)){remove$5(eventOverlay);}};handleEvents.push(bind(handleElement,'mousedown',start),bind(handleElement,'touchstart',start));return{destroy:destroy};}var count=0;var create$1=function create$1(currentRect,viewPortRect,clampRect,containerElm,action){var dragHelpers;var events=[];var prefix='tox-';var id=prefix+'crid-'+count++;var container=SugarElement.fromDom(containerElm);var handles=[{name:'move',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:'Crop Mask'},{name:'nw',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:'Top Left Crop Handle'},{name:'ne',xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:'Top Right Crop Handle'},{name:'sw',xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:'Bottom Left Crop Handle'},{name:'se',xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:'Bottom Right Crop Handle'}];var blockers=['top','right','bottom','left'];var getAbsoluteRect=function getAbsoluteRect(outerRect,relativeRect){return{x:relativeRect.x+outerRect.x,y:relativeRect.y+outerRect.y,w:relativeRect.w,h:relativeRect.h};};var getRelativeRect=function getRelativeRect(outerRect,innerRect){return{x:innerRect.x-outerRect.x,y:innerRect.y-outerRect.y,w:innerRect.w,h:innerRect.h};};var getInnerRect=function getInnerRect(){return getRelativeRect(clampRect,currentRect);};var moveRect=function moveRect(handle,startRect,deltaX,deltaY){var x=startRect.x+deltaX*handle.deltaX;var y=startRect.y+deltaY*handle.deltaY;var w=Math.max(20,startRect.w+deltaX*handle.deltaW);var h=Math.max(20,startRect.h+deltaY*handle.deltaH);var rect=currentRect=global$4.clamp({x:x,y:y,w:w,h:h},clampRect,handle.name==='move');rect=getRelativeRect(clampRect,rect);instance.fire('updateRect',{rect:rect});setInnerRect(rect);};var render=function render(){var createDragHelper=function createDragHelper(handle){var startRect;return DragHelper(id,{document:containerElm.ownerDocument,root:getRootNode(container).dom,handle:id+'-'+handle.name,start:function start(){startRect=currentRect;},drag:function drag(e){moveRect(handle,startRect,e.deltaX,e.deltaY);}});};var cropContainer=SugarElement.fromTag('div');setAll$1(cropContainer,{id:id,'class':prefix+'croprect-container','role':'grid','aria-dropeffect':'execute'});append$2(container,cropContainer);each$1(blockers,function(blocker){descendant(container,'#'+id).each(function(blockerElm){var cropBlocker=SugarElement.fromTag('div');setAll$1(cropBlocker,{'id':id+'-'+blocker,'class':prefix+'croprect-block','data-mce-bogus':'all'});set$7(cropBlocker,'display','none');append$2(blockerElm,cropBlocker);});});each$1(handles,function(handle){descendant(container,'#'+id).each(function(handleElm){var cropHandle=SugarElement.fromTag('div');setAll$1(cropHandle,{'id':id+'-'+handle.name,'aria-label':handle.label,'aria-grabbed':'false','data-mce-bogus':'all','role':'gridcell','tabindex':'-1','title':handle.label});add$1(cropHandle,[prefix+'croprect-handle',prefix+'croprect-handle-'+handle.name]);set$7(cropHandle,'display','none');append$2(handleElm,cropHandle);});});dragHelpers=map$2(handles,createDragHelper);repaint(currentRect);var handleFocus=function handleFocus(e){set$8(e.target,'aria-grabbed',e.raw.type==='focus'?'true':'false');};var handleKeydown=function handleKeydown(e){var activeHandle;each$1(handles,function(handle){if(get$d(e.target,'id')===id+'-'+handle.name){activeHandle=handle;return false;}});var moveAndBlock=function moveAndBlock(evt,handle,startRect,deltaX,deltaY){evt.stopPropagation();evt.preventDefault();moveRect(activeHandle,startRect,deltaX,deltaY);};switch(e.raw.keyCode){case global$2.LEFT:moveAndBlock(e,activeHandle,currentRect,-10,0);break;case global$2.RIGHT:moveAndBlock(e,activeHandle,currentRect,10,0);break;case global$2.UP:moveAndBlock(e,activeHandle,currentRect,0,-10);break;case global$2.DOWN:moveAndBlock(e,activeHandle,currentRect,0,10);break;case global$2.ENTER:case global$2.SPACEBAR:e.prevent();action();break;}};events.push(bind(container,'focusin',handleFocus),bind(container,'focusout',handleFocus),bind(container,'keydown',handleKeydown));};var toggleVisibility=function toggleVisibility(state){var selectors=__spreadArray(__spreadArray([],map$2(handles,function(handle){return'#'+id+'-'+handle.name;}),true),map$2(blockers,function(blocker){return'#'+id+'-'+blocker;}),true).join(',');var elems=descendants(container,selectors);if(state){each$1(elems,function(elm){return remove$6(elm,'display');});}else{each$1(elems,function(elm){return set$7(elm,'display','none');});}};var repaint=function repaint(rect){var updateElementRect=function updateElementRect(name,newRect){descendant(container,'#'+id+'-'+name).each(function(elm){setAll(elm,{left:newRect.x+'px',top:newRect.y+'px',width:Math.max(0,newRect.w)+'px',height:Math.max(0,newRect.h)+'px'});});};each$1(handles,function(handle){descendant(container,'#'+id+'-'+handle.name).each(function(elm){setAll(elm,{left:rect.w*handle.xMul+rect.x+'px',top:rect.h*handle.yMul+rect.y+'px'});});});updateElementRect('top',{x:viewPortRect.x,y:viewPortRect.y,w:viewPortRect.w,h:rect.y-viewPortRect.y});updateElementRect('right',{x:rect.x+rect.w,y:rect.y,w:viewPortRect.w-rect.x-rect.w+viewPortRect.x,h:rect.h});updateElementRect('bottom',{x:viewPortRect.x,y:rect.y+rect.h,w:viewPortRect.w,h:viewPortRect.h-rect.y-rect.h+viewPortRect.y});updateElementRect('left',{x:viewPortRect.x,y:rect.y,w:rect.x-viewPortRect.x,h:rect.h});updateElementRect('move',rect);};var setRect=function setRect(rect){currentRect=rect;repaint(currentRect);};var setViewPortRect=function setViewPortRect(rect){viewPortRect=rect;repaint(currentRect);};var setInnerRect=function setInnerRect(rect){setRect(getAbsoluteRect(clampRect,rect));};var setClampRect=function setClampRect(rect){clampRect=rect;repaint(currentRect);};var destroy=function destroy(){each$1(dragHelpers,function(helper){return helper.destroy();});dragHelpers=[];each$1(events,function(e){return e.unbind();});events=[];};render();var instance=_assign(_assign({},global$3),{toggleVisibility:toggleVisibility,setClampRect:setClampRect,setRect:setRect,getInnerRect:getInnerRect,setInnerRect:setInnerRect,setViewPortRect:setViewPortRect,destroy:destroy});return instance;};var CropRect={create:create$1};var loadImage=function loadImage(image){return new global$c(function(resolve){var _loaded=function loaded(){image.removeEventListener('load',_loaded);resolve(image);};if(image.complete){resolve(image);}else{image.addEventListener('load',_loaded);}});};var renderImagePanel=function renderImagePanel(initialUrl){var memBg=record({dom:{tag:'div',classes:['tox-image-tools__image-bg'],attributes:{role:'presentation'}}});var zoomState=Cell(1);var cropRect=api$1();var rectState=Cell({x:0,y:0,w:1,h:1});var viewRectState=Cell({x:0,y:0,w:1,h:1});var repaintImg=function repaintImg(anyInSystem,img){memContainer.getOpt(anyInSystem).each(function(panel){var zoom=zoomState.get();var panelW=get$a(panel.element);var panelH=get$b(panel.element);var width=img.dom.naturalWidth*zoom;var height=img.dom.naturalHeight*zoom;var left=Math.max(0,panelW/2-width/2);var top=Math.max(0,panelH/2-height/2);var css={left:left.toString()+'px',top:top.toString()+'px',width:width.toString()+'px',height:height.toString()+'px',position:'absolute'};setAll(img,css);memBg.getOpt(panel).each(function(bg){setAll(bg.element,css);});cropRect.run(function(cRect){var rect=rectState.get();cRect.setRect({x:rect.x*zoom+left,y:rect.y*zoom+top,w:rect.w*zoom,h:rect.h*zoom});cRect.setClampRect({x:left,y:top,w:width,h:height});cRect.setViewPortRect({x:0,y:0,w:panelW,h:panelH});});});};var zoomFit=function zoomFit(anyInSystem,img){memContainer.getOpt(anyInSystem).each(function(panel){var panelW=get$a(panel.element);var panelH=get$b(panel.element);var width=img.dom.naturalWidth;var height=img.dom.naturalHeight;var zoom=Math.min(panelW/width,panelH/height);if(zoom>=1){zoomState.set(1);}else{zoomState.set(zoom);}});};var updateSrc=function updateSrc(anyInSystem,url){var img=SugarElement.fromTag('img');set$8(img,'src',url);return loadImage(img.dom).then(function(){if(anyInSystem.getSystem().isConnected()){memContainer.getOpt(anyInSystem).map(function(panel){var aImg=external$2({element:img});Replacing.replaceAt(panel,1,Optional.some(aImg));var lastViewRect=viewRectState.get();var viewRect={x:0,y:0,w:img.dom.naturalWidth,h:img.dom.naturalHeight};viewRectState.set(viewRect);var rect=global$4.inflate(viewRect,-20,-20);rectState.set(rect);if(lastViewRect.w!==viewRect.w||lastViewRect.h!==viewRect.h){zoomFit(panel,img);}repaintImg(panel,img);});}});};var zoom=function zoom(anyInSystem,direction){var currentZoom=zoomState.get();var newZoom=direction>0?Math.min(2,currentZoom+0.1):Math.max(0.1,currentZoom-0.1);zoomState.set(newZoom);memContainer.getOpt(anyInSystem).each(function(panel){var img=panel.components()[1].element;repaintImg(panel,img);});};var showCrop=function showCrop(){cropRect.run(function(cRect){cRect.toggleVisibility(true);});};var hideCrop=function hideCrop(){cropRect.run(function(cRect){cRect.toggleVisibility(false);});};var getRect=function getRect(){return rectState.get();};var container=Container.sketch({dom:{tag:'div',classes:['tox-image-tools__image']},components:[memBg.asSpec(),{dom:{tag:'img',attributes:{src:initialUrl}}},{dom:{tag:'div'},behaviours:derive$1([config('image-panel-crop-events',[runOnAttached(function(comp){memContainer.getOpt(comp).each(function(container){var el=container.element.dom;var cRect=CropRect.create({x:10,y:10,w:100,h:100},{x:0,y:0,w:200,h:200},{x:0,y:0,w:200,h:200},el,noop);cRect.toggleVisibility(false);cRect.on('updateRect',function(e){var rect=e.rect;var zoom=zoomState.get();var newRect={x:Math.round(rect.x/zoom),y:Math.round(rect.y/zoom),w:Math.round(rect.w/zoom),h:Math.round(rect.h/zoom)};rectState.set(newRect);});cropRect.set(cRect);});}),runOnDetached(function(){cropRect.clear();})])])}],containerBehaviours:derive$1([Replacing.config({}),config('image-panel-events',[runOnAttached(function(comp){updateSrc(comp,initialUrl);})])])});var memContainer=record(container);var getMeasurements=function getMeasurements(){var viewRect=viewRectState.get();return{width:viewRect.w,height:viewRect.h};};return{memContainer:memContainer,updateSrc:updateSrc,zoom:zoom,showCrop:showCrop,hideCrop:hideCrop,getRect:getRect,getMeasurements:getMeasurements};};var createButton=function createButton(innerHtml,icon,disabled,action,providersBackstage){return renderIconButton({name:innerHtml,icon:Optional.some(icon),disabled:disabled,tooltip:Optional.some(innerHtml),primary:false,borderless:false},action,providersBackstage);};var setButtonEnabled=function setButtonEnabled(button,enabled){if(enabled){Disabling.enable(button);}else{Disabling.disable(button);}};var renderSideBar=function renderSideBar(providersBackstage){var updateButtonUndoStates=function updateButtonUndoStates(anyInSystem,undoEnabled,redoEnabled){memUndo.getOpt(anyInSystem).each(function(undo){setButtonEnabled(undo,undoEnabled);});memRedo.getOpt(anyInSystem).each(function(redo){setButtonEnabled(redo,redoEnabled);});};var memUndo=record(createButton('Undo','undo',true,function(button){emitWith(button,internal.undo(),{direction:1});},providersBackstage));var memRedo=record(createButton('Redo','redo',true,function(button){emitWith(button,internal.redo(),{direction:1});},providersBackstage));var container=Container.sketch({dom:{tag:'div',classes:['tox-image-tools__toolbar','tox-image-tools__sidebar']},components:[memUndo.asSpec(),memRedo.asSpec(),createButton('Zoom in','zoom-in',false,function(button){emitWith(button,internal.zoom(),{direction:1});},providersBackstage),createButton('Zoom out','zoom-out',false,function(button){emitWith(button,internal.zoom(),{direction:-1});},providersBackstage)]});return{container:container,updateButtonUndoStates:updateButtonUndoStates};};function UndoStack(){var data=[];var index=-1;var add=function add(state){var removed=data.splice(++index);data.push(state);return{state:state,removed:removed};};var undo=function undo(){if(canUndo()){return data[--index];}};var redo=function redo(){if(canRedo()){return data[++index];}};var canUndo=function canUndo(){return index>0;};var canRedo=function canRedo(){return index!==-1&&index<data.length-1;};return{data:data,add:add,undo:undo,redo:redo,canUndo:canUndo,canRedo:canRedo};}var makeState=function makeState(initialState){var blobState=Cell(initialState);var tempState=value$1();var undoStack=UndoStack();undoStack.add(initialState);var getBlobState=function getBlobState(){return blobState.get();};var setBlobState=function setBlobState(state){blobState.set(state);};var getTempState=function getTempState(){return tempState.get().getOrThunk(blobState.get);};var updateTempState=function updateTempState(blob){var newTempState=createState(blob);destroyTempState();tempState.set(newTempState);return newTempState.url;};var createState=function createState(blob){return{blob:blob,url:URL.createObjectURL(blob)};};var destroyState=function destroyState(state){URL.revokeObjectURL(state.url);};var destroyStates=function destroyStates(states){global$5.each(states,destroyState);};var destroyTempState=function destroyTempState(){tempState.on(destroyState);tempState.clear();};var addBlobState=function addBlobState(blob){var newState=createState(blob);setBlobState(newState);var removed=undoStack.add(newState).removed;destroyStates(removed);return newState.url;};var addTempState=function addTempState(blob){var newState=createState(blob);tempState.set(newState);return newState.url;};var applyTempState=function applyTempState(postApply){return tempState.get().fold(noop,function(temp){addBlobState(temp.blob);postApply();});};var undo=function undo(){var currentState=undoStack.undo();setBlobState(currentState);return currentState.url;};var redo=function redo(){var currentState=undoStack.redo();setBlobState(currentState);return currentState.url;};var getHistoryStates=function getHistoryStates(){var undoEnabled=undoStack.canUndo();var redoEnabled=undoStack.canRedo();return{undoEnabled:undoEnabled,redoEnabled:redoEnabled};};return{getBlobState:getBlobState,setBlobState:setBlobState,addBlobState:addBlobState,getTempState:getTempState,updateTempState:updateTempState,addTempState:addTempState,applyTempState:applyTempState,destroyTempState:destroyTempState,undo:undo,redo:redo,getHistoryStates:getHistoryStates};};var renderImageTools=function renderImageTools(detail,providersBackstage){var state=makeState(detail.currentState);var zoom=function zoom(anyInSystem,simulatedEvent){var direction=simulatedEvent.event.direction;imagePanel.zoom(anyInSystem,direction);};var updateButtonUndoStates=function updateButtonUndoStates(anyInSystem){var historyStates=state.getHistoryStates();sideBar.updateButtonUndoStates(anyInSystem,historyStates.undoEnabled,historyStates.redoEnabled);emitWith(anyInSystem,external.formActionEvent,{name:external.saveState(),value:historyStates.undoEnabled});};var disableUndoRedo=function disableUndoRedo(anyInSystem){sideBar.updateButtonUndoStates(anyInSystem,false,false);};var undo=function undo(anyInSystem,_simulatedEvent){var url=state.undo();updateSrc(anyInSystem,url).then(function(_oImg){unblock(anyInSystem);updateButtonUndoStates(anyInSystem);});};var redo=function redo(anyInSystem,_simulatedEvent){var url=state.redo();updateSrc(anyInSystem,url).then(function(_oImg){unblock(anyInSystem);updateButtonUndoStates(anyInSystem);});};var imageResultToBlob=function imageResultToBlob(ir){return ir.toBlob();};var block=function block(anyInSystem){emitWith(anyInSystem,external.formActionEvent,{name:external.disable(),value:{}});};var unblock=function unblock(anyInSystem){editPanel.getApplyButton(anyInSystem).each(function(applyButton){Disabling.enable(applyButton);});emitWith(anyInSystem,external.formActionEvent,{name:external.enable(),value:{}});};var updateSrc=function updateSrc(anyInSystem,src){block(anyInSystem);return imagePanel.updateSrc(anyInSystem,src);};var blobManipulate=function blobManipulate(anyInSystem,blob,filter,action,swap){block(anyInSystem);blobToImageResult(blob).then(filter).then(imageResultToBlob).then(action).then(function(url){return updateSrc(anyInSystem,url);}).then(function(){updateButtonUndoStates(anyInSystem);swap();unblock(anyInSystem);}).catch(function(err){console.log(err);if(anyInSystem.getSystem().isConnected()){unblock(anyInSystem);}});};var manipulate=function manipulate(anyInSystem,filter,swap){var blob=state.getBlobState().blob;var action=function action(blob){return state.updateTempState(blob);};blobManipulate(anyInSystem,blob,filter,action,swap);};var tempManipulate=function tempManipulate(anyInSystem,filter){var blob=state.getTempState().blob;var action=function action(blob){return state.addTempState(blob);};blobManipulate(anyInSystem,blob,filter,action,noop);};var manipulateApply=function manipulateApply(anyInSystem,filter,swap){var blob=state.getBlobState().blob;var action=function action(blob){var url=state.addBlobState(blob);destroyTempState(anyInSystem);return url;};blobManipulate(anyInSystem,blob,filter,action,swap);};var apply=function apply(anyInSystem,simulatedEvent){var postApply=function postApply(){destroyTempState(anyInSystem);var swap=simulatedEvent.event.swap;swap();};state.applyTempState(postApply);};var destroyTempState=function destroyTempState(anyInSystem){var currentUrl=state.getBlobState().url;state.destroyTempState();updateButtonUndoStates(anyInSystem);return currentUrl;};var cancel=function cancel(anyInSystem){var currentUrl=destroyTempState(anyInSystem);updateSrc(anyInSystem,currentUrl).then(function(_oImg){unblock(anyInSystem);});};var back=function back(anyInSystem,simulatedEvent){cancel(anyInSystem);var swap=simulatedEvent.event.swap;swap();imagePanel.hideCrop();};var transform=function transform(anyInSystem,simulatedEvent){return manipulate(anyInSystem,simulatedEvent.event.transform,noop);};var tempTransform=function tempTransform(anyInSystem,simulatedEvent){return tempManipulate(anyInSystem,simulatedEvent.event.transform);};var transformApply=function transformApply(anyInSystem,simulatedEvent){return manipulateApply(anyInSystem,simulatedEvent.event.transform,simulatedEvent.event.swap);};var imagePanel=renderImagePanel(detail.currentState.url);var sideBar=renderSideBar(providersBackstage);var editPanel=renderEditPanel(imagePanel,providersBackstage);var swap=function swap(anyInSystem,simulatedEvent){disableUndoRedo(anyInSystem);var transform=simulatedEvent.event.transform;var swap=simulatedEvent.event.swap;transform.fold(function(){swap();},function(transform){manipulate(anyInSystem,transform,swap);});};return{dom:{tag:'div',attributes:{role:'presentation'}},components:[editPanel.memContainer.asSpec(),imagePanel.memContainer.asSpec(),sideBar.container],behaviours:derive$1([Representing.config({store:{mode:'manual',getValue:function getValue(){return state.getBlobState();}}}),config('image-tools-events',[run$1(internal.undo(),undo),run$1(internal.redo(),redo),run$1(internal.zoom(),zoom),run$1(internal.back(),back),run$1(internal.apply(),apply),run$1(internal.transform(),transform),run$1(internal.tempTransform(),tempTransform),run$1(internal.transformApply(),transformApply),run$1(internal.swap(),swap)]),ComposingConfigs.self()])};};var renderLabel=function renderLabel(spec,backstageShared){var label={dom:{tag:'label',innerHtml:backstageShared.providers.translate(spec.label),classes:['tox-label']}};var comps=map$2(spec.items,backstageShared.interpreter);return{dom:{tag:'div',classes:['tox-form__group']},components:[label].concat(comps),behaviours:derive$1([ComposingConfigs.self(),Replacing.config({}),RepresentingConfigs.domHtml(Optional.none()),Keying.config({mode:'acyclic'})])};};var isSingleListItem=function isSingleListItem(item){return!has$2(item,'items');};var dataAttribute='data-value';var _fetchItems=function fetchItems(dropdownComp,name,items,selectedValue){return map$2(items,function(item){if(!isSingleListItem(item)){return{type:'nestedmenuitem',text:item.text,getSubmenuItems:function getSubmenuItems(){return _fetchItems(dropdownComp,name,item.items,selectedValue);}};}else{return{type:'togglemenuitem',text:item.text,value:item.value,active:item.value===selectedValue,onAction:function onAction(){Representing.setValue(dropdownComp,item.value);emitWith(dropdownComp,formChangeEvent,{name:name});Focusing.focus(dropdownComp);}};}});};var _findItemByValue=function findItemByValue(items,value){return findMap(items,function(item){if(!isSingleListItem(item)){return _findItemByValue(item.items,value);}else{return someIf(item.value===value,item);}});};var renderListBox=function renderListBox(spec,backstage){var providersBackstage=backstage.shared.providers;var initialItem=head(spec.items).filter(isSingleListItem);var pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage);});var pField=FormField.parts.field({dom:{},factory:{sketch:function sketch(sketchSpec){return renderCommonDropdown({uid:sketchSpec.uid,text:initialItem.map(function(item){return item.text;}),icon:Optional.none(),tooltip:spec.label,role:Optional.none(),fetch:function fetch(comp,callback){var items=_fetchItems(comp,spec.name,spec.items,Representing.getValue(comp));callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,false));},onSetup:constant$1(noop),getApi:constant$1({}),columns:1,presets:'normal',classes:[],dropdownBehaviours:[Tabstopping.config({}),Representing.config({store:{mode:'manual',initialValue:initialItem.map(function(item){return item.value;}).getOr(''),getValue:function getValue(comp){return get$d(comp.element,dataAttribute);},setValue:function setValue(comp,data){_findItemByValue(spec.items,data).each(function(item){set$8(comp.element,dataAttribute,item.value);emitWith(comp,updateMenuText,{text:item.text});});}}})]},'tox-listbox',backstage.shared);}}});var listBoxWrap={dom:{tag:'div',classes:['tox-listboxfield']},components:[pField]};return FormField.sketch({dom:{tag:'div',classes:['tox-form__group']},components:flatten([pLabel.toArray(),[listBoxWrap]]),fieldBehaviours:derive$1([Disabling.config({disabled:constant$1(spec.disabled),onDisabled:function onDisabled(comp){FormField.getField(comp).each(Disabling.disable);},onEnabled:function onEnabled(comp){FormField.getField(comp).each(Disabling.enable);}})])});};var renderPanel=function renderPanel(spec,backstage){return{dom:{tag:'div',classes:spec.classes},components:map$2(spec.items,backstage.shared.interpreter)};};var factory$e=function factory$e(detail,_spec){var options=map$2(detail.options,function(option){return{dom:{tag:'option',value:option.value,innerHtml:option.text}};});var initialValues=detail.data.map(function(v){return wrap$1('initialValue',v);}).getOr({});return{uid:detail.uid,dom:{tag:'select',classes:detail.selectClasses,attributes:detail.selectAttributes},components:options,behaviours:augment(detail.selectBehaviours,[Focusing.config({}),Representing.config({store:_assign({mode:'manual',getValue:function getValue(select){return get$5(select.element);},setValue:function setValue(select,newValue){var found=find$5(detail.options,function(opt){return opt.value===newValue;});if(found.isSome()){set$4(select.element,newValue);}}},initialValues)})])};};var HtmlSelect=single({name:'HtmlSelect',configFields:[required$1('options'),field('selectBehaviours',[Focusing,Representing]),defaulted('selectClasses',[]),defaulted('selectAttributes',{}),option('data')],factory:factory$e});var renderSelectBox=function renderSelectBox(spec,providersBackstage){var translatedOptions=map$2(spec.items,function(item){return{text:providersBackstage.translate(item.text),value:item.value};});var pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage);});var pField=FormField.parts.field({dom:{},selectAttributes:{size:spec.size},options:translatedOptions,factory:HtmlSelect,selectBehaviours:derive$1([Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();}}),Tabstopping.config({}),config('selectbox-change',[run$1(change(),function(component,_){emitWith(component,formChangeEvent,{name:spec.name});})])])});var chevron=spec.size>1?Optional.none():Optional.some(render$3('chevron-down',{tag:'div',classes:['tox-selectfield__icon-js']},providersBackstage.icons));var selectWrap={dom:{tag:'div',classes:['tox-selectfield']},components:flatten([[pField],chevron.toArray()])};return FormField.sketch({dom:{tag:'div',classes:['tox-form__group']},components:flatten([pLabel.toArray(),[selectWrap]]),fieldBehaviours:derive$1([Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();},onDisabled:function onDisabled(comp){FormField.getField(comp).each(Disabling.disable);},onEnabled:function onEnabled(comp){FormField.getField(comp).each(Disabling.enable);}}),receivingConfig()])});};var renderTable=function renderTable(spec,providersBackstage){var renderTh=function renderTh(text){return{dom:{tag:'th',innerHtml:providersBackstage.translate(text)}};};var renderHeader=function renderHeader(header){return{dom:{tag:'thead'},components:[{dom:{tag:'tr'},components:map$2(header,renderTh)}]};};var renderTd=function renderTd(text){return{dom:{tag:'td',innerHtml:providersBackstage.translate(text)}};};var renderTr=function renderTr(row){return{dom:{tag:'tr'},components:map$2(row,renderTd)};};var renderRows=function renderRows(rows){return{dom:{tag:'tbody'},components:map$2(rows,renderTr)};};return{dom:{tag:'table',classes:['tox-dialog__table']},components:[renderHeader(spec.header),renderRows(spec.cells)],behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])};};var renderTextField=function renderTextField(spec,providersBackstage){var pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage);});var baseInputBehaviours=[Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();}}),receivingConfig(),Keying.config({mode:'execution',useEnter:spec.multiline!==true,useControlEnter:spec.multiline===true,execute:function execute(comp){emit(comp,formSubmitEvent);return Optional.some(true);}}),config('textfield-change',[run$1(input(),function(component,_){emitWith(component,formChangeEvent,{name:spec.name});}),run$1(postPaste(),function(component,_){emitWith(component,formChangeEvent,{name:spec.name});})]),Tabstopping.config({})];var validatingBehaviours=spec.validation.map(function(vl){return Invalidating.config({getRoot:function getRoot(input){return parent(input.element);},invalidClass:'tox-invalid',validator:{validate:function validate(input){var v=Representing.getValue(input);var result=vl.validator(v);return Future.pure(result===true?Result.value(v):Result.error(result));},validateOnLoad:vl.validateOnLoad}});}).toArray();var placeholder=spec.placeholder.fold(constant$1({}),function(p){return{placeholder:providersBackstage.translate(p)};});var inputMode=spec.inputMode.fold(constant$1({}),function(mode){return{inputmode:mode};});var inputAttributes=_assign(_assign({},placeholder),inputMode);var pField=FormField.parts.field({tag:spec.multiline===true?'textarea':'input',inputAttributes:inputAttributes,inputClasses:[spec.classname],inputBehaviours:derive$1(flatten([baseInputBehaviours,validatingBehaviours])),selectOnFocus:false,factory:Input});var extraClasses=spec.flex?['tox-form__group--stretched']:[];var extraClasses2=extraClasses.concat(spec.maximized?['tox-form-group--maximize']:[]);var extraBehaviours=[Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();},onDisabled:function onDisabled(comp){FormField.getField(comp).each(Disabling.disable);},onEnabled:function onEnabled(comp){FormField.getField(comp).each(Disabling.enable);}}),receivingConfig()];return renderFormFieldWith(pLabel,pField,extraClasses2,extraBehaviours);};var renderInput=function renderInput(spec,providersBackstage){return renderTextField({name:spec.name,multiline:false,label:spec.label,inputMode:spec.inputMode,placeholder:spec.placeholder,flex:false,disabled:spec.disabled,classname:'tox-textfield',validation:Optional.none(),maximized:spec.maximized},providersBackstage);};var renderTextarea=function renderTextarea(spec,providersBackstage){return renderTextField({name:spec.name,multiline:true,label:spec.label,inputMode:Optional.none(),placeholder:spec.placeholder,flex:true,disabled:spec.disabled,classname:'tox-textarea',validation:Optional.none(),maximized:spec.maximized},providersBackstage);};var events$6=function events$6(streamConfig,streamState){var streams=streamConfig.stream.streams;var processor=streams.setup(streamConfig,streamState);return derive$2([run$1(streamConfig.event,processor),runOnDetached(function(){return streamState.cancel();})].concat(streamConfig.cancelEvent.map(function(e){return[run$1(e,function(){return streamState.cancel();})];}).getOr([])));};var ActiveStreaming=/*#__PURE__*/Object.freeze({__proto__:null,events:events$6});var throttle=function throttle(_config){var state=Cell(null);var readState=function readState(){return{timer:state.get()!==null?'set':'unset'};};var setTimer=function setTimer(t){state.set(t);};var cancel=function cancel(){var t=state.get();if(t!==null){t.cancel();}};return nu$8({readState:readState,setTimer:setTimer,cancel:cancel});};var init$9=function init$9(spec){return spec.stream.streams.state(spec);};var StreamingState=/*#__PURE__*/Object.freeze({__proto__:null,throttle:throttle,init:init$9});var setup$c=function setup$c(streamInfo,streamState){var sInfo=streamInfo.stream;var throttler=last(streamInfo.onStream,sInfo.delay);streamState.setTimer(throttler);return function(component,simulatedEvent){throttler.throttle(component,simulatedEvent);if(sInfo.stopEvent){simulatedEvent.stop();}};};var StreamingSchema=[requiredOf('stream',choose$1('mode',{throttle:[required$1('delay'),defaulted('stopEvent',true),output$1('streams',{setup:setup$c,state:throttle})]})),defaulted('event','input'),option('cancelEvent'),onStrictHandler('onStream')];var Streaming=create$8({fields:StreamingSchema,name:'streaming',active:ActiveStreaming,state:StreamingState});var setValueFromItem=function setValueFromItem(model,input,item){var itemData=Representing.getValue(item);Representing.setValue(input,itemData);setCursorAtEnd(input);};var setSelectionOn=function setSelectionOn(input,f){var el=input.element;var value=get$5(el);var node=el.dom;if(get$d(el,'type')!=='number'){f(node,value);}};var setCursorAtEnd=function setCursorAtEnd(input){setSelectionOn(input,function(node,value){return node.setSelectionRange(value.length,value.length);});};var setSelectionToEnd=function setSelectionToEnd(input,startOffset){setSelectionOn(input,function(node,value){return node.setSelectionRange(startOffset,value.length);});};var attemptSelectOver=function attemptSelectOver(model,input,item){if(!model.selectsOver){return Optional.none();}else{var currentValue=Representing.getValue(input);var inputDisplay_1=model.getDisplayText(currentValue);var itemValue=Representing.getValue(item);var itemDisplay=model.getDisplayText(itemValue);return itemDisplay.indexOf(inputDisplay_1)===0?Optional.some(function(){setValueFromItem(model,input,item);setSelectionToEnd(input,inputDisplay_1.length);}):Optional.none();}};var itemExecute=constant$1('alloy.typeahead.itemexecute');var make$3=function make$3(detail,components,spec,externals){var navigateList=function navigateList(comp,simulatedEvent,highlighter){detail.previewing.set(false);var sandbox=Coupling.getCoupled(comp,'sandbox');if(Sandboxing.isOpen(sandbox)){Composing.getCurrent(sandbox).each(function(menu){Highlighting.getHighlighted(menu).fold(function(){highlighter(menu);},function(){dispatchEvent(sandbox,menu.element,'keydown',simulatedEvent);});});}else{var onOpenSync=function onOpenSync(sandbox){Composing.getCurrent(sandbox).each(highlighter);};open(detail,mapFetch(comp),comp,sandbox,externals,onOpenSync,HighlightOnOpen.HighlightFirst).get(noop);}};var focusBehaviours$1=focusBehaviours(detail);var mapFetch=function mapFetch(comp){return function(tdata){return tdata.map(function(data){var menus=values(data.menus);var items=bind$3(menus,function(menu){return filter$2(menu.items,function(item){return item.type==='item';});});var repState=Representing.getState(comp);repState.update(map$2(items,function(item){return item.data;}));return data;});};};var behaviours=[Focusing.config({}),Representing.config({onSetValue:detail.onSetValue,store:_assign({mode:'dataset',getDataKey:function getDataKey(comp){return get$5(comp.element);},getFallbackEntry:function getFallbackEntry(itemString){return{value:itemString,meta:{}};},setValue:function setValue(comp,data){set$4(comp.element,detail.model.getDisplayText(data));}},detail.initialData.map(function(d){return wrap$1('initialValue',d);}).getOr({}))}),Streaming.config({stream:{mode:'throttle',delay:detail.responseTime,stopEvent:false},onStream:function onStream(component,_simulatedEvent){var sandbox=Coupling.getCoupled(component,'sandbox');var focusInInput=Focusing.isFocused(component);if(focusInInput){if(get$5(component.element).length>=detail.minChars){var previousValue_1=Composing.getCurrent(sandbox).bind(function(menu){return Highlighting.getHighlighted(menu).map(Representing.getValue);});detail.previewing.set(true);var onOpenSync=function onOpenSync(_sandbox){Composing.getCurrent(sandbox).each(function(menu){previousValue_1.fold(function(){if(detail.model.selectsOver){Highlighting.highlightFirst(menu);}},function(pv){Highlighting.highlightBy(menu,function(item){var itemData=Representing.getValue(item);return itemData.value===pv.value;});Highlighting.getHighlighted(menu).orThunk(function(){Highlighting.highlightFirst(menu);return Optional.none();});});});};open(detail,mapFetch(component),component,sandbox,externals,onOpenSync,HighlightOnOpen.HighlightFirst).get(noop);}}},cancelEvent:typeaheadCancel()}),Keying.config({mode:'special',onDown:function onDown(comp,simulatedEvent){navigateList(comp,simulatedEvent,Highlighting.highlightFirst);return Optional.some(true);},onEscape:function onEscape(comp){var sandbox=Coupling.getCoupled(comp,'sandbox');if(Sandboxing.isOpen(sandbox)){Sandboxing.close(sandbox);return Optional.some(true);}return Optional.none();},onUp:function onUp(comp,simulatedEvent){navigateList(comp,simulatedEvent,Highlighting.highlightLast);return Optional.some(true);},onEnter:function onEnter(comp){var sandbox=Coupling.getCoupled(comp,'sandbox');var sandboxIsOpen=Sandboxing.isOpen(sandbox);if(sandboxIsOpen&&!detail.previewing.get()){return Composing.getCurrent(sandbox).bind(function(menu){return Highlighting.getHighlighted(menu);}).map(function(item){emitWith(comp,itemExecute(),{item:item});return true;});}else{var currentValue=Representing.getValue(comp);emit(comp,typeaheadCancel());detail.onExecute(sandbox,comp,currentValue);if(sandboxIsOpen){Sandboxing.close(sandbox);}return Optional.some(true);}}}),Toggling.config({toggleClass:detail.markers.openClass,aria:{mode:'expanded'}}),Coupling.config({others:{sandbox:function sandbox(hotspot){return makeSandbox$1(detail,hotspot,{onOpen:function onOpen(){return Toggling.on(hotspot);},onClose:function onClose(){return Toggling.off(hotspot);}});}}}),config('typeaheadevents',[runOnExecute$1(function(comp){var onOpenSync=noop;togglePopup(detail,mapFetch(comp),comp,externals,onOpenSync,HighlightOnOpen.HighlightFirst).get(noop);}),run$1(itemExecute(),function(comp,se){var sandbox=Coupling.getCoupled(comp,'sandbox');setValueFromItem(detail.model,comp,se.event.item);emit(comp,typeaheadCancel());detail.onItemExecute(comp,sandbox,se.event.item,Representing.getValue(comp));Sandboxing.close(sandbox);setCursorAtEnd(comp);})].concat(detail.dismissOnBlur?[run$1(postBlur(),function(typeahead){var sandbox=Coupling.getCoupled(typeahead,'sandbox');if(search(sandbox.element).isNone()){Sandboxing.close(sandbox);}})]:[]))];return{uid:detail.uid,dom:dom(deepMerge(detail,{inputAttributes:{'role':'combobox','aria-autocomplete':'list','aria-haspopup':'true'}})),behaviours:_assign(_assign({},focusBehaviours$1),augment(detail.typeaheadBehaviours,behaviours)),eventOrder:detail.eventOrder};};var schema$g=constant$1([option('lazySink'),required$1('fetch'),defaulted('minChars',5),defaulted('responseTime',1000),onHandler('onOpen'),defaulted('getHotspot',Optional.some),defaulted('getAnchorOverrides',constant$1({})),defaulted('layouts',Optional.none()),defaulted('eventOrder',{}),defaultedObjOf('model',{},[defaulted('getDisplayText',function(itemData){return itemData.meta!==undefined&&itemData.meta.text!==undefined?itemData.meta.text:itemData.value;}),defaulted('selectsOver',true),defaulted('populateFromBrowse',true)]),onHandler('onSetValue'),onKeyboardHandler('onExecute'),onHandler('onItemExecute'),defaulted('inputClasses',[]),defaulted('inputAttributes',{}),defaulted('inputStyles',{}),defaulted('matchWidth',true),defaulted('useMinWidth',false),defaulted('dismissOnBlur',true),markers$1(['openClass']),option('initialData'),field('typeaheadBehaviours',[Focusing,Representing,Streaming,Keying,Toggling,Coupling]),customField('previewing',function(){return Cell(true);})].concat(schema$k()).concat(sandboxFields()));var parts$b=constant$1([external$1({schema:[tieredMenuMarkers()],name:'menu',overrides:function overrides(detail){return{fakeFocus:true,onHighlight:function onHighlight(menu,item){if(!detail.previewing.get()){menu.getSystem().getByUid(detail.uid).each(function(input){if(detail.model.populateFromBrowse){setValueFromItem(detail.model,input,item);}});}else{menu.getSystem().getByUid(detail.uid).each(function(input){attemptSelectOver(detail.model,input,item).fold(function(){return Highlighting.dehighlight(menu,item);},function(fn){return fn();});});}detail.previewing.set(false);},onExecute:function onExecute(menu,item){return menu.getSystem().getByUid(detail.uid).toOptional().map(function(typeahead){emitWith(typeahead,itemExecute(),{item:item});return true;});},onHover:function onHover(menu,item){detail.previewing.set(false);menu.getSystem().getByUid(detail.uid).each(function(input){if(detail.model.populateFromBrowse){setValueFromItem(detail.model,input,item);}});}};}})]);var Typeahead=composite({name:'Typeahead',configFields:schema$g(),partFields:parts$b(),factory:make$3});var _wrap=function wrap(delegate){var toCached=function toCached(){return _wrap(delegate.toCached());};var bindFuture=function bindFuture(f){return _wrap(delegate.bind(function(resA){return resA.fold(function(err){return Future.pure(Result.error(err));},function(a){return f(a);});}));};var bindResult=function bindResult(f){return _wrap(delegate.map(function(resA){return resA.bind(f);}));};var mapResult=function mapResult(f){return _wrap(delegate.map(function(resA){return resA.map(f);}));};var mapError=function mapError(f){return _wrap(delegate.map(function(resA){return resA.mapError(f);}));};var foldResult=function foldResult(whenError,whenValue){return delegate.map(function(res){return res.fold(whenError,whenValue);});};var withTimeout=function withTimeout(timeout,errorThunk){return _wrap(Future.nu(function(callback){var timedOut=false;var timer=setTimeout(function(){timedOut=true;callback(Result.error(errorThunk()));},timeout);delegate.get(function(result){if(!timedOut){clearTimeout(timer);callback(result);}});}));};return _assign(_assign({},delegate),{toCached:toCached,bindFuture:bindFuture,bindResult:bindResult,mapResult:mapResult,mapError:mapError,foldResult:foldResult,withTimeout:withTimeout});};var nu$1=function nu$1(worker){return _wrap(Future.nu(worker));};var value=function value(_value2){return _wrap(Future.pure(Result.value(_value2)));};var error=function error(_error){return _wrap(Future.pure(Result.error(_error)));};var fromResult=function fromResult(result){return _wrap(Future.pure(result));};var fromFuture=function fromFuture(future){return _wrap(future.map(Result.value));};var fromPromise=function fromPromise(promise){return nu$1(function(completer){promise.then(function(value){completer(Result.value(value));},function(error){completer(Result.error(error));});});};var FutureResult={nu:nu$1,wrap:_wrap,pure:value,value:value,error:error,fromResult:fromResult,fromFuture:fromFuture,fromPromise:fromPromise};var separator$1={type:'separator'};var toMenuItem=function toMenuItem(target){return{type:'menuitem',value:target.url,text:target.title,meta:{attach:target.attach},onAction:noop};};var staticMenuItem=function staticMenuItem(title,url){return{type:'menuitem',value:url,text:title,meta:{attach:undefined},onAction:noop};};var toMenuItems=function toMenuItems(targets){return map$2(targets,toMenuItem);};var filterLinkTargets=function filterLinkTargets(type,targets){return filter$2(targets,function(target){return target.type===type;});};var filteredTargets=function filteredTargets(type,targets){return toMenuItems(filterLinkTargets(type,targets));};var headerTargets=function headerTargets(linkInfo){return filteredTargets('header',linkInfo.targets);};var anchorTargets=function anchorTargets(linkInfo){return filteredTargets('anchor',linkInfo.targets);};var anchorTargetTop=function anchorTargetTop(linkInfo){return Optional.from(linkInfo.anchorTop).map(function(url){return staticMenuItem('<top>',url);}).toArray();};var anchorTargetBottom=function anchorTargetBottom(linkInfo){return Optional.from(linkInfo.anchorBottom).map(function(url){return staticMenuItem('<bottom>',url);}).toArray();};var historyTargets=function historyTargets(history){return map$2(history,function(url){return staticMenuItem(url,url);});};var joinMenuLists=function joinMenuLists(items){return foldl(items,function(a,b){var bothEmpty=a.length===0||b.length===0;return bothEmpty?a.concat(b):a.concat(separator$1,b);},[]);};var filterByQuery=function filterByQuery(term,menuItems){var lowerCaseTerm=term.toLowerCase();return filter$2(menuItems,function(item){var text=item.meta!==undefined&&item.meta.text!==undefined?item.meta.text:item.text;return contains$1(text.toLowerCase(),lowerCaseTerm)||contains$1(item.value.toLowerCase(),lowerCaseTerm);});};var getItems=function getItems(fileType,input,urlBackstage){var urlInputValue=Representing.getValue(input);var term=urlInputValue.meta.text!==undefined?urlInputValue.meta.text:urlInputValue.value;var info=urlBackstage.getLinkInformation();return info.fold(function(){return[];},function(linkInfo){var history=filterByQuery(term,historyTargets(urlBackstage.getHistory(fileType)));return fileType==='file'?joinMenuLists([history,filterByQuery(term,headerTargets(linkInfo)),filterByQuery(term,flatten([anchorTargetTop(linkInfo),anchorTargets(linkInfo),anchorTargetBottom(linkInfo)]))]):history;});};var errorId=generate$6('aria-invalid');var renderUrlInput=function renderUrlInput(spec,backstage,urlBackstage){var _a;var providersBackstage=backstage.shared.providers;var updateHistory=function updateHistory(component){var urlEntry=Representing.getValue(component);urlBackstage.addToHistory(urlEntry.value,spec.filetype);};var pField=FormField.parts.field({factory:Typeahead,dismissOnBlur:true,inputClasses:['tox-textfield'],sandboxClasses:['tox-dialog__popups'],inputAttributes:{'aria-errormessage':errorId,'type':'url'},minChars:0,responseTime:0,fetch:function fetch(input){var items=getItems(spec.filetype,input,urlBackstage);var tdata=build(items,ItemResponse$1.BUBBLE_TO_SANDBOX,backstage,false);return Future.pure(tdata);},getHotspot:function getHotspot(comp){return memUrlBox.getOpt(comp);},onSetValue:function onSetValue(comp,_newValue){if(comp.hasConfigured(Invalidating)){Invalidating.run(comp).get(noop);}},typeaheadBehaviours:derive$1(flatten([urlBackstage.getValidationHandler().map(function(handler){return Invalidating.config({getRoot:function getRoot(comp){return parent(comp.element);},invalidClass:'tox-control-wrap--status-invalid',notify:{onInvalid:function onInvalid(comp,err){memInvalidIcon.getOpt(comp).each(function(invalidComp){set$8(invalidComp.element,'title',providersBackstage.translate(err));});}},validator:{validate:function validate(input){var urlEntry=Representing.getValue(input);return FutureResult.nu(function(completer){handler({type:spec.filetype,url:urlEntry.value},function(validation){if(validation.status==='invalid'){var err=Result.error(validation.message);completer(err);}else{var val=Result.value(validation.message);completer(val);}});});},validateOnLoad:false}});}).toArray(),[Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();}}),Tabstopping.config({}),config('urlinput-events',flatten([spec.filetype==='file'?[run$1(input(),function(comp){emitWith(comp,formChangeEvent,{name:spec.name});})]:[],[run$1(change(),function(comp){emitWith(comp,formChangeEvent,{name:spec.name});updateHistory(comp);}),run$1(postPaste(),function(comp){emitWith(comp,formChangeEvent,{name:spec.name});updateHistory(comp);})]]))]])),eventOrder:(_a={},_a[input()]=['streaming','urlinput-events','invalidating'],_a),model:{getDisplayText:function getDisplayText(itemData){return itemData.value;},selectsOver:false,populateFromBrowse:false},markers:{openClass:'tox-textfield--popup-open'},lazySink:backstage.shared.getSink,parts:{menu:part(false,1,'normal')},onExecute:function onExecute(_menu,component,_entry){emitWith(component,formSubmitEvent,{});},onItemExecute:function onItemExecute(typeahead,_sandbox,_item,_value){updateHistory(typeahead);emitWith(typeahead,formChangeEvent,{name:spec.name});}});var pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage);});var makeIcon=function makeIcon(name,errId,icon,label){if(icon===void 0){icon=name;}if(label===void 0){label=name;}return render$3(icon,{tag:'div',classes:['tox-icon','tox-control-wrap__status-icon-'+name],attributes:_assign({'title':providersBackstage.translate(label),'aria-live':'polite'},errId.fold(function(){return{};},function(id){return{id:id};}))},providersBackstage.icons);};var memInvalidIcon=record(makeIcon('invalid',Optional.some(errorId),'warning'));var memStatus=record({dom:{tag:'div',classes:['tox-control-wrap__status-icon-wrap']},components:[memInvalidIcon.asSpec()]});var optUrlPicker=urlBackstage.getUrlPicker(spec.filetype);var browseUrlEvent=generate$6('browser.url.event');var memUrlBox=record({dom:{tag:'div',classes:['tox-control-wrap']},components:[pField,memStatus.asSpec()],behaviours:derive$1([Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();}})])});var memUrlPickerButton=record(renderButton({name:spec.name,icon:Optional.some('browse'),text:spec.label.getOr(''),disabled:spec.disabled,primary:false,borderless:true},function(component){return emit(component,browseUrlEvent);},providersBackstage,[],['tox-browse-url']));var controlHWrapper=function controlHWrapper(){return{dom:{tag:'div',classes:['tox-form__controls-h-stack']},components:flatten([[memUrlBox.asSpec()],optUrlPicker.map(function(){return memUrlPickerButton.asSpec();}).toArray()])};};var openUrlPicker=function openUrlPicker(comp){Composing.getCurrent(comp).each(function(field){var componentData=Representing.getValue(field);var urlData=_assign({fieldname:spec.name},componentData);optUrlPicker.each(function(picker){picker(urlData).get(function(chosenData){Representing.setValue(field,chosenData);emitWith(comp,formChangeEvent,{name:spec.name});});});});};return FormField.sketch({dom:renderFormFieldDom(),components:pLabel.toArray().concat([controlHWrapper()]),fieldBehaviours:derive$1([Disabling.config({disabled:function disabled(){return spec.disabled||providersBackstage.isDisabled();},onDisabled:function onDisabled(comp){FormField.getField(comp).each(Disabling.disable);memUrlPickerButton.getOpt(comp).each(Disabling.disable);},onEnabled:function onEnabled(comp){FormField.getField(comp).each(Disabling.enable);memUrlPickerButton.getOpt(comp).each(Disabling.enable);}}),receivingConfig(),config('url-input-events',[run$1(browseUrlEvent,openUrlPicker)])])});};var renderAlertBanner=function renderAlertBanner(spec,providersBackstage){return Container.sketch({dom:{tag:'div',attributes:{role:'alert'},classes:['tox-notification','tox-notification--in','tox-notification--'+spec.level]},components:[{dom:{tag:'div',classes:['tox-notification__icon']},components:[Button.sketch({dom:{tag:'button',classes:['tox-button','tox-button--naked','tox-button--icon'],innerHtml:get$1(spec.icon,providersBackstage.icons),attributes:{title:providersBackstage.translate(spec.iconTooltip)}},action:function action(comp){emitWith(comp,formActionEvent,{name:'alert-banner',value:spec.url});},buttonBehaviours:derive$1([addFocusableBehaviour()])})]},{dom:{tag:'div',classes:['tox-notification__body'],innerHtml:providersBackstage.translate(spec.text)}}]});};var renderCheckbox=function renderCheckbox(spec,providerBackstage){var repBehaviour=Representing.config({store:{mode:'manual',getValue:function getValue(comp){var el=comp.element.dom;return el.checked;},setValue:function setValue(comp,value){var el=comp.element.dom;el.checked=value;}}});var toggleCheckboxHandler=function toggleCheckboxHandler(comp){comp.element.dom.click();return Optional.some(true);};var pField=FormField.parts.field({factory:{sketch:identity$1},dom:{tag:'input',classes:['tox-checkbox__input'],attributes:{type:'checkbox'}},behaviours:derive$1([ComposingConfigs.self(),Disabling.config({disabled:function disabled(){return spec.disabled||providerBackstage.isDisabled();}}),Tabstopping.config({}),Focusing.config({}),repBehaviour,Keying.config({mode:'special',onEnter:toggleCheckboxHandler,onSpace:toggleCheckboxHandler,stopSpaceKeyup:true}),config('checkbox-events',[run$1(change(),function(component,_){emitWith(component,formChangeEvent,{name:spec.name});})])])});var pLabel=FormField.parts.label({dom:{tag:'span',classes:['tox-checkbox__label'],innerHtml:providerBackstage.translate(spec.label)},behaviours:derive$1([Unselecting.config({})])});var makeIcon=function makeIcon(className){var iconName=className==='checked'?'selected':'unselected';return render$3(iconName,{tag:'span',classes:['tox-icon','tox-checkbox-icon__'+className]},providerBackstage.icons);};var memIcons=record({dom:{tag:'div',classes:['tox-checkbox__icons']},components:[makeIcon('checked'),makeIcon('unchecked')]});return FormField.sketch({dom:{tag:'label',classes:['tox-checkbox']},components:[pField,memIcons.asSpec(),pLabel],fieldBehaviours:derive$1([Disabling.config({disabled:function disabled(){return spec.disabled||providerBackstage.isDisabled();},disableClass:'tox-checkbox--disabled',onDisabled:function onDisabled(comp){FormField.getField(comp).each(Disabling.disable);},onEnabled:function onEnabled(comp){FormField.getField(comp).each(Disabling.enable);}}),receivingConfig()])});};var renderHtmlPanel=function renderHtmlPanel(spec){if(spec.presets==='presentation'){return Container.sketch({dom:{tag:'div',classes:['tox-form__group'],innerHtml:spec.html}});}else{return Container.sketch({dom:{tag:'div',classes:['tox-form__group'],innerHtml:spec.html,attributes:{role:'document'}},containerBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])});}};var make$2=function make$2(render){return function(parts,spec,backstage){return get$e(spec,'name').fold(function(){return render(spec,backstage);},function(fieldName){return parts.field(fieldName,render(spec,backstage));});};};var makeIframe=function makeIframe(render){return function(parts,spec,backstage){var iframeSpec=deepMerge(spec,{source:'dynamic'});return make$2(render)(parts,iframeSpec,backstage);};};var factories={bar:make$2(function(spec,backstage){return renderBar(spec,backstage.shared);}),collection:make$2(function(spec,backstage){return renderCollection(spec,backstage.shared.providers);}),alertbanner:make$2(function(spec,backstage){return renderAlertBanner(spec,backstage.shared.providers);}),input:make$2(function(spec,backstage){return renderInput(spec,backstage.shared.providers);}),textarea:make$2(function(spec,backstage){return renderTextarea(spec,backstage.shared.providers);}),label:make$2(function(spec,backstage){return renderLabel(spec,backstage.shared);}),iframe:makeIframe(function(spec,backstage){return renderIFrame(spec,backstage.shared.providers);}),button:make$2(function(spec,backstage){return renderDialogButton(spec,backstage.shared.providers);}),checkbox:make$2(function(spec,backstage){return renderCheckbox(spec,backstage.shared.providers);}),colorinput:make$2(function(spec,backstage){return renderColorInput(spec,backstage.shared,backstage.colorinput);}),colorpicker:make$2(renderColorPicker),dropzone:make$2(function(spec,backstage){return renderDropZone(spec,backstage.shared.providers);}),grid:make$2(function(spec,backstage){return renderGrid(spec,backstage.shared);}),listbox:make$2(function(spec,backstage){return renderListBox(spec,backstage);}),selectbox:make$2(function(spec,backstage){return renderSelectBox(spec,backstage.shared.providers);}),sizeinput:make$2(function(spec,backstage){return renderSizeInput(spec,backstage.shared.providers);}),urlinput:make$2(function(spec,backstage){return renderUrlInput(spec,backstage,backstage.urlinput);}),customeditor:make$2(renderCustomEditor),htmlpanel:make$2(renderHtmlPanel),imagetools:make$2(function(spec,backstage){return renderImageTools(spec,backstage.shared.providers);}),table:make$2(function(spec,backstage){return renderTable(spec,backstage.shared.providers);}),panel:make$2(function(spec,backstage){return renderPanel(spec,backstage);})};var noFormParts={field:function field(_name,spec){return spec;}};var interpretInForm=function interpretInForm(parts,spec,oldBackstage){var newBackstage=deepMerge(oldBackstage,{shared:{interpreter:function interpreter(childSpec){return interpretParts(parts,childSpec,newBackstage);}}});return interpretParts(parts,spec,newBackstage);};var interpretParts=function interpretParts(parts,spec,backstage){return get$e(factories,spec.type).fold(function(){console.error('Unknown factory type \"'+spec.type+'\", defaulting to container: ',spec);return spec;},function(factory){return factory(parts,spec,backstage);});};var interpretWithoutForm=function interpretWithoutForm(spec,backstage){var parts=noFormParts;return interpretParts(parts,spec,backstage);};var bubbleAlignments$2={valignCentre:[],alignCentre:[],alignLeft:[],alignRight:[],right:[],left:[],bottom:[],top:[]};var getInlineDialogAnchor=function getInlineDialogAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor){var bubbleSize=12;var overrides={maxHeightFunction:expandable$1()};var editableAreaAnchor=function editableAreaAnchor(){return{type:'node',root:getContentContainer(contentAreaElement()),node:Optional.from(contentAreaElement()),bubble:nu$5(bubbleSize,bubbleSize,bubbleAlignments$2),layouts:{onRtl:function onRtl(){return[northeast];},onLtr:function onLtr(){return[northwest];}},overrides:overrides};};var standardAnchor=function standardAnchor(){return{type:'hotspot',hotspot:lazyAnchorbar(),bubble:nu$5(-bubbleSize,bubbleSize,bubbleAlignments$2),layouts:{onRtl:function onRtl(){return[southeast$2];},onLtr:function onLtr(){return[southwest$2];}},overrides:overrides};};return function(){return lazyUseEditableAreaAnchor()?editableAreaAnchor():standardAnchor();};};var getBannerAnchor=function getBannerAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor){var editableAreaAnchor=function editableAreaAnchor(){return{type:'node',root:getContentContainer(contentAreaElement()),node:Optional.from(contentAreaElement()),layouts:{onRtl:function onRtl(){return[north];},onLtr:function onLtr(){return[north];}}};};var standardAnchor=function standardAnchor(){return{type:'hotspot',hotspot:lazyAnchorbar(),layouts:{onRtl:function onRtl(){return[south$2];},onLtr:function onLtr(){return[south$2];}}};};return function(){return lazyUseEditableAreaAnchor()?editableAreaAnchor():standardAnchor();};};var getCursorAnchor=function getCursorAnchor(editor,bodyElement){return function(){return{type:'selection',root:bodyElement(),getSelection:function getSelection(){var rng=editor.selection.getRng();return Optional.some(SimSelection.range(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset));}};};};var getNodeAnchor$1=function getNodeAnchor$1(bodyElement){return function(element){return{type:'node',root:bodyElement(),node:element};};};var getAnchors=function getAnchors(editor,lazyAnchorbar,isToolbarTop){var useFixedToolbarContainer=useFixedContainer(editor);var bodyElement=function bodyElement(){return SugarElement.fromDom(editor.getBody());};var contentAreaElement=function contentAreaElement(){return SugarElement.fromDom(editor.getContentAreaContainer());};var lazyUseEditableAreaAnchor=function lazyUseEditableAreaAnchor(){return useFixedToolbarContainer||!isToolbarTop();};return{inlineDialog:getInlineDialogAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),banner:getBannerAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),cursor:getCursorAnchor(editor,bodyElement),node:getNodeAnchor$1(bodyElement)};};var colorPicker=function colorPicker(editor){return function(callback,value){var dialog=colorPickerDialog(editor);dialog(callback,value);};};var hasCustomColors=function hasCustomColors(editor){return function(){return hasCustomColors$1(editor);};};var getColors=function getColors(editor){return function(){return getColors$2(editor);};};var getColorCols=function getColorCols(editor){return function(){return getColorCols$1(editor);};};var ColorInputBackstage=function ColorInputBackstage(editor){return{colorPicker:colorPicker(editor),hasCustomColors:hasCustomColors(editor),getColors:getColors(editor),getColorCols:getColorCols(editor)};};var isDraggableModal=function isDraggableModal(editor){return function(){return isDraggableModal$1(editor);};};var DialogBackstage=function DialogBackstage(editor){return{isDraggableModal:isDraggableModal(editor)};};var HeaderBackstage=function HeaderBackstage(editor){var mode=Cell(isToolbarLocationBottom(editor)?'bottom':'top');return{isPositionedAtTop:function isPositionedAtTop(){return mode.get()==='top';},getDockingMode:mode.get,setDockingMode:mode.set};};var defaultStyleFormats=[{title:'Headings',items:[{title:'Heading 1',format:'h1'},{title:'Heading 2',format:'h2'},{title:'Heading 3',format:'h3'},{title:'Heading 4',format:'h4'},{title:'Heading 5',format:'h5'},{title:'Heading 6',format:'h6'}]},{title:'Inline',items:[{title:'Bold',format:'bold'},{title:'Italic',format:'italic'},{title:'Underline',format:'underline'},{title:'Strikethrough',format:'strikethrough'},{title:'Superscript',format:'superscript'},{title:'Subscript',format:'subscript'},{title:'Code',format:'code'}]},{title:'Blocks',items:[{title:'Paragraph',format:'p'},{title:'Blockquote',format:'blockquote'},{title:'Div',format:'div'},{title:'Pre',format:'pre'}]},{title:'Align',items:[{title:'Left',format:'alignleft'},{title:'Center',format:'aligncenter'},{title:'Right',format:'alignright'},{title:'Justify',format:'alignjustify'}]}];var isNestedFormat=function isNestedFormat(format){return has$2(format,'items');};var isBlockFormat=function isBlockFormat(format){return has$2(format,'block');};var isInlineFormat=function isInlineFormat(format){return has$2(format,'inline');};var isSelectorFormat=function isSelectorFormat(format){return has$2(format,'selector');};var _mapFormats=function mapFormats(userFormats){return foldl(userFormats,function(acc,fmt){if(isNestedFormat(fmt)){var result=_mapFormats(fmt.items);return{customFormats:acc.customFormats.concat(result.customFormats),formats:acc.formats.concat([{title:fmt.title,items:result.formats}])};}else if(isInlineFormat(fmt)||isBlockFormat(fmt)||isSelectorFormat(fmt)){var formatName=isString(fmt.name)?fmt.name:fmt.title.toLowerCase();var formatNameWithPrefix='custom-'+formatName;return{customFormats:acc.customFormats.concat([{name:formatNameWithPrefix,format:fmt}]),formats:acc.formats.concat([{title:fmt.title,format:formatNameWithPrefix,icon:fmt.icon}])};}else{return _assign(_assign({},acc),{formats:acc.formats.concat(fmt)});}},{customFormats:[],formats:[]});};var registerCustomFormats=function registerCustomFormats(editor,userFormats){var result=_mapFormats(userFormats);var registerFormats=function registerFormats(customFormats){each$1(customFormats,function(fmt){if(!editor.formatter.has(fmt.name)){editor.formatter.register(fmt.name,fmt.format);}});};if(editor.formatter){registerFormats(result.customFormats);}else{editor.on('init',function(){registerFormats(result.customFormats);});}return result.formats;};var getStyleFormats=function getStyleFormats(editor){return getUserStyleFormats(editor).map(function(userFormats){var registeredUserFormats=registerCustomFormats(editor,userFormats);return isMergeStyleFormats(editor)?defaultStyleFormats.concat(registeredUserFormats):registeredUserFormats;}).getOr(defaultStyleFormats);};var processBasic=function processBasic(item,isSelectedFor,getPreviewFor){var formatterSpec={type:'formatter',isSelected:isSelectedFor(item.format),getStylePreview:getPreviewFor(item.format)};return deepMerge(item,formatterSpec);};var register$8=function register$8(editor,formats,isSelectedFor,getPreviewFor){var enrichSupported=function enrichSupported(item){return processBasic(item,isSelectedFor,getPreviewFor);};var enrichMenu=function enrichMenu(item){var submenuSpec={type:'submenu'};return deepMerge(item,submenuSpec);};var enrichCustom=function enrichCustom(item){var formatName=isString(item.name)?item.name:generate$6(item.title);var formatNameWithPrefix='custom-'+formatName;var customSpec={type:'formatter',format:formatNameWithPrefix,isSelected:isSelectedFor(formatNameWithPrefix),getStylePreview:getPreviewFor(formatNameWithPrefix)};var newItem=deepMerge(item,customSpec);editor.formatter.register(formatName,newItem);return newItem;};var _doEnrich=function doEnrich(items){return map$2(items,function(item){var keys$1=keys(item);if(hasNonNullableKey(item,'items')){var newItems=_doEnrich(item.items);return deepMerge(enrichMenu(item),{getStyleItems:constant$1(newItems)});}else if(hasNonNullableKey(item,'format')){return enrichSupported(item);}else if(keys$1.length===1&&contains$2(keys$1,'title')){return deepMerge(item,{type:'separator'});}else{return enrichCustom(item);}});};return _doEnrich(formats);};var init$8=function init$8(editor){var isSelectedFor=function isSelectedFor(format){return function(){return editor.formatter.match(format);};};var getPreviewFor=function getPreviewFor(format){return function(){var fmt=editor.formatter.get(format);return fmt!==undefined?Optional.some({tag:fmt.length>0?fmt[0].inline||fmt[0].block||'div':'div',styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none();};};var _flatten=function flatten(fmt){var subs=fmt.items;return subs!==undefined&&subs.length>0?bind$3(subs,_flatten):[fmt.format];};var settingsFormats=Cell([]);var settingsFlattenedFormats=Cell([]);var eventsFormats=Cell([]);var eventsFlattenedFormats=Cell([]);var replaceSettings=Cell(false);editor.on('PreInit',function(_e){var formats=getStyleFormats(editor);var enriched=register$8(editor,formats,isSelectedFor,getPreviewFor);settingsFormats.set(enriched);settingsFlattenedFormats.set(bind$3(enriched,_flatten));});editor.on('addStyleModifications',function(e){var modifications=register$8(editor,e.items,isSelectedFor,getPreviewFor);eventsFormats.set(modifications);replaceSettings.set(e.replace);eventsFlattenedFormats.set(bind$3(modifications,_flatten));});var getData=function getData(){var fromSettings=replaceSettings.get()?[]:settingsFormats.get();var fromEvents=eventsFormats.get();return fromSettings.concat(fromEvents);};var getFlattenedKeys=function getFlattenedKeys(){var fromSettings=replaceSettings.get()?[]:settingsFlattenedFormats.get();var fromEvents=eventsFlattenedFormats.get();return fromSettings.concat(fromEvents);};return{getData:getData,getFlattenedKeys:getFlattenedKeys};};var isElement=function isElement(node){return isNonNullable(node)&&node.nodeType===1;};var trim=global$5.trim;var hasContentEditableState=function hasContentEditableState(value){return function(node){if(isElement(node)){if(node.contentEditable===value){return true;}if(node.getAttribute('data-mce-contenteditable')===value){return true;}}return false;};};var isContentEditableTrue=hasContentEditableState('true');var isContentEditableFalse=hasContentEditableState('false');var create=function create(type,title,url,level,attach){return{type:type,title:title,url:url,level:level,attach:attach};};var isChildOfContentEditableTrue=function isChildOfContentEditableTrue(node){while(node=node.parentNode){var value=node.contentEditable;if(value&&value!=='inherit'){return isContentEditableTrue(node);}}return false;};var select=function select(selector,root){return map$2(descendants(SugarElement.fromDom(root),selector),function(element){return element.dom;});};var getElementText=function getElementText(elm){return elm.innerText||elm.textContent;};var getOrGenerateId=function getOrGenerateId(elm){return elm.id?elm.id:generate$6('h');};var isAnchor=function isAnchor(elm){return elm&&elm.nodeName==='A'&&(elm.id||elm.name)!==undefined;};var isValidAnchor=function isValidAnchor(elm){return isAnchor(elm)&&isEditable(elm);};var isHeader=function isHeader(elm){return elm&&/^(H[1-6])$/.test(elm.nodeName);};var isEditable=function isEditable(elm){return isChildOfContentEditableTrue(elm)&&!isContentEditableFalse(elm);};var isValidHeader=function isValidHeader(elm){return isHeader(elm)&&isEditable(elm);};var getLevel=function getLevel(elm){return isHeader(elm)?parseInt(elm.nodeName.substr(1),10):0;};var headerTarget=function headerTarget(elm){var headerId=getOrGenerateId(elm);var attach=function attach(){elm.id=headerId;};return create('header',getElementText(elm),'#'+headerId,getLevel(elm),attach);};var anchorTarget=function anchorTarget(elm){var anchorId=elm.id||elm.name;var anchorText=getElementText(elm);return create('anchor',anchorText?anchorText:'#'+anchorId,'#'+anchorId,0,noop);};var getHeaderTargets=function getHeaderTargets(elms){return map$2(filter$2(elms,isValidHeader),headerTarget);};var getAnchorTargets=function getAnchorTargets(elms){return map$2(filter$2(elms,isValidAnchor),anchorTarget);};var getTargetElements=function getTargetElements(elm){var elms=select('h1,h2,h3,h4,h5,h6,a:not([href])',elm);return elms;};var hasTitle=function hasTitle(target){return trim(target.title).length>0;};var find=function find(elm){var elms=getTargetElements(elm);return filter$2(getHeaderTargets(elms).concat(getAnchorTargets(elms)),hasTitle);};var LinkTargets={find:find};var STORAGE_KEY='tinymce-url-history';var HISTORY_LENGTH=5;var isHttpUrl=function isHttpUrl(url){return isString(url)&&/^https?/.test(url);};var isArrayOfUrl=function isArrayOfUrl(a){return isArray(a)&&a.length<=HISTORY_LENGTH&&forall(a,isHttpUrl);};var isRecordOfUrlArray=function isRecordOfUrlArray(r){return isObject(r)&&find$4(r,function(value){return!isArrayOfUrl(value);}).isNone();};var getAllHistory=function getAllHistory(){var unparsedHistory=global$8.getItem(STORAGE_KEY);if(unparsedHistory===null){return{};}var history;try{history=JSON.parse(unparsedHistory);}catch(e){if(e instanceof SyntaxError){console.log('Local storage '+STORAGE_KEY+' was not valid JSON',e);return{};}throw e;}if(!isRecordOfUrlArray(history)){console.log('Local storage '+STORAGE_KEY+' was not valid format',history);return{};}return history;};var setAllHistory=function setAllHistory(history){if(!isRecordOfUrlArray(history)){throw new Error('Bad format for history:\\n'+JSON.stringify(history));}global$8.setItem(STORAGE_KEY,JSON.stringify(history));};var getHistory=function getHistory(fileType){var history=getAllHistory();return get$e(history,fileType).getOr([]);};var addToHistory=function addToHistory(url,fileType){if(!isHttpUrl(url)){return;}var history=getAllHistory();var items=get$e(history,fileType).getOr([]);var itemsWithoutUrl=filter$2(items,function(item){return item!==url;});history[fileType]=[url].concat(itemsWithoutUrl).slice(0,HISTORY_LENGTH);setAllHistory(history);};var isTruthy=function isTruthy(value){return!!value;};var makeMap=function makeMap(value){return map$1(global$5.makeMap(value,/[, ]/),isTruthy);};var getPicker=function getPicker(editor){return Optional.from(getFilePickerCallback(editor)).filter(isFunction);};var getPickerTypes=function getPickerTypes(editor){var optFileTypes=Optional.some(getFilePickerTypes(editor)).filter(isTruthy);var optLegacyTypes=Optional.some(getFileBrowserCallbackTypes(editor)).filter(isTruthy);var optTypes=optFileTypes.or(optLegacyTypes).map(makeMap);return getPicker(editor).fold(never,function(_picker){return optTypes.fold(always,function(types){return keys(types).length>0?types:false;});});};var getPickerSetting=function getPickerSetting(editor,filetype){var pickerTypes=getPickerTypes(editor);if(isBoolean(pickerTypes)){return pickerTypes?getPicker(editor):Optional.none();}else{return pickerTypes[filetype]?getPicker(editor):Optional.none();}};var _getUrlPicker=function getUrlPicker(editor,filetype){return getPickerSetting(editor,filetype).map(function(picker){return function(entry){return Future.nu(function(completer){var handler=function handler(value,meta){if(!isString(value)){throw new Error('Expected value to be string');}if(meta!==undefined&&!isObject(meta)){throw new Error('Expected meta to be a object');}var r={value:value,meta:meta};completer(r);};var meta=_assign({filetype:filetype,fieldname:entry.fieldname},Optional.from(entry.meta).getOr({}));picker.call(editor,handler,entry.value,meta);});};});};var getTextSetting=function getTextSetting(value){return Optional.from(value).filter(isString).getOrUndefined();};var _getLinkInformation=function getLinkInformation(editor){if(noTypeaheadUrls(editor)){return Optional.none();}return Optional.some({targets:LinkTargets.find(editor.getBody()),anchorTop:getTextSetting(getAnchorTop(editor)),anchorBottom:getTextSetting(getAnchorBottom(editor))});};var _getValidationHandler=function getValidationHandler(editor){return Optional.from(getFilePickerValidatorHandler(editor));};var UrlInputBackstage=function UrlInputBackstage(editor){return{getHistory:getHistory,addToHistory:addToHistory,getLinkInformation:function getLinkInformation(){return _getLinkInformation(editor);},getValidationHandler:function getValidationHandler(){return _getValidationHandler(editor);},getUrlPicker:function getUrlPicker(filetype){return _getUrlPicker(editor,filetype);}};};var init$7=function init$7(sink,editor,lazyAnchorbar){var contextMenuState=Cell(false);var toolbar=HeaderBackstage(editor);var backstage={shared:{providers:{icons:function icons(){return editor.ui.registry.getAll().icons;},menuItems:function menuItems(){return editor.ui.registry.getAll().menuItems;},translate:global$e.translate,isDisabled:function isDisabled(){return editor.mode.isReadOnly()||editor.ui.isDisabled();},getSetting:editor.getParam.bind(editor)},interpreter:function interpreter(s){return interpretWithoutForm(s,backstage);},anchors:getAnchors(editor,lazyAnchorbar,toolbar.isPositionedAtTop),header:toolbar,getSink:function getSink(){return Result.value(sink);}},urlinput:UrlInputBackstage(editor),styleselect:init$8(editor),colorinput:ColorInputBackstage(editor),dialog:DialogBackstage(editor),isContextMenuOpen:function isContextMenuOpen(){return contextMenuState.get();},setContextMenuState:function setContextMenuState(state){return contextMenuState.set(state);}};return backstage;};var setup$b=function setup$b(editor,mothership,uiMothership){var broadcastEvent=function broadcastEvent(name,evt){each$1([mothership,uiMothership],function(ship){ship.broadcastEvent(name,evt);});};var broadcastOn=function broadcastOn(channel,message){each$1([mothership,uiMothership],function(ship){ship.broadcastOn([channel],message);});};var fireDismissPopups=function fireDismissPopups(evt){return broadcastOn(dismissPopups(),{target:evt.target});};var doc=getDocument();var onTouchstart=bind(doc,'touchstart',fireDismissPopups);var onTouchmove=bind(doc,'touchmove',function(evt){return broadcastEvent(documentTouchmove(),evt);});var onTouchend=bind(doc,'touchend',function(evt){return broadcastEvent(documentTouchend(),evt);});var onMousedown=bind(doc,'mousedown',fireDismissPopups);var onMouseup=bind(doc,'mouseup',function(evt){if(evt.raw.button===0){broadcastOn(mouseReleased(),{target:evt.target});}});var onContentClick=function onContentClick(raw){return broadcastOn(dismissPopups(),{target:SugarElement.fromDom(raw.target)});};var onContentMouseup=function onContentMouseup(raw){if(raw.button===0){broadcastOn(mouseReleased(),{target:SugarElement.fromDom(raw.target)});}};var onContentMousedown=function onContentMousedown(){each$1(editor.editorManager.get(),function(loopEditor){if(editor!==loopEditor){loopEditor.fire('DismissPopups',{relatedTarget:editor});}});};var onWindowScroll=function onWindowScroll(evt){return broadcastEvent(windowScroll(),fromRawEvent(evt));};var onWindowResize=function onWindowResize(evt){broadcastOn(repositionPopups(),{});broadcastEvent(windowResize(),fromRawEvent(evt));};var onEditorResize=function onEditorResize(){return broadcastOn(repositionPopups(),{});};var onEditorProgress=function onEditorProgress(evt){if(evt.state){broadcastOn(dismissPopups(),{target:SugarElement.fromDom(editor.getContainer())});}};var onDismissPopups=function onDismissPopups(event){broadcastOn(dismissPopups(),{target:SugarElement.fromDom(event.relatedTarget.getContainer())});};editor.on('PostRender',function(){editor.on('click',onContentClick);editor.on('tap',onContentClick);editor.on('mouseup',onContentMouseup);editor.on('mousedown',onContentMousedown);editor.on('ScrollWindow',onWindowScroll);editor.on('ResizeWindow',onWindowResize);editor.on('ResizeEditor',onEditorResize);editor.on('AfterProgressState',onEditorProgress);editor.on('DismissPopups',onDismissPopups);});editor.on('remove',function(){editor.off('click',onContentClick);editor.off('tap',onContentClick);editor.off('mouseup',onContentMouseup);editor.off('mousedown',onContentMousedown);editor.off('ScrollWindow',onWindowScroll);editor.off('ResizeWindow',onWindowResize);editor.off('ResizeEditor',onEditorResize);editor.off('AfterProgressState',onEditorProgress);editor.off('DismissPopups',onDismissPopups);onMousedown.unbind();onTouchstart.unbind();onTouchmove.unbind();onTouchend.unbind();onMouseup.unbind();});editor.on('detach',function(){detachSystem(mothership);detachSystem(uiMothership);mothership.destroy();uiMothership.destroy();});};var parts$a=AlloyParts;var partType=PartType;var schema$f=constant$1([defaulted('shell',false),required$1('makeItem'),defaulted('setupItem',noop),SketchBehaviours.field('listBehaviours',[Replacing])]);var customListDetail=function customListDetail(){return{behaviours:derive$1([Replacing.config({})])};};var itemsPart=optional({name:'items',overrides:customListDetail});var parts$9=constant$1([itemsPart]);var name=constant$1('CustomList');var factory$d=function factory$d(detail,components,_spec,_external){var setItems=function setItems(list,items){getListContainer(list).fold(function(){console.error('Custom List was defined to not be a shell, but no item container was specified in components');throw new Error('Custom List was defined to not be a shell, but no item container was specified in components');},function(container){var itemComps=Replacing.contents(container);var numListsRequired=items.length;var numListsToAdd=numListsRequired-itemComps.length;var itemsToAdd=numListsToAdd>0?range$2(numListsToAdd,function(){return detail.makeItem();}):[];var itemsToRemove=itemComps.slice(numListsRequired);each$1(itemsToRemove,function(item){return Replacing.remove(container,item);});each$1(itemsToAdd,function(item){return Replacing.append(container,item);});var builtLists=Replacing.contents(container);each$1(builtLists,function(item,i){detail.setupItem(list,item,items[i],i);});});};var extra=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components:components};var getListContainer=function getListContainer(component){return detail.shell?Optional.some(component):getPart(component,detail,'items');};return{uid:detail.uid,dom:detail.dom,components:extra.components,behaviours:augment(detail.listBehaviours,extra.behaviours),apis:{setItems:setItems}};};var CustomList=composite({name:name(),configFields:schema$f(),partFields:parts$9(),factory:factory$d,apis:{setItems:function setItems(apis,list,items){apis.setItems(list,items);}}});var schema$e=constant$1([required$1('dom'),defaulted('shell',true),field('toolbarBehaviours',[Replacing])]);var enhanceGroups=function enhanceGroups(){return{behaviours:derive$1([Replacing.config({})])};};var parts$8=constant$1([optional({name:'groups',overrides:enhanceGroups})]);var factory$c=function factory$c(detail,components,_spec,_externals){var setGroups=function setGroups(toolbar,groups){getGroupContainer(toolbar).fold(function(){console.error('Toolbar was defined to not be a shell, but no groups container was specified in components');throw new Error('Toolbar was defined to not be a shell, but no groups container was specified in components');},function(container){Replacing.set(container,groups);});};var getGroupContainer=function getGroupContainer(component){return detail.shell?Optional.some(component):getPart(component,detail,'groups');};var extra=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components:components};return{uid:detail.uid,dom:detail.dom,components:extra.components,behaviours:augment(detail.toolbarBehaviours,extra.behaviours),apis:{setGroups:setGroups},domModification:{attributes:{role:'group'}}};};var Toolbar=composite({name:'Toolbar',configFields:schema$e(),partFields:parts$8(),factory:factory$c,apis:{setGroups:function setGroups(apis,toolbar,groups){apis.setGroups(toolbar,groups);}}});var setup$a=noop;var isDocked$2=never;var getBehaviours$1=constant$1([]);var StaticHeader=/*#__PURE__*/Object.freeze({__proto__:null,setup:setup$a,isDocked:isDocked$2,getBehaviours:getBehaviours$1});var getOffsetParent=function getOffsetParent(element){var isFixed=is$1(getRaw(element,'position'),'fixed');var offsetParent$1=isFixed?Optional.none():offsetParent(element);return offsetParent$1.orThunk(function(){var marker=SugarElement.fromTag('span');return parent(element).bind(function(parent){append$2(parent,marker);var offsetParent$1=offsetParent(marker);remove$5(marker);return offsetParent$1;});});};var getOrigin=function getOrigin(element){return getOffsetParent(element).map(absolute$3).getOrThunk(function(){return SugarPosition(0,0);});};var morphAdt=Adt.generate([{static:[]},{absolute:['positionCss']},{fixed:['positionCss']}]);var appear=function appear(component,contextualInfo){var elem=component.element;add$2(elem,contextualInfo.transitionClass);remove$2(elem,contextualInfo.fadeOutClass);add$2(elem,contextualInfo.fadeInClass);contextualInfo.onShow(component);};var disappear=function disappear(component,contextualInfo){var elem=component.element;add$2(elem,contextualInfo.transitionClass);remove$2(elem,contextualInfo.fadeInClass);add$2(elem,contextualInfo.fadeOutClass);contextualInfo.onHide(component);};var isPartiallyVisible=function isPartiallyVisible(box,viewport){return box.y<viewport.bottom&&box.bottom>viewport.y;};var isTopCompletelyVisible=function isTopCompletelyVisible(box,viewport){return box.y>=viewport.y;};var isBottomCompletelyVisible=function isBottomCompletelyVisible(box,viewport){return box.bottom<=viewport.bottom;};var isVisibleForModes=function isVisibleForModes(modes,box,viewport){return forall(modes,function(mode){switch(mode){case'bottom':return isBottomCompletelyVisible(box,viewport);case'top':return isTopCompletelyVisible(box,viewport);}});};var getPrior=function getPrior(elem,state){return state.getInitialPos().map(function(pos){return bounds(pos.bounds.x,pos.bounds.y,get$a(elem),get$b(elem));});};var storePrior=function storePrior(elem,box,state){state.setInitialPos({style:getAllRaw(elem),position:get$c(elem,'position')||'static',bounds:box});};var revertToOriginal=function revertToOriginal(elem,box,state){return state.getInitialPos().bind(function(position){state.clearInitialPos();switch(position.position){case'static':return Optional.some(morphAdt.static());case'absolute':var offsetBox_1=getOffsetParent(elem).map(box$1).getOrThunk(function(){return box$1(body());});return Optional.some(morphAdt.absolute(NuPositionCss('absolute',get$e(position.style,'left').map(function(_left){return box.x-offsetBox_1.x;}),get$e(position.style,'top').map(function(_top){return box.y-offsetBox_1.y;}),get$e(position.style,'right').map(function(_right){return offsetBox_1.right-box.right;}),get$e(position.style,'bottom').map(function(_bottom){return offsetBox_1.bottom-box.bottom;}))));default:return Optional.none();}});};var morphToOriginal=function morphToOriginal(elem,viewport,state){return getPrior(elem,state).filter(function(box){return isVisibleForModes(state.getModes(),box,viewport);}).bind(function(box){return revertToOriginal(elem,box,state);});};var morphToFixed=function morphToFixed(elem,viewport,state){var box=box$1(elem);if(!isVisibleForModes(state.getModes(),box,viewport)){storePrior(elem,box,state);var winBox=win();var left=box.x-winBox.x;var top_1=viewport.y-winBox.y;var bottom=winBox.bottom-viewport.bottom;var isTop=box.y<=viewport.y;return Optional.some(morphAdt.fixed(NuPositionCss('fixed',Optional.some(left),isTop?Optional.some(top_1):Optional.none(),Optional.none(),!isTop?Optional.some(bottom):Optional.none())));}else{return Optional.none();}};var getMorph=function getMorph(component,viewport,state){var elem=component.element;var isDocked=is$1(getRaw(elem,'position'),'fixed');return isDocked?morphToOriginal(elem,viewport,state):morphToFixed(elem,viewport,state);};var getMorphToOriginal=function getMorphToOriginal(component,state){var elem=component.element;return getPrior(elem,state).bind(function(box){return revertToOriginal(elem,box,state);});};var morphToStatic=function morphToStatic(component,config,state){state.setDocked(false);each$1(['left','right','top','bottom','position'],function(prop){return remove$6(component.element,prop);});config.onUndocked(component);};var morphToCoord=function morphToCoord(component,config,state,position){var isDocked=position.position==='fixed';state.setDocked(isDocked);applyPositionCss(component.element,position);var method=isDocked?config.onDocked:config.onUndocked;method(component);};var updateVisibility=function updateVisibility(component,config,state,viewport,morphToDocked){if(morphToDocked===void 0){morphToDocked=false;}config.contextual.each(function(contextInfo){contextInfo.lazyContext(component).each(function(box){var isVisible=isPartiallyVisible(box,viewport);if(isVisible!==state.isVisible()){state.setVisible(isVisible);if(morphToDocked&&!isVisible){add$1(component.element,[contextInfo.fadeOutClass]);contextInfo.onHide(component);}else{var method=isVisible?appear:disappear;method(component,contextInfo);}}});});};var refreshInternal=function refreshInternal(component,config,state){var viewport=config.lazyViewport(component);var isDocked=state.isDocked();if(isDocked){updateVisibility(component,config,state,viewport);}getMorph(component,viewport,state).each(function(morph){morph.fold(function(){return morphToStatic(component,config,state);},function(position){return morphToCoord(component,config,state,position);},function(position){updateVisibility(component,config,state,viewport,true);morphToCoord(component,config,state,position);});});};var resetInternal=function resetInternal(component,config,state){var elem=component.element;state.setDocked(false);getMorphToOriginal(component,state).each(function(morph){morph.fold(function(){return morphToStatic(component,config,state);},function(position){return morphToCoord(component,config,state,position);},noop);});state.setVisible(true);config.contextual.each(function(contextInfo){remove$1(elem,[contextInfo.fadeInClass,contextInfo.fadeOutClass,contextInfo.transitionClass]);contextInfo.onShow(component);});refresh$4(component,config,state);};var refresh$4=function refresh$4(component,config,state){if(component.getSystem().isConnected()){refreshInternal(component,config,state);}};var reset=function reset(component,config,state){if(state.isDocked()){resetInternal(component,config,state);}};var isDocked$1=function isDocked$1(component,config,state){return state.isDocked();};var setModes=function setModes(component,config,state,modes){return state.setModes(modes);};var getModes=function getModes(component,config,state){return state.getModes();};var DockingApis=/*#__PURE__*/Object.freeze({__proto__:null,refresh:refresh$4,reset:reset,isDocked:isDocked$1,getModes:getModes,setModes:setModes});var events$5=function events$5(dockInfo,dockState){return derive$2([runOnSource(transitionend(),function(component,simulatedEvent){dockInfo.contextual.each(function(contextInfo){if(has(component.element,contextInfo.transitionClass)){remove$1(component.element,[contextInfo.transitionClass,contextInfo.fadeInClass]);var notify=dockState.isVisible()?contextInfo.onShown:contextInfo.onHidden;notify(component);}simulatedEvent.stop();});}),run$1(windowScroll(),function(component,_){refresh$4(component,dockInfo,dockState);}),run$1(windowResize(),function(component,_){reset(component,dockInfo,dockState);})]);};var ActiveDocking=/*#__PURE__*/Object.freeze({__proto__:null,events:events$5});var DockingSchema=[optionObjOf('contextual',[requiredString('fadeInClass'),requiredString('fadeOutClass'),requiredString('transitionClass'),requiredFunction('lazyContext'),onHandler('onShow'),onHandler('onShown'),onHandler('onHide'),onHandler('onHidden')]),defaultedFunction('lazyViewport',win),defaultedArrayOf('modes',['top','bottom'],string),onHandler('onDocked'),onHandler('onUndocked')];var init$6=function init$6(spec){var docked=Cell(false);var visible=Cell(true);var initialBounds=value$1();var modes=Cell(spec.modes);var readState=function readState(){return'docked:  '+docked.get()+', visible: '+visible.get()+', modes: '+modes.get().join(',');};return nu$8({isDocked:docked.get,setDocked:docked.set,getInitialPos:initialBounds.get,setInitialPos:initialBounds.set,clearInitialPos:initialBounds.clear,isVisible:visible.get,setVisible:visible.set,getModes:modes.get,setModes:modes.set,readState:readState});};var DockingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$6});var Docking=create$8({fields:DockingSchema,name:'docking',active:ActiveDocking,apis:DockingApis,state:DockingState});var toolbarHeightChange=constant$1(generate$6('toolbar-height-change'));var visibility={fadeInClass:'tox-editor-dock-fadein',fadeOutClass:'tox-editor-dock-fadeout',transitionClass:'tox-editor-dock-transition'};var editorStickyOnClass='tox-tinymce--toolbar-sticky-on';var editorStickyOffClass='tox-tinymce--toolbar-sticky-off';var scrollFromBehindHeader=function scrollFromBehindHeader(e,containerHeader){var doc=owner$4(containerHeader);var viewHeight=doc.dom.defaultView.innerHeight;var scrollPos=get$9(doc);var markerElement=SugarElement.fromDom(e.elm);var markerPos=absolute$2(markerElement);var markerHeight=get$b(markerElement);var markerTop=markerPos.y;var markerBottom=markerTop+markerHeight;var editorHeaderPos=absolute$3(containerHeader);var editorHeaderHeight=get$b(containerHeader);var editorHeaderTop=editorHeaderPos.top;var editorHeaderBottom=editorHeaderTop+editorHeaderHeight;var editorHeaderDockedAtTop=Math.abs(editorHeaderTop-scrollPos.top)<2;var editorHeaderDockedAtBottom=Math.abs(editorHeaderBottom-(scrollPos.top+viewHeight))<2;if(editorHeaderDockedAtTop&&markerTop<editorHeaderBottom){to(scrollPos.left,markerTop-editorHeaderHeight,doc);}else if(editorHeaderDockedAtBottom&&markerBottom>editorHeaderTop){var y=markerTop-viewHeight+markerHeight+editorHeaderHeight;to(scrollPos.left,y,doc);}};var isDockedMode=function isDockedMode(header,mode){return contains$2(Docking.getModes(header),mode);};var updateIframeContentFlow=function updateIframeContentFlow(header){var getOccupiedHeight=function getOccupiedHeight(elm){return getOuter$2(elm)+(parseInt(get$c(elm,'margin-top'),10)||0)+(parseInt(get$c(elm,'margin-bottom'),10)||0);};var elm=header.element;parent(elm).each(function(parentElem){var padding='padding-'+Docking.getModes(header)[0];if(Docking.isDocked(header)){var parentWidth=get$a(parentElem);set$7(elm,'width',parentWidth+'px');set$7(parentElem,padding,getOccupiedHeight(elm)+'px');}else{remove$6(elm,'width');remove$6(parentElem,padding);}});};var updateSinkVisibility=function updateSinkVisibility(sinkElem,visible){if(visible){remove$2(sinkElem,visibility.fadeOutClass);add$1(sinkElem,[visibility.transitionClass,visibility.fadeInClass]);}else{remove$2(sinkElem,visibility.fadeInClass);add$1(sinkElem,[visibility.fadeOutClass,visibility.transitionClass]);}};var updateEditorClasses=function updateEditorClasses(editor,docked){var editorContainer=SugarElement.fromDom(editor.getContainer());if(docked){add$2(editorContainer,editorStickyOnClass);remove$2(editorContainer,editorStickyOffClass);}else{add$2(editorContainer,editorStickyOffClass);remove$2(editorContainer,editorStickyOnClass);}};var restoreFocus=function restoreFocus(headerElem,focusedElem){var ownerDoc=owner$4(focusedElem);active(ownerDoc).filter(function(activeElm){return!eq(focusedElem,activeElm);}).filter(function(activeElm){return eq(activeElm,SugarElement.fromDom(ownerDoc.dom.body))||contains(headerElem,activeElm);}).each(function(){return focus$3(focusedElem);});};var findFocusedElem=function findFocusedElem(rootElm,lazySink){return search(rootElm).orThunk(function(){return lazySink().toOptional().bind(function(sink){return search(sink.element);});});};var setup$9=function setup$9(editor,sharedBackstage,lazyHeader){if(!editor.inline){if(!sharedBackstage.header.isPositionedAtTop()){editor.on('ResizeEditor',function(){lazyHeader().each(Docking.reset);});}editor.on('ResizeWindow ResizeEditor',function(){lazyHeader().each(updateIframeContentFlow);});editor.on('SkinLoaded',function(){lazyHeader().each(function(comp){Docking.isDocked(comp)?Docking.reset(comp):Docking.refresh(comp);});});editor.on('FullscreenStateChanged',function(){lazyHeader().each(Docking.reset);});}editor.on('AfterScrollIntoView',function(e){lazyHeader().each(function(header){Docking.refresh(header);var headerElem=header.element;if(isVisible(headerElem)){scrollFromBehindHeader(e,headerElem);}});});editor.on('PostRender',function(){updateEditorClasses(editor,false);});};var isDocked=function isDocked(lazyHeader){return lazyHeader().map(Docking.isDocked).getOr(false);};var getIframeBehaviours=function getIframeBehaviours(){var _a;return[Receiving.config({channels:(_a={},_a[toolbarHeightChange()]={onReceive:updateIframeContentFlow},_a)})];};var getBehaviours=function getBehaviours(editor,sharedBackstage){var focusedElm=value$1();var lazySink=sharedBackstage.getSink;var runOnSinkElement=function runOnSinkElement(f){lazySink().each(function(sink){return f(sink.element);});};var onDockingSwitch=function onDockingSwitch(comp){if(!editor.inline){updateIframeContentFlow(comp);}updateEditorClasses(editor,Docking.isDocked(comp));comp.getSystem().broadcastOn([repositionPopups()],{});lazySink().each(function(sink){return sink.getSystem().broadcastOn([repositionPopups()],{});});};var additionalBehaviours=editor.inline?[]:getIframeBehaviours();return __spreadArray([Focusing.config({}),Docking.config({contextual:_assign({lazyContext:function lazyContext(comp){var headerHeight=getOuter$2(comp.element);var container=editor.inline?editor.getContentAreaContainer():editor.getContainer();var box=box$1(SugarElement.fromDom(container));var boxHeight=box.height-headerHeight;var topBound=box.y+(isDockedMode(comp,'top')?0:headerHeight);return Optional.some(bounds(box.x,topBound,box.width,boxHeight));},onShow:function onShow(){runOnSinkElement(function(elem){return updateSinkVisibility(elem,true);});},onShown:function onShown(comp){runOnSinkElement(function(elem){return remove$1(elem,[visibility.transitionClass,visibility.fadeInClass]);});focusedElm.get().each(function(elem){restoreFocus(comp.element,elem);focusedElm.clear();});},onHide:function onHide(comp){findFocusedElem(comp.element,lazySink).fold(focusedElm.clear,focusedElm.set);runOnSinkElement(function(elem){return updateSinkVisibility(elem,false);});},onHidden:function onHidden(){runOnSinkElement(function(elem){return remove$1(elem,[visibility.transitionClass]);});}},visibility),lazyViewport:function lazyViewport(comp){var win$1=win();var offset=getStickyToolbarOffset(editor);var top=win$1.y+(isDockedMode(comp,'top')?offset:0);var height=win$1.height-(isDockedMode(comp,'bottom')?offset:0);return bounds(win$1.x,top,win$1.width,height);},modes:[sharedBackstage.header.getDockingMode()],onDocked:onDockingSwitch,onUndocked:onDockingSwitch})],additionalBehaviours,true);};var StickyHeader=/*#__PURE__*/Object.freeze({__proto__:null,setup:setup$9,isDocked:isDocked,getBehaviours:getBehaviours});var renderHeader=function renderHeader(spec){var editor=spec.editor;var getBehaviours$2=spec.sticky?getBehaviours:getBehaviours$1;return{uid:spec.uid,dom:spec.dom,components:spec.components,behaviours:derive$1(getBehaviours$2(editor,spec.sharedBackstage))};};var groupToolbarButtonSchema=objOf([requiredString('type'),requiredOf('items',oneOf([arrOfObj([requiredString('name'),requiredArrayOf('items',string)]),string]))].concat(baseToolbarButtonFields));var createGroupToolbarButton=function createGroupToolbarButton(spec){return asRaw('GroupToolbarButton',groupToolbarButtonSchema,spec);};var baseMenuButtonFields=[optionString('text'),optionString('tooltip'),optionString('icon'),requiredFunction('fetch'),defaultedFunction('onSetup',function(){return noop;})];var MenuButtonSchema=objOf(__spreadArray([requiredString('type')],baseMenuButtonFields,true));var createMenuButton=function createMenuButton(spec){return asRaw('menubutton',MenuButtonSchema,spec);};var splitButtonSchema=objOf([requiredString('type'),optionString('tooltip'),optionString('icon'),optionString('text'),optionFunction('select'),requiredFunction('fetch'),defaultedFunction('onSetup',function(){return noop;}),defaultedStringEnum('presets','normal',['normal','color','listpreview']),defaulted('columns',1),requiredFunction('onAction'),requiredFunction('onItemAction')]);var createSplitButton=function createSplitButton(spec){return asRaw('SplitButton',splitButtonSchema,spec);};var factory$b=function factory$b(detail,spec){var setMenus=function setMenus(comp,menus){var newMenus=map$2(menus,function(m){var buttonSpec={type:'menubutton',text:m.text,fetch:function fetch(callback){callback(m.getItems());}};var internal=createMenuButton(buttonSpec).mapError(function(errInfo){return formatError(errInfo);}).getOrDie();return renderMenuButton(internal,'tox-mbtn',spec.backstage,Optional.some('menuitem'));});Replacing.set(comp,newMenus);};var apis={focus:Keying.focusIn,setMenus:setMenus};return{uid:detail.uid,dom:detail.dom,components:[],behaviours:derive$1([Replacing.config({}),config('menubar-events',[runOnAttached(function(component){detail.onSetup(component);}),run$1(mouseover(),function(comp,se){descendant(comp.element,'.'+'tox-mbtn--active').each(function(activeButton){closest$1(se.event.target,'.'+'tox-mbtn').each(function(hoveredButton){if(!eq(activeButton,hoveredButton)){comp.getSystem().getByDom(activeButton).each(function(activeComp){comp.getSystem().getByDom(hoveredButton).each(function(hoveredComp){Dropdown.expand(hoveredComp);Dropdown.close(activeComp);Focusing.focus(hoveredComp);});});}});});}),run$1(focusShifted(),function(comp,se){se.event.prevFocus.bind(function(prev){return comp.getSystem().getByDom(prev).toOptional();}).each(function(prev){se.event.newFocus.bind(function(nu){return comp.getSystem().getByDom(nu).toOptional();}).each(function(nu){if(Dropdown.isOpen(prev)){Dropdown.expand(nu);Dropdown.close(prev);}});});})]),Keying.config({mode:'flow',selector:'.'+'tox-mbtn',onEscape:function onEscape(comp){detail.onEscape(comp);return Optional.some(true);}}),Tabstopping.config({})]),apis:apis,domModification:{attributes:{role:'menubar'}}};};var SilverMenubar=single({factory:factory$b,name:'silver.Menubar',configFields:[required$1('dom'),required$1('uid'),required$1('onEscape'),required$1('backstage'),defaulted('onSetup',noop)],apis:{focus:function focus(apis,comp){apis.focus(comp);},setMenus:function setMenus(apis,comp,menus){apis.setMenus(comp,menus);}}});var getAnimationRoot=function getAnimationRoot(component,slideConfig){return slideConfig.getAnimationRoot.fold(function(){return component.element;},function(get){return get(component);});};var getDimensionProperty=function getDimensionProperty(slideConfig){return slideConfig.dimension.property;};var getDimension=function getDimension(slideConfig,elem){return slideConfig.dimension.getDimension(elem);};var disableTransitions=function disableTransitions(component,slideConfig){var root=getAnimationRoot(component,slideConfig);remove$1(root,[slideConfig.shrinkingClass,slideConfig.growingClass]);};var setShrunk=function setShrunk(component,slideConfig){remove$2(component.element,slideConfig.openClass);add$2(component.element,slideConfig.closedClass);set$7(component.element,getDimensionProperty(slideConfig),'0px');reflow(component.element);};var setGrown=function setGrown(component,slideConfig){remove$2(component.element,slideConfig.closedClass);add$2(component.element,slideConfig.openClass);remove$6(component.element,getDimensionProperty(slideConfig));};var doImmediateShrink=function doImmediateShrink(component,slideConfig,slideState,_calculatedSize){slideState.setCollapsed();set$7(component.element,getDimensionProperty(slideConfig),getDimension(slideConfig,component.element));reflow(component.element);disableTransitions(component,slideConfig);setShrunk(component,slideConfig);slideConfig.onStartShrink(component);slideConfig.onShrunk(component);};var doStartShrink=function doStartShrink(component,slideConfig,slideState,calculatedSize){var size=calculatedSize.getOrThunk(function(){return getDimension(slideConfig,component.element);});slideState.setCollapsed();set$7(component.element,getDimensionProperty(slideConfig),size);reflow(component.element);var root=getAnimationRoot(component,slideConfig);remove$2(root,slideConfig.growingClass);add$2(root,slideConfig.shrinkingClass);setShrunk(component,slideConfig);slideConfig.onStartShrink(component);};var doStartSmartShrink=function doStartSmartShrink(component,slideConfig,slideState){var size=getDimension(slideConfig,component.element);var shrinker=size==='0px'?doImmediateShrink:doStartShrink;shrinker(component,slideConfig,slideState,Optional.some(size));};var doStartGrow=function doStartGrow(component,slideConfig,slideState){var root=getAnimationRoot(component,slideConfig);var wasShrinking=has(root,slideConfig.shrinkingClass);var beforeSize=getDimension(slideConfig,component.element);setGrown(component,slideConfig);var fullSize=getDimension(slideConfig,component.element);var startPartialGrow=function startPartialGrow(){set$7(component.element,getDimensionProperty(slideConfig),beforeSize);reflow(component.element);};var startCompleteGrow=function startCompleteGrow(){setShrunk(component,slideConfig);};var setStartSize=wasShrinking?startPartialGrow:startCompleteGrow;setStartSize();remove$2(root,slideConfig.shrinkingClass);add$2(root,slideConfig.growingClass);setGrown(component,slideConfig);set$7(component.element,getDimensionProperty(slideConfig),fullSize);slideState.setExpanded();slideConfig.onStartGrow(component);};var refresh$3=function refresh$3(component,slideConfig,slideState){if(slideState.isExpanded()){remove$6(component.element,getDimensionProperty(slideConfig));var fullSize=getDimension(slideConfig,component.element);set$7(component.element,getDimensionProperty(slideConfig),fullSize);}};var grow=function grow(component,slideConfig,slideState){if(!slideState.isExpanded()){doStartGrow(component,slideConfig,slideState);}};var shrink=function shrink(component,slideConfig,slideState){if(slideState.isExpanded()){doStartSmartShrink(component,slideConfig,slideState);}};var immediateShrink=function immediateShrink(component,slideConfig,slideState){if(slideState.isExpanded()){doImmediateShrink(component,slideConfig,slideState);}};var hasGrown=function hasGrown(component,slideConfig,slideState){return slideState.isExpanded();};var hasShrunk=function hasShrunk(component,slideConfig,slideState){return slideState.isCollapsed();};var isGrowing=function isGrowing(component,slideConfig,_slideState){var root=getAnimationRoot(component,slideConfig);return has(root,slideConfig.growingClass)===true;};var isShrinking=function isShrinking(component,slideConfig,_slideState){var root=getAnimationRoot(component,slideConfig);return has(root,slideConfig.shrinkingClass)===true;};var isTransitioning=function isTransitioning(component,slideConfig,slideState){return isGrowing(component,slideConfig)||isShrinking(component,slideConfig);};var toggleGrow=function toggleGrow(component,slideConfig,slideState){var f=slideState.isExpanded()?doStartSmartShrink:doStartGrow;f(component,slideConfig,slideState);};var SlidingApis=/*#__PURE__*/Object.freeze({__proto__:null,refresh:refresh$3,grow:grow,shrink:shrink,immediateShrink:immediateShrink,hasGrown:hasGrown,hasShrunk:hasShrunk,isGrowing:isGrowing,isShrinking:isShrinking,isTransitioning:isTransitioning,toggleGrow:toggleGrow,disableTransitions:disableTransitions});var exhibit=function exhibit(base,slideConfig,_slideState){var expanded=slideConfig.expanded;return expanded?nu$7({classes:[slideConfig.openClass],styles:{}}):nu$7({classes:[slideConfig.closedClass],styles:wrap$1(slideConfig.dimension.property,'0px')});};var events$4=function events$4(slideConfig,slideState){return derive$2([runOnSource(transitionend(),function(component,simulatedEvent){var raw=simulatedEvent.event.raw;if(raw.propertyName===slideConfig.dimension.property){disableTransitions(component,slideConfig);if(slideState.isExpanded()){remove$6(component.element,slideConfig.dimension.property);}var notify=slideState.isExpanded()?slideConfig.onGrown:slideConfig.onShrunk;notify(component);}})]);};var ActiveSliding=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit,events:events$4});var SlidingSchema=[required$1('closedClass'),required$1('openClass'),required$1('shrinkingClass'),required$1('growingClass'),option('getAnimationRoot'),onHandler('onShrunk'),onHandler('onStartShrink'),onHandler('onGrown'),onHandler('onStartGrow'),defaulted('expanded',false),requiredOf('dimension',choose$1('property',{width:[output$1('property','width'),output$1('getDimension',function(elem){return get$a(elem)+'px';})],height:[output$1('property','height'),output$1('getDimension',function(elem){return get$b(elem)+'px';})]}))];var init$5=function init$5(spec){var state=Cell(spec.expanded);var readState=function readState(){return'expanded: '+state.get();};return nu$8({isExpanded:function isExpanded(){return state.get()===true;},isCollapsed:function isCollapsed(){return state.get()===false;},setCollapsed:curry(state.set,false),setExpanded:curry(state.set,true),readState:readState});};var SlidingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$5});var Sliding=create$8({fields:SlidingSchema,name:'sliding',active:ActiveSliding,apis:SlidingApis,state:SlidingState});var owner='container';var schema$d=[field('slotBehaviours',[])];var getPartName=function getPartName(name){return'<alloy.field.'+name+'>';};var sketch=function sketch(sSpec){var parts=function(){var record=[];var slot=function slot(name,config){record.push(name);return generateOne$1(owner,getPartName(name),config);};return{slot:slot,record:constant$1(record)};}();var spec=sSpec(parts);var partNames=parts.record();var fieldParts=map$2(partNames,function(n){return required({name:n,pname:getPartName(n)});});return composite$1(owner,schema$d,fieldParts,make$1,spec);};var make$1=function make$1(detail,components){var getSlotNames=function getSlotNames(_){return getAllPartNames(detail);};var getSlot=function getSlot(container,key){return getPart(container,detail,key);};var onSlot=function onSlot(f,def){return function(container,key){return getPart(container,detail,key).map(function(slot){return f(slot,key);}).getOr(def);};};var onSlots=function onSlots(f){return function(container,keys){each$1(keys,function(key){return f(container,key);});};};var doShowing=function doShowing(comp,_key){return get$d(comp.element,'aria-hidden')!=='true';};var doShow=function doShow(comp,key){if(!doShowing(comp)){var element=comp.element;remove$6(element,'display');remove$7(element,'aria-hidden');emitWith(comp,slotVisibility(),{name:key,visible:true});}};var doHide=function doHide(comp,key){if(doShowing(comp)){var element=comp.element;set$7(element,'display','none');set$8(element,'aria-hidden','true');emitWith(comp,slotVisibility(),{name:key,visible:false});}};var isShowing=onSlot(doShowing,false);var hideSlot=onSlot(doHide);var hideSlots=onSlots(hideSlot);var hideAllSlots=function hideAllSlots(container){return hideSlots(container,getSlotNames());};var showSlot=onSlot(doShow);var apis={getSlotNames:getSlotNames,getSlot:getSlot,isShowing:isShowing,hideSlot:hideSlot,hideAllSlots:hideAllSlots,showSlot:showSlot};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:get$2(detail.slotBehaviours),apis:apis};};var slotApis=map$1({getSlotNames:function getSlotNames(apis,c){return apis.getSlotNames(c);},getSlot:function getSlot(apis,c,key){return apis.getSlot(c,key);},isShowing:function isShowing(apis,c,key){return apis.isShowing(c,key);},hideSlot:function hideSlot(apis,c,key){return apis.hideSlot(c,key);},hideAllSlots:function hideAllSlots(apis,c){return apis.hideAllSlots(c);},showSlot:function showSlot(apis,c,key){return apis.showSlot(c,key);}},function(value){return makeApi(value);});var SlotContainer=_assign(_assign({},slotApis),{sketch:sketch});var sidebarSchema=objOf([optionString('icon'),optionString('tooltip'),defaultedFunction('onShow',noop),defaultedFunction('onHide',noop),defaultedFunction('onSetup',function(){return noop;})]);var createSidebar=function createSidebar(spec){return asRaw('sidebar',sidebarSchema,spec);};var setup$8=function setup$8(editor){var sidebars=editor.ui.registry.getAll().sidebars;each$1(keys(sidebars),function(name){var spec=sidebars[name];var isActive=function isActive(){return is$1(Optional.from(editor.queryCommandValue('ToggleSidebar')),name);};editor.ui.registry.addToggleButton(name,{icon:spec.icon,tooltip:spec.tooltip,onAction:function onAction(buttonApi){editor.execCommand('ToggleSidebar',false,name);buttonApi.setActive(isActive());},onSetup:function onSetup(buttonApi){var handleToggle=function handleToggle(){return buttonApi.setActive(isActive());};editor.on('ToggleSidebar',handleToggle);return function(){editor.off('ToggleSidebar',handleToggle);};}});});};var getApi=function getApi(comp){return{element:function element(){return comp.element.dom;}};};var makePanels=function makePanels(parts,panelConfigs){var specs=map$2(keys(panelConfigs),function(name){var spec=panelConfigs[name];var bridged=getOrDie(createSidebar(spec));return{name:name,getApi:getApi,onSetup:bridged.onSetup,onShow:bridged.onShow,onHide:bridged.onHide};});return map$2(specs,function(spec){var editorOffCell=Cell(noop);return parts.slot(spec.name,{dom:{tag:'div',classes:['tox-sidebar__pane']},behaviours:SimpleBehaviours.unnamedEvents([onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell),run$1(slotVisibility(),function(sidepanel,se){var data=se.event;var optSidePanelSpec=find$5(specs,function(config){return config.name===data.name;});optSidePanelSpec.each(function(sidePanelSpec){var handler=data.visible?sidePanelSpec.onShow:sidePanelSpec.onHide;handler(sidePanelSpec.getApi(sidepanel));});})])});});};var makeSidebar=function makeSidebar(panelConfigs){return SlotContainer.sketch(function(parts){return{dom:{tag:'div',classes:['tox-sidebar__pane-container']},components:makePanels(parts,panelConfigs),slotBehaviours:SimpleBehaviours.unnamedEvents([runOnAttached(function(slotContainer){return SlotContainer.hideAllSlots(slotContainer);})])};});};var _setSidebar=function setSidebar(sidebar,panelConfigs){var optSlider=Composing.getCurrent(sidebar);optSlider.each(function(slider){return Replacing.set(slider,[makeSidebar(panelConfigs)]);});};var _toggleSidebar=function toggleSidebar(sidebar,name){var optSlider=Composing.getCurrent(sidebar);optSlider.each(function(slider){var optSlotContainer=Composing.getCurrent(slider);optSlotContainer.each(function(slotContainer){if(Sliding.hasGrown(slider)){if(SlotContainer.isShowing(slotContainer,name)){Sliding.shrink(slider);}else{SlotContainer.hideAllSlots(slotContainer);SlotContainer.showSlot(slotContainer,name);}}else{SlotContainer.hideAllSlots(slotContainer);SlotContainer.showSlot(slotContainer,name);Sliding.grow(slider);}});});};var _whichSidebar=function whichSidebar(sidebar){var optSlider=Composing.getCurrent(sidebar);return optSlider.bind(function(slider){var sidebarOpen=Sliding.isGrowing(slider)||Sliding.hasGrown(slider);if(sidebarOpen){var optSlotContainer=Composing.getCurrent(slider);return optSlotContainer.bind(function(slotContainer){return find$5(SlotContainer.getSlotNames(slotContainer),function(name){return SlotContainer.isShowing(slotContainer,name);});});}else{return Optional.none();}});};var fixSize=generate$6('FixSizeEvent');var autoSize=generate$6('AutoSizeEvent');var renderSidebar=function renderSidebar(spec){return{uid:spec.uid,dom:{tag:'div',classes:['tox-sidebar'],attributes:{role:'complementary'}},components:[{dom:{tag:'div',classes:['tox-sidebar__slider']},components:[],behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),Sliding.config({dimension:{property:'width'},closedClass:'tox-sidebar--sliding-closed',openClass:'tox-sidebar--sliding-open',shrinkingClass:'tox-sidebar--sliding-shrinking',growingClass:'tox-sidebar--sliding-growing',onShrunk:function onShrunk(slider){var optSlotContainer=Composing.getCurrent(slider);optSlotContainer.each(SlotContainer.hideAllSlots);emit(slider,autoSize);},onGrown:function onGrown(slider){emit(slider,autoSize);},onStartGrow:function onStartGrow(slider){emitWith(slider,fixSize,{width:getRaw(slider.element,'width').getOr('')});},onStartShrink:function onStartShrink(slider){emitWith(slider,fixSize,{width:get$a(slider.element)+'px'});}}),Replacing.config({}),Composing.config({find:function find(comp){var children=Replacing.contents(comp);return head(children);}})])}],behaviours:derive$1([ComposingConfigs.childAt(0),config('sidebar-sliding-events',[run$1(fixSize,function(comp,se){set$7(comp.element,'width',se.event.width);}),run$1(autoSize,function(comp,_se){remove$6(comp.element,'width');})])])};};var block=function block(component,config,state,getBusySpec){set$8(component.element,'aria-busy',true);var root=config.getRoot(component).getOr(component);var blockerBehaviours=derive$1([Keying.config({mode:'special',onTab:function onTab(){return Optional.some(true);},onShiftTab:function onShiftTab(){return Optional.some(true);}}),Focusing.config({})]);var blockSpec=getBusySpec(root,blockerBehaviours);var blocker=root.getSystem().build(blockSpec);Replacing.append(root,premade(blocker));if(blocker.hasConfigured(Keying)&&config.focus){Keying.focusIn(blocker);}if(!state.isBlocked()){config.onBlock(component);}state.blockWith(function(){return Replacing.remove(root,blocker);});};var unblock=function unblock(component,config,state){remove$7(component.element,'aria-busy');if(state.isBlocked()){config.onUnblock(component);}state.clear();};var BlockingApis=/*#__PURE__*/Object.freeze({__proto__:null,block:block,unblock:unblock});var BlockingSchema=[defaultedFunction('getRoot',Optional.none),defaultedBoolean('focus',true),onHandler('onBlock'),onHandler('onUnblock')];var init$4=function init$4(){var blocker=destroyable();var blockWith=function blockWith(destroy){blocker.set({destroy:destroy});};return nu$8({readState:blocker.isSet,blockWith:blockWith,clear:blocker.clear,isBlocked:blocker.isSet});};var BlockingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$4});var Blocking=create$8({fields:BlockingSchema,name:'blocking',apis:BlockingApis,state:BlockingState});var getBusySpec$1=function getBusySpec$1(providerBackstage){return function(_root,_behaviours){return{dom:{tag:'div',attributes:{'aria-label':providerBackstage.translate('Loading...'),'tabindex':'0'},classes:['tox-throbber__busy-spinner']},components:[{dom:fromHtml('<div class=\"tox-spinner\"><div></div><div></div><div></div></div>')}]};};};var focusBusyComponent=function focusBusyComponent(throbber){return Composing.getCurrent(throbber).each(function(comp){return focus$3(comp.element);});};var toggleEditorTabIndex=function toggleEditorTabIndex(editor,state){var tabIndexAttr='tabindex';var dataTabIndexAttr='data-mce-'+tabIndexAttr;Optional.from(editor.iframeElement).map(SugarElement.fromDom).each(function(iframe){if(state){getOpt(iframe,tabIndexAttr).each(function(tabIndex){return set$8(iframe,dataTabIndexAttr,tabIndex);});set$8(iframe,tabIndexAttr,-1);}else{remove$7(iframe,tabIndexAttr);getOpt(iframe,dataTabIndexAttr).each(function(tabIndex){set$8(iframe,tabIndexAttr,tabIndex);remove$7(iframe,dataTabIndexAttr);});}});};var toggleThrobber=function toggleThrobber(editor,comp,state,providerBackstage){var element=comp.element;toggleEditorTabIndex(editor,state);if(state){Blocking.block(comp,getBusySpec$1(providerBackstage));remove$6(element,'display');remove$7(element,'aria-hidden');if(editor.hasFocus()){focusBusyComponent(comp);}}else{var throbberFocus=Composing.getCurrent(comp).exists(function(busyComp){return hasFocus(busyComp.element);});Blocking.unblock(comp);set$7(element,'display','none');set$8(element,'aria-hidden','true');if(throbberFocus){editor.focus();}}};var renderThrobber=function renderThrobber(spec){return{uid:spec.uid,dom:{tag:'div',attributes:{'aria-hidden':'true'},classes:['tox-throbber'],styles:{display:'none'}},behaviours:derive$1([Replacing.config({}),Blocking.config({focus:false}),Composing.config({find:function find(comp){return head(comp.components());}})]),components:[]};};var isFocusEvent=function isFocusEvent(event){return event.type==='focusin';};var isPasteBinTarget=function isPasteBinTarget(event){if(isFocusEvent(event)){var node=event.composed?head(event.composedPath()):Optional.from(event.target);return node.map(SugarElement.fromDom).filter(isElement$2).exists(function(targetElm){return has(targetElm,'mce-pastebin');});}else{return false;}};var setup$7=function setup$7(editor,lazyThrobber,sharedBackstage){var throbberState=Cell(false);var timer=value$1();var stealFocus=function stealFocus(e){if(throbberState.get()&&!isPasteBinTarget(e)){e.preventDefault();focusBusyComponent(lazyThrobber());editor.editorManager.setActive(editor);}};if(!editor.inline){editor.on('PreInit',function(){editor.dom.bind(editor.getWin(),'focusin',stealFocus);editor.on('BeforeExecCommand',function(e){if(e.command.toLowerCase()==='mcefocus'&&e.value!==true){stealFocus(e);}});});}var toggle=function toggle(state){if(state!==throbberState.get()){throbberState.set(state);toggleThrobber(editor,lazyThrobber(),state,sharedBackstage.providers);editor.fire('AfterProgressState',{state:state});}};editor.on('ProgressState',function(e){timer.on(global$f.clearTimeout);if(isNumber(e.time)){var timerId=global$f.setEditorTimeout(editor,function(){return toggle(e.state);},e.time);timer.set(timerId);}else{toggle(e.state);timer.clear();}});};var generate$1=function generate$1(xs,f){var init={len:0,list:[]};var r=foldl(xs,function(b,a){var value=f(a,b.len);return value.fold(constant$1(b),function(v){return{len:v.finish,list:b.list.concat([v])};});},init);return r.list;};var output=function output(within,extra,withinWidth){return{within:within,extra:extra,withinWidth:withinWidth};};var apportion=function apportion(units,total,len){var parray=generate$1(units,function(unit,current){var width=len(unit);return Optional.some({element:unit,start:current,finish:current+width,width:width});});var within=filter$2(parray,function(unit){return unit.finish<=total;});var withinWidth=foldr(within,function(acc,el){return acc+el.width;},0);var extra=parray.slice(within.length);return{within:within,extra:extra,withinWidth:withinWidth};};var toUnit=function toUnit(parray){return map$2(parray,function(unit){return unit.element;});};var fitLast=function fitLast(within,extra,withinWidth){var fits=toUnit(within.concat(extra));return output(fits,[],withinWidth);};var overflow=function overflow(within,extra,overflower,withinWidth){var fits=toUnit(within).concat([overflower]);return output(fits,toUnit(extra),withinWidth);};var fitAll=function fitAll(within,extra,withinWidth){return output(toUnit(within),[],withinWidth);};var tryFit=function tryFit(total,units,len){var divide=apportion(units,total,len);return divide.extra.length===0?Optional.some(divide):Optional.none();};var partition=function partition(total,units,len,overflower){var divide=tryFit(total,units,len).getOrThunk(function(){return apportion(units,total-len(overflower),len);});var within=divide.within;var extra=divide.extra;var withinWidth=divide.withinWidth;if(extra.length===1&&extra[0].width<=len(overflower)){return fitLast(within,extra,withinWidth);}else if(extra.length>=1){return overflow(within,extra,overflower,withinWidth);}else{return fitAll(within,extra,withinWidth);}};var setGroups$1=function setGroups$1(toolbar,storedGroups){var bGroups=map$2(storedGroups,function(g){return premade(g);});Toolbar.setGroups(toolbar,bGroups);};var findFocusedComp=function findFocusedComp(comps){return findMap(comps,function(comp){return search(comp.element).bind(function(focusedElm){return comp.getSystem().getByDom(focusedElm).toOptional();});});};var refresh$2=function refresh$2(toolbar,detail,setOverflow){var builtGroups=detail.builtGroups.get();if(builtGroups.length===0){return;}var primary=getPartOrDie(toolbar,detail,'primary');var overflowGroup=Coupling.getCoupled(toolbar,'overflowGroup');set$7(primary.element,'visibility','hidden');var groups=builtGroups.concat([overflowGroup]);var focusedComp=findFocusedComp(groups);setOverflow([]);setGroups$1(primary,groups);var availableWidth=get$a(primary.element);var overflows=partition(availableWidth,detail.builtGroups.get(),function(comp){return get$a(comp.element);},overflowGroup);if(overflows.extra.length===0){Replacing.remove(primary,overflowGroup);setOverflow([]);}else{setGroups$1(primary,overflows.within);setOverflow(overflows.extra);}remove$6(primary.element,'visibility');reflow(primary.element);focusedComp.each(Focusing.focus);};var schema$c=constant$1([field('splitToolbarBehaviours',[Coupling]),customField('builtGroups',function(){return Cell([]);})]);var schema$b=constant$1([markers$1(['overflowToggledClass']),optionFunction('getOverflowBounds'),required$1('lazySink'),customField('overflowGroups',function(){return Cell([]);})].concat(schema$c()));var parts$7=constant$1([required({factory:Toolbar,schema:schema$e(),name:'primary'}),external$1({schema:schema$e(),name:'overflow'}),external$1({name:'overflow-button'}),external$1({name:'overflow-group'})]);var expandable=constant$1(function(element,available){setMax(element,Math.floor(available));});var schema$a=constant$1([markers$1(['toggledClass']),required$1('lazySink'),requiredFunction('fetch'),optionFunction('getBounds'),optionObjOf('fireDismissalEventInstead',[defaulted('event',dismissRequested())]),schema$y()]);var parts$6=constant$1([external$1({name:'button',overrides:function overrides(detail){return{dom:{attributes:{'aria-haspopup':'true'}},buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.toggledClass,aria:{mode:'expanded'},toggleOnExecute:false})])};}}),external$1({factory:Toolbar,schema:schema$e(),name:'toolbar',overrides:function overrides(detail){return{toolbarBehaviours:derive$1([Keying.config({mode:'cyclic',onEscape:function onEscape(comp){getPart(comp,detail,'button').each(Focusing.focus);return Optional.none();}})])};}})]);var _toggle=function toggle(button,externals){var toolbarSandbox=Coupling.getCoupled(button,'toolbarSandbox');if(Sandboxing.isOpen(toolbarSandbox)){Sandboxing.close(toolbarSandbox);}else{Sandboxing.open(toolbarSandbox,externals.toolbar());}};var position=function position(button,toolbar,detail,layouts){var bounds=detail.getBounds.map(function(bounder){return bounder();});var sink=detail.lazySink(button).getOrDie();Positioning.positionWithinBounds(sink,toolbar,{anchor:{type:'hotspot',hotspot:button,layouts:layouts,overrides:{maxWidthFunction:expandable()}}},bounds);};var _setGroups=function setGroups(button,toolbar,detail,layouts,groups){Toolbar.setGroups(toolbar,groups);position(button,toolbar,detail,layouts);Toggling.on(button);};var makeSandbox=function makeSandbox(button,spec,detail){var ariaOwner=manager();var onOpen=function onOpen(sandbox,toolbar){detail.fetch().get(function(groups){_setGroups(button,toolbar,detail,spec.layouts,groups);ariaOwner.link(button.element);Keying.focusIn(toolbar);});};var onClose=function onClose(){Toggling.off(button);Focusing.focus(button);ariaOwner.unlink(button.element);};return{dom:{tag:'div',attributes:{id:ariaOwner.id}},behaviours:derive$1([Keying.config({mode:'special',onEscape:function onEscape(comp){Sandboxing.close(comp);return Optional.some(true);}}),Sandboxing.config({onOpen:onOpen,onClose:onClose,isPartOf:function isPartOf(container,data,queryElem){return isPartOf$1(data,queryElem)||isPartOf$1(button,queryElem);},getAttachPoint:function getAttachPoint(){return detail.lazySink(button).getOrDie();}}),Receiving.config({channels:_assign(_assign({},receivingChannel$1(_assign({isExtraPart:never},detail.fireDismissalEventInstead.map(function(fe){return{fireEventInstead:{event:fe.event}};}).getOr({})))),receivingChannel({doReposition:function doReposition(){Sandboxing.getState(Coupling.getCoupled(button,'toolbarSandbox')).each(function(toolbar){position(button,toolbar,detail,spec.layouts);});}}))})])};};var factory$a=function factory$a(detail,components,spec,externals){return _assign(_assign({},Button.sketch(_assign(_assign({},externals.button()),{action:function action(button){_toggle(button,externals);},buttonBehaviours:SketchBehaviours.augment({dump:externals.button().buttonBehaviours},[Coupling.config({others:{toolbarSandbox:function toolbarSandbox(button){return makeSandbox(button,spec,detail);}}})])}))),{apis:{setGroups:function setGroups(button,groups){Sandboxing.getState(Coupling.getCoupled(button,'toolbarSandbox')).each(function(toolbar){_setGroups(button,toolbar,detail,spec.layouts,groups);});},reposition:function reposition(button){Sandboxing.getState(Coupling.getCoupled(button,'toolbarSandbox')).each(function(toolbar){position(button,toolbar,detail,spec.layouts);});},toggle:function toggle(button){_toggle(button,externals);},getToolbar:function getToolbar(button){return Sandboxing.getState(Coupling.getCoupled(button,'toolbarSandbox'));},isOpen:function isOpen(button){return Sandboxing.isOpen(Coupling.getCoupled(button,'toolbarSandbox'));}}});};var FloatingToolbarButton=composite({name:'FloatingToolbarButton',factory:factory$a,configFields:schema$a(),partFields:parts$6(),apis:{setGroups:function setGroups(apis,button,groups){apis.setGroups(button,groups);},reposition:function reposition(apis,button){apis.reposition(button);},toggle:function toggle(apis,button){apis.toggle(button);},getToolbar:function getToolbar(apis,button){return apis.getToolbar(button);},isOpen:function isOpen(apis,button){return apis.isOpen(button);}}});var schema$9=constant$1([required$1('items'),markers$1(['itemSelector']),field('tgroupBehaviours',[Keying])]);var parts$5=constant$1([group({name:'items',unit:'item'})]);var factory$9=function factory$9(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.tgroupBehaviours,[Keying.config({mode:'flow',selector:detail.markers.itemSelector})]),domModification:{attributes:{role:'toolbar'}}};};var ToolbarGroup=composite({name:'ToolbarGroup',configFields:schema$9(),partFields:parts$5(),factory:factory$9});var buildGroups=function buildGroups(comps){return map$2(comps,function(g){return premade(g);});};var refresh$1=function refresh$1(toolbar,memFloatingToolbarButton,detail){refresh$2(toolbar,detail,function(overflowGroups){detail.overflowGroups.set(overflowGroups);memFloatingToolbarButton.getOpt(toolbar).each(function(floatingToolbarButton){FloatingToolbarButton.setGroups(floatingToolbarButton,buildGroups(overflowGroups));});});};var factory$8=function factory$8(detail,components,spec,externals){var memFloatingToolbarButton=record(FloatingToolbarButton.sketch({fetch:function fetch(){return Future.nu(function(resolve){resolve(buildGroups(detail.overflowGroups.get()));});},layouts:{onLtr:function onLtr(){return[southwest$2,southeast$2];},onRtl:function onRtl(){return[southeast$2,southwest$2];},onBottomLtr:function onBottomLtr(){return[northwest$2,northeast$2];},onBottomRtl:function onBottomRtl(){return[northeast$2,northwest$2];}},getBounds:spec.getOverflowBounds,lazySink:detail.lazySink,fireDismissalEventInstead:{},markers:{toggledClass:detail.markers.overflowToggledClass},parts:{button:externals['overflow-button'](),toolbar:externals.overflow()}}));return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:function overflowGroup(){return ToolbarGroup.sketch(_assign(_assign({},externals['overflow-group']()),{items:[memFloatingToolbarButton.asSpec()]}));}}})]),apis:{setGroups:function setGroups(toolbar,groups){detail.builtGroups.set(map$2(groups,toolbar.getSystem().build));refresh$1(toolbar,memFloatingToolbarButton,detail);},refresh:function refresh(toolbar){return refresh$1(toolbar,memFloatingToolbarButton,detail);},toggle:function toggle(toolbar){memFloatingToolbarButton.getOpt(toolbar).each(function(floatingToolbarButton){FloatingToolbarButton.toggle(floatingToolbarButton);});},isOpen:function isOpen(toolbar){return memFloatingToolbarButton.getOpt(toolbar).map(FloatingToolbarButton.isOpen).getOr(false);},reposition:function reposition(toolbar){memFloatingToolbarButton.getOpt(toolbar).each(function(floatingToolbarButton){FloatingToolbarButton.reposition(floatingToolbarButton);});},getOverflow:function getOverflow(toolbar){return memFloatingToolbarButton.getOpt(toolbar).bind(FloatingToolbarButton.getToolbar);}},domModification:{attributes:{role:'group'}}};};var SplitFloatingToolbar=composite({name:'SplitFloatingToolbar',configFields:schema$b(),partFields:parts$7(),factory:factory$8,apis:{setGroups:function setGroups(apis,toolbar,groups){apis.setGroups(toolbar,groups);},refresh:function refresh(apis,toolbar){apis.refresh(toolbar);},reposition:function reposition(apis,toolbar){apis.reposition(toolbar);},toggle:function toggle(apis,toolbar){apis.toggle(toolbar);},isOpen:function isOpen(apis,toolbar){return apis.isOpen(toolbar);},getOverflow:function getOverflow(apis,toolbar){return apis.getOverflow(toolbar);}}});var schema$8=constant$1([markers$1(['closedClass','openClass','shrinkingClass','growingClass','overflowToggledClass']),onHandler('onOpened'),onHandler('onClosed')].concat(schema$c()));var parts$4=constant$1([required({factory:Toolbar,schema:schema$e(),name:'primary'}),required({factory:Toolbar,schema:schema$e(),name:'overflow',overrides:function overrides(detail){return{toolbarBehaviours:derive$1([Sliding.config({dimension:{property:'height'},closedClass:detail.markers.closedClass,openClass:detail.markers.openClass,shrinkingClass:detail.markers.shrinkingClass,growingClass:detail.markers.growingClass,onShrunk:function onShrunk(comp){getPart(comp,detail,'overflow-button').each(function(button){Toggling.off(button);Focusing.focus(button);});detail.onClosed(comp);},onGrown:function onGrown(comp){Keying.focusIn(comp);detail.onOpened(comp);},onStartGrow:function onStartGrow(comp){getPart(comp,detail,'overflow-button').each(Toggling.on);}}),Keying.config({mode:'acyclic',onEscape:function onEscape(comp){getPart(comp,detail,'overflow-button').each(Focusing.focus);return Optional.some(true);}})])};}}),external$1({name:'overflow-button',overrides:function overrides(detail){return{buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.overflowToggledClass,aria:{mode:'pressed'},toggleOnExecute:false})])};}}),external$1({name:'overflow-group'})]);var _isOpen=function isOpen(toolbar,detail){return getPart(toolbar,detail,'overflow').map(Sliding.hasGrown).getOr(false);};var toggleToolbar=function toggleToolbar(toolbar,detail){getPart(toolbar,detail,'overflow-button').bind(function(){return getPart(toolbar,detail,'overflow');}).each(function(overf){_refresh(toolbar,detail);Sliding.toggleGrow(overf);});};var _refresh=function refresh(toolbar,detail){getPart(toolbar,detail,'overflow').each(function(overflow){refresh$2(toolbar,detail,function(groups){var builtGroups=map$2(groups,function(g){return premade(g);});Toolbar.setGroups(overflow,builtGroups);});getPart(toolbar,detail,'overflow-button').each(function(button){if(Sliding.hasGrown(overflow)){Toggling.on(button);}});Sliding.refresh(overflow);});};var factory$7=function factory$7(detail,components,spec,externals){var toolbarToggleEvent='alloy.toolbar.toggle';var doSetGroups=function doSetGroups(toolbar,groups){var built=map$2(groups,toolbar.getSystem().build);detail.builtGroups.set(built);};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:function overflowGroup(toolbar){return ToolbarGroup.sketch(_assign(_assign({},externals['overflow-group']()),{items:[Button.sketch(_assign(_assign({},externals['overflow-button']()),{action:function action(_button){emit(toolbar,toolbarToggleEvent);}}))]}));}}}),config('toolbar-toggle-events',[run$1(toolbarToggleEvent,function(toolbar){toggleToolbar(toolbar,detail);})])]),apis:{setGroups:function setGroups(toolbar,groups){doSetGroups(toolbar,groups);_refresh(toolbar,detail);},refresh:function refresh(toolbar){return _refresh(toolbar,detail);},toggle:function toggle(toolbar){return toggleToolbar(toolbar,detail);},isOpen:function isOpen(toolbar){return _isOpen(toolbar,detail);}},domModification:{attributes:{role:'group'}}};};var SplitSlidingToolbar=composite({name:'SplitSlidingToolbar',configFields:schema$8(),partFields:parts$4(),factory:factory$7,apis:{setGroups:function setGroups(apis,toolbar,groups){apis.setGroups(toolbar,groups);},refresh:function refresh(apis,toolbar){apis.refresh(toolbar);},toggle:function toggle(apis,toolbar){apis.toggle(toolbar);},isOpen:function isOpen(apis,toolbar){return apis.isOpen(toolbar);}}});var renderToolbarGroupCommon=function renderToolbarGroupCommon(toolbarGroup){var attributes=toolbarGroup.title.fold(function(){return{};},function(title){return{attributes:{title:title}};});return{dom:_assign({tag:'div',classes:['tox-toolbar__group']},attributes),components:[ToolbarGroup.parts.items({})],items:toolbarGroup.items,markers:{itemSelector:'*:not(.tox-split-button) > .tox-tbtn:not([disabled]), '+'.tox-split-button:not([disabled]), '+'.tox-toolbar-nav-js:not([disabled])'},tgroupBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])};};var renderToolbarGroup=function renderToolbarGroup(toolbarGroup){return ToolbarGroup.sketch(renderToolbarGroupCommon(toolbarGroup));};var getToolbarbehaviours=function getToolbarbehaviours(toolbarSpec,modeName){var onAttached=runOnAttached(function(component){var groups=map$2(toolbarSpec.initGroups,renderToolbarGroup);Toolbar.setGroups(component,groups);});return derive$1([DisablingConfigs.toolbarButton(toolbarSpec.providers.isDisabled),receivingConfig(),Keying.config({mode:modeName,onEscape:toolbarSpec.onEscape,selector:'.tox-toolbar__group'}),config('toolbar-events',[onAttached])]);};var renderMoreToolbarCommon=function renderMoreToolbarCommon(toolbarSpec){var modeName=toolbarSpec.cyclicKeying?'cyclic':'acyclic';return{uid:toolbarSpec.uid,dom:{tag:'div',classes:['tox-toolbar-overlord']},parts:{'overflow-group':renderToolbarGroupCommon({title:Optional.none(),items:[]}),'overflow-button':renderIconButtonSpec({name:'more',icon:Optional.some('more-drawer'),disabled:false,tooltip:Optional.some('More...'),primary:false,borderless:false},Optional.none(),toolbarSpec.providers)},splitToolbarBehaviours:getToolbarbehaviours(toolbarSpec,modeName)};};var renderFloatingMoreToolbar=function renderFloatingMoreToolbar(toolbarSpec){var baseSpec=renderMoreToolbarCommon(toolbarSpec);var overflowXOffset=4;var primary=SplitFloatingToolbar.parts.primary({dom:{tag:'div',classes:['tox-toolbar__primary']}});return SplitFloatingToolbar.sketch(_assign(_assign({},baseSpec),{lazySink:toolbarSpec.getSink,getOverflowBounds:function getOverflowBounds(){var headerElem=toolbarSpec.moreDrawerData.lazyHeader().element;var headerBounds=absolute$2(headerElem);var docElem=documentElement(headerElem);var docBounds=absolute$2(docElem);var height=Math.max(docElem.dom.scrollHeight,docBounds.height);return bounds(headerBounds.x+overflowXOffset,docBounds.y,headerBounds.width-overflowXOffset*2,height);},parts:_assign(_assign({},baseSpec.parts),{overflow:{dom:{tag:'div',classes:['tox-toolbar__overflow'],attributes:toolbarSpec.attributes}}}),components:[primary],markers:{overflowToggledClass:'tox-tbtn--enabled'}}));};var renderSlidingMoreToolbar=function renderSlidingMoreToolbar(toolbarSpec){var primary=SplitSlidingToolbar.parts.primary({dom:{tag:'div',classes:['tox-toolbar__primary']}});var overflow=SplitSlidingToolbar.parts.overflow({dom:{tag:'div',classes:['tox-toolbar__overflow']}});var baseSpec=renderMoreToolbarCommon(toolbarSpec);return SplitSlidingToolbar.sketch(_assign(_assign({},baseSpec),{components:[primary,overflow],markers:{openClass:'tox-toolbar__overflow--open',closedClass:'tox-toolbar__overflow--closed',growingClass:'tox-toolbar__overflow--growing',shrinkingClass:'tox-toolbar__overflow--shrinking',overflowToggledClass:'tox-tbtn--enabled'},onOpened:function onOpened(comp){comp.getSystem().broadcastOn([toolbarHeightChange()],{type:'opened'});},onClosed:function onClosed(comp){comp.getSystem().broadcastOn([toolbarHeightChange()],{type:'closed'});}}));};var renderToolbar=function renderToolbar(toolbarSpec){var modeName=toolbarSpec.cyclicKeying?'cyclic':'acyclic';return Toolbar.sketch({uid:toolbarSpec.uid,dom:{tag:'div',classes:['tox-toolbar'].concat(toolbarSpec.type===ToolbarMode.scrolling?['tox-toolbar--scrolling']:[])},components:[Toolbar.parts.groups({})],toolbarBehaviours:getToolbarbehaviours(toolbarSpec,modeName)});};var factory$6=function factory$6(detail,components,_spec){var apis={getSocket:function getSocket(comp){return parts$a.getPart(comp,detail,'socket');},setSidebar:function setSidebar(comp,panelConfigs){parts$a.getPart(comp,detail,'sidebar').each(function(sidebar){return _setSidebar(sidebar,panelConfigs);});},toggleSidebar:function toggleSidebar(comp,name){parts$a.getPart(comp,detail,'sidebar').each(function(sidebar){return _toggleSidebar(sidebar,name);});},whichSidebar:function whichSidebar(comp){return parts$a.getPart(comp,detail,'sidebar').bind(_whichSidebar).getOrNull();},getHeader:function getHeader(comp){return parts$a.getPart(comp,detail,'header');},getToolbar:function getToolbar(comp){return parts$a.getPart(comp,detail,'toolbar');},setToolbar:function setToolbar(comp,groups){parts$a.getPart(comp,detail,'toolbar').each(function(toolbar){toolbar.getApis().setGroups(toolbar,groups);});},setToolbars:function setToolbars(comp,toolbars){parts$a.getPart(comp,detail,'multiple-toolbar').each(function(mToolbar){CustomList.setItems(mToolbar,toolbars);});},refreshToolbar:function refreshToolbar(comp){var toolbar=parts$a.getPart(comp,detail,'toolbar');toolbar.each(function(toolbar){return toolbar.getApis().refresh(toolbar);});},toggleToolbarDrawer:function toggleToolbarDrawer(comp){parts$a.getPart(comp,detail,'toolbar').each(function(toolbar){mapFrom(toolbar.getApis().toggle,function(toggle){return toggle(toolbar);});});},isToolbarDrawerToggled:function isToolbarDrawerToggled(comp){return parts$a.getPart(comp,detail,'toolbar').bind(function(toolbar){return Optional.from(toolbar.getApis().isOpen).map(function(isOpen){return isOpen(toolbar);});}).getOr(false);},getThrobber:function getThrobber(comp){return parts$a.getPart(comp,detail,'throbber');},focusToolbar:function focusToolbar(comp){var optToolbar=parts$a.getPart(comp,detail,'toolbar').orThunk(function(){return parts$a.getPart(comp,detail,'multiple-toolbar');});optToolbar.each(function(toolbar){Keying.focusIn(toolbar);});},setMenubar:function setMenubar(comp,menus){parts$a.getPart(comp,detail,'menubar').each(function(menubar){SilverMenubar.setMenus(menubar,menus);});},focusMenubar:function focusMenubar(comp){parts$a.getPart(comp,detail,'menubar').each(function(menubar){SilverMenubar.focus(menubar);});}};return{uid:detail.uid,dom:detail.dom,components:components,apis:apis,behaviours:detail.behaviours};};var partMenubar=partType.optional({factory:SilverMenubar,name:'menubar',schema:[required$1('backstage')]});var toolbarFactory=function toolbarFactory(spec){if(spec.type===ToolbarMode.sliding){return renderSlidingMoreToolbar;}else if(spec.type===ToolbarMode.floating){return renderFloatingMoreToolbar;}else{return renderToolbar;}};var partMultipleToolbar=partType.optional({factory:{sketch:function sketch(spec){return CustomList.sketch({uid:spec.uid,dom:spec.dom,listBehaviours:derive$1([Keying.config({mode:'acyclic',selector:'.tox-toolbar'})]),makeItem:function makeItem(){return renderToolbar({type:spec.type,uid:generate$6('multiple-toolbar-item'),cyclicKeying:false,initGroups:[],providers:spec.providers,onEscape:function onEscape(){spec.onEscape();return Optional.some(true);}});},setupItem:function setupItem(_mToolbar,tc,data,_index){Toolbar.setGroups(tc,data);},shell:true});}},name:'multiple-toolbar',schema:[required$1('dom'),required$1('onEscape')]});var partToolbar=partType.optional({factory:{sketch:function sketch(spec){var renderer=toolbarFactory(spec);var toolbarSpec={type:spec.type,uid:spec.uid,onEscape:function onEscape(){spec.onEscape();return Optional.some(true);},cyclicKeying:false,initGroups:[],getSink:spec.getSink,providers:spec.providers,moreDrawerData:{lazyToolbar:spec.lazyToolbar,lazyMoreButton:spec.lazyMoreButton,lazyHeader:spec.lazyHeader},attributes:spec.attributes};return renderer(toolbarSpec);}},name:'toolbar',schema:[required$1('dom'),required$1('onEscape'),required$1('getSink')]});var partHeader=partType.optional({factory:{sketch:renderHeader},name:'header',schema:[required$1('dom')]});var partSocket=partType.optional({name:'socket',schema:[required$1('dom')]});var partSidebar=partType.optional({factory:{sketch:renderSidebar},name:'sidebar',schema:[required$1('dom')]});var partThrobber=partType.optional({factory:{sketch:renderThrobber},name:'throbber',schema:[required$1('dom')]});var OuterContainer=composite({name:'OuterContainer',factory:factory$6,configFields:[required$1('dom'),required$1('behaviours')],partFields:[partHeader,partMenubar,partToolbar,partMultipleToolbar,partSocket,partSidebar,partThrobber],apis:{getSocket:function getSocket(apis,comp){return apis.getSocket(comp);},setSidebar:function setSidebar(apis,comp,panelConfigs){apis.setSidebar(comp,panelConfigs);},toggleSidebar:function toggleSidebar(apis,comp,name){apis.toggleSidebar(comp,name);},whichSidebar:function whichSidebar(apis,comp){return apis.whichSidebar(comp);},getHeader:function getHeader(apis,comp){return apis.getHeader(comp);},getToolbar:function getToolbar(apis,comp){return apis.getToolbar(comp);},setToolbar:function setToolbar(apis,comp,grps){var groups=map$2(grps,function(grp){return renderToolbarGroup(grp);});apis.setToolbar(comp,groups);},setToolbars:function setToolbars(apis,comp,ts){var renderedToolbars=map$2(ts,function(g){return map$2(g,renderToolbarGroup);});apis.setToolbars(comp,renderedToolbars);},refreshToolbar:function refreshToolbar(apis,comp){return apis.refreshToolbar(comp);},toggleToolbarDrawer:function toggleToolbarDrawer(apis,comp){apis.toggleToolbarDrawer(comp);},isToolbarDrawerToggled:function isToolbarDrawerToggled(apis,comp){return apis.isToolbarDrawerToggled(comp);},getThrobber:function getThrobber(apis,comp){return apis.getThrobber(comp);},setMenubar:function setMenubar(apis,comp,menus){apis.setMenubar(comp,menus);},focusMenubar:function focusMenubar(apis,comp){apis.focusMenubar(comp);},focusToolbar:function focusToolbar(apis,comp){apis.focusToolbar(comp);}}});var defaultMenubar='file edit view insert format tools table help';var defaultMenus={file:{title:'File',items:'newdocument restoredraft | preview | export print | deleteallconversations'},edit:{title:'Edit',items:'undo redo | cut copy paste pastetext | selectall | searchreplace'},view:{title:'View',items:'code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments'},insert:{title:'Insert',items:'image link media addcomment pageembed template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor toc | insertdatetime'},format:{title:'Format',items:'bold italic underline strikethrough superscript subscript codeformat | formats blockformats fontformats fontsizes align lineheight | forecolor backcolor | language | removeformat'},tools:{title:'Tools',items:'spellchecker spellcheckerlanguage | a11ycheck code wordcount'},table:{title:'Table',items:'inserttable | cell row column | advtablesort | tableprops deletetable'},help:{title:'Help',items:'help'}};var make=function make(menu,registry,editor){var removedMenuItems=getRemovedMenuItems(editor).split(/[ ,]/);return{text:menu.title,getItems:function getItems(){return bind$3(menu.items,function(i){var itemName=i.toLowerCase();if(itemName.trim().length===0){return[];}else if(exists(removedMenuItems,function(removedMenuItem){return removedMenuItem===itemName;})){return[];}else if(itemName==='separator'||itemName==='|'){return[{type:'separator'}];}else if(registry.menuItems[itemName]){return[registry.menuItems[itemName]];}else{return[];}});}};};var parseItemsString=function parseItemsString(items){if(typeof items==='string'){return items.split(' ');}return items;};var identifyMenus=function identifyMenus(editor,registry){var rawMenuData=_assign(_assign({},defaultMenus),registry.menus);var userDefinedMenus=keys(registry.menus).length>0;var menubar=registry.menubar===undefined||registry.menubar===true?parseItemsString(defaultMenubar):parseItemsString(registry.menubar===false?'':registry.menubar);var validMenus=filter$2(menubar,function(menuName){var isDefaultMenu=has$2(defaultMenus,menuName);if(userDefinedMenus){return isDefaultMenu||get$e(registry.menus,menuName).exists(function(menu){return has$2(menu,'items');});}else{return isDefaultMenu;}});var menus=map$2(validMenus,function(menuName){var menuData=rawMenuData[menuName];return make({title:menuData.title,items:parseItemsString(menuData.items)},registry,editor);});return filter$2(menus,function(menu){var isNotSeparator=function isNotSeparator(item){return item.type!=='separator';};return menu.getItems().length>0&&exists(menu.getItems(),isNotSeparator);});};var fireSkinLoaded=function fireSkinLoaded(editor){var done=function done(){editor._skinLoaded=true;fireSkinLoaded$1(editor);};return function(){if(editor.initialized){done();}else{editor.on('init',done);}};};var fireSkinLoadError=function fireSkinLoadError(editor,err){return function(){return fireSkinLoadError$1(editor,{message:err});};};var loadStylesheet=function loadStylesheet(editor,stylesheetUrl,styleSheetLoader){return new global$c(function(resolve,reject){styleSheetLoader.load(stylesheetUrl,resolve,reject);editor.on('remove',function(){return styleSheetLoader.unload(stylesheetUrl);});});};var loadUiSkins=function loadUiSkins(editor,skinUrl){var skinUiCss=skinUrl+'/skin.min.css';return loadStylesheet(editor,skinUiCss,editor.ui.styleSheetLoader);};var loadShadowDomUiSkins=function loadShadowDomUiSkins(editor,skinUrl){var isInShadowRoot$1=isInShadowRoot(SugarElement.fromDom(editor.getElement()));if(isInShadowRoot$1){var shadowDomSkinCss=skinUrl+'/skin.shadowdom.min.css';return loadStylesheet(editor,shadowDomSkinCss,global$b.DOM.styleSheetLoader);}else{return global$c.resolve();}};var loadSkin=function loadSkin(isInline,editor){var skinUrl=getSkinUrl(editor);if(skinUrl){editor.contentCSS.push(skinUrl+(isInline?'/content.inline':'/content')+'.min.css');}if(isSkinDisabled(editor)===false&&isString(skinUrl)){global$c.all([loadUiSkins(editor,skinUrl),loadShadowDomUiSkins(editor,skinUrl)]).then(fireSkinLoaded(editor),fireSkinLoadError(editor,'Skin could not be loaded'));}else{fireSkinLoaded(editor)();}};var iframe=curry(loadSkin,false);var inline=curry(loadSkin,true);var onSetupFormatToggle=function onSetupFormatToggle(editor,name){return function(api){var boundCallback=unbindable();var init=function init(){api.setActive(editor.formatter.match(name));var binding=editor.formatter.formatChanged(name,api.setActive);boundCallback.set(binding);};editor.initialized?init():editor.once('init',init);return function(){editor.off('init',init);boundCallback.clear();};};};var onSetupEvent=function onSetupEvent(editor,event,f){return function(api){var handleEvent=function handleEvent(){return f(api);};var init=function init(){f(api);editor.on(event,handleEvent);};editor.initialized?init():editor.once('init',init);return function(){editor.off('init',init);editor.off(event,handleEvent);};};};var onActionToggleFormat$1=function onActionToggleFormat$1(editor){return function(rawItem){return function(){editor.undoManager.transact(function(){editor.focus();editor.execCommand('mceToggleFormat',false,rawItem.format);});};};};var onActionExecCommand=function onActionExecCommand(editor,command){return function(){return editor.execCommand(command);};};var generateSelectItems=function generateSelectItems(_editor,backstage,spec){var generateItem=function generateItem(rawItem,response,disabled,value){var translatedText=backstage.shared.providers.translate(rawItem.title);if(rawItem.type==='separator'){return Optional.some({type:'separator',text:translatedText});}else if(rawItem.type==='submenu'){var items=bind$3(rawItem.getStyleItems(),function(si){return validate(si,response,value);});if(response===0&&items.length<=0){return Optional.none();}else{return Optional.some({type:'nestedmenuitem',text:translatedText,disabled:items.length<=0,getSubmenuItems:function getSubmenuItems(){return bind$3(rawItem.getStyleItems(),function(si){return validate(si,response,value);});}});}}else{return Optional.some(_assign({type:'togglemenuitem',text:translatedText,icon:rawItem.icon,active:rawItem.isSelected(value),disabled:disabled,onAction:spec.onAction(rawItem)},rawItem.getStylePreview().fold(function(){return{};},function(preview){return{meta:{style:preview}};})));}};var validate=function validate(item,response,value){var invalid=item.type==='formatter'&&spec.isInvalid(item);if(response===0){return invalid?[]:generateItem(item,response,false,value).toArray();}else{return generateItem(item,response,invalid,value).toArray();}};var validateItems=function validateItems(preItems){var value=spec.getCurrentValue();var response=spec.shouldHide?0:1;return bind$3(preItems,function(item){return validate(item,response,value);});};var getFetch=function getFetch(backstage,getStyleItems){return function(comp,callback){var preItems=getStyleItems();var items=validateItems(preItems);var menu=build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,false);callback(menu);};};return{validateItems:validateItems,getFetch:getFetch};};var createMenuItems=function createMenuItems(editor,backstage,spec){var dataset=spec.dataset;var getStyleItems=dataset.type==='basic'?function(){return map$2(dataset.data,function(d){return processBasic(d,spec.isSelectedFor,spec.getPreviewFor);});}:dataset.getData;return{items:generateSelectItems(editor,backstage,spec),getStyleItems:getStyleItems};};var createSelectButton=function createSelectButton(editor,backstage,spec){var _a=createMenuItems(editor,backstage,spec),items=_a.items,getStyleItems=_a.getStyleItems;var getApi=function getApi(comp){return{getComponent:constant$1(comp)};};var onSetup=onSetupEvent(editor,'NodeChange',function(api){var comp=api.getComponent();spec.updateText(comp);});return renderCommonDropdown({text:spec.icon.isSome()?Optional.none():spec.text,icon:spec.icon,tooltip:Optional.from(spec.tooltip),role:Optional.none(),fetch:items.getFetch(backstage,getStyleItems),onSetup:onSetup,getApi:getApi,columns:1,presets:'normal',classes:spec.icon.isSome()?[]:['bespoke'],dropdownBehaviours:[]},'tox-tbtn',backstage.shared);};var process=function process(rawFormats){return map$2(rawFormats,function(item){var title=item,format=item;var values=item.split('=');if(values.length>1){title=values[0];format=values[1];}return{title:title,format:format};});};var buildBasicStaticDataset=function buildBasicStaticDataset(data){return{type:'basic',data:data};};var Delimiter;(function(Delimiter){Delimiter[Delimiter['SemiColon']=0]='SemiColon';Delimiter[Delimiter['Space']=1]='Space';})(Delimiter||(Delimiter={}));var split=function split(rawFormats,delimiter){if(delimiter===Delimiter.SemiColon){return rawFormats.replace(/;$/,'').split(';');}else{return rawFormats.split(' ');}};var buildBasicSettingsDataset=function buildBasicSettingsDataset(editor,settingName,defaults,delimiter){var rawFormats=editor.getParam(settingName,defaults,'string');var data=process(split(rawFormats,delimiter));return{type:'basic',data:data};};var alignMenuItems=[{title:'Left',icon:'align-left',format:'alignleft',command:'JustifyLeft'},{title:'Center',icon:'align-center',format:'aligncenter',command:'JustifyCenter'},{title:'Right',icon:'align-right',format:'alignright',command:'JustifyRight'},{title:'Justify',icon:'align-justify',format:'alignjustify',command:'JustifyFull'}];var getSpec$4=function getSpec$4(editor){var getMatchingValue=function getMatchingValue(){return find$5(alignMenuItems,function(item){return editor.formatter.match(item.format);});};var isSelectedFor=function isSelectedFor(format){return function(){return editor.formatter.match(format);};};var getPreviewFor=function getPreviewFor(_format){return Optional.none;};var updateSelectMenuIcon=function updateSelectMenuIcon(comp){var match=getMatchingValue();var alignment=match.fold(constant$1('left'),function(item){return item.title.toLowerCase();});emitWith(comp,updateMenuIcon,{icon:'align-'+alignment});};var dataset=buildBasicStaticDataset(alignMenuItems);var onAction=function onAction(rawItem){return function(){return find$5(alignMenuItems,function(item){return item.format===rawItem.format;}).each(function(item){return editor.execCommand(item.command);});};};return{tooltip:'Align',text:Optional.none(),icon:Optional.some('align-left'),isSelectedFor:isSelectedFor,getCurrentValue:Optional.none,getPreviewFor:getPreviewFor,onAction:onAction,updateText:updateSelectMenuIcon,dataset:dataset,shouldHide:false,isInvalid:function isInvalid(item){return!editor.formatter.canApply(item.format);}};};var createAlignSelect=function createAlignSelect(editor,backstage){return createSelectButton(editor,backstage,getSpec$4(editor));};var alignSelectMenu=function alignSelectMenu(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$4(editor));editor.ui.registry.addNestedMenuItem('align',{text:backstage.shared.providers.translate('Align'),getSubmenuItems:function getSubmenuItems(){return menuItems.items.validateItems(menuItems.getStyleItems());}});};var defaultFontsFormats='Andale Mono=andale mono,monospace;'+'Arial=arial,helvetica,sans-serif;'+'Arial Black=arial black,sans-serif;'+'Book Antiqua=book antiqua,palatino,serif;'+'Comic Sans MS=comic sans ms,sans-serif;'+'Courier New=courier new,courier,monospace;'+'Georgia=georgia,palatino,serif;'+'Helvetica=helvetica,arial,sans-serif;'+'Impact=impact,sans-serif;'+'Symbol=symbol;'+'Tahoma=tahoma,arial,helvetica,sans-serif;'+'Terminal=terminal,monaco,monospace;'+'Times New Roman=times new roman,times,serif;'+'Trebuchet MS=trebuchet ms,geneva,sans-serif;'+'Verdana=verdana,geneva,sans-serif;'+'Webdings=webdings;'+'Wingdings=wingdings,zapf dingbats';var systemStackFonts=['-apple-system','Segoe UI','Roboto','Helvetica Neue','sans-serif'];var splitFonts=function splitFonts(fontFamily){var fonts=fontFamily.split(/\\s*,\\s*/);return map$2(fonts,function(font){return font.replace(/^['\"]+|['\"]+$/g,'');});};var isSystemFontStack=function isSystemFontStack(fontFamily){var matchesSystemStack=function matchesSystemStack(){var fonts=splitFonts(fontFamily.toLowerCase());return forall(systemStackFonts,function(font){return fonts.indexOf(font.toLowerCase())>-1;});};return fontFamily.indexOf('-apple-system')===0&&matchesSystemStack();};var getSpec$3=function getSpec$3(editor){var systemFont='System Font';var getMatchingValue=function getMatchingValue(){var getFirstFont=function getFirstFont(fontFamily){return fontFamily?splitFonts(fontFamily)[0]:'';};var fontFamily=editor.queryCommandValue('FontName');var items=dataset.data;var font=fontFamily?fontFamily.toLowerCase():'';var matchOpt=find$5(items,function(item){var format=item.format;return format.toLowerCase()===font||getFirstFont(format).toLowerCase()===getFirstFont(font).toLowerCase();}).orThunk(function(){return someIf(isSystemFontStack(font),{title:systemFont,format:font});});return{matchOpt:matchOpt,font:fontFamily};};var isSelectedFor=function isSelectedFor(item){return function(valueOpt){return valueOpt.exists(function(value){return value.format===item;});};};var getCurrentValue=function getCurrentValue(){var matchOpt=getMatchingValue().matchOpt;return matchOpt;};var getPreviewFor=function getPreviewFor(item){return function(){return Optional.some({tag:'div',styles:item.indexOf('dings')===-1?{'font-family':item}:{}});};};var onAction=function onAction(rawItem){return function(){editor.undoManager.transact(function(){editor.focus();editor.execCommand('FontName',false,rawItem.format);});};};var updateSelectMenuText=function updateSelectMenuText(comp){var _a=getMatchingValue(),matchOpt=_a.matchOpt,font=_a.font;var text=matchOpt.fold(constant$1(font),function(item){return item.title;});emitWith(comp,updateMenuText,{text:text});};var dataset=buildBasicSettingsDataset(editor,'font_formats',defaultFontsFormats,Delimiter.SemiColon);return{tooltip:'Fonts',text:Optional.some(systemFont),icon:Optional.none(),isSelectedFor:isSelectedFor,getCurrentValue:getCurrentValue,getPreviewFor:getPreviewFor,onAction:onAction,updateText:updateSelectMenuText,dataset:dataset,shouldHide:false,isInvalid:never};};var createFontSelect=function createFontSelect(editor,backstage){return createSelectButton(editor,backstage,getSpec$3(editor));};var fontSelectMenu=function fontSelectMenu(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$3(editor));editor.ui.registry.addNestedMenuItem('fontformats',{text:backstage.shared.providers.translate('Fonts'),getSubmenuItems:function getSubmenuItems(){return menuItems.items.validateItems(menuItems.getStyleItems());}});};var defaultFontsizeFormats='8pt 10pt 12pt 14pt 18pt 24pt 36pt';var legacyFontSizes={'8pt':'1','10pt':'2','12pt':'3','14pt':'4','18pt':'5','24pt':'6','36pt':'7'};var keywordFontSizes={'xx-small':'7pt','x-small':'8pt','small':'10pt','medium':'12pt','large':'14pt','x-large':'18pt','xx-large':'24pt'};var round=function round(number,precision){var factor=Math.pow(10,precision);return Math.round(number*factor)/factor;};var toPt=function toPt(fontSize,precision){if(/[0-9.]+px$/.test(fontSize)){return round(parseInt(fontSize,10)*72/96,precision||0)+'pt';}else{return get$e(keywordFontSizes,fontSize).getOr(fontSize);}};var toLegacy=function toLegacy(fontSize){return get$e(legacyFontSizes,fontSize).getOr('');};var getSpec$2=function getSpec$2(editor){var getMatchingValue=function getMatchingValue(){var matchOpt=Optional.none();var items=dataset.data;var fontSize=editor.queryCommandValue('FontSize');if(fontSize){var _loop_1=function _loop_1(precision){var pt=toPt(fontSize,precision);var legacy=toLegacy(pt);matchOpt=find$5(items,function(item){return item.format===fontSize||item.format===pt||item.format===legacy;});};for(var precision=3;matchOpt.isNone()&&precision>=0;precision--){_loop_1(precision);}}return{matchOpt:matchOpt,size:fontSize};};var isSelectedFor=function isSelectedFor(item){return function(valueOpt){return valueOpt.exists(function(value){return value.format===item;});};};var getCurrentValue=function getCurrentValue(){var matchOpt=getMatchingValue().matchOpt;return matchOpt;};var getPreviewFor=constant$1(Optional.none);var onAction=function onAction(rawItem){return function(){editor.undoManager.transact(function(){editor.focus();editor.execCommand('FontSize',false,rawItem.format);});};};var updateSelectMenuText=function updateSelectMenuText(comp){var _a=getMatchingValue(),matchOpt=_a.matchOpt,size=_a.size;var text=matchOpt.fold(constant$1(size),function(match){return match.title;});emitWith(comp,updateMenuText,{text:text});};var dataset=buildBasicSettingsDataset(editor,'fontsize_formats',defaultFontsizeFormats,Delimiter.Space);return{tooltip:'Font sizes',text:Optional.some('12pt'),icon:Optional.none(),isSelectedFor:isSelectedFor,getPreviewFor:getPreviewFor,getCurrentValue:getCurrentValue,onAction:onAction,updateText:updateSelectMenuText,dataset:dataset,shouldHide:false,isInvalid:never};};var createFontsizeSelect=function createFontsizeSelect(editor,backstage){return createSelectButton(editor,backstage,getSpec$2(editor));};var fontsizeSelectMenu=function fontsizeSelectMenu(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$2(editor));editor.ui.registry.addNestedMenuItem('fontsizes',{text:'Font sizes',getSubmenuItems:function getSubmenuItems(){return menuItems.items.validateItems(menuItems.getStyleItems());}});};var findNearest=function findNearest(editor,getStyles){var styles=getStyles();var formats=map$2(styles,function(style){return style.format;});return Optional.from(editor.formatter.closest(formats)).bind(function(fmt){return find$5(styles,function(data){return data.format===fmt;});}).orThunk(function(){return someIf(editor.formatter.match('p'),{title:'Paragraph',format:'p'});});};var defaultBlocks='Paragraph=p;'+'Heading 1=h1;'+'Heading 2=h2;'+'Heading 3=h3;'+'Heading 4=h4;'+'Heading 5=h5;'+'Heading 6=h6;'+'Preformatted=pre';var getSpec$1=function getSpec$1(editor){var fallbackFormat='Paragraph';var isSelectedFor=function isSelectedFor(format){return function(){return editor.formatter.match(format);};};var getPreviewFor=function getPreviewFor(format){return function(){var fmt=editor.formatter.get(format);return Optional.some({tag:fmt.length>0?fmt[0].inline||fmt[0].block||'div':'div',styles:editor.dom.parseStyle(editor.formatter.getCssText(format))});};};var updateSelectMenuText=function updateSelectMenuText(comp){var detectedFormat=findNearest(editor,function(){return dataset.data;});var text=detectedFormat.fold(constant$1(fallbackFormat),function(fmt){return fmt.title;});emitWith(comp,updateMenuText,{text:text});};var dataset=buildBasicSettingsDataset(editor,'block_formats',defaultBlocks,Delimiter.SemiColon);return{tooltip:'Blocks',text:Optional.some(fallbackFormat),icon:Optional.none(),isSelectedFor:isSelectedFor,getCurrentValue:Optional.none,getPreviewFor:getPreviewFor,onAction:onActionToggleFormat$1(editor),updateText:updateSelectMenuText,dataset:dataset,shouldHide:false,isInvalid:function isInvalid(item){return!editor.formatter.canApply(item.format);}};};var createFormatSelect=function createFormatSelect(editor,backstage){return createSelectButton(editor,backstage,getSpec$1(editor));};var formatSelectMenu=function formatSelectMenu(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$1(editor));editor.ui.registry.addNestedMenuItem('blockformats',{text:'Blocks',getSubmenuItems:function getSubmenuItems(){return menuItems.items.validateItems(menuItems.getStyleItems());}});};var getSpec=function getSpec(editor,dataset){var fallbackFormat='Paragraph';var isSelectedFor=function isSelectedFor(format){return function(){return editor.formatter.match(format);};};var getPreviewFor=function getPreviewFor(format){return function(){var fmt=editor.formatter.get(format);return fmt!==undefined?Optional.some({tag:fmt.length>0?fmt[0].inline||fmt[0].block||'div':'div',styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none();};};var updateSelectMenuText=function updateSelectMenuText(comp){var _getFormatItems=function getFormatItems(fmt){var subs=fmt.items;return subs!==undefined&&subs.length>0?bind$3(subs,_getFormatItems):[{title:fmt.title,format:fmt.format}];};var flattenedItems=bind$3(getStyleFormats(editor),_getFormatItems);var detectedFormat=findNearest(editor,constant$1(flattenedItems));var text=detectedFormat.fold(constant$1(fallbackFormat),function(fmt){return fmt.title;});emitWith(comp,updateMenuText,{text:text});};return{tooltip:'Formats',text:Optional.some(fallbackFormat),icon:Optional.none(),isSelectedFor:isSelectedFor,getCurrentValue:Optional.none,getPreviewFor:getPreviewFor,onAction:onActionToggleFormat$1(editor),updateText:updateSelectMenuText,shouldHide:editor.getParam('style_formats_autohide',false,'boolean'),isInvalid:function isInvalid(item){return!editor.formatter.canApply(item.format);},dataset:dataset};};var createStyleSelect=function createStyleSelect(editor,backstage){var dataset=_assign({type:'advanced'},backstage.styleselect);return createSelectButton(editor,backstage,getSpec(editor,dataset));};var styleSelectMenu=function styleSelectMenu(editor,backstage){var dataset=_assign({type:'advanced'},backstage.styleselect);var menuItems=createMenuItems(editor,backstage,getSpec(editor,dataset));editor.ui.registry.addNestedMenuItem('formats',{text:'Formats',getSubmenuItems:function getSubmenuItems(){return menuItems.items.validateItems(menuItems.getStyleItems());}});};var events$3=function events$3(reflectingConfig,reflectingState){var update=function update(component,data){reflectingConfig.updateState.each(function(updateState){var newState=updateState(component,data);reflectingState.set(newState);});reflectingConfig.renderComponents.each(function(renderComponents){var newComponents=renderComponents(data,reflectingState.get());var newChildren=map$2(newComponents,component.getSystem().build);replaceChildren(component,newChildren);});};return derive$2([run$1(receive(),function(component,message){var receivingData=message;if(!receivingData.universal){var channel=reflectingConfig.channel;if(contains$2(receivingData.channels,channel)){update(component,receivingData.data);}}}),runOnAttached(function(comp,_se){reflectingConfig.initialData.each(function(rawData){update(comp,rawData);});})]);};var ActiveReflecting=/*#__PURE__*/Object.freeze({__proto__:null,events:events$3});var getState=function getState(component,replaceConfig,reflectState){return reflectState;};var ReflectingApis=/*#__PURE__*/Object.freeze({__proto__:null,getState:getState});var ReflectingSchema=[required$1('channel'),option('renderComponents'),option('updateState'),option('initialData')];var init$3=function init$3(){var cell=Cell(Optional.none());var clear=function clear(){return cell.set(Optional.none());};var readState=function readState(){return cell.get().getOr('none');};return{readState:readState,get:cell.get,set:cell.set,clear:clear};};var ReflectingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$3});var Reflecting=create$8({fields:ReflectingSchema,name:'reflecting',active:ActiveReflecting,apis:ReflectingApis,state:ReflectingState});var schema$7=constant$1([required$1('toggleClass'),required$1('fetch'),onStrictHandler('onExecute'),defaulted('getHotspot',Optional.some),defaulted('getAnchorOverrides',constant$1({})),schema$y(),onStrictHandler('onItemExecute'),option('lazySink'),required$1('dom'),onHandler('onOpen'),field('splitDropdownBehaviours',[Coupling,Keying,Focusing]),defaulted('matchWidth',false),defaulted('useMinWidth',false),defaulted('eventOrder',{}),option('role')].concat(sandboxFields()));var arrowPart=required({factory:Button,schema:[required$1('dom')],name:'arrow',defaults:function defaults(){return{buttonBehaviours:derive$1([Focusing.revoke()])};},overrides:function overrides(detail){return{dom:{tag:'span',attributes:{role:'presentation'}},action:function action(arrow){arrow.getSystem().getByUid(detail.uid).each(emitExecute);},buttonBehaviours:derive$1([Toggling.config({toggleOnExecute:false,toggleClass:detail.toggleClass})])};}});var buttonPart=required({factory:Button,schema:[required$1('dom')],name:'button',defaults:function defaults(){return{buttonBehaviours:derive$1([Focusing.revoke()])};},overrides:function overrides(detail){return{dom:{tag:'span',attributes:{role:'presentation'}},action:function action(btn){btn.getSystem().getByUid(detail.uid).each(function(splitDropdown){detail.onExecute(splitDropdown,btn);});}};}});var parts$3=constant$1([arrowPart,buttonPart,optional({factory:{sketch:function sketch(spec){return{uid:spec.uid,dom:{tag:'span',styles:{display:'none'},attributes:{'aria-hidden':'true'},innerHtml:spec.text}};}},schema:[required$1('text')],name:'aria-descriptor'}),external$1({schema:[tieredMenuMarkers()],name:'menu',defaults:function defaults(detail){return{onExecute:function onExecute(tmenu,item){tmenu.getSystem().getByUid(detail.uid).each(function(splitDropdown){detail.onItemExecute(splitDropdown,tmenu,item);});}};}}),partType$1()]);var factory$5=function factory$5(detail,components,spec,externals){var _a;var switchToMenu=function switchToMenu(sandbox){Composing.getCurrent(sandbox).each(function(current){Highlighting.highlightFirst(current);Keying.focusIn(current);});};var action=function action(component){var onOpenSync=switchToMenu;togglePopup(detail,identity$1,component,externals,onOpenSync,HighlightOnOpen.HighlightFirst).get(noop);};var openMenu=function openMenu(comp){action(comp);return Optional.some(true);};var executeOnButton=function executeOnButton(comp){var button=getPartOrDie(comp,detail,'button');emitExecute(button);return Optional.some(true);};var buttonEvents=_assign(_assign({},derive$2([runOnAttached(function(component,_simulatedEvent){var ariaDescriptor=getPart(component,detail,'aria-descriptor');ariaDescriptor.each(function(descriptor){var descriptorId=generate$6('aria');set$8(descriptor.element,'id',descriptorId);set$8(component.element,'aria-describedby',descriptorId);});})])),events$a(Optional.some(action)));var apis={repositionMenus:function repositionMenus(comp){if(Toggling.isOn(comp)){_repositionMenus(comp);}}};return{uid:detail.uid,dom:detail.dom,components:components,apis:apis,eventOrder:_assign(_assign({},detail.eventOrder),(_a={},_a[execute$5()]=['disabling','toggling','alloy.base.behaviour'],_a)),events:buttonEvents,behaviours:augment(detail.splitDropdownBehaviours,[Coupling.config({others:{sandbox:function sandbox(hotspot){var arrow=getPartOrDie(hotspot,detail,'arrow');var extras={onOpen:function onOpen(){Toggling.on(arrow);Toggling.on(hotspot);},onClose:function onClose(){Toggling.off(arrow);Toggling.off(hotspot);}};return makeSandbox$1(detail,hotspot,extras);}}}),Keying.config({mode:'special',onSpace:executeOnButton,onEnter:executeOnButton,onDown:openMenu}),Focusing.config({}),Toggling.config({toggleOnExecute:false,aria:{mode:'expanded'}})]),domModification:{attributes:{'role':detail.role.getOr('button'),'aria-haspopup':true}}};};var SplitDropdown=composite({name:'SplitDropdown',configFields:schema$7(),partFields:parts$3(),factory:factory$5,apis:{repositionMenus:function repositionMenus(apis,comp){return apis.repositionMenus(comp);}}});var getButtonApi=function getButtonApi(component){return{isDisabled:function isDisabled(){return Disabling.isDisabled(component);},setDisabled:function setDisabled(state){return Disabling.set(component,state);}};};var getToggleApi=function getToggleApi(component){return{setActive:function setActive(state){Toggling.set(component,state);},isActive:function isActive(){return Toggling.isOn(component);},isDisabled:function isDisabled(){return Disabling.isDisabled(component);},setDisabled:function setDisabled(state){return Disabling.set(component,state);}};};var getTooltipAttributes=function getTooltipAttributes(tooltip,providersBackstage){return tooltip.map(function(tooltip){return{'aria-label':providersBackstage.translate(tooltip),'title':providersBackstage.translate(tooltip)};}).getOr({});};var focusButtonEvent=generate$6('focus-button');var renderCommonStructure=function renderCommonStructure(icon,text,tooltip,receiver,behaviours,providersBackstage){var _d;return{dom:{tag:'button',classes:['tox-tbtn'].concat(text.isSome()?['tox-tbtn--select']:[]),attributes:getTooltipAttributes(tooltip,providersBackstage)},components:componentRenderPipeline([icon.map(function(iconName){return renderIconFromPack(iconName,providersBackstage.icons);}),text.map(function(text){return renderLabel$1(text,'tox-tbtn',providersBackstage);})]),eventOrder:(_d={},_d[mousedown()]=['focusing','alloy.base.behaviour','common-button-display-events'],_d),buttonBehaviours:derive$1([DisablingConfigs.toolbarButton(providersBackstage.isDisabled),receivingConfig(),config('common-button-display-events',[run$1(mousedown(),function(button,se){se.event.prevent();emit(button,focusButtonEvent);})])].concat(receiver.map(function(r){return Reflecting.config({channel:r,initialData:{icon:icon,text:text},renderComponents:function renderComponents(data,_state){return componentRenderPipeline([data.icon.map(function(iconName){return renderIconFromPack(iconName,providersBackstage.icons);}),data.text.map(function(text){return renderLabel$1(text,'tox-tbtn',providersBackstage);})]);}});}).toArray()).concat(behaviours.getOr([])))};};var renderFloatingToolbarButton=function renderFloatingToolbarButton(spec,backstage,identifyButtons,attributes){var sharedBackstage=backstage.shared;return FloatingToolbarButton.sketch({lazySink:sharedBackstage.getSink,fetch:function fetch(){return Future.nu(function(resolve){resolve(map$2(identifyButtons(spec.items),renderToolbarGroup));});},markers:{toggledClass:'tox-tbtn--enabled'},parts:{button:renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.none(),Optional.none(),sharedBackstage.providers),toolbar:{dom:{tag:'div',classes:['tox-toolbar__overflow'],attributes:attributes}}}});};var renderCommonToolbarButton=function renderCommonToolbarButton(spec,specialisation,providersBackstage){var editorOffCell=Cell(noop);var structure=renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.none(),Optional.none(),providersBackstage);return Button.sketch({dom:structure.dom,components:structure.components,eventOrder:toolbarButtonEventOrder,buttonBehaviours:derive$1([config('toolbar-button-events',[onToolbarButtonExecute({onAction:spec.onAction,getApi:specialisation.getApi}),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),DisablingConfigs.toolbarButton(function(){return spec.disabled||providersBackstage.isDisabled();}),receivingConfig()].concat(specialisation.toolbarButtonBehaviours))});};var renderToolbarButton=function renderToolbarButton(spec,providersBackstage){return renderToolbarButtonWith(spec,providersBackstage,[]);};var renderToolbarButtonWith=function renderToolbarButtonWith(spec,providersBackstage,bonusEvents){return renderCommonToolbarButton(spec,{toolbarButtonBehaviours:[].concat(bonusEvents.length>0?[config('toolbarButtonWith',bonusEvents)]:[]),getApi:getButtonApi,onSetup:spec.onSetup},providersBackstage);};var renderToolbarToggleButton=function renderToolbarToggleButton(spec,providersBackstage){return renderToolbarToggleButtonWith(spec,providersBackstage,[]);};var renderToolbarToggleButtonWith=function renderToolbarToggleButtonWith(spec,providersBackstage,bonusEvents){return deepMerge(renderCommonToolbarButton(spec,{toolbarButtonBehaviours:[Replacing.config({}),Toggling.config({toggleClass:'tox-tbtn--enabled',aria:{mode:'pressed'},toggleOnExecute:false})].concat(bonusEvents.length>0?[config('toolbarToggleButtonWith',bonusEvents)]:[]),getApi:getToggleApi,onSetup:spec.onSetup},providersBackstage));};var fetchChoices=function fetchChoices(getApi,spec,providersBackstage){return function(comp){return Future.nu(function(callback){return spec.fetch(callback);}).map(function(items){return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6('menu-value'),items,function(value){spec.onItemAction(getApi(comp),value);},spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,spec.select.getOr(never),providersBackstage),{movement:deriveMenuMovement(spec.columns,spec.presets),menuBehaviours:SimpleBehaviours.unnamedEvents(spec.columns!=='auto'?[]:[runOnAttached(function(comp,_se){detectSize(comp,4,classForPreset(spec.presets)).each(function(_d){var numRows=_d.numRows,numColumns=_d.numColumns;Keying.setGridSize(comp,numRows,numColumns);});})])})));});};};var renderSplitButton=function renderSplitButton(spec,sharedBackstage){var _d;var displayChannel=generate$6('channel-update-split-dropdown-display');var getApi=function getApi(comp){return{isDisabled:function isDisabled(){return Disabling.isDisabled(comp);},setDisabled:function setDisabled(state){return Disabling.set(comp,state);},setIconFill:function setIconFill(id,value){descendant(comp.element,'svg path[id=\"'+id+'\"], rect[id=\"'+id+'\"]').each(function(underlinePath){set$8(underlinePath,'fill',value);});},setIconStroke:function setIconStroke(id,value){descendant(comp.element,'svg path[id=\"'+id+'\"], rect[id=\"'+id+'\"]').each(function(underlinePath){set$8(underlinePath,'stroke',value);});},setActive:function setActive(state){set$8(comp.element,'aria-pressed',state);descendant(comp.element,'span').each(function(button){comp.getSystem().getByDom(button).each(function(buttonComp){return Toggling.set(buttonComp,state);});});},isActive:function isActive(){return descendant(comp.element,'span').exists(function(button){return comp.getSystem().getByDom(button).exists(Toggling.isOn);});}};};var editorOffCell=Cell(noop);var specialisation={getApi:getApi,onSetup:spec.onSetup};return SplitDropdown.sketch({dom:{tag:'div',classes:['tox-split-button'],attributes:_assign({'aria-pressed':false},getTooltipAttributes(spec.tooltip,sharedBackstage.providers))},onExecute:function onExecute(button){spec.onAction(getApi(button));},onItemExecute:function onItemExecute(_a,_b,_c){},splitDropdownBehaviours:derive$1([DisablingConfigs.splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),config('split-dropdown-events',[run$1(focusButtonEvent,Focusing.focus),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),Unselecting.config({})]),eventOrder:(_d={},_d[attachedToDom()]=['alloy.base.behaviour','split-dropdown-events'],_d),toggleClass:'tox-tbtn--enabled',lazySink:sharedBackstage.getSink,fetch:fetchChoices(getApi,spec,sharedBackstage.providers),parts:{menu:part(false,spec.columns,spec.presets)},components:[SplitDropdown.parts.button(renderCommonStructure(spec.icon,spec.text,Optional.none(),Optional.some(displayChannel),Optional.some([Toggling.config({toggleClass:'tox-tbtn--enabled',toggleOnExecute:false})]),sharedBackstage.providers)),SplitDropdown.parts.arrow({dom:{tag:'button',classes:['tox-tbtn','tox-split-button__chevron'],innerHtml:get$1('chevron-down',sharedBackstage.providers.icons)},buttonBehaviours:derive$1([DisablingConfigs.splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),addFocusableBehaviour()])}),SplitDropdown.parts['aria-descriptor']({text:sharedBackstage.providers.translate('To open the popup, press Shift+Enter')})]});};var defaultToolbar=[{name:'history',items:['undo','redo']},{name:'styles',items:['styleselect']},{name:'formatting',items:['bold','italic']},{name:'alignment',items:['alignleft','aligncenter','alignright','alignjustify']},{name:'indentation',items:['outdent','indent']},{name:'permanent pen',items:['permanentpen']},{name:'comments',items:['addcomment']}];var renderFromBridge=function renderFromBridge(bridgeBuilder,render){return function(spec,extras,editor){var internal=bridgeBuilder(spec).mapError(function(errInfo){return formatError(errInfo);}).getOrDie();return render(internal,extras,editor);};};var types={button:renderFromBridge(createToolbarButton,function(s,extras){return renderToolbarButton(s,extras.backstage.shared.providers);}),togglebutton:renderFromBridge(createToggleButton,function(s,extras){return renderToolbarToggleButton(s,extras.backstage.shared.providers);}),menubutton:renderFromBridge(createMenuButton,function(s,extras){return renderMenuButton(s,'tox-tbtn',extras.backstage,Optional.none());}),splitbutton:renderFromBridge(createSplitButton,function(s,extras){return renderSplitButton(s,extras.backstage.shared);}),grouptoolbarbutton:renderFromBridge(createGroupToolbarButton,function(s,extras,editor){var _a;var buttons=editor.ui.registry.getAll().buttons;var identify=function identify(toolbar){return identifyButtons(editor,{buttons:buttons,toolbar:toolbar,allowToolbarGroups:false},extras,Optional.none());};var attributes=(_a={},_a[Attribute]=extras.backstage.shared.header.isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop,_a);switch(getToolbarMode(editor)){case ToolbarMode.floating:return renderFloatingToolbarButton(s,extras.backstage,identify,attributes);default:throw new Error('Toolbar groups are only supported when using floating toolbar mode');}}),styleSelectButton:function styleSelectButton(editor,extras){return createStyleSelect(editor,extras.backstage);},fontsizeSelectButton:function fontsizeSelectButton(editor,extras){return createFontsizeSelect(editor,extras.backstage);},fontSelectButton:function fontSelectButton(editor,extras){return createFontSelect(editor,extras.backstage);},formatButton:function formatButton(editor,extras){return createFormatSelect(editor,extras.backstage);},alignMenuButton:function alignMenuButton(editor,extras){return createAlignSelect(editor,extras.backstage);}};var extractFrom=function extractFrom(spec,extras,editor){return get$e(types,spec.type).fold(function(){console.error('skipping button defined by',spec);return Optional.none();},function(render){return Optional.some(render(spec,extras,editor));});};var bespokeButtons={styleselect:types.styleSelectButton,fontsizeselect:types.fontsizeSelectButton,fontselect:types.fontSelectButton,formatselect:types.formatButton,align:types.alignMenuButton};var removeUnusedDefaults=function removeUnusedDefaults(buttons){var filteredItemGroups=map$2(defaultToolbar,function(group){var items=filter$2(group.items,function(subItem){return has$2(buttons,subItem)||has$2(bespokeButtons,subItem);});return{name:group.name,items:items};});return filter$2(filteredItemGroups,function(group){return group.items.length>0;});};var convertStringToolbar=function convertStringToolbar(strToolbar){var groupsStrings=strToolbar.split('|');return map$2(groupsStrings,function(g){return{items:g.trim().split(' ')};});};var isToolbarGroupSettingArray=function isToolbarGroupSettingArray(toolbar){return isArrayOf(toolbar,function(t){return has$2(t,'name')&&has$2(t,'items');});};var createToolbar=function createToolbar(toolbarConfig){var toolbar=toolbarConfig.toolbar;var buttons=toolbarConfig.buttons;if(toolbar===false){return[];}else if(toolbar===undefined||toolbar===true){return removeUnusedDefaults(buttons);}else if(isString(toolbar)){return convertStringToolbar(toolbar);}else if(isToolbarGroupSettingArray(toolbar)){return toolbar;}else{console.error('Toolbar type should be string, string[], boolean or ToolbarGroup[]');return[];}};var lookupButton=function lookupButton(editor,buttons,toolbarItem,allowToolbarGroups,extras,prefixes){return get$e(buttons,toolbarItem.toLowerCase()).orThunk(function(){return prefixes.bind(function(ps){return findMap(ps,function(prefix){return get$e(buttons,prefix+toolbarItem.toLowerCase());});});}).fold(function(){return get$e(bespokeButtons,toolbarItem.toLowerCase()).map(function(r){return r(editor,extras);}).orThunk(function(){return Optional.none();});},function(spec){if(spec.type==='grouptoolbarbutton'&&!allowToolbarGroups){console.warn('Ignoring the \\''+toolbarItem+'\\' toolbar button. Group toolbar buttons are only supported when using floating toolbar mode and cannot be nested.');return Optional.none();}else{return extractFrom(spec,extras,editor);}});};var identifyButtons=function identifyButtons(editor,toolbarConfig,extras,prefixes){var toolbarGroups=createToolbar(toolbarConfig);var groups=map$2(toolbarGroups,function(group){var items=bind$3(group.items,function(toolbarItem){return toolbarItem.trim().length===0?[]:lookupButton(editor,toolbarConfig.buttons,toolbarItem,toolbarConfig.allowToolbarGroups,extras,prefixes).toArray();});return{title:Optional.from(editor.translate(group.name)),items:items};});return filter$2(groups,function(group){return group.items.length>0;});};var setToolbar=function setToolbar(editor,uiComponents,rawUiConfig,backstage){var comp=uiComponents.outerContainer;var toolbarConfig=rawUiConfig.toolbar;var toolbarButtonsConfig=rawUiConfig.buttons;if(isArrayOf(toolbarConfig,isString)){var toolbars=toolbarConfig.map(function(t){var config={toolbar:t,buttons:toolbarButtonsConfig,allowToolbarGroups:rawUiConfig.allowToolbarGroups};return identifyButtons(editor,config,{backstage:backstage},Optional.none());});OuterContainer.setToolbars(comp,toolbars);}else{OuterContainer.setToolbar(comp,identifyButtons(editor,rawUiConfig,{backstage:backstage},Optional.none()));}};var detection=detect$1();var isiOS12=detection.os.isiOS()&&detection.os.version.major<=12;var setupEvents$1=function setupEvents$1(editor,uiComponents){var dom=editor.dom;var contentWindow=editor.getWin();var initialDocEle=editor.getDoc().documentElement;var lastWindowDimensions=Cell(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight));var lastDocumentDimensions=Cell(SugarPosition(initialDocEle.offsetWidth,initialDocEle.offsetHeight));var resizeWindow=function resizeWindow(){var outer=lastWindowDimensions.get();if(outer.left!==contentWindow.innerWidth||outer.top!==contentWindow.innerHeight){lastWindowDimensions.set(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight));fireResizeContent(editor);}};var resizeDocument=function resizeDocument(){var docEle=editor.getDoc().documentElement;var inner=lastDocumentDimensions.get();if(inner.left!==docEle.offsetWidth||inner.top!==docEle.offsetHeight){lastDocumentDimensions.set(SugarPosition(docEle.offsetWidth,docEle.offsetHeight));fireResizeContent(editor);}};var scroll=function scroll(e){return fireScrollContent(editor,e);};dom.bind(contentWindow,'resize',resizeWindow);dom.bind(contentWindow,'scroll',scroll);var elementLoad=capture(SugarElement.fromDom(editor.getBody()),'load',resizeDocument);var mothership=uiComponents.uiMothership.element;editor.on('hide',function(){set$7(mothership,'display','none');});editor.on('show',function(){remove$6(mothership,'display');});editor.on('NodeChange',resizeDocument);editor.on('remove',function(){elementLoad.unbind();dom.unbind(contentWindow,'resize',resizeWindow);dom.unbind(contentWindow,'scroll',scroll);contentWindow=null;});};var render$1=function render$1(editor,uiComponents,rawUiConfig,backstage,args){var lastToolbarWidth=Cell(0);var outerContainer=uiComponents.outerContainer;iframe(editor);var eTargetNode=SugarElement.fromDom(args.targetNode);var uiRoot=getContentContainer(getRootNode(eTargetNode));attachSystemAfter(eTargetNode,uiComponents.mothership);attachSystem(uiRoot,uiComponents.uiMothership);editor.on('PostRender',function(){setToolbar(editor,uiComponents,rawUiConfig,backstage);lastToolbarWidth.set(editor.getWin().innerWidth);OuterContainer.setMenubar(outerContainer,identifyMenus(editor,rawUiConfig));OuterContainer.setSidebar(outerContainer,rawUiConfig.sidebar);setupEvents$1(editor,uiComponents);});var socket=OuterContainer.getSocket(outerContainer).getOrDie('Could not find expected socket element');if(isiOS12){setAll(socket.element,{'overflow':'scroll','-webkit-overflow-scrolling':'touch'});var limit=first(function(){editor.fire('ScrollContent');},20);var unbinder=bind(socket.element,'scroll',limit.throttle);editor.on('remove',unbinder.unbind);}setupReadonlyModeSwitch(editor,uiComponents);editor.addCommand('ToggleSidebar',function(_ui,value){OuterContainer.toggleSidebar(outerContainer,value);editor.fire('ToggleSidebar');});editor.addQueryValueHandler('ToggleSidebar',function(){return OuterContainer.whichSidebar(outerContainer);});var toolbarMode=getToolbarMode(editor);var refreshDrawer=function refreshDrawer(){OuterContainer.refreshToolbar(uiComponents.outerContainer);};if(toolbarMode===ToolbarMode.sliding||toolbarMode===ToolbarMode.floating){editor.on('ResizeWindow ResizeEditor ResizeContent',function(){var width=editor.getWin().innerWidth;if(width!==lastToolbarWidth.get()){refreshDrawer();lastToolbarWidth.set(width);}});}var api={enable:function enable(){broadcastReadonly(uiComponents,false);},disable:function disable(){broadcastReadonly(uiComponents,true);},isDisabled:function isDisabled(){return Disabling.isDisabled(outerContainer);}};return{iframeContainer:socket.element.dom,editorContainer:outerContainer.element.dom,api:api};};var Iframe=/*#__PURE__*/Object.freeze({__proto__:null,render:render$1});var parseToInt=function parseToInt(val){var re=/^[0-9\\.]+(|px)$/i;if(re.test(''+val)){return Optional.some(parseInt(''+val,10));}return Optional.none();};var numToPx=function numToPx(val){return isNumber(val)?val+'px':val;};var calcCappedSize=function calcCappedSize(size,minSize,maxSize){var minOverride=minSize.filter(function(min){return size<min;});var maxOverride=maxSize.filter(function(max){return size>max;});return minOverride.or(maxOverride).getOr(size);};var getHeight=function getHeight(editor){var baseHeight=getHeightSetting(editor);var minHeight=getMinHeightSetting(editor);var maxHeight=getMaxHeightSetting(editor);return parseToInt(baseHeight).map(function(height){return calcCappedSize(height,minHeight,maxHeight);});};var getHeightWithFallback=function getHeightWithFallback(editor){var height=getHeight(editor);return height.getOr(getHeightSetting(editor));};var getWidth=function getWidth(editor){var baseWidth=getWidthSetting(editor);var minWidth=getMinWidthSetting(editor);var maxWidth=getMaxWidthSetting(editor);return parseToInt(baseWidth).map(function(width){return calcCappedSize(width,minWidth,maxWidth);});};var getWidthWithFallback=function getWidthWithFallback(editor){var width=getWidth(editor);return width.getOr(getWidthSetting(editor));};var InlineHeader=function InlineHeader(editor,targetElm,uiComponents,backstage,floatContainer){var uiMothership=uiComponents.uiMothership,outerContainer=uiComponents.outerContainer;var DOM=global$b.DOM;var useFixedToolbarContainer=useFixedContainer(editor);var isSticky=isStickyToolbar(editor);var editorMaxWidthOpt=getMaxWidthSetting(editor).or(getWidth(editor));var headerBackstage=backstage.shared.header;var isPositionedAtTop=headerBackstage.isPositionedAtTop;var toolbarMode=getToolbarMode(editor);var isSplitToolbar=toolbarMode===ToolbarMode.sliding||toolbarMode===ToolbarMode.floating;var visible=Cell(false);var isVisible=function isVisible(){return visible.get()&&!editor.removed;};var calcToolbarOffset=function calcToolbarOffset(toolbar){return isSplitToolbar?toolbar.fold(constant$1(0),function(tbar){return tbar.components().length>1?get$b(tbar.components()[1].element):0;}):0;};var calcMode=function calcMode(container){switch(getToolbarLocation(editor)){case ToolbarLocation.auto:var toolbar_1=OuterContainer.getToolbar(outerContainer);var offset=calcToolbarOffset(toolbar_1);var toolbarHeight=get$b(container.element)-offset;var targetBounds=box$1(targetElm);var roomAtTop=targetBounds.y>toolbarHeight;if(roomAtTop){return'top';}else{var doc=documentElement(targetElm);var docHeight=Math.max(doc.dom.scrollHeight,get$b(doc));var roomAtBottom=targetBounds.bottom<docHeight-toolbarHeight;if(roomAtBottom){return'bottom';}else{var winBounds=win();var isRoomAtBottomViewport=winBounds.bottom<targetBounds.bottom-toolbarHeight;return isRoomAtBottomViewport?'bottom':'top';}}case ToolbarLocation.bottom:return'bottom';case ToolbarLocation.top:default:return'top';}};var setupMode=function setupMode(mode){var container=floatContainer.get();Docking.setModes(container,[mode]);headerBackstage.setDockingMode(mode);var verticalDir=isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop;set$8(container.element,Attribute,verticalDir);};var updateChromeWidth=function updateChromeWidth(){var maxWidth=editorMaxWidthOpt.getOrThunk(function(){var bodyMargin=parseToInt(get$c(body(),'margin-left')).getOr(0);return get$a(body())-absolute$3(targetElm).left+bodyMargin;});set$7(floatContainer.get().element,'max-width',maxWidth+'px');};var updateChromePosition=function updateChromePosition(){var toolbar=OuterContainer.getToolbar(outerContainer);var offset=calcToolbarOffset(toolbar);var targetBounds=box$1(targetElm);var top=isPositionedAtTop()?Math.max(targetBounds.y-get$b(floatContainer.get().element)+offset,0):targetBounds.bottom;setAll(outerContainer.element,{position:'absolute',top:Math.round(top)+'px',left:Math.round(targetBounds.x)+'px'});};var repositionPopups$1=function repositionPopups$1(){uiMothership.broadcastOn([repositionPopups()],{});};var updateChromeUi=function updateChromeUi(resetDocking){if(resetDocking===void 0){resetDocking=false;}if(!isVisible()){return;}if(!useFixedToolbarContainer){updateChromeWidth();}if(isSplitToolbar){OuterContainer.refreshToolbar(outerContainer);}if(!useFixedToolbarContainer){updateChromePosition();}if(isSticky){var floatContainerComp=floatContainer.get();resetDocking?Docking.reset(floatContainerComp):Docking.refresh(floatContainerComp);}repositionPopups$1();};var updateMode=function updateMode(updateUi){if(updateUi===void 0){updateUi=true;}if(useFixedToolbarContainer||!isSticky||!isVisible()){return;}var currentMode=headerBackstage.getDockingMode();var newMode=calcMode(floatContainer.get());if(newMode!==currentMode){setupMode(newMode);if(updateUi){updateChromeUi(true);}}};var show=function show(){visible.set(true);set$7(outerContainer.element,'display','flex');DOM.addClass(editor.getBody(),'mce-edit-focus');remove$6(uiMothership.element,'display');updateMode(false);updateChromeUi();};var hide=function hide(){visible.set(false);if(uiComponents.outerContainer){set$7(outerContainer.element,'display','none');DOM.removeClass(editor.getBody(),'mce-edit-focus');}set$7(uiMothership.element,'display','none');};return{isVisible:isVisible,isPositionedAtTop:isPositionedAtTop,show:show,hide:hide,update:updateChromeUi,updateMode:updateMode,repositionPopups:repositionPopups$1};};var getTargetPosAndBounds=function getTargetPosAndBounds(targetElm,isToolbarTop){var bounds=box$1(targetElm);return{pos:isToolbarTop?bounds.y:bounds.bottom,bounds:bounds};};var setupEvents=function setupEvents(editor,targetElm,ui,toolbarPersist){var prevPosAndBounds=Cell(getTargetPosAndBounds(targetElm,ui.isPositionedAtTop()));var resizeContent=function resizeContent(e){var _a=getTargetPosAndBounds(targetElm,ui.isPositionedAtTop()),pos=_a.pos,bounds=_a.bounds;var _b=prevPosAndBounds.get(),prevPos=_b.pos,prevBounds=_b.bounds;var hasResized=bounds.height!==prevBounds.height||bounds.width!==prevBounds.width;prevPosAndBounds.set({pos:pos,bounds:bounds});if(hasResized){fireResizeContent(editor,e);}if(ui.isVisible()){if(prevPos!==pos){ui.update(true);}else if(hasResized){ui.updateMode();ui.repositionPopups();}}};if(!toolbarPersist){editor.on('activate',ui.show);editor.on('deactivate',ui.hide);}editor.on('SkinLoaded ResizeWindow',function(){return ui.update(true);});editor.on('NodeChange keydown',function(e){global$f.requestAnimationFrame(function(){return resizeContent(e);});});editor.on('ScrollWindow',function(){return ui.updateMode();});var elementLoad=unbindable();elementLoad.set(capture(SugarElement.fromDom(editor.getBody()),'load',resizeContent));editor.on('remove',function(){elementLoad.clear();});};var render=function render(editor,uiComponents,rawUiConfig,backstage,args){var mothership=uiComponents.mothership,uiMothership=uiComponents.uiMothership,outerContainer=uiComponents.outerContainer;var floatContainer=Cell(null);var targetElm=SugarElement.fromDom(args.targetNode);var ui=InlineHeader(editor,targetElm,uiComponents,backstage,floatContainer);var toolbarPersist=isToolbarPersist(editor);inline(editor);var render=function render(){if(floatContainer.get()){ui.show();return;}floatContainer.set(OuterContainer.getHeader(outerContainer).getOrDie());var uiContainer=getUiContainer(editor);attachSystem(uiContainer,mothership);attachSystem(uiContainer,uiMothership);setToolbar(editor,uiComponents,rawUiConfig,backstage);OuterContainer.setMenubar(outerContainer,identifyMenus(editor,rawUiConfig));ui.show();setupEvents(editor,targetElm,ui,toolbarPersist);editor.nodeChanged();};editor.on('show',render);editor.on('hide',ui.hide);if(!toolbarPersist){editor.on('focus',render);editor.on('blur',ui.hide);}editor.on('init',function(){if(editor.hasFocus()||toolbarPersist){render();}});setupReadonlyModeSwitch(editor,uiComponents);var api={show:function show(){ui.show();},hide:function hide(){ui.hide();},enable:function enable(){broadcastReadonly(uiComponents,false);},disable:function disable(){broadcastReadonly(uiComponents,true);},isDisabled:function isDisabled(){return Disabling.isDisabled(outerContainer);}};return{editorContainer:outerContainer.element.dom,api:api};};var Inline=/*#__PURE__*/Object.freeze({__proto__:null,render:render});var showContextToolbarEvent='contexttoolbar-show';var hideContextToolbarEvent='contexttoolbar-hide';var getFormApi=function getFormApi(input){return{hide:function hide(){return emit(input,sandboxClose());},getValue:function getValue(){return Representing.getValue(input);}};};var runOnExecute=function runOnExecute(memInput,original){return run$1(internalToolbarButtonExecute,function(comp,se){var input=memInput.get(comp);var formApi=getFormApi(input);original.onAction(formApi,se.event.buttonApi);});};var renderContextButton=function renderContextButton(memInput,button,extras){var _a=button.original;_a.primary;var rest=__rest(_a,['primary']);var bridged=getOrDie(createToolbarButton(_assign(_assign({},rest),{type:'button',onAction:noop})));return renderToolbarButtonWith(bridged,extras.backstage.shared.providers,[runOnExecute(memInput,button)]);};var renderContextToggleButton=function renderContextToggleButton(memInput,button,extras){var _a=button.original;_a.primary;var rest=__rest(_a,['primary']);var bridged=getOrDie(createToggleButton(_assign(_assign({},rest),{type:'togglebutton',onAction:noop})));return renderToolbarToggleButtonWith(bridged,extras.backstage.shared.providers,[runOnExecute(memInput,button)]);};var generateOne=function generateOne(memInput,button,providersBackstage){var extras={backstage:{shared:{providers:providersBackstage}}};if(button.type==='contextformtogglebutton'){return renderContextToggleButton(memInput,button,extras);}else{return renderContextButton(memInput,button,extras);}};var generate=function generate(memInput,buttons,providersBackstage){var mementos=map$2(buttons,function(button){return record(generateOne(memInput,button,providersBackstage));});var asSpecs=function asSpecs(){return map$2(mementos,function(mem){return mem.asSpec();});};var findPrimary=function findPrimary(compInSystem){return findMap(buttons,function(button,i){if(button.primary){return Optional.from(mementos[i]).bind(function(mem){return mem.getOpt(compInSystem);}).filter(not(Disabling.isDisabled));}else{return Optional.none();}});};return{asSpecs:asSpecs,findPrimary:findPrimary};};var buildInitGroups=function buildInitGroups(ctx,providers){var inputAttributes=ctx.label.fold(function(){return{};},function(label){return{'aria-label':label};});var memInput=record(Input.sketch({inputClasses:['tox-toolbar-textfield','tox-toolbar-nav-js'],data:ctx.initValue(),inputAttributes:inputAttributes,selectOnFocus:true,inputBehaviours:derive$1([Keying.config({mode:'special',onEnter:function onEnter(input){return commands.findPrimary(input).map(function(primary){emitExecute(primary);return true;});},onLeft:function onLeft(comp,se){se.cut();return Optional.none();},onRight:function onRight(comp,se){se.cut();return Optional.none();}})])}));var commands=generate(memInput,ctx.commands,providers);return[{title:Optional.none(),items:[memInput.asSpec()]},{title:Optional.none(),items:commands.asSpecs()}];};var renderContextForm=function renderContextForm(toolbarType,ctx,providers){return renderToolbar({type:toolbarType,uid:generate$6('context-toolbar'),initGroups:buildInitGroups(ctx,providers),onEscape:Optional.none,cyclicKeying:true,providers:providers});};var ContextForm={renderContextForm:renderContextForm,buildInitGroups:buildInitGroups};var isVerticalOverlap=function isVerticalOverlap(a,b,threshold){if(threshold===void 0){threshold=0.01;}return b.bottom-a.y>=threshold&&a.bottom-b.y>=threshold;};var getRangeRect=function getRangeRect(rng){var rect=rng.getBoundingClientRect();if(rect.height<=0&&rect.width<=0){var leaf$1=leaf(SugarElement.fromDom(rng.startContainer),rng.startOffset).element;var elm=isText$1(leaf$1)?parent(leaf$1):Optional.some(leaf$1);return elm.filter(isElement$2).map(function(e){return e.dom.getBoundingClientRect();}).getOr(rect);}else{return rect;}};var getSelectionBounds=function getSelectionBounds(editor){var rng=editor.selection.getRng();var rect=getRangeRect(rng);if(editor.inline){var scroll_1=get$9();return bounds(scroll_1.left+rect.left,scroll_1.top+rect.top,rect.width,rect.height);}else{var bodyPos=absolute$2(SugarElement.fromDom(editor.getBody()));return bounds(bodyPos.x+rect.left,bodyPos.y+rect.top,rect.width,rect.height);}};var getAnchorElementBounds=function getAnchorElementBounds(editor,lastElement){return lastElement.filter(_inBody).map(absolute$2).getOrThunk(function(){return getSelectionBounds(editor);});};var getHorizontalBounds=function getHorizontalBounds(contentAreaBox,viewportBounds,margin){var x=Math.max(contentAreaBox.x+margin,viewportBounds.x);var right=Math.min(contentAreaBox.right-margin,viewportBounds.right);return{x:x,width:right-x};};var getVerticalBounds=function getVerticalBounds(editor,contentAreaBox,viewportBounds,isToolbarLocationTop,toolbarType,margin){var container=SugarElement.fromDom(editor.getContainer());var header=descendant(container,'.tox-editor-header').getOr(container);var headerBox=box$1(header);var isToolbarBelowContentArea=headerBox.y>=contentAreaBox.bottom;var isToolbarAbove=isToolbarLocationTop&&!isToolbarBelowContentArea;if(editor.inline&&isToolbarAbove){return{y:Math.max(headerBox.bottom+margin,viewportBounds.y),bottom:viewportBounds.bottom};}if(editor.inline&&!isToolbarAbove){return{y:viewportBounds.y,bottom:Math.min(headerBox.y-margin,viewportBounds.bottom)};}var containerBounds=toolbarType==='line'?box$1(container):contentAreaBox;if(isToolbarAbove){return{y:Math.max(headerBox.bottom+margin,viewportBounds.y),bottom:Math.min(containerBounds.bottom-margin,viewportBounds.bottom)};}return{y:Math.max(containerBounds.y+margin,viewportBounds.y),bottom:Math.min(headerBox.y-margin,viewportBounds.bottom)};};var getContextToolbarBounds=function getContextToolbarBounds(editor,sharedBackstage,toolbarType,margin){if(margin===void 0){margin=0;}var viewportBounds=getBounds$3(window);var contentAreaBox=box$1(SugarElement.fromDom(editor.getContentAreaContainer()));var toolbarOrMenubarEnabled=isMenubarEnabled(editor)||isToolbarEnabled(editor)||isMultipleToolbars(editor);var _a=getHorizontalBounds(contentAreaBox,viewportBounds,margin),x=_a.x,width=_a.width;if(editor.inline&&!toolbarOrMenubarEnabled){return bounds(x,viewportBounds.y,width,viewportBounds.height);}else{var isToolbarTop=sharedBackstage.header.isPositionedAtTop();var _b=getVerticalBounds(editor,contentAreaBox,viewportBounds,isToolbarTop,toolbarType,margin),y=_b.y,bottom=_b.bottom;return bounds(x,y,width,bottom-y);}};var bubbleSize$1=12;var bubbleAlignments$1={valignCentre:[],alignCentre:[],alignLeft:['tox-pop--align-left'],alignRight:['tox-pop--align-right'],right:['tox-pop--right'],left:['tox-pop--left'],bottom:['tox-pop--bottom'],top:['tox-pop--top'],inset:['tox-pop--inset']};var anchorOverrides={maxHeightFunction:expandable$1(),maxWidthFunction:expandable()};var isEntireElementSelected=function isEntireElementSelected(editor,elem){var rng=editor.selection.getRng();var leaf$1=leaf(SugarElement.fromDom(rng.startContainer),rng.startOffset);return rng.startContainer===rng.endContainer&&rng.startOffset===rng.endOffset-1&&eq(leaf$1.element,elem);};var preservePosition=function preservePosition(elem,position,f){var currentPosition=getRaw(elem,'position');set$7(elem,'position',position);var result=f(elem);currentPosition.each(function(pos){return set$7(elem,'position',pos);});return result;};var shouldUseInsetLayouts=function shouldUseInsetLayouts(position){return position==='node';};var determineInsetLayout=function determineInsetLayout(editor,contextbar,elem,data,bounds){var selectionBounds=getSelectionBounds(editor);var isSameAnchorElement=data.lastElement().exists(function(prev){return eq(elem,prev);});if(isEntireElementSelected(editor,elem)){return isSameAnchorElement?preserve:north;}else if(isSameAnchorElement){return preservePosition(contextbar,data.getMode(),function(){var isOverlapping=isVerticalOverlap(selectionBounds,box$1(contextbar));return isOverlapping&&!data.isReposition()?flip$2:preserve;});}else{var yBounds=data.getMode()==='fixed'?bounds.y+get$9().top:bounds.y;var contextbarHeight=get$b(contextbar)+bubbleSize$1;return yBounds+contextbarHeight<=selectionBounds.y?north:south;}};var getAnchorSpec$2=function getAnchorSpec$2(editor,mobile,data,position){var smartInsetLayout=function smartInsetLayout(elem){return function(anchor,element,bubbles,placee,bounds){var layout=determineInsetLayout(editor,placee,elem,data,bounds);var newAnchor=_assign(_assign({},anchor),{y:bounds.y,height:bounds.height});return _assign(_assign({},layout(newAnchor,element,bubbles,placee,bounds)),{alwaysFit:true});};};var getInsetLayouts=function getInsetLayouts(elem){return shouldUseInsetLayouts(position)?[smartInsetLayout(elem)]:[];};var desktopAnchorSpecLayouts={onLtr:function onLtr(elem){return[north$2,south$2,northeast$2,southeast$2,northwest$2,southwest$2].concat(getInsetLayouts(elem));},onRtl:function onRtl(elem){return[north$2,south$2,northwest$2,southwest$2,northeast$2,southeast$2].concat(getInsetLayouts(elem));}};var mobileAnchorSpecLayouts={onLtr:function onLtr(elem){return[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2].concat(getInsetLayouts(elem));},onRtl:function onRtl(elem){return[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2].concat(getInsetLayouts(elem));}};return mobile?mobileAnchorSpecLayouts:desktopAnchorSpecLayouts;};var getAnchorLayout=function getAnchorLayout(editor,position,isTouch,data){if(position==='line'){return{bubble:nu$5(bubbleSize$1,0,bubbleAlignments$1),layouts:{onLtr:function onLtr(){return[east$2];},onRtl:function onRtl(){return[west$2];}},overrides:anchorOverrides};}else{return{bubble:nu$5(0,bubbleSize$1,bubbleAlignments$1,1/bubbleSize$1),layouts:getAnchorSpec$2(editor,isTouch,data,position),overrides:anchorOverrides};}};var matchTargetWith=function matchTargetWith(elem,candidates){var ctxs=filter$2(candidates,function(toolbarApi){return toolbarApi.predicate(elem.dom);});var _a=partition$3(ctxs,function(t){return t.type==='contexttoolbar';}),pass=_a.pass,fail=_a.fail;return{contextToolbars:pass,contextForms:fail};};var filterByPositionForStartNode=function filterByPositionForStartNode(toolbars){if(toolbars.length<=1){return toolbars;}else{var doesPositionExist=function doesPositionExist(value){return exists(toolbars,function(t){return t.position===value;});};var filterToolbarsByPosition=function filterToolbarsByPosition(value){return filter$2(toolbars,function(t){return t.position===value;});};var hasSelectionToolbars=doesPositionExist('selection');var hasNodeToolbars=doesPositionExist('node');if(hasSelectionToolbars||hasNodeToolbars){if(hasNodeToolbars&&hasSelectionToolbars){var nodeToolbars=filterToolbarsByPosition('node');var selectionToolbars=map$2(filterToolbarsByPosition('selection'),function(t){return _assign(_assign({},t),{position:'node'});});return nodeToolbars.concat(selectionToolbars);}else{return hasSelectionToolbars?filterToolbarsByPosition('selection'):filterToolbarsByPosition('node');}}else{return filterToolbarsByPosition('line');}}};var filterByPositionForAncestorNode=function filterByPositionForAncestorNode(toolbars){if(toolbars.length<=1){return toolbars;}else{var findPosition_1=function findPosition_1(value){return find$5(toolbars,function(t){return t.position===value;});};var basePosition=findPosition_1('selection').orThunk(function(){return findPosition_1('node');}).orThunk(function(){return findPosition_1('line');}).map(function(t){return t.position;});return basePosition.fold(function(){return[];},function(pos){return filter$2(toolbars,function(t){return t.position===pos;});});}};var matchStartNode=function matchStartNode(elem,nodeCandidates,editorCandidates){var nodeMatches=matchTargetWith(elem,nodeCandidates);if(nodeMatches.contextForms.length>0){return Optional.some({elem:elem,toolbars:[nodeMatches.contextForms[0]]});}else{var editorMatches=matchTargetWith(elem,editorCandidates);if(editorMatches.contextForms.length>0){return Optional.some({elem:elem,toolbars:[editorMatches.contextForms[0]]});}else if(nodeMatches.contextToolbars.length>0||editorMatches.contextToolbars.length>0){var toolbars=filterByPositionForStartNode(nodeMatches.contextToolbars.concat(editorMatches.contextToolbars));return Optional.some({elem:elem,toolbars:toolbars});}else{return Optional.none();}}};var matchAncestor=function matchAncestor(isRoot,startNode,scopes){if(isRoot(startNode)){return Optional.none();}else{return ancestor$2(startNode,function(ancestorElem){if(isElement$2(ancestorElem)){var _a=matchTargetWith(ancestorElem,scopes.inNodeScope),contextToolbars=_a.contextToolbars,contextForms=_a.contextForms;var toolbars=contextForms.length>0?contextForms:filterByPositionForAncestorNode(contextToolbars);return toolbars.length>0?Optional.some({elem:ancestorElem,toolbars:toolbars}):Optional.none();}else{return Optional.none();}},isRoot);}};var lookup$1=function lookup$1(scopes,editor){var rootElem=SugarElement.fromDom(editor.getBody());var isRoot=function isRoot(elem){return eq(elem,rootElem);};var isOutsideRoot=function isOutsideRoot(startNode){return!isRoot(startNode)&&!contains(rootElem,startNode);};var startNode=SugarElement.fromDom(editor.selection.getNode());if(isOutsideRoot(startNode)){return Optional.none();}return matchStartNode(startNode,scopes.inNodeScope,scopes.inEditorScope).orThunk(function(){return matchAncestor(isRoot,startNode,scopes);});};var categorise=function categorise(contextToolbars,navigate){var forms={};var inNodeScope=[];var inEditorScope=[];var formNavigators={};var lookupTable={};var registerForm=function registerForm(key,toolbarSpec){var contextForm=getOrDie(createContextForm(toolbarSpec));forms[key]=contextForm;contextForm.launch.map(function(launch){formNavigators['form:'+key+'']=_assign(_assign({},toolbarSpec.launch),{type:launch.type==='contextformtogglebutton'?'togglebutton':'button',onAction:function onAction(){navigate(contextForm);}});});if(contextForm.scope==='editor'){inEditorScope.push(contextForm);}else{inNodeScope.push(contextForm);}lookupTable[key]=contextForm;};var registerToolbar=function registerToolbar(key,toolbarSpec){createContextToolbar(toolbarSpec).each(function(contextToolbar){if(toolbarSpec.scope==='editor'){inEditorScope.push(contextToolbar);}else{inNodeScope.push(contextToolbar);}lookupTable[key]=contextToolbar;});};var keys$1=keys(contextToolbars);each$1(keys$1,function(key){var toolbarApi=contextToolbars[key];if(toolbarApi.type==='contextform'){registerForm(key,toolbarApi);}else if(toolbarApi.type==='contexttoolbar'){registerToolbar(key,toolbarApi);}});return{forms:forms,inNodeScope:inNodeScope,inEditorScope:inEditorScope,lookupTable:lookupTable,formNavigators:formNavigators};};var forwardSlideEvent=generate$6('forward-slide');var backSlideEvent=generate$6('backward-slide');var changeSlideEvent=generate$6('change-slide-event');var resizingClass='tox-pop--resizing';var renderContextToolbar=function renderContextToolbar(spec){var stack=Cell([]);return InlineView.sketch({dom:{tag:'div',classes:['tox-pop']},fireDismissalEventInstead:{event:'doNotDismissYet'},onShow:function onShow(comp){stack.set([]);InlineView.getContent(comp).each(function(c){remove$6(c.element,'visibility');});remove$2(comp.element,resizingClass);remove$6(comp.element,'width');},inlineBehaviours:derive$1([config('context-toolbar-events',[runOnSource(transitionend(),function(comp,se){if(se.event.raw.propertyName==='width'){remove$2(comp.element,resizingClass);remove$6(comp.element,'width');}}),run$1(changeSlideEvent,function(comp,se){var elem=comp.element;remove$6(elem,'width');var currentWidth=get$a(elem);InlineView.setContent(comp,se.event.contents);add$2(elem,resizingClass);var newWidth=get$a(elem);set$7(elem,'width',currentWidth+'px');InlineView.getContent(comp).each(function(newContents){se.event.focus.bind(function(f){focus$3(f);return search(elem);}).orThunk(function(){Keying.focusIn(newContents);return active(getRootNode(elem));});});global$f.setTimeout(function(){set$7(comp.element,'width',newWidth+'px');},0);}),run$1(forwardSlideEvent,function(comp,se){InlineView.getContent(comp).each(function(oldContents){stack.set(stack.get().concat([{bar:oldContents,focus:active(getRootNode(comp.element))}]));});emitWith(comp,changeSlideEvent,{contents:se.event.forwardContents,focus:Optional.none()});}),run$1(backSlideEvent,function(comp,_se){last$2(stack.get()).each(function(last){stack.set(stack.get().slice(0,stack.get().length-1));emitWith(comp,changeSlideEvent,{contents:premade(last.bar),focus:last.focus});});})]),Keying.config({mode:'special',onEscape:function onEscape(comp){return last$2(stack.get()).fold(function(){return spec.onEscape();},function(_){emit(comp,backSlideEvent);return Optional.some(true);});}})]),lazySink:function lazySink(){return Result.value(spec.sink);}});};var transitionClass='tox-pop--transition';var register$7=function register$7(editor,registryContextToolbars,sink,extras){var backstage=extras.backstage;var sharedBackstage=backstage.shared;var isTouch=detect$1().deviceType.isTouch;var lastElement=value$1();var lastTrigger=value$1();var lastContextPosition=value$1();var contextbar=build$1(renderContextToolbar({sink:sink,onEscape:function onEscape(){editor.focus();return Optional.some(true);}}));var getBounds=function getBounds(){var position=lastContextPosition.get().getOr('node');var margin=shouldUseInsetLayouts(position)?1:0;return getContextToolbarBounds(editor,sharedBackstage,position,margin);};var canLaunchToolbar=function canLaunchToolbar(){return!editor.removed&&!(isTouch()&&backstage.isContextMenuOpen());};var isSameLaunchElement=function isSameLaunchElement(elem){return is$1(lift2(elem,lastElement.get(),eq),true);};var shouldContextToolbarHide=function shouldContextToolbarHide(){if(!canLaunchToolbar()){return true;}else{var contextToolbarBounds=getBounds();var anchorBounds=is$1(lastContextPosition.get(),'node')?getAnchorElementBounds(editor,lastElement.get()):getSelectionBounds(editor);return contextToolbarBounds.height<=0||!isVerticalOverlap(anchorBounds,contextToolbarBounds);}};var close=function close(){lastElement.clear();lastTrigger.clear();lastContextPosition.clear();InlineView.hide(contextbar);};var hideOrRepositionIfNecessary=function hideOrRepositionIfNecessary(){if(InlineView.isOpen(contextbar)){var contextBarEle=contextbar.element;remove$6(contextBarEle,'display');if(shouldContextToolbarHide()){set$7(contextBarEle,'display','none');}else{lastTrigger.set(0);InlineView.reposition(contextbar);}}};var wrapInPopDialog=function wrapInPopDialog(toolbarSpec){return{dom:{tag:'div',classes:['tox-pop__dialog']},components:[toolbarSpec],behaviours:derive$1([Keying.config({mode:'acyclic'}),config('pop-dialog-wrap-events',[runOnAttached(function(comp){editor.shortcuts.add('ctrl+F9','focus statusbar',function(){return Keying.focusIn(comp);});}),runOnDetached(function(_comp){editor.shortcuts.remove('ctrl+F9');})])])};};var getScopes=cached(function(){return categorise(registryContextToolbars,function(toolbarApi){var alloySpec=buildToolbar([toolbarApi]);emitWith(contextbar,forwardSlideEvent,{forwardContents:wrapInPopDialog(alloySpec)});});});var buildContextToolbarGroups=function buildContextToolbarGroups(allButtons,ctx){return identifyButtons(editor,{buttons:allButtons,toolbar:ctx.items,allowToolbarGroups:false},extras,Optional.some(['form:']));};var buildContextFormGroups=function buildContextFormGroups(ctx,providers){return ContextForm.buildInitGroups(ctx,providers);};var buildToolbar=function buildToolbar(toolbars){var buttons=editor.ui.registry.getAll().buttons;var scopes=getScopes();var allButtons=_assign(_assign({},buttons),scopes.formNavigators);var toolbarType=getToolbarMode(editor)===ToolbarMode.scrolling?ToolbarMode.scrolling:ToolbarMode.default;var initGroups=flatten(map$2(toolbars,function(ctx){return ctx.type==='contexttoolbar'?buildContextToolbarGroups(allButtons,ctx):buildContextFormGroups(ctx,sharedBackstage.providers);}));return renderToolbar({type:toolbarType,uid:generate$6('context-toolbar'),initGroups:initGroups,onEscape:Optional.none,cyclicKeying:true,providers:sharedBackstage.providers});};var getAnchor=function getAnchor(position,element){var anchorage=position==='node'?sharedBackstage.anchors.node(element):sharedBackstage.anchors.cursor();var anchorLayout=getAnchorLayout(editor,position,isTouch(),{lastElement:lastElement.get,isReposition:function isReposition(){return is$1(lastTrigger.get(),0);},getMode:function getMode(){return Positioning.getMode(sink);}});return deepMerge(anchorage,anchorLayout);};var launchContext=function launchContext(toolbarApi,elem){launchContextToolbar.cancel();if(!canLaunchToolbar()){return;}var toolbarSpec=buildToolbar(toolbarApi);var position=toolbarApi[0].position;var anchor=getAnchor(position,elem);lastContextPosition.set(position);lastTrigger.set(1);var contextBarEle=contextbar.element;remove$6(contextBarEle,'display');if(!isSameLaunchElement(elem)){remove$2(contextBarEle,transitionClass);Positioning.reset(sink,contextbar);}InlineView.showWithinBounds(contextbar,wrapInPopDialog(toolbarSpec),{anchor:anchor,transition:{classes:[transitionClass],mode:'placement'}},function(){return Optional.some(getBounds());});elem.fold(lastElement.clear,lastElement.set);if(shouldContextToolbarHide()){set$7(contextBarEle,'display','none');}};var launchContextToolbar=last(function(){if(!editor.hasFocus()||editor.removed){return;}if(has(contextbar.element,transitionClass)){launchContextToolbar.throttle();}else{var scopes=getScopes();lookup$1(scopes,editor).fold(close,function(info){launchContext(info.toolbars,Optional.some(info.elem));});}},17);editor.on('init',function(){editor.on('remove',close);editor.on('ScrollContent ScrollWindow ObjectResized ResizeEditor longpress',hideOrRepositionIfNecessary);editor.on('click keyup focus SetContent',launchContextToolbar.throttle);editor.on(hideContextToolbarEvent,close);editor.on(showContextToolbarEvent,function(e){var scopes=getScopes();get$e(scopes.lookupTable,e.toolbarKey).each(function(ctx){launchContext([ctx],someIf(e.target!==editor,e.target));InlineView.getContent(contextbar).each(Keying.focusIn);});});editor.on('focusout',function(_e){global$f.setEditorTimeout(editor,function(){if(search(sink.element).isNone()&&search(contextbar.element).isNone()){close();}},0);});editor.on('SwitchMode',function(){if(editor.mode.isReadOnly()){close();}});editor.on('AfterProgressState',function(event){if(event.state){close();}else if(editor.hasFocus()){launchContextToolbar.throttle();}});editor.on('NodeChange',function(_e){search(contextbar.element).fold(launchContextToolbar.throttle,noop);});});};var register$6=function register$6(editor){var alignToolbarButtons=[{name:'alignleft',text:'Align left',cmd:'JustifyLeft',icon:'align-left'},{name:'aligncenter',text:'Align center',cmd:'JustifyCenter',icon:'align-center'},{name:'alignright',text:'Align right',cmd:'JustifyRight',icon:'align-right'},{name:'alignjustify',text:'Justify',cmd:'JustifyFull',icon:'align-justify'}];each$1(alignToolbarButtons,function(item){editor.ui.registry.addToggleButton(item.name,{tooltip:item.text,icon:item.icon,onAction:onActionExecCommand(editor,item.cmd),onSetup:onSetupFormatToggle(editor,item.name)});});editor.ui.registry.addButton('alignnone',{tooltip:'No alignment',icon:'align-none',onAction:onActionExecCommand(editor,'JustifyNone')});};var units={unsupportedLength:['em','ex','cap','ch','ic','rem','lh','rlh','vw','vh','vi','vb','vmin','vmax','cm','mm','Q','in','pc','pt','px'],fixed:['px','pt'],relative:['%'],empty:['']};var pattern=function(){var decimalDigits='[0-9]+';var signedInteger='[+-]?'+decimalDigits;var exponentPart='[eE]'+signedInteger;var dot='\\\\.';var opt=function opt(input){return'(?:'+input+')?';};var unsignedDecimalLiteral=['Infinity',decimalDigits+dot+opt(decimalDigits)+opt(exponentPart),dot+decimalDigits+opt(exponentPart),decimalDigits+opt(exponentPart)].join('|');var float='[+-]?(?:'+unsignedDecimalLiteral+')';return new RegExp('^('+float+')(.*)$');}();var isUnit=function isUnit(unit,accepted){return exists(accepted,function(acc){return exists(units[acc],function(check){return unit===check;});});};var parse=function parse(input,accepted){var match=Optional.from(pattern.exec(input));return match.bind(function(array){var value=Number(array[1]);var unitRaw=array[2];if(isUnit(unitRaw,accepted)){return Optional.some({value:value,unit:unitRaw});}else{return Optional.none();}});};var normalise=function normalise(input,accepted){return parse(input,accepted).map(function(_a){var value=_a.value,unit=_a.unit;return value+unit;});};var registerController=function registerController(editor,spec){var getMenuItems=function getMenuItems(){var options=spec.getOptions(editor);var initial=spec.getCurrent(editor).map(spec.hash);var current=value$1();return map$2(options,function(value){return{type:'togglemenuitem',text:spec.display(value),onSetup:function onSetup(api){var setActive=function setActive(active){if(active){current.on(function(oldApi){return oldApi.setActive(false);});current.set(api);}api.setActive(active);};setActive(is$1(initial,spec.hash(value)));var unbindWatcher=spec.watcher(editor,value,setActive);return function(){current.clear();unbindWatcher();};},onAction:function onAction(){return spec.setCurrent(editor,value);}};});};editor.ui.registry.addMenuButton(spec.name,{tooltip:spec.text,icon:spec.icon,fetch:function fetch(callback){return callback(getMenuItems());},onSetup:spec.onToolbarSetup});editor.ui.registry.addNestedMenuItem(spec.name,{type:'nestedmenuitem',text:spec.text,getSubmenuItems:getMenuItems,onSetup:spec.onMenuSetup});};var lineHeightSpec={name:'lineheight',text:'Line height',icon:'line-height',getOptions:getLineHeightFormats,hash:function hash(input){return normalise(input,['fixed','relative','empty']).getOr(input);},display:identity$1,watcher:function watcher(editor,value,callback){return editor.formatter.formatChanged('lineheight',callback,false,{value:value}).unbind;},getCurrent:function getCurrent(editor){return Optional.from(editor.queryCommandValue('LineHeight'));},setCurrent:function setCurrent(editor,value){return editor.execCommand('LineHeight',false,value);}};var languageSpec=function languageSpec(editor){var settingsOpt=Optional.from(getContentLanguages(editor));return settingsOpt.map(function(settings){return{name:'language',text:'Language',icon:'language',getOptions:constant$1(settings),hash:function hash(input){return isUndefined(input.customCode)?input.code:input.code+'/'+input.customCode;},display:function display(input){return input.title;},watcher:function watcher(editor,value,callback){return editor.formatter.formatChanged('lang',callback,false,{value:value.code,customValue:value.customCode}).unbind;},getCurrent:function getCurrent(editor){var node=SugarElement.fromDom(editor.selection.getNode());return closest$4(node,function(n){return Optional.some(n).filter(isElement$2).bind(function(ele){var codeOpt=getOpt(ele,'lang');return codeOpt.map(function(code){var customCode=getOpt(ele,'data-mce-lang').getOrUndefined();return{code:code,customCode:customCode,title:''};});});});},setCurrent:function setCurrent(editor,lang){return editor.execCommand('Lang',false,lang);},onToolbarSetup:function onToolbarSetup(api){var unbinder=unbindable();api.setActive(editor.formatter.match('lang',{},undefined,true));unbinder.set(editor.formatter.formatChanged('lang',api.setActive,true));return unbinder.clear;}};});};var register$5=function register$5(editor){registerController(editor,lineHeightSpec);languageSpec(editor).each(function(spec){return registerController(editor,spec);});};var register$4=function register$4(editor,backstage){alignSelectMenu(editor,backstage);fontSelectMenu(editor,backstage);styleSelectMenu(editor,backstage);formatSelectMenu(editor,backstage);fontsizeSelectMenu(editor,backstage);};var onSetupOutdentState=function onSetupOutdentState(editor){return onSetupEvent(editor,'NodeChange',function(api){api.setDisabled(!editor.queryCommandState('outdent'));});};var registerButtons$2=function registerButtons$2(editor){editor.ui.registry.addButton('outdent',{tooltip:'Decrease indent',icon:'outdent',onSetup:onSetupOutdentState(editor),onAction:onActionExecCommand(editor,'outdent')});editor.ui.registry.addButton('indent',{tooltip:'Increase indent',icon:'indent',onAction:onActionExecCommand(editor,'indent')});};var register$3=function register$3(editor){registerButtons$2(editor);};var onActionToggleFormat=function onActionToggleFormat(editor,fmt){return function(){editor.execCommand('mceToggleFormat',false,fmt);};};var registerFormatButtons=function registerFormatButtons(editor){global$5.each([{name:'bold',text:'Bold',icon:'bold'},{name:'italic',text:'Italic',icon:'italic'},{name:'underline',text:'Underline',icon:'underline'},{name:'strikethrough',text:'Strikethrough',icon:'strike-through'},{name:'subscript',text:'Subscript',icon:'subscript'},{name:'superscript',text:'Superscript',icon:'superscript'}],function(btn,_idx){editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onSetup:onSetupFormatToggle(editor,btn.name),onAction:onActionToggleFormat(editor,btn.name)});});for(var i=1;i<=6;i++){var name_1='h'+i;editor.ui.registry.addToggleButton(name_1,{text:name_1.toUpperCase(),tooltip:'Heading '+i,onSetup:onSetupFormatToggle(editor,name_1),onAction:onActionToggleFormat(editor,name_1)});}};var registerCommandButtons=function registerCommandButtons(editor){global$5.each([{name:'cut',text:'Cut',action:'Cut',icon:'cut'},{name:'copy',text:'Copy',action:'Copy',icon:'copy'},{name:'paste',text:'Paste',action:'Paste',icon:'paste'},{name:'help',text:'Help',action:'mceHelp',icon:'help'},{name:'selectall',text:'Select all',action:'SelectAll',icon:'select-all'},{name:'newdocument',text:'New document',action:'mceNewDocument',icon:'new-document'},{name:'removeformat',text:'Clear formatting',action:'RemoveFormat',icon:'remove-formatting'},{name:'remove',text:'Remove',action:'Delete',icon:'remove'}],function(btn){editor.ui.registry.addButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action)});});};var registerCommandToggleButtons=function registerCommandToggleButtons(editor){global$5.each([{name:'blockquote',text:'Blockquote',action:'mceBlockQuote',icon:'quote'}],function(btn){editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action),onSetup:onSetupFormatToggle(editor,btn.name)});});};var registerButtons$1=function registerButtons$1(editor){registerFormatButtons(editor);registerCommandButtons(editor);registerCommandToggleButtons(editor);};var registerMenuItems$2=function registerMenuItems$2(editor){global$5.each([{name:'bold',text:'Bold',action:'Bold',icon:'bold',shortcut:'Meta+B'},{name:'italic',text:'Italic',action:'Italic',icon:'italic',shortcut:'Meta+I'},{name:'underline',text:'Underline',action:'Underline',icon:'underline',shortcut:'Meta+U'},{name:'strikethrough',text:'Strikethrough',action:'Strikethrough',icon:'strike-through',shortcut:''},{name:'subscript',text:'Subscript',action:'Subscript',icon:'subscript',shortcut:''},{name:'superscript',text:'Superscript',action:'Superscript',icon:'superscript',shortcut:''},{name:'removeformat',text:'Clear formatting',action:'RemoveFormat',icon:'remove-formatting',shortcut:''},{name:'newdocument',text:'New document',action:'mceNewDocument',icon:'new-document',shortcut:''},{name:'cut',text:'Cut',action:'Cut',icon:'cut',shortcut:'Meta+X'},{name:'copy',text:'Copy',action:'Copy',icon:'copy',shortcut:'Meta+C'},{name:'paste',text:'Paste',action:'Paste',icon:'paste',shortcut:'Meta+V'},{name:'selectall',text:'Select all',action:'SelectAll',icon:'select-all',shortcut:'Meta+A'}],function(btn){editor.ui.registry.addMenuItem(btn.name,{text:btn.text,icon:btn.icon,shortcut:btn.shortcut,onAction:onActionExecCommand(editor,btn.action)});});editor.ui.registry.addMenuItem('codeformat',{text:'Code',icon:'sourcecode',onAction:onActionToggleFormat(editor,'code')});};var register$2=function register$2(editor){registerButtons$1(editor);registerMenuItems$2(editor);};var onSetupUndoRedoState=function onSetupUndoRedoState(editor,type){return onSetupEvent(editor,'Undo Redo AddUndo TypingUndo ClearUndos SwitchMode',function(api){api.setDisabled(editor.mode.isReadOnly()||!editor.undoManager[type]());});};var registerMenuItems$1=function registerMenuItems$1(editor){editor.ui.registry.addMenuItem('undo',{text:'Undo',icon:'undo',shortcut:'Meta+Z',onSetup:onSetupUndoRedoState(editor,'hasUndo'),onAction:onActionExecCommand(editor,'undo')});editor.ui.registry.addMenuItem('redo',{text:'Redo',icon:'redo',shortcut:'Meta+Y',onSetup:onSetupUndoRedoState(editor,'hasRedo'),onAction:onActionExecCommand(editor,'redo')});};var registerButtons=function registerButtons(editor){editor.ui.registry.addButton('undo',{tooltip:'Undo',icon:'undo',disabled:true,onSetup:onSetupUndoRedoState(editor,'hasUndo'),onAction:onActionExecCommand(editor,'undo')});editor.ui.registry.addButton('redo',{tooltip:'Redo',icon:'redo',disabled:true,onSetup:onSetupUndoRedoState(editor,'hasRedo'),onAction:onActionExecCommand(editor,'redo')});};var register$1=function register$1(editor){registerMenuItems$1(editor);registerButtons(editor);};var onSetupVisualAidState=function onSetupVisualAidState(editor){return onSetupEvent(editor,'VisualAid',function(api){api.setActive(editor.hasVisual);});};var registerMenuItems=function registerMenuItems(editor){editor.ui.registry.addToggleMenuItem('visualaid',{text:'Visual aids',onSetup:onSetupVisualAidState(editor),onAction:onActionExecCommand(editor,'mceToggleVisualAid')});};var registerToolbarButton=function registerToolbarButton(editor){editor.ui.registry.addButton('visualaid',{tooltip:'Visual aids',text:'Visual aids',onAction:onActionExecCommand(editor,'mceToggleVisualAid')});};var register=function register(editor){registerToolbarButton(editor);registerMenuItems(editor);};var setup$6=function setup$6(editor,backstage){register$6(editor);register$2(editor);register$4(editor,backstage);register$1(editor);register$a(editor);register(editor);register$3(editor);register$5(editor);};var nu=function nu(x,y){return{type:'makeshift',x:x,y:y};};var transpose=function transpose(pos,dx,dy){return nu(pos.x+dx,pos.y+dy);};var isTouchEvent=function isTouchEvent(e){return e.type==='longpress'||e.type.indexOf('touch')===0;};var fromPageXY=function fromPageXY(e){if(isTouchEvent(e)){var touch=e.touches[0];return nu(touch.pageX,touch.pageY);}else{return nu(e.pageX,e.pageY);}};var fromClientXY=function fromClientXY(e){if(isTouchEvent(e)){var touch=e.touches[0];return nu(touch.clientX,touch.clientY);}else{return nu(e.clientX,e.clientY);}};var transposeContentAreaContainer=function transposeContentAreaContainer(element,pos){var containerPos=global$b.DOM.getPos(element);return transpose(pos,containerPos.x,containerPos.y);};var getPointAnchor=function getPointAnchor(editor,e){if(e.type==='contextmenu'||e.type==='longpress'){if(editor.inline){return fromPageXY(e);}else{return transposeContentAreaContainer(editor.getContentAreaContainer(),fromClientXY(e));}}else{return getSelectionAnchor(editor);}};var getSelectionAnchor=function getSelectionAnchor(editor){return{type:'selection',root:SugarElement.fromDom(editor.selection.getNode())};};var getNodeAnchor=function getNodeAnchor(editor){return{type:'node',node:Optional.some(SugarElement.fromDom(editor.selection.getNode())),root:SugarElement.fromDom(editor.getBody())};};var getAnchorSpec$1=function getAnchorSpec$1(editor,e,anchorType){switch(anchorType){case'node':return getNodeAnchor(editor);case'point':return getPointAnchor(editor,e);case'selection':return getSelectionAnchor(editor);}};var initAndShow$1=function initAndShow$1(editor,e,buildMenu,backstage,contextmenu,anchorType){var items=buildMenu();var anchorSpec=getAnchorSpec$1(editor,e,anchorType);build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,false).map(function(menuData){e.preventDefault();InlineView.showMenuAt(contextmenu,{anchor:anchorSpec},{menu:{markers:markers('normal')},data:menuData});});};var layouts={onLtr:function onLtr(){return[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2,north,south,northeast,southeast,northwest,southwest];},onRtl:function onRtl(){return[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2,north,south,northwest,southwest,northeast,southeast];}};var bubbleSize=12;var bubbleAlignments={valignCentre:[],alignCentre:[],alignLeft:['tox-pop--align-left'],alignRight:['tox-pop--align-right'],right:['tox-pop--right'],left:['tox-pop--left'],bottom:['tox-pop--bottom'],top:['tox-pop--top']};var isTouchWithinSelection=function isTouchWithinSelection(editor,e){var selection=editor.selection;if(selection.isCollapsed()||e.touches.length<1){return false;}else{var touch_1=e.touches[0];var rng=selection.getRng();var rngRectOpt=getFirstRect(editor.getWin(),SimSelection.domRange(rng));return rngRectOpt.exists(function(rngRect){return rngRect.left<=touch_1.clientX&&rngRect.right>=touch_1.clientX&&rngRect.top<=touch_1.clientY&&rngRect.bottom>=touch_1.clientY;});}};var setupiOSOverrides=function setupiOSOverrides(editor){var originalSelection=editor.selection.getRng();var selectionReset=function selectionReset(){global$f.setEditorTimeout(editor,function(){editor.selection.setRng(originalSelection);},10);unbindEventListeners();};editor.once('touchend',selectionReset);var preventMousedown=function preventMousedown(e){e.preventDefault();e.stopImmediatePropagation();};editor.on('mousedown',preventMousedown,true);var clearSelectionReset=function clearSelectionReset(){return unbindEventListeners();};editor.once('longpresscancel',clearSelectionReset);var unbindEventListeners=function unbindEventListeners(){editor.off('touchend',selectionReset);editor.off('longpresscancel',clearSelectionReset);editor.off('mousedown',preventMousedown);};};var getAnchorSpec=function getAnchorSpec(editor,e,anchorType){var anchorSpec=getAnchorSpec$1(editor,e,anchorType);var bubbleYOffset=anchorType==='point'?bubbleSize:0;return _assign({bubble:nu$5(0,bubbleYOffset,bubbleAlignments),layouts:layouts,overrides:{maxWidthFunction:expandable(),maxHeightFunction:expandable$1()}},anchorSpec);};var show=function show(editor,e,items,backstage,contextmenu,anchorType,highlightImmediately){var anchorSpec=getAnchorSpec(editor,e,anchorType);build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,true).map(function(menuData){e.preventDefault();InlineView.showMenuWithinBounds(contextmenu,{anchor:anchorSpec},{menu:{markers:markers('normal'),highlightImmediately:highlightImmediately},data:menuData,type:'horizontal'},function(){return Optional.some(getContextToolbarBounds(editor,backstage.shared,anchorType==='node'?'node':'selection'));});editor.fire(hideContextToolbarEvent);});};var initAndShow=function initAndShow(editor,e,buildMenu,backstage,contextmenu,anchorType){var detection=detect$1();var isiOS=detection.os.isiOS();var isOSX=detection.os.isOSX();var isAndroid=detection.os.isAndroid();var isTouch=detection.deviceType.isTouch();var shouldHighlightImmediately=function shouldHighlightImmediately(){return!(isAndroid||isiOS||isOSX&&isTouch);};var open=function open(){var items=buildMenu();show(editor,e,items,backstage,contextmenu,anchorType,shouldHighlightImmediately());};if((isOSX||isiOS)&&anchorType!=='node'){var openiOS_1=function openiOS_1(){setupiOSOverrides(editor);open();};if(isTouchWithinSelection(editor,e)){openiOS_1();}else{editor.once('selectionchange',openiOS_1);editor.once('touchend',function(){return editor.off('selectionchange',openiOS_1);});}}else{open();}};var patchPipeConfig=function patchPipeConfig(config){return typeof config==='string'?config.split(/[ ,]/):config;};var shouldNeverUseNative=function shouldNeverUseNative(editor){return editor.getParam('contextmenu_never_use_native',false,'boolean');};var getMenuItems=function getMenuItems(editor,name,defaultItems){var contextMenus=editor.ui.registry.getAll().contextMenus;return Optional.from(editor.getParam(name)).map(patchPipeConfig).getOrThunk(function(){return filter$2(patchPipeConfig(defaultItems),function(item){return has$2(contextMenus,item);});});};var isContextMenuDisabled=function isContextMenuDisabled(editor){return editor.getParam('contextmenu')===false;};var getContextMenu=function getContextMenu(editor){return getMenuItems(editor,'contextmenu','link linkchecker image imagetools table spellchecker configurepermanentpen');};var getAvoidOverlapSelector=function getAvoidOverlapSelector(editor){return editor.getParam('contextmenu_avoid_overlap','','string');};var isSeparator=function isSeparator(item){return isString(item)?item==='|':item.type==='separator';};var separator={type:'separator'};var _makeContextItem=function makeContextItem(item){var commonMenuItem=function commonMenuItem(item){return{text:item.text,icon:item.icon,disabled:item.disabled,shortcut:item.shortcut};};if(isString(item)){return item;}else{switch(item.type){case'separator':return separator;case'submenu':return _assign(_assign({type:'nestedmenuitem'},commonMenuItem(item)),{getSubmenuItems:function getSubmenuItems(){var items=item.getSubmenuItems();if(isString(items)){return items;}else{return map$2(items,_makeContextItem);}}});default:return _assign(_assign({type:'menuitem'},commonMenuItem(item)),{onAction:noarg(item.onAction)});}}};var addContextMenuGroup=function addContextMenuGroup(xs,groupItems){if(groupItems.length===0){return xs;}var lastMenuItem=last$2(xs).filter(function(item){return!isSeparator(item);});var before=lastMenuItem.fold(function(){return[];},function(_){return[separator];});return xs.concat(before).concat(groupItems).concat([separator]);};var generateContextMenu=function generateContextMenu(contextMenus,menuConfig,selectedElement){var sections=foldl(menuConfig,function(acc,name){return get$e(contextMenus,name.toLowerCase()).map(function(menu){var items=menu.update(selectedElement);if(isString(items)){return addContextMenuGroup(acc,items.split(' '));}else if(items.length>0){var allItems=map$2(items,_makeContextItem);return addContextMenuGroup(acc,allItems);}else{return acc;}}).getOrThunk(function(){return acc.concat([name]);});},[]);if(sections.length>0&&isSeparator(sections[sections.length-1])){sections.pop();}return sections;};var isNativeOverrideKeyEvent=function isNativeOverrideKeyEvent(editor,e){return e.ctrlKey&&!shouldNeverUseNative(editor);};var isTriggeredByKeyboard=function isTriggeredByKeyboard(editor,e){return e.type!=='longpress'&&(e.button!==2||e.target===editor.getBody()&&e.pointerType==='');};var getSelectedElement=function getSelectedElement(editor,e){return isTriggeredByKeyboard(editor,e)?editor.selection.getStart(true):e.target;};var getAnchorType=function getAnchorType(editor,e){var selector=getAvoidOverlapSelector(editor);var anchorType=isTriggeredByKeyboard(editor,e)?'selection':'point';if(isNotEmpty(selector)){var target=getSelectedElement(editor,e);var selectorExists=closest(SugarElement.fromDom(target),selector);return selectorExists?'node':anchorType;}else{return anchorType;}};var setup$5=function setup$5(editor,lazySink,backstage){var detection=detect$1();var isTouch=detection.deviceType.isTouch;var contextmenu=build$1(InlineView.sketch({dom:{tag:'div'},lazySink:lazySink,onEscape:function onEscape(){return editor.focus();},onShow:function onShow(){return backstage.setContextMenuState(true);},onHide:function onHide(){return backstage.setContextMenuState(false);},fireDismissalEventInstead:{},inlineBehaviours:derive$1([config('dismissContextMenu',[run$1(dismissRequested(),function(comp,_se){Sandboxing.close(comp);editor.focus();})])])}));var hideContextMenu=function hideContextMenu(_e){return InlineView.hide(contextmenu);};var showContextMenu=function showContextMenu(e){if(shouldNeverUseNative(editor)){e.preventDefault();}if(isNativeOverrideKeyEvent(editor,e)||isContextMenuDisabled(editor)){return;}var anchorType=getAnchorType(editor,e);var buildMenu=function buildMenu(){var selectedElement=getSelectedElement(editor,e);var registry=editor.ui.registry.getAll();var menuConfig=getContextMenu(editor);return generateContextMenu(registry.contextMenus,menuConfig,selectedElement);};var initAndShow$2=isTouch()?initAndShow:initAndShow$1;initAndShow$2(editor,e,buildMenu,backstage,contextmenu,anchorType);};editor.on('init',function(){var hideEvents='ResizeEditor ScrollContent ScrollWindow longpresscancel'+(isTouch()?'':' ResizeWindow');editor.on(hideEvents,hideContextMenu);editor.on('longpress contextmenu',showContextMenu);});};var adt=Adt.generate([{offset:['x','y']},{absolute:['x','y']},{fixed:['x','y']}]);var subtract=function subtract(change){return function(point){return point.translate(-change.left,-change.top);};};var add=function add(change){return function(point){return point.translate(change.left,change.top);};};var transform=function transform(changes){return function(x,y){return foldl(changes,function(rest,f){return f(rest);},SugarPosition(x,y));};};var asFixed=function asFixed(coord,scroll,origin){return coord.fold(transform([add(origin),subtract(scroll)]),transform([subtract(scroll)]),transform([]));};var asAbsolute=function asAbsolute(coord,scroll,origin){return coord.fold(transform([add(origin)]),transform([]),transform([add(scroll)]));};var asOffset=function asOffset(coord,scroll,origin){return coord.fold(transform([]),transform([subtract(origin)]),transform([add(scroll),subtract(origin)]));};var withinRange=function withinRange(coord1,coord2,xRange,yRange,scroll,origin){var a1=asAbsolute(coord1,scroll,origin);var a2=asAbsolute(coord2,scroll,origin);return Math.abs(a1.left-a2.left)<=xRange&&Math.abs(a1.top-a2.top)<=yRange;};var getDeltas=function getDeltas(coord1,coord2,xRange,yRange,scroll,origin){var a1=asAbsolute(coord1,scroll,origin);var a2=asAbsolute(coord2,scroll,origin);var left=Math.abs(a1.left-a2.left);var top=Math.abs(a1.top-a2.top);return SugarPosition(left,top);};var toStyles=function toStyles(coord,scroll,origin){var stylesOpt=coord.fold(function(x,y){return{position:Optional.some('absolute'),left:Optional.some(x+'px'),top:Optional.some(y+'px')};},function(x,y){return{position:Optional.some('absolute'),left:Optional.some(x-origin.left+'px'),top:Optional.some(y-origin.top+'px')};},function(x,y){return{position:Optional.some('fixed'),left:Optional.some(x+'px'),top:Optional.some(y+'px')};});return _assign({right:Optional.none(),bottom:Optional.none()},stylesOpt);};var translate=function translate(coord,deltaX,deltaY){return coord.fold(function(x,y){return offset(x+deltaX,y+deltaY);},function(x,y){return absolute(x+deltaX,y+deltaY);},function(x,y){return fixed(x+deltaX,y+deltaY);});};var absorb=function absorb(partialCoord,originalCoord,scroll,origin){var absorbOne=function absorbOne(stencil,nu){return function(optX,optY){var original=stencil(originalCoord,scroll,origin);return nu(optX.getOr(original.left),optY.getOr(original.top));};};return partialCoord.fold(absorbOne(asOffset,offset),absorbOne(asAbsolute,absolute),absorbOne(asFixed,fixed));};var offset=adt.offset;var absolute=adt.absolute;var fixed=adt.fixed;var parseAttrToInt=function parseAttrToInt(element,name){var value=get$d(element,name);return isUndefined(value)?NaN:parseInt(value,10);};var get=function get(component,snapsInfo){var element=component.element;var x=parseAttrToInt(element,snapsInfo.leftAttr);var y=parseAttrToInt(element,snapsInfo.topAttr);return isNaN(x)||isNaN(y)?Optional.none():Optional.some(SugarPosition(x,y));};var set=function set(component,snapsInfo,pt){var element=component.element;set$8(element,snapsInfo.leftAttr,pt.left+'px');set$8(element,snapsInfo.topAttr,pt.top+'px');};var clear=function clear(component,snapsInfo){var element=component.element;remove$7(element,snapsInfo.leftAttr);remove$7(element,snapsInfo.topAttr);};var getCoords=function getCoords(component,snapInfo,coord,delta){return get(component,snapInfo).fold(function(){return coord;},function(fixed$1){return fixed(fixed$1.left+delta.left,fixed$1.top+delta.top);});};var moveOrSnap=function moveOrSnap(component,snapInfo,coord,delta,scroll,origin){var newCoord=getCoords(component,snapInfo,coord,delta);var snap=snapInfo.mustSnap?findClosestSnap(component,snapInfo,newCoord,scroll,origin):findSnap(component,snapInfo,newCoord,scroll,origin);var fixedCoord=asFixed(newCoord,scroll,origin);set(component,snapInfo,fixedCoord);return snap.fold(function(){return{coord:fixed(fixedCoord.left,fixedCoord.top),extra:Optional.none()};},function(spanned){return{coord:spanned.output,extra:spanned.extra};});};var stopDrag=function stopDrag(component,snapInfo){clear(component,snapInfo);};var findMatchingSnap=function findMatchingSnap(snaps,newCoord,scroll,origin){return findMap(snaps,function(snap){var sensor=snap.sensor;var inRange=withinRange(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin);return inRange?Optional.some({output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra}):Optional.none();});};var findClosestSnap=function findClosestSnap(component,snapInfo,newCoord,scroll,origin){var snaps=snapInfo.getSnapPoints(component);var matchSnap=findMatchingSnap(snaps,newCoord,scroll,origin);return matchSnap.orThunk(function(){var bestSnap=foldl(snaps,function(acc,snap){var sensor=snap.sensor;var deltas=getDeltas(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin);return acc.deltas.fold(function(){return{deltas:Optional.some(deltas),snap:Optional.some(snap)};},function(bestDeltas){var currAvg=(deltas.left+deltas.top)/2;var bestAvg=(bestDeltas.left+bestDeltas.top)/2;if(currAvg<=bestAvg){return{deltas:Optional.some(deltas),snap:Optional.some(snap)};}else{return acc;}});},{deltas:Optional.none(),snap:Optional.none()});return bestSnap.snap.map(function(snap){return{output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra};});});};var findSnap=function findSnap(component,snapInfo,newCoord,scroll,origin){var snaps=snapInfo.getSnapPoints(component);return findMatchingSnap(snaps,newCoord,scroll,origin);};var snapTo$1=function snapTo$1(snap,scroll,origin){return{coord:absorb(snap.output,snap.output,scroll,origin),extra:snap.extra};};var snapTo=function snapTo(component,dragConfig,_state,snap){var target=dragConfig.getTarget(component.element);if(dragConfig.repositionTarget){var doc=owner$4(component.element);var scroll_1=get$9(doc);var origin_1=getOrigin(target);var snapPin=snapTo$1(snap,scroll_1,origin_1);var styles=toStyles(snapPin.coord,scroll_1,origin_1);setOptions(target,styles);}};var DraggingApis=/*#__PURE__*/Object.freeze({__proto__:null,snapTo:snapTo});var initialAttribute='data-initial-z-index';var resetZIndex=function resetZIndex(blocker){parent(blocker.element).filter(isElement$2).each(function(root){getOpt(root,initialAttribute).fold(function(){return remove$6(root,'z-index');},function(zIndex){return set$7(root,'z-index',zIndex);});remove$7(root,initialAttribute);});};var changeZIndex=function changeZIndex(blocker){parent(blocker.element).filter(isElement$2).each(function(root){getRaw(root,'z-index').each(function(zindex){set$8(root,initialAttribute,zindex);});set$7(root,'z-index',get$c(blocker.element,'z-index'));});};var instigate=function instigate(anyComponent,blocker){anyComponent.getSystem().addToGui(blocker);changeZIndex(blocker);};var discard=function discard(blocker){resetZIndex(blocker);blocker.getSystem().removeFromGui(blocker);};var createComponent=function createComponent(component,blockerClass,blockerEvents){return component.getSystem().build(Container.sketch({dom:{styles:{'left':'0px','top':'0px','width':'100%','height':'100%','position':'fixed','z-index':'1000000000000000'},classes:[blockerClass]},events:blockerEvents}));};var SnapSchema=optionObjOf('snaps',[required$1('getSnapPoints'),onHandler('onSensor'),required$1('leftAttr'),required$1('topAttr'),defaulted('lazyViewport',win),defaulted('mustSnap',false)]);var schema$6=[defaulted('useFixed',never),required$1('blockerClass'),defaulted('getTarget',identity$1),defaulted('onDrag',noop),defaulted('repositionTarget',true),defaulted('onDrop',noop),defaultedFunction('getBounds',win),SnapSchema];var getCurrentCoord=function getCurrentCoord(target){return lift3(getRaw(target,'left'),getRaw(target,'top'),getRaw(target,'position'),function(left,top,position){var nu=position==='fixed'?fixed:offset;return nu(parseInt(left,10),parseInt(top,10));}).getOrThunk(function(){var location=absolute$3(target);return absolute(location.left,location.top);});};var clampCoords=function clampCoords(component,coords,scroll,origin,startData){var bounds=startData.bounds;var absoluteCoord=asAbsolute(coords,scroll,origin);var newX=clamp$1(absoluteCoord.left,bounds.x,bounds.x+bounds.width-startData.width);var newY=clamp$1(absoluteCoord.top,bounds.y,bounds.y+bounds.height-startData.height);var newCoords=absolute(newX,newY);return coords.fold(function(){var offset$1=asOffset(newCoords,scroll,origin);return offset(offset$1.left,offset$1.top);},constant$1(newCoords),function(){var fixed$1=asFixed(newCoords,scroll,origin);return fixed(fixed$1.left,fixed$1.top);});};var calcNewCoord=function calcNewCoord(component,optSnaps,currentCoord,scroll,origin,delta,startData){var newCoord=optSnaps.fold(function(){var translated=translate(currentCoord,delta.left,delta.top);var fixedCoord=asFixed(translated,scroll,origin);return fixed(fixedCoord.left,fixedCoord.top);},function(snapInfo){var snapping=moveOrSnap(component,snapInfo,currentCoord,delta,scroll,origin);snapping.extra.each(function(extra){snapInfo.onSensor(component,extra);});return snapping.coord;});return clampCoords(component,newCoord,scroll,origin,startData);};var dragBy=function dragBy(component,dragConfig,startData,delta){var target=dragConfig.getTarget(component.element);if(dragConfig.repositionTarget){var doc=owner$4(component.element);var scroll_1=get$9(doc);var origin_1=getOrigin(target);var currentCoord=getCurrentCoord(target);var newCoord=calcNewCoord(component,dragConfig.snaps,currentCoord,scroll_1,origin_1,delta,startData);var styles=toStyles(newCoord,scroll_1,origin_1);setOptions(target,styles);}dragConfig.onDrag(component,target,delta);};var calcStartData=function calcStartData(dragConfig,comp){return{bounds:dragConfig.getBounds(),height:getOuter$2(comp.element),width:getOuter$1(comp.element)};};var _move=function move(component,dragConfig,dragState,dragMode,event){var delta=dragState.update(dragMode,event);var dragStartData=dragState.getStartData().getOrThunk(function(){return calcStartData(dragConfig,component);});delta.each(function(dlt){dragBy(component,dragConfig,dragStartData,dlt);});};var stop=function stop(component,blocker,dragConfig,dragState){blocker.each(discard);dragConfig.snaps.each(function(snapInfo){stopDrag(component,snapInfo);});var target=dragConfig.getTarget(component.element);dragState.reset();dragConfig.onDrop(component,target);};var handlers=function handlers(events){return function(dragConfig,dragState){var updateStartState=function updateStartState(comp){dragState.setStartData(calcStartData(dragConfig,comp));};return derive$2(__spreadArray([run$1(windowScroll(),function(comp){dragState.getStartData().each(function(){return updateStartState(comp);});})],events(dragConfig,dragState,updateStartState),true));};};var init$2=function init$2(dragApi){return derive$2([run$1(mousedown(),dragApi.forceDrop),run$1(mouseup(),dragApi.drop),run$1(mousemove(),function(comp,simulatedEvent){dragApi.move(simulatedEvent.event);}),run$1(mouseout(),dragApi.delayDrop)]);};var getData$1=function getData$1(event){return Optional.from(SugarPosition(event.x,event.y));};var getDelta$1=function getDelta$1(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top);};var MouseData=/*#__PURE__*/Object.freeze({__proto__:null,getData:getData$1,getDelta:getDelta$1});var events$2=function events$2(dragConfig,dragState,updateStartState){return[run$1(mousedown(),function(component,simulatedEvent){var raw=simulatedEvent.event.raw;if(raw.button!==0){return;}simulatedEvent.stop();var stop$1=function stop$1(){return stop(component,Optional.some(blocker),dragConfig,dragState);};var delayDrop=DelayedFunction(stop$1,200);var dragApi={drop:stop$1,delayDrop:delayDrop.schedule,forceDrop:stop$1,move:function move(event){delayDrop.cancel();_move(component,dragConfig,dragState,MouseData,event);}};var blocker=createComponent(component,dragConfig.blockerClass,init$2(dragApi));var start=function start(){updateStartState(component);instigate(component,blocker);};start();})];};var schema$5=__spreadArray(__spreadArray([],schema$6,true),[output$1('dragger',{handlers:handlers(events$2)})],false);var init$1=function init$1(dragApi){return derive$2([run$1(touchstart(),dragApi.forceDrop),run$1(touchend(),dragApi.drop),run$1(touchcancel(),dragApi.drop),run$1(touchmove(),function(comp,simulatedEvent){dragApi.move(simulatedEvent.event);})]);};var getDataFrom=function getDataFrom(touches){var touch=touches[0];return Optional.some(SugarPosition(touch.clientX,touch.clientY));};var getData=function getData(event){var raw=event.raw;var touches=raw.touches;return touches.length===1?getDataFrom(touches):Optional.none();};var getDelta=function getDelta(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top);};var TouchData=/*#__PURE__*/Object.freeze({__proto__:null,getData:getData,getDelta:getDelta});var events$1=function events$1(dragConfig,dragState,updateStartState){var blockerSingleton=value$1();var stopBlocking=function stopBlocking(component){stop(component,blockerSingleton.get(),dragConfig,dragState);blockerSingleton.clear();};return[run$1(touchstart(),function(component,simulatedEvent){simulatedEvent.stop();var stop=function stop(){return stopBlocking(component);};var dragApi={drop:stop,delayDrop:noop,forceDrop:stop,move:function move(event){_move(component,dragConfig,dragState,TouchData,event);}};var blocker=createComponent(component,dragConfig.blockerClass,init$1(dragApi));blockerSingleton.set(blocker);var start=function start(){updateStartState(component);instigate(component,blocker);};start();}),run$1(touchmove(),function(component,simulatedEvent){simulatedEvent.stop();_move(component,dragConfig,dragState,TouchData,simulatedEvent.event);}),run$1(touchend(),function(component,simulatedEvent){simulatedEvent.stop();stopBlocking(component);}),run$1(touchcancel(),stopBlocking)];};var schema$4=__spreadArray(__spreadArray([],schema$6,true),[output$1('dragger',{handlers:handlers(events$1)})],false);var events=function events(dragConfig,dragState,updateStartState){return __spreadArray(__spreadArray([],events$2(dragConfig,dragState,updateStartState),true),events$1(dragConfig,dragState,updateStartState),true);};var schema$3=__spreadArray(__spreadArray([],schema$6,true),[output$1('dragger',{handlers:handlers(events)})],false);var mouse=schema$5;var touch=schema$4;var mouseOrTouch=schema$3;var DraggingBranches=/*#__PURE__*/Object.freeze({__proto__:null,mouse:mouse,touch:touch,mouseOrTouch:mouseOrTouch});var init=function init(){var previous=Optional.none();var startData=Optional.none();var reset=function reset(){previous=Optional.none();startData=Optional.none();};var calculateDelta=function calculateDelta(mode,nu){var result=previous.map(function(old){return mode.getDelta(old,nu);});previous=Optional.some(nu);return result;};var update=function update(mode,dragEvent){return mode.getData(dragEvent).bind(function(nuData){return calculateDelta(mode,nuData);});};var setStartData=function setStartData(data){startData=Optional.some(data);};var getStartData=function getStartData(){return startData;};var readState=constant$1({});return nu$8({readState:readState,reset:reset,update:update,getStartData:getStartData,setStartData:setStartData});};var DragState=/*#__PURE__*/Object.freeze({__proto__:null,init:init});var Dragging=createModes({branchKey:'mode',branches:DraggingBranches,name:'dragging',active:{events:function events(dragConfig,dragState){var dragger=dragConfig.dragger;return dragger.handlers(dragConfig,dragState);}},extra:{snap:function snap(sConfig){return{sensor:sConfig.sensor,range:sConfig.range,output:sConfig.output,extra:Optional.from(sConfig.extra)};}},state:DragState,apis:DraggingApis});var snapWidth=40;var snapOffset=snapWidth/2;var calcSnap=function calcSnap(selectorOpt,td,x,y,width,height){return selectorOpt.fold(function(){return Dragging.snap({sensor:absolute(x-snapOffset,y-snapOffset),range:SugarPosition(width,height),output:absolute(Optional.some(x),Optional.some(y)),extra:{td:td}});},function(selectorHandle){var sensorLeft=x-snapOffset;var sensorTop=y-snapOffset;var sensorWidth=snapWidth;var sensorHeight=snapWidth;var rect=selectorHandle.element.dom.getBoundingClientRect();return Dragging.snap({sensor:absolute(sensorLeft,sensorTop),range:SugarPosition(sensorWidth,sensorHeight),output:absolute(Optional.some(x-rect.width/2),Optional.some(y-rect.height/2)),extra:{td:td}});});};var getSnapsConfig=function getSnapsConfig(getSnapPoints,cell,onChange){var isSameCell=function isSameCell(cellOpt,td){return cellOpt.exists(function(currentTd){return eq(currentTd,td);});};return{getSnapPoints:getSnapPoints,leftAttr:'data-drag-left',topAttr:'data-drag-top',onSensor:function onSensor(component,extra){var td=extra.td;if(!isSameCell(cell.get(),td)){cell.set(td);onChange(td);}},mustSnap:true};};var createSelector=function createSelector(snaps){return record(Button.sketch({dom:{tag:'div',classes:['tox-selector']},buttonBehaviours:derive$1([Dragging.config({mode:'mouseOrTouch',blockerClass:'blocker',snaps:snaps}),Unselecting.config({})]),eventOrder:{mousedown:['dragging','alloy.base.behaviour'],touchstart:['dragging','alloy.base.behaviour']}}));};var setup$4=function setup$4(editor,sink){var tlTds=Cell([]);var brTds=Cell([]);var isVisible=Cell(false);var startCell=value$1();var finishCell=value$1();var getTopLeftSnap=function getTopLeftSnap(td){var box=absolute$2(td);return calcSnap(memTopLeft.getOpt(sink),td,box.x,box.y,box.width,box.height);};var getTopLeftSnaps=function getTopLeftSnaps(){return map$2(tlTds.get(),function(td){return getTopLeftSnap(td);});};var getBottomRightSnap=function getBottomRightSnap(td){var box=absolute$2(td);return calcSnap(memBottomRight.getOpt(sink),td,box.right,box.bottom,box.width,box.height);};var getBottomRightSnaps=function getBottomRightSnaps(){return map$2(brTds.get(),function(td){return getBottomRightSnap(td);});};var topLeftSnaps=getSnapsConfig(getTopLeftSnaps,startCell,function(start){finishCell.get().each(function(finish){editor.fire('TableSelectorChange',{start:start,finish:finish});});});var bottomRightSnaps=getSnapsConfig(getBottomRightSnaps,finishCell,function(finish){startCell.get().each(function(start){editor.fire('TableSelectorChange',{start:start,finish:finish});});});var memTopLeft=createSelector(topLeftSnaps);var memBottomRight=createSelector(bottomRightSnaps);var topLeft=build$1(memTopLeft.asSpec());var bottomRight=build$1(memBottomRight.asSpec());var showOrHideHandle=function showOrHideHandle(selector,cell,isAbove,isBelow){var cellRect=cell.dom.getBoundingClientRect();remove$6(selector.element,'display');var viewportHeight=defaultView(SugarElement.fromDom(editor.getBody())).dom.innerHeight;var aboveViewport=isAbove(cellRect);var belowViewport=isBelow(cellRect,viewportHeight);if(aboveViewport||belowViewport){set$7(selector.element,'display','none');}};var snapTo=function snapTo(selector,cell,getSnapConfig,pos){var snap=getSnapConfig(cell);Dragging.snapTo(selector,snap);var isAbove=function isAbove(rect){return rect[pos]<0;};var isBelow=function isBelow(rect,viewportHeight){return rect[pos]>viewportHeight;};showOrHideHandle(selector,cell,isAbove,isBelow);};var snapTopLeft=function snapTopLeft(cell){return snapTo(topLeft,cell,getTopLeftSnap,'top');};var snapLastTopLeft=function snapLastTopLeft(){return startCell.get().each(snapTopLeft);};var snapBottomRight=function snapBottomRight(cell){return snapTo(bottomRight,cell,getBottomRightSnap,'bottom');};var snapLastBottomRight=function snapLastBottomRight(){return finishCell.get().each(snapBottomRight);};if(detect$1().deviceType.isTouch()){editor.on('TableSelectionChange',function(e){if(!isVisible.get()){attach(sink,topLeft);attach(sink,bottomRight);isVisible.set(true);}startCell.set(e.start);finishCell.set(e.finish);e.otherCells.each(function(otherCells){tlTds.set(otherCells.upOrLeftCells);brTds.set(otherCells.downOrRightCells);snapTopLeft(e.start);snapBottomRight(e.finish);});});editor.on('ResizeEditor ResizeWindow ScrollContent',function(){snapLastTopLeft();snapLastBottomRight();});editor.on('TableSelectionClear',function(){if(isVisible.get()){detach(topLeft);detach(bottomRight);isVisible.set(false);}startCell.clear();finishCell.clear();});}};var isHidden=function isHidden(elm){if(elm.nodeType===1){if(elm.nodeName==='BR'||!!elm.getAttribute('data-mce-bogus')){return true;}if(elm.getAttribute('data-mce-type')==='bookmark'){return true;}}return false;};var renderElementPath=function renderElementPath(editor,settings,providersBackstage){if(!settings.delimiter){settings.delimiter='\\xBB';}var getDataPath=function getDataPath(data){var parts=data||[];var newPathElements=map$2(parts,function(part,index){return Button.sketch({dom:{tag:'div',classes:['tox-statusbar__path-item'],attributes:{'role':'button','data-index':index,'tab-index':-1,'aria-level':index+1},innerHtml:part.name},action:function action(_btn){editor.focus();editor.selection.select(part.element);editor.nodeChanged();},buttonBehaviours:derive$1([DisablingConfigs.button(providersBackstage.isDisabled),receivingConfig()])});});var divider={dom:{tag:'div',classes:['tox-statusbar__path-divider'],attributes:{'aria-hidden':true},innerHtml:' '+settings.delimiter+' '}};return foldl(newPathElements.slice(1),function(acc,element){var newAcc=acc;newAcc.push(divider);newAcc.push(element);return newAcc;},[newPathElements[0]]);};var updatePath=function updatePath(parents){var newPath=[];var i=parents.length;while(i-->0){var parent_1=parents[i];if(parent_1.nodeType===1&&!isHidden(parent_1)){var args=editor.fire('ResolveName',{name:parent_1.nodeName.toLowerCase(),target:parent_1});if(!args.isDefaultPrevented()){newPath.push({name:args.name,element:parent_1});}if(args.isPropagationStopped()){break;}}}return newPath;};return{dom:{tag:'div',classes:['tox-statusbar__path'],attributes:{role:'navigation'}},behaviours:derive$1([Keying.config({mode:'flow',selector:'div[role=button]'}),Disabling.config({disabled:providersBackstage.isDisabled}),receivingConfig(),Tabstopping.config({}),Replacing.config({}),config('elementPathEvents',[runOnAttached(function(comp,_e){editor.shortcuts.add('alt+F11','focus statusbar elementpath',function(){return Keying.focusIn(comp);});editor.on('NodeChange',function(e){var newPath=updatePath(e.parents);if(newPath.length>0){Replacing.set(comp,getDataPath(newPath));}else{Replacing.set(comp,[]);}});})])]),components:[]};};var ResizeTypes;(function(ResizeTypes){ResizeTypes[ResizeTypes['None']=0]='None';ResizeTypes[ResizeTypes['Both']=1]='Both';ResizeTypes[ResizeTypes['Vertical']=2]='Vertical';})(ResizeTypes||(ResizeTypes={}));var getDimensions=function getDimensions(editor,deltas,resizeType,originalHeight,originalWidth){var dimensions={};dimensions.height=calcCappedSize(originalHeight+deltas.top,getMinHeightSetting(editor),getMaxHeightSetting(editor));if(resizeType===ResizeTypes.Both){dimensions.width=calcCappedSize(originalWidth+deltas.left,getMinWidthSetting(editor),getMaxWidthSetting(editor));}return dimensions;};var resize=function resize(editor,deltas,resizeType){var container=SugarElement.fromDom(editor.getContainer());var dimensions=getDimensions(editor,deltas,resizeType,get$b(container),get$a(container));each(dimensions,function(val,dim){return set$7(container,dim,numToPx(val));});fireResizeEditor(editor);};var getResizeType=function getResizeType(editor){var fallback=!editor.hasPlugin('autoresize');var resize=editor.getParam('resize',fallback);if(resize===false){return ResizeTypes.None;}else if(resize==='both'){return ResizeTypes.Both;}else{return ResizeTypes.Vertical;}};var keyboardHandler=function keyboardHandler(editor,resizeType,x,y){var scale=20;var delta=SugarPosition(x*scale,y*scale);resize(editor,delta,resizeType);return Optional.some(true);};var renderResizeHandler=function renderResizeHandler(editor,providersBackstage){var resizeType=getResizeType(editor);if(resizeType===ResizeTypes.None){return Optional.none();}return Optional.some(render$3('resize-handle',{tag:'div',classes:['tox-statusbar__resize-handle'],attributes:{title:providersBackstage.translate('Resize')},behaviours:[Dragging.config({mode:'mouse',repositionTarget:false,onDrag:function onDrag(_comp,_target,delta){return resize(editor,delta,resizeType);},blockerClass:'tox-blocker'}),Keying.config({mode:'special',onLeft:function onLeft(){return keyboardHandler(editor,resizeType,-1,0);},onRight:function onRight(){return keyboardHandler(editor,resizeType,1,0);},onUp:function onUp(){return keyboardHandler(editor,resizeType,0,-1);},onDown:function onDown(){return keyboardHandler(editor,resizeType,0,1);}}),Tabstopping.config({}),Focusing.config({})]},providersBackstage.icons));};var renderWordCount=function renderWordCount(editor,providersBackstage){var _a;var replaceCountText=function replaceCountText(comp,count,mode){return Replacing.set(comp,[text$1(providersBackstage.translate(['{0} '+mode,count[mode]]))]);};return Button.sketch({dom:{tag:'button',classes:['tox-statusbar__wordcount']},components:[],buttonBehaviours:derive$1([DisablingConfigs.button(providersBackstage.isDisabled),receivingConfig(),Tabstopping.config({}),Replacing.config({}),Representing.config({store:{mode:'memory',initialValue:{mode:'words',count:{words:0,characters:0}}}}),config('wordcount-events',[runOnExecute$1(function(comp){var currentVal=Representing.getValue(comp);var newMode=currentVal.mode==='words'?'characters':'words';Representing.setValue(comp,{mode:newMode,count:currentVal.count});replaceCountText(comp,currentVal.count,newMode);}),runOnAttached(function(comp){editor.on('wordCountUpdate',function(e){var mode=Representing.getValue(comp).mode;Representing.setValue(comp,{mode:mode,count:e.wordCount});replaceCountText(comp,e.wordCount,mode);});})])]),eventOrder:(_a={},_a[execute$5()]=['disabling','alloy.base.behaviour','wordcount-events'],_a)});};var renderStatusbar=function renderStatusbar(editor,providersBackstage){var renderBranding=function renderBranding(){var label=global$e.translate(['Powered by {0}','Tiny']);var linkHtml='<a href=\"https://www.tiny.cloud/?utm_campaign=editor_referral&amp;utm_medium=poweredby&amp;utm_source=tinymce&amp;utm_content=v5\" rel=\"noopener\" target=\"_blank\" tabindex=\"-1\" aria-label=\"'+label+'\">'+label+'</a>';return{dom:{tag:'span',classes:['tox-statusbar__branding'],innerHtml:linkHtml}};};var getTextComponents=function getTextComponents(){var components=[];if(editor.getParam('elementpath',true,'boolean')){components.push(renderElementPath(editor,{},providersBackstage));}if(editor.hasPlugin('wordcount')){components.push(renderWordCount(editor,providersBackstage));}if(editor.getParam('branding',true,'boolean')){components.push(renderBranding());}if(components.length>0){return[{dom:{tag:'div',classes:['tox-statusbar__text-container']},components:components}];}return[];};var getComponents=function getComponents(){var components=getTextComponents();var resizeHandler=renderResizeHandler(editor,providersBackstage);return components.concat(resizeHandler.toArray());};return{dom:{tag:'div',classes:['tox-statusbar']},components:getComponents()};};var setup$3=function setup$3(editor){var _a;var isInline=editor.inline;var mode=isInline?Inline:Iframe;var header=isStickyToolbar(editor)?StickyHeader:StaticHeader;var lazyOuterContainer=Optional.none();var platform=detect$1();var isIE=platform.browser.isIE();var platformClasses=isIE?['tox-platform-ie']:[];var isTouch=platform.deviceType.isTouch();var touchPlatformClass='tox-platform-touch';var deviceClasses=isTouch?[touchPlatformClass]:[];var isToolbarBottom=isToolbarLocationBottom(editor);var uiContainer=getUiContainer(editor);var dirAttributes=global$e.isRtl()?{attributes:{dir:'rtl'}}:{};var verticalDirAttributes={attributes:(_a={},_a[Attribute]=isToolbarBottom?AttributeValue.BottomToTop:AttributeValue.TopToBottom,_a)};var _lazyHeader=function lazyHeader(){return lazyOuterContainer.bind(OuterContainer.getHeader);};var isHeaderDocked=function isHeaderDocked(){return header.isDocked(_lazyHeader);};var resizeUiMothership=function resizeUiMothership(){set$7(uiMothership.element,'width',document.body.clientWidth+'px');};var makeSinkDefinition=function makeSinkDefinition(){var isGridUiContainer=eq(body(),uiContainer)&&get$c(uiContainer,'display')==='grid';var sinkSpec={dom:_assign({tag:'div',classes:['tox','tox-silver-sink','tox-tinymce-aux'].concat(platformClasses).concat(deviceClasses)},dirAttributes),behaviours:derive$1([Positioning.config({useFixed:function useFixed(){return isHeaderDocked();}})])};var reactiveWidthSpec={dom:{styles:{width:document.body.clientWidth+'px'}},events:derive$2([run$1(windowResize(),resizeUiMothership)])};return deepMerge(sinkSpec,isGridUiContainer?reactiveWidthSpec:{});};var sink=build$1(makeSinkDefinition());var lazySink=function lazySink(){return Result.value(sink);};var memAnchorBar=record({dom:{tag:'div',classes:['tox-anchorbar']}});var lazyAnchorBar=function lazyAnchorBar(){return lazyOuterContainer.bind(function(container){return memAnchorBar.getOpt(container);}).getOrDie('Could not find a anchor bar element');};var lazyToolbar=function lazyToolbar(){return lazyOuterContainer.bind(function(container){return OuterContainer.getToolbar(container);}).getOrDie('Could not find more toolbar element');};var lazyThrobber=function lazyThrobber(){return lazyOuterContainer.bind(function(container){return OuterContainer.getThrobber(container);}).getOrDie('Could not find throbber element');};var backstage=init$7(sink,editor,lazyAnchorBar);var partMenubar=OuterContainer.parts.menubar({dom:{tag:'div',classes:['tox-menubar']},backstage:backstage,onEscape:function onEscape(){editor.focus();}});var toolbarMode=getToolbarMode(editor);var partToolbar=OuterContainer.parts.toolbar(_assign({dom:{tag:'div',classes:['tox-toolbar']},getSink:lazySink,providers:backstage.shared.providers,onEscape:function onEscape(){editor.focus();},type:toolbarMode,lazyToolbar:lazyToolbar,lazyHeader:function lazyHeader(){return _lazyHeader().getOrDie('Could not find header element');}},verticalDirAttributes));var partMultipleToolbar=OuterContainer.parts['multiple-toolbar']({dom:{tag:'div',classes:['tox-toolbar-overlord']},providers:backstage.shared.providers,onEscape:function onEscape(){editor.focus();},type:toolbarMode});var partSocket=OuterContainer.parts.socket({dom:{tag:'div',classes:['tox-edit-area']}});var partSidebar=OuterContainer.parts.sidebar({dom:{tag:'div',classes:['tox-sidebar']}});var partThrobber=OuterContainer.parts.throbber({dom:{tag:'div',classes:['tox-throbber']},backstage:backstage});var sb=editor.getParam('statusbar',true,'boolean');var statusbar=sb&&!isInline?Optional.some(renderStatusbar(editor,backstage.shared.providers)):Optional.none();var socketSidebarContainer={dom:{tag:'div',classes:['tox-sidebar-wrap']},components:[partSocket,partSidebar]};var hasMultipleToolbar=isMultipleToolbars(editor);var hasToolbar=isToolbarEnabled(editor);var hasMenubar=isMenubarEnabled(editor);var getPartToolbar=function getPartToolbar(){if(hasMultipleToolbar){return[partMultipleToolbar];}else if(hasToolbar){return[partToolbar];}else{return[];}};var partHeader=OuterContainer.parts.header({dom:_assign({tag:'div',classes:['tox-editor-header']},verticalDirAttributes),components:flatten([hasMenubar?[partMenubar]:[],getPartToolbar(),useFixedContainer(editor)?[]:[memAnchorBar.asSpec()]]),sticky:isStickyToolbar(editor),editor:editor,sharedBackstage:backstage.shared});var editorComponents=flatten([isToolbarBottom?[]:[partHeader],isInline?[]:[socketSidebarContainer],isToolbarBottom?[partHeader]:[]]);var editorContainer={dom:{tag:'div',classes:['tox-editor-container']},components:editorComponents};var containerComponents=flatten([[editorContainer],isInline?[]:statusbar.toArray(),[partThrobber]]);var isHidden=isDistractionFree(editor);var attributes=_assign(_assign({role:'application'},global$e.isRtl()?{dir:'rtl'}:{}),isHidden?{'aria-hidden':'true'}:{});var outerContainer=build$1(OuterContainer.sketch({dom:{tag:'div',classes:['tox','tox-tinymce'].concat(isInline?['tox-tinymce-inline']:[]).concat(isToolbarBottom?['tox-tinymce--toolbar-bottom']:[]).concat(deviceClasses).concat(platformClasses),styles:_assign({visibility:'hidden'},isHidden?{opacity:'0',border:'0'}:{}),attributes:attributes},components:containerComponents,behaviours:derive$1([receivingConfig(),Disabling.config({disableClass:'tox-tinymce--disabled'}),Keying.config({mode:'cyclic',selector:'.tox-menubar, .tox-toolbar, .tox-toolbar__primary, .tox-toolbar__overflow--open, .tox-sidebar__overflow--open, .tox-statusbar__path, .tox-statusbar__wordcount, .tox-statusbar__branding a, .tox-statusbar__resize-handle'})])}));lazyOuterContainer=Optional.some(outerContainer);editor.shortcuts.add('alt+F9','focus menubar',function(){OuterContainer.focusMenubar(outerContainer);});editor.shortcuts.add('alt+F10','focus toolbar',function(){OuterContainer.focusToolbar(outerContainer);});editor.addCommand('ToggleToolbarDrawer',function(){OuterContainer.toggleToolbarDrawer(outerContainer);});editor.addQueryStateHandler('ToggleToolbarDrawer',function(){return OuterContainer.isToolbarDrawerToggled(outerContainer);});var mothership=takeover(outerContainer);var uiMothership=takeover(sink);setup$b(editor,mothership,uiMothership);var getUi=function getUi(){var channels={broadcastAll:uiMothership.broadcast,broadcastOn:uiMothership.broadcastOn,register:noop};return{channels:channels};};var setEditorSize=function setEditorSize(){var parsedHeight=numToPx(getHeightWithFallback(editor));var parsedWidth=numToPx(getWidthWithFallback(editor));if(!editor.inline){if(isValidValue('div','width',parsedWidth)){set$7(outerContainer.element,'width',parsedWidth);}if(isValidValue('div','height',parsedHeight)){set$7(outerContainer.element,'height',parsedHeight);}else{set$7(outerContainer.element,'height','200px');}}return parsedHeight;};var renderUI=function renderUI(){header.setup(editor,backstage.shared,_lazyHeader);setup$6(editor,backstage);setup$5(editor,lazySink,backstage);setup$8(editor);setup$7(editor,lazyThrobber,backstage.shared);map$1(getToolbarGroups(editor),function(toolbarGroupButtonConfig,name){editor.ui.registry.addGroupToolbarButton(name,toolbarGroupButtonConfig);});var _a=editor.ui.registry.getAll(),buttons=_a.buttons,menuItems=_a.menuItems,contextToolbars=_a.contextToolbars,sidebars=_a.sidebars;var toolbarOpt=getMultipleToolbarsSetting(editor);var rawUiConfig={menuItems:menuItems,menus:getMenus(editor),menubar:getMenubar(editor),toolbar:toolbarOpt.getOrThunk(function(){return getToolbar(editor);}),allowToolbarGroups:toolbarMode===ToolbarMode.floating,buttons:buttons,sidebar:sidebars};register$7(editor,contextToolbars,sink,{backstage:backstage});setup$4(editor,sink);var elm=editor.getElement();var height=setEditorSize();var uiComponents={mothership:mothership,uiMothership:uiMothership,outerContainer:outerContainer};var args={targetNode:elm,height:height};return mode.render(editor,uiComponents,rawUiConfig,backstage,args);};return{mothership:mothership,uiMothership:uiMothership,backstage:backstage,renderUI:renderUI,getUi:getUi};};var describedBy=function describedBy(describedElement,describeElement){var describeId=Optional.from(get$d(describedElement,'id')).fold(function(){var id=generate$6('dialog-describe');set$8(describeElement,'id',id);return id;},identity$1);set$8(describedElement,'aria-describedby',describeId);};var labelledBy=function labelledBy(labelledElement,labelElement){var labelId=getOpt(labelledElement,'id').fold(function(){var id=generate$6('dialog-label');set$8(labelElement,'id',id);return id;},identity$1);set$8(labelledElement,'aria-labelledby',labelId);};var schema$2=constant$1([required$1('lazySink'),option('dragBlockClass'),defaultedFunction('getBounds',win),defaulted('useTabstopAt',always),defaulted('eventOrder',{}),field('modalBehaviours',[Keying]),onKeyboardHandler('onExecute'),onStrictKeyboardHandler('onEscape')]);var basic={sketch:identity$1};var parts$2=constant$1([optional({name:'draghandle',overrides:function overrides(detail,spec){return{behaviours:derive$1([Dragging.config({mode:'mouse',getTarget:function getTarget(handle){return ancestor(handle,'[role=\"dialog\"]').getOr(handle);},blockerClass:detail.dragBlockClass.getOrDie(new Error('The drag blocker class was not specified for a dialog with a drag handle: \\n'+JSON.stringify(spec,null,2)).message),getBounds:detail.getDragBounds})])};}}),required({schema:[required$1('dom')],name:'title'}),required({factory:basic,schema:[required$1('dom')],name:'close'}),required({factory:basic,schema:[required$1('dom')],name:'body'}),optional({factory:basic,schema:[required$1('dom')],name:'footer'}),external$1({factory:{sketch:function sketch(spec,detail){return _assign(_assign({},spec),{dom:detail.dom,components:detail.components});}},schema:[defaulted('dom',{tag:'div',styles:{position:'fixed',left:'0px',top:'0px',right:'0px',bottom:'0px'}}),defaulted('components',[])],name:'blocker'})]);var factory$4=function factory$4(detail,components,spec,externals){var _a;var dialogComp=value$1();var showDialog=function showDialog(dialog){dialogComp.set(dialog);var sink=detail.lazySink(dialog).getOrDie();var externalBlocker=externals.blocker();var blocker=sink.getSystem().build(_assign(_assign({},externalBlocker),{components:externalBlocker.components.concat([premade(dialog)]),behaviours:derive$1([Focusing.config({}),config('dialog-blocker-events',[runOnSource(focusin(),function(){Keying.focusIn(dialog);})])])}));attach(sink,blocker);Keying.focusIn(dialog);};var hideDialog=function hideDialog(dialog){dialogComp.clear();parent(dialog.element).each(function(blockerDom){dialog.getSystem().getByDom(blockerDom).each(function(blocker){detach(blocker);});});};var getDialogBody=function getDialogBody(dialog){return getPartOrDie(dialog,detail,'body');};var getDialogFooter=function getDialogFooter(dialog){return getPartOrDie(dialog,detail,'footer');};var setBusy=function setBusy(dialog,getBusySpec){Blocking.block(dialog,getBusySpec);};var setIdle=function setIdle(dialog){Blocking.unblock(dialog);};var modalEventsId=generate$6('modal-events');var eventOrder=_assign(_assign({},detail.eventOrder),(_a={},_a[attachedToDom()]=[modalEventsId].concat(detail.eventOrder['alloy.system.attached']||[]),_a));return{uid:detail.uid,dom:detail.dom,components:components,apis:{show:showDialog,hide:hideDialog,getBody:getDialogBody,getFooter:getDialogFooter,setIdle:setIdle,setBusy:setBusy},eventOrder:eventOrder,domModification:{attributes:{'role':'dialog','aria-modal':'true'}},behaviours:augment(detail.modalBehaviours,[Replacing.config({}),Keying.config({mode:'cyclic',onEnter:detail.onExecute,onEscape:detail.onEscape,useTabstopAt:detail.useTabstopAt}),Blocking.config({getRoot:dialogComp.get}),config(modalEventsId,[runOnAttached(function(c){labelledBy(c.element,getPartOrDie(c,detail,'title').element);describedBy(c.element,getPartOrDie(c,detail,'body').element);})])])};};var ModalDialog=composite({name:'ModalDialog',configFields:schema$2(),partFields:parts$2(),factory:factory$4,apis:{show:function show(apis,dialog){apis.show(dialog);},hide:function hide(apis,dialog){apis.hide(dialog);},getBody:function getBody(apis,dialog){return apis.getBody(dialog);},getFooter:function getFooter(apis,dialog){return apis.getFooter(dialog);},setBusy:function setBusy(apis,dialog,getBusySpec){apis.setBusy(dialog,getBusySpec);},setIdle:function setIdle(apis,dialog){apis.setIdle(dialog);}}});var dialogToggleMenuItemSchema=objOf([requiredString('type'),requiredString('name')].concat(commonMenuItemFields));var dialogToggleMenuItemDataProcessor=boolean;var baseFooterButtonFields=[field$1('name','name',defaultedThunk(function(){return generate$6('button-name');}),string),optionString('icon'),defaultedStringEnum('align','end',['start','end']),defaultedBoolean('primary',false),defaultedBoolean('disabled',false)];var dialogFooterButtonFields=__spreadArray(__spreadArray([],baseFooterButtonFields,true),[requiredString('text')],false);var normalFooterButtonFields=__spreadArray([requiredStringEnum('type',['submit','cancel','custom'])],dialogFooterButtonFields,true);var menuFooterButtonFields=__spreadArray([requiredStringEnum('type',['menu']),optionString('text'),optionString('tooltip'),optionString('icon'),requiredArrayOf('items',dialogToggleMenuItemSchema)],baseFooterButtonFields,true);var dialogFooterButtonSchema=choose$1('type',{submit:normalFooterButtonFields,cancel:normalFooterButtonFields,custom:normalFooterButtonFields,menu:menuFooterButtonFields});var alertBannerFields=[requiredString('type'),requiredString('text'),requiredStringEnum('level',['info','warn','error','success']),requiredString('icon'),defaulted('url','')];var alertBannerSchema=objOf(alertBannerFields);var createBarFields=function createBarFields(itemsField){return[requiredString('type'),itemsField];};var buttonFields=[requiredString('type'),requiredString('text'),defaultedBoolean('disabled',false),defaultedBoolean('primary',false),field$1('name','name',defaultedThunk(function(){return generate$6('button-name');}),string),optionString('icon'),defaultedBoolean('borderless',false)];var buttonSchema=objOf(buttonFields);var checkboxFields=[requiredString('type'),requiredString('name'),requiredString('label'),defaultedBoolean('disabled',false)];var checkboxSchema=objOf(checkboxFields);var checkboxDataProcessor=boolean;var formComponentFields=[requiredString('type'),requiredString('name')];var formComponentWithLabelFields=formComponentFields.concat([optionString('label')]);var collectionFields=formComponentWithLabelFields.concat([defaulted('columns','auto')]);var collectionSchema=objOf(collectionFields);var collectionDataProcessor=arrOfObj([requiredString('value'),requiredString('text'),requiredString('icon')]);var colorInputFields=formComponentWithLabelFields;var colorInputSchema=objOf(colorInputFields);var colorInputDataProcessor=string;var colorPickerFields=formComponentWithLabelFields;var colorPickerSchema=objOf(colorPickerFields);var colorPickerDataProcessor=string;var customEditorFields=formComponentFields.concat([defaultedString('tag','textarea'),requiredString('scriptId'),requiredString('scriptUrl'),defaultedPostMsg('settings',undefined)]);var customEditorFieldsOld=formComponentFields.concat([defaultedString('tag','textarea'),requiredFunction('init')]);var customEditorSchema=valueOf(function(v){return asRaw('customeditor.old',objOfOnly(customEditorFieldsOld),v).orThunk(function(){return asRaw('customeditor.new',objOfOnly(customEditorFields),v);});});var customEditorDataProcessor=string;var dropZoneFields=formComponentWithLabelFields;var dropZoneSchema=objOf(dropZoneFields);var dropZoneDataProcessor=arrOfVal();var createGridFields=function createGridFields(itemsField){return[requiredString('type'),requiredNumber('columns'),itemsField];};var htmlPanelFields=[requiredString('type'),requiredString('html'),defaultedStringEnum('presets','presentation',['presentation','document'])];var htmlPanelSchema=objOf(htmlPanelFields);var iframeFields=formComponentWithLabelFields.concat([defaultedBoolean('sandboxed',true)]);var iframeSchema=objOf(iframeFields);var iframeDataProcessor=string;var imageToolsFields=formComponentWithLabelFields.concat([requiredOf('currentState',objOf([required$1('blob'),requiredString('url')]))]);var imageToolsSchema=objOf(imageToolsFields);var inputFields=formComponentWithLabelFields.concat([optionString('inputMode'),optionString('placeholder'),defaultedBoolean('maximized',false),defaultedBoolean('disabled',false)]);var inputSchema=objOf(inputFields);var inputDataProcessor=string;var createLabelFields=function createLabelFields(itemsField){return[requiredString('type'),requiredString('label'),itemsField];};var listBoxSingleItemFields=[requiredString('text'),requiredString('value')];var listBoxNestedItemFields=[requiredString('text'),requiredArrayOf('items',thunkOf('items',function(){return listBoxItemSchema;}))];var listBoxItemSchema=oneOf([objOf(listBoxSingleItemFields),objOf(listBoxNestedItemFields)]);var listBoxFields=formComponentWithLabelFields.concat([requiredArrayOf('items',listBoxItemSchema),defaultedBoolean('disabled',false)]);var listBoxSchema=objOf(listBoxFields);var listBoxDataProcessor=string;var selectBoxFields=formComponentWithLabelFields.concat([requiredArrayOfObj('items',[requiredString('text'),requiredString('value')]),defaultedNumber('size',1),defaultedBoolean('disabled',false)]);var selectBoxSchema=objOf(selectBoxFields);var selectBoxDataProcessor=string;var sizeInputFields=formComponentWithLabelFields.concat([defaultedBoolean('constrain',true),defaultedBoolean('disabled',false)]);var sizeInputSchema=objOf(sizeInputFields);var sizeInputDataProcessor=objOf([requiredString('width'),requiredString('height')]);var tableFields=[requiredString('type'),requiredArrayOf('header',string),requiredArrayOf('cells',arrOf(string))];var tableSchema=objOf(tableFields);var textAreaFields=formComponentWithLabelFields.concat([optionString('placeholder'),defaultedBoolean('maximized',false),defaultedBoolean('disabled',false)]);var textAreaSchema=objOf(textAreaFields);var textAreaDataProcessor=string;var urlInputFields=formComponentWithLabelFields.concat([defaultedStringEnum('filetype','file',['image','media','file']),defaulted('disabled',false)]);var urlInputSchema=objOf(urlInputFields);var urlInputDataProcessor=objOf([requiredString('value'),defaulted('meta',{})]);var createItemsField=function createItemsField(name){return field$1('items','items',required$2(),arrOf(valueOf(function(v){return asRaw('Checking item of '+name,itemSchema,v).fold(function(sErr){return Result.error(formatError(sErr));},function(passValue){return Result.value(passValue);});})));};var itemSchema=valueThunk(function(){return choose$2('type',{alertbanner:alertBannerSchema,bar:objOf(createBarFields(createItemsField('bar'))),button:buttonSchema,checkbox:checkboxSchema,colorinput:colorInputSchema,colorpicker:colorPickerSchema,dropzone:dropZoneSchema,grid:objOf(createGridFields(createItemsField('grid'))),iframe:iframeSchema,input:inputSchema,listbox:listBoxSchema,selectbox:selectBoxSchema,sizeinput:sizeInputSchema,textarea:textAreaSchema,urlinput:urlInputSchema,customeditor:customEditorSchema,htmlpanel:htmlPanelSchema,imagetools:imageToolsSchema,collection:collectionSchema,label:objOf(createLabelFields(createItemsField('label'))),table:tableSchema,panel:panelSchema});});var panelFields=[requiredString('type'),defaulted('classes',[]),requiredArrayOf('items',itemSchema)];var panelSchema=objOf(panelFields);var tabFields=[field$1('name','name',defaultedThunk(function(){return generate$6('tab-name');}),string),requiredString('title'),requiredArrayOf('items',itemSchema)];var tabPanelFields=[requiredString('type'),requiredArrayOfObj('tabs',tabFields)];var tabPanelSchema=objOf(tabPanelFields);var dialogButtonFields=dialogFooterButtonFields;var dialogButtonSchema=dialogFooterButtonSchema;var dialogSchema=objOf([requiredString('title'),requiredOf('body',choose$2('type',{panel:panelSchema,tabpanel:tabPanelSchema})),defaultedString('size','normal'),requiredArrayOf('buttons',dialogButtonSchema),defaulted('initialData',{}),defaultedFunction('onAction',noop),defaultedFunction('onChange',noop),defaultedFunction('onSubmit',noop),defaultedFunction('onClose',noop),defaultedFunction('onCancel',noop),defaulted('onTabChange',noop)]);var createDialog=function createDialog(spec){return asRaw('dialog',dialogSchema,spec);};var urlDialogButtonSchema=objOf(__spreadArray([requiredStringEnum('type',['cancel','custom'])],dialogButtonFields,true));var urlDialogSchema=objOf([requiredString('title'),requiredString('url'),optionNumber('height'),optionNumber('width'),optionArrayOf('buttons',urlDialogButtonSchema),defaultedFunction('onAction',noop),defaultedFunction('onCancel',noop),defaultedFunction('onClose',noop),defaultedFunction('onMessage',noop)]);var createUrlDialog=function createUrlDialog(spec){return asRaw('dialog',urlDialogSchema,spec);};var _getAllObjects=function getAllObjects(obj){if(isObject(obj)){return[obj].concat(bind$3(values(obj),_getAllObjects));}else if(isArray(obj)){return bind$3(obj,_getAllObjects);}else{return[];}};var isNamedItem=function isNamedItem(obj){return isString(obj.type)&&isString(obj.name);};var dataProcessors={checkbox:checkboxDataProcessor,colorinput:colorInputDataProcessor,colorpicker:colorPickerDataProcessor,dropzone:dropZoneDataProcessor,input:inputDataProcessor,iframe:iframeDataProcessor,sizeinput:sizeInputDataProcessor,selectbox:selectBoxDataProcessor,listbox:listBoxDataProcessor,size:sizeInputDataProcessor,textarea:textAreaDataProcessor,urlinput:urlInputDataProcessor,customeditor:customEditorDataProcessor,collection:collectionDataProcessor,togglemenuitem:dialogToggleMenuItemDataProcessor};var getDataProcessor=function getDataProcessor(item){return Optional.from(dataProcessors[item.type]);};var getNamedItems=function getNamedItems(structure){return filter$2(_getAllObjects(structure),isNamedItem);};var createDataValidator=function createDataValidator(structure){var namedItems=getNamedItems(structure);var fields=bind$3(namedItems,function(item){return getDataProcessor(item).fold(function(){return[];},function(schema){return[requiredOf(item.name,schema)];});});return objOf(fields);};var extract=function extract(structure){var internalDialog=getOrDie(createDialog(structure));var dataValidator=createDataValidator(structure);var initialData=structure.initialData;return{internalDialog:internalDialog,dataValidator:dataValidator,initialData:initialData};};var DialogManager={open:function open(factory,structure){var extraction=extract(structure);return factory(extraction.internalDialog,extraction.initialData,extraction.dataValidator);},openUrl:function openUrl(factory,structure){var internalDialog=getOrDie(createUrlDialog(structure));return factory(internalDialog);},redial:function redial(structure){return extract(structure);}};var toValidValues=function toValidValues(values){var errors=[];var result={};each(values,function(value,name){value.fold(function(){errors.push(name);},function(v){result[name]=v;});});return errors.length>0?Result.error(errors):Result.value(result);};var renderBodyPanel=function renderBodyPanel(spec,backstage){var memForm=record(Form.sketch(function(parts){return{dom:{tag:'div',classes:['tox-form'].concat(spec.classes)},components:map$2(spec.items,function(item){return interpretInForm(parts,item,backstage);})};}));return{dom:{tag:'div',classes:['tox-dialog__body']},components:[{dom:{tag:'div',classes:['tox-dialog__body-content']},components:[memForm.asSpec()]}],behaviours:derive$1([Keying.config({mode:'acyclic',useTabstopAt:not(isPseudoStop)}),ComposingConfigs.memento(memForm),RepresentingConfigs.memento(memForm,{postprocess:function postprocess(formValue){return toValidValues(formValue).fold(function(err){console.error(err);return{};},identity$1);}})])};};var factory$3=function factory$3(detail,_spec){return{uid:detail.uid,dom:detail.dom,components:detail.components,events:events$a(detail.action),behaviours:augment(detail.tabButtonBehaviours,[Focusing.config({}),Keying.config({mode:'execution',useSpace:true,useEnter:true}),Representing.config({store:{mode:'memory',initialValue:detail.value}})]),domModification:detail.domModification};};var TabButton=single({name:'TabButton',configFields:[defaulted('uid',undefined),required$1('value'),field$1('dom','dom',mergeWithThunk(function(){return{attributes:{'role':'tab','id':generate$6('aria'),'aria-selected':'false'}};}),anyValue()),option('action'),defaulted('domModification',{}),field('tabButtonBehaviours',[Focusing,Keying,Representing]),required$1('view')],factory:factory$3});var schema$1=constant$1([required$1('tabs'),required$1('dom'),defaulted('clickToDismiss',false),field('tabbarBehaviours',[Highlighting,Keying]),markers$1(['tabClass','selectedClass'])]);var tabsPart=group({factory:TabButton,name:'tabs',unit:'tab',overrides:function overrides(barDetail){var dismissTab$1=function dismissTab$1(tabbar,button){Highlighting.dehighlight(tabbar,button);emitWith(tabbar,dismissTab(),{tabbar:tabbar,button:button});};var changeTab$1=function changeTab$1(tabbar,button){Highlighting.highlight(tabbar,button);emitWith(tabbar,changeTab(),{tabbar:tabbar,button:button});};return{action:function action(button){var tabbar=button.getSystem().getByUid(barDetail.uid).getOrDie();var activeButton=Highlighting.isHighlighted(tabbar,button);var response=function(){if(activeButton&&barDetail.clickToDismiss){return dismissTab$1;}else if(!activeButton){return changeTab$1;}else{return noop;}}();response(tabbar,button);},domModification:{classes:[barDetail.markers.tabClass]}};}});var parts$1=constant$1([tabsPart]);var factory$2=function factory$2(detail,components,_spec,_externals){return{'uid':detail.uid,'dom':detail.dom,components:components,'debug.sketcher':'Tabbar','domModification':{attributes:{role:'tablist'}},'behaviours':augment(detail.tabbarBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedClass,itemClass:detail.markers.tabClass,onHighlight:function onHighlight(tabbar,tab){set$8(tab.element,'aria-selected','true');},onDehighlight:function onDehighlight(tabbar,tab){set$8(tab.element,'aria-selected','false');}}),Keying.config({mode:'flow',getInitial:function getInitial(tabbar){return Highlighting.getHighlighted(tabbar).map(function(tab){return tab.element;});},selector:'.'+detail.markers.tabClass,executeOnMove:true})])};};var Tabbar=composite({name:'Tabbar',configFields:schema$1(),partFields:parts$1(),factory:factory$2});var factory$1=function factory$1(detail,_spec){return{uid:detail.uid,dom:detail.dom,behaviours:augment(detail.tabviewBehaviours,[Replacing.config({})]),domModification:{attributes:{role:'tabpanel'}}};};var Tabview=single({name:'Tabview',configFields:[field('tabviewBehaviours',[Replacing])],factory:factory$1});var schema=constant$1([defaulted('selectFirst',true),onHandler('onChangeTab'),onHandler('onDismissTab'),defaulted('tabs',[]),field('tabSectionBehaviours',[])]);var barPart=required({factory:Tabbar,schema:[required$1('dom'),requiredObjOf('markers',[required$1('tabClass'),required$1('selectedClass')])],name:'tabbar',defaults:function defaults(detail){return{tabs:detail.tabs};}});var viewPart=required({factory:Tabview,name:'tabview'});var parts=constant$1([barPart,viewPart]);var factory=function factory(detail,components,_spec,_externals){var changeTab$1=function changeTab$1(button){var tabValue=Representing.getValue(button);getPart(button,detail,'tabview').each(function(tabview){var tabWithValue=find$5(detail.tabs,function(t){return t.value===tabValue;});tabWithValue.each(function(tabData){var panel=tabData.view();getOpt(button.element,'id').each(function(id){set$8(tabview.element,'aria-labelledby',id);});Replacing.set(tabview,panel);detail.onChangeTab(tabview,button,panel);});});};var changeTabBy=function changeTabBy(section,byPred){getPart(section,detail,'tabbar').each(function(tabbar){byPred(tabbar).each(emitExecute);});};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:get$2(detail.tabSectionBehaviours),events:derive$2(flatten([detail.selectFirst?[runOnAttached(function(section,_simulatedEvent){changeTabBy(section,Highlighting.getFirst);})]:[],[run$1(changeTab(),function(section,simulatedEvent){var button=simulatedEvent.event.button;changeTab$1(button);}),run$1(dismissTab(),function(section,simulatedEvent){var button=simulatedEvent.event.button;detail.onDismissTab(section,button);})]])),apis:{getViewItems:function getViewItems(section){return getPart(section,detail,'tabview').map(function(tabview){return Replacing.contents(tabview);}).getOr([]);},showTab:function showTab(section,tabKey){var getTabIfNotActive=function getTabIfNotActive(tabbar){var candidates=Highlighting.getCandidates(tabbar);var optTab=find$5(candidates,function(c){return Representing.getValue(c)===tabKey;});return optTab.filter(function(tab){return!Highlighting.isHighlighted(tabbar,tab);});};changeTabBy(section,getTabIfNotActive);}}};};var TabSection=composite({name:'TabSection',configFields:schema(),partFields:parts(),factory:factory,apis:{getViewItems:function getViewItems(apis,component){return apis.getViewItems(component);},showTab:function showTab(apis,component,tabKey){apis.showTab(component,tabKey);}}});var measureHeights=function measureHeights(allTabs,tabview,tabviewComp){return map$2(allTabs,function(_tab,i){Replacing.set(tabviewComp,allTabs[i].view());var rect=tabview.dom.getBoundingClientRect();Replacing.set(tabviewComp,[]);return rect.height;});};var getMaxHeight=function getMaxHeight(heights){return head(sort(heights,function(a,b){if(a>b){return-1;}else if(a<b){return+1;}else{return 0;}}));};var getMaxTabviewHeight=function getMaxTabviewHeight(dialog,tabview,tablist){var documentElement$1=documentElement(dialog).dom;var rootElm=ancestor(dialog,'.tox-dialog-wrap').getOr(dialog);var isFixed=get$c(rootElm,'position')==='fixed';var maxHeight;if(isFixed){maxHeight=Math.max(documentElement$1.clientHeight,window.innerHeight);}else{maxHeight=Math.max(documentElement$1.offsetHeight,documentElement$1.scrollHeight);}var tabviewHeight=get$b(tabview);var isTabListBeside=tabview.dom.offsetLeft>=tablist.dom.offsetLeft+get$a(tablist);var currentTabHeight=isTabListBeside?Math.max(get$b(tablist),tabviewHeight):tabviewHeight;var dialogTopMargin=parseInt(get$c(dialog,'margin-top'),10)||0;var dialogBottomMargin=parseInt(get$c(dialog,'margin-bottom'),10)||0;var dialogHeight=get$b(dialog)+dialogTopMargin+dialogBottomMargin;var chromeHeight=dialogHeight-currentTabHeight;return maxHeight-chromeHeight;};var showTab=function showTab(allTabs,comp){head(allTabs).each(function(tab){return TabSection.showTab(comp,tab.value);});};var setTabviewHeight=function setTabviewHeight(tabview,height){set$7(tabview,'height',height+'px');if(!detect$1().browser.isIE()){set$7(tabview,'flex-basis',height+'px');}else{remove$6(tabview,'flex-basis');}};var updateTabviewHeight=function updateTabviewHeight(dialogBody,tabview,maxTabHeight){ancestor(dialogBody,'[role=\"dialog\"]').each(function(dialog){descendant(dialog,'[role=\"tablist\"]').each(function(tablist){maxTabHeight.get().map(function(height){set$7(tabview,'height','0');set$7(tabview,'flex-basis','0');return Math.min(height,getMaxTabviewHeight(dialog,tabview,tablist));}).each(function(height){setTabviewHeight(tabview,height);});});});};var getTabview=function getTabview(dialog){return descendant(dialog,'[role=\"tabpanel\"]');};var setMode=function setMode(allTabs){var smartTabHeight=function(){var maxTabHeight=value$1();var extraEvents=[runOnAttached(function(comp){var dialog=comp.element;getTabview(dialog).each(function(tabview){set$7(tabview,'visibility','hidden');comp.getSystem().getByDom(tabview).toOptional().each(function(tabviewComp){var heights=measureHeights(allTabs,tabview,tabviewComp);var maxTabHeightOpt=getMaxHeight(heights);maxTabHeightOpt.fold(maxTabHeight.clear,maxTabHeight.set);});updateTabviewHeight(dialog,tabview,maxTabHeight);remove$6(tabview,'visibility');showTab(allTabs,comp);global$f.requestAnimationFrame(function(){updateTabviewHeight(dialog,tabview,maxTabHeight);});});}),run$1(windowResize(),function(comp){var dialog=comp.element;getTabview(dialog).each(function(tabview){updateTabviewHeight(dialog,tabview,maxTabHeight);});}),run$1(formResizeEvent,function(comp,_se){var dialog=comp.element;getTabview(dialog).each(function(tabview){var oldFocus=active(getRootNode(tabview));set$7(tabview,'visibility','hidden');var oldHeight=getRaw(tabview,'height').map(function(h){return parseInt(h,10);});remove$6(tabview,'height');remove$6(tabview,'flex-basis');var newHeight=tabview.dom.getBoundingClientRect().height;var hasGrown=oldHeight.forall(function(h){return newHeight>h;});if(hasGrown){maxTabHeight.set(newHeight);updateTabviewHeight(dialog,tabview,maxTabHeight);}else{oldHeight.each(function(h){setTabviewHeight(tabview,h);});}remove$6(tabview,'visibility');oldFocus.each(focus$3);});})];var selectFirst=false;return{extraEvents:extraEvents,selectFirst:selectFirst};}();var naiveTabHeight=function(){var extraEvents=[];var selectFirst=true;return{extraEvents:extraEvents,selectFirst:selectFirst};}();return{smartTabHeight:smartTabHeight,naiveTabHeight:naiveTabHeight};};var SendDataToSectionChannel='send-data-to-section';var SendDataToViewChannel='send-data-to-view';var renderTabPanel=function renderTabPanel(spec,backstage){var storedValue=Cell({});var updateDataWithForm=function updateDataWithForm(form){var formData=Representing.getValue(form);var validData=toValidValues(formData).getOr({});var currentData=storedValue.get();var newData=deepMerge(currentData,validData);storedValue.set(newData);};var setDataOnForm=function setDataOnForm(form){var tabData=storedValue.get();Representing.setValue(form,tabData);};var oldTab=Cell(null);var allTabs=map$2(spec.tabs,function(tab){return{value:tab.name,dom:{tag:'div',classes:['tox-dialog__body-nav-item'],innerHtml:backstage.shared.providers.translate(tab.title)},view:function view(){return[Form.sketch(function(parts){return{dom:{tag:'div',classes:['tox-form']},components:map$2(tab.items,function(item){return interpretInForm(parts,item,backstage);}),formBehaviours:derive$1([Keying.config({mode:'acyclic',useTabstopAt:not(isPseudoStop)}),config('TabView.form.events',[runOnAttached(setDataOnForm),runOnDetached(updateDataWithForm)]),Receiving.config({channels:wrapAll([{key:SendDataToSectionChannel,value:{onReceive:updateDataWithForm}},{key:SendDataToViewChannel,value:{onReceive:setDataOnForm}}])})])};})];}};});var tabMode=setMode(allTabs).smartTabHeight;return TabSection.sketch({dom:{tag:'div',classes:['tox-dialog__body']},onChangeTab:function onChangeTab(section,button,_viewItems){var name=Representing.getValue(button);emitWith(section,formTabChangeEvent,{name:name,oldName:oldTab.get()});oldTab.set(name);},tabs:allTabs,components:[TabSection.parts.tabbar({dom:{tag:'div',classes:['tox-dialog__body-nav']},components:[Tabbar.parts.tabs({})],markers:{tabClass:'tox-tab',selectedClass:'tox-dialog__body-nav-item--active'},tabbarBehaviours:derive$1([Tabstopping.config({})])}),TabSection.parts.tabview({dom:{tag:'div',classes:['tox-dialog__body-content']}})],selectFirst:tabMode.selectFirst,tabSectionBehaviours:derive$1([config('tabpanel',tabMode.extraEvents),Keying.config({mode:'acyclic'}),Composing.config({find:function find(comp){return head(TabSection.getViewItems(comp));}}),Representing.config({store:{mode:'manual',getValue:function getValue(tsection){tsection.getSystem().broadcastOn([SendDataToSectionChannel],{});return storedValue.get();},setValue:function setValue(tsection,value){storedValue.set(value);tsection.getSystem().broadcastOn([SendDataToViewChannel],{});}}})])});};var dialogChannel=generate$6('update-dialog');var titleChannel=generate$6('update-title');var bodyChannel=generate$6('update-body');var footerChannel=generate$6('update-footer');var bodySendMessageChannel=generate$6('body-send-message');var renderBody=function renderBody(spec,id,backstage,ariaAttrs){var renderComponents=function renderComponents(incoming){switch(incoming.body.type){case'tabpanel':{return[renderTabPanel(incoming.body,backstage)];}default:{return[renderBodyPanel(incoming.body,backstage)];}}};var updateState=function updateState(_comp,incoming){return Optional.some({isTabPanel:function isTabPanel(){return incoming.body.type==='tabpanel';}});};var ariaAttributes={'aria-live':'polite'};return{dom:{tag:'div',classes:['tox-dialog__content-js'],attributes:_assign(_assign({},id.map(function(x){return{id:x};}).getOr({})),ariaAttrs?ariaAttributes:{})},components:[],behaviours:derive$1([ComposingConfigs.childAt(0),Reflecting.config({channel:bodyChannel,updateState:updateState,renderComponents:renderComponents,initialData:spec})])};};var renderInlineBody=function renderInlineBody(spec,contentId,backstage,ariaAttrs){return renderBody(spec,Optional.some(contentId),backstage,ariaAttrs);};var renderModalBody=function renderModalBody(spec,backstage){var bodySpec=renderBody(spec,Optional.none(),backstage,false);return ModalDialog.parts.body(bodySpec);};var renderIframeBody=function renderIframeBody(spec){var bodySpec={dom:{tag:'div',classes:['tox-dialog__content-js']},components:[{dom:{tag:'div',classes:['tox-dialog__body-iframe']},components:[craft({dom:{tag:'iframe',attributes:{src:spec.url}},behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])})]}],behaviours:derive$1([Keying.config({mode:'acyclic',useTabstopAt:not(isPseudoStop)})])};return ModalDialog.parts.body(bodySpec);};var isTouch=global$9.deviceType.isTouch();var hiddenHeader=function hiddenHeader(title,close){return{dom:{tag:'div',styles:{display:'none'},classes:['tox-dialog__header']},components:[title,close]};};var pClose=function pClose(onClose,providersBackstage){return ModalDialog.parts.close(Button.sketch({dom:{tag:'button',classes:['tox-button','tox-button--icon','tox-button--naked'],attributes:{'type':'button','aria-label':providersBackstage.translate('Close')}},action:onClose,buttonBehaviours:derive$1([Tabstopping.config({})])}));};var pUntitled=function pUntitled(){return ModalDialog.parts.title({dom:{tag:'div',classes:['tox-dialog__title'],innerHtml:'',styles:{display:'none'}}});};var pBodyMessage=function pBodyMessage(message,providersBackstage){return ModalDialog.parts.body({dom:{tag:'div',classes:['tox-dialog__body']},components:[{dom:{tag:'div',classes:['tox-dialog__body-content']},components:[{dom:fromHtml('<p>'+sanitizeHtmlString(providersBackstage.translate(message))+'</p>')}]}]});};var pFooter=function pFooter(buttons){return ModalDialog.parts.footer({dom:{tag:'div',classes:['tox-dialog__footer']},components:buttons});};var pFooterGroup=function pFooterGroup(startButtons,endButtons){return[Container.sketch({dom:{tag:'div',classes:['tox-dialog__footer-start']},components:startButtons}),Container.sketch({dom:{tag:'div',classes:['tox-dialog__footer-end']},components:endButtons})];};var renderDialog$1=function renderDialog$1(spec){var _a;var dialogClass='tox-dialog';var blockerClass=dialogClass+'-wrap';var blockerBackdropClass=blockerClass+'__backdrop';var scrollLockClass=dialogClass+'__disable-scroll';return ModalDialog.sketch({lazySink:spec.lazySink,onEscape:function onEscape(comp){spec.onEscape(comp);return Optional.some(true);},useTabstopAt:function useTabstopAt(elem){return!isPseudoStop(elem);},dom:{tag:'div',classes:[dialogClass].concat(spec.extraClasses),styles:_assign({position:'relative'},spec.extraStyles)},components:__spreadArray([spec.header,spec.body],spec.footer.toArray(),true),parts:{blocker:{dom:fromHtml('<div class=\"'+blockerClass+'\"></div>'),components:[{dom:{tag:'div',classes:isTouch?[blockerBackdropClass,blockerBackdropClass+'--opaque']:[blockerBackdropClass]}}]}},dragBlockClass:blockerClass,modalBehaviours:derive$1(__spreadArray([Focusing.config({}),config('dialog-events',spec.dialogEvents.concat([runOnSource(focusin(),function(comp,_se){Keying.focusIn(comp);})])),config('scroll-lock',[runOnAttached(function(){add$2(body(),scrollLockClass);}),runOnDetached(function(){remove$2(body(),scrollLockClass);})])],spec.extraBehaviours,true)),eventOrder:_assign((_a={},_a[execute$5()]=['dialog-events'],_a[attachedToDom()]=['scroll-lock','dialog-events','alloy.base.behaviour'],_a[detachedFromDom()]=['alloy.base.behaviour','dialog-events','scroll-lock'],_a),spec.eventOrder)});};var renderClose=function renderClose(providersBackstage){return Button.sketch({dom:{tag:'button',classes:['tox-button','tox-button--icon','tox-button--naked'],attributes:{'type':'button','aria-label':providersBackstage.translate('Close'),'title':providersBackstage.translate('Close')}},components:[render$3('close',{tag:'div',classes:['tox-icon']},providersBackstage.icons)],action:function action(comp){emit(comp,formCancelEvent);}});};var renderTitle=function renderTitle(spec,id,providersBackstage){var renderComponents=function renderComponents(data){return[text$1(providersBackstage.translate(data.title))];};return{dom:{tag:'div',classes:['tox-dialog__title'],attributes:_assign({},id.map(function(x){return{id:x};}).getOr({}))},components:renderComponents(spec),behaviours:derive$1([Reflecting.config({channel:titleChannel,renderComponents:renderComponents})])};};var renderDragHandle=function renderDragHandle(){return{dom:fromHtml('<div class=\"tox-dialog__draghandle\"></div>')};};var renderInlineHeader=function renderInlineHeader(spec,titleId,providersBackstage){return Container.sketch({dom:fromHtml('<div class=\"tox-dialog__header\"></div>'),components:[renderTitle(spec,Optional.some(titleId),providersBackstage),renderDragHandle(),renderClose(providersBackstage)],containerBehaviours:derive$1([Dragging.config({mode:'mouse',blockerClass:'blocker',getTarget:function getTarget(handle){return closest$1(handle,'[role=\"dialog\"]').getOrDie();},snaps:{getSnapPoints:function getSnapPoints(){return[];},leftAttr:'data-drag-left',topAttr:'data-drag-top'}})])});};var renderModalHeader=function renderModalHeader(spec,providersBackstage){var pTitle=ModalDialog.parts.title(renderTitle(spec,Optional.none(),providersBackstage));var pHandle=ModalDialog.parts.draghandle(renderDragHandle());var pClose=ModalDialog.parts.close(renderClose(providersBackstage));var components=[pTitle].concat(spec.draggable?[pHandle]:[]).concat([pClose]);return Container.sketch({dom:fromHtml('<div class=\"tox-dialog__header\"></div>'),components:components});};var getHeader=function getHeader(title,backstage){return renderModalHeader({title:backstage.shared.providers.translate(title),draggable:backstage.dialog.isDraggableModal()},backstage.shared.providers);};var getBusySpec=function getBusySpec(message,bs,providers){return{dom:{tag:'div',classes:['tox-dialog__busy-spinner'],attributes:{'aria-label':providers.translate(message)},styles:{left:'0px',right:'0px',bottom:'0px',top:'0px',position:'absolute'}},behaviours:bs,components:[{dom:fromHtml('<div class=\"tox-spinner\"><div></div><div></div><div></div></div>')}]};};var getEventExtras=function getEventExtras(lazyDialog,providers,extra){return{onClose:function onClose(){return extra.closeWindow();},onBlock:function onBlock(blockEvent){ModalDialog.setBusy(lazyDialog(),function(_comp,bs){return getBusySpec(blockEvent.message,bs,providers);});},onUnblock:function onUnblock(){ModalDialog.setIdle(lazyDialog());}};};var renderModalDialog=function renderModalDialog(spec,initialData,dialogEvents,backstage){var _a;var updateState=function updateState(_comp,incoming){return Optional.some(incoming);};return build$1(renderDialog$1(_assign(_assign({},spec),{lazySink:backstage.shared.getSink,extraBehaviours:__spreadArray([Reflecting.config({channel:dialogChannel,updateState:updateState,initialData:initialData}),RepresentingConfigs.memory({})],spec.extraBehaviours,true),onEscape:function onEscape(comp){emit(comp,formCancelEvent);},dialogEvents:dialogEvents,eventOrder:(_a={},_a[receive()]=[Reflecting.name(),Receiving.name()],_a[attachedToDom()]=['scroll-lock',Reflecting.name(),'messages','dialog-events','alloy.base.behaviour'],_a[detachedFromDom()]=['alloy.base.behaviour','dialog-events','messages',Reflecting.name(),'scroll-lock'],_a)})));};var mapMenuButtons=function mapMenuButtons(buttons){var mapItems=function mapItems(button){var items=map$2(button.items,function(item){var cell=Cell(false);return _assign(_assign({},item),{storage:cell});});return _assign(_assign({},button),{items:items});};return map$2(buttons,function(button){if(button.type==='menu'){return mapItems(button);}return button;});};var extractCellsToObject=function extractCellsToObject(buttons){return foldl(buttons,function(acc,button){if(button.type==='menu'){var menuButton=button;return foldl(menuButton.items,function(innerAcc,item){innerAcc[item.name]=item.storage;return innerAcc;},acc);}return acc;},{});};var initCommonEvents=function initCommonEvents(fireApiEvent,extras){return[runWithTarget(focusin(),onFocus),fireApiEvent(formCloseEvent,function(_api,spec){extras.onClose();spec.onClose();}),fireApiEvent(formCancelEvent,function(api,spec,_event,self){spec.onCancel(api);emit(self,formCloseEvent);}),run$1(formUnblockEvent,function(_c,_se){return extras.onUnblock();}),run$1(formBlockEvent,function(_c,se){return extras.onBlock(se.event);})];};var initUrlDialog=function initUrlDialog(getInstanceApi,extras){var fireApiEvent=function fireApiEvent(eventName,f){return run$1(eventName,function(c,se){withSpec(c,function(spec,_c){f(getInstanceApi(),spec,se.event,c);});});};var withSpec=function withSpec(c,f){Reflecting.getState(c).get().each(function(currentDialog){f(currentDialog,c);});};return __spreadArray(__spreadArray([],initCommonEvents(fireApiEvent,extras),true),[fireApiEvent(formActionEvent,function(api,spec,event){spec.onAction(api,{name:event.name});})],false);};var initDialog=function initDialog(getInstanceApi,extras,getSink){var fireApiEvent=function fireApiEvent(eventName,f){return run$1(eventName,function(c,se){withSpec(c,function(spec,_c){f(getInstanceApi(),spec,se.event,c);});});};var withSpec=function withSpec(c,f){Reflecting.getState(c).get().each(function(currentDialogInit){f(currentDialogInit.internalDialog,c);});};return __spreadArray(__spreadArray([],initCommonEvents(fireApiEvent,extras),true),[fireApiEvent(formSubmitEvent,function(api,spec){return spec.onSubmit(api);}),fireApiEvent(formChangeEvent,function(api,spec,event){spec.onChange(api,{name:event.name});}),fireApiEvent(formActionEvent,function(api,spec,event,component){var focusIn=function focusIn(){return Keying.focusIn(component);};var isDisabled=function isDisabled(focused){return has$1(focused,'disabled')||getOpt(focused,'aria-disabled').exists(function(val){return val==='true';});};var rootNode=getRootNode(component.element);var current=active(rootNode);spec.onAction(api,{name:event.name,value:event.value});active(rootNode).fold(focusIn,function(focused){if(isDisabled(focused)){focusIn();}else if(current.exists(function(cur){return contains(focused,cur)&&isDisabled(cur);})){focusIn();}else{getSink().toOptional().filter(function(sink){return!contains(sink.element,focused);}).each(focusIn);}});}),fireApiEvent(formTabChangeEvent,function(api,spec,event){spec.onTabChange(api,{newTabName:event.name,oldTabName:event.oldName});}),runOnDetached(function(component){var api=getInstanceApi();Representing.setValue(component,api.getData());})],false);};var SilverDialogEvents={initUrlDialog:initUrlDialog,initDialog:initDialog};var makeButton=function makeButton(button,backstage){return renderFooterButton(button,button.type,backstage);};var lookup=function lookup(compInSystem,footerButtons,buttonName){return find$5(footerButtons,function(button){return button.name===buttonName;}).bind(function(memButton){return memButton.memento.getOpt(compInSystem);});};var renderComponents=function renderComponents(_data,state){var footerButtons=state.map(function(s){return s.footerButtons;}).getOr([]);var buttonGroups=partition$3(footerButtons,function(button){return button.align==='start';});var makeGroup=function makeGroup(edge,buttons){return Container.sketch({dom:{tag:'div',classes:['tox-dialog__footer-'+edge]},components:map$2(buttons,function(button){return button.memento.asSpec();})});};var startButtons=makeGroup('start',buttonGroups.pass);var endButtons=makeGroup('end',buttonGroups.fail);return[startButtons,endButtons];};var renderFooter=function renderFooter(initSpec,backstage){var updateState=function updateState(_comp,data){var footerButtons=map$2(data.buttons,function(button){var memButton=record(makeButton(button,backstage));return{name:button.name,align:button.align,memento:memButton};});var lookupByName=function lookupByName(compInSystem,buttonName){return lookup(compInSystem,footerButtons,buttonName);};return Optional.some({lookupByName:lookupByName,footerButtons:footerButtons});};return{dom:fromHtml('<div class=\"tox-dialog__footer\"></div>'),components:[],behaviours:derive$1([Reflecting.config({channel:footerChannel,initialData:initSpec,updateState:updateState,renderComponents:renderComponents})])};};var renderInlineFooter=function renderInlineFooter(initSpec,backstage){return renderFooter(initSpec,backstage);};var renderModalFooter=function renderModalFooter(initSpec,backstage){return ModalDialog.parts.footer(renderFooter(initSpec,backstage));};var getCompByName=function getCompByName(access,name){var root=access.getRoot();if(root.getSystem().isConnected()){var form_1=Composing.getCurrent(access.getFormWrapper()).getOr(access.getFormWrapper());return Form.getField(form_1,name).fold(function(){var footer=access.getFooter();var footerState=Reflecting.getState(footer);return footerState.get().bind(function(f){return f.lookupByName(form_1,name);});},function(comp){return Optional.some(comp);});}else{return Optional.none();}};var validateData$1=function validateData$1(access,data){var root=access.getRoot();return Reflecting.getState(root).get().map(function(dialogState){return getOrDie(asRaw('data',dialogState.dataValidator,data));}).getOr(data);};var getDialogApi=function getDialogApi(access,doRedial,menuItemStates){var withRoot=function withRoot(f){var root=access.getRoot();if(root.getSystem().isConnected()){f(root);}};var getData=function getData(){var root=access.getRoot();var valueComp=root.getSystem().isConnected()?access.getFormWrapper():root;var representedValues=Representing.getValue(valueComp);var menuItemCurrentState=map$1(menuItemStates,function(cell){return cell.get();});return _assign(_assign({},representedValues),menuItemCurrentState);};var setData=function setData(newData){withRoot(function(_){var prevData=instanceApi.getData();var mergedData=_assign(_assign({},prevData),newData);var newInternalData=validateData$1(access,mergedData);var form=access.getFormWrapper();Representing.setValue(form,newInternalData);each(menuItemStates,function(v,k){if(has$2(mergedData,k)){v.set(mergedData[k]);}});});};var disable=function disable(name){getCompByName(access,name).each(Disabling.disable);};var enable=function enable(name){getCompByName(access,name).each(Disabling.enable);};var focus=function focus(name){getCompByName(access,name).each(Focusing.focus);};var block=function block(message){if(!isString(message)){throw new Error('The dialogInstanceAPI.block function should be passed a blocking message of type string as an argument');}withRoot(function(root){emitWith(root,formBlockEvent,{message:message});});};var unblock=function unblock(){withRoot(function(root){emit(root,formUnblockEvent);});};var showTab=function showTab(name){withRoot(function(_){var body=access.getBody();var bodyState=Reflecting.getState(body);if(bodyState.get().exists(function(b){return b.isTabPanel();})){Composing.getCurrent(body).each(function(tabSection){TabSection.showTab(tabSection,name);});}});};var redial=function redial(d){withRoot(function(root){var dialogInit=doRedial(d);root.getSystem().broadcastOn([dialogChannel],dialogInit);root.getSystem().broadcastOn([titleChannel],dialogInit.internalDialog);root.getSystem().broadcastOn([bodyChannel],dialogInit.internalDialog);root.getSystem().broadcastOn([footerChannel],dialogInit.internalDialog);instanceApi.setData(dialogInit.initialData);});};var close=function close(){withRoot(function(root){emit(root,formCloseEvent);});};var instanceApi={getData:getData,setData:setData,disable:disable,enable:enable,focus:focus,block:block,unblock:unblock,showTab:showTab,redial:redial,close:close};return instanceApi;};var getDialogSizeClasses=function getDialogSizeClasses(size){switch(size){case'large':return['tox-dialog--width-lg'];case'medium':return['tox-dialog--width-md'];default:return[];}};var renderDialog=function renderDialog(dialogInit,extra,backstage){var header=getHeader(dialogInit.internalDialog.title,backstage);var body=renderModalBody({body:dialogInit.internalDialog.body},backstage);var storagedMenuButtons=mapMenuButtons(dialogInit.internalDialog.buttons);var objOfCells=extractCellsToObject(storagedMenuButtons);var footer=renderModalFooter({buttons:storagedMenuButtons},backstage);var dialogEvents=SilverDialogEvents.initDialog(function(){return instanceApi;},getEventExtras(function(){return dialog;},backstage.shared.providers,extra),backstage.shared.getSink);var dialogSize=getDialogSizeClasses(dialogInit.internalDialog.size);var spec={header:header,body:body,footer:Optional.some(footer),extraClasses:dialogSize,extraBehaviours:[],extraStyles:{}};var dialog=renderModalDialog(spec,dialogInit,dialogEvents,backstage);var modalAccess=function(){var getForm=function getForm(){var outerForm=ModalDialog.getBody(dialog);return Composing.getCurrent(outerForm).getOr(outerForm);};return{getRoot:constant$1(dialog),getBody:function getBody(){return ModalDialog.getBody(dialog);},getFooter:function getFooter(){return ModalDialog.getFooter(dialog);},getFormWrapper:getForm};}();var instanceApi=getDialogApi(modalAccess,extra.redial,objOfCells);return{dialog:dialog,instanceApi:instanceApi};};var renderInlineDialog=function renderInlineDialog(dialogInit,extra,backstage,ariaAttrs){var _a,_b;var dialogLabelId=generate$6('dialog-label');var dialogContentId=generate$6('dialog-content');var updateState=function updateState(_comp,incoming){return Optional.some(incoming);};var memHeader=record(renderInlineHeader({title:dialogInit.internalDialog.title,draggable:true},dialogLabelId,backstage.shared.providers));var memBody=record(renderInlineBody({body:dialogInit.internalDialog.body},dialogContentId,backstage,ariaAttrs));var storagedMenuButtons=mapMenuButtons(dialogInit.internalDialog.buttons);var objOfCells=extractCellsToObject(storagedMenuButtons);var memFooter=record(renderInlineFooter({buttons:storagedMenuButtons},backstage));var dialogEvents=SilverDialogEvents.initDialog(function(){return instanceApi;},{onBlock:function onBlock(event){Blocking.block(dialog,function(_comp,bs){return getBusySpec(event.message,bs,backstage.shared.providers);});},onUnblock:function onUnblock(){Blocking.unblock(dialog);},onClose:function onClose(){return extra.closeWindow();}},backstage.shared.getSink);var dialog=build$1({dom:{tag:'div',classes:['tox-dialog','tox-dialog-inline'],attributes:(_a={role:'dialog'},_a['aria-labelledby']=dialogLabelId,_a['aria-describedby']=dialogContentId,_a)},eventOrder:(_b={},_b[receive()]=[Reflecting.name(),Receiving.name()],_b[execute$5()]=['execute-on-form'],_b[attachedToDom()]=['reflecting','execute-on-form'],_b),behaviours:derive$1([Keying.config({mode:'cyclic',onEscape:function onEscape(c){emit(c,formCloseEvent);return Optional.some(true);},useTabstopAt:function useTabstopAt(elem){return!isPseudoStop(elem)&&(name$2(elem)!=='button'||get$d(elem,'disabled')!=='disabled');}}),Reflecting.config({channel:dialogChannel,updateState:updateState,initialData:dialogInit}),Focusing.config({}),config('execute-on-form',dialogEvents.concat([runOnSource(focusin(),function(comp,_se){Keying.focusIn(comp);})])),Blocking.config({getRoot:function getRoot(){return Optional.some(dialog);}}),Replacing.config({}),RepresentingConfigs.memory({})]),components:[memHeader.asSpec(),memBody.asSpec(),memFooter.asSpec()]});var instanceApi=getDialogApi({getRoot:constant$1(dialog),getFooter:function getFooter(){return memFooter.get(dialog);},getBody:function getBody(){return memBody.get(dialog);},getFormWrapper:function getFormWrapper(){var body=memBody.get(dialog);return Composing.getCurrent(body).getOr(body);}},extra.redial,objOfCells);return{dialog:dialog,instanceApi:instanceApi};};var global$1=tinymce.util.Tools.resolve('tinymce.util.URI');var getUrlDialogApi=function getUrlDialogApi(root){var withRoot=function withRoot(f){if(root.getSystem().isConnected()){f(root);}};var block=function block(message){if(!isString(message)){throw new Error('The urlDialogInstanceAPI.block function should be passed a blocking message of type string as an argument');}withRoot(function(root){emitWith(root,formBlockEvent,{message:message});});};var unblock=function unblock(){withRoot(function(root){emit(root,formUnblockEvent);});};var close=function close(){withRoot(function(root){emit(root,formCloseEvent);});};var sendMessage=function sendMessage(data){withRoot(function(root){root.getSystem().broadcastOn([bodySendMessageChannel],data);});};return{block:block,unblock:unblock,close:close,sendMessage:sendMessage};};var SUPPORTED_MESSAGE_ACTIONS=['insertContent','setContent','execCommand','close','block','unblock'];var isSupportedMessage=function isSupportedMessage(data){return isObject(data)&&SUPPORTED_MESSAGE_ACTIONS.indexOf(data.mceAction)!==-1;};var isCustomMessage=function isCustomMessage(data){return!isSupportedMessage(data)&&isObject(data)&&has$2(data,'mceAction');};var handleMessage=function handleMessage(editor,api,data){switch(data.mceAction){case'insertContent':editor.insertContent(data.content);break;case'setContent':editor.setContent(data.content);break;case'execCommand':var ui=isBoolean(data.ui)?data.ui:false;editor.execCommand(data.cmd,ui,data.value);break;case'close':api.close();break;case'block':api.block(data.message);break;case'unblock':api.unblock();break;}};var renderUrlDialog=function renderUrlDialog(internalDialog,extra,editor,backstage){var _a;var header=getHeader(internalDialog.title,backstage);var body=renderIframeBody(internalDialog);var footer=internalDialog.buttons.bind(function(buttons){if(buttons.length===0){return Optional.none();}else{return Optional.some(renderModalFooter({buttons:buttons},backstage));}});var dialogEvents=SilverDialogEvents.initUrlDialog(function(){return instanceApi;},getEventExtras(function(){return dialog;},backstage.shared.providers,extra));var styles=_assign(_assign({},internalDialog.height.fold(function(){return{};},function(height){return{'height':height+'px','max-height':height+'px'};})),internalDialog.width.fold(function(){return{};},function(width){return{'width':width+'px','max-width':width+'px'};}));var classes=internalDialog.width.isNone()&&internalDialog.height.isNone()?['tox-dialog--width-lg']:[];var iframeUri=new global$1(internalDialog.url,{base_uri:new global$1(window.location.href)});var iframeDomain=iframeUri.protocol+'://'+iframeUri.host+(iframeUri.port?':'+iframeUri.port:'');var messageHandlerUnbinder=unbindable();var extraBehaviours=[config('messages',[runOnAttached(function(){var unbind=bind(SugarElement.fromDom(window),'message',function(e){if(iframeUri.isSameOrigin(new global$1(e.raw.origin))){var data=e.raw.data;if(isSupportedMessage(data)){handleMessage(editor,instanceApi,data);}else if(isCustomMessage(data)){internalDialog.onMessage(instanceApi,data);}}});messageHandlerUnbinder.set(unbind);}),runOnDetached(messageHandlerUnbinder.clear)]),Receiving.config({channels:(_a={},_a[bodySendMessageChannel]={onReceive:function onReceive(comp,data){descendant(comp.element,'iframe').each(function(iframeEle){var iframeWin=iframeEle.dom.contentWindow;iframeWin.postMessage(data,iframeDomain);});}},_a)})];var spec={header:header,body:body,footer:footer,extraClasses:classes,extraBehaviours:extraBehaviours,extraStyles:styles};var dialog=renderModalDialog(spec,internalDialog,dialogEvents,backstage);var instanceApi=getUrlDialogApi(dialog);return{dialog:dialog,instanceApi:instanceApi};};var setup$2=function setup$2(extras){var sharedBackstage=extras.backstage.shared;var open=function open(message,callback){var closeDialog=function closeDialog(){ModalDialog.hide(alertDialog);callback();};var memFooterClose=record(renderFooterButton({name:'close-alert',text:'OK',primary:true,align:'end',disabled:false,icon:Optional.none()},'cancel',extras.backstage));var titleSpec=pUntitled();var closeSpec=pClose(closeDialog,sharedBackstage.providers);var alertDialog=build$1(renderDialog$1({lazySink:function lazySink(){return sharedBackstage.getSink();},header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[memFooterClose.asSpec()]))),onEscape:closeDialog,extraClasses:['tox-alert-dialog'],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,closeDialog)],eventOrder:{}}));ModalDialog.show(alertDialog);var footerCloseButton=memFooterClose.get(alertDialog);Focusing.focus(footerCloseButton);};return{open:open};};var setup$1=function setup$1(extras){var sharedBackstage=extras.backstage.shared;var open=function open(message,callback){var closeDialog=function closeDialog(state){ModalDialog.hide(confirmDialog);callback(state);};var memFooterYes=record(renderFooterButton({name:'yes',text:'Yes',primary:true,align:'end',disabled:false,icon:Optional.none()},'submit',extras.backstage));var footerNo=renderFooterButton({name:'no',text:'No',primary:false,align:'end',disabled:false,icon:Optional.none()},'cancel',extras.backstage);var titleSpec=pUntitled();var closeSpec=pClose(function(){return closeDialog(false);},sharedBackstage.providers);var confirmDialog=build$1(renderDialog$1({lazySink:function lazySink(){return sharedBackstage.getSink();},header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[footerNo,memFooterYes.asSpec()]))),onEscape:function onEscape(){return closeDialog(false);},extraClasses:['tox-confirm-dialog'],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,function(){return closeDialog(false);}),run$1(formSubmitEvent,function(){return closeDialog(true);})],eventOrder:{}}));ModalDialog.show(confirmDialog);var footerYesButton=memFooterYes.get(confirmDialog);Focusing.focus(footerYesButton);};return{open:open};};var validateData=function validateData(data,validator){return getOrDie(asRaw('data',validator,data));};var isAlertOrConfirmDialog=function isAlertOrConfirmDialog(target){return closest(target,'.tox-alert-dialog')||closest(target,'.tox-confirm-dialog');};var inlineAdditionalBehaviours=function inlineAdditionalBehaviours(editor,isStickyToolbar,isToolbarLocationTop){if(isStickyToolbar&&isToolbarLocationTop){return[];}else{return[Docking.config({contextual:{lazyContext:function lazyContext(){return Optional.some(box$1(SugarElement.fromDom(editor.getContentAreaContainer())));},fadeInClass:'tox-dialog-dock-fadein',fadeOutClass:'tox-dialog-dock-fadeout',transitionClass:'tox-dialog-dock-transition'},modes:['top']})];}};var setup=function setup(extras){var backstage=extras.backstage;var editor=extras.editor;var isStickyToolbar$1=isStickyToolbar(editor);var alertDialog=setup$2(extras);var confirmDialog=setup$1(extras);var open=function open(config,params,closeWindow){if(params!==undefined&&params.inline==='toolbar'){return openInlineDialog(config,backstage.shared.anchors.inlineDialog(),closeWindow,params.ariaAttrs);}else if(params!==undefined&&params.inline==='cursor'){return openInlineDialog(config,backstage.shared.anchors.cursor(),closeWindow,params.ariaAttrs);}else{return openModalDialog(config,closeWindow);}};var openUrl=function openUrl(config,closeWindow){return openModalUrlDialog(config,closeWindow);};var openModalUrlDialog=function openModalUrlDialog(config,_closeWindow){var factory=function factory(contents){var dialog=renderUrlDialog(contents,{closeWindow:function closeWindow(){ModalDialog.hide(dialog.dialog);_closeWindow(dialog.instanceApi);}},editor,backstage);ModalDialog.show(dialog.dialog);return dialog.instanceApi;};return DialogManager.openUrl(factory,config);};var openModalDialog=function openModalDialog(config,_closeWindow2){var factory=function factory(contents,internalInitialData,dataValidator){var initialData=internalInitialData;var dialogInit={dataValidator:dataValidator,initialData:initialData,internalDialog:contents};var dialog=renderDialog(dialogInit,{redial:DialogManager.redial,closeWindow:function closeWindow(){ModalDialog.hide(dialog.dialog);_closeWindow2(dialog.instanceApi);}},backstage);ModalDialog.show(dialog.dialog);dialog.instanceApi.setData(initialData);return dialog.instanceApi;};return DialogManager.open(factory,config);};var openInlineDialog=function openInlineDialog(config$1,anchor,_closeWindow3,ariaAttrs){var factory=function factory(contents,internalInitialData,dataValidator){var initialData=validateData(internalInitialData,dataValidator);var inlineDialog=value$1();var isToolbarLocationTop=backstage.shared.header.isPositionedAtTop();var dialogInit={dataValidator:dataValidator,initialData:initialData,internalDialog:contents};var refreshDocking=function refreshDocking(){return inlineDialog.on(function(dialog){InlineView.reposition(dialog);Docking.refresh(dialog);});};var dialogUi=renderInlineDialog(dialogInit,{redial:DialogManager.redial,closeWindow:function closeWindow(){inlineDialog.on(InlineView.hide);editor.off('ResizeEditor',refreshDocking);inlineDialog.clear();_closeWindow3(dialogUi.instanceApi);}},backstage,ariaAttrs);var inlineDialogComp=build$1(InlineView.sketch(_assign(_assign({lazySink:backstage.shared.getSink,dom:{tag:'div',classes:[]},fireDismissalEventInstead:{}},isToolbarLocationTop?{}:{fireRepositionEventInstead:{}}),{inlineBehaviours:derive$1(__spreadArray([config('window-manager-inline-events',[run$1(dismissRequested(),function(_comp,_se){emit(dialogUi.dialog,formCancelEvent);})])],inlineAdditionalBehaviours(editor,isStickyToolbar$1,isToolbarLocationTop),true)),isExtraPart:function isExtraPart(_comp,target){return isAlertOrConfirmDialog(target);}})));inlineDialog.set(inlineDialogComp);InlineView.showWithin(inlineDialogComp,premade(dialogUi.dialog),{anchor:anchor},Optional.some(body()));if(!isStickyToolbar$1||!isToolbarLocationTop){Docking.refresh(inlineDialogComp);editor.on('ResizeEditor',refreshDocking);}dialogUi.instanceApi.setData(initialData);Keying.focusIn(dialogUi.dialog);return dialogUi.instanceApi;};return DialogManager.open(factory,config$1);};var confirm=function confirm(message,callback){confirmDialog.open(message,function(state){callback(state);});};var alert=function alert(message,callback){alertDialog.open(message,function(){callback();});};var close=function close(instanceApi){instanceApi.close();};return{open:open,openUrl:openUrl,alert:alert,close:close,confirm:confirm};};function Theme(){global$g.add('silver',function(editor){var _a=setup$3(editor),uiMothership=_a.uiMothership,backstage=_a.backstage,renderUI=_a.renderUI,getUi=_a.getUi;Autocompleter.register(editor,backstage.shared);var windowMgr=setup({editor:editor,backstage:backstage});return{renderUI:renderUI,getWindowManagerImpl:constant$1(windowMgr),getNotificationManagerImpl:function getNotificationManagerImpl(){return NotificationManagerImpl(editor,{backstage:backstage},uiMothership);},ui:getUi()};});}Theme();})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/themes/silver/theme.js?");

/***/ }),

/***/ "./node_modules/tinymce/tinymce.js":
/*!*****************************************!*\
  !*** ./node_modules/tinymce/tinymce.js ***!
  \*****************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.10.9 (2023-11-15)\n */(function(){'use strict';var typeOf$1=function typeOf$1(x){if(x===null){return'null';}if(x===undefined){return'undefined';}var t=typeof x;if(t==='object'&&(Array.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='Array')){return'array';}if(t==='object'&&(String.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='String')){return'string';}return t;};var isEquatableType=function isEquatableType(x){return['undefined','boolean','number','string','function','xml','null'].indexOf(x)!==-1;};var sort$1=function sort$1(xs,compareFn){var clone=Array.prototype.slice.call(xs);return clone.sort(compareFn);};var contramap=function contramap(eqa,f){return eq$2(function(x,y){return eqa.eq(f(x),f(y));});};var eq$2=function eq$2(f){return{eq:f};};var tripleEq=eq$2(function(x,y){return x===y;});var eqString=tripleEq;var eqArray=function eqArray(eqa){return eq$2(function(x,y){if(x.length!==y.length){return false;}var len=x.length;for(var i=0;i<len;i++){if(!eqa.eq(x[i],y[i])){return false;}}return true;});};var eqSortedArray=function eqSortedArray(eqa,compareFn){return contramap(eqArray(eqa),function(xs){return sort$1(xs,compareFn);});};var eqRecord=function eqRecord(eqa){return eq$2(function(x,y){var kx=Object.keys(x);var ky=Object.keys(y);if(!eqSortedArray(eqString).eq(kx,ky)){return false;}var len=kx.length;for(var i=0;i<len;i++){var q=kx[i];if(!eqa.eq(x[q],y[q])){return false;}}return true;});};var eqAny=eq$2(function(x,y){if(x===y){return true;}var tx=typeOf$1(x);var ty=typeOf$1(y);if(tx!==ty){return false;}if(isEquatableType(tx)){return x===y;}else if(tx==='array'){return eqArray(eqAny).eq(x,y);}else if(tx==='object'){return eqRecord(eqAny).eq(x,y);}return false;});var typeOf=function typeOf(x){var t=typeof x;if(x===null){return'null';}else if(t==='object'&&(Array.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='Array')){return'array';}else if(t==='object'&&(String.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='String')){return'string';}else{return t;}};var isType$1=function isType$1(type){return function(value){return typeOf(value)===type;};};var isSimpleType=function isSimpleType(type){return function(value){return typeof value===type;};};var eq$1=function eq$1(t){return function(a){return t===a;};};var isString$1=isType$1('string');var isObject=isType$1('object');var isArray$1=isType$1('array');var isNull=eq$1(null);var isBoolean=isSimpleType('boolean');var isUndefined=eq$1(undefined);var isNullable=function isNullable(a){return a===null||a===undefined;};var isNonNullable=function isNonNullable(a){return!isNullable(a);};var isFunction=isSimpleType('function');var isNumber=isSimpleType('number');var noop=function noop(){};var compose=function compose(fa,fb){return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}return fa(fb.apply(null,args));};};var compose1=function compose1(fbc,fab){return function(a){return fbc(fab(a));};};var constant=function constant(value){return function(){return value;};};var identity=function identity(x){return x;};var tripleEquals=function tripleEquals(a,b){return a===b;};function curry(fn){var initialArgs=[];for(var _i=1;_i<arguments.length;_i++){initialArgs[_i-1]=arguments[_i];}return function(){var restArgs=[];for(var _i=0;_i<arguments.length;_i++){restArgs[_i]=arguments[_i];}var all=initialArgs.concat(restArgs);return fn.apply(null,all);};}var not=function not(f){return function(t){return!f(t);};};var die=function die(msg){return function(){throw new Error(msg);};};var apply=function apply(f){return f();};var call=function call(f){f();};var never=constant(false);var always=constant(true);var none=function none(){return NONE;};var NONE=function(){var call=function call(thunk){return thunk();};var id=identity;var me={fold:function fold(n,_s){return n();},isSome:never,isNone:always,getOr:id,getOrThunk:call,getOrDie:function getOrDie(msg){throw new Error(msg||'error: getOrDie called on none.');},getOrNull:constant(null),getOrUndefined:constant(undefined),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function filter(){return none();},toArray:function toArray(){return[];},toString:constant('none()')};return me;}();var _some=function some(a){var constant_a=constant(a);var self=function self(){return me;};var bind=function bind(f){return f(a);};var me={fold:function fold(n,s){return s(a);},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function map(f){return _some(f(a));},each:function each(f){f(a);},bind:bind,exists:bind,forall:bind,filter:function filter(f){return f(a)?me:NONE;},toArray:function toArray(){return[a];},toString:function toString(){return'some('+a+')';}};return me;};var from$1=function from$1(value){return value===null||value===undefined?NONE:_some(value);};var Optional={some:_some,none:none,from:from$1};var nativeSlice=Array.prototype.slice;var nativeIndexOf=Array.prototype.indexOf;var nativePush=Array.prototype.push;var rawIndexOf=function rawIndexOf(ts,t){return nativeIndexOf.call(ts,t);};var indexOf$2=function indexOf$2(xs,x){var r=rawIndexOf(xs,x);return r===-1?Optional.none():Optional.some(r);};var contains$3=function contains$3(xs,x){return rawIndexOf(xs,x)>-1;};var exists=function exists(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return true;}}return false;};var map$3=function map$3(xs,f){var len=xs.length;var r=new Array(len);for(var i=0;i<len;i++){var x=xs[i];r[i]=f(x,i);}return r;};var each$k=function each$k(xs,f){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];f(x,i);}};var eachr=function eachr(xs,f){for(var i=xs.length-1;i>=0;i--){var x=xs[i];f(x,i);}};var partition=function partition(xs,pred){var pass=[];var fail=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];var arr=pred(x,i)?pass:fail;arr.push(x);}return{pass:pass,fail:fail};};var filter$4=function filter$4(xs,pred){var r=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){r.push(x);}}return r;};var foldr=function foldr(xs,f,acc){eachr(xs,function(x,i){acc=f(acc,x,i);});return acc;};var foldl=function foldl(xs,f,acc){each$k(xs,function(x,i){acc=f(acc,x,i);});return acc;};var findUntil$1=function findUntil$1(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(x);}else if(until(x,i)){break;}}return Optional.none();};var find$3=function find$3(xs,pred){return findUntil$1(xs,pred,never);};var findIndex$2=function findIndex$2(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(i);}}return Optional.none();};var flatten=function flatten(xs){var r=[];for(var i=0,len=xs.length;i<len;++i){if(!isArray$1(xs[i])){throw new Error('Arr.flatten item '+i+' was not an array, input: '+xs);}nativePush.apply(r,xs[i]);}return r;};var bind=function bind(xs,f){return flatten(map$3(xs,f));};var forall=function forall(xs,pred){for(var i=0,len=xs.length;i<len;++i){var x=xs[i];if(pred(x,i)!==true){return false;}}return true;};var reverse=function reverse(xs){var r=nativeSlice.call(xs,0);r.reverse();return r;};var difference=function difference(a1,a2){return filter$4(a1,function(x){return!contains$3(a2,x);});};var mapToObject=function mapToObject(xs,f){var r={};for(var i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i);}return r;};var sort=function sort(xs,comparator){var copy=nativeSlice.call(xs,0);copy.sort(comparator);return copy;};var get$a=function get$a(xs,i){return i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none();};var head=function head(xs){return get$a(xs,0);};var last$2=function last$2(xs){return get$a(xs,xs.length-1);};var from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x);};var findMap=function findMap(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome()){return r;}}return Optional.none();};var keys=Object.keys;var hasOwnProperty$1=Object.hasOwnProperty;var each$j=function each$j(obj,f){var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];f(x,i);}};var map$2=function map$2(obj,f){return tupleMap(obj,function(x,i){return{k:i,v:f(x,i)};});};var tupleMap=function tupleMap(obj,f){var r={};each$j(obj,function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v;});return r;};var objAcc=function objAcc(r){return function(x,i){r[i]=x;};};var internalFilter=function internalFilter(obj,pred,onTrue,onFalse){var r={};each$j(obj,function(x,i){(pred(x,i)?onTrue:onFalse)(x,i);});return r;};var bifilter=function bifilter(obj,pred){var t={};var f={};internalFilter(obj,pred,objAcc(t),objAcc(f));return{t:t,f:f};};var filter$3=function filter$3(obj,pred){var t={};internalFilter(obj,pred,objAcc(t),noop);return t;};var mapToArray=function mapToArray(obj,f){var r=[];each$j(obj,function(value,name){r.push(f(value,name));});return r;};var values=function values(obj){return mapToArray(obj,identity);};var get$9=function get$9(obj,key){return has$2(obj,key)?Optional.from(obj[key]):Optional.none();};var has$2=function has$2(obj,key){return hasOwnProperty$1.call(obj,key);};var hasNonNullableKey=function hasNonNullableKey(obj,key){return has$2(obj,key)&&obj[key]!==undefined&&obj[key]!==null;};var equal$1=function equal$1(a1,a2,eq){if(eq===void 0){eq=eqAny;}return eqRecord(eq).eq(a1,a2);};var isArray=Array.isArray;var toArray$1=function toArray$1(obj){if(!isArray(obj)){var array=[];for(var i=0,l=obj.length;i<l;i++){array[i]=obj[i];}return array;}else{return obj;}};var each$i=function each$i(o,cb,s){var n,l;if(!o){return false;}s=s||o;if(o.length!==undefined){for(n=0,l=o.length;n<l;n++){if(cb.call(s,o[n],n,o)===false){return false;}}}else{for(n in o){if(has$2(o,n)){if(cb.call(s,o[n],n,o)===false){return false;}}}}return true;};var map$1=function map$1(array,callback){var out=[];each$i(array,function(item,index){out.push(callback(item,index,array));});return out;};var filter$2=function filter$2(a,f){var o=[];each$i(a,function(v,index){if(!f||f(v,index,a)){o.push(v);}});return o;};var indexOf$1=function indexOf$1(a,v){if(a){for(var i=0,l=a.length;i<l;i++){if(a[i]===v){return i;}}}return-1;};var reduce=function reduce(collection,iteratee,accumulator,thisArg){var acc=isUndefined(accumulator)?collection[0]:accumulator;for(var i=0;i<collection.length;i++){acc=iteratee.call(thisArg,acc,collection[i],i);}return acc;};var findIndex$1=function findIndex$1(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++){if(predicate.call(thisArg,array[i],i,array)){return i;}}return-1;};var last$1=function last$1(collection){return collection[collection.length-1];};var _assign=function __assign(){_assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return _assign.apply(this,arguments);};function __rest(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==='function')for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]];}return t;}function __spreadArray(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i];}}return to.concat(ar||Array.prototype.slice.call(from));}var cached=function cached(f){var called=false;var r;return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}if(!called){called=true;r=f.apply(null,args);}return r;};};var DeviceType=function DeviceType(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&/ipad/i.test(userAgent)===true;var isiPhone=os.isiOS()&&!isiPad;var isMobile=os.isiOS()||os.isAndroid();var isTouch=isMobile||mediaMatch('(pointer:coarse)');var isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch('(min-device-width:768px)');var isPhone=isiPhone||isMobile&&!isTablet;var iOSwebview=browser.isSafari()&&os.isiOS()&&/safari/i.test(userAgent)===false;var isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(isTablet),isPhone:constant(isPhone),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(iOSwebview),isDesktop:constant(isDesktop)};};var firstMatch=function firstMatch(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s)){return x;}}return undefined;};var find$2=function find$2(regexes,agent){var r=firstMatch(regexes,agent);if(!r){return{major:0,minor:0};}var group=function group(i){return Number(agent.replace(r,'$'+i));};return nu$4(group(1),group(2));};var detect$3=function detect$3(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();if(versionRegexes.length===0){return unknown$2();}return find$2(versionRegexes,cleanedAgent);};var unknown$2=function unknown$2(){return nu$4(0,0);};var nu$4=function nu$4(major,minor){return{major:major,minor:minor};};var Version={nu:nu$4,detect:detect$3,unknown:unknown$2};var detectBrowser$1=function detectBrowser$1(browsers,userAgentData){return findMap(userAgentData.brands,function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$3(browsers,function(browser){var _a;return lcBrand===((_a=browser.brand)===null||_a===void 0?void 0:_a.toLowerCase());}).map(function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)};});});};var detect$2=function detect$2(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$3(candidates,function(candidate){return candidate.search(agent);});};var detectBrowser=function detectBrowser(browsers,userAgent){return detect$2(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version};});};var detectOs=function detectOs(oses,userAgent){return detect$2(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version};});};var removeFromStart=function removeFromStart(str,numChars){return str.substring(numChars);};var checkRange=function checkRange(str,substr,start){return substr===''||str.length>=substr.length&&str.substr(start,start+substr.length)===substr;};var removeLeading=function removeLeading(str,prefix){return startsWith(str,prefix)?removeFromStart(str,prefix.length):str;};var contains$2=function contains$2(str,substr){return str.indexOf(substr)!==-1;};var startsWith=function startsWith(str,prefix){return checkRange(str,prefix,0);};var blank=function blank(r){return function(s){return s.replace(r,'');};};var trim$5=blank(/^\\s+|\\s+$/g);var lTrim=blank(/^\\s+/g);var rTrim=blank(/\\s+$/g);var isNotEmpty=function isNotEmpty(s){return s.length>0;};var isEmpty$3=function isEmpty$3(s){return!isNotEmpty(s);};var normalVersionRegex=/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;var checkContains=function checkContains(target){return function(uastring){return contains$2(uastring,target);};};var browsers=[{name:'Edge',versionRegexes:[/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],search:function search(uastring){return contains$2(uastring,'edge/')&&contains$2(uastring,'chrome')&&contains$2(uastring,'safari')&&contains$2(uastring,'applewebkit');}},{name:'Chrome',brand:'Chromium',versionRegexes:[/.*?chrome\\/([0-9]+)\\.([0-9]+).*/,normalVersionRegex],search:function search(uastring){return contains$2(uastring,'chrome')&&!contains$2(uastring,'chromeframe');}},{name:'IE',versionRegexes:[/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,/.*?rv:([0-9]+)\\.([0-9]+).*/],search:function search(uastring){return contains$2(uastring,'msie')||contains$2(uastring,'trident');}},{name:'Opera',versionRegexes:[normalVersionRegex,/.*?opera\\/([0-9]+)\\.([0-9]+).*/],search:checkContains('opera')},{name:'Firefox',versionRegexes:[/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],search:checkContains('firefox')},{name:'Safari',versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function search(uastring){return(contains$2(uastring,'safari')||contains$2(uastring,'mobile/'))&&contains$2(uastring,'applewebkit');}}];var oses=[{name:'Windows',search:checkContains('win'),versionRegexes:[/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]},{name:'iOS',search:function search(uastring){return contains$2(uastring,'iphone')||contains$2(uastring,'ipad');},versionRegexes:[/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:'Android',search:checkContains('android'),versionRegexes:[/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]},{name:'OSX',search:checkContains('mac os x'),versionRegexes:[/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]},{name:'Linux',search:checkContains('linux'),versionRegexes:[]},{name:'Solaris',search:checkContains('sunos'),versionRegexes:[]},{name:'FreeBSD',search:checkContains('freebsd'),versionRegexes:[]},{name:'ChromeOS',search:checkContains('cros'),versionRegexes:[/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]}];var PlatformInfo={browsers:constant(browsers),oses:constant(oses)};var edge='Edge';var chrome='Chrome';var ie$1='IE';var opera='Opera';var firefox='Firefox';var safari='Safari';var unknown$1=function unknown$1(){return nu$3({current:undefined,version:Version.unknown()});};var nu$3=function nu$3(info){var current=info.current;var version=info.version;var isBrowser=function isBrowser(name){return function(){return current===name;};};return{current:current,version:version,isEdge:isBrowser(edge),isChrome:isBrowser(chrome),isIE:isBrowser(ie$1),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)};};var Browser={unknown:unknown$1,nu:nu$3,edge:constant(edge),chrome:constant(chrome),ie:constant(ie$1),opera:constant(opera),firefox:constant(firefox),safari:constant(safari)};var windows='Windows';var ios='iOS';var android='Android';var linux='Linux';var osx='OSX';var solaris='Solaris';var freebsd='FreeBSD';var chromeos='ChromeOS';var unknown=function unknown(){return nu$2({current:undefined,version:Version.unknown()});};var nu$2=function nu$2(info){var current=info.current;var version=info.version;var isOS=function isOS(name){return function(){return current===name;};};return{current:current,version:version,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isOSX:isOS(osx),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)};};var OperatingSystem={unknown:unknown,nu:nu$2,windows:constant(windows),ios:constant(ios),android:constant(android),linux:constant(linux),osx:constant(osx),solaris:constant(solaris),freebsd:constant(freebsd),chromeos:constant(chromeos)};var detect$1=function detect$1(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers();var oses=PlatformInfo.oses();var browser=userAgentDataOpt.bind(function(userAgentData){return detectBrowser$1(browsers,userAgentData);}).orThunk(function(){return detectBrowser(browsers,userAgent);}).fold(Browser.unknown,Browser.nu);var os=detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu);var deviceType=DeviceType(os,browser,userAgent,mediaMatch);return{browser:browser,os:os,deviceType:deviceType};};var PlatformDetection={detect:detect$1};var mediaMatch=function mediaMatch(query){return window.matchMedia(query).matches;};var platform$2=cached(function(){return PlatformDetection.detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch);});var detect=function detect(){return platform$2();};var userAgent=navigator.userAgent;var platform$1=detect();var browser$4=platform$1.browser;var os=platform$1.os;var deviceType=platform$1.deviceType;var webkit=/WebKit/.test(userAgent)&&!browser$4.isEdge();var fileApi='FormData'in window&&'FileReader'in window&&'URL'in window&&!!URL.createObjectURL;var windowsPhone=userAgent.indexOf('Windows Phone')!==-1;var Env={opera:browser$4.isOpera(),webkit:webkit,ie:browser$4.isIE()||browser$4.isEdge()?browser$4.version.major:false,gecko:browser$4.isFirefox(),mac:os.isOSX()||os.isiOS(),iOS:deviceType.isiPad()||deviceType.isiPhone(),android:os.isAndroid(),contentEditable:true,transparentSrc:'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',caretAfter:true,range:window.getSelection&&'Range'in window,documentMode:browser$4.isIE()?document.documentMode||7:10,fileApi:fileApi,ceFalse:true,cacheSuffix:null,container:null,experimentalShadowDom:false,canHaveCSP:!browser$4.isIE(),desktop:deviceType.isDesktop(),windowsPhone:windowsPhone,browser:{current:browser$4.current,version:browser$4.version,isChrome:browser$4.isChrome,isEdge:browser$4.isEdge,isFirefox:browser$4.isFirefox,isIE:browser$4.isIE,isOpera:browser$4.isOpera,isSafari:browser$4.isSafari},os:{current:os.current,version:os.version,isAndroid:os.isAndroid,isChromeOS:os.isChromeOS,isFreeBSD:os.isFreeBSD,isiOS:os.isiOS,isLinux:os.isLinux,isOSX:os.isOSX,isSolaris:os.isSolaris,isWindows:os.isWindows},deviceType:{isDesktop:deviceType.isDesktop,isiPad:deviceType.isiPad,isiPhone:deviceType.isiPhone,isPhone:deviceType.isPhone,isTablet:deviceType.isTablet,isTouch:deviceType.isTouch,isWebView:deviceType.isWebView}};var whiteSpaceRegExp$2=/^\\s*|\\s*$/g;var trim$4=function trim$4(str){return str===null||str===undefined?'':(''+str).replace(whiteSpaceRegExp$2,'');};var is$3=function is$3(obj,type){if(!type){return obj!==undefined;}if(type==='array'&&isArray(obj)){return true;}return typeof obj===type;};var makeMap$4=function makeMap$4(items,delim,map){var i;items=items||[];delim=delim||',';if(typeof items==='string'){items=items.split(delim);}map=map||{};i=items.length;while(i--){map[items[i]]={};}return map;};var hasOwnProperty=has$2;var create$9=function create$9(s,p,root){var self=this;var sp,scn,c,de=0;s=/^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);var cn=s[3].match(/(^|\\.)(\\w+)$/i)[2];var ns=self.createNS(s[3].replace(/\\.\\w+$/,''),root);if(ns[cn]){return;}if(s[2]==='static'){ns[cn]=p;if(this.onCreate){this.onCreate(s[2],s[3],ns[cn]);}return;}if(!p[cn]){p[cn]=function(){};de=1;}ns[cn]=p[cn];self.extend(ns[cn].prototype,p);if(s[5]){sp=self.resolve(s[5]).prototype;scn=s[5].match(/\\.(\\w+)$/i)[1];c=ns[cn];if(de){ns[cn]=function(){return sp[scn].apply(this,arguments);};}else{ns[cn]=function(){this.parent=sp[scn];return c.apply(this,arguments);};}ns[cn].prototype[cn]=ns[cn];self.each(sp,function(f,n){ns[cn].prototype[n]=sp[n];});self.each(p,function(f,n){if(sp[n]){ns[cn].prototype[n]=function(){this.parent=sp[n];return f.apply(this,arguments);};}else{if(n!==cn){ns[cn].prototype[n]=f;}}});}self.each(p.static,function(f,n){ns[cn][n]=f;});};var extend$6=function extend$6(obj){var exts=[];for(var _i=1;_i<arguments.length;_i++){exts[_i-1]=arguments[_i];}for(var i=0;i<exts.length;i++){var ext=exts[i];for(var name_1 in ext){if(has$2(ext,name_1)){var value=ext[name_1];if(value!==undefined){obj[name_1]=value;}}}}return obj;};var _walk$=function walk$3(o,f,n,s){s=s||this;if(o){if(n){o=o[n];}each$i(o,function(o,i){if(f.call(s,o,i,n)===false){return false;}_walk$(o,f,n,s);});}};var createNS=function createNS(n,o){var i,v;o=o||window;n=n.split('.');for(i=0;i<n.length;i++){v=n[i];if(!o[v]){o[v]={};}o=o[v];}return o;};var resolve$3=function resolve$3(n,o){var i,l;o=o||window;n=n.split('.');for(i=0,l=n.length;i<l;i++){o=o[n[i]];if(!o){break;}}return o;};var explode$4=function explode$4(s,d){if(!s||is$3(s,'array')){return s;}return map$1(s.split(d||','),trim$4);};var _addCacheSuffix=function _addCacheSuffix(url){var cacheSuffix=Env.cacheSuffix;if(cacheSuffix){url+=(url.indexOf('?')===-1?'?':'&')+cacheSuffix;}return url;};var Tools={trim:trim$4,isArray:isArray,is:is$3,toArray:toArray$1,makeMap:makeMap$4,each:each$i,map:map$1,grep:filter$2,inArray:indexOf$1,hasOwn:hasOwnProperty,extend:extend$6,create:create$9,walk:_walk$,createNS:createNS,resolve:resolve$3,explode:explode$4,_addCacheSuffix:_addCacheSuffix};var fromHtml$1=function fromHtml$1(html,scope){var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;if(!div.hasChildNodes()||div.childNodes.length>1){console.error('HTML does not have a single root node',html);throw new Error('HTML must have a single root node');}return fromDom$2(div.childNodes[0]);};var fromTag=function fromTag(tag,scope){var doc=scope||document;var node=doc.createElement(tag);return fromDom$2(node);};var fromText=function fromText(text,scope){var doc=scope||document;var node=doc.createTextNode(text);return fromDom$2(node);};var fromDom$2=function fromDom$2(node){if(node===null||node===undefined){throw new Error('Node cannot be null or undefined');}return{dom:node};};var fromPoint$1=function fromPoint$1(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom$2);};var SugarElement={fromHtml:fromHtml$1,fromTag:fromTag,fromText:fromText,fromDom:fromDom$2,fromPoint:fromPoint$1};var toArray=function toArray(target,f){var r=[];var recurse=function recurse(e){r.push(e);return f(e);};var cur=f(target);do{cur=cur.bind(recurse);}while(cur.isSome());return r;};var compareDocumentPosition=function compareDocumentPosition(a,b,match){return(a.compareDocumentPosition(b)&match)!==0;};var documentPositionContainedBy=function documentPositionContainedBy(a,b){return compareDocumentPosition(a,b,Node.DOCUMENT_POSITION_CONTAINED_BY);};var COMMENT=8;var DOCUMENT=9;var DOCUMENT_FRAGMENT=11;var ELEMENT=1;var TEXT=3;var is$2=function is$2(element,selector){var dom=element.dom;if(dom.nodeType!==ELEMENT){return false;}else{var elem=dom;if(elem.matches!==undefined){return elem.matches(selector);}else if(elem.msMatchesSelector!==undefined){return elem.msMatchesSelector(selector);}else if(elem.webkitMatchesSelector!==undefined){return elem.webkitMatchesSelector(selector);}else if(elem.mozMatchesSelector!==undefined){return elem.mozMatchesSelector(selector);}else{throw new Error('Browser lacks native selectors');}}};var bypassSelector=function bypassSelector(dom){return dom.nodeType!==ELEMENT&&dom.nodeType!==DOCUMENT&&dom.nodeType!==DOCUMENT_FRAGMENT||dom.childElementCount===0;};var all=function all(selector,scope){var base=scope===undefined?document:scope.dom;return bypassSelector(base)?[]:map$3(base.querySelectorAll(selector),SugarElement.fromDom);};var one=function one(selector,scope){var base=scope===undefined?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);};var eq=function eq(e1,e2){return e1.dom===e2.dom;};var regularContains=function regularContains(e1,e2){var d1=e1.dom;var d2=e2.dom;return d1===d2?false:d1.contains(d2);};var ieContains=function ieContains(e1,e2){return documentPositionContainedBy(e1.dom,e2.dom);};var contains$1=function contains$1(e1,e2){return detect().browser.isIE()?ieContains(e1,e2):regularContains(e1,e2);};typeof window!=='undefined'?window:Function('return this;')();var name=function name(element){var r=element.dom.nodeName;return r.toLowerCase();};var type=function type(element){return element.dom.nodeType;};var isType=function isType(t){return function(element){return type(element)===t;};};var isComment$1=function isComment$1(element){return type(element)===COMMENT||name(element)==='#comment';};var isElement$6=isType(ELEMENT);var isText$8=isType(TEXT);var isDocument$2=isType(DOCUMENT);var isDocumentFragment$1=isType(DOCUMENT_FRAGMENT);var isTag=function isTag(tag){return function(e){return isElement$6(e)&&name(e)===tag;};};var owner$1=function owner$1(element){return SugarElement.fromDom(element.dom.ownerDocument);};var documentOrOwner=function documentOrOwner(dos){return isDocument$2(dos)?dos:owner$1(dos);};var documentElement=function documentElement(element){return SugarElement.fromDom(documentOrOwner(element).dom.documentElement);};var defaultView=function defaultView(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);};var parent=function parent(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);};var parents$1=function parents$1(element,isRoot){var stop=isFunction(isRoot)?isRoot:never;var dom=element.dom;var ret=[];while(dom.parentNode!==null&&dom.parentNode!==undefined){var rawParent=dom.parentNode;var p=SugarElement.fromDom(rawParent);ret.push(p);if(stop(p)===true){break;}else{dom=rawParent;}}return ret;};var siblings=function siblings(element){var filterSelf=function filterSelf(elements){return filter$4(elements,function(x){return!eq(element,x);});};return parent(element).map(children).map(filterSelf).getOr([]);};var prevSibling=function prevSibling(element){return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);};var nextSibling=function nextSibling(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);};var prevSiblings=function prevSiblings(element){return reverse(toArray(element,prevSibling));};var nextSiblings=function nextSiblings(element){return toArray(element,nextSibling);};var children=function children(element){return map$3(element.dom.childNodes,SugarElement.fromDom);};var child$1=function child$1(element,index){var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom);};var firstChild=function firstChild(element){return child$1(element,0);};var lastChild=function lastChild(element){return child$1(element,element.dom.childNodes.length-1);};var childNodesCount=function childNodesCount(element){return element.dom.childNodes.length;};var getHead=function getHead(doc){var b=doc.dom.head;if(b===null||b===undefined){throw new Error('Head is not available yet');}return SugarElement.fromDom(b);};var isShadowRoot=function isShadowRoot(dos){return isDocumentFragment$1(dos)&&isNonNullable(dos.dom.host);};var supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode);var isSupported$1=constant(supported);var getRootNode=supported?function(e){return SugarElement.fromDom(e.dom.getRootNode());}:documentOrOwner;var getStyleContainer=function getStyleContainer(dos){return isShadowRoot(dos)?dos:getHead(documentOrOwner(dos));};var getShadowRoot=function getShadowRoot(e){var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none();};var getShadowHost=function getShadowHost(e){return SugarElement.fromDom(e.dom.host);};var getOriginalEventTarget=function getOriginalEventTarget(event){if(isSupported$1()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$6(el)&&isOpenShadowHost(el)){if(event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath){return head(composedPath);}}}}return Optional.from(event.target);};var isOpenShadowHost=function isOpenShadowHost(element){return isNonNullable(element.dom.shadowRoot);};var before$4=function before$4(marker,element){var parent$1=parent(marker);parent$1.each(function(v){v.dom.insertBefore(element.dom,marker.dom);});};var after$3=function after$3(marker,element){var sibling=nextSibling(marker);sibling.fold(function(){var parent$1=parent(marker);parent$1.each(function(v){append$1(v,element);});},function(v){before$4(v,element);});};var prepend=function prepend(parent,element){var firstChild$1=firstChild(parent);firstChild$1.fold(function(){append$1(parent,element);},function(v){parent.dom.insertBefore(element.dom,v.dom);});};var append$1=function append$1(parent,element){parent.dom.appendChild(element.dom);};var wrap$3=function wrap$3(element,wrapper){before$4(element,wrapper);append$1(wrapper,element);};var before$3=function before$3(marker,elements){each$k(elements,function(x){before$4(marker,x);});};var append=function append(parent,elements){each$k(elements,function(x){append$1(parent,x);});};var empty=function empty(element){element.dom.textContent='';each$k(children(element),function(rogue){remove$7(rogue);});};var remove$7=function remove$7(element){var dom=element.dom;if(dom.parentNode!==null){dom.parentNode.removeChild(dom);}};var unwrap=function unwrap(wrapper){var children$1=children(wrapper);if(children$1.length>0){before$3(wrapper,children$1);}remove$7(wrapper);};var _inBody=function inBody(element){var dom=isText$8(element)?element.dom.parentNode:element.dom;if(dom===undefined||dom===null||dom.ownerDocument===null){return false;}var doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold(function(){return doc.body.contains(dom);},compose1(_inBody,getShadowHost));};var _r=function r(left,top){var translate=function translate(x,y){return _r(left+x,top+y);};return{left:left,top:top,translate:translate};};var SugarPosition=_r;var boxPosition=function boxPosition(dom){var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top);};var firstDefinedOrZero=function firstDefinedOrZero(a,b){if(a!==undefined){return a;}else{return b!==undefined?b:0;}};var absolute=function absolute(element){var doc=element.dom.ownerDocument;var body=doc.body;var win=doc.defaultView;var html=doc.documentElement;if(body===element.dom){return SugarPosition(body.offsetLeft,body.offsetTop);}var scrollTop=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageYOffset,html.scrollTop);var scrollLeft=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageXOffset,html.scrollLeft);var clientTop=firstDefinedOrZero(html.clientTop,body.clientTop);var clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport(element).translate(scrollLeft-clientLeft,scrollTop-clientTop);};var viewport=function viewport(element){var dom=element.dom;var doc=dom.ownerDocument;var body=doc.body;if(body===dom){return SugarPosition(body.offsetLeft,body.offsetTop);}if(!_inBody(element)){return SugarPosition(0,0);}return boxPosition(dom);};var get$8=function get$8(_DOC){var doc=_DOC!==undefined?_DOC.dom:document;var x=doc.body.scrollLeft||doc.documentElement.scrollLeft;var y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y);};var to=function to(x,y,_DOC){var doc=_DOC!==undefined?_DOC.dom:document;var win=doc.defaultView;if(win){win.scrollTo(x,y);}};var intoView=function intoView(element,alignToTop){var isSafari=detect().browser.isSafari();if(isSafari&&isFunction(element.dom.scrollIntoViewIfNeeded)){element.dom.scrollIntoViewIfNeeded(false);}else{element.dom.scrollIntoView(alignToTop);}};var get$7=function get$7(_win){var win=_win===undefined?window:_win;if(detect().browser.isFirefox()){return Optional.none();}else{return Optional.from(win['visualViewport']);}};var bounds=function bounds(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height};};var getBounds=function getBounds(_win){var win=_win===undefined?window:_win;var doc=win.document;var scroll=get$8(SugarElement.fromDom(doc));return get$7(win).fold(function(){var html=win.document.documentElement;var width=html.clientWidth;var height=html.clientHeight;return bounds(scroll.left,scroll.top,width,height);},function(visualViewport){return bounds(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height);});};var isNodeType=function isNodeType(type){return function(node){return!!node&&node.nodeType===type;};};var isRestrictedNode=function isRestrictedNode(node){return!!node&&!Object.getPrototypeOf(node);};var isElement$5=isNodeType(1);var matchNodeNames=function matchNodeNames(names){var lowercasedNames=names.map(function(s){return s.toLowerCase();});return function(node){if(node&&node.nodeName){var nodeName=node.nodeName.toLowerCase();return contains$3(lowercasedNames,nodeName);}return false;};};var matchStyleValues=function matchStyleValues(name,values){var items=values.toLowerCase().split(' ');return function(node){if(isElement$5(node)){for(var i=0;i<items.length;i++){var computed=node.ownerDocument.defaultView.getComputedStyle(node,null);var cssValue=computed?computed.getPropertyValue(name):null;if(cssValue===items[i]){return true;}}}return false;};};var hasAttribute=function hasAttribute(attrName){return function(node){return isElement$5(node)&&node.hasAttribute(attrName);};};var hasAttributeValue=function hasAttributeValue(attrName,attrValue){return function(node){return isElement$5(node)&&node.getAttribute(attrName)===attrValue;};};var isBogus$2=function isBogus$2(node){return isElement$5(node)&&node.hasAttribute('data-mce-bogus');};var isBogusAll$1=function isBogusAll$1(node){return isElement$5(node)&&node.getAttribute('data-mce-bogus')==='all';};var isTable$3=function isTable$3(node){return isElement$5(node)&&node.tagName==='TABLE';};var hasContentEditableState=function hasContentEditableState(value){return function(node){if(isElement$5(node)){if(node.contentEditable===value){return true;}if(node.getAttribute('data-mce-contenteditable')===value){return true;}}return false;};};var isTextareaOrInput=matchNodeNames(['textarea','input']);var isText$7=isNodeType(3);var isComment=isNodeType(8);var isDocument$1=isNodeType(9);var isDocumentFragment=isNodeType(11);var isBr$5=matchNodeNames(['br']);var isImg=matchNodeNames(['img']);var isContentEditableTrue$4=hasContentEditableState('true');var isContentEditableFalse$b=hasContentEditableState('false');var isTableCell$5=matchNodeNames(['td','th']);var isMedia$2=matchNodeNames(['video','audio','object','embed']);var is$1=function is$1(lhs,rhs,comparator){if(comparator===void 0){comparator=tripleEquals;}return lhs.exists(function(left){return comparator(left,rhs);});};var cat=function cat(arr){var r=[];var push=function push(x){r.push(x);};for(var i=0;i<arr.length;i++){arr[i].each(push);}return r;};var lift2=function lift2(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none();};var lift3=function lift3(oa,ob,oc,f){return oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none();};var someIf=function someIf(b,a){return b?Optional.some(a):Optional.none();};var isSupported=function isSupported(dom){return dom.style!==undefined&&isFunction(dom.style.getPropertyValue);};var rawSet=function rawSet(dom,key,value){if(isString$1(value)||isBoolean(value)||isNumber(value)){dom.setAttribute(key,value+'');}else{console.error('Invalid call to Attribute.set. Key ',key,':: Value ',value,':: Element ',dom);throw new Error('Attribute value was not simple');}};var set$1=function set$1(element,key,value){rawSet(element.dom,key,value);};var setAll$1=function setAll$1(element,attrs){var dom=element.dom;each$j(attrs,function(v,k){rawSet(dom,k,v);});};var get$6=function get$6(element,key){var v=element.dom.getAttribute(key);return v===null?undefined:v;};var getOpt=function getOpt(element,key){return Optional.from(get$6(element,key));};var has$1=function has$1(element,key){var dom=element.dom;return dom&&dom.hasAttribute?dom.hasAttribute(key):false;};var remove$6=function remove$6(element,key){element.dom.removeAttribute(key);};var clone$3=function clone$3(element){return foldl(element.dom.attributes,function(acc,attr){acc[attr.name]=attr.value;return acc;},{});};var internalSet=function internalSet(dom,property,value){if(!isString$1(value)){console.error('Invalid call to CSS.set. Property ',property,':: Value ',value,':: Element ',dom);throw new Error('CSS value must be a string: '+value);}if(isSupported(dom)){dom.style.setProperty(property,value);}};var setAll=function setAll(element,css){var dom=element.dom;each$j(css,function(v,k){internalSet(dom,k,v);});};var get$5=function get$5(element,property){var dom=element.dom;var styles=window.getComputedStyle(dom);var r=styles.getPropertyValue(property);return r===''&&!_inBody(element)?getUnsafeProperty(dom,property):r;};var getUnsafeProperty=function getUnsafeProperty(dom,property){return isSupported(dom)?dom.style.getPropertyValue(property):'';};var getRaw=function getRaw(element,property){var dom=element.dom;var raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter(function(r){return r.length>0;});};var getAllRaw=function getAllRaw(element){var css={};var dom=element.dom;if(isSupported(dom)){for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName];}}return css;};var reflow=function reflow(e){return e.dom.offsetWidth;};var browser$3=detect().browser;var firstElement=function firstElement(nodes){return find$3(nodes,isElement$6);};var getTableCaptionDeltaY=function getTableCaptionDeltaY(elm){if(browser$3.isFirefox()&&name(elm)==='table'){return firstElement(children(elm)).filter(function(elm){return name(elm)==='caption';}).bind(function(caption){return firstElement(nextSiblings(caption)).map(function(body){var bodyTop=body.dom.offsetTop;var captionTop=caption.dom.offsetTop;var captionHeight=caption.dom.offsetHeight;return bodyTop<=captionTop?-captionHeight:0;});}).getOr(0);}else{return 0;}};var hasChild=function hasChild(elm,child){return elm.children&&contains$3(elm.children,child);};var getPos=function getPos(body,elm,rootElm){var x=0,y=0;var doc=body.ownerDocument;rootElm=rootElm?rootElm:body;if(elm){if(rootElm===body&&elm.getBoundingClientRect&&get$5(SugarElement.fromDom(body),'position')==='static'){var pos=elm.getBoundingClientRect();x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-doc.documentElement.clientLeft;y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-doc.documentElement.clientTop;return{x:x,y:y};}var offsetParent=elm;while(offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm)){var castOffsetParent=offsetParent;x+=castOffsetParent.offsetLeft||0;y+=castOffsetParent.offsetTop||0;offsetParent=castOffsetParent.offsetParent;}offsetParent=elm.parentNode;while(offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm)){x-=offsetParent.scrollLeft||0;y-=offsetParent.scrollTop||0;offsetParent=offsetParent.parentNode;}y+=getTableCaptionDeltaY(SugarElement.fromDom(elm));}return{x:x,y:y};};var exports$1={},module$1={exports:exports$1};(function(define,exports,module,require){(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):(global=typeof globalThis!=='undefined'?globalThis:global||self,global.EphoxContactWrapper=factory());})(this,function(){var commonjsGlobal=typeof globalThis!=='undefined'?globalThis:typeof window!=='undefined'?window:typeof __webpack_require__.g!=='undefined'?__webpack_require__.g:typeof self!=='undefined'?self:{};var promise={exports:{}};(function(module){(function(root){var setTimeoutFunc=setTimeout;function noop(){}function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments);};}function Promise(fn){if(typeof this!=='object')throw new TypeError('Promises must be constructed via new');if(typeof fn!=='function')throw new TypeError('not a function');this._state=0;this._handled=false;this._value=undefined;this._deferreds=[];doResolve(fn,this);}function handle(self,deferred){while(self._state===3){self=self._value;}if(self._state===0){self._deferreds.push(deferred);return;}self._handled=true;Promise._immediateFn(function(){var cb=self._state===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){(self._state===1?resolve:reject)(deferred.promise,self._value);return;}var ret;try{ret=cb(self._value);}catch(e){reject(deferred.promise,e);return;}resolve(deferred.promise,ret);});}function resolve(self,newValue){try{if(newValue===self)throw new TypeError('A promise cannot be resolved with itself.');if(newValue&&(typeof newValue==='object'||typeof newValue==='function')){var then=newValue.then;if(newValue instanceof Promise){self._state=3;self._value=newValue;finale(self);return;}else if(typeof then==='function'){doResolve(bind(then,newValue),self);return;}}self._state=1;self._value=newValue;finale(self);}catch(e){reject(self,e);}}function reject(self,newValue){self._state=2;self._value=newValue;finale(self);}function finale(self){if(self._state===2&&self._deferreds.length===0){Promise._immediateFn(function(){if(!self._handled){Promise._unhandledRejectionFn(self._value);}});}for(var i=0,len=self._deferreds.length;i<len;i++){handle(self,self._deferreds[i]);}self._deferreds=null;}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled==='function'?onFulfilled:null;this.onRejected=typeof onRejected==='function'?onRejected:null;this.promise=promise;}function doResolve(fn,self){var done=false;try{fn(function(value){if(done)return;done=true;resolve(self,value);},function(reason){if(done)return;done=true;reject(self,reason);});}catch(ex){if(done)return;done=true;reject(self,ex);}}Promise.prototype['catch']=function(onRejected){return this.then(null,onRejected);};Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);handle(this,new Handler(onFulfilled,onRejected,prom));return prom;};Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&(typeof val==='object'||typeof val==='function')){var then=val.then;if(typeof then==='function'){then.call(val,function(val){res(i,val);},reject);return;}}args[i]=val;if(--remaining===0){resolve(args);}}catch(ex){reject(ex);}}for(var i=0;i<args.length;i++){res(i,args[i]);}});};Promise.resolve=function(value){if(value&&typeof value==='object'&&value.constructor===Promise){return value;}return new Promise(function(resolve){resolve(value);});};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value);});};Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++){values[i].then(resolve,reject);}});};Promise._immediateFn=typeof setImmediate==='function'?function(fn){setImmediate(fn);}:function(fn){setTimeoutFunc(fn,0);};Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){if(typeof console!=='undefined'&&console){console.warn('Possible Unhandled Promise Rejection:',err);}};Promise._setImmediateFn=function _setImmediateFn(fn){Promise._immediateFn=fn;};Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){Promise._unhandledRejectionFn=fn;};if(module.exports){module.exports=Promise;}else if(!root.Promise){root.Promise=Promise;}})(commonjsGlobal);})(promise);var promisePolyfill=promise.exports;var Global=function(){if(typeof window!=='undefined'){return window;}else{return Function('return this;')();}}();var promisePolyfill_1={boltExport:Global.Promise||promisePolyfill};return promisePolyfill_1;});})(undefined,exports$1,module$1);var Promise$1=module$1.exports.boltExport;var _nu$=function nu$1(baseFn){var data=Optional.none();var callbacks=[];var map=function map(f){return _nu$(function(nCallback){get(function(data){nCallback(f(data));});});};var get=function get(nCallback){if(isReady()){call(nCallback);}else{callbacks.push(nCallback);}};var set=function set(x){if(!isReady()){data=Optional.some(x);run(callbacks);callbacks=[];}};var isReady=function isReady(){return data.isSome();};var run=function run(cbs){each$k(cbs,call);};var call=function call(cb){data.each(function(x){setTimeout(function(){cb(x);},0);});};baseFn(set);return{get:get,map:map,isReady:isReady};};var pure$1=function pure$1(a){return _nu$(function(callback){callback(a);});};var LazyValue={nu:_nu$,pure:pure$1};var errorReporter=function errorReporter(err){setTimeout(function(){throw err;},0);};var _make=function make(run){var get=function get(callback){run().then(callback,errorReporter);};var map=function map(fab){return _make(function(){return run().then(fab);});};var bind=function bind(aFutureB){return _make(function(){return run().then(function(v){return aFutureB(v).toPromise();});});};var anonBind=function anonBind(futureB){return _make(function(){return run().then(function(){return futureB.toPromise();});});};var toLazy=function toLazy(){return LazyValue.nu(get);};var toCached=function toCached(){var cache=null;return _make(function(){if(cache===null){cache=run();}return cache;});};var toPromise=run;return{map:map,bind:bind,anonBind:anonBind,toLazy:toLazy,toCached:toCached,toPromise:toPromise,get:get};};var nu=function nu(baseFn){return _make(function(){return new Promise$1(baseFn);});};var pure=function pure(a){return _make(function(){return Promise$1.resolve(a);});};var Future={nu:nu,pure:pure};var par$1=function par$1(asyncValues,nu){return nu(function(callback){var r=[];var count=0;var cb=function cb(i){return function(value){r[i]=value;count++;if(count>=asyncValues.length){callback(r);}};};if(asyncValues.length===0){callback([]);}else{each$k(asyncValues,function(asyncValue,i){asyncValue.get(cb(i));});}});};var par=function par(futures){return par$1(futures,Future.nu);};var _value$=function value$1(o){var or=function or(_opt){return _value$(o);};var orThunk=function orThunk(_f){return _value$(o);};var map=function map(f){return _value$(f(o));};var mapError=function mapError(_f){return _value$(o);};var each=function each(f){f(o);};var bind=function bind(f){return f(o);};var fold=function fold(_,onValue){return onValue(o);};var exists=function exists(f){return f(o);};var forall=function forall(f){return f(o);};var toOptional=function toOptional(){return Optional.some(o);};return{isValue:always,isError:never,getOr:constant(o),getOrThunk:constant(o),getOrDie:constant(o),or:or,orThunk:orThunk,fold:fold,map:map,mapError:mapError,each:each,bind:bind,exists:exists,forall:forall,toOptional:toOptional};};var _error=function error(message){var getOrThunk=function getOrThunk(f){return f();};var getOrDie=function getOrDie(){return die(String(message))();};var or=identity;var orThunk=function orThunk(f){return f();};var map=function map(_f){return _error(message);};var mapError=function mapError(f){return _error(f(message));};var bind=function bind(_f){return _error(message);};var fold=function fold(onError,_){return onError(message);};return{isValue:never,isError:always,getOr:identity,getOrThunk:getOrThunk,getOrDie:getOrDie,or:or,orThunk:orThunk,fold:fold,map:map,mapError:mapError,each:noop,bind:bind,exists:never,forall:always,toOptional:Optional.none};};var fromOption=function fromOption(opt,err){return opt.fold(function(){return _error(err);},_value$);};var Result={value:_value$,error:_error,fromOption:fromOption};var generate$1=function generate$1(cases){if(!isArray$1(cases)){throw new Error('cases must be an array');}if(cases.length===0){throw new Error('there must be at least one case');}var constructors=[];var adt={};each$k(cases,function(acase,count){var keys$1=keys(acase);if(keys$1.length!==1){throw new Error('one and only one name per case');}var key=keys$1[0];var value=acase[key];if(adt[key]!==undefined){throw new Error('duplicate key detected:'+key);}else if(key==='cata'){throw new Error('cannot have a case named cata (sorry)');}else if(!isArray$1(value)){throw new Error('case arguments must be an array');}constructors.push(key);adt[key]=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}var argLength=args.length;if(argLength!==value.length){throw new Error('Wrong number of arguments to case '+key+'. Expected '+value.length+' ('+value+'), got '+argLength);}var match=function match(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length){throw new Error('Wrong number of arguments to match. Expected: '+constructors.join(',')+'\\nActual: '+branchKeys.join(','));}var allReqd=forall(constructors,function(reqKey){return contains$3(branchKeys,reqKey);});if(!allReqd){throw new Error('Not all branches were specified when using match. Specified: '+branchKeys.join(', ')+'\\nRequired: '+constructors.join(', '));}return branches[key].apply(null,args);};return{fold:function fold(){var foldArgs=[];for(var _i=0;_i<arguments.length;_i++){foldArgs[_i]=arguments[_i];}if(foldArgs.length!==cases.length){throw new Error('Wrong number of arguments to fold. Expected '+cases.length+', got '+foldArgs.length);}var target=foldArgs[count];return target.apply(null,args);},match:match,log:function log(label){console.log(label,{constructors:constructors,constructor:key,params:args});}};};});return adt;};var Adt={generate:generate$1};Adt.generate([{bothErrors:['error1','error2']},{firstError:['error1','value2']},{secondError:['value1','error2']},{bothValues:['value1','value2']}]);var unite=function unite(result){return result.fold(identity,identity);};function ClosestOrAncestor(is,ancestor,scope,a,isRoot){if(is(scope,a)){return Optional.some(scope);}else if(isFunction(isRoot)&&isRoot(scope)){return Optional.none();}else{return ancestor(scope,a,isRoot);}}var ancestor$3=function ancestor$3(scope,predicate,isRoot){var element=scope.dom;var stop=isFunction(isRoot)?isRoot:never;while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el)){return Optional.some(el);}else if(stop(el)){break;}}return Optional.none();};var closest$3=function closest$3(scope,predicate,isRoot){var is=function is(s,test){return test(s);};return ClosestOrAncestor(is,ancestor$3,scope,predicate,isRoot);};var sibling$2=function sibling$2(scope,predicate){var element=scope.dom;if(!element.parentNode){return Optional.none();}return child(SugarElement.fromDom(element.parentNode),function(x){return!eq(scope,x)&&predicate(x);});};var child=function child(scope,predicate){var pred=function pred(node){return predicate(SugarElement.fromDom(node));};var result=find$3(scope.dom.childNodes,pred);return result.map(SugarElement.fromDom);};var ancestor$2=function ancestor$2(scope,selector,isRoot){return ancestor$3(scope,function(e){return is$2(e,selector);},isRoot);};var descendant=function descendant(scope,selector){return one(selector,scope);};var closest$2=function closest$2(scope,selector,isRoot){var is=function is(element,selector){return is$2(element,selector);};return ClosestOrAncestor(is,ancestor$2,scope,selector,isRoot);};var promiseObj=window.Promise?window.Promise:Promise$1;var requestAnimationFramePromise;var _requestAnimationFrame=function requestAnimationFrame(callback,element){var requestAnimationFrameFunc=window.requestAnimationFrame;var vendors=['ms','moz','webkit'];var featurefill=function featurefill(cb){window.setTimeout(cb,0);};for(var i=0;i<vendors.length&&!requestAnimationFrameFunc;i++){requestAnimationFrameFunc=window[vendors[i]+'RequestAnimationFrame'];}if(!requestAnimationFrameFunc){requestAnimationFrameFunc=featurefill;}requestAnimationFrameFunc(callback,element);};var wrappedSetTimeout=function wrappedSetTimeout(callback,time){if(typeof time!=='number'){time=0;}return setTimeout(callback,time);};var wrappedSetInterval=function wrappedSetInterval(callback,time){if(typeof time!=='number'){time=1;}return setInterval(callback,time);};var wrappedClearTimeout=function wrappedClearTimeout(id){return clearTimeout(id);};var wrappedClearInterval=function wrappedClearInterval(id){return clearInterval(id);};var debounce=function debounce(callback,time){var timer;var func=function func(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}clearTimeout(timer);timer=wrappedSetTimeout(function(){callback.apply(this,args);},time);};func.stop=function(){clearTimeout(timer);};return func;};var Delay={requestAnimationFrame:function requestAnimationFrame(callback,element){if(requestAnimationFramePromise){requestAnimationFramePromise.then(callback);return;}requestAnimationFramePromise=new promiseObj(function(resolve){if(!element){element=document.body;}_requestAnimationFrame(resolve,element);}).then(callback);},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function setEditorTimeout(editor,callback,time){return wrappedSetTimeout(function(){if(!editor.removed){callback();}},time);},setEditorInterval:function setEditorInterval(editor,callback,time){var timer=wrappedSetInterval(function(){if(!editor.removed){callback();}else{clearInterval(timer);}},time);return timer;},debounce:debounce,throttle:debounce,clearInterval:wrappedClearInterval,clearTimeout:wrappedClearTimeout};var StyleSheetLoader=function StyleSheetLoader(documentOrShadowRoot,settings){if(settings===void 0){settings={};}var idCount=0;var loadedStates={};var edos=SugarElement.fromDom(documentOrShadowRoot);var doc=documentOrOwner(edos);var maxLoadTime=settings.maxLoadTime||5000;var _setReferrerPolicy=function _setReferrerPolicy(referrerPolicy){settings.referrerPolicy=referrerPolicy;};var addStyle=function addStyle(element){append$1(getStyleContainer(edos),element);};var removeStyle=function removeStyle(id){var styleContainer=getStyleContainer(edos);descendant(styleContainer,'#'+id).each(remove$7);};var getOrCreateState=function getOrCreateState(url){return get$9(loadedStates,url).getOrThunk(function(){return{id:'mce-u'+idCount++,passed:[],failed:[],count:0};});};var load=function load(url,success,failure){var link;var urlWithSuffix=Tools._addCacheSuffix(url);var state=getOrCreateState(urlWithSuffix);loadedStates[urlWithSuffix]=state;state.count++;var resolve=function resolve(callbacks,status){var i=callbacks.length;while(i--){callbacks[i]();}state.status=status;state.passed=[];state.failed=[];if(link){link.onload=null;link.onerror=null;link=null;}};var passed=function passed(){return resolve(state.passed,2);};var failed=function failed(){return resolve(state.failed,3);};var wait=function wait(testCallback,waitCallback){if(!testCallback()){if(Date.now()-startTime<maxLoadTime){Delay.setTimeout(waitCallback);}else{failed();}}};var _waitForWebKitLinkLoaded=function waitForWebKitLinkLoaded(){wait(function(){var styleSheets=documentOrShadowRoot.styleSheets;var i=styleSheets.length;while(i--){var styleSheet=styleSheets[i];var owner=styleSheet.ownerNode;if(owner&&owner.id===link.id){passed();return true;}}return false;},_waitForWebKitLinkLoaded);};if(success){state.passed.push(success);}if(failure){state.failed.push(failure);}if(state.status===1){return;}if(state.status===2){passed();return;}if(state.status===3){failed();return;}state.status=1;var linkElem=SugarElement.fromTag('link',doc.dom);setAll$1(linkElem,{rel:'stylesheet',type:'text/css',id:state.id});var startTime=Date.now();if(settings.contentCssCors){set$1(linkElem,'crossOrigin','anonymous');}if(settings.referrerPolicy){set$1(linkElem,'referrerpolicy',settings.referrerPolicy);}link=linkElem.dom;link.onload=_waitForWebKitLinkLoaded;link.onerror=failed;addStyle(linkElem);set$1(linkElem,'href',urlWithSuffix);};var loadF=function loadF(url){return Future.nu(function(resolve){load(url,compose(resolve,constant(Result.value(url))),compose(resolve,constant(Result.error(url))));});};var loadAll=function loadAll(urls,success,failure){par(map$3(urls,loadF)).get(function(result){var parts=partition(result,function(r){return r.isValue();});if(parts.fail.length>0){failure(parts.fail.map(unite));}else{success(parts.pass.map(unite));}});};var unload=function unload(url){var urlWithSuffix=Tools._addCacheSuffix(url);get$9(loadedStates,urlWithSuffix).each(function(state){var count=--state.count;if(count===0){delete loadedStates[urlWithSuffix];removeStyle(state.id);}});};var unloadAll=function unloadAll(urls){each$k(urls,function(url){unload(url);});};return{load:load,loadAll:loadAll,unload:unload,unloadAll:unloadAll,_setReferrerPolicy:_setReferrerPolicy};};var create$8=function create$8(){var map=new WeakMap();var forElement=function forElement(referenceElement,settings){var root=getRootNode(referenceElement);var rootDom=root.dom;return Optional.from(map.get(rootDom)).getOrThunk(function(){var sl=StyleSheetLoader(rootDom,settings);map.set(rootDom,sl);return sl;});};return{forElement:forElement};};var instance=create$8();var DomTreeWalker=function(){function DomTreeWalker(startNode,rootNode){this.node=startNode;this.rootNode=rootNode;this.current=this.current.bind(this);this.next=this.next.bind(this);this.prev=this.prev.bind(this);this.prev2=this.prev2.bind(this);}DomTreeWalker.prototype.current=function(){return this.node;};DomTreeWalker.prototype.next=function(shallow){this.node=this.findSibling(this.node,'firstChild','nextSibling',shallow);return this.node;};DomTreeWalker.prototype.prev=function(shallow){this.node=this.findSibling(this.node,'lastChild','previousSibling',shallow);return this.node;};DomTreeWalker.prototype.prev2=function(shallow){this.node=this.findPreviousNode(this.node,'lastChild','previousSibling',shallow);return this.node;};DomTreeWalker.prototype.findSibling=function(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName]){return node[startName];}if(node!==this.rootNode){sibling=node[siblingName];if(sibling){return sibling;}for(parent=node.parentNode;parent&&parent!==this.rootNode;parent=parent.parentNode){sibling=parent[siblingName];if(sibling){return sibling;}}}}};DomTreeWalker.prototype.findPreviousNode=function(node,startName,siblingName,shallow){var sibling,parent,child;if(node){sibling=node[siblingName];if(this.rootNode&&sibling===this.rootNode){return;}if(sibling){if(!shallow){for(child=sibling[startName];child;child=child[startName]){if(!child[startName]){return child;}}}return sibling;}parent=node.parentNode;if(parent&&parent!==this.rootNode){return parent;}}};return DomTreeWalker;}();var blocks=['article','aside','details','div','dt','figcaption','footer','form','fieldset','header','hgroup','html','main','nav','section','summary','body','p','dl','multicol','dd','figure','address','center','blockquote','h1','h2','h3','h4','h5','h6','listing','xmp','pre','plaintext','menu','dir','ul','ol','li','hr','table','tbody','thead','tfoot','th','tr','td','caption'];var tableCells=['td','th'];var tableSections=['thead','tbody','tfoot'];var textBlocks=['h1','h2','h3','h4','h5','h6','p','div','address','pre','form','blockquote','center','dir','fieldset','header','footer','article','section','hgroup','aside','nav','figure'];var headings=['h1','h2','h3','h4','h5','h6'];var listItems$1=['li','dd','dt'];var lists=['ul','ol','dl'];var wsElements=['pre','script','textarea','style'];var lazyLookup=function lazyLookup(items){var lookup;return function(node){lookup=lookup?lookup:mapToObject(items,always);return has$2(lookup,name(node));};};var isHeading=lazyLookup(headings);var isBlock$2=lazyLookup(blocks);var isTable$2=function isTable$2(node){return name(node)==='table';};var isInline$1=function isInline$1(node){return isElement$6(node)&&!isBlock$2(node);};var isBr$4=function isBr$4(node){return isElement$6(node)&&name(node)==='br';};var isTextBlock$2=lazyLookup(textBlocks);var isList=lazyLookup(lists);var isListItem=lazyLookup(listItems$1);var isTableSection=lazyLookup(tableSections);var isTableCell$4=lazyLookup(tableCells);var isWsPreserveElement=lazyLookup(wsElements);var ancestor$1=function ancestor$1(scope,selector,isRoot){return ancestor$2(scope,selector,isRoot).isSome();};var zeroWidth='\\uFEFF';var nbsp='\\xA0';var isZwsp$1=function isZwsp$1(char){return char===zeroWidth;};var removeZwsp=function removeZwsp(s){return s.replace(/\\uFEFF/g,'');};var ZWSP$1=zeroWidth;var isZwsp=isZwsp$1;var trim$3=removeZwsp;var isElement$4=isElement$5;var isText$6=isText$7;var isCaretContainerBlock$1=function isCaretContainerBlock$1(node){if(isText$6(node)){node=node.parentNode;}return isElement$4(node)&&node.hasAttribute('data-mce-caret');};var isCaretContainerInline=function isCaretContainerInline(node){return isText$6(node)&&isZwsp(node.data);};var isCaretContainer$2=function isCaretContainer$2(node){return isCaretContainerBlock$1(node)||isCaretContainerInline(node);};var hasContent=function hasContent(node){return node.firstChild!==node.lastChild||!isBr$5(node.firstChild);};var insertInline$1=function insertInline$1(node,before){var doc=node.ownerDocument;var textNode=doc.createTextNode(ZWSP$1);var parentNode=node.parentNode;if(!before){var sibling=node.nextSibling;if(isText$6(sibling)){if(isCaretContainer$2(sibling)){return sibling;}if(startsWithCaretContainer$1(sibling)){sibling.splitText(1);return sibling;}}if(node.nextSibling){parentNode.insertBefore(textNode,node.nextSibling);}else{parentNode.appendChild(textNode);}}else{var sibling=node.previousSibling;if(isText$6(sibling)){if(isCaretContainer$2(sibling)){return sibling;}if(endsWithCaretContainer$1(sibling)){return sibling.splitText(sibling.data.length-1);}}parentNode.insertBefore(textNode,node);}return textNode;};var isBeforeInline=function isBeforeInline(pos){var container=pos.container();if(!isText$7(container)){return false;}return container.data.charAt(pos.offset())===ZWSP$1||pos.isAtStart()&&isCaretContainerInline(container.previousSibling);};var isAfterInline=function isAfterInline(pos){var container=pos.container();if(!isText$7(container)){return false;}return container.data.charAt(pos.offset()-1)===ZWSP$1||pos.isAtEnd()&&isCaretContainerInline(container.nextSibling);};var createBogusBr=function createBogusBr(){var br=document.createElement('br');br.setAttribute('data-mce-bogus','1');return br;};var insertBlock$1=function insertBlock$1(blockName,node,before){var doc=node.ownerDocument;var blockNode=doc.createElement(blockName);blockNode.setAttribute('data-mce-caret',before?'before':'after');blockNode.setAttribute('data-mce-bogus','all');blockNode.appendChild(createBogusBr());var parentNode=node.parentNode;if(!before){if(node.nextSibling){parentNode.insertBefore(blockNode,node.nextSibling);}else{parentNode.appendChild(blockNode);}}else{parentNode.insertBefore(blockNode,node);}return blockNode;};var startsWithCaretContainer$1=function startsWithCaretContainer$1(node){return isText$6(node)&&node.data[0]===ZWSP$1;};var endsWithCaretContainer$1=function endsWithCaretContainer$1(node){return isText$6(node)&&node.data[node.data.length-1]===ZWSP$1;};var trimBogusBr=function trimBogusBr(elm){var brs=elm.getElementsByTagName('br');var lastBr=brs[brs.length-1];if(isBogus$2(lastBr)){lastBr.parentNode.removeChild(lastBr);}};var showCaretContainerBlock=function showCaretContainerBlock(caretContainer){if(caretContainer&&caretContainer.hasAttribute('data-mce-caret')){trimBogusBr(caretContainer);caretContainer.removeAttribute('data-mce-caret');caretContainer.removeAttribute('data-mce-bogus');caretContainer.removeAttribute('style');caretContainer.removeAttribute('_moz_abspos');return caretContainer;}return null;};var isRangeInCaretContainerBlock=function isRangeInCaretContainerBlock(range){return isCaretContainerBlock$1(range.startContainer);};var isContentEditableTrue$3=isContentEditableTrue$4;var isContentEditableFalse$a=isContentEditableFalse$b;var isBr$3=isBr$5;var isText$5=isText$7;var isInvalidTextElement=matchNodeNames(['script','style','textarea']);var isAtomicInline=matchNodeNames(['img','input','textarea','hr','iframe','video','audio','object','embed']);var isTable$1=matchNodeNames(['table']);var isCaretContainer$1=isCaretContainer$2;var isCaretCandidate$3=function isCaretCandidate$3(node){if(isCaretContainer$1(node)){return false;}if(isText$5(node)){return!isInvalidTextElement(node.parentNode);}return isAtomicInline(node)||isBr$3(node)||isTable$1(node)||isNonUiContentEditableFalse(node);};var isUnselectable=function isUnselectable(node){return isElement$5(node)&&node.getAttribute('unselectable')==='true';};var isNonUiContentEditableFalse=function isNonUiContentEditableFalse(node){return isUnselectable(node)===false&&isContentEditableFalse$a(node);};var isInEditable=function isInEditable(node,root){for(node=node.parentNode;node&&node!==root;node=node.parentNode){if(isNonUiContentEditableFalse(node)){return false;}if(isContentEditableTrue$3(node)){return true;}}return true;};var isAtomicContentEditableFalse=function isAtomicContentEditableFalse(node){if(!isNonUiContentEditableFalse(node)){return false;}return foldl(from(node.getElementsByTagName('*')),function(result,elm){return result||isContentEditableTrue$3(elm);},false)!==true;};var isAtomic$1=function isAtomic$1(node){return isAtomicInline(node)||isAtomicContentEditableFalse(node);};var isEditableCaretCandidate$1=function isEditableCaretCandidate$1(node,root){return isCaretCandidate$3(node)&&isInEditable(node,root);};var whiteSpaceRegExp$1=/^[ \\t\\r\\n]*$/;var isWhitespaceText=function isWhitespaceText(text){return whiteSpaceRegExp$1.test(text);};var hasWhitespacePreserveParent=function hasWhitespacePreserveParent(node,rootNode){var rootElement=SugarElement.fromDom(rootNode);var startNode=SugarElement.fromDom(node);return ancestor$1(startNode,'pre,code',curry(eq,rootElement));};var isWhitespace=function isWhitespace(node,rootNode){return isText$7(node)&&isWhitespaceText(node.data)&&hasWhitespacePreserveParent(node,rootNode)===false;};var isNamedAnchor=function isNamedAnchor(node){return isElement$5(node)&&node.nodeName==='A'&&!node.hasAttribute('href')&&(node.hasAttribute('name')||node.hasAttribute('id'));};var isContent$1=function isContent$1(node,rootNode){return isCaretCandidate$3(node)&&isWhitespace(node,rootNode)===false||isNamedAnchor(node)||isBookmark(node);};var isBookmark=hasAttribute('data-mce-bookmark');var isBogus$1=hasAttribute('data-mce-bogus');var isBogusAll=hasAttributeValue('data-mce-bogus','all');var isEmptyNode=function isEmptyNode(targetNode,skipBogus){var brCount=0;if(isContent$1(targetNode,targetNode)){return false;}else{var node=targetNode.firstChild;if(!node){return true;}var walker=new DomTreeWalker(node,targetNode);do{if(skipBogus){if(isBogusAll(node)){node=walker.next(true);continue;}if(isBogus$1(node)){node=walker.next();continue;}}if(isBr$5(node)){brCount++;node=walker.next();continue;}if(isContent$1(node,targetNode)){return false;}node=walker.next();}while(node);return brCount<=1;}};var isEmpty$2=function isEmpty$2(elm,skipBogus){if(skipBogus===void 0){skipBogus=true;}return isEmptyNode(elm.dom,skipBogus);};var isSpan=function isSpan(node){return node.nodeName.toLowerCase()==='span';};var isInlineContent=function isInlineContent(node,root){return isNonNullable(node)&&(isContent$1(node,root)||isInline$1(SugarElement.fromDom(node)));};var surroundedByInlineContent=function surroundedByInlineContent(node,root){var prev=new DomTreeWalker(node,root).prev(false);var next=new DomTreeWalker(node,root).next(false);var prevIsInline=isUndefined(prev)||isInlineContent(prev,root);var nextIsInline=isUndefined(next)||isInlineContent(next,root);return prevIsInline&&nextIsInline;};var isBookmarkNode$2=function isBookmarkNode$2(node){return isSpan(node)&&node.getAttribute('data-mce-type')==='bookmark';};var isKeepTextNode=function isKeepTextNode(node,root){return isText$7(node)&&node.data.length>0&&surroundedByInlineContent(node,root);};var isKeepElement=function isKeepElement(node){return isElement$5(node)?node.childNodes.length>0:false;};var isDocument=function isDocument(node){return isDocumentFragment(node)||isDocument$1(node);};var _trimNode=function trimNode(dom,node,root){var rootNode=root||node;if(isElement$5(node)&&isBookmarkNode$2(node)){return node;}var children=node.childNodes;for(var i=children.length-1;i>=0;i--){_trimNode(dom,children[i],rootNode);}if(isElement$5(node)){var currentChildren=node.childNodes;if(currentChildren.length===1&&isBookmarkNode$2(currentChildren[0])){node.parentNode.insertBefore(currentChildren[0],node);}}if(!isDocument(node)&&!isContent$1(node,rootNode)&&!isKeepElement(node)&&!isKeepTextNode(node,rootNode)){dom.remove(node);}return node;};var makeMap$3=Tools.makeMap;var attrsCharsRegExp=/[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;var textCharsRegExp=/[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;var rawCharsRegExp=/[<>&\\\"\\']/g;var entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi;var asciiMap={128:'\\u20AC',130:'\\u201A',131:'\\u0192',132:'\\u201E',133:'\\u2026',134:'\\u2020',135:'\\u2021',136:'\\u02c6',137:'\\u2030',138:'\\u0160',139:'\\u2039',140:'\\u0152',142:'\\u017d',145:'\\u2018',146:'\\u2019',147:'\\u201C',148:'\\u201D',149:'\\u2022',150:'\\u2013',151:'\\u2014',152:'\\u02DC',153:'\\u2122',154:'\\u0161',155:'\\u203A',156:'\\u0153',158:'\\u017e',159:'\\u0178'};var baseEntities={'\"':'&quot;','\\'':'&#39;','<':'&lt;','>':'&gt;','&':'&amp;','`':'&#96;'};var reverseEntities={'&lt;':'<','&gt;':'>','&amp;':'&','&quot;':'\"','&apos;':'\\''};var nativeDecode=function nativeDecode(text){var elm=SugarElement.fromTag('div').dom;elm.innerHTML=text;return elm.textContent||elm.innerText||text;};var buildEntitiesLookup=function buildEntitiesLookup(items,radix){var i,chr,entity;var lookup={};if(items){items=items.split(',');radix=radix||10;for(i=0;i<items.length;i+=2){chr=String.fromCharCode(parseInt(items[i],radix));if(!baseEntities[chr]){entity='&'+items[i+1]+';';lookup[chr]=entity;lookup[entity]=chr;}}return lookup;}};var namedEntities=buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,'+'5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,'+'5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,'+'5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,'+'68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,'+'6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,'+'6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,'+'75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,'+'7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,'+'7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,'+'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,'+'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,'+'t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,'+'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,'+'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,'+'81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,'+'8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,'+'8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,'+'8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,'+'8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,'+'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,'+'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,'+'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,'+'80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,'+'811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro',32);var encodeRaw=function encodeRaw(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||chr;});};var encodeAllRaw=function encodeAllRaw(text){return(''+text).replace(rawCharsRegExp,function(chr){return baseEntities[chr]||chr;});};var encodeNumeric=function encodeNumeric(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){if(chr.length>1){return'&#'+((chr.charCodeAt(0)-55296)*1024+(chr.charCodeAt(1)-56320)+65536)+';';}return baseEntities[chr]||'&#'+chr.charCodeAt(0)+';';});};var encodeNamed=function encodeNamed(text,attr,entities){entities=entities||namedEntities;return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||chr;});};var getEncodeFunc=function getEncodeFunc(name,entities){var entitiesMap=buildEntitiesLookup(entities)||namedEntities;var encodeNamedAndNumeric=function encodeNamedAndNumeric(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){if(baseEntities[chr]!==undefined){return baseEntities[chr];}if(entitiesMap[chr]!==undefined){return entitiesMap[chr];}if(chr.length>1){return'&#'+((chr.charCodeAt(0)-55296)*1024+(chr.charCodeAt(1)-56320)+65536)+';';}return'&#'+chr.charCodeAt(0)+';';});};var encodeCustomNamed=function encodeCustomNamed(text,attr){return encodeNamed(text,attr,entitiesMap);};var nameMap=makeMap$3(name.replace(/\\+/g,','));if(nameMap.named&&nameMap.numeric){return encodeNamedAndNumeric;}if(nameMap.named){if(entities){return encodeCustomNamed;}return encodeNamed;}if(nameMap.numeric){return encodeNumeric;}return encodeRaw;};var decode=function decode(text){return text.replace(entityRegExp,function(all,numeric){if(numeric){if(numeric.charAt(0).toLowerCase()==='x'){numeric=parseInt(numeric.substr(1),16);}else{numeric=parseInt(numeric,10);}if(numeric>65535){numeric-=65536;return String.fromCharCode(55296+(numeric>>10),56320+(numeric&1023));}return asciiMap[numeric]||String.fromCharCode(numeric);}return reverseEntities[all]||namedEntities[all]||nativeDecode(all);});};var Entities={encodeRaw:encodeRaw,encodeAllRaw:encodeAllRaw,encodeNumeric:encodeNumeric,encodeNamed:encodeNamed,getEncodeFunc:getEncodeFunc,decode:decode};var mapCache={},dummyObj={};var makeMap$2=Tools.makeMap,each$h=Tools.each,extend$5=Tools.extend,explode$3=Tools.explode,inArray$2=Tools.inArray;var split$1=function split$1(items,delim){items=Tools.trim(items);return items?items.split(delim||' '):[];};var createMap=function createMap(defaultValue,extendWith){var value=makeMap$2(defaultValue,' ',makeMap$2(defaultValue.toUpperCase(),' '));return extend$5(value,extendWith);};var getTextRootBlockElements=function getTextRootBlockElements(schema){return createMap('td th li dt dd figcaption caption details summary',schema.getTextBlockElements());};var compileSchema=function compileSchema(type){var schema={};var globalAttributes,blockContent;var phrasingContent,flowContent,html4BlockContent,html4PhrasingContent;var add=function add(name,attributes,children){var ni,attributesOrder,element;var arrayToMap=function arrayToMap(array,obj){var map={};var i,l;for(i=0,l=array.length;i<l;i++){map[array[i]]=obj||{};}return map;};children=children||[];attributes=attributes||'';if(typeof children==='string'){children=split$1(children);}var names=split$1(name);ni=names.length;while(ni--){attributesOrder=split$1([globalAttributes,attributes].join(' '));element={attributes:arrayToMap(attributesOrder),attributesOrder:attributesOrder,children:arrayToMap(children,dummyObj)};schema[names[ni]]=element;}};var addAttrs=function addAttrs(name,attributes){var ni,schemaItem,i,l;var names=split$1(name);ni=names.length;var attrs=split$1(attributes);while(ni--){schemaItem=schema[names[ni]];for(i=0,l=attrs.length;i<l;i++){schemaItem.attributes[attrs[i]]={};schemaItem.attributesOrder.push(attrs[i]);}}};if(mapCache[type]){return mapCache[type];}globalAttributes='id accesskey class dir lang style tabindex title role';blockContent='address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';phrasingContent='a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd '+'label map noscript object q s samp script select small span strong sub sup '+'textarea u var #text #comment';if(type!=='html4'){globalAttributes+=' contenteditable contextmenu draggable dropzone '+'hidden spellcheck translate';blockContent+=' article aside details dialog figure main header footer hgroup section nav';phrasingContent+=' audio canvas command datalist mark meter output picture '+'progress time wbr video ruby bdi keygen';}if(type!=='html5-strict'){globalAttributes+=' xml:lang';html4PhrasingContent='acronym applet basefont big font strike tt';phrasingContent=[phrasingContent,html4PhrasingContent].join(' ');each$h(split$1(html4PhrasingContent),function(name){add(name,'',phrasingContent);});html4BlockContent='center dir isindex noframes';blockContent=[blockContent,html4BlockContent].join(' ');flowContent=[blockContent,phrasingContent].join(' ');each$h(split$1(html4BlockContent),function(name){add(name,'',flowContent);});}flowContent=flowContent||[blockContent,phrasingContent].join(' ');add('html','manifest','head body');add('head','','base command link meta noscript script style title');add('title hr noscript br');add('base','href target');add('link','href rel media hreflang type sizes hreflang');add('meta','name http-equiv content charset');add('style','media type scoped');add('script','src async defer type charset');add('body','onafterprint onbeforeprint onbeforeunload onblur onerror onfocus '+'onhashchange onload onmessage onoffline ononline onpagehide onpageshow '+'onpopstate onresize onscroll onstorage onunload',flowContent);add('address dt dd div caption','',flowContent);add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn','',phrasingContent);add('blockquote','cite',flowContent);add('ol','reversed start type','li');add('ul','','li');add('li','value',flowContent);add('dl','','dt dd');add('a','href target rel media hreflang type',phrasingContent);add('q','cite',phrasingContent);add('ins del','cite datetime',flowContent);add('img','src sizes srcset alt usemap ismap width height');add('iframe','src name width height',flowContent);add('embed','src type width height');add('object','data type typemustmatch name usemap form width height',[flowContent,'param'].join(' '));add('param','name value');add('map','name',[flowContent,'area'].join(' '));add('area','alt coords shape href target rel media hreflang type');add('table','border','caption colgroup thead tfoot tbody tr'+(type==='html4'?' col':''));add('colgroup','span','col');add('col','span');add('tbody thead tfoot','','tr');add('tr','','td th');add('td','colspan rowspan headers',flowContent);add('th','colspan rowspan headers scope abbr',flowContent);add('form','accept-charset action autocomplete enctype method name novalidate target',flowContent);add('fieldset','disabled form name',[flowContent,'legend'].join(' '));add('label','form for',phrasingContent);add('input','accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate '+'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');add('button','disabled form formaction formenctype formmethod formnovalidate formtarget name type value',type==='html4'?flowContent:phrasingContent);add('select','disabled form multiple name required size','option optgroup');add('optgroup','disabled label','option');add('option','disabled label selected value');add('textarea','cols dirname disabled form maxlength name readonly required rows wrap');add('menu','type label',[flowContent,'li'].join(' '));add('noscript','',flowContent);if(type!=='html4'){add('wbr');add('ruby','',[phrasingContent,'rt rp'].join(' '));add('figcaption','',flowContent);add('mark rt rp summary bdi','',phrasingContent);add('canvas','width height',flowContent);add('video','src crossorigin poster preload autoplay mediagroup loop '+'muted controls width height buffered',[flowContent,'track source'].join(' '));add('audio','src crossorigin preload autoplay mediagroup loop muted controls '+'buffered volume',[flowContent,'track source'].join(' '));add('picture','','img source');add('source','src srcset type media sizes');add('track','kind src srclang label default');add('datalist','',[phrasingContent,'option'].join(' '));add('article section nav aside main header footer','',flowContent);add('hgroup','','h1 h2 h3 h4 h5 h6');add('figure','',[flowContent,'figcaption'].join(' '));add('time','datetime',phrasingContent);add('dialog','open',flowContent);add('command','type label icon disabled checked radiogroup command');add('output','for form name',phrasingContent);add('progress','value max',phrasingContent);add('meter','value min max low high optimum',phrasingContent);add('details','open',[flowContent,'summary'].join(' '));add('keygen','autofocus challenge disabled form keytype name');}if(type!=='html5-strict'){addAttrs('script','language xml:space');addAttrs('style','xml:space');addAttrs('object','declare classid code codebase codetype archive standby align border hspace vspace');addAttrs('embed','align name hspace vspace');addAttrs('param','valuetype type');addAttrs('a','charset name rev shape coords');addAttrs('br','clear');addAttrs('applet','codebase archive code object alt name width height align hspace vspace');addAttrs('img','name longdesc align border hspace vspace');addAttrs('iframe','longdesc frameborder marginwidth marginheight scrolling align');addAttrs('font basefont','size color face');addAttrs('input','usemap align');addAttrs('select');addAttrs('textarea');addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption','align');addAttrs('ul','type compact');addAttrs('li','type');addAttrs('ol dl menu dir','compact');addAttrs('pre','width xml:space');addAttrs('hr','align noshade size width');addAttrs('isindex','prompt');addAttrs('table','summary width frame rules cellspacing cellpadding align bgcolor');addAttrs('col','width align char charoff valign');addAttrs('colgroup','width align char charoff valign');addAttrs('thead','align char charoff valign');addAttrs('tr','align char charoff valign bgcolor');addAttrs('th','axis align char charoff valign nowrap bgcolor width height');addAttrs('form','accept');addAttrs('td','abbr axis scope align char charoff valign nowrap bgcolor width height');addAttrs('tfoot','align char charoff valign');addAttrs('tbody','align char charoff valign');addAttrs('area','nohref');addAttrs('body','background bgcolor text link vlink alink');}if(type!=='html4'){addAttrs('input button select textarea','autofocus');addAttrs('input textarea','placeholder');addAttrs('a','download');addAttrs('link script img','crossorigin');addAttrs('img','loading');addAttrs('iframe','sandbox seamless allowfullscreen loading');}each$h(split$1('a form meter progress dfn'),function(name){if(schema[name]){delete schema[name].children[name];}});delete schema.caption.children.table;delete schema.script;mapCache[type]=schema;return schema;};var compileElementMap=function compileElementMap(value,mode){var styles;if(value){styles={};if(typeof value==='string'){value={'*':value};}each$h(value,function(value,key){styles[key]=styles[key.toUpperCase()]=mode==='map'?makeMap$2(value,/[, ]/):explode$3(value,/[, ]/);});}return styles;};var Schema=function Schema(settings){var elements={};var children={};var patternElements=[];var customElementsMap={},specialElements={};var createLookupTable=function createLookupTable(option,defaultValue,extendWith){var value=settings[option];if(!value){value=mapCache[option];if(!value){value=createMap(defaultValue,extendWith);mapCache[option]=value;}}else{value=makeMap$2(value,/[, ]/,makeMap$2(value.toUpperCase(),/[, ]/));}return value;};settings=settings||{};var schemaItems=compileSchema(settings.schema);if(settings.verify_html===false){settings.valid_elements='*[*]';}var validStyles=compileElementMap(settings.valid_styles);var invalidStyles=compileElementMap(settings.invalid_styles,'map');var validClasses=compileElementMap(settings.valid_classes,'map');var whiteSpaceElementsMap=createLookupTable('whitespace_elements','pre script noscript style textarea video audio iframe object code');var selfClosingElementsMap=createLookupTable('self_closing_elements','colgroup dd dt li option p td tfoot th thead tr');var shortEndedElementsMap=createLookupTable('short_ended_elements','area base basefont br col frame hr img input isindex link '+'meta param embed source wbr track');var boolAttrMap=createLookupTable('boolean_attributes','checked compact declare defer disabled ismap multiple nohref noresize '+'noshade nowrap readonly selected autoplay loop controls');var nonEmptyOrMoveCaretBeforeOnEnter='td th iframe video audio object script code';var nonEmptyElementsMap=createLookupTable('non_empty_elements',nonEmptyOrMoveCaretBeforeOnEnter+' pre',shortEndedElementsMap);var moveCaretBeforeOnEnterElementsMap=createLookupTable('move_caret_before_on_enter_elements',nonEmptyOrMoveCaretBeforeOnEnter+' table',shortEndedElementsMap);var textBlockElementsMap=createLookupTable('text_block_elements','h1 h2 h3 h4 h5 h6 p div address pre form '+'blockquote center dir fieldset header footer article section hgroup aside main nav figure');var blockElementsMap=createLookupTable('block_elements','hr table tbody thead tfoot '+'th tr td li ol ul caption dl dt dd noscript menu isindex option '+'datalist select optgroup figcaption details summary',textBlockElementsMap);var textInlineElementsMap=createLookupTable('text_inline_elements','span strong b em i font s strike u var cite '+'dfn code mark q sup sub samp');each$h((settings.special||'script noscript iframe noframes noembed title style textarea xmp').split(' '),function(name){specialElements[name]=new RegExp('</'+name+'[^>]*>','gi');});var patternToRegExp=function patternToRegExp(str){return new RegExp('^'+str.replace(/([?+*])/g,'.$1')+'$');};var addValidElements=function addValidElements(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,value;var elementRuleRegExp=/^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)])?$/,attrRuleRegExp=/^([!\\-])?(\\w+[\\\\:]:\\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements){var validElementsArr=split$1(validElements,',');if(elements['@']){globalAttributes=elements['@'].attributes;globalAttributesOrder=elements['@'].attributesOrder;}for(ei=0,el=validElementsArr.length;ei<el;ei++){matches=elementRuleRegExp.exec(validElementsArr[ei]);if(matches){prefix=matches[1];elementName=matches[2];outputName=matches[3];attrData=matches[5];attributes={};attributesOrder=[];element={attributes:attributes,attributesOrder:attributesOrder};if(prefix==='#'){element.paddEmpty=true;}if(prefix==='-'){element.removeEmpty=true;}if(matches[4]==='!'){element.removeEmptyAttrs=true;}if(globalAttributes){each$j(globalAttributes,function(value,key){attributes[key]=value;});attributesOrder.push.apply(attributesOrder,globalAttributesOrder);}if(attrData){attrData=split$1(attrData,'|');for(ai=0,al=attrData.length;ai<al;ai++){matches=attrRuleRegExp.exec(attrData[ai]);if(matches){attr={};attrType=matches[1];attrName=matches[2].replace(/[\\\\:]:/g,':');prefix=matches[3];value=matches[4];if(attrType==='!'){element.attributesRequired=element.attributesRequired||[];element.attributesRequired.push(attrName);attr.required=true;}if(attrType==='-'){delete attributes[attrName];attributesOrder.splice(inArray$2(attributesOrder,attrName),1);continue;}if(prefix){if(prefix==='='){element.attributesDefault=element.attributesDefault||[];element.attributesDefault.push({name:attrName,value:value});attr.defaultValue=value;}if(prefix===':'){element.attributesForced=element.attributesForced||[];element.attributesForced.push({name:attrName,value:value});attr.forcedValue=value;}if(prefix==='<'){attr.validValues=makeMap$2(value,'?');}}if(hasPatternsRegExp.test(attrName)){element.attributePatterns=element.attributePatterns||[];attr.pattern=patternToRegExp(attrName);element.attributePatterns.push(attr);}else{if(!attributes[attrName]){attributesOrder.push(attrName);}attributes[attrName]=attr;}}}}if(!globalAttributes&&elementName==='@'){globalAttributes=attributes;globalAttributesOrder=attributesOrder;}if(outputName){element.outputName=elementName;elements[outputName]=element;}if(hasPatternsRegExp.test(elementName)){element.pattern=patternToRegExp(elementName);patternElements.push(element);}else{elements[elementName]=element;}}}}};var setValidElements=function setValidElements(validElements){elements={};patternElements=[];addValidElements(validElements);each$h(schemaItems,function(element,name){children[name]=element.children;});};var addCustomElements=function addCustomElements(customElements){var customElementRegExp=/^(~)?(.+)$/;if(customElements){mapCache.text_block_elements=mapCache.block_elements=null;each$h(split$1(customElements,','),function(rule){var matches=customElementRegExp.exec(rule),inline=matches[1]==='~',cloneName=inline?'span':'div',name=matches[2];children[name]=children[cloneName];customElementsMap[name]=cloneName;if(!inline){blockElementsMap[name.toUpperCase()]={};blockElementsMap[name]={};}if(!elements[name]){var customRule=elements[cloneName];customRule=extend$5({},customRule);delete customRule.removeEmptyAttrs;delete customRule.removeEmpty;elements[name]=customRule;}each$h(children,function(element,elmName){if(element[cloneName]){children[elmName]=element=extend$5({},children[elmName]);element[name]=element[cloneName];}});});}};var addValidChildren=function addValidChildren(validChildren){var childRuleRegExp=/^([+\\-]?)([A-Za-z0-9_\\-.\\u00b7\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u037d\\u037f-\\u1fff\\u200c-\\u200d\\u203f-\\u2040\\u2070-\\u218f\\u2c00-\\u2fef\\u3001-\\ud7ff\\uf900-\\ufdcf\\ufdf0-\\ufffd]+)\\[([^\\]]+)]$/;mapCache[settings.schema]=null;if(validChildren){each$h(split$1(validChildren,','),function(rule){var matches=childRuleRegExp.exec(rule);var parent,prefix;if(matches){prefix=matches[1];if(prefix){parent=children[matches[2]];}else{parent=children[matches[2]]={'#comment':{}};}parent=children[matches[2]];each$h(split$1(matches[3],'|'),function(child){if(prefix==='-'){delete parent[child];}else{parent[child]={};}});}});}};var getElementRule=function getElementRule(name){var element=elements[name],i;if(element){return element;}i=patternElements.length;while(i--){element=patternElements[i];if(element.pattern.test(name)){return element;}}};if(!settings.valid_elements){each$h(schemaItems,function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder};children[name]=element.children;});if(settings.schema!=='html5'){each$h(split$1('strong/b em/i'),function(item){var items=split$1(item,'/');elements[items[1]].outputName=items[0];});}each$h(textInlineElementsMap,function(_val,name){if(elements[name]){if(settings.padd_empty_block_inline_children){elements[name].paddInEmptyBlock=true;}elements[name].removeEmpty=true;}});each$h(split$1('ol ul blockquote a table tbody'),function(name){if(elements[name]){elements[name].removeEmpty=true;}});each$h(split$1('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'),function(name){elements[name].paddEmpty=true;});each$h(split$1('span'),function(name){elements[name].removeEmptyAttrs=true;});}else{setValidElements(settings.valid_elements);}addCustomElements(settings.custom_elements);addValidChildren(settings.valid_children);addValidElements(settings.extended_valid_elements);addValidChildren('+ol[ul|ol],+ul[ul|ol]');each$h({dd:'dl',dt:'dl',li:'ul ol',td:'tr',th:'tr',tr:'tbody thead tfoot',tbody:'table',thead:'table',tfoot:'table',legend:'fieldset',area:'map',param:'video audio object'},function(parents,item){if(elements[item]){elements[item].parentsRequired=split$1(parents);}});if(settings.invalid_elements){each$h(explode$3(settings.invalid_elements),function(item){if(elements[item]){delete elements[item];}});}if(!getElementRule('span')){addValidElements('span[!data-mce-type|*]');}var getValidStyles=constant(validStyles);var getInvalidStyles=constant(invalidStyles);var getValidClasses=constant(validClasses);var getBoolAttrs=constant(boolAttrMap);var getBlockElements=constant(blockElementsMap);var getTextBlockElements=constant(textBlockElementsMap);var getTextInlineElements=constant(textInlineElementsMap);var getShortEndedElements=constant(shortEndedElementsMap);var getSelfClosingElements=constant(selfClosingElementsMap);var getNonEmptyElements=constant(nonEmptyElementsMap);var getMoveCaretBeforeOnEnterElements=constant(moveCaretBeforeOnEnterElementsMap);var getWhiteSpaceElements=constant(whiteSpaceElementsMap);var getSpecialElements=constant(specialElements);var isValidChild=function isValidChild(name,child){var parent=children[name.toLowerCase()];return!!(parent&&parent[child.toLowerCase()]);};var isValid=function isValid(name,attr){var attrPatterns,i;var rule=getElementRule(name);if(rule){if(attr){if(rule.attributes[attr]){return true;}attrPatterns=rule.attributePatterns;if(attrPatterns){i=attrPatterns.length;while(i--){if(attrPatterns[i].pattern.test(name)){return true;}}}}else{return true;}}return false;};var getCustomElements=constant(customElementsMap);return{children:children,elements:elements,getValidStyles:getValidStyles,getValidClasses:getValidClasses,getBlockElements:getBlockElements,getInvalidStyles:getInvalidStyles,getShortEndedElements:getShortEndedElements,getTextBlockElements:getTextBlockElements,getTextInlineElements:getTextInlineElements,getBoolAttrs:getBoolAttrs,getElementRule:getElementRule,getSelfClosingElements:getSelfClosingElements,getNonEmptyElements:getNonEmptyElements,getMoveCaretBeforeOnEnterElements:getMoveCaretBeforeOnEnterElements,getWhiteSpaceElements:getWhiteSpaceElements,getSpecialElements:getSpecialElements,isValidChild:isValidChild,isValid:isValid,getCustomElements:getCustomElements,addValidElements:addValidElements,setValidElements:setValidElements,addCustomElements:addCustomElements,addValidChildren:addValidChildren};};var _toHex=function toHex(match,r,g,b){var hex=function hex(val){val=parseInt(val,10).toString(16);return val.length>1?val:'0'+val;};return'#'+hex(r)+hex(g)+hex(b);};var Styles=function Styles(settings,schema){var _this=this;var rgbRegExp=/rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi;var urlOrStrRegExp=/(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi;var styleRegExp=/\\s*([^:]+):\\s*([^;]+);?/g;var trimRightRegExp=/\\s+$/;var i;var encodingLookup={};var validStyles;var invalidStyles;var invisibleChar=zeroWidth;settings=settings||{};if(schema){validStyles=schema.getValidStyles();invalidStyles=schema.getInvalidStyles();}var encodingItems=('\\\\\" \\\\\\' \\\\; \\\\: ; : '+invisibleChar).split(' ');for(i=0;i<encodingItems.length;i++){encodingLookup[encodingItems[i]]=invisibleChar+i;encodingLookup[invisibleChar+i]=encodingItems[i];}return{toHex:function toHex(color){return color.replace(rgbRegExp,_toHex);},parse:function parse(css){var styles={};var matches,name,value,isEncoded;var urlConverter=settings.url_converter;var urlConverterScope=settings.url_converter_scope||_this;var compress=function compress(prefix,suffix,noJoin){var top=styles[prefix+'-top'+suffix];if(!top){return;}var right=styles[prefix+'-right'+suffix];if(!right){return;}var bottom=styles[prefix+'-bottom'+suffix];if(!bottom){return;}var left=styles[prefix+'-left'+suffix];if(!left){return;}var box=[top,right,bottom,left];i=box.length-1;while(i--){if(box[i]!==box[i+1]){break;}}if(i>-1&&noJoin){return;}styles[prefix+suffix]=i===-1?box[0]:box.join(' ');delete styles[prefix+'-top'+suffix];delete styles[prefix+'-right'+suffix];delete styles[prefix+'-bottom'+suffix];delete styles[prefix+'-left'+suffix];};var canCompress=function canCompress(key){var value=styles[key],i;if(!value){return;}value=value.split(' ');i=value.length;while(i--){if(value[i]!==value[0]){return false;}}styles[key]=value[0];return true;};var compress2=function compress2(target,a,b,c){if(!canCompress(a)){return;}if(!canCompress(b)){return;}if(!canCompress(c)){return;}styles[target]=styles[a]+' '+styles[b]+' '+styles[c];delete styles[a];delete styles[b];delete styles[c];};var encode=function encode(str){isEncoded=true;return encodingLookup[str];};var decode=function decode(str,keepSlashes){if(isEncoded){str=str.replace(/\\uFEFF[0-9]/g,function(str){return encodingLookup[str];});}if(!keepSlashes){str=str.replace(/\\\\([\\'\\\";:])/g,'$1');}return str;};var decodeSingleHexSequence=function decodeSingleHexSequence(escSeq){return String.fromCharCode(parseInt(escSeq.slice(1),16));};var decodeHexSequences=function decodeHexSequences(value){return value.replace(/\\\\[0-9a-f]+/gi,decodeSingleHexSequence);};var processUrl=function processUrl(match,url,url2,url3,str,str2){str=str||str2;if(str){str=decode(str);return'\\''+str.replace(/\\'/g,'\\\\\\'')+'\\'';}url=decode(url||url2||url3);if(!settings.allow_script_urls){var scriptUrl=url.replace(/[\\s\\r\\n]+/g,'');if(/(java|vb)script:/i.test(scriptUrl)){return'';}if(!settings.allow_svg_data_urls&&/^data:image\\/svg/i.test(scriptUrl)){return'';}}if(urlConverter){url=urlConverter.call(urlConverterScope,url,'style');}return'url(\\''+url.replace(/\\'/g,'\\\\\\'')+'\\')';};if(css){css=css.replace(/[\\u0000-\\u001F]/g,'');css=css.replace(/\\\\[\\\"\\';:\\uFEFF]/g,encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g,function(str){return str.replace(/[;:]/g,encode);});while(matches=styleRegExp.exec(css)){styleRegExp.lastIndex=matches.index+matches[0].length;name=matches[1].replace(trimRightRegExp,'').toLowerCase();value=matches[2].replace(trimRightRegExp,'');if(name&&value){name=decodeHexSequences(name);value=decodeHexSequences(value);if(name.indexOf(invisibleChar)!==-1||name.indexOf('\"')!==-1){continue;}if(!settings.allow_script_urls&&(name==='behavior'||/expression\\s*\\(|\\/\\*|\\*\\//.test(value))){continue;}if(name==='font-weight'&&value==='700'){value='bold';}else if(name==='color'||name==='background-color'){value=value.toLowerCase();}value=value.replace(rgbRegExp,_toHex);value=value.replace(urlOrStrRegExp,processUrl);styles[name]=isEncoded?decode(value,true):value;}}compress('border','',true);compress('border','-width');compress('border','-color');compress('border','-style');compress('padding','');compress('margin','');compress2('border','border-width','border-style','border-color');if(styles.border==='medium none'){delete styles.border;}if(styles['border-image']==='none'){delete styles['border-image'];}}return styles;},serialize:function serialize(styles,elementName){var css='';var serializeStyles=function serializeStyles(name){var value;var styleList=validStyles[name];if(styleList){for(var i_1=0,l=styleList.length;i_1<l;i_1++){name=styleList[i_1];value=styles[name];if(value){css+=(css.length>0?' ':'')+name+': '+value+';';}}}};var isValid=function isValid(name,elementName){var styleMap=invalidStyles['*'];if(styleMap&&styleMap[name]){return false;}styleMap=invalidStyles[elementName];return!(styleMap&&styleMap[name]);};if(elementName&&validStyles){serializeStyles('*');serializeStyles(elementName);}else{each$j(styles,function(value,name){if(value&&(!invalidStyles||isValid(name,elementName))){css+=(css.length>0?' ':'')+name+': '+value+';';}});}return css;}};};var deprecated={keyLocation:true,layerX:true,layerY:true,returnValue:true,webkitMovementX:true,webkitMovementY:true,keyIdentifier:true,mozPressure:true};var isNativeEvent=function isNativeEvent(event){return event instanceof Event||isFunction(event.initEvent);};var hasIsDefaultPrevented=function hasIsDefaultPrevented(event){return event.isDefaultPrevented===always||event.isDefaultPrevented===never;};var needsNormalizing=function needsNormalizing(event){return isNullable(event.preventDefault)||isNativeEvent(event);};var clone$2=function clone$2(originalEvent,data){var event=data!==null&&data!==void 0?data:{};for(var name_1 in originalEvent){if(!has$2(deprecated,name_1)){event[name_1]=originalEvent[name_1];}}if(isNonNullable(event.composedPath)){event.composedPath=function(){return originalEvent.composedPath();};}return event;};var normalize$3=function normalize$3(type,originalEvent,fallbackTarget,data){var _a;var event=clone$2(originalEvent,data);event.type=type;if(isNullable(event.target)){event.target=(_a=event.srcElement)!==null&&_a!==void 0?_a:fallbackTarget;}if(needsNormalizing(originalEvent)){event.preventDefault=function(){event.defaultPrevented=true;event.isDefaultPrevented=always;if(isFunction(originalEvent.preventDefault)){originalEvent.preventDefault();}else if(isNativeEvent(originalEvent)){originalEvent.returnValue=false;}};event.stopPropagation=function(){event.cancelBubble=true;event.isPropagationStopped=always;if(isFunction(originalEvent.stopPropagation)){originalEvent.stopPropagation();}else if(isNativeEvent(originalEvent)){originalEvent.cancelBubble=true;}};event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=always;event.stopPropagation();};if(!hasIsDefaultPrevented(event)){event.isDefaultPrevented=event.defaultPrevented===true?always:never;event.isPropagationStopped=event.cancelBubble===true?always:never;event.isImmediatePropagationStopped=never;}}return event;};var eventExpandoPrefix='mce-data-';var mouseEventRe=/^(?:mouse|contextmenu)|click/;var addEvent=function addEvent(target,name,callback,capture){if(target.addEventListener){target.addEventListener(name,callback,capture||false);}else if(target.attachEvent){target.attachEvent('on'+name,callback);}};var removeEvent=function removeEvent(target,name,callback,capture){if(target.removeEventListener){target.removeEventListener(name,callback,capture||false);}else if(target.detachEvent){target.detachEvent('on'+name,callback);}};var isMouseEvent=function isMouseEvent(event){return isNonNullable(event)&&mouseEventRe.test(event.type);};var fix=function fix(originalEvent,data){var event=normalize$3(originalEvent.type,originalEvent,document,data);if(isMouseEvent(originalEvent)&&isUndefined(originalEvent.pageX)&&!isUndefined(originalEvent.clientX)){var eventDoc=event.target.ownerDocument||document;var doc=eventDoc.documentElement;var body=eventDoc.body;var mouseEvent=event;mouseEvent.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);mouseEvent.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}if(isUndefined(event.metaKey)){event.metaKey=false;}return event;};var bindOnReady=function bindOnReady(win,callback,eventUtils){var doc=win.document,event={type:'ready'};if(eventUtils.domLoaded){callback(event);return;}var isDocReady=function isDocReady(){return doc.readyState==='complete'||doc.readyState==='interactive'&&doc.body;};var _readyHandler=function readyHandler(){removeEvent(win,'DOMContentLoaded',_readyHandler);removeEvent(win,'load',_readyHandler);if(!eventUtils.domLoaded){eventUtils.domLoaded=true;callback(event);}win=null;};if(isDocReady()){_readyHandler();}else{addEvent(win,'DOMContentLoaded',_readyHandler);}if(!eventUtils.domLoaded){addEvent(win,'load',_readyHandler);}};var EventUtils=function(){function EventUtils(){this.domLoaded=false;this.events={};this.count=1;this.expando=eventExpandoPrefix+(+new Date()).toString(32);this.hasMouseEnterLeave='onmouseenter'in document.documentElement;this.hasFocusIn='onfocusin'in document.documentElement;this.count=1;}EventUtils.prototype.bind=function(target,names,callback,scope){var self=this;var id,callbackList,i,name,fakeName,nativeHandler,capture;var win=window;var defaultNativeHandler=function defaultNativeHandler(evt){self.executeHandlers(fix(evt||win.event),id);};if(!target||target.nodeType===3||target.nodeType===8){return;}if(!target[self.expando]){id=self.count++;target[self.expando]=id;self.events[id]={};}else{id=target[self.expando];}scope=scope||target;var namesList=names.split(' ');i=namesList.length;while(i--){name=namesList[i];nativeHandler=defaultNativeHandler;fakeName=capture=false;if(name==='DOMContentLoaded'){name='ready';}if(self.domLoaded&&name==='ready'&&target.readyState==='complete'){callback.call(scope,fix({type:name}));continue;}if(!self.hasMouseEnterLeave){fakeName=self.mouseEnterLeave[name];if(fakeName){nativeHandler=function nativeHandler(evt){var current=evt.currentTarget;var related=evt.relatedTarget;if(related&&current.contains){related=current.contains(related);}else{while(related&&related!==current){related=related.parentNode;}}if(!related){evt=fix(evt||win.event);evt.type=evt.type==='mouseout'?'mouseleave':'mouseenter';evt.target=current;self.executeHandlers(evt,id);}};}}if(!self.hasFocusIn&&(name==='focusin'||name==='focusout')){capture=true;fakeName=name==='focusin'?'focus':'blur';nativeHandler=function nativeHandler(evt){evt=fix(evt||win.event);evt.type=evt.type==='focus'?'focusin':'focusout';self.executeHandlers(evt,id);};}callbackList=self.events[id][name];if(!callbackList){self.events[id][name]=callbackList=[{func:callback,scope:scope}];callbackList.fakeName=fakeName;callbackList.capture=capture;callbackList.nativeHandler=nativeHandler;if(name==='ready'){bindOnReady(target,nativeHandler,self);}else{addEvent(target,fakeName||name,nativeHandler,capture);}}else{if(name==='ready'&&self.domLoaded){callback(fix({type:name}));}else{callbackList.push({func:callback,scope:scope});}}}target=callbackList=null;return callback;};EventUtils.prototype.unbind=function(target,names,callback){var callbackList,i,ci,name,eventMap;if(!target||target.nodeType===3||target.nodeType===8){return this;}var id=target[this.expando];if(id){eventMap=this.events[id];if(names){var namesList=names.split(' ');i=namesList.length;while(i--){name=namesList[i];callbackList=eventMap[name];if(callbackList){if(callback){ci=callbackList.length;while(ci--){if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler;var fakeName=callbackList.fakeName,capture=callbackList.capture;callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1));callbackList.nativeHandler=nativeHandler;callbackList.fakeName=fakeName;callbackList.capture=capture;eventMap[name]=callbackList;}}}if(!callback||callbackList.length===0){delete eventMap[name];removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture);}}}}else{each$j(eventMap,function(callbackList,name){removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture);});eventMap={};}for(name in eventMap){if(has$2(eventMap,name)){return this;}}delete this.events[id];try{delete target[this.expando];}catch(ex){target[this.expando]=null;}}return this;};EventUtils.prototype.fire=function(target,name,args){var id;if(!target||target.nodeType===3||target.nodeType===8){return this;}var event=fix({type:name,target:target},args);do{id=target[this.expando];if(id){this.executeHandlers(event,id);}target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow;}while(target&&!event.isPropagationStopped());return this;};EventUtils.prototype.clean=function(target){var i,children;if(!target||target.nodeType===3||target.nodeType===8){return this;}if(target[this.expando]){this.unbind(target);}if(!target.getElementsByTagName){target=target.document;}if(target&&target.getElementsByTagName){this.unbind(target);children=target.getElementsByTagName('*');i=children.length;while(i--){target=children[i];if(target[this.expando]){this.unbind(target);}}}return this;};EventUtils.prototype.destroy=function(){this.events={};};EventUtils.prototype.cancel=function(e){if(e){e.preventDefault();e.stopImmediatePropagation();}return false;};EventUtils.prototype.executeHandlers=function(evt,id){var container=this.events[id];var callbackList=container&&container[evt.type];if(callbackList){for(var i=0,l=callbackList.length;i<l;i++){var callback=callbackList[i];if(callback&&callback.func.call(callback.scope,evt)===false){evt.preventDefault();}if(evt.isImmediatePropagationStopped()){return;}}}};EventUtils.Event=new EventUtils();return EventUtils;}();var support,Expr,getText,isXML,tokenize,compile,select$1,outermostContext,sortInput,hasDuplicate,setDocument,document$1,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando='sizzle'+-new Date(),preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function sortOrder(a,b){if(a===b){hasDuplicate=true;}return 0;},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push$1=arr.push,slice$1=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i;}}return-1;},booleans='checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped',whitespace='[\\\\x20\\\\t\\\\r\\\\n\\\\f]',identifier='(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+',attributes='\\\\['+whitespace+'*('+identifier+')(?:'+whitespace+'*([*^$|!~]?=)'+whitespace+'*(?:\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\"|('+identifier+'))|)'+whitespace+'*\\\\]',pseudos=':('+identifier+')(?:\\\\(('+'(\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\")|'+'((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|'+attributes+')*)|'+'.*'+')\\\\)|)',rtrim=new RegExp('^'+whitespace+'+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)'+whitespace+'+$','g'),rcomma=new RegExp('^'+whitespace+'*,'+whitespace+'*'),rcombinators=new RegExp('^'+whitespace+'*([>+~]|'+whitespace+')'+whitespace+'*'),rattributeQuotes=new RegExp('='+whitespace+'*([^\\\\]\\'\"]*?)'+whitespace+'*\\\\]','g'),rpseudo=new RegExp(pseudos),ridentifier=new RegExp('^'+identifier+'$'),matchExpr={ID:new RegExp('^#('+identifier+')'),CLASS:new RegExp('^\\\\.('+identifier+')'),TAG:new RegExp('^('+identifier+'|[*])'),ATTR:new RegExp('^'+attributes),PSEUDO:new RegExp('^'+pseudos),CHILD:new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\('+whitespace+'*(even|odd|(([+-]|)(\\\\d*)n|)'+whitespace+'*(?:([+-]|)'+whitespace+'*(\\\\d+)|))'+whitespace+'*\\\\)|)','i'),bool:new RegExp('^(?:'+booleans+')$','i'),needsContext:new RegExp('^'+whitespace+'*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\('+whitespace+'*((?:-\\\\d)?\\\\d*)'+whitespace+'*\\\\)|)(?=[^-]|$)','i')},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\\d$/i,rnative=/^[^{]+\\{\\s*\\[native \\w/,rquickExpr$1=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\\\/g,runescape=new RegExp('\\\\\\\\([\\\\da-f]{1,6}'+whitespace+'?|('+whitespace+')|.)','ig'),funescape=function funescape(_,escaped,escapedWhitespace){var high='0x'+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320);};try{push$1.apply(arr=slice$1.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType;}catch(e){push$1={apply:arr.length?function(target,els){push_native.apply(target,slice$1.call(els));}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1;}};}var Sizzle=function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document$1){setDocument(context);}context=context||document$1;results=results||[];if(!selector||typeof selector!=='string'){return results;}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[];}if(documentIsHTML&&!seed){if(match=rquickExpr$1.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results;}}else{return results;}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results;}}}else if(match[2]){push$1.apply(results,context.getElementsByTagName(selector));return results;}else if((m=match[3])&&support.getElementsByClassName){push$1.apply(results,context.getElementsByClassName(m));return results;}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=='object'){groups=tokenize(selector);if(old=context.getAttribute('id')){nid=old.replace(rescape,'\\\\$&');}else{context.setAttribute('id',nid);}nid='[id=\\''+nid+'\\'] ';i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i]);}newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;newSelector=groups.join(',');}if(newSelector){try{push$1.apply(results,newContext.querySelectorAll(newSelector));return results;}catch(qsaError){}finally{if(!old){context.removeAttribute('id');}}}}}return select$1(selector.replace(rtrim,'$1'),context,results,seed);};function createCache(){var keys=[];function cache(key,value){if(keys.push(key+' ')>Expr.cacheLength){delete cache[keys.shift()];}return cache[key+' ']=value;}return cache;}function markFunction(fn){fn[expando]=true;return fn;}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff;}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1;}}}return a?1:-1;}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==='input'&&elem.type===type;};}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==='input'||name==='button')&&elem.type===type;};}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j]);}}});});}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context;}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=='HTML':false;};setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;function getTop(win){try{return win.top;}catch(ex){}return null;}if(doc===document$1||doc.nodeType!==9||!doc.documentElement){return document$1;}document$1=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent!==getTop(parent)){if(parent.addEventListener){parent.addEventListener('unload',function(){setDocument();},false);}else if(parent.attachEvent){parent.attachEvent('onunload',function(){setDocument();});}}support.attributes=true;support.getElementsByTagName=true;support.getElementsByClassName=rnative.test(doc.getElementsByClassName);support.getById=true;Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[];}};Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute('id')===attrId;};};Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag);}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==='*'){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem);}}return tmp;}return results;};Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML){return context.getElementsByClassName(className);}};rbuggyMatches=[];rbuggyQSA=[];support.disconnectedMatch=true;rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join('|'));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join('|'));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16));}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true;}}}return false;};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0;}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare;}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1;}if(b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1;}return sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;}return compare&4?-1:1;}:function(a,b){if(a===b){hasDuplicate=true;return 0;}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;}else if(aup===bup){return siblingCheck(a,b);}cur=a;while(cur=cur.parentNode){ap.unshift(cur);}cur=b;while(cur=cur.parentNode){bp.unshift(cur);}while(ap[i]===bp[i]){i++;}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0;};return doc;};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements);};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document$1){setDocument(elem);}expr=expr.replace(rattributeQuotes,'=\\'$1\\']');if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret;}}catch(e){}}return Sizzle(expr,document$1,null,[elem]).length>0;};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document$1){setDocument(context);}return contains(context,elem);};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document$1){setDocument(elem);}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null;};Sizzle.error=function(msg){throw new Error('Syntax error, unrecognized expression: '+msg);};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i);}}while(j--){results.splice(duplicates[j],1);}}sortInput=null;return results;};getText=Sizzle.getText=function(elem){var node,ret='',i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node);}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==='string'){return elem.textContent;}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}return ret;};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{'>':{dir:'parentNode',first:true},' ':{dir:'parentNode'},'+':{dir:'previousSibling',first:true},'~':{dir:'previousSibling'}},preFilter:{ATTR:function ATTR(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||'').replace(runescape,funescape);if(match[2]==='~='){match[3]=' '+match[3]+' ';}return match.slice(0,4);},CHILD:function CHILD(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==='nth'){if(!match[3]){Sizzle.error(match[0]);}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==='even'||match[3]==='odd'));match[5]=+(match[7]+match[8]||match[3]==='odd');}else if(match[3]){Sizzle.error(match[0]);}return match;},PSEUDO:function PSEUDO(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr.CHILD.test(match[0])){return null;}if(match[3]){match[2]=match[4]||match[5]||'';}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(')',unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess);}return match.slice(0,3);}},filter:{TAG:function TAG(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==='*'?function(){return true;}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName;};},CLASS:function CLASS(className){var pattern=classCache[className+' '];return pattern||(pattern=new RegExp('(^|'+whitespace+')'+className+'('+whitespace+'|$)'))&&classCache(className,function(elem){return pattern.test(typeof elem.className==='string'&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute('class')||'');});},ATTR:function ATTR(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==='!=';}if(!operator){return true;}result+='';return operator==='='?result===check:operator==='!='?result!==check:operator==='^='?check&&result.indexOf(check)===0:operator==='*='?check&&result.indexOf(check)>-1:operator==='$='?check&&result.slice(-check.length)===check:operator==='~='?(' '+result+' ').indexOf(check)>-1:operator==='|='?result===check||result.slice(0,check.length+1)===check+'-':false;};},CHILD:function CHILD(type,what,argument,first,last){var simple=type.slice(0,3)!=='nth',forward=type.slice(-4)!=='last',ofType=what==='of-type';return first===1&&last===0?function(elem){return!!elem.parentNode;}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?'nextSibling':'previousSibling',parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false;}}start=dir=type==='only'&&!start&&'nextSibling';}return true;}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break;}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1];}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff];}if(node===elem){break;}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0;}};},PSEUDO:function PSEUDO(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error('unsupported pseudo: '+pseudo);if(fn[expando]){return fn(argument);}if(fn.length>1){args=[pseudo,pseudo,'',argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i]);}}):function(elem){return fn(elem,0,args);};}return fn;}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,'$1'));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem);}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return!results.pop();};}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0;};}),contains:markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1;};}),lang:markFunction(function(lang){if(!ridentifier.test(lang||'')){Sizzle.error('unsupported lang: '+lang);}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute('xml:lang')||elem.getAttribute('lang')){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+'-')===0;}}while((elem=elem.parentNode)&&elem.nodeType===1);return false;};}),target:function target(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id;},root:function root(elem){return elem===docElem;},focus:function focus(elem){return elem===document$1.activeElement&&(!document$1.hasFocus||document$1.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex);},enabled:function enabled(elem){return elem.disabled===false;},disabled:function disabled(elem){return elem.disabled===true;},checked:function checked(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==='input'&&!!elem.checked||nodeName==='option'&&!!elem.selected;},selected:function selected(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}return elem.selected===true;},empty:function empty(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false;}}return true;},parent:function parent(elem){return!Expr.pseudos.empty(elem);},header:function header(elem){return rheader.test(elem.nodeName);},input:function input(elem){return rinputs.test(elem.nodeName);},button:function button(elem){var name=elem.nodeName.toLowerCase();return name==='input'&&elem.type==='button'||name==='button';},text:function text(elem){var attr;return elem.nodeName.toLowerCase()==='input'&&elem.type==='text'&&((attr=elem.getAttribute('type'))==null||attr.toLowerCase()==='text');},first:createPositionalPseudo(function(){return[0];}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1];}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument];}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i);}return matchIndexes;}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i);}return matchIndexes;}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i);}return matchIndexes;}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i);}return matchIndexes;})}};Expr.pseudos.nth=Expr.pseudos.eq;each$k(['radio','checkbox','file','password','image'],function(i){Expr.pseudos[i]=createInputPseudo(i);});each$k(['submit','reset'],function(i){Expr.pseudos[i]=createButtonPseudo(i);});function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters();tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+' '];if(cached){return parseOnly?0:cached.slice(0);}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar;}groups.push(tokens=[]);}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim,' ')});soFar=soFar.slice(matched.length);}for(type in Expr.filter){if(!Expr.filter.hasOwnProperty(type)){continue;}if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length);}}if(!matched){break;}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0);};function toSelector(tokens){var i=0,len=tokens.length,selector='';for(;i<len;i++){selector+=tokens[i].value;}return selector;}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==='parentNode',doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml);}}}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true;}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2];}else{outerCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true;}}}}}};}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false;}}return true;}:matchers[0];}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results);}return results;}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i);}}}}return newUnmatched;}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter);}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector);}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||'*',context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml);}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem);}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem);}}postFinder(null,matcherOut=[],temp,xml);}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem);}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml);}else{push$1.apply(results,matcherOut);}}});}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[' '],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext;},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1;},implicitRelative,true),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret;}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)];}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break;}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===' '?'*':''})).replace(rtrim,'$1'),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens));}matchers.push(matcher);}}return elementMatcher(matchers);}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function superMatcher(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i='0',unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG('*',outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||0.1,len=elems.length;if(outermost){outermostContext=context!==document$1&&context;}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break;}}if(outermost){dirruns=dirrunsUnique;}}if(bySet){if(elem=!matcher&&elem){matchedCount--;}if(seed){unmatched.push(elem);}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml);}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results);}}}setMatched=condense(setMatched);}push$1.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results);}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup;}return unmatched;};return bySet?markFunction(superMatcher):superMatcher;}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+' '];if(!cached){if(!match){match=tokenize(selector);}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached);}else{elementMatchers.push(cached);}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector;}return cached;};select$1=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==='function'&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==='ID'&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results;}else if(compiled){context=context.parentNode;}selector=selector.slice(tokens.shift().value.length);}i=matchExpr.needsContext.test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break;}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push$1.apply(results,seed);return results;}break;}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context);return results;};support.sortStable=expando.split('').sort(sortOrder).join('')===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=true;var doc=document;var push=Array.prototype.push;var _slice=Array.prototype.slice;var rquickExpr=/^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;var Event$1=EventUtils.Event;var skipUniques=Tools.makeMap('children,contents,next,prev');var isDefined=function isDefined(obj){return typeof obj!=='undefined';};var isString=function isString(obj){return typeof obj==='string';};var isWindow=function isWindow(obj){return obj&&obj===obj.window;};var createFragment$1=function createFragment$1(html,fragDoc){fragDoc=fragDoc||doc;var container=fragDoc.createElement('div');var frag=fragDoc.createDocumentFragment();container.innerHTML=html;var node;while(node=container.firstChild){frag.appendChild(node);}return frag;};var _domManipulate=function domManipulate(targetNodes,sourceItem,callback,reverse){var i;if(isString(sourceItem)){sourceItem=createFragment$1(sourceItem,getElementDocument(targetNodes[0]));}else if(sourceItem.length&&!sourceItem.nodeType){sourceItem=DomQuery.makeArray(sourceItem);if(reverse){for(i=sourceItem.length-1;i>=0;i--){_domManipulate(targetNodes,sourceItem[i],callback,reverse);}}else{for(i=0;i<sourceItem.length;i++){_domManipulate(targetNodes,sourceItem[i],callback,reverse);}}return targetNodes;}if(sourceItem.nodeType){i=targetNodes.length;while(i--){callback.call(targetNodes[i],sourceItem);}}return targetNodes;};var _hasClass=function hasClass(node,className){return node&&className&&(' '+node.className+' ').indexOf(' '+className+' ')!==-1;};var wrap$2=function wrap$2(elements,wrapper,all){var lastParent,newWrapper;wrapper=DomQuery(wrapper)[0];elements.each(function(){var self=this;if(!all||lastParent!==self.parentNode){lastParent=self.parentNode;newWrapper=wrapper.cloneNode(false);self.parentNode.insertBefore(newWrapper,self);newWrapper.appendChild(self);}else{newWrapper.appendChild(self);}});return elements;};var numericCssMap=Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom',' ');var booleanMap=Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected',' ');var propFix={for:'htmlFor',class:'className',readonly:'readOnly'};var cssFix={float:'cssFloat'};var attrHooks={},cssHooks={};var DomQueryConstructor=function DomQueryConstructor(selector,context){return new DomQuery.fn.init(selector,context);};var inArray$1=function inArray$1(item,array){var i;if(array.indexOf){return array.indexOf(item);}i=array.length;while(i--){if(array[i]===item){return i;}}return-1;};var whiteSpaceRegExp=/^\\s*|\\s*$/g;var trim$2=function trim$2(str){return str===null||str===undefined?'':(''+str).replace(whiteSpaceRegExp,'');};var each$g=function each$g(obj,callback){var length,key,i,value;if(obj){length=obj.length;if(length===undefined){for(key in obj){if(obj.hasOwnProperty(key)){value=obj[key];if(callback.call(value,key,value)===false){break;}}}}else{for(i=0;i<length;i++){value=obj[i];if(callback.call(value,i,value)===false){break;}}}}return obj;};var grep$2=function grep$2(array,callback){var out=[];each$g(array,function(i,item){if(callback(item,i)){out.push(item);}});return out;};var getElementDocument=function getElementDocument(element){if(!element){return doc;}if(element.nodeType===9){return element;}return element.ownerDocument;};DomQueryConstructor.fn=DomQueryConstructor.prototype={constructor:DomQueryConstructor,selector:'',context:null,length:0,init:function init(selector,context){var self=this;var match,node;if(!selector){return self;}if(selector.nodeType){self.context=self[0]=selector;self.length=1;return self;}if(context&&context.nodeType){self.context=context;}else{if(context){return DomQuery(selector).attr(context);}self.context=context=document;}if(isString(selector)){self.selector=selector;if(selector.charAt(0)==='<'&&selector.charAt(selector.length-1)==='>'&&selector.length>=3){match=[null,selector,null];}else{match=rquickExpr.exec(selector);}if(match){if(match[1]){node=createFragment$1(selector,getElementDocument(context)).firstChild;while(node){push.call(self,node);node=node.nextSibling;}}else{node=getElementDocument(context).getElementById(match[2]);if(!node){return self;}if(node.id!==match[2]){return self.find(selector);}self.length=1;self[0]=node;}}else{return DomQuery(context).find(selector);}}else{this.add(selector,false);}return self;},toArray:function toArray(){return Tools.toArray(this);},add:function add(items,sort){var self=this;var nodes,i;if(isString(items)){return self.add(DomQuery(items));}if(sort!==false){nodes=DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));self.length=nodes.length;for(i=0;i<nodes.length;i++){self[i]=nodes[i];}}else{push.apply(self,DomQuery.makeArray(items));}return self;},attr:function attr(name,value){var self=this;var hook;if(typeof name==='object'){each$g(name,function(name,value){self.attr(name,value);});}else if(isDefined(value)){this.each(function(){var hook;if(this.nodeType===1){hook=attrHooks[name];if(hook&&hook.set){hook.set(this,value);return;}if(value===null){this.removeAttribute(name,2);}else{this.setAttribute(name,value,2);}}});}else{if(self[0]&&self[0].nodeType===1){hook=attrHooks[name];if(hook&&hook.get){return hook.get(self[0],name);}if(booleanMap[name]){return self.prop(name)?name:undefined;}value=self[0].getAttribute(name,2);if(value===null){value=undefined;}}return value;}return self;},removeAttr:function removeAttr(name){return this.attr(name,null);},prop:function prop(name,value){var self=this;name=propFix[name]||name;if(typeof name==='object'){each$g(name,function(name,value){self.prop(name,value);});}else if(isDefined(value)){this.each(function(){if(this.nodeType===1){this[name]=value;}});}else{if(self[0]&&self[0].nodeType&&name in self[0]){return self[0][name];}return value;}return self;},css:function css(name,value){var self=this;var elm,hook;var camel=function camel(name){return name.replace(/-(\\D)/g,function(a,b){return b.toUpperCase();});};var dashed=function dashed(name){return name.replace(/[A-Z]/g,function(a){return'-'+a;});};if(typeof name==='object'){each$g(name,function(name,value){self.css(name,value);});}else{if(isDefined(value)){name=camel(name);if(typeof value==='number'&&!numericCssMap[name]){value=value.toString()+'px';}self.each(function(){var style=this.style;hook=cssHooks[name];if(hook&&hook.set){hook.set(this,value);return;}try{this.style[cssFix[name]||name]=value;}catch(ex){}if(value===null||value===''){if(style.removeProperty){style.removeProperty(dashed(name));}else{style.removeAttribute(name);}}});}else{elm=self[0];hook=cssHooks[name];if(hook&&hook.get){return hook.get(elm);}if(elm.ownerDocument.defaultView){try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name));}catch(ex){return undefined;}}else if(elm.currentStyle){return elm.currentStyle[camel(name)];}else{return'';}}}return self;},remove:function remove(){var self=this;var node,i=this.length;while(i--){node=self[i];Event$1.clean(node);if(node.parentNode){node.parentNode.removeChild(node);}}return this;},empty:function empty(){var self=this;var node,i=this.length;while(i--){node=self[i];while(node.firstChild){node.removeChild(node.firstChild);}}return this;},html:function html(value){var self=this;var i;if(isDefined(value)){i=self.length;try{while(i--){self[i].innerHTML=value;}}catch(ex){DomQuery(self[i]).empty().append(value);}return self;}return self[0]?self[0].innerHTML:'';},text:function text(value){var self=this;var i;if(isDefined(value)){i=self.length;while(i--){if('innerText'in self[i]){self[i].innerText=value;}else{self[0].textContent=value;}}return self;}return self[0]?self[0].innerText||self[0].textContent:'';},append:function append(){return _domManipulate(this,arguments,function(node){if(this.nodeType===1||this.host&&this.host.nodeType===1){this.appendChild(node);}});},prepend:function prepend(){return _domManipulate(this,arguments,function(node){if(this.nodeType===1||this.host&&this.host.nodeType===1){this.insertBefore(node,this.firstChild);}},true);},before:function before(){var self=this;if(self[0]&&self[0].parentNode){return _domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this);});}return self;},after:function after(){var self=this;if(self[0]&&self[0].parentNode){return _domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this.nextSibling);},true);}return self;},appendTo:function appendTo(val){DomQuery(val).append(this);return this;},prependTo:function prependTo(val){DomQuery(val).prepend(this);return this;},replaceWith:function replaceWith(content){return this.before(content).remove();},wrap:function wrap(content){return wrap$2(this,content);},wrapAll:function wrapAll(content){return wrap$2(this,content,true);},wrapInner:function wrapInner(content){this.each(function(){DomQuery(this).contents().wrapAll(content);});return this;},unwrap:function unwrap(){return this.parent().each(function(){DomQuery(this).replaceWith(this.childNodes);});},clone:function clone(){var result=[];this.each(function(){result.push(this.cloneNode(true));});return DomQuery(result);},addClass:function addClass(className){return this.toggleClass(className,true);},removeClass:function removeClass(className){return this.toggleClass(className,false);},toggleClass:function toggleClass(className,state){var self=this;if(typeof className!=='string'){return self;}if(className.indexOf(' ')!==-1){each$g(className.split(' '),function(){self.toggleClass(this,state);});}else{self.each(function(index,node){var classState=_hasClass(node,className);if(classState!==state){var existingClassName=node.className;if(classState){node.className=trim$2((' '+existingClassName+' ').replace(' '+className+' ',' '));}else{node.className+=existingClassName?' '+className:className;}}});}return self;},hasClass:function hasClass(className){return _hasClass(this[0],className);},each:function each(callback){return each$g(this,callback);},on:function on(name,callback){return this.each(function(){Event$1.bind(this,name,callback);});},off:function off(name,callback){return this.each(function(){Event$1.unbind(this,name,callback);});},trigger:function trigger(name){return this.each(function(){if(typeof name==='object'){Event$1.fire(this,name.type,name);}else{Event$1.fire(this,name);}});},show:function show(){return this.css('display','');},hide:function hide(){return this.css('display','none');},slice:function slice(){return DomQuery(_slice.apply(this,arguments));},eq:function eq(index){return index===-1?this.slice(index):this.slice(index,+index+1);},first:function first(){return this.eq(0);},last:function last(){return this.eq(-1);},find:function find(selector){var i,l;var ret=[];for(i=0,l=this.length;i<l;i++){DomQuery.find(selector,this[i],ret);}return DomQuery(ret);},filter:function filter(selector){if(typeof selector==='function'){return DomQuery(grep$2(this.toArray(),function(item,i){return selector(i,item);}));}return DomQuery(DomQuery.filter(selector,this.toArray()));},closest:function closest(selector){var result=[];if(selector instanceof DomQuery){selector=selector[0];}this.each(function(i,node){while(node){if(typeof selector==='string'&&DomQuery(node).is(selector)){result.push(node);break;}else if(node===selector){result.push(node);break;}node=node.parentNode;}});return DomQuery(result);},offset:function offset(_offset){var elm,doc,docElm;var x=0,y=0,pos;if(!_offset){elm=this[0];if(elm){doc=elm.ownerDocument;docElm=doc.documentElement;if(elm.getBoundingClientRect){pos=elm.getBoundingClientRect();x=pos.left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft;y=pos.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop;}}return{left:x,top:y};}return this.css(_offset);},push:push,sort:Array.prototype.sort,splice:Array.prototype.splice};Tools.extend(DomQueryConstructor,{extend:Tools.extend,makeArray:function makeArray(object){if(isWindow(object)||object.nodeType){return[object];}return Tools.toArray(object);},inArray:inArray$1,isArray:Tools.isArray,each:each$g,trim:trim$2,grep:grep$2,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function filter(expr,elems,not){var i=elems.length;if(not){expr=':not('+expr+')';}while(i--){if(elems[i].nodeType!==1){elems.splice(i,1);}}if(elems.length===1){elems=DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[];}else{elems=DomQuery.find.matches(expr,elems);}return elems;}});var dir=function dir(el,prop,until){var matched=[];var cur=el[prop];if(typeof until!=='string'&&until instanceof DomQuery){until=until[0];}while(cur&&cur.nodeType!==9){if(until!==undefined){if(cur===until){break;}if(typeof until==='string'&&DomQuery(cur).is(until)){break;}}if(cur.nodeType===1){matched.push(cur);}cur=cur[prop];}return matched;};var sibling$1=function sibling$1(node,siblingName,nodeType,until){var result=[];if(until instanceof DomQuery){until=until[0];}for(;node;node=node[siblingName]){if(nodeType&&node.nodeType!==nodeType){continue;}if(until!==undefined){if(node===until){break;}if(typeof until==='string'&&DomQuery(node).is(until)){break;}}result.push(node);}return result;};var firstSibling=function firstSibling(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName]){if(node.nodeType===nodeType){return node;}}return null;};each$g({parent:function parent(node){var parent=node.parentNode;return parent&&parent.nodeType!==11?parent:null;},parents:function parents(node){return dir(node,'parentNode');},next:function next(node){return firstSibling(node,'nextSibling',1);},prev:function prev(node){return firstSibling(node,'previousSibling',1);},children:function children(node){return sibling$1(node.firstChild,'nextSibling',1);},contents:function contents(node){return Tools.toArray((node.nodeName==='iframe'?node.contentDocument||node.contentWindow.document:node).childNodes);}},function(name,fn){DomQueryConstructor.fn[name]=function(selector){var self=this;var result=[];self.each(function(){var nodes=fn.call(result,this,selector,result);if(nodes){if(DomQuery.isArray(nodes)){result.push.apply(result,nodes);}else{result.push(nodes);}}});if(this.length>1){if(!skipUniques[name]){result=DomQuery.unique(result);}if(name.indexOf('parents')===0){result=result.reverse();}}var wrappedResult=DomQuery(result);if(selector){return wrappedResult.filter(selector);}return wrappedResult;};});each$g({parentsUntil:function parentsUntil(node,until){return dir(node,'parentNode',until);},nextUntil:function nextUntil(node,until){return sibling$1(node,'nextSibling',1,until).slice(1);},prevUntil:function prevUntil(node,until){return sibling$1(node,'previousSibling',1,until).slice(1);}},function(name,fn){DomQueryConstructor.fn[name]=function(selector,filter){var self=this;var result=[];self.each(function(){var nodes=fn.call(result,this,selector,result);if(nodes){if(DomQuery.isArray(nodes)){result.push.apply(result,nodes);}else{result.push(nodes);}}});if(this.length>1){result=DomQuery.unique(result);if(name.indexOf('parents')===0||name==='prevUntil'){result=result.reverse();}}var wrappedResult=DomQuery(result);if(filter){return wrappedResult.filter(filter);}return wrappedResult;};});DomQueryConstructor.fn.is=function(selector){return!!selector&&this.filter(selector).length>0;};DomQueryConstructor.fn.init.prototype=DomQueryConstructor.fn;DomQueryConstructor.overrideDefaults=function(callback){var defaults;var _sub=function sub(selector,context){defaults=defaults||callback();if(arguments.length===0){selector=defaults.element;}if(!context){context=defaults.context;}return new _sub.fn.init(selector,context);};DomQuery.extend(_sub,this);return _sub;};DomQueryConstructor.attrHooks=attrHooks;DomQueryConstructor.cssHooks=cssHooks;var DomQuery=DomQueryConstructor;var each$f=Tools.each;var grep$1=Tools.grep;var isIE=Env.ie;var simpleSelectorRe=/^([a-z0-9],?)+$/i;var setupAttrHooks=function setupAttrHooks(styles,settings,getContext){var keepValues=settings.keep_values;var keepUrlHook={set:function set($elm,value,name){if(settings.url_converter&&value!==null){value=settings.url_converter.call(settings.url_converter_scope||getContext(),value,name,$elm[0]);}$elm.attr('data-mce-'+name,value).attr(name,value);},get:function get($elm,name){return $elm.attr('data-mce-'+name)||$elm.attr(name);}};var attrHooks={style:{set:function set($elm,value){if(value!==null&&typeof value==='object'){$elm.css(value);return;}if(keepValues){$elm.attr('data-mce-style',value);}if(value!==null&&typeof value==='string'){$elm.removeAttr('style');$elm.css(styles.parse(value));}else{$elm.attr('style',value);}},get:function get($elm){var value=$elm.attr('data-mce-style')||$elm.attr('style');value=styles.serialize(styles.parse(value),$elm[0].nodeName);return value;}}};if(keepValues){attrHooks.href=attrHooks.src=keepUrlHook;}return attrHooks;};var updateInternalStyleAttr=function updateInternalStyleAttr(styles,$elm){var rawValue=$elm.attr('style');var value=styles.serialize(styles.parse(rawValue),$elm[0].nodeName);if(!value){value=null;}$elm.attr('data-mce-style',value);};var findNodeIndex=function findNodeIndex(node,normalized){var idx=0,lastNodeType,nodeType;if(node){for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling){nodeType=node.nodeType;if(normalized&&nodeType===3){if(nodeType===lastNodeType||!node.nodeValue.length){continue;}}idx++;lastNodeType=nodeType;}}return idx;};var _DOMUtils=function DOMUtils(doc,settings){if(settings===void 0){settings={};}var addedStyles={};var win=window;var files={};var counter=0;var stdMode=true;var boxModel=true;var styleSheetLoader=instance.forElement(SugarElement.fromDom(doc),{contentCssCors:settings.contentCssCors,referrerPolicy:settings.referrerPolicy});var boundEvents=[];var schema=settings.schema?settings.schema:Schema({});var styles=Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema);var events=settings.ownEvents?new EventUtils():EventUtils.Event;var blockElementsMap=schema.getBlockElements();var $=DomQuery.overrideDefaults(function(){return{context:doc,element:self.getRoot()};});var isBlock=function isBlock(node){if(typeof node==='string'){return!!blockElementsMap[node];}else if(node){var type=node.nodeType;if(type){return!!(type===1&&blockElementsMap[node.nodeName]);}}return false;};var get=function get(elm){return elm&&doc&&isString$1(elm)?doc.getElementById(elm):elm;};var $$=function $$(elm){return $(typeof elm==='string'?get(elm):elm);};var getAttrib=function getAttrib(elm,name,defaultVal){var hook,value;var $elm=$$(elm);if($elm.length){hook=attrHooks[name];if(hook&&hook.get){value=hook.get($elm,name);}else{value=$elm.attr(name);}}if(typeof value==='undefined'){value=defaultVal||'';}return value;};var getAttribs=function getAttribs(elm){var node=get(elm);if(!node){return[];}return node.attributes;};var setAttrib=function setAttrib(elm,name,value){if(value===''){value=null;}var $elm=$$(elm);var originalValue=$elm.attr(name);if(!$elm.length){return;}var hook=attrHooks[name];if(hook&&hook.set){hook.set($elm,value,name);}else{$elm.attr(name,value);}if(originalValue!==value&&settings.onSetAttrib){settings.onSetAttrib({attrElm:$elm,attrName:name,attrValue:value});}};var clone=function clone(node,deep){if(!isIE||node.nodeType!==1||deep){return node.cloneNode(deep);}else{var clone_1=doc.createElement(node.nodeName);each$f(getAttribs(node),function(attr){setAttrib(clone_1,attr.nodeName,getAttrib(node,attr.nodeName));});return clone_1;}};var getRoot=function getRoot(){return settings.root_element||doc.body;};var getViewPort=function getViewPort(argWin){var vp=getBounds(argWin);return{x:vp.x,y:vp.y,w:vp.width,h:vp.height};};var getPos$1=function getPos$1(elm,rootElm){return getPos(doc.body,get(elm),rootElm);};var setStyle=function setStyle(elm,name,value){var $elm=isString$1(name)?$$(elm).css(name,value):$$(elm).css(name);if(settings.update_styles){updateInternalStyleAttr(styles,$elm);}};var setStyles=function setStyles(elm,stylesArg){var $elm=$$(elm).css(stylesArg);if(settings.update_styles){updateInternalStyleAttr(styles,$elm);}};var getStyle=function getStyle(elm,name,computed){var $elm=$$(elm);if(computed){return $elm.css(name);}name=name.replace(/-(\\D)/g,function(a,b){return b.toUpperCase();});if(name==='float'){name=Env.browser.isIE()?'styleFloat':'cssFloat';}return $elm[0]&&$elm[0].style?$elm[0].style[name]:undefined;};var getSize=function getSize(elm){var w,h;elm=get(elm);w=getStyle(elm,'width');h=getStyle(elm,'height');if(w.indexOf('px')===-1){w=0;}if(h.indexOf('px')===-1){h=0;}return{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight};};var getRect=function getRect(elm){elm=get(elm);var pos=getPos$1(elm);var size=getSize(elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h};};var is=function is(elm,selector){var i;if(!elm){return false;}if(!Array.isArray(elm)){if(selector==='*'){return elm.nodeType===1;}if(simpleSelectorRe.test(selector)){var selectors=selector.toLowerCase().split(/,/);var elmName=elm.nodeName.toLowerCase();for(i=selectors.length-1;i>=0;i--){if(selectors[i]===elmName){return true;}}return false;}if(elm.nodeType&&elm.nodeType!==1){return false;}}var elms=!Array.isArray(elm)?[elm]:elm;return Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length>0;};var getParents=function getParents(elm,selector,root,collect){var result=[];var selectorVal;var node=get(elm);collect=collect===undefined;root=root||(getRoot().nodeName!=='BODY'?getRoot().parentNode:null);if(Tools.is(selector,'string')){selectorVal=selector;if(selector==='*'){selector=function selector(node){return node.nodeType===1;};}else{selector=function selector(node){return is(node,selectorVal);};}}while(node){if(node===root||isNullable(node.nodeType)||isDocument$1(node)||isDocumentFragment(node)){break;}if(!selector||typeof selector==='function'&&selector(node)){if(collect){result.push(node);}else{return[node];}}node=node.parentNode;}return collect?result:null;};var getParent=function getParent(node,selector,root){var parents=getParents(node,selector,root,false);return parents&&parents.length>0?parents[0]:null;};var _findSib=function _findSib(node,selector,name){var func=selector;if(node){if(typeof selector==='string'){func=function func(node){return is(node,selector);};}for(node=node[name];node;node=node[name]){if(typeof func==='function'&&func(node)){return node;}}}return null;};var getNext=function getNext(node,selector){return _findSib(node,selector,'nextSibling');};var getPrev=function getPrev(node,selector){return _findSib(node,selector,'previousSibling');};var select=function select(selector,scope){return Sizzle(selector,get(scope)||settings.root_element||doc,[]);};var run=function run(elm,func,scope){var result;var node=typeof elm==='string'?get(elm):elm;if(!node){return false;}if(Tools.isArray(node)&&(node.length||node.length===0)){result=[];each$f(node,function(elm,i){if(elm){result.push(func.call(scope,typeof elm==='string'?get(elm):elm,i));}});return result;}var context=scope?scope:this;return func.call(context,node);};var setAttribs=function setAttribs(elm,attrs){$$(elm).each(function(i,node){each$f(attrs,function(value,name){setAttrib(node,name,value);});});};var setHTML=function setHTML(elm,html){var $elm=$$(elm);if(isIE){$elm.each(function(i,target){if(target.canHaveHTML===false){return;}while(target.firstChild){target.removeChild(target.firstChild);}try{target.innerHTML='<br>'+html;target.removeChild(target.firstChild);}catch(ex){DomQuery('<div></div>').html('<br>'+html).contents().slice(1).appendTo(target);}return html;});}else{$elm.html(html);}};var add=function add(parentElm,name,attrs,html,create){return run(parentElm,function(parentElm){var newElm=typeof name==='string'?doc.createElement(name):name;setAttribs(newElm,attrs);if(html){if(typeof html!=='string'&&html.nodeType){newElm.appendChild(html);}else if(typeof html==='string'){setHTML(newElm,html);}}return!create?parentElm.appendChild(newElm):newElm;});};var create=function create(name,attrs,html){return add(doc.createElement(name),name,attrs,html,true);};var decode=Entities.decode;var encode=Entities.encodeAllRaw;var createHTML=function createHTML(name,attrs,html){var outHtml='',key;outHtml+='<'+name;for(key in attrs){if(hasNonNullableKey(attrs,key)){outHtml+=' '+key+'=\"'+encode(attrs[key])+'\"';}}if(typeof html!=='undefined'){return outHtml+'>'+html+'</'+name+'>';}return outHtml+' />';};var createFragment=function createFragment(html){var node;var container=doc.createElement('div');var frag=doc.createDocumentFragment();frag.appendChild(container);if(html){container.innerHTML=html;}while(node=container.firstChild){frag.appendChild(node);}frag.removeChild(container);return frag;};var remove=function remove(node,keepChildren){var $node=$$(node);if(keepChildren){$node.each(function(){var child;while(child=this.firstChild){if(child.nodeType===3&&child.data.length===0){this.removeChild(child);}else{this.parentNode.insertBefore(child,this);}}}).remove();}else{$node.remove();}return $node.length>1?$node.toArray():$node[0];};var removeAllAttribs=function removeAllAttribs(e){return run(e,function(e){var i;var attrs=e.attributes;for(i=attrs.length-1;i>=0;i--){e.removeAttributeNode(attrs.item(i));}});};var parseStyle=function parseStyle(cssText){return styles.parse(cssText);};var serializeStyle=function serializeStyle(stylesArg,name){return styles.serialize(stylesArg,name);};var addStyle=function addStyle(cssText){var head,styleElm;if(self!==_DOMUtils.DOM&&doc===document){if(addedStyles[cssText]){return;}addedStyles[cssText]=true;}styleElm=doc.getElementById('mceDefaultStyles');if(!styleElm){styleElm=doc.createElement('style');styleElm.id='mceDefaultStyles';styleElm.type='text/css';head=doc.getElementsByTagName('head')[0];if(head.firstChild){head.insertBefore(styleElm,head.firstChild);}else{head.appendChild(styleElm);}}if(styleElm.styleSheet){styleElm.styleSheet.cssText+=cssText;}else{styleElm.appendChild(doc.createTextNode(cssText));}};var loadCSS=function loadCSS(urls){if(!urls){urls='';}each$k(urls.split(','),function(url){files[url]=true;styleSheetLoader.load(url,noop);});};var toggleClass=function toggleClass(elm,cls,state){$$(elm).toggleClass(cls,state).each(function(){if(this.className===''){DomQuery(this).attr('class',null);}});};var addClass=function addClass(elm,cls){$$(elm).addClass(cls);};var removeClass=function removeClass(elm,cls){toggleClass(elm,cls,false);};var hasClass=function hasClass(elm,cls){return $$(elm).hasClass(cls);};var show=function show(elm){$$(elm).show();};var hide=function hide(elm){$$(elm).hide();};var isHidden=function isHidden(elm){return $$(elm).css('display')==='none';};var uniqueId=function uniqueId(prefix){return(!prefix?'mce_':prefix)+counter++;};var getOuterHTML=function getOuterHTML(elm){var node=typeof elm==='string'?get(elm):elm;return isElement$5(node)?node.outerHTML:DomQuery('<div></div>').append(DomQuery(node).clone()).html();};var setOuterHTML=function setOuterHTML(elm,html){$$(elm).each(function(){try{if('outerHTML'in this){this.outerHTML=html;return;}}catch(ex){}remove(DomQuery(this).html(html),true);});};var insertAfter=function insertAfter(node,reference){var referenceNode=get(reference);return run(node,function(node){var parent=referenceNode.parentNode;var nextSibling=referenceNode.nextSibling;if(nextSibling){parent.insertBefore(node,nextSibling);}else{parent.appendChild(node);}return node;});};var replace=function replace(newElm,oldElm,keepChildren){return run(oldElm,function(oldElm){if(Tools.is(oldElm,'array')){newElm=newElm.cloneNode(true);}if(keepChildren){each$f(grep$1(oldElm.childNodes),function(node){newElm.appendChild(node);});}return oldElm.parentNode.replaceChild(newElm,oldElm);});};var rename=function rename(elm,name){var newElm;if(elm.nodeName!==name.toUpperCase()){newElm=create(name);each$f(getAttribs(elm),function(attrNode){setAttrib(newElm,attrNode.nodeName,getAttrib(elm,attrNode.nodeName));});replace(newElm,elm,true);}return newElm||elm;};var findCommonAncestor=function findCommonAncestor(a,b){var ps=a,pe;while(ps){pe=b;while(pe&&ps!==pe){pe=pe.parentNode;}if(ps===pe){break;}ps=ps.parentNode;}if(!ps&&a.ownerDocument){return a.ownerDocument.documentElement;}return ps;};var toHex=function toHex(rgbVal){return styles.toHex(Tools.trim(rgbVal));};var isNonEmptyElement=function isNonEmptyElement(node){if(isElement$5(node)){var isNamedAnchor=node.nodeName.toLowerCase()==='a'&&!getAttrib(node,'href')&&getAttrib(node,'id');if(getAttrib(node,'name')||getAttrib(node,'data-mce-bookmark')||isNamedAnchor){return true;}}return false;};var isEmpty=function isEmpty(node,elements){var type,name,brCount=0;if(isNonEmptyElement(node)){return false;}node=node.firstChild;if(node){var walker=new DomTreeWalker(node,node.parentNode);var whitespace=schema?schema.getWhiteSpaceElements():{};elements=elements||(schema?schema.getNonEmptyElements():null);do{type=node.nodeType;if(isElement$5(node)){var bogusVal=node.getAttribute('data-mce-bogus');if(bogusVal){node=walker.next(bogusVal==='all');continue;}name=node.nodeName.toLowerCase();if(elements&&elements[name]){if(name==='br'){brCount++;node=walker.next();continue;}return false;}if(isNonEmptyElement(node)){return false;}}if(type===8){return false;}if(type===3&&!isWhitespaceText(node.nodeValue)){return false;}if(type===3&&node.parentNode&&whitespace[node.parentNode.nodeName]&&isWhitespaceText(node.nodeValue)){return false;}node=walker.next();}while(node);}return brCount<=1;};var createRng=function createRng(){return doc.createRange();};var split=function split(parentElm,splitElm,replacementElm){var range=createRng();var beforeFragment;var afterFragment;var parentNode;if(parentElm&&splitElm){range.setStart(parentElm.parentNode,findNodeIndex(parentElm));range.setEnd(splitElm.parentNode,findNodeIndex(splitElm));beforeFragment=range.extractContents();range=createRng();range.setStart(splitElm.parentNode,findNodeIndex(splitElm)+1);range.setEnd(parentElm.parentNode,findNodeIndex(parentElm)+1);afterFragment=range.extractContents();parentNode=parentElm.parentNode;parentNode.insertBefore(_trimNode(self,beforeFragment),parentElm);if(replacementElm){parentNode.insertBefore(replacementElm,parentElm);}else{parentNode.insertBefore(splitElm,parentElm);}parentNode.insertBefore(_trimNode(self,afterFragment),parentElm);remove(parentElm);return replacementElm||splitElm;}};var _bind=function bind(target,name,func,scope){if(Tools.isArray(target)){var i=target.length;var rv=[];while(i--){rv[i]=_bind(target[i],name,func,scope);}return rv;}if(settings.collect&&(target===doc||target===win)){boundEvents.push([target,name,func,scope]);}var output=events.bind(target,name,func,scope||self);return output;};var _unbind=function unbind(target,name,func){if(Tools.isArray(target)){var i=target.length;var rv=[];while(i--){rv[i]=_unbind(target[i],name,func);}return rv;}else{if(boundEvents.length>0&&(target===doc||target===win)){var i=boundEvents.length;while(i--){var item=boundEvents[i];if(target===item[0]&&(!name||name===item[1])&&(!func||func===item[2])){events.unbind(item[0],item[1],item[2]);}}}return events.unbind(target,name,func);}};var fire=function fire(target,name,evt){return events.fire(target,name,evt);};var getContentEditable=function getContentEditable(node){if(node&&isElement$5(node)){var contentEditable=node.getAttribute('data-mce-contenteditable');if(contentEditable&&contentEditable!=='inherit'){return contentEditable;}return node.contentEditable!=='inherit'?node.contentEditable:null;}else{return null;}};var getContentEditableParent=function getContentEditableParent(node){var root=getRoot();var state=null;for(;node&&node!==root;node=node.parentNode){state=getContentEditable(node);if(state!==null){break;}}return state;};var destroy=function destroy(){if(boundEvents.length>0){var i=boundEvents.length;while(i--){var item=boundEvents[i];events.unbind(item[0],item[1],item[2]);}}each$j(files,function(_,url){styleSheetLoader.unload(url);delete files[url];});if(Sizzle.setDocument){Sizzle.setDocument();}};var isChildOf=function isChildOf(node,parent){if(!isIE){return node===parent||parent.contains(node);}else{while(node){if(parent===node){return true;}node=node.parentNode;}return false;}};var dumpRng=function dumpRng(r){return'startContainer: '+r.startContainer.nodeName+', startOffset: '+r.startOffset+', endContainer: '+r.endContainer.nodeName+', endOffset: '+r.endOffset;};var self={doc:doc,settings:settings,win:win,files:files,stdMode:stdMode,boxModel:boxModel,styleSheetLoader:styleSheetLoader,boundEvents:boundEvents,styles:styles,schema:schema,events:events,isBlock:isBlock,$:$,$$:$$,root:null,clone:clone,getRoot:getRoot,getViewPort:getViewPort,getRect:getRect,getSize:getSize,getParent:getParent,getParents:getParents,get:get,getNext:getNext,getPrev:getPrev,select:select,is:is,add:add,create:create,createHTML:createHTML,createFragment:createFragment,remove:remove,setStyle:setStyle,getStyle:getStyle,setStyles:setStyles,removeAllAttribs:removeAllAttribs,setAttrib:setAttrib,setAttribs:setAttribs,getAttrib:getAttrib,getPos:getPos$1,parseStyle:parseStyle,serializeStyle:serializeStyle,addStyle:addStyle,loadCSS:loadCSS,addClass:addClass,removeClass:removeClass,hasClass:hasClass,toggleClass:toggleClass,show:show,hide:hide,isHidden:isHidden,uniqueId:uniqueId,setHTML:setHTML,getOuterHTML:getOuterHTML,setOuterHTML:setOuterHTML,decode:decode,encode:encode,insertAfter:insertAfter,replace:replace,rename:rename,findCommonAncestor:findCommonAncestor,toHex:toHex,run:run,getAttribs:getAttribs,isEmpty:isEmpty,createRng:createRng,nodeIndex:findNodeIndex,split:split,bind:_bind,unbind:_unbind,fire:fire,getContentEditable:getContentEditable,getContentEditableParent:getContentEditableParent,destroy:destroy,isChildOf:isChildOf,dumpRng:dumpRng};var attrHooks=setupAttrHooks(styles,settings,constant(self));return self;};_DOMUtils.DOM=_DOMUtils(document);_DOMUtils.nodeIndex=findNodeIndex;var DOM$a=_DOMUtils.DOM;var each$e=Tools.each,grep=Tools.grep;var QUEUED=0;var LOADING=1;var LOADED=2;var FAILED=3;var ScriptLoader=function(){function ScriptLoader(settings){if(settings===void 0){settings={};}this.states={};this.queue=[];this.scriptLoadedCallbacks={};this.queueLoadedCallbacks=[];this.loading=0;this.settings=settings;}ScriptLoader.prototype._setReferrerPolicy=function(referrerPolicy){this.settings.referrerPolicy=referrerPolicy;};ScriptLoader.prototype.loadScript=function(url,success,failure){var dom=DOM$a;var elm;var cleanup=function cleanup(){dom.remove(id);if(elm){elm.onerror=elm.onload=elm=null;}};var done=function done(){cleanup();success();};var error=function error(){cleanup();if(isFunction(failure)){failure();}else{if(typeof console!=='undefined'&&console.log){console.log('Failed to load script: '+url);}}};var id=dom.uniqueId();elm=document.createElement('script');elm.id=id;elm.type='text/javascript';elm.src=Tools._addCacheSuffix(url);if(this.settings.referrerPolicy){dom.setAttrib(elm,'referrerpolicy',this.settings.referrerPolicy);}elm.onload=done;elm.onerror=error;(document.getElementsByTagName('head')[0]||document.body).appendChild(elm);};ScriptLoader.prototype.isDone=function(url){return this.states[url]===LOADED;};ScriptLoader.prototype.markDone=function(url){this.states[url]=LOADED;};ScriptLoader.prototype.add=function(url,success,scope,failure){var state=this.states[url];this.queue.push(url);if(state===undefined){this.states[url]=QUEUED;}if(success){if(!this.scriptLoadedCallbacks[url]){this.scriptLoadedCallbacks[url]=[];}this.scriptLoadedCallbacks[url].push({success:success,failure:failure,scope:scope||this});}};ScriptLoader.prototype.load=function(url,success,scope,failure){return this.add(url,success,scope,failure);};ScriptLoader.prototype.remove=function(url){delete this.states[url];delete this.scriptLoadedCallbacks[url];};ScriptLoader.prototype.loadQueue=function(success,scope,failure){this.loadScripts(this.queue,success,scope,failure);};ScriptLoader.prototype.loadScripts=function(scripts,success,scope,failure){var self=this;var failures=[];var execCallbacks=function execCallbacks(name,url){each$e(self.scriptLoadedCallbacks[url],function(callback){if(isFunction(callback[name])){callback[name].call(callback.scope);}});self.scriptLoadedCallbacks[url]=undefined;};self.queueLoadedCallbacks.push({success:success,failure:failure,scope:scope||this});var _loadScripts=function loadScripts(){var loadingScripts=grep(scripts);scripts.length=0;each$e(loadingScripts,function(url){if(self.states[url]===LOADED){execCallbacks('success',url);return;}if(self.states[url]===FAILED){execCallbacks('failure',url);return;}if(self.states[url]!==LOADING){self.states[url]=LOADING;self.loading++;self.loadScript(url,function(){self.states[url]=LOADED;self.loading--;execCallbacks('success',url);_loadScripts();},function(){self.states[url]=FAILED;self.loading--;failures.push(url);execCallbacks('failure',url);_loadScripts();});}});if(!self.loading){var notifyCallbacks=self.queueLoadedCallbacks.slice(0);self.queueLoadedCallbacks.length=0;each$e(notifyCallbacks,function(callback){if(failures.length===0){if(isFunction(callback.success)){callback.success.call(callback.scope);}}else{if(isFunction(callback.failure)){callback.failure.call(callback.scope,failures);}}});}};_loadScripts();};ScriptLoader.ScriptLoader=new ScriptLoader();return ScriptLoader;}();var Cell=function Cell(initial){var value=initial;var get=function get(){return value;};var set=function set(v){value=v;};return{get:get,set:set};};var isRaw=function isRaw(str){return isObject(str)&&has$2(str,'raw');};var isTokenised=function isTokenised(str){return isArray$1(str)&&str.length>1;};var data={};var currentCode=Cell('en');var getLanguageData=function getLanguageData(){return get$9(data,currentCode.get());};var getData=function getData(){return map$2(data,function(value){return _assign({},value);});};var setCode=function setCode(newCode){if(newCode){currentCode.set(newCode);}};var getCode=function getCode(){return currentCode.get();};var add$4=function add$4(code,items){var langData=data[code];if(!langData){data[code]=langData={};}each$j(items,function(translation,name){langData[name.toLowerCase()]=translation;});};var translate=function translate(text){var langData=getLanguageData().getOr({});var toString=function toString(obj){if(isFunction(obj)){return Object.prototype.toString.call(obj);}return!isEmpty(obj)?''+obj:'';};var isEmpty=function isEmpty(text){return text===''||text===null||text===undefined;};var getLangData=function getLangData(text){var textstr=toString(text);return get$9(langData,textstr.toLowerCase()).map(toString).getOr(textstr);};var removeContext=function removeContext(str){return str.replace(/{context:\\w+}$/,'');};if(isEmpty(text)){return'';}if(isRaw(text)){return toString(text.raw);}if(isTokenised(text)){var values_1=text.slice(1);var substitued=getLangData(text[0]).replace(/\\{([0-9]+)\\}/g,function($1,$2){return has$2(values_1,$2)?toString(values_1[$2]):$1;});return removeContext(substitued);}return removeContext(getLangData(text));};var isRtl$1=function isRtl$1(){return getLanguageData().bind(function(items){return get$9(items,'_dir');}).exists(function(dir){return dir==='rtl';});};var hasCode=function hasCode(code){return has$2(data,code);};var I18n={getData:getData,setCode:setCode,getCode:getCode,add:add$4,translate:translate,isRtl:isRtl$1,hasCode:hasCode};var _AddOnManager=function AddOnManager(){var items=[];var urls={};var lookup={};var _listeners=[];var runListeners=function runListeners(name,state){var matchedListeners=filter$4(_listeners,function(listener){return listener.name===name&&listener.state===state;});each$k(matchedListeners,function(listener){return listener.callback();});};var get=function get(name){if(lookup[name]){return lookup[name].instance;}return undefined;};var dependencies=function dependencies(name){var result;if(lookup[name]){result=lookup[name].dependencies;}return result||[];};var requireLangPack=function requireLangPack(name,languages){if(_AddOnManager.languageLoad!==false){waitFor(name,function(){var language=I18n.getCode();var wrappedLanguages=','+(languages||'')+',';if(!language||languages&&wrappedLanguages.indexOf(','+language+',')===-1){return;}ScriptLoader.ScriptLoader.add(urls[name]+'/langs/'+language+'.js');},'loaded');}};var add=function add(id,addOn,dependencies){var addOnConstructor=addOn;items.push(addOnConstructor);lookup[id]={instance:addOnConstructor,dependencies:dependencies};runListeners(id,'added');return addOnConstructor;};var remove=function remove(name){delete urls[name];delete lookup[name];};var createUrl=function createUrl(baseUrl,dep){if(typeof dep==='object'){return dep;}return typeof baseUrl==='string'?{prefix:'',resource:dep,suffix:''}:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix};};var addComponents=function addComponents(pluginName,scripts){var pluginUrl=urls[pluginName];each$k(scripts,function(script){ScriptLoader.ScriptLoader.add(pluginUrl+'/'+script);});};var loadDependencies=function loadDependencies(name,addOnUrl,success,scope){var deps=dependencies(name);each$k(deps,function(dep){var newUrl=createUrl(addOnUrl,dep);load(newUrl.resource,newUrl,undefined,undefined);});if(success){if(scope){success.call(scope);}else{success.call(ScriptLoader);}}};var load=function load(name,addOnUrl,success,scope,failure){if(urls[name]){return;}var urlString=typeof addOnUrl==='string'?addOnUrl:addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix;if(urlString.indexOf('/')!==0&&urlString.indexOf('://')===-1){urlString=_AddOnManager.baseURL+'/'+urlString;}urls[name]=urlString.substring(0,urlString.lastIndexOf('/'));var done=function done(){runListeners(name,'loaded');loadDependencies(name,addOnUrl,success,scope);};if(lookup[name]){done();}else{ScriptLoader.ScriptLoader.add(urlString,done,scope,failure);}};var waitFor=function waitFor(name,callback,state){if(state===void 0){state='added';}if(has$2(lookup,name)&&state==='added'){callback();}else if(has$2(urls,name)&&state==='loaded'){callback();}else{_listeners.push({name:name,state:state,callback:callback});}};return{items:items,urls:urls,lookup:lookup,_listeners:_listeners,get:get,dependencies:dependencies,requireLangPack:requireLangPack,add:add,remove:remove,createUrl:createUrl,addComponents:addComponents,load:load,waitFor:waitFor};};_AddOnManager.languageLoad=true;_AddOnManager.baseURL='';_AddOnManager.PluginManager=_AddOnManager();_AddOnManager.ThemeManager=_AddOnManager();var singleton=function singleton(doRevoke){var subject=Cell(Optional.none());var revoke=function revoke(){return subject.get().each(doRevoke);};var clear=function clear(){revoke();subject.set(Optional.none());};var isSet=function isSet(){return subject.get().isSome();};var get=function get(){return subject.get();};var set=function set(s){revoke();subject.set(Optional.some(s));};return{clear:clear,isSet:isSet,get:get,set:set};};var value=function value(){var subject=singleton(noop);var on=function on(f){return subject.get().each(f);};return _assign(_assign({},subject),{on:on});};var first=function first(fn,rate){var timer=null;var cancel=function cancel(){if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}if(isNull(timer)){timer=setTimeout(function(){timer=null;fn.apply(null,args);},rate);}};return{cancel:cancel,throttle:throttle};};var last=function last(fn,rate){var timer=null;var cancel=function cancel(){if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}cancel();timer=setTimeout(function(){timer=null;fn.apply(null,args);},rate);};return{cancel:cancel,throttle:throttle};};var read$4=function read$4(element,attr){var value=get$6(element,attr);return value===undefined||value===''?[]:value.split(' ');};var add$3=function add$3(element,attr,id){var old=read$4(element,attr);var nu=old.concat([id]);set$1(element,attr,nu.join(' '));return true;};var remove$5=function remove$5(element,attr,id){var nu=filter$4(read$4(element,attr),function(v){return v!==id;});if(nu.length>0){set$1(element,attr,nu.join(' '));}else{remove$6(element,attr);}return false;};var supports=function supports(element){return element.dom.classList!==undefined;};var get$4=function get$4(element){return read$4(element,'class');};var add$2=function add$2(element,clazz){return add$3(element,'class',clazz);};var remove$4=function remove$4(element,clazz){return remove$5(element,'class',clazz);};var add$1=function add$1(element,clazz){if(supports(element)){element.dom.classList.add(clazz);}else{add$2(element,clazz);}};var cleanClass=function cleanClass(element){var classList=supports(element)?element.dom.classList:get$4(element);if(classList.length===0){remove$6(element,'class');}};var remove$3=function remove$3(element,clazz){if(supports(element)){var classList=element.dom.classList;classList.remove(clazz);}else{remove$4(element,clazz);}cleanClass(element);};var has=function has(element,clazz){return supports(element)&&element.dom.classList.contains(clazz);};var _descendants$=function descendants$1(scope,predicate){var result=[];each$k(children(scope),function(x){if(predicate(x)){result=result.concat([x]);}result=result.concat(_descendants$(x,predicate));});return result;};var descendants=function descendants(scope,selector){return all(selector,scope);};var annotation=constant('mce-annotation');var dataAnnotation=constant('data-mce-annotation');var dataAnnotationId=constant('data-mce-annotation-uid');var identify=function identify(editor,annotationName){var rng=editor.selection.getRng();var start=SugarElement.fromDom(rng.startContainer);var root=SugarElement.fromDom(editor.getBody());var selector=annotationName.fold(function(){return'.'+annotation();},function(an){return'['+dataAnnotation()+'=\"'+an+'\"]';});var newStart=child$1(start,rng.startOffset).getOr(start);var closest=closest$2(newStart,selector,function(n){return eq(n,root);});var getAttr=function getAttr(c,property){if(has$1(c,property)){return Optional.some(get$6(c,property));}else{return Optional.none();}};return closest.bind(function(c){return getAttr(c,''+dataAnnotationId()).bind(function(uid){return getAttr(c,''+dataAnnotation()).map(function(name){var elements=findMarkers(editor,uid);return{uid:uid,name:name,elements:elements};});});});};var isAnnotation=function isAnnotation(elem){return isElement$6(elem)&&has(elem,annotation());};var findMarkers=function findMarkers(editor,uid){var body=SugarElement.fromDom(editor.getBody());return descendants(body,'['+dataAnnotationId()+'=\"'+uid+'\"]');};var findAll=function findAll(editor,name){var body=SugarElement.fromDom(editor.getBody());var markers=descendants(body,'['+dataAnnotation()+'=\"'+name+'\"]');var directory={};each$k(markers,function(m){var uid=get$6(m,dataAnnotationId());var nodesAlready=get$9(directory,uid).getOr([]);directory[uid]=nodesAlready.concat([m]);});return directory;};var setup$n=function setup$n(editor,_registry){var changeCallbacks=Cell({});var initData=function initData(){return{listeners:[],previous:value()};};var withCallbacks=function withCallbacks(name,f){updateCallbacks(name,function(data){f(data);return data;});};var updateCallbacks=function updateCallbacks(name,f){var callbackMap=changeCallbacks.get();var data=get$9(callbackMap,name).getOrThunk(initData);var outputData=f(data);callbackMap[name]=outputData;changeCallbacks.set(callbackMap);};var fireCallbacks=function fireCallbacks(name,uid,elements){withCallbacks(name,function(data){each$k(data.listeners,function(f){return f(true,name,{uid:uid,nodes:map$3(elements,function(elem){return elem.dom;})});});});};var fireNoAnnotation=function fireNoAnnotation(name){withCallbacks(name,function(data){each$k(data.listeners,function(f){return f(false,name);});});};var onNodeChange=last(function(){var callbackMap=changeCallbacks.get();var annotations=sort(keys(callbackMap));each$k(annotations,function(name){updateCallbacks(name,function(data){var prev=data.previous.get();identify(editor,Optional.some(name)).fold(function(){if(prev.isSome()){fireNoAnnotation(name);data.previous.clear();}},function(_a){var uid=_a.uid,name=_a.name,elements=_a.elements;if(!is$1(prev,uid)){fireCallbacks(name,uid,elements);data.previous.set(uid);}});return{previous:data.previous,listeners:data.listeners};});});},30);editor.on('remove',function(){onNodeChange.cancel();});editor.on('NodeChange',function(){onNodeChange.throttle();});var addListener=function addListener(name,f){updateCallbacks(name,function(data){return{previous:data.previous,listeners:data.listeners.concat([f])};});};return{addListener:addListener};};var setup$m=function setup$m(editor,registry){var identifyParserNode=function identifyParserNode(span){return Optional.from(span.attr(dataAnnotation())).bind(registry.lookup);};editor.on('init',function(){editor.serializer.addNodeFilter('span',function(spans){each$k(spans,function(span){identifyParserNode(span).each(function(settings){if(settings.persistent===false){span.unwrap();}});});});});};var create$7=function create$7(){var annotations={};var register=function register(name,settings){annotations[name]={name:name,settings:settings};};var lookup=function lookup(name){return get$9(annotations,name).map(function(a){return a.settings;});};return{register:register,lookup:lookup};};var unique=0;var generate=function generate(prefix){var date=new Date();var time=date.getTime();var random=Math.floor(Math.random()*1000000000);unique++;return prefix+'_'+random+unique+String(time);};var add=function add(element,classes){each$k(classes,function(x){add$1(element,x);});};var fromHtml=function fromHtml(html,scope){var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;return children(SugarElement.fromDom(div));};var fromDom$1=function fromDom$1(nodes){return map$3(nodes,SugarElement.fromDom);};var get$3=function get$3(element){return element.dom.innerHTML;};var set=function set(element,content){var owner=owner$1(element);var docDom=owner.dom;var fragment=SugarElement.fromDom(docDom.createDocumentFragment());var contentElements=fromHtml(content,docDom);append(fragment,contentElements);empty(element);append$1(element,fragment);};var clone$1=function clone$1(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep));};var shallow=function shallow(original){return clone$1(original,false);};var deep$1=function deep$1(original){return clone$1(original,true);};var TextWalker=function TextWalker(startNode,rootNode,isBoundary){if(isBoundary===void 0){isBoundary=never;}var walker=new DomTreeWalker(startNode,rootNode);var walk=function walk(direction){var next;do{next=walker[direction]();}while(next&&!isText$7(next)&&!isBoundary(next));return Optional.from(next).filter(isText$7);};return{current:function current(){return Optional.from(walker.current()).filter(isText$7);},next:function next(){return walk('next');},prev:function prev(){return walk('prev');},prev2:function prev2(){return walk('prev2');}};};var TextSeeker=function TextSeeker(dom,isBoundary){var isBlockBoundary=isBoundary?isBoundary:function(node){return dom.isBlock(node)||isBr$5(node)||isContentEditableFalse$b(node);};var _walk=function walk(node,offset,walker,process){if(isText$7(node)){var newOffset=process(node,offset,node.data);if(newOffset!==-1){return Optional.some({container:node,offset:newOffset});}}return walker().bind(function(next){return _walk(next.container,next.offset,walker,process);});};var backwards=function backwards(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return _walk(node,offset,function(){return walker.prev().map(function(prev){return{container:prev,offset:prev.length};});},process).getOrNull();};var forwards=function forwards(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return _walk(node,offset,function(){return walker.next().map(function(next){return{container:next,offset:0};});},process).getOrNull();};return{backwards:backwards,forwards:forwards};};var round$2=Math.round;var clone=function clone(rect){if(!rect){return{left:0,top:0,bottom:0,right:0,width:0,height:0};}return{left:round$2(rect.left),top:round$2(rect.top),bottom:round$2(rect.bottom),right:round$2(rect.right),width:round$2(rect.width),height:round$2(rect.height)};};var collapse=function collapse(rect,toStart){rect=clone(rect);if(toStart){rect.right=rect.left;}else{rect.left=rect.left+rect.width;rect.right=rect.left;}rect.width=0;return rect;};var isEqual=function isEqual(rect1,rect2){return rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right;};var isValidOverflow=function isValidOverflow(overflowY,rect1,rect2){return overflowY>=0&&overflowY<=Math.min(rect1.height,rect2.height)/2;};var isAbove$1=function isAbove$1(rect1,rect2){var halfHeight=Math.min(rect2.height/2,rect1.height/2);if(rect1.bottom-halfHeight<rect2.top){return true;}if(rect1.top>rect2.bottom){return false;}return isValidOverflow(rect2.top-rect1.bottom,rect1,rect2);};var isBelow$1=function isBelow$1(rect1,rect2){if(rect1.top>rect2.bottom){return true;}if(rect1.bottom<rect2.top){return false;}return isValidOverflow(rect2.bottom-rect1.top,rect1,rect2);};var containsXY=function containsXY(rect,clientX,clientY){return clientX>=rect.left&&clientX<=rect.right&&clientY>=rect.top&&clientY<=rect.bottom;};var clamp$2=function clamp$2(value,min,max){return Math.min(Math.max(value,min),max);};var getSelectedNode=function getSelectedNode(range){var startContainer=range.startContainer,startOffset=range.startOffset;if(startContainer.hasChildNodes()&&range.endOffset===startOffset+1){return startContainer.childNodes[startOffset];}return null;};var getNode$1=function getNode$1(container,offset){if(isElement$5(container)&&container.hasChildNodes()){var childNodes=container.childNodes;var safeOffset=clamp$2(offset,0,childNodes.length-1);return childNodes[safeOffset];}else{return container;}};var getNodeUnsafe=function getNodeUnsafe(container,offset){if(offset<0&&isElement$5(container)&&container.hasChildNodes()){return undefined;}else{return getNode$1(container,offset);}};var extendingChars=new RegExp('[\\u0300-\\u036f\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1-\\u05c2\\u05c4-\\u05c5\\u05c7\\u0610-\\u061a'+'\\u064b-\\u065f\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7-\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0'+'\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e3-\\u0902\\u093a\\u093c'+'\\u0941-\\u0948\\u094d\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2-\\u09e3'+'\\u0a01-\\u0a02\\u0a3c\\u0a41-\\u0a42\\u0a47-\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70-\\u0a71\\u0a75\\u0a81-\\u0a82\\u0abc'+'\\u0ac1-\\u0ac5\\u0ac7-\\u0ac8\\u0acd\\u0ae2-\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57'+'\\u0b62-\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c00\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55-\\u0c56'+'\\u0c62-\\u0c63\\u0c81\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc-\\u0ccd\\u0cd5-\\u0cd6\\u0ce2-\\u0ce3\\u0d01\\u0d3e\\u0d41-\\u0d44'+'\\u0d4d\\u0d57\\u0d62-\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9'+'\\u0ebb-\\u0ebc\\u0ec8-\\u0ecd\\u0f18-\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97'+'\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039-\\u103a\\u103d-\\u103e\\u1058-\\u1059\\u105e-\\u1060\\u1071-\\u1074'+'\\u1082\\u1085-\\u1086\\u108d\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17b4-\\u17b5'+'\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193b\\u1a17-\\u1a18'+'\\u1a1b\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1ab0-\\u1abd\\u1ABE\\u1b00-\\u1b03\\u1b34'+'\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80-\\u1b81\\u1ba2-\\u1ba5\\u1ba8-\\u1ba9\\u1bab-\\u1bad\\u1be6\\u1be8-\\u1be9'+'\\u1bed\\u1bef-\\u1bf1\\u1c2c-\\u1c33\\u1c36-\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1cf4\\u1cf8-\\u1cf9'+'\\u1dc0-\\u1df5\\u1dfc-\\u1dff\\u200c-\\u200d\\u20d0-\\u20dc\\u20DD-\\u20E0\\u20e1\\u20E2-\\u20E4\\u20e5-\\u20f0\\u2cef-\\u2cf1'+'\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302d\\u302e-\\u302f\\u3099-\\u309a\\ua66f\\uA670-\\uA672\\ua674-\\ua67d\\ua69e-\\ua69f\\ua6f0-\\ua6f1'+'\\ua802\\ua806\\ua80b\\ua825-\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc'+'\\ua9e5\\uaa29-\\uaa2e\\uaa31-\\uaa32\\uaa35-\\uaa36\\uaa43\\uaa4c\\uaa7c\\uaab0\\uaab2-\\uaab4\\uaab7-\\uaab8\\uaabe-\\uaabf\\uaac1'+'\\uaaec-\\uaaed\\uaaf6\\uabe5\\uabe8\\uabed\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe2f\\uff9e-\\uff9f]');var isExtendingChar=function isExtendingChar(ch){return typeof ch==='string'&&ch.charCodeAt(0)>=768&&extendingChars.test(ch);};var or=function or(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}return function(x){for(var i=0;i<args.length;i++){if(args[i](x)){return true;}}return false;};};var and=function and(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}return function(x){for(var i=0;i<args.length;i++){if(!args[i](x)){return false;}}return true;};};var isElement$3=isElement$5;var isCaretCandidate$2=isCaretCandidate$3;var isBlock$1=matchStyleValues('display','block table');var isFloated=matchStyleValues('float','left right');var isValidElementCaretCandidate=and(isElement$3,isCaretCandidate$2,not(isFloated));var isNotPre=not(matchStyleValues('white-space','pre pre-line pre-wrap'));var isText$4=isText$7;var isBr$2=isBr$5;var nodeIndex$1=_DOMUtils.nodeIndex;var resolveIndex$1=getNodeUnsafe;var createRange$1=function createRange$1(doc){return'createRange'in doc?doc.createRange():_DOMUtils.DOM.createRng();};var isWhiteSpace$1=function isWhiteSpace$1(chr){return chr&&/[\\r\\n\\t ]/.test(chr);};var isRange=function isRange(rng){return!!rng.setStart&&!!rng.setEnd;};var isHiddenWhiteSpaceRange=function isHiddenWhiteSpaceRange(range){var container=range.startContainer;var offset=range.startOffset;if(isWhiteSpace$1(range.toString())&&isNotPre(container.parentNode)&&isText$7(container)){var text=container.data;if(isWhiteSpace$1(text[offset-1])||isWhiteSpace$1(text[offset+1])){return true;}}return false;};var getBrClientRect=function getBrClientRect(brNode){var doc=brNode.ownerDocument;var rng=createRange$1(doc);var nbsp$1=doc.createTextNode(nbsp);var parentNode=brNode.parentNode;parentNode.insertBefore(nbsp$1,brNode);rng.setStart(nbsp$1,0);rng.setEnd(nbsp$1,1);var clientRect=clone(rng.getBoundingClientRect());parentNode.removeChild(nbsp$1);return clientRect;};var getBoundingClientRectWebKitText=function getBoundingClientRectWebKitText(rng){var sc=rng.startContainer;var ec=rng.endContainer;var so=rng.startOffset;var eo=rng.endOffset;if(sc===ec&&isText$7(ec)&&so===0&&eo===1){var newRng=rng.cloneRange();newRng.setEndAfter(ec);return getBoundingClientRect$1(newRng);}else{return null;}};var isZeroRect=function isZeroRect(r){return r.left===0&&r.right===0&&r.top===0&&r.bottom===0;};var getBoundingClientRect$1=function getBoundingClientRect$1(item){var clientRect;var clientRects=item.getClientRects();if(clientRects.length>0){clientRect=clone(clientRects[0]);}else{clientRect=clone(item.getBoundingClientRect());}if(!isRange(item)&&isBr$2(item)&&isZeroRect(clientRect)){return getBrClientRect(item);}if(isZeroRect(clientRect)&&isRange(item)){return getBoundingClientRectWebKitText(item);}return clientRect;};var collapseAndInflateWidth=function collapseAndInflateWidth(clientRect,toStart){var newClientRect=collapse(clientRect,toStart);newClientRect.width=1;newClientRect.right=newClientRect.left+1;return newClientRect;};var getCaretPositionClientRects=function getCaretPositionClientRects(caretPosition){var clientRects=[];var addUniqueAndValidRect=function addUniqueAndValidRect(clientRect){if(clientRect.height===0){return;}if(clientRects.length>0){if(isEqual(clientRect,clientRects[clientRects.length-1])){return;}}clientRects.push(clientRect);};var addCharacterOffset=function addCharacterOffset(container,offset){var range=createRange$1(container.ownerDocument);if(offset<container.data.length){if(isExtendingChar(container.data[offset])){return clientRects;}if(isExtendingChar(container.data[offset-1])){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),false));return clientRects;}}}if(offset>0){range.setStart(container,offset-1);range.setEnd(container,offset);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),false));}}if(offset<container.data.length){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),true));}}};var container=caretPosition.container();var offset=caretPosition.offset();if(isText$4(container)){addCharacterOffset(container,offset);return clientRects;}if(isElement$3(container)){if(caretPosition.isAtEnd()){var node=resolveIndex$1(container,offset);if(isText$4(node)){addCharacterOffset(node,node.data.length);}if(isValidElementCaretCandidate(node)&&!isBr$2(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),false));}}else{var node=resolveIndex$1(container,offset);if(isText$4(node)){addCharacterOffset(node,0);}if(isValidElementCaretCandidate(node)&&caretPosition.isAtEnd()){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),false));return clientRects;}var beforeNode=resolveIndex$1(caretPosition.container(),caretPosition.offset()-1);if(isValidElementCaretCandidate(beforeNode)&&!isBr$2(beforeNode)){if(isBlock$1(beforeNode)||isBlock$1(node)||!isValidElementCaretCandidate(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(beforeNode),false));}}if(isValidElementCaretCandidate(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),true));}}}return clientRects;};var _CaretPosition=function CaretPosition(container,offset,clientRects){var isAtStart=function isAtStart(){if(isText$4(container)){return offset===0;}return offset===0;};var isAtEnd=function isAtEnd(){if(isText$4(container)){return offset>=container.data.length;}return offset>=container.childNodes.length;};var toRange=function toRange(){var range=createRange$1(container.ownerDocument);range.setStart(container,offset);range.setEnd(container,offset);return range;};var getClientRects=function getClientRects(){if(!clientRects){clientRects=getCaretPositionClientRects(_CaretPosition(container,offset));}return clientRects;};var isVisible=function isVisible(){return getClientRects().length>0;};var isEqual=function isEqual(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset();};var getNode=function getNode(before){return resolveIndex$1(container,before?offset-1:offset);};return{container:constant(container),offset:constant(offset),toRange:toRange,getClientRects:getClientRects,isVisible:isVisible,isAtStart:isAtStart,isAtEnd:isAtEnd,isEqual:isEqual,getNode:getNode};};_CaretPosition.fromRangeStart=function(range){return _CaretPosition(range.startContainer,range.startOffset);};_CaretPosition.fromRangeEnd=function(range){return _CaretPosition(range.endContainer,range.endOffset);};_CaretPosition.after=function(node){return _CaretPosition(node.parentNode,nodeIndex$1(node)+1);};_CaretPosition.before=function(node){return _CaretPosition(node.parentNode,nodeIndex$1(node));};_CaretPosition.isAbove=function(pos1,pos2){return lift2(head(pos2.getClientRects()),last$2(pos1.getClientRects()),isAbove$1).getOr(false);};_CaretPosition.isBelow=function(pos1,pos2){return lift2(last$2(pos2.getClientRects()),head(pos1.getClientRects()),isBelow$1).getOr(false);};_CaretPosition.isAtStart=function(pos){return pos?pos.isAtStart():false;};_CaretPosition.isAtEnd=function(pos){return pos?pos.isAtEnd():false;};_CaretPosition.isTextPosition=function(pos){return pos?isText$7(pos.container()):false;};_CaretPosition.isElementPosition=function(pos){return _CaretPosition.isTextPosition(pos)===false;};var trimEmptyTextNode$1=function trimEmptyTextNode$1(dom,node){if(isText$7(node)&&node.data.length===0){dom.remove(node);}};var insertNode=function insertNode(dom,rng,node){rng.insertNode(node);trimEmptyTextNode$1(dom,node.previousSibling);trimEmptyTextNode$1(dom,node.nextSibling);};var insertFragment=function insertFragment(dom,rng,frag){var firstChild=Optional.from(frag.firstChild);var lastChild=Optional.from(frag.lastChild);rng.insertNode(frag);firstChild.each(function(child){return trimEmptyTextNode$1(dom,child.previousSibling);});lastChild.each(function(child){return trimEmptyTextNode$1(dom,child.nextSibling);});};var rangeInsertNode=function rangeInsertNode(dom,rng,node){if(isDocumentFragment(node)){insertFragment(dom,rng,node);}else{insertNode(dom,rng,node);}};var isText$3=isText$7;var isBogus=isBogus$2;var nodeIndex=_DOMUtils.nodeIndex;var _normalizedParent=function normalizedParent(node){var parentNode=node.parentNode;if(isBogus(parentNode)){return _normalizedParent(parentNode);}return parentNode;};var _getChildNodes=function getChildNodes(node){if(!node){return[];}return reduce(node.childNodes,function(result,node){if(isBogus(node)&&node.nodeName!=='BR'){result=result.concat(_getChildNodes(node));}else{result.push(node);}return result;},[]);};var normalizedTextOffset=function normalizedTextOffset(node,offset){while(node=node.previousSibling){if(!isText$3(node)){break;}offset+=node.data.length;}return offset;};var equal=function equal(a){return function(b){return a===b;};};var normalizedNodeIndex=function normalizedNodeIndex(node){var nodes,index;nodes=_getChildNodes(_normalizedParent(node));index=findIndex$1(nodes,equal(node),node);nodes=nodes.slice(0,index+1);var numTextFragments=reduce(nodes,function(result,node,i){if(isText$3(node)&&isText$3(nodes[i-1])){result++;}return result;},0);nodes=filter$2(nodes,matchNodeNames([node.nodeName]));index=findIndex$1(nodes,equal(node),node);return index-numTextFragments;};var createPathItem=function createPathItem(node){var name;if(isText$3(node)){name='text()';}else{name=node.nodeName.toLowerCase();}return name+'['+normalizedNodeIndex(node)+']';};var parentsUntil$1=function parentsUntil$1(root,node,predicate){var parents=[];for(node=node.parentNode;node!==root;node=node.parentNode){if(predicate&&predicate(node)){break;}parents.push(node);}return parents;};var create$6=function create$6(root,caretPosition){var container,offset,path=[],outputOffset,childNodes,parents;container=caretPosition.container();offset=caretPosition.offset();if(isText$3(container)){outputOffset=normalizedTextOffset(container,offset);}else{childNodes=container.childNodes;if(offset>=childNodes.length){outputOffset='after';offset=childNodes.length-1;}else{outputOffset='before';}container=childNodes[offset];}path.push(createPathItem(container));parents=parentsUntil$1(root,container);parents=filter$2(parents,not(isBogus$2));path=path.concat(map$1(parents,function(node){return createPathItem(node);}));return path.reverse().join('/')+','+outputOffset;};var resolvePathItem=function resolvePathItem(node,name,index){var nodes=_getChildNodes(node);nodes=filter$2(nodes,function(node,index){return!isText$3(node)||!isText$3(nodes[index-1]);});nodes=filter$2(nodes,matchNodeNames([name]));return nodes[index];};var findTextPosition=function findTextPosition(container,offset){var node=container,targetOffset=0,dataLen;while(isText$3(node)){dataLen=node.data.length;if(offset>=targetOffset&&offset<=targetOffset+dataLen){container=node;offset=offset-targetOffset;break;}if(!isText$3(node.nextSibling)){container=node;offset=dataLen;break;}targetOffset+=dataLen;node=node.nextSibling;}if(isText$3(container)&&offset>container.data.length){offset=container.data.length;}return _CaretPosition(container,offset);};var resolve$2=function resolve$2(root,path){var offset;if(!path){return null;}var parts=path.split(',');var paths=parts[0].split('/');offset=parts.length>1?parts[1]:'before';var container=reduce(paths,function(result,value){var match=/([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);if(!match){return null;}if(match[1]==='text()'){match[1]='#text';}return resolvePathItem(result,match[1],parseInt(match[2],10));},root);if(!container){return null;}if(!isText$3(container)){if(offset==='after'){offset=nodeIndex(container)+1;}else{offset=nodeIndex(container);}return _CaretPosition(container.parentNode,offset);}return findTextPosition(container,parseInt(offset,10));};var isContentEditableFalse$9=isContentEditableFalse$b;var getNormalizedTextOffset=function getNormalizedTextOffset(trim,container,offset){var node,trimmedOffset;trimmedOffset=trim(container.data.slice(0,offset)).length;for(node=container.previousSibling;node&&isText$7(node);node=node.previousSibling){trimmedOffset+=trim(node.data).length;}return trimmedOffset;};var getPoint=function getPoint(dom,trim,normalized,rng,start){var container=rng[start?'startContainer':'endContainer'];var offset=rng[start?'startOffset':'endOffset'];var point=[];var childNodes,after=0;var root=dom.getRoot();if(isText$7(container)){point.push(normalized?getNormalizedTextOffset(trim,container,offset):offset);}else{childNodes=container.childNodes;if(offset>=childNodes.length&&childNodes.length){after=1;offset=Math.max(0,childNodes.length-1);}point.push(dom.nodeIndex(childNodes[offset],normalized)+after);}for(;container&&container!==root;container=container.parentNode){point.push(dom.nodeIndex(container,normalized));}return point;};var getLocation=function getLocation(trim,selection,normalized,rng){var dom=selection.dom,bookmark={};bookmark.start=getPoint(dom,trim,normalized,rng,true);if(!selection.isCollapsed()){bookmark.end=getPoint(dom,trim,normalized,rng,false);}if(isRangeInCaretContainerBlock(rng)){bookmark.isFakeCaret=true;}return bookmark;};var findIndex=function findIndex(dom,name,element){var count=0;Tools.each(dom.select(name),function(node){if(node.getAttribute('data-mce-bogus')==='all'){return;}if(node===element){return false;}count++;});return count;};var moveEndPoint$1=function moveEndPoint$1(rng,start){var container,offset,childNodes;var prefix=start?'start':'end';container=rng[prefix+'Container'];offset=rng[prefix+'Offset'];if(isElement$5(container)&&container.nodeName==='TR'){childNodes=container.childNodes;container=childNodes[Math.min(start?offset:offset-1,childNodes.length-1)];if(container){offset=start?0:container.childNodes.length;rng['set'+(start?'Start':'End')](container,offset);}}};var normalizeTableCellSelection=function normalizeTableCellSelection(rng){moveEndPoint$1(rng,true);moveEndPoint$1(rng,false);return rng;};var findSibling=function findSibling(node,offset){var sibling;if(isElement$5(node)){node=getNode$1(node,offset);if(isContentEditableFalse$9(node)){return node;}}if(isCaretContainer$2(node)){if(isText$7(node)&&isCaretContainerBlock$1(node)){node=node.parentNode;}sibling=node.previousSibling;if(isContentEditableFalse$9(sibling)){return sibling;}sibling=node.nextSibling;if(isContentEditableFalse$9(sibling)){return sibling;}}};var findAdjacentContentEditableFalseElm=function findAdjacentContentEditableFalseElm(rng){return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset);};var getOffsetBookmark=function getOffsetBookmark(trim,normalized,selection){var element=selection.getNode();var name=element?element.nodeName:null;var rng=selection.getRng();if(isContentEditableFalse$9(element)||name==='IMG'){return{name:name,index:findIndex(selection.dom,name,element)};}var sibling=findAdjacentContentEditableFalseElm(rng);if(sibling){name=sibling.tagName;return{name:name,index:findIndex(selection.dom,name,sibling)};}return getLocation(trim,selection,normalized,rng);};var getCaretBookmark=function getCaretBookmark(selection){var rng=selection.getRng();return{start:create$6(selection.dom.getRoot(),_CaretPosition.fromRangeStart(rng)),end:create$6(selection.dom.getRoot(),_CaretPosition.fromRangeEnd(rng))};};var getRangeBookmark=function getRangeBookmark(selection){return{rng:selection.getRng()};};var createBookmarkSpan=function createBookmarkSpan(dom,id,filled){var args={'data-mce-type':'bookmark',id:id,'style':'overflow:hidden;line-height:0px'};return filled?dom.create('span',args,'&#xFEFF;'):dom.create('span',args);};var getPersistentBookmark=function getPersistentBookmark(selection,filled){var dom=selection.dom;var rng=selection.getRng();var id=dom.uniqueId();var collapsed=selection.isCollapsed();var element=selection.getNode();var name=element.nodeName;if(name==='IMG'){return{name:name,index:findIndex(dom,name,element)};}var rng2=normalizeTableCellSelection(rng.cloneRange());if(!collapsed){rng2.collapse(false);var endBookmarkNode=createBookmarkSpan(dom,id+'_end',filled);rangeInsertNode(dom,rng2,endBookmarkNode);}rng=normalizeTableCellSelection(rng);rng.collapse(true);var startBookmarkNode=createBookmarkSpan(dom,id+'_start',filled);rangeInsertNode(dom,rng,startBookmarkNode);selection.moveToBookmark({id:id,keep:true});return{id:id};};var getBookmark$2=function getBookmark$2(selection,type,normalized){if(type===2){return getOffsetBookmark(trim$3,normalized,selection);}else if(type===3){return getCaretBookmark(selection);}else if(type){return getRangeBookmark(selection);}else{return getPersistentBookmark(selection,false);}};var getUndoBookmark=curry(getOffsetBookmark,identity,true);var DOM$9=_DOMUtils.DOM;var defaultPreviewStyles='font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow';var getBodySetting=function getBodySetting(editor,name,defaultValue){var value=editor.getParam(name,defaultValue);if(value.indexOf('=')!==-1){var bodyObj=editor.getParam(name,'','hash');return get$9(bodyObj,editor.id).getOr(defaultValue);}else{return value;}};var getIframeAttrs=function getIframeAttrs(editor){return editor.getParam('iframe_attrs',{});};var getDocType=function getDocType(editor){return editor.getParam('doctype','<!DOCTYPE html>');};var getDocumentBaseUrl=function getDocumentBaseUrl(editor){return editor.getParam('document_base_url','');};var getBodyId=function getBodyId(editor){return getBodySetting(editor,'body_id','tinymce');};var getBodyClass=function getBodyClass(editor){return getBodySetting(editor,'body_class','');};var getContentSecurityPolicy=function getContentSecurityPolicy(editor){return editor.getParam('content_security_policy','');};var shouldPutBrInPre$1=function shouldPutBrInPre$1(editor){return editor.getParam('br_in_pre',true);};var getForcedRootBlock=function getForcedRootBlock(editor){if(editor.getParam('force_p_newlines',false)){return'p';}var block=editor.getParam('forced_root_block','p');if(block===false){return'';}else if(block===true){return'p';}else{return block;}};var getForcedRootBlockAttrs=function getForcedRootBlockAttrs(editor){return editor.getParam('forced_root_block_attrs',{});};var getBrNewLineSelector=function getBrNewLineSelector(editor){return editor.getParam('br_newline_selector','.mce-toc h2,figcaption,caption');};var getNoNewLineSelector=function getNoNewLineSelector(editor){return editor.getParam('no_newline_selector','');};var shouldKeepStyles=function shouldKeepStyles(editor){return editor.getParam('keep_styles',true);};var shouldEndContainerOnEmptyBlock=function shouldEndContainerOnEmptyBlock(editor){return editor.getParam('end_container_on_empty_block',false);};var getFontStyleValues=function getFontStyleValues(editor){return Tools.explode(editor.getParam('font_size_style_values','xx-small,x-small,small,medium,large,x-large,xx-large'));};var getFontSizeClasses=function getFontSizeClasses(editor){return Tools.explode(editor.getParam('font_size_classes',''));};var getImagesDataImgFilter=function getImagesDataImgFilter(editor){return editor.getParam('images_dataimg_filter',always,'function');};var isAutomaticUploadsEnabled=function isAutomaticUploadsEnabled(editor){return editor.getParam('automatic_uploads',true,'boolean');};var shouldReuseFileName=function shouldReuseFileName(editor){return editor.getParam('images_reuse_filename',false,'boolean');};var shouldReplaceBlobUris=function shouldReplaceBlobUris(editor){return editor.getParam('images_replace_blob_uris',true,'boolean');};var getIconPackName=function getIconPackName(editor){return editor.getParam('icons','','string');};var getIconsUrl=function getIconsUrl(editor){return editor.getParam('icons_url','','string');};var getImageUploadUrl=function getImageUploadUrl(editor){return editor.getParam('images_upload_url','','string');};var getImageUploadBasePath=function getImageUploadBasePath(editor){return editor.getParam('images_upload_base_path','','string');};var getImagesUploadCredentials=function getImagesUploadCredentials(editor){return editor.getParam('images_upload_credentials',false,'boolean');};var getImagesUploadHandler=function getImagesUploadHandler(editor){return editor.getParam('images_upload_handler',null,'function');};var shouldUseContentCssCors=function shouldUseContentCssCors(editor){return editor.getParam('content_css_cors',false,'boolean');};var getReferrerPolicy=function getReferrerPolicy(editor){return editor.getParam('referrer_policy','','string');};var getLanguageCode=function getLanguageCode(editor){return editor.getParam('language','en','string');};var getLanguageUrl=function getLanguageUrl(editor){return editor.getParam('language_url','','string');};var shouldIndentUseMargin=function shouldIndentUseMargin(editor){return editor.getParam('indent_use_margin',false);};var getIndentation=function getIndentation(editor){return editor.getParam('indentation','40px','string');};var getContentCss=function getContentCss(editor){var contentCss=editor.getParam('content_css');if(isString$1(contentCss)){return map$3(contentCss.split(','),trim$5);}else if(isArray$1(contentCss)){return contentCss;}else if(contentCss===false||editor.inline){return[];}else{return['default'];}};var getFontCss=function getFontCss(editor){var fontCss=editor.getParam('font_css',[]);return isArray$1(fontCss)?fontCss:map$3(fontCss.split(','),trim$5);};var getDirectionality=function getDirectionality(editor){return editor.getParam('directionality',I18n.isRtl()?'rtl':undefined);};var getInlineBoundarySelector=function getInlineBoundarySelector(editor){return editor.getParam('inline_boundaries_selector','a[href],code,.mce-annotation','string');};var getObjectResizing=function getObjectResizing(editor){var selector=editor.getParam('object_resizing');if(selector===false||Env.iOS){return false;}else{return isString$1(selector)?selector:'table,img,figure.image,div,video,iframe';}};var getResizeImgProportional=function getResizeImgProportional(editor){return editor.getParam('resize_img_proportional',true,'boolean');};var getPlaceholder=function getPlaceholder(editor){return editor.getParam('placeholder',DOM$9.getAttrib(editor.getElement(),'placeholder'),'string');};var getEventRoot=function getEventRoot(editor){return editor.getParam('event_root');};var getServiceMessage=function getServiceMessage(editor){return editor.getParam('service_message');};var getTheme=function getTheme(editor){return editor.getParam('theme');};var shouldValidate=function shouldValidate(editor){return editor.getParam('validate');};var isInlineBoundariesEnabled=function isInlineBoundariesEnabled(editor){return editor.getParam('inline_boundaries')!==false;};var getFormats=function getFormats(editor){return editor.getParam('formats');};var getPreviewStyles=function getPreviewStyles(editor){var style=editor.getParam('preview_styles',defaultPreviewStyles);if(isString$1(style)){return style;}else{return'';}};var canFormatEmptyLines=function canFormatEmptyLines(editor){return editor.getParam('format_empty_lines',false,'boolean');};var getCustomUiSelector=function getCustomUiSelector(editor){return editor.getParam('custom_ui_selector','','string');};var getThemeUrl=function getThemeUrl(editor){return editor.getParam('theme_url');};var isInline=function isInline(editor){return editor.getParam('inline');};var hasHiddenInput=function hasHiddenInput(editor){return editor.getParam('hidden_input');};var shouldPatchSubmit=function shouldPatchSubmit(editor){return editor.getParam('submit_patch');};var isEncodingXml=function isEncodingXml(editor){return editor.getParam('encoding')==='xml';};var shouldAddFormSubmitTrigger=function shouldAddFormSubmitTrigger(editor){return editor.getParam('add_form_submit_trigger');};var shouldAddUnloadTrigger=function shouldAddUnloadTrigger(editor){return editor.getParam('add_unload_trigger');};var hasForcedRootBlock=function hasForcedRootBlock(editor){return getForcedRootBlock(editor)!=='';};var getCustomUndoRedoLevels=function getCustomUndoRedoLevels(editor){return editor.getParam('custom_undo_redo_levels',0,'number');};var shouldDisableNodeChange=function shouldDisableNodeChange(editor){return editor.getParam('disable_nodechange');};var isReadOnly$1=function isReadOnly$1(editor){return editor.getParam('readonly');};var hasContentCssCors=function hasContentCssCors(editor){return editor.getParam('content_css_cors');};var getPlugins=function getPlugins(editor){return editor.getParam('plugins','','string');};var getExternalPlugins$1=function getExternalPlugins$1(editor){return editor.getParam('external_plugins');};var shouldBlockUnsupportedDrop=function shouldBlockUnsupportedDrop(editor){return editor.getParam('block_unsupported_drop',true,'boolean');};var isVisualAidsEnabled=function isVisualAidsEnabled(editor){return editor.getParam('visual',true,'boolean');};var getVisualAidsTableClass=function getVisualAidsTableClass(editor){return editor.getParam('visual_table_class','mce-item-table','string');};var getVisualAidsAnchorClass=function getVisualAidsAnchorClass(editor){return editor.getParam('visual_anchor_class','mce-item-anchor','string');};var getIframeAriaText=function getIframeAriaText(editor){return editor.getParam('iframe_aria_text','Rich Text Area. Press ALT-0 for help.','string');};var isElement$2=isElement$5;var isText$2=isText$7;var removeNode$1=function removeNode$1(node){var parentNode=node.parentNode;if(parentNode){parentNode.removeChild(node);}};var trimCount=function trimCount(text){var trimmedText=trim$3(text);return{count:text.length-trimmedText.length,text:trimmedText};};var deleteZwspChars=function deleteZwspChars(caretContainer){var idx;while((idx=caretContainer.data.lastIndexOf(ZWSP$1))!==-1){caretContainer.deleteData(idx,1);}};var removeUnchanged=function removeUnchanged(caretContainer,pos){remove$2(caretContainer);return pos;};var removeTextAndReposition=function removeTextAndReposition(caretContainer,pos){var before=trimCount(caretContainer.data.substr(0,pos.offset()));var after=trimCount(caretContainer.data.substr(pos.offset()));var text=before.text+after.text;if(text.length>0){deleteZwspChars(caretContainer);return _CaretPosition(caretContainer,pos.offset()-before.count);}else{return pos;}};var removeElementAndReposition=function removeElementAndReposition(caretContainer,pos){var parentNode=pos.container();var newPosition=indexOf$2(from(parentNode.childNodes),caretContainer).map(function(index){return index<pos.offset()?_CaretPosition(parentNode,pos.offset()-1):pos;}).getOr(pos);remove$2(caretContainer);return newPosition;};var removeTextCaretContainer=function removeTextCaretContainer(caretContainer,pos){return isText$2(caretContainer)&&pos.container()===caretContainer?removeTextAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos);};var removeElementCaretContainer=function removeElementCaretContainer(caretContainer,pos){return pos.container()===caretContainer.parentNode?removeElementAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos);};var removeAndReposition=function removeAndReposition(container,pos){return _CaretPosition.isTextPosition(pos)?removeTextCaretContainer(container,pos):removeElementCaretContainer(container,pos);};var remove$2=function remove$2(caretContainerNode){if(isElement$2(caretContainerNode)&&isCaretContainer$2(caretContainerNode)){if(hasContent(caretContainerNode)){caretContainerNode.removeAttribute('data-mce-caret');}else{removeNode$1(caretContainerNode);}}if(isText$2(caretContainerNode)){deleteZwspChars(caretContainerNode);if(caretContainerNode.data.length===0){removeNode$1(caretContainerNode);}}};var browser$2=detect().browser;var isContentEditableFalse$8=isContentEditableFalse$b;var isMedia$1=isMedia$2;var isTableCell$3=isTableCell$5;var inlineFakeCaretSelector='*[contentEditable=false],video,audio,embed,object';var getAbsoluteClientRect=function getAbsoluteClientRect(root,element,before){var clientRect=collapse(element.getBoundingClientRect(),before);var scrollX;var scrollY;if(root.tagName==='BODY'){var docElm=root.ownerDocument.documentElement;scrollX=root.scrollLeft||docElm.scrollLeft;scrollY=root.scrollTop||docElm.scrollTop;}else{var rootRect=root.getBoundingClientRect();scrollX=root.scrollLeft-rootRect.left;scrollY=root.scrollTop-rootRect.top;}clientRect.left+=scrollX;clientRect.right+=scrollX;clientRect.top+=scrollY;clientRect.bottom+=scrollY;clientRect.width=1;var margin=element.offsetWidth-element.clientWidth;if(margin>0){if(before){margin*=-1;}clientRect.left+=margin;clientRect.right+=margin;}return clientRect;};var trimInlineCaretContainers=function trimInlineCaretContainers(root){var fakeCaretTargetNodes=descendants(SugarElement.fromDom(root),inlineFakeCaretSelector);for(var i=0;i<fakeCaretTargetNodes.length;i++){var node=fakeCaretTargetNodes[i].dom;var sibling=node.previousSibling;if(endsWithCaretContainer$1(sibling)){var data=sibling.data;if(data.length===1){sibling.parentNode.removeChild(sibling);}else{sibling.deleteData(data.length-1,1);}}sibling=node.nextSibling;if(startsWithCaretContainer$1(sibling)){var data=sibling.data;if(data.length===1){sibling.parentNode.removeChild(sibling);}else{sibling.deleteData(0,1);}}}};var FakeCaret=function FakeCaret(editor,root,isBlock,hasFocus){var lastVisualCaret=value();var cursorInterval;var caretContainerNode;var rootBlock=getForcedRootBlock(editor);var caretBlock=rootBlock.length>0?rootBlock:'p';var show=function show(before,element){var rng;hide();if(isTableCell$3(element)){return null;}if(isBlock(element)){caretContainerNode=insertBlock$1(caretBlock,element,before);var clientRect=getAbsoluteClientRect(root,element,before);DomQuery(caretContainerNode).css('top',clientRect.top);var caret=DomQuery('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(_assign({},clientRect)).appendTo(root)[0];lastVisualCaret.set({caret:caret,element:element,before:before});if(before){DomQuery(caret).addClass('mce-visual-caret-before');}startBlink();rng=element.ownerDocument.createRange();rng.setStart(caretContainerNode,0);rng.setEnd(caretContainerNode,0);}else{caretContainerNode=insertInline$1(element,before);rng=element.ownerDocument.createRange();if(isInlineFakeCaretTarget(caretContainerNode.nextSibling)){rng.setStart(caretContainerNode,0);rng.setEnd(caretContainerNode,0);}else{rng.setStart(caretContainerNode,1);rng.setEnd(caretContainerNode,1);}return rng;}return rng;};var hide=function hide(){trimInlineCaretContainers(root);if(caretContainerNode){remove$2(caretContainerNode);caretContainerNode=null;}lastVisualCaret.on(function(caretState){DomQuery(caretState.caret).remove();lastVisualCaret.clear();});if(cursorInterval){Delay.clearInterval(cursorInterval);cursorInterval=undefined;}};var startBlink=function startBlink(){cursorInterval=Delay.setInterval(function(){if(hasFocus()){DomQuery('div.mce-visual-caret',root).toggleClass('mce-visual-caret-hidden');}else{DomQuery('div.mce-visual-caret',root).addClass('mce-visual-caret-hidden');}},500);};var reposition=function reposition(){lastVisualCaret.on(function(caretState){var clientRect=getAbsoluteClientRect(root,caretState.element,caretState.before);DomQuery(caretState.caret).css(_assign({},clientRect));});};var destroy=function destroy(){return Delay.clearInterval(cursorInterval);};var getCss=function getCss(){return'.mce-visual-caret {'+'position: absolute;'+'background-color: black;'+'background-color: currentcolor;'+'}'+'.mce-visual-caret-hidden {'+'display: none;'+'}'+'*[data-mce-caret] {'+'position: absolute;'+'left: -1000px;'+'right: auto;'+'top: 0;'+'margin: 0;'+'padding: 0;'+'}';};return{show:show,hide:hide,getCss:getCss,reposition:reposition,destroy:destroy};};var isFakeCaretTableBrowser=function isFakeCaretTableBrowser(){return browser$2.isIE()||browser$2.isEdge()||browser$2.isFirefox();};var isInlineFakeCaretTarget=function isInlineFakeCaretTarget(node){return isContentEditableFalse$8(node)||isMedia$1(node);};var isFakeCaretTarget=function isFakeCaretTarget(node){return isInlineFakeCaretTarget(node)||isTable$3(node)&&isFakeCaretTableBrowser();};var isContentEditableFalse$7=isContentEditableFalse$b;var isMedia=isMedia$2;var isBlockLike=matchStyleValues('display','block table table-cell table-caption list-item');var isCaretContainer=isCaretContainer$2;var isCaretContainerBlock=isCaretContainerBlock$1;var isElement$1=isElement$5;var isCaretCandidate$1=isCaretCandidate$3;var isForwards=function isForwards(direction){return direction>0;};var isBackwards=function isBackwards(direction){return direction<0;};var skipCaretContainers=function skipCaretContainers(walk,shallow){var node;while(node=walk(shallow)){if(!isCaretContainerBlock(node)){return node;}}return null;};var findNode$1=function findNode$1(node,direction,predicateFn,rootNode,shallow){var walker=new DomTreeWalker(node,rootNode);var isCefOrCaretContainer=isContentEditableFalse$7(node)||isCaretContainerBlock(node);if(isBackwards(direction)){if(isCefOrCaretContainer){node=skipCaretContainers(walker.prev.bind(walker),true);if(predicateFn(node)){return node;}}while(node=skipCaretContainers(walker.prev.bind(walker),shallow)){if(predicateFn(node)){return node;}}}if(isForwards(direction)){if(isCefOrCaretContainer){node=skipCaretContainers(walker.next.bind(walker),true);if(predicateFn(node)){return node;}}while(node=skipCaretContainers(walker.next.bind(walker),shallow)){if(predicateFn(node)){return node;}}}return null;};var getParentBlock$2=function getParentBlock$2(node,rootNode){while(node&&node!==rootNode){if(isBlockLike(node)){return node;}node=node.parentNode;}return null;};var isInSameBlock=function isInSameBlock(caretPosition1,caretPosition2,rootNode){return getParentBlock$2(caretPosition1.container(),rootNode)===getParentBlock$2(caretPosition2.container(),rootNode);};var getChildNodeAtRelativeOffset=function getChildNodeAtRelativeOffset(relativeOffset,caretPosition){if(!caretPosition){return null;}var container=caretPosition.container();var offset=caretPosition.offset();if(!isElement$1(container)){return null;}return container.childNodes[offset+relativeOffset];};var beforeAfter=function beforeAfter(before,node){var range=node.ownerDocument.createRange();if(before){range.setStartBefore(node);range.setEndBefore(node);}else{range.setStartAfter(node);range.setEndAfter(node);}return range;};var isNodesInSameBlock=function isNodesInSameBlock(root,node1,node2){return getParentBlock$2(node1,root)===getParentBlock$2(node2,root);};var lean=function lean(left,root,node){var siblingName=left?'previousSibling':'nextSibling';while(node&&node!==root){var sibling=node[siblingName];if(isCaretContainer(sibling)){sibling=sibling[siblingName];}if(isContentEditableFalse$7(sibling)||isMedia(sibling)){if(isNodesInSameBlock(root,sibling,node)){return sibling;}break;}if(isCaretCandidate$1(sibling)){break;}node=node.parentNode;}return null;};var before$2=curry(beforeAfter,true);var after$2=curry(beforeAfter,false);var normalizeRange=function normalizeRange(direction,root,range){var node;var leanLeft=curry(lean,true,root);var leanRight=curry(lean,false,root);var container=range.startContainer;var offset=range.startOffset;if(isCaretContainerBlock$1(container)){if(!isElement$1(container)){container=container.parentNode;}var location_1=container.getAttribute('data-mce-caret');if(location_1==='before'){node=container.nextSibling;if(isFakeCaretTarget(node)){return before$2(node);}}if(location_1==='after'){node=container.previousSibling;if(isFakeCaretTarget(node)){return after$2(node);}}}if(!range.collapsed){return range;}if(isText$7(container)){if(isCaretContainer(container)){if(direction===1){node=leanRight(container);if(node){return before$2(node);}node=leanLeft(container);if(node){return after$2(node);}}if(direction===-1){node=leanLeft(container);if(node){return after$2(node);}node=leanRight(container);if(node){return before$2(node);}}return range;}if(endsWithCaretContainer$1(container)&&offset>=container.data.length-1){if(direction===1){node=leanRight(container);if(node){return before$2(node);}}return range;}if(startsWithCaretContainer$1(container)&&offset<=1){if(direction===-1){node=leanLeft(container);if(node){return after$2(node);}}return range;}if(offset===container.data.length){node=leanRight(container);if(node){return before$2(node);}return range;}if(offset===0){node=leanLeft(container);if(node){return after$2(node);}return range;}}return range;};var getRelativeCefElm=function getRelativeCefElm(forward,caretPosition){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,caretPosition)).filter(isContentEditableFalse$7);};var getNormalizedRangeEndPoint=function getNormalizedRangeEndPoint(direction,root,range){var normalizedRange=normalizeRange(direction,root,range);if(direction===-1){return _CaretPosition.fromRangeStart(normalizedRange);}return _CaretPosition.fromRangeEnd(normalizedRange);};var getElementFromPosition=function getElementFromPosition(pos){return Optional.from(pos.getNode()).map(SugarElement.fromDom);};var getElementFromPrevPosition=function getElementFromPrevPosition(pos){return Optional.from(pos.getNode(true)).map(SugarElement.fromDom);};var getVisualCaretPosition=function getVisualCaretPosition(walkFn,caretPosition){while(caretPosition=walkFn(caretPosition)){if(caretPosition.isVisible()){return caretPosition;}}return caretPosition;};var isMoveInsideSameBlock=function isMoveInsideSameBlock(from,to){var inSameBlock=isInSameBlock(from,to);if(!inSameBlock&&isBr$5(from.getNode())){return true;}return inSameBlock;};var HDirection;(function(HDirection){HDirection[HDirection['Backwards']=-1]='Backwards';HDirection[HDirection['Forwards']=1]='Forwards';})(HDirection||(HDirection={}));var isContentEditableFalse$6=isContentEditableFalse$b;var isText$1=isText$7;var isElement=isElement$5;var isBr$1=isBr$5;var isCaretCandidate=isCaretCandidate$3;var isAtomic=isAtomic$1;var isEditableCaretCandidate=isEditableCaretCandidate$1;var getParents$3=function getParents$3(node,root){var parents=[];while(node&&node!==root){parents.push(node);node=node.parentNode;}return parents;};var nodeAtIndex=function nodeAtIndex(container,offset){if(container.hasChildNodes()&&offset<container.childNodes.length){return container.childNodes[offset];}return null;};var getCaretCandidatePosition=function getCaretCandidatePosition(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText$1(node.previousSibling)){return _CaretPosition.before(node);}if(isText$1(node)){return _CaretPosition(node,0);}}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText$1(node.nextSibling)){return _CaretPosition.after(node);}if(isText$1(node)){return _CaretPosition(node,node.data.length);}}if(isBackwards(direction)){if(isBr$1(node)){return _CaretPosition.before(node);}return _CaretPosition.after(node);}return _CaretPosition.before(node);};var moveForwardFromBr=function moveForwardFromBr(root,nextNode){var nextSibling=nextNode.nextSibling;if(nextSibling&&isCaretCandidate(nextSibling)){if(isText$1(nextSibling)){return _CaretPosition(nextSibling,0);}else{return _CaretPosition.before(nextSibling);}}else{return findCaretPosition$1(HDirection.Forwards,_CaretPosition.after(nextNode),root);}};var findCaretPosition$1=function findCaretPosition$1(direction,startPos,root){var node;var nextNode;var innerNode;var caretPosition;if(!isElement(root)||!startPos){return null;}if(startPos.isEqual(_CaretPosition.after(root))&&root.lastChild){caretPosition=_CaretPosition.after(root.lastChild);if(isBackwards(direction)&&isCaretCandidate(root.lastChild)&&isElement(root.lastChild)){return isBr$1(root.lastChild)?_CaretPosition.before(root.lastChild):caretPosition;}}else{caretPosition=startPos;}var container=caretPosition.container();var offset=caretPosition.offset();if(isText$1(container)){if(isBackwards(direction)&&offset>0){return _CaretPosition(container,--offset);}if(isForwards(direction)&&offset<container.length){return _CaretPosition(container,++offset);}node=container;}else{if(isBackwards(direction)&&offset>0){nextNode=nodeAtIndex(container,offset-1);if(isCaretCandidate(nextNode)){if(!isAtomic(nextNode)){innerNode=findNode$1(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText$1(innerNode)){return _CaretPosition(innerNode,innerNode.data.length);}return _CaretPosition.after(innerNode);}}if(isText$1(nextNode)){return _CaretPosition(nextNode,nextNode.data.length);}return _CaretPosition.before(nextNode);}}if(isForwards(direction)&&offset<container.childNodes.length){nextNode=nodeAtIndex(container,offset);if(isCaretCandidate(nextNode)){if(isBr$1(nextNode)){return moveForwardFromBr(root,nextNode);}if(!isAtomic(nextNode)){innerNode=findNode$1(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText$1(innerNode)){return _CaretPosition(innerNode,0);}return _CaretPosition.before(innerNode);}}if(isText$1(nextNode)){return _CaretPosition(nextNode,0);}return _CaretPosition.after(nextNode);}}node=nextNode?nextNode:caretPosition.getNode();}if(isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart()){node=findNode$1(node,direction,always,root,true);if(isEditableCaretCandidate(node,root)){return getCaretCandidatePosition(direction,node);}}nextNode=findNode$1(node,direction,isEditableCaretCandidate,root);var rootContentEditableFalseElm=last$1(filter$4(getParents$3(container,root),isContentEditableFalse$6));if(rootContentEditableFalseElm&&(!nextNode||!rootContentEditableFalseElm.contains(nextNode))){if(isForwards(direction)){caretPosition=_CaretPosition.after(rootContentEditableFalseElm);}else{caretPosition=_CaretPosition.before(rootContentEditableFalseElm);}return caretPosition;}if(nextNode){return getCaretCandidatePosition(direction,nextNode);}return null;};var CaretWalker=function CaretWalker(root){return{next:function next(caretPosition){return findCaretPosition$1(HDirection.Forwards,caretPosition,root);},prev:function prev(caretPosition){return findCaretPosition$1(HDirection.Backwards,caretPosition,root);}};};var walkToPositionIn=function walkToPositionIn(forward,root,start){var position=forward?_CaretPosition.before(start):_CaretPosition.after(start);return fromPosition(forward,root,position);};var afterElement=function afterElement(node){return isBr$5(node)?_CaretPosition.before(node):_CaretPosition.after(node);};var isBeforeOrStart=function isBeforeOrStart(position){if(_CaretPosition.isTextPosition(position)){return position.offset()===0;}else{return isCaretCandidate$3(position.getNode());}};var isAfterOrEnd=function isAfterOrEnd(position){if(_CaretPosition.isTextPosition(position)){var container=position.container();return position.offset()===container.data.length;}else{return isCaretCandidate$3(position.getNode(true));}};var isBeforeAfterSameElement=function isBeforeAfterSameElement(from,to){return!_CaretPosition.isTextPosition(from)&&!_CaretPosition.isTextPosition(to)&&from.getNode()===to.getNode(true);};var isAtBr=function isAtBr(position){return!_CaretPosition.isTextPosition(position)&&isBr$5(position.getNode());};var shouldSkipPosition=function shouldSkipPosition(forward,from,to){if(forward){return!isBeforeAfterSameElement(from,to)&&!isAtBr(from)&&isAfterOrEnd(from)&&isBeforeOrStart(to);}else{return!isBeforeAfterSameElement(to,from)&&isBeforeOrStart(from)&&isAfterOrEnd(to);}};var fromPosition=function fromPosition(forward,root,pos){var walker=CaretWalker(root);return Optional.from(forward?walker.next(pos):walker.prev(pos));};var navigate=function navigate(forward,root,from){return fromPosition(forward,root,from).bind(function(to){if(isInSameBlock(from,to,root)&&shouldSkipPosition(forward,from,to)){return fromPosition(forward,root,to);}else{return Optional.some(to);}});};var _navigateIgnore=function navigateIgnore(forward,root,from,ignoreFilter){return navigate(forward,root,from).bind(function(pos){return ignoreFilter(pos)?_navigateIgnore(forward,root,pos,ignoreFilter):Optional.some(pos);});};var positionIn=function positionIn(forward,element){var startNode=forward?element.firstChild:element.lastChild;if(isText$7(startNode)){return Optional.some(_CaretPosition(startNode,forward?0:startNode.data.length));}else if(startNode){if(isCaretCandidate$3(startNode)){return Optional.some(forward?_CaretPosition.before(startNode):afterElement(startNode));}else{return walkToPositionIn(forward,element,startNode);}}else{return Optional.none();}};var nextPosition=curry(fromPosition,true);var prevPosition=curry(fromPosition,false);var firstPositionIn=curry(positionIn,true);var lastPositionIn=curry(positionIn,false);var CARET_ID$1='_mce_caret';var isCaretNode=function isCaretNode(node){return isElement$5(node)&&node.id===CARET_ID$1;};var getParentCaretContainer=function getParentCaretContainer(body,node){while(node&&node!==body){if(node.id===CARET_ID$1){return node;}node=node.parentNode;}return null;};var isStringPathBookmark=function isStringPathBookmark(bookmark){return isString$1(bookmark.start);};var isRangeBookmark=function isRangeBookmark(bookmark){return has$2(bookmark,'rng');};var isIdBookmark=function isIdBookmark(bookmark){return has$2(bookmark,'id');};var isIndexBookmark=function isIndexBookmark(bookmark){return has$2(bookmark,'name');};var isPathBookmark=function isPathBookmark(bookmark){return Tools.isArray(bookmark.start);};var addBogus=function addBogus(dom,node){if(isElement$5(node)&&dom.isBlock(node)&&!node.innerHTML&&!Env.ie){node.innerHTML='<br data-mce-bogus=\"1\" />';}return node;};var resolveCaretPositionBookmark=function resolveCaretPositionBookmark(dom,bookmark){var pos;var rng=dom.createRng();pos=resolve$2(dom.getRoot(),bookmark.start);rng.setStart(pos.container(),pos.offset());pos=resolve$2(dom.getRoot(),bookmark.end);rng.setEnd(pos.container(),pos.offset());return rng;};var insertZwsp=function insertZwsp(node,rng){var textNode=node.ownerDocument.createTextNode(ZWSP$1);node.appendChild(textNode);rng.setStart(textNode,0);rng.setEnd(textNode,0);};var isEmpty$1=function isEmpty$1(node){return node.hasChildNodes()===false;};var tryFindRangePosition=function tryFindRangePosition(node,rng){return lastPositionIn(node).fold(never,function(pos){rng.setStart(pos.container(),pos.offset());rng.setEnd(pos.container(),pos.offset());return true;});};var padEmptyCaretContainer=function padEmptyCaretContainer(root,node,rng){if(isEmpty$1(node)&&getParentCaretContainer(root,node)){insertZwsp(node,rng);return true;}else{return false;}};var setEndPoint=function setEndPoint(dom,start,bookmark,rng){var point=bookmark[start?'start':'end'];var i,node,offset,children;var root=dom.getRoot();if(point){offset=point[0];for(node=root,i=point.length-1;i>=1;i--){children=node.childNodes;if(padEmptyCaretContainer(root,node,rng)){return true;}if(point[i]>children.length-1){if(padEmptyCaretContainer(root,node,rng)){return true;}return tryFindRangePosition(node,rng);}node=children[point[i]];}if(node.nodeType===3){offset=Math.min(point[0],node.nodeValue.length);}if(node.nodeType===1){offset=Math.min(point[0],node.childNodes.length);}if(start){rng.setStart(node,offset);}else{rng.setEnd(node,offset);}}return true;};var isValidTextNode=function isValidTextNode(node){return isText$7(node)&&node.data.length>0;};var restoreEndPoint=function restoreEndPoint(dom,suffix,bookmark){var marker=dom.get(bookmark.id+'_'+suffix),node,idx,next,prev;var keep=bookmark.keep;var container,offset;if(marker){node=marker.parentNode;if(suffix==='start'){if(!keep){idx=dom.nodeIndex(marker);}else{if(marker.hasChildNodes()){node=marker.firstChild;idx=1;}else if(isValidTextNode(marker.nextSibling)){node=marker.nextSibling;idx=0;}else if(isValidTextNode(marker.previousSibling)){node=marker.previousSibling;idx=marker.previousSibling.data.length;}else{node=marker.parentNode;idx=dom.nodeIndex(marker)+1;}}container=node;offset=idx;}else{if(!keep){idx=dom.nodeIndex(marker);}else{if(marker.hasChildNodes()){node=marker.firstChild;idx=1;}else if(isValidTextNode(marker.previousSibling)){node=marker.previousSibling;idx=marker.previousSibling.data.length;}else{node=marker.parentNode;idx=dom.nodeIndex(marker);}}container=node;offset=idx;}if(!keep){prev=marker.previousSibling;next=marker.nextSibling;Tools.each(Tools.grep(marker.childNodes),function(node){if(isText$7(node)){node.nodeValue=node.nodeValue.replace(/\\uFEFF/g,'');}});while(marker=dom.get(bookmark.id+'_'+suffix)){dom.remove(marker,true);}if(prev&&next&&prev.nodeType===next.nodeType&&isText$7(prev)&&!Env.opera){idx=prev.nodeValue.length;prev.appendData(next.nodeValue);dom.remove(next);container=prev;offset=idx;}}return Optional.some(_CaretPosition(container,offset));}else{return Optional.none();}};var resolvePaths=function resolvePaths(dom,bookmark){var rng=dom.createRng();if(setEndPoint(dom,true,bookmark,rng)&&setEndPoint(dom,false,bookmark,rng)){return Optional.some(rng);}else{return Optional.none();}};var resolveId=function resolveId(dom,bookmark){var startPos=restoreEndPoint(dom,'start',bookmark);var endPos=restoreEndPoint(dom,'end',bookmark);return lift2(startPos,endPos.or(startPos),function(spos,epos){var rng=dom.createRng();rng.setStart(addBogus(dom,spos.container()),spos.offset());rng.setEnd(addBogus(dom,epos.container()),epos.offset());return rng;});};var resolveIndex=function resolveIndex(dom,bookmark){return Optional.from(dom.select(bookmark.name)[bookmark.index]).map(function(elm){var rng=dom.createRng();rng.selectNode(elm);return rng;});};var resolve$1=function resolve$1(selection,bookmark){var dom=selection.dom;if(bookmark){if(isPathBookmark(bookmark)){return resolvePaths(dom,bookmark);}else if(isStringPathBookmark(bookmark)){return Optional.some(resolveCaretPositionBookmark(dom,bookmark));}else if(isIdBookmark(bookmark)){return resolveId(dom,bookmark);}else if(isIndexBookmark(bookmark)){return resolveIndex(dom,bookmark);}else if(isRangeBookmark(bookmark)){return Optional.some(bookmark.rng);}}return Optional.none();};var getBookmark$1=function getBookmark$1(selection,type,normalized){return getBookmark$2(selection,type,normalized);};var moveToBookmark=function moveToBookmark(selection,bookmark){resolve$1(selection,bookmark).each(function(rng){selection.setRng(rng);});};var isBookmarkNode$1=function isBookmarkNode$1(node){return isElement$5(node)&&node.tagName==='SPAN'&&node.getAttribute('data-mce-type')==='bookmark';};var is=function is(expected){return function(actual){return expected===actual;};};var isNbsp=is(nbsp);var isWhiteSpace=function isWhiteSpace(chr){return chr!==''&&' \\f\\n\\r\\t\\x0B'.indexOf(chr)!==-1;};var isContent=function isContent(chr){return!isWhiteSpace(chr)&&!isNbsp(chr);};var isNode=function isNode(node){return!!node.nodeType;};var isInlineBlock=function isInlineBlock(node){return node&&/^(IMG)$/.test(node.nodeName);};var moveStart=function moveStart(dom,selection,rng){var offset=rng.startOffset;var container=rng.startContainer;if(container===rng.endContainer){if(isInlineBlock(container.childNodes[offset])){return;}}if(isElement$5(container)){var nodes=container.childNodes;var walker=void 0;if(offset<nodes.length){container=nodes[offset];walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock));}else{container=nodes[nodes.length-1];walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock));walker.next(true);}for(var node=walker.current();node;node=walker.next()){if(isText$7(node)&&!isWhiteSpaceNode$1(node)){rng.setStart(node,0);selection.setRng(rng);return;}}}};var getNonWhiteSpaceSibling=function getNonWhiteSpaceSibling(node,next,inc){if(node){var nextName=next?'nextSibling':'previousSibling';for(node=inc?node:node[nextName];node;node=node[nextName]){if(isElement$5(node)||!isWhiteSpaceNode$1(node)){return node;}}}};var isTextBlock$1=function isTextBlock$1(editor,name){if(isNode(name)){name=name.nodeName;}return!!editor.schema.getTextBlockElements()[name.toLowerCase()];};var isValid=function isValid(ed,parent,child){return ed.schema.isValidChild(parent,child);};var isWhiteSpaceNode$1=function isWhiteSpaceNode$1(node,allowSpaces){if(allowSpaces===void 0){allowSpaces=false;}if(isNonNullable(node)&&isText$7(node)){var data=allowSpaces?node.data.replace(/ /g,'\\xA0'):node.data;return isWhitespaceText(data);}else{return false;}};var isEmptyTextNode$1=function isEmptyTextNode$1(node){return isNonNullable(node)&&isText$7(node)&&node.length===0;};var replaceVars=function replaceVars(value,vars){if(isFunction(value)){value=value(vars);}else if(isNonNullable(vars)){value=value.replace(/%(\\w+)/g,function(str,name){return vars[name]||str;});}return value;};var isEq$5=function isEq$5(str1,str2){str1=str1||'';str2=str2||'';str1=''+(str1.nodeName||str1);str2=''+(str2.nodeName||str2);return str1.toLowerCase()===str2.toLowerCase();};var normalizeStyleValue=function normalizeStyleValue(dom,value,name){if(name==='color'||name==='backgroundColor'){value=dom.toHex(value);}if(name==='fontWeight'&&value===700){value='bold';}if(name==='fontFamily'){value=value.replace(/[\\'\\\"]/g,'').replace(/,\\s+/g,',');}return''+value;};var getStyle=function getStyle(dom,node,name){return normalizeStyleValue(dom,dom.getStyle(node,name),name);};var getTextDecoration=function getTextDecoration(dom,node){var decoration;dom.getParent(node,function(n){decoration=dom.getStyle(n,'text-decoration');return decoration&&decoration!=='none';});return decoration;};var getParents$2=function getParents$2(dom,node,selector){return dom.getParents(node,selector,dom.getRoot());};var isVariableFormatName=function isVariableFormatName(editor,formatName){var hasVariableValues=function hasVariableValues(format){var isVariableValue=function isVariableValue(val){return val.length>1&&val.charAt(0)==='%';};return exists(['styles','attributes'],function(key){return get$9(format,key).exists(function(field){var fieldValues=isArray$1(field)?field:values(field);return exists(fieldValues,isVariableValue);});});};return exists(editor.formatter.get(formatName),hasVariableValues);};var areSimilarFormats=function areSimilarFormats(editor,formatName,otherFormatName){var validKeys=['inline','block','selector','attributes','styles','classes'];var filterObj=function filterObj(format){return filter$3(format,function(_,key){return exists(validKeys,function(validKey){return validKey===key;});});};return exists(editor.formatter.get(formatName),function(fmt1){var filteredFmt1=filterObj(fmt1);return exists(editor.formatter.get(otherFormatName),function(fmt2){var filteredFmt2=filterObj(fmt2);return equal$1(filteredFmt1,filteredFmt2);});});};var isBlockFormat=function isBlockFormat(format){return hasNonNullableKey(format,'block');};var isSelectorFormat=function isSelectorFormat(format){return hasNonNullableKey(format,'selector');};var isInlineFormat=function isInlineFormat(format){return hasNonNullableKey(format,'inline');};var isMixedFormat=function isMixedFormat(format){return isSelectorFormat(format)&&isInlineFormat(format)&&is$1(get$9(format,'mixed'),true);};var shouldExpandToSelector=function shouldExpandToSelector(format){return isSelectorFormat(format)&&format.expand!==false&&!isInlineFormat(format);};var isBookmarkNode=isBookmarkNode$1;var getParents$1=getParents$2;var isWhiteSpaceNode=isWhiteSpaceNode$1;var isTextBlock=isTextBlock$1;var isBogusBr=function isBogusBr(node){return isBr$5(node)&&node.getAttribute('data-mce-bogus')&&!node.nextSibling;};var findParentContentEditable=function findParentContentEditable(dom,node){var parent=node;while(parent){if(isElement$5(parent)&&dom.getContentEditable(parent)){return dom.getContentEditable(parent)==='false'?parent:node;}parent=parent.parentNode;}return node;};var walkText=function walkText(start,node,offset,predicate){var str=node.data;for(var i=offset;start?i>=0:i<str.length;start?i--:i++){if(predicate(str.charAt(i))){return start?i+1:i;}}return-1;};var findSpace=function findSpace(start,node,offset){return walkText(start,node,offset,function(c){return isNbsp(c)||isWhiteSpace(c);});};var findContent=function findContent(start,node,offset){return walkText(start,node,offset,isContent);};var findWordEndPoint=function findWordEndPoint(dom,body,container,offset,start,includeTrailingSpaces){var lastTextNode;var rootNode=dom.getParent(container,dom.isBlock)||body;var walk=function walk(container,offset,pred){var textSeeker=TextSeeker(dom);var walker=start?textSeeker.backwards:textSeeker.forwards;return Optional.from(walker(container,offset,function(text,textOffset){if(isBookmarkNode(text.parentNode)){return-1;}else{lastTextNode=text;return pred(start,text,textOffset);}},rootNode));};var spaceResult=walk(container,offset,findSpace);return spaceResult.bind(function(result){return includeTrailingSpaces?walk(result.container,result.offset+(start?-1:0),findContent):Optional.some(result);}).orThunk(function(){return lastTextNode?Optional.some({container:lastTextNode,offset:start?0:lastTextNode.length}):Optional.none();});};var findSelectorEndPoint=function findSelectorEndPoint(dom,formatList,rng,container,siblingName){if(isText$7(container)&&isEmpty$3(container.data)&&container[siblingName]){container=container[siblingName];}var parents=getParents$1(dom,container);for(var i=0;i<parents.length;i++){for(var y=0;y<formatList.length;y++){var curFormat=formatList[y];if(isNonNullable(curFormat.collapsed)&&curFormat.collapsed!==rng.collapsed){continue;}if(isSelectorFormat(curFormat)&&dom.is(parents[i],curFormat.selector)){return parents[i];}}}return container;};var findBlockEndPoint=function findBlockEndPoint(editor,formatList,container,siblingName){var node=container;var dom=editor.dom;var root=dom.getRoot();var format=formatList[0];if(isBlockFormat(format)){node=format.wrapper?null:dom.getParent(container,format.block,root);}if(!node){var scopeRoot=dom.getParent(container,'LI,TD,TH');node=dom.getParent(isText$7(container)?container.parentNode:container,function(node){return node!==root&&isTextBlock(editor,node);},scopeRoot);}if(node&&isBlockFormat(format)&&format.wrapper){node=getParents$1(dom,node,'ul,ol').reverse()[0]||node;}if(!node){node=container;while(node[siblingName]&&!dom.isBlock(node[siblingName])){node=node[siblingName];if(isEq$5(node,'br')){break;}}}return node||container;};var _isAtBlockBoundary$=function isAtBlockBoundary$1(dom,root,container,siblingName){var parent=container.parentNode;if(isNonNullable(container[siblingName])){return false;}else if(parent===root||isNullable(parent)||dom.isBlock(parent)){return true;}else{return _isAtBlockBoundary$(dom,root,parent,siblingName);}};var findParentContainer=function findParentContainer(dom,formatList,container,offset,start){var parent=container;var siblingName=start?'previousSibling':'nextSibling';var root=dom.getRoot();if(isText$7(container)&&!isWhiteSpaceNode(container)){if(start?offset>0:offset<container.data.length){return container;}}while(true){if(!formatList[0].block_expand&&dom.isBlock(parent)){return parent;}for(var sibling=parent[siblingName];sibling;sibling=sibling[siblingName]){var allowSpaces=isText$7(sibling)&&!_isAtBlockBoundary$(dom,root,sibling,siblingName);if(!isBookmarkNode(sibling)&&!isBogusBr(sibling)&&!isWhiteSpaceNode(sibling,allowSpaces)){return parent;}}if(parent===root||parent.parentNode===root){container=parent;break;}parent=parent.parentNode;}return container;};var isSelfOrParentBookmark=function isSelfOrParentBookmark(container){return isBookmarkNode(container.parentNode)||isBookmarkNode(container);};var expandRng=function expandRng(editor,rng,formatList,includeTrailingSpace){if(includeTrailingSpace===void 0){includeTrailingSpace=false;}var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;var dom=editor.dom;var format=formatList[0];if(isElement$5(startContainer)&&startContainer.hasChildNodes()){startContainer=getNode$1(startContainer,startOffset);if(isText$7(startContainer)){startOffset=0;}}if(isElement$5(endContainer)&&endContainer.hasChildNodes()){endContainer=getNode$1(endContainer,rng.collapsed?endOffset:endOffset-1);if(isText$7(endContainer)){endOffset=endContainer.nodeValue.length;}}startContainer=findParentContentEditable(dom,startContainer);endContainer=findParentContentEditable(dom,endContainer);if(isSelfOrParentBookmark(startContainer)){startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode;if(rng.collapsed){startContainer=startContainer.previousSibling||startContainer;}else{startContainer=startContainer.nextSibling||startContainer;}if(isText$7(startContainer)){startOffset=rng.collapsed?startContainer.length:0;}}if(isSelfOrParentBookmark(endContainer)){endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode;if(rng.collapsed){endContainer=endContainer.nextSibling||endContainer;}else{endContainer=endContainer.previousSibling||endContainer;}if(isText$7(endContainer)){endOffset=rng.collapsed?0:endContainer.length;}}if(rng.collapsed){var startPoint=findWordEndPoint(dom,editor.getBody(),startContainer,startOffset,true,includeTrailingSpace);startPoint.each(function(_a){var container=_a.container,offset=_a.offset;startContainer=container;startOffset=offset;});var endPoint=findWordEndPoint(dom,editor.getBody(),endContainer,endOffset,false,includeTrailingSpace);endPoint.each(function(_a){var container=_a.container,offset=_a.offset;endContainer=container;endOffset=offset;});}if(isInlineFormat(format)||format.block_expand){if(!isInlineFormat(format)||!isText$7(startContainer)||startOffset===0){startContainer=findParentContainer(dom,formatList,startContainer,startOffset,true);}if(!isInlineFormat(format)||!isText$7(endContainer)||endOffset===endContainer.nodeValue.length){endContainer=findParentContainer(dom,formatList,endContainer,endOffset,false);}}if(shouldExpandToSelector(format)){startContainer=findSelectorEndPoint(dom,formatList,rng,startContainer,'previousSibling');endContainer=findSelectorEndPoint(dom,formatList,rng,endContainer,'nextSibling');}if(isBlockFormat(format)||isSelectorFormat(format)){startContainer=findBlockEndPoint(editor,formatList,startContainer,'previousSibling');endContainer=findBlockEndPoint(editor,formatList,endContainer,'nextSibling');if(isBlockFormat(format)){if(!dom.isBlock(startContainer)){startContainer=findParentContainer(dom,formatList,startContainer,startOffset,true);}if(!dom.isBlock(endContainer)){endContainer=findParentContainer(dom,formatList,endContainer,endOffset,false);}}}if(isElement$5(startContainer)){startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode;}if(isElement$5(endContainer)){endOffset=dom.nodeIndex(endContainer)+1;endContainer=endContainer.parentNode;}return{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset};};var walk$2=function walk$2(dom,rng,callback){var startOffset=rng.startOffset;var startContainer=getNode$1(rng.startContainer,startOffset);var endOffset=rng.endOffset;var endContainer=getNode$1(rng.endContainer,endOffset-1);var exclude=function exclude(nodes){var firstNode=nodes[0];if(isText$7(firstNode)&&firstNode===startContainer&&startOffset>=firstNode.data.length){nodes.splice(0,1);}var lastNode=nodes[nodes.length-1];if(endOffset===0&&nodes.length>0&&lastNode===endContainer&&isText$7(lastNode)){nodes.splice(nodes.length-1,1);}return nodes;};var collectSiblings=function collectSiblings(node,name,endNode){var siblings=[];for(;node&&node!==endNode;node=node[name]){siblings.push(node);}return siblings;};var findEndPoint=function findEndPoint(node,root){return dom.getParent(node,function(node){return node.parentNode===root;},root);};var walkBoundary=function walkBoundary(startNode,endNode,next){var siblingName=next?'nextSibling':'previousSibling';for(var node=startNode,parent_1=node.parentNode;node&&node!==endNode;node=parent_1){parent_1=node.parentNode;var siblings_1=collectSiblings(node===startNode?node:node[siblingName],siblingName);if(siblings_1.length){if(!next){siblings_1.reverse();}callback(exclude(siblings_1));}}};if(startContainer===endContainer){return callback(exclude([startContainer]));}var ancestor=dom.findCommonAncestor(startContainer,endContainer);if(dom.isChildOf(startContainer,endContainer)){return walkBoundary(startContainer,ancestor,true);}if(dom.isChildOf(endContainer,startContainer)){return walkBoundary(endContainer,ancestor);}var startPoint=findEndPoint(startContainer,ancestor)||startContainer;var endPoint=findEndPoint(endContainer,ancestor)||endContainer;walkBoundary(startContainer,startPoint,true);var siblings=collectSiblings(startPoint===startContainer?startPoint:startPoint.nextSibling,'nextSibling',endPoint===endContainer?endPoint.nextSibling:endPoint);if(siblings.length){callback(exclude(siblings));}walkBoundary(endContainer,endPoint);};var getRanges=function getRanges(selection){var ranges=[];if(selection){for(var i=0;i<selection.rangeCount;i++){ranges.push(selection.getRangeAt(i));}}return ranges;};var getSelectedNodes=function getSelectedNodes(ranges){return bind(ranges,function(range){var node=getSelectedNode(range);return node?[SugarElement.fromDom(node)]:[];});};var hasMultipleRanges=function hasMultipleRanges(selection){return getRanges(selection).length>1;};var getCellsFromRanges=function getCellsFromRanges(ranges){return filter$4(getSelectedNodes(ranges),isTableCell$4);};var getCellsFromElement=function getCellsFromElement(elm){return descendants(elm,'td[data-mce-selected],th[data-mce-selected]');};var getCellsFromElementOrRanges=function getCellsFromElementOrRanges(ranges,element){var selectedCells=getCellsFromElement(element);return selectedCells.length>0?selectedCells:getCellsFromRanges(ranges);};var getCellsFromEditor=function getCellsFromEditor(editor){return getCellsFromElementOrRanges(getRanges(editor.selection.getSel()),SugarElement.fromDom(editor.getBody()));};var getClosestTable=function getClosestTable(cell,isRoot){return ancestor$2(cell,'table',isRoot);};var getStartNode=function getStartNode(rng){var sc=rng.startContainer,so=rng.startOffset;if(isText$7(sc)){return so===0?Optional.some(SugarElement.fromDom(sc)):Optional.none();}else{return Optional.from(sc.childNodes[so]).map(SugarElement.fromDom);}};var getEndNode=function getEndNode(rng){var ec=rng.endContainer,eo=rng.endOffset;if(isText$7(ec)){return eo===ec.data.length?Optional.some(SugarElement.fromDom(ec)):Optional.none();}else{return Optional.from(ec.childNodes[eo-1]).map(SugarElement.fromDom);}};var _getFirstChildren=function getFirstChildren(node){return firstChild(node).fold(constant([node]),function(child){return[node].concat(_getFirstChildren(child));});};var _getLastChildren$=function getLastChildren$1(node){return lastChild(node).fold(constant([node]),function(child){if(name(child)==='br'){return prevSibling(child).map(function(sibling){return[node].concat(_getLastChildren$(sibling));}).getOr([]);}else{return[node].concat(_getLastChildren$(child));}});};var hasAllContentsSelected=function hasAllContentsSelected(elm,rng){return lift2(getStartNode(rng),getEndNode(rng),function(startNode,endNode){var start=find$3(_getFirstChildren(elm),curry(eq,startNode));var end=find$3(_getLastChildren$(elm),curry(eq,endNode));return start.isSome()&&end.isSome();}).getOr(false);};var moveEndPoint=function moveEndPoint(dom,rng,node,start){var root=node,walker=new DomTreeWalker(node,root);var moveCaretBeforeOnEnterElementsMap=filter$3(dom.schema.getMoveCaretBeforeOnEnterElements(),function(_,name){return!contains$3(['td','th','table'],name.toLowerCase());});do{if(isText$7(node)&&Tools.trim(node.nodeValue).length!==0){if(start){rng.setStart(node,0);}else{rng.setEnd(node,node.nodeValue.length);}return;}if(moveCaretBeforeOnEnterElementsMap[node.nodeName]){if(start){rng.setStartBefore(node);}else{if(node.nodeName==='BR'){rng.setEndBefore(node);}else{rng.setEndAfter(node);}}return;}}while(node=start?walker.next():walker.prev());if(root.nodeName==='BODY'){if(start){rng.setStart(root,0);}else{rng.setEnd(root,root.childNodes.length);}}};var hasAnyRanges=function hasAnyRanges(editor){var sel=editor.selection.getSel();return sel&&sel.rangeCount>0;};var runOnRanges=function runOnRanges(editor,executor){var fakeSelectionNodes=getCellsFromEditor(editor);if(fakeSelectionNodes.length>0){each$k(fakeSelectionNodes,function(elem){var node=elem.dom;var fakeNodeRng=editor.dom.createRng();fakeNodeRng.setStartBefore(node);fakeNodeRng.setEndAfter(node);executor(fakeNodeRng,true);});}else{executor(editor.selection.getRng(),false);}};var preserve=function preserve(selection,fillBookmark,executor){var bookmark=getPersistentBookmark(selection,fillBookmark);executor(bookmark);selection.moveToBookmark(bookmark);};var NodeValue=function NodeValue(is,name){var get=function get(element){if(!is(element)){throw new Error('Can only get '+name+' value of a '+name+' node');}return getOption(element).getOr('');};var getOption=function getOption(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none();};var set=function set(element,value){if(!is(element)){throw new Error('Can only set raw '+name+' value of a '+name+' node');}element.dom.nodeValue=value;};return{get:get,getOption:getOption,set:set};};var api$1=NodeValue(isText$8,'text');var get$2=function get$2(element){return api$1.get(element);};var isZeroWidth=function isZeroWidth(elem){return isText$8(elem)&&get$2(elem)===ZWSP$1;};var context=function context(editor,elem,wrapName,nodeName){return parent(elem).fold(function(){return'skipping';},function(parent){if(nodeName==='br'||isZeroWidth(elem)){return'valid';}else if(isAnnotation(elem)){return'existing';}else if(isCaretNode(elem.dom)){return'caret';}else if(!isValid(editor,wrapName,nodeName)||!isValid(editor,name(parent),wrapName)){return'invalid-child';}else{return'valid';}});};var applyWordGrab=function applyWordGrab(editor,rng){var r=expandRng(editor,rng,[{inline:'span'}]);rng.setStart(r.startContainer,r.startOffset);rng.setEnd(r.endContainer,r.endOffset);editor.selection.setRng(rng);};var makeAnnotation=function makeAnnotation(eDoc,_a,annotationName,decorate){var _b=_a.uid,uid=_b===void 0?generate('mce-annotation'):_b,data=__rest(_a,['uid']);var master=SugarElement.fromTag('span',eDoc);add$1(master,annotation());set$1(master,''+dataAnnotationId(),uid);set$1(master,''+dataAnnotation(),annotationName);var _c=decorate(uid,data),_d=_c.attributes,attributes=_d===void 0?{}:_d,_e=_c.classes,classes=_e===void 0?[]:_e;setAll$1(master,attributes);add(master,classes);return master;};var annotate=function annotate(editor,rng,annotationName,decorate,data){var newWrappers=[];var master=makeAnnotation(editor.getDoc(),data,annotationName,decorate);var wrapper=value();var finishWrapper=function finishWrapper(){wrapper.clear();};var getOrOpenWrapper=function getOrOpenWrapper(){return wrapper.get().getOrThunk(function(){var nu=shallow(master);newWrappers.push(nu);wrapper.set(nu);return nu;});};var processElements=function processElements(elems){each$k(elems,processElement);};var processElement=function processElement(elem){var ctx=context(editor,elem,'span',name(elem));switch(ctx){case'invalid-child':{finishWrapper();var children$1=children(elem);processElements(children$1);finishWrapper();break;}case'valid':{var w=getOrOpenWrapper();wrap$3(elem,w);break;}}};var processNodes=function processNodes(nodes){var elems=map$3(nodes,SugarElement.fromDom);processElements(elems);};walk$2(editor.dom,rng,function(nodes){finishWrapper();processNodes(nodes);});return newWrappers;};var annotateWithBookmark=function annotateWithBookmark(editor,name,settings,data){editor.undoManager.transact(function(){var selection=editor.selection;var initialRng=selection.getRng();var hasFakeSelection=getCellsFromEditor(editor).length>0;if(initialRng.collapsed&&!hasFakeSelection){applyWordGrab(editor,initialRng);}if(selection.getRng().collapsed&&!hasFakeSelection){var wrapper=makeAnnotation(editor.getDoc(),data,name,settings.decorate);set(wrapper,nbsp);selection.getRng().insertNode(wrapper.dom);selection.select(wrapper.dom);}else{preserve(selection,false,function(){runOnRanges(editor,function(selectionRng){annotate(editor,selectionRng,name,settings.decorate,data);});});}});};var Annotator=function Annotator(editor){var registry=create$7();setup$m(editor,registry);var changes=setup$n(editor);return{register:function register(name,settings){registry.register(name,settings);},annotate:function annotate(name,data){registry.lookup(name).each(function(settings){annotateWithBookmark(editor,name,settings,data);});},annotationChanged:function annotationChanged(name,callback){changes.addListener(name,callback);},remove:function remove(name){identify(editor,Optional.some(name)).each(function(_a){var elements=_a.elements;each$k(elements,unwrap);});},getAll:function getAll(name){var directory=findAll(editor,name);return map$2(directory,function(elems){return map$3(elems,function(elem){return elem.dom;});});}};};var BookmarkManager=function BookmarkManager(selection){return{getBookmark:curry(getBookmark$1,selection),moveToBookmark:curry(moveToBookmark,selection)};};BookmarkManager.isBookmarkNode=isBookmarkNode$1;var getContentEditableRoot$1=function getContentEditableRoot$1(root,node){while(node&&node!==root){if(isContentEditableTrue$4(node)||isContentEditableFalse$b(node)){return node;}node=node.parentNode;}return null;};var isXYWithinRange=function isXYWithinRange(clientX,clientY,range){if(range.collapsed){return false;}if(Env.browser.isIE()&&range.startOffset===range.endOffset-1&&range.startContainer===range.endContainer){var elm=range.startContainer.childNodes[range.startOffset];if(isElement$5(elm)){return exists(elm.getClientRects(),function(rect){return containsXY(rect,clientX,clientY);});}}return exists(range.getClientRects(),function(rect){return containsXY(rect,clientX,clientY);});};var firePreProcess=function firePreProcess(editor,args){return editor.fire('PreProcess',args);};var firePostProcess=function firePostProcess(editor,args){return editor.fire('PostProcess',args);};var fireRemove=function fireRemove(editor){return editor.fire('remove');};var fireDetach=function fireDetach(editor){return editor.fire('detach');};var fireSwitchMode=function fireSwitchMode(editor,mode){return editor.fire('SwitchMode',{mode:mode});};var fireObjectResizeStart=function fireObjectResizeStart(editor,target,width,height,origin){editor.fire('ObjectResizeStart',{target:target,width:width,height:height,origin:origin});};var fireObjectResized=function fireObjectResized(editor,target,width,height,origin){editor.fire('ObjectResized',{target:target,width:width,height:height,origin:origin});};var firePreInit=function firePreInit(editor){return editor.fire('PreInit');};var firePostRender=function firePostRender(editor){return editor.fire('PostRender');};var fireInit=function fireInit(editor){return editor.fire('Init');};var firePlaceholderToggle=function firePlaceholderToggle(editor,state){return editor.fire('PlaceholderToggle',{state:state});};var fireError=function fireError(editor,errorType,error){return editor.fire(errorType,error);};var fireFormatApply=function fireFormatApply(editor,format,node,vars){return editor.fire('FormatApply',{format:format,node:node,vars:vars});};var fireFormatRemove=function fireFormatRemove(editor,format,node,vars){return editor.fire('FormatRemove',{format:format,node:node,vars:vars});};var VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,modifierPressed:function modifierPressed(e){return e.shiftKey||e.ctrlKey||e.altKey||VK.metaKeyPressed(e);},metaKeyPressed:function metaKeyPressed(e){return Env.mac?e.metaKey:e.ctrlKey&&!e.altKey;}};var isContentEditableFalse$5=isContentEditableFalse$b;var ControlSelection=function ControlSelection(selection,editor){var elementSelectionAttr='data-mce-selected';var dom=editor.dom,each=Tools.each;var selectedElm,selectedElmGhost,resizeHelper,selectedHandle,resizeBackdrop;var startX,startY,selectedElmX,selectedElmY,startW,startH,ratio,resizeStarted;var width,height;var editableDoc=editor.getDoc(),rootDocument=document;var abs=Math.abs,round=Math.round,rootElement=editor.getBody();var startScrollWidth,startScrollHeight;var resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var isImage=function isImage(elm){return elm&&(elm.nodeName==='IMG'||editor.dom.is(elm,'figure.image'));};var isMedia=function isMedia(elm){return isMedia$2(elm)||dom.hasClass(elm,'mce-preview-object');};var isEventOnImageOutsideRange=function isEventOnImageOutsideRange(evt,range){if(evt.type==='longpress'||evt.type.indexOf('touch')===0){var touch=evt.touches[0];return isImage(evt.target)&&!isXYWithinRange(touch.clientX,touch.clientY,range);}else{return isImage(evt.target)&&!isXYWithinRange(evt.clientX,evt.clientY,range);}};var contextMenuSelectImage=function contextMenuSelectImage(evt){var target=evt.target;if(isEventOnImageOutsideRange(evt,editor.selection.getRng())&&!evt.isDefaultPrevented()){editor.selection.select(target);}};var getResizeTargets=function getResizeTargets(elm){if(dom.is(elm,'figure.image')){return[elm.querySelector('img')];}else if(dom.hasClass(elm,'mce-preview-object')&&isNonNullable(elm.firstElementChild)){return[elm,elm.firstElementChild];}else{return[elm];}};var isResizable=function isResizable(elm){var selector=getObjectResizing(editor);if(!selector){return false;}if(elm.getAttribute('data-mce-resize')==='false'){return false;}if(elm===editor.getBody()){return false;}if(dom.hasClass(elm,'mce-preview-object')){return is$2(SugarElement.fromDom(elm.firstElementChild),selector);}else{return is$2(SugarElement.fromDom(elm),selector);}};var createGhostElement=function createGhostElement(elm){if(isMedia(elm)){return dom.create('img',{src:Env.transparentSrc});}else{return elm.cloneNode(true);}};var setSizeProp=function setSizeProp(element,name,value){if(isNonNullable(value)){var targets=getResizeTargets(element);each$k(targets,function(target){if(target.style[name]||!editor.schema.isValid(target.nodeName.toLowerCase(),name)){dom.setStyle(target,name,value);}else{dom.setAttrib(target,name,''+value);}});}};var setGhostElmSize=function setGhostElmSize(ghostElm,width,height){setSizeProp(ghostElm,'width',width);setSizeProp(ghostElm,'height',height);};var resizeGhostElement=function resizeGhostElement(e){var deltaX,deltaY,proportional;var resizeHelperX,resizeHelperY;deltaX=e.screenX-startX;deltaY=e.screenY-startY;width=deltaX*selectedHandle[2]+startW;height=deltaY*selectedHandle[3]+startH;width=width<5?5:width;height=height<5?5:height;if((isImage(selectedElm)||isMedia(selectedElm))&&getResizeImgProportional(editor)!==false){proportional=!VK.modifierPressed(e);}else{proportional=VK.modifierPressed(e);}if(proportional){if(abs(deltaX)>abs(deltaY)){height=round(width*ratio);width=round(height/ratio);}else{width=round(height/ratio);height=round(width*ratio);}}setGhostElmSize(selectedElmGhost,width,height);resizeHelperX=selectedHandle.startPos.x+deltaX;resizeHelperY=selectedHandle.startPos.y+deltaY;resizeHelperX=resizeHelperX>0?resizeHelperX:0;resizeHelperY=resizeHelperY>0?resizeHelperY:0;dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:'block'});resizeHelper.innerHTML=width+' &times; '+height;if(selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width){dom.setStyle(selectedElmGhost,'left',selectedElmX+(startW-width));}if(selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height){dom.setStyle(selectedElmGhost,'top',selectedElmY+(startH-height));}deltaX=rootElement.scrollWidth-startScrollWidth;deltaY=rootElement.scrollHeight-startScrollHeight;if(deltaX+deltaY!==0){dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY});}if(!resizeStarted){fireObjectResizeStart(editor,selectedElm,startW,startH,'corner-'+selectedHandle.name);resizeStarted=true;}};var _endGhostResize=function endGhostResize(){var wasResizeStarted=resizeStarted;resizeStarted=false;if(wasResizeStarted){setSizeProp(selectedElm,'width',width);setSizeProp(selectedElm,'height',height);}dom.unbind(editableDoc,'mousemove',resizeGhostElement);dom.unbind(editableDoc,'mouseup',_endGhostResize);if(rootDocument!==editableDoc){dom.unbind(rootDocument,'mousemove',resizeGhostElement);dom.unbind(rootDocument,'mouseup',_endGhostResize);}dom.remove(selectedElmGhost);dom.remove(resizeHelper);dom.remove(resizeBackdrop);showResizeRect(selectedElm);if(wasResizeStarted){fireObjectResized(editor,selectedElm,width,height,'corner-'+selectedHandle.name);dom.setAttrib(selectedElm,'style',dom.getAttrib(selectedElm,'style'));}editor.nodeChanged();};var showResizeRect=function showResizeRect(targetElm){unbindResizeHandleEvents();var position=dom.getPos(targetElm,rootElement);var selectedElmX=position.x;var selectedElmY=position.y;var rect=targetElm.getBoundingClientRect();var targetWidth=rect.width||rect.right-rect.left;var targetHeight=rect.height||rect.bottom-rect.top;if(selectedElm!==targetElm){hideResizeRect();selectedElm=targetElm;width=height=0;}var e=editor.fire('ObjectSelected',{target:targetElm});var selectedValue=dom.getAttrib(selectedElm,elementSelectionAttr,'1');if(isResizable(targetElm)&&!e.isDefaultPrevented()){each(resizeHandles,function(handle,name){var handleElm;var startDrag=function startDrag(e){var target=getResizeTargets(selectedElm)[0];startX=e.screenX;startY=e.screenY;startW=target.clientWidth;startH=target.clientHeight;ratio=startH/startW;selectedHandle=handle;selectedHandle.name=name;selectedHandle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY};startScrollWidth=rootElement.scrollWidth;startScrollHeight=rootElement.scrollHeight;resizeBackdrop=dom.add(rootElement,'div',{'class':'mce-resize-backdrop','data-mce-bogus':'all'});dom.setStyles(resizeBackdrop,{position:'fixed',left:'0',top:'0',width:'100%',height:'100%'});selectedElmGhost=createGhostElement(selectedElm);dom.addClass(selectedElmGhost,'mce-clonedresizable');dom.setAttrib(selectedElmGhost,'data-mce-bogus','all');selectedElmGhost.contentEditable='false';dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0});setGhostElmSize(selectedElmGhost,targetWidth,targetHeight);selectedElmGhost.removeAttribute(elementSelectionAttr);rootElement.appendChild(selectedElmGhost);dom.bind(editableDoc,'mousemove',resizeGhostElement);dom.bind(editableDoc,'mouseup',_endGhostResize);if(rootDocument!==editableDoc){dom.bind(rootDocument,'mousemove',resizeGhostElement);dom.bind(rootDocument,'mouseup',_endGhostResize);}resizeHelper=dom.add(rootElement,'div',{'class':'mce-resize-helper','data-mce-bogus':'all'},startW+' &times; '+startH);};handleElm=dom.get('mceResizeHandle'+name);if(handleElm){dom.remove(handleElm);}handleElm=dom.add(rootElement,'div',{'id':'mceResizeHandle'+name,'data-mce-bogus':'all','class':'mce-resizehandle','unselectable':true,'style':'cursor:'+name+'-resize; margin:0; padding:0'});if(Env.ie===11){handleElm.contentEditable=false;}dom.bind(handleElm,'mousedown',function(e){e.stopImmediatePropagation();e.preventDefault();startDrag(e);});handle.elm=handleElm;dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2});});}else{hideResizeRect();}if(!dom.getAttrib(selectedElm,elementSelectionAttr)){selectedElm.setAttribute(elementSelectionAttr,selectedValue);}};var hideResizeRect=function hideResizeRect(){unbindResizeHandleEvents();if(selectedElm){selectedElm.removeAttribute(elementSelectionAttr);}each$j(resizeHandles,function(value,name){var handleElm=dom.get('mceResizeHandle'+name);if(handleElm){dom.unbind(handleElm);dom.remove(handleElm);}});};var updateResizeRect=function updateResizeRect(e){var startElm,controlElm;var isChildOrEqual=function isChildOrEqual(node,parent){if(node){do{if(node===parent){return true;}}while(node=node.parentNode);}};if(resizeStarted||editor.removed){return;}each(dom.select('img[data-mce-selected],hr[data-mce-selected]'),function(img){img.removeAttribute(elementSelectionAttr);});controlElm=e.type==='mousedown'?e.target:selection.getNode();controlElm=dom.$(controlElm).closest('table,img,figure.image,hr,video,span.mce-preview-object')[0];if(isChildOrEqual(controlElm,rootElement)){disableGeckoResize();startElm=selection.getStart(true);if(isChildOrEqual(startElm,controlElm)&&isChildOrEqual(selection.getEnd(true),controlElm)){showResizeRect(controlElm);return;}}hideResizeRect();};var isWithinContentEditableFalse=function isWithinContentEditableFalse(elm){return isContentEditableFalse$5(getContentEditableRoot$1(editor.getBody(),elm));};var unbindResizeHandleEvents=function unbindResizeHandleEvents(){each$j(resizeHandles,function(handle){if(handle.elm){dom.unbind(handle.elm);delete handle.elm;}});};var disableGeckoResize=function disableGeckoResize(){try{editor.getDoc().execCommand('enableObjectResizing',false,'false');}catch(ex){}};editor.on('init',function(){disableGeckoResize();if(Env.browser.isIE()||Env.browser.isEdge()){editor.on('mousedown click',function(e){var target=e.target,nodeName=target.nodeName;if(!resizeStarted&&/^(TABLE|IMG|HR)$/.test(nodeName)&&!isWithinContentEditableFalse(target)){if(e.button!==2){editor.selection.select(target,nodeName==='TABLE');}if(e.type==='mousedown'){editor.nodeChanged();}}});var handleMSControlSelect_1=function handleMSControlSelect_1(e){var delayedSelect=function delayedSelect(node){Delay.setEditorTimeout(editor,function(){return editor.selection.select(node);});};if(isWithinContentEditableFalse(e.target)||isMedia$2(e.target)){e.preventDefault();delayedSelect(e.target);return;}if(/^(TABLE|IMG|HR)$/.test(e.target.nodeName)){e.preventDefault();if(e.target.tagName==='IMG'){delayedSelect(e.target);}}};dom.bind(rootElement,'mscontrolselect',handleMSControlSelect_1);editor.on('remove',function(){return dom.unbind(rootElement,'mscontrolselect',handleMSControlSelect_1);});}var throttledUpdateResizeRect=Delay.throttle(function(e){if(!editor.composing){updateResizeRect(e);}});editor.on('NodeChange ResizeEditor ResizeWindow ResizeContent drop',throttledUpdateResizeRect);editor.on('keyup compositionend',function(e){if(selectedElm&&selectedElm.nodeName==='TABLE'){throttledUpdateResizeRect(e);}});editor.on('hide blur',hideResizeRect);editor.on('contextmenu longpress',contextMenuSelectImage,true);});editor.on('remove',unbindResizeHandleEvents);var destroy=function destroy(){selectedElm=selectedElmGhost=resizeBackdrop=null;};return{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,destroy:destroy};};var hasCeProperty=function hasCeProperty(node){return isContentEditableTrue$4(node)||isContentEditableFalse$b(node);};var findParent$1=function findParent$1(node,rootNode,predicate){while(node&&node!==rootNode){if(predicate(node)){return node;}node=node.parentNode;}return null;};var findClosestIeRange=function findClosestIeRange(clientX,clientY,doc){var rects;var element=doc.elementFromPoint(clientX,clientY);var rng=doc.body.createTextRange();if(!element||element.tagName==='HTML'){element=doc.body;}rng.moveToElementText(element);rects=Tools.toArray(rng.getClientRects());rects=rects.sort(function(a,b){a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY));b=Math.abs(Math.max(b.top-clientY,b.bottom-clientY));return a-b;});if(rects.length>0){clientY=(rects[0].bottom+rects[0].top)/2;try{rng.moveToPoint(clientX,clientY);rng.collapse(true);return rng;}catch(ex){}}return null;};var moveOutOfContentEditableFalse=function moveOutOfContentEditableFalse(rng,rootNode){var parentElement=rng&&rng.parentElement?rng.parentElement():null;return isContentEditableFalse$b(findParent$1(parentElement,rootNode,hasCeProperty))?null:rng;};var fromPoint=function fromPoint(clientX,clientY,doc){var rng,point;var pointDoc=doc;if(pointDoc.caretPositionFromPoint){point=pointDoc.caretPositionFromPoint(clientX,clientY);if(point){rng=doc.createRange();rng.setStart(point.offsetNode,point.offset);rng.collapse(true);}}else if(pointDoc.caretRangeFromPoint){rng=pointDoc.caretRangeFromPoint(clientX,clientY);}else if(pointDoc.body.createTextRange){rng=pointDoc.body.createTextRange();try{rng.moveToPoint(clientX,clientY);rng.collapse(true);}catch(ex){rng=findClosestIeRange(clientX,clientY,doc);}return moveOutOfContentEditableFalse(rng,doc.body);}return rng;};var isEq$4=function isEq$4(rng1,rng2){return rng1&&rng2&&rng1.startContainer===rng2.startContainer&&rng1.startOffset===rng2.startOffset&&rng1.endContainer===rng2.endContainer&&rng1.endOffset===rng2.endOffset;};var findParent=function findParent(node,rootNode,predicate){while(node&&node!==rootNode){if(predicate(node)){return node;}node=node.parentNode;}return null;};var hasParent$1=function hasParent$1(node,rootNode,predicate){return findParent(node,rootNode,predicate)!==null;};var hasParentWithName=function hasParentWithName(node,rootNode,name){return hasParent$1(node,rootNode,function(node){return node.nodeName===name;});};var isTable=function isTable(node){return node&&node.nodeName==='TABLE';};var isTableCell$2=function isTableCell$2(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName);};var isCeFalseCaretContainer=function isCeFalseCaretContainer(node,rootNode){return isCaretContainer$2(node)&&hasParent$1(node,rootNode,isCaretNode)===false;};var hasBrBeforeAfter=function hasBrBeforeAfter(dom,node,left){var walker=new DomTreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||dom.getRoot());while(node=walker[left?'prev':'next']()){if(isBr$5(node)){return true;}}};var isPrevNode=function isPrevNode(node,name){return node.previousSibling&&node.previousSibling.nodeName===name;};var hasContentEditableFalseParent=function hasContentEditableFalseParent(body,node){while(node&&node!==body){if(isContentEditableFalse$b(node)){return true;}node=node.parentNode;}return false;};var findTextNodeRelative=function findTextNodeRelative(dom,isAfterNode,collapsed,left,startNode){var lastInlineElement;var body=dom.getRoot();var node;var nonEmptyElementsMap=dom.schema.getNonEmptyElements();var parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body;if(left&&isBr$5(startNode)&&isAfterNode&&dom.isEmpty(parentBlockContainer)){return Optional.some(_CaretPosition(startNode.parentNode,dom.nodeIndex(startNode)));}var walker=new DomTreeWalker(startNode,parentBlockContainer);while(node=walker[left?'prev':'next']()){if(dom.getContentEditableParent(node)==='false'||isCeFalseCaretContainer(node,body)){return Optional.none();}if(isText$7(node)&&node.nodeValue.length>0){if(hasParentWithName(node,body,'A')===false){return Optional.some(_CaretPosition(node,left?node.nodeValue.length:0));}return Optional.none();}if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()]){return Optional.none();}lastInlineElement=node;}if(collapsed&&lastInlineElement){return Optional.some(_CaretPosition(lastInlineElement,0));}return Optional.none();};var normalizeEndPoint=function normalizeEndPoint(dom,collapsed,start,rng){var container,offset;var body=dom.getRoot();var node;var directionLeft,normalized=false;container=rng[(start?'start':'end')+'Container'];offset=rng[(start?'start':'end')+'Offset'];var isAfterNode=isElement$5(container)&&offset===container.childNodes.length;var nonEmptyElementsMap=dom.schema.getNonEmptyElements();directionLeft=start;if(isCaretContainer$2(container)){return Optional.none();}if(isElement$5(container)&&offset>container.childNodes.length-1){directionLeft=false;}if(isDocument$1(container)){container=body;offset=0;}if(container===body){if(directionLeft){node=container.childNodes[offset>0?offset-1:0];if(node){if(isCaretContainer$2(node)){return Optional.none();}if(nonEmptyElementsMap[node.nodeName]||isTable(node)){return Optional.none();}}}if(container.hasChildNodes()){offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1);container=container.childNodes[offset];offset=isText$7(container)&&isAfterNode?container.data.length:0;if(!collapsed&&container===body.lastChild&&isTable(container)){return Optional.none();}if(hasContentEditableFalseParent(body,container)||isCaretContainer$2(container)){return Optional.none();}if(container.hasChildNodes()&&isTable(container)===false){node=container;var walker=new DomTreeWalker(container,body);do{if(isContentEditableFalse$b(node)||isCaretContainer$2(node)){normalized=false;break;}if(isText$7(node)&&node.nodeValue.length>0){offset=directionLeft?0:node.nodeValue.length;container=node;normalized=true;break;}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCell$2(node)){offset=dom.nodeIndex(node);container=node.parentNode;if(!directionLeft){offset++;}normalized=true;break;}}while(node=directionLeft?walker.next():walker.prev());}}}if(collapsed){if(isText$7(container)&&offset===0){findTextNodeRelative(dom,isAfterNode,collapsed,true,container).each(function(pos){container=pos.container();offset=pos.offset();normalized=true;});}if(isElement$5(container)){node=container.childNodes[offset];if(!node){node=container.childNodes[offset-1];}if(node&&isBr$5(node)&&!isPrevNode(node,'A')&&!hasBrBeforeAfter(dom,node,false)&&!hasBrBeforeAfter(dom,node,true)){findTextNodeRelative(dom,isAfterNode,collapsed,true,node).each(function(pos){container=pos.container();offset=pos.offset();normalized=true;});}}}if(directionLeft&&!collapsed&&isText$7(container)&&offset===container.nodeValue.length){findTextNodeRelative(dom,isAfterNode,collapsed,false,container).each(function(pos){container=pos.container();offset=pos.offset();normalized=true;});}return normalized?Optional.some(_CaretPosition(container,offset)):Optional.none();};var normalize$2=function normalize$2(dom,rng){var collapsed=rng.collapsed,normRng=rng.cloneRange();var startPos=_CaretPosition.fromRangeStart(rng);normalizeEndPoint(dom,collapsed,true,normRng).each(function(pos){if(!collapsed||!_CaretPosition.isAbove(startPos,pos)){normRng.setStart(pos.container(),pos.offset());}});if(!collapsed){normalizeEndPoint(dom,collapsed,false,normRng).each(function(pos){normRng.setEnd(pos.container(),pos.offset());});}if(collapsed){normRng.collapse(true);}return isEq$4(rng,normRng)?Optional.none():Optional.some(normRng);};var splitText=function splitText(node,offset){return node.splitText(offset);};var split=function split(rng){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if(startContainer===endContainer&&isText$7(startContainer)){if(startOffset>0&&startOffset<startContainer.nodeValue.length){endContainer=splitText(startContainer,startOffset);startContainer=endContainer.previousSibling;if(endOffset>startOffset){endOffset=endOffset-startOffset;startContainer=endContainer=splitText(endContainer,endOffset).previousSibling;endOffset=endContainer.nodeValue.length;startOffset=0;}else{endOffset=0;}}}else{if(isText$7(startContainer)&&startOffset>0&&startOffset<startContainer.nodeValue.length){startContainer=splitText(startContainer,startOffset);startOffset=0;}if(isText$7(endContainer)&&endOffset>0&&endOffset<endContainer.nodeValue.length){endContainer=splitText(endContainer,endOffset).previousSibling;endOffset=endContainer.nodeValue.length;}}return{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset};};var RangeUtils=function RangeUtils(dom){var walk=function walk(rng,callback){return walk$2(dom,rng,callback);};var split$1=split;var normalize=function normalize(rng){return normalize$2(dom,rng).fold(never,function(normalizedRng){rng.setStart(normalizedRng.startContainer,normalizedRng.startOffset);rng.setEnd(normalizedRng.endContainer,normalizedRng.endOffset);return true;});};return{walk:walk,split:split$1,normalize:normalize};};RangeUtils.compareRanges=isEq$4;RangeUtils.getCaretRangeFromPoint=fromPoint;RangeUtils.getSelectedNode=getSelectedNode;RangeUtils.getNode=getNode$1;var Dimension=function Dimension(name,getOffset){var set=function set(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/)){throw new Error(name+'.set accepts only positive integer values. Value was '+h);}var dom=element.dom;if(isSupported(dom)){dom.style[name]=h+'px';}};var get=function get(element){var r=getOffset(element);if(r<=0||r===null){var css=get$5(element,name);return parseFloat(css)||0;}return r;};var getOuter=get;var aggregate=function aggregate(element,properties){return foldl(properties,function(acc,property){var val=get$5(element,property);var value=val===undefined?0:parseInt(val,10);return isNaN(value)?acc:acc+value;},0);};var max=function max(element,value,properties){var cumulativeInclusions=aggregate(element,properties);var absoluteMax=value>cumulativeInclusions?value-cumulativeInclusions:0;return absoluteMax;};return{set:set,get:get,getOuter:getOuter,aggregate:aggregate,max:max};};var api=Dimension('height',function(element){var dom=element.dom;return _inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight;});var get$1=function get$1(element){return api.get(element);};var _walkUp=function walkUp(navigation,doc){var frame=navigation.view(doc);return frame.fold(constant([]),function(f){var parent=navigation.owner(f);var rest=_walkUp(navigation,parent);return[f].concat(rest);});};var pathTo=function pathTo(element,navigation){var d=navigation.owner(element);return _walkUp(navigation,d);};var view=function view(doc){var _a;var element=doc.dom===document?Optional.none():Optional.from((_a=doc.dom.defaultView)===null||_a===void 0?void 0:_a.frameElement);return element.map(SugarElement.fromDom);};var owner=function owner(element){return documentOrOwner(element);};var Navigation=/*#__PURE__*/Object.freeze({__proto__:null,view:view,owner:owner});var find$1=function find$1(element){var doc=SugarElement.fromDom(document);var scroll=get$8(doc);var frames=pathTo(element,Navigation);var offset=viewport(element);var r=foldr(frames,function(b,a){var loc=viewport(a);return{left:b.left+loc.left,top:b.top+loc.top};},{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top);};var excludeFromDescend=function excludeFromDescend(element){return name(element)==='textarea';};var fireScrollIntoViewEvent=function fireScrollIntoViewEvent(editor,data){var scrollEvent=editor.fire('ScrollIntoView',data);return scrollEvent.isDefaultPrevented();};var fireAfterScrollIntoViewEvent=function fireAfterScrollIntoViewEvent(editor,data){editor.fire('AfterScrollIntoView',data);};var descend=function descend(element,offset){var children$1=children(element);if(children$1.length===0||excludeFromDescend(element)){return{element:element,offset:offset};}else if(offset<children$1.length&&!excludeFromDescend(children$1[offset])){return{element:children$1[offset],offset:0};}else{var last=children$1[children$1.length-1];if(excludeFromDescend(last)){return{element:element,offset:offset};}else{if(name(last)==='img'){return{element:last,offset:1};}else if(isText$8(last)){return{element:last,offset:get$2(last).length};}else{return{element:last,offset:children(last).length};}}}};var markerInfo=function markerInfo(element,cleanupFun){var pos=absolute(element);var height=get$1(element);return{element:element,bottom:pos.top+height,height:height,pos:pos,cleanup:cleanupFun};};var createMarker=function createMarker(element,offset){var startPoint=descend(element,offset);var span=SugarElement.fromHtml('<span data-mce-bogus=\"all\" style=\"display: inline-block;\">'+ZWSP$1+'</span>');before$4(startPoint.element,span);return markerInfo(span,function(){return remove$7(span);});};var elementMarker=function elementMarker(element){return markerInfo(SugarElement.fromDom(element),noop);};var withMarker=function withMarker(editor,f,rng,alignToTop){preserveWith(editor,function(_s,_e){return applyWithMarker(editor,f,rng,alignToTop);},rng);};var withScrollEvents=function withScrollEvents(editor,doc,f,marker,alignToTop){var data={elm:marker.element.dom,alignToTop:alignToTop};if(fireScrollIntoViewEvent(editor,data)){return;}var scrollTop=get$8(doc).top;f(doc,scrollTop,marker,alignToTop);fireAfterScrollIntoViewEvent(editor,data);};var applyWithMarker=function applyWithMarker(editor,f,rng,alignToTop){var body=SugarElement.fromDom(editor.getBody());var doc=SugarElement.fromDom(editor.getDoc());reflow(body);var marker=createMarker(SugarElement.fromDom(rng.startContainer),rng.startOffset);withScrollEvents(editor,doc,f,marker,alignToTop);marker.cleanup();};var withElement=function withElement(editor,element,f,alignToTop){var doc=SugarElement.fromDom(editor.getDoc());withScrollEvents(editor,doc,f,elementMarker(element),alignToTop);};var preserveWith=function preserveWith(editor,f,rng){var startElement=rng.startContainer;var startOffset=rng.startOffset;var endElement=rng.endContainer;var endOffset=rng.endOffset;f(SugarElement.fromDom(startElement),SugarElement.fromDom(endElement));var newRng=editor.dom.createRng();newRng.setStart(startElement,startOffset);newRng.setEnd(endElement,endOffset);editor.selection.setRng(rng);};var scrollToMarker=function scrollToMarker(marker,viewHeight,alignToTop,doc){var pos=marker.pos;if(alignToTop){to(pos.left,pos.top,doc);}else{var y=pos.top-viewHeight+marker.height;to(pos.left,y,doc);}};var intoWindowIfNeeded=function intoWindowIfNeeded(doc,scrollTop,viewHeight,marker,alignToTop){var viewportBottom=viewHeight+scrollTop;var markerTop=marker.pos.top;var markerBottom=marker.bottom;var largerThanViewport=markerBottom-markerTop>=viewHeight;if(markerTop<scrollTop){scrollToMarker(marker,viewHeight,alignToTop!==false,doc);}else if(markerTop>viewportBottom){var align=largerThanViewport?alignToTop!==false:alignToTop===true;scrollToMarker(marker,viewHeight,align,doc);}else if(markerBottom>viewportBottom&&!largerThanViewport){scrollToMarker(marker,viewHeight,alignToTop===true,doc);}};var intoWindow=function intoWindow(doc,scrollTop,marker,alignToTop){var viewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,viewHeight,marker,alignToTop);};var intoFrame=function intoFrame(doc,scrollTop,marker,alignToTop){var frameViewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,frameViewHeight,marker,alignToTop);var op=find$1(marker.element);var viewportBounds=getBounds(window);if(op.top<viewportBounds.y){intoView(marker.element,alignToTop!==false);}else if(op.top>viewportBounds.bottom){intoView(marker.element,alignToTop===true);}};var rangeIntoWindow=function rangeIntoWindow(editor,rng,alignToTop){return withMarker(editor,intoWindow,rng,alignToTop);};var elementIntoWindow=function elementIntoWindow(editor,element,alignToTop){return withElement(editor,element,intoWindow,alignToTop);};var rangeIntoFrame=function rangeIntoFrame(editor,rng,alignToTop){return withMarker(editor,intoFrame,rng,alignToTop);};var elementIntoFrame=function elementIntoFrame(editor,element,alignToTop){return withElement(editor,element,intoFrame,alignToTop);};var scrollElementIntoView=function scrollElementIntoView(editor,element,alignToTop){var scroller=editor.inline?elementIntoWindow:elementIntoFrame;scroller(editor,element,alignToTop);};var scrollRangeIntoView=function scrollRangeIntoView(editor,rng,alignToTop){var scroller=editor.inline?rangeIntoWindow:rangeIntoFrame;scroller(editor,rng,alignToTop);};var getDocument=function getDocument(){return SugarElement.fromDom(document);};var focus$1=function focus$1(element){return element.dom.focus();};var hasFocus$1=function hasFocus$1(element){var root=getRootNode(element).dom;return element.dom===root.activeElement;};var active=function active(root){if(root===void 0){root=getDocument();}return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);};var search=function search(element){return active(getRootNode(element)).filter(function(e){return element.dom.contains(e.dom);});};var create$5=function create$5(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset};};var SimRange={create:create$5};var adt$1=Adt.generate([{before:['element']},{on:['element','offset']},{after:['element']}]);var cata=function cata(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter);};var getStart$2=function getStart$2(situ){return situ.fold(identity,identity,identity);};var before$1=adt$1.before;var on=adt$1.on;var after$1=adt$1.after;var Situ={before:before$1,on:on,after:after$1,cata:cata,getStart:getStart$2};var adt=Adt.generate([{domRange:['rng']},{relative:['startSitu','finishSitu']},{exact:['start','soffset','finish','foffset']}]);var exactFromRange=function exactFromRange(simRange){return adt.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset);};var getStart$1=function getStart$1(selection){return selection.match({domRange:function domRange(rng){return SugarElement.fromDom(rng.startContainer);},relative:function relative(startSitu,_finishSitu){return Situ.getStart(startSitu);},exact:function exact(start,_soffset,_finish,_foffset){return start;}});};var domRange=adt.domRange;var relative=adt.relative;var exact=adt.exact;var getWin=function getWin(selection){var start=getStart$1(selection);return defaultView(start);};var range=SimRange.create;var SimSelection={domRange:domRange,relative:relative,exact:exact,exactFromRange:exactFromRange,getWin:getWin,range:range};var browser$1=detect().browser;var clamp$1=function clamp$1(offset,element){var max=isText$8(element)?get$2(element).length:children(element).length+1;if(offset>max){return max;}else if(offset<0){return 0;}return offset;};var normalizeRng=function normalizeRng(rng){return SimSelection.range(rng.start,clamp$1(rng.soffset,rng.start),rng.finish,clamp$1(rng.foffset,rng.finish));};var isOrContains=function isOrContains(root,elm){return!isRestrictedNode(elm.dom)&&(contains$1(root,elm)||eq(root,elm));};var isRngInRoot=function isRngInRoot(root){return function(rng){return isOrContains(root,rng.start)&&isOrContains(root,rng.finish);};};var shouldStore=function shouldStore(editor){return editor.inline===true||browser$1.isIE();};var nativeRangeToSelectionRange=function nativeRangeToSelectionRange(r){return SimSelection.range(SugarElement.fromDom(r.startContainer),r.startOffset,SugarElement.fromDom(r.endContainer),r.endOffset);};var readRange=function readRange(win){var selection=win.getSelection();var rng=!selection||selection.rangeCount===0?Optional.none():Optional.from(selection.getRangeAt(0));return rng.map(nativeRangeToSelectionRange);};var getBookmark=function getBookmark(root){var win=defaultView(root);return readRange(win.dom).filter(isRngInRoot(root));};var validate=function validate(root,bookmark){return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);};var bookmarkToNativeRng=function bookmarkToNativeRng(bookmark){var rng=document.createRange();try{rng.setStart(bookmark.start.dom,bookmark.soffset);rng.setEnd(bookmark.finish.dom,bookmark.foffset);return Optional.some(rng);}catch(_){return Optional.none();}};var store=function store(editor){var newBookmark=shouldStore(editor)?getBookmark(SugarElement.fromDom(editor.getBody())):Optional.none();editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark;};var storeNative=function storeNative(editor,rng){var root=SugarElement.fromDom(editor.getBody());var range=shouldStore(editor)?Optional.from(rng):Optional.none();var newBookmark=range.map(nativeRangeToSelectionRange).filter(isRngInRoot(root));editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark;};var getRng=function getRng(editor){var bookmark=editor.bookmark?editor.bookmark:Optional.none();return bookmark.bind(function(x){return validate(SugarElement.fromDom(editor.getBody()),x);}).bind(bookmarkToNativeRng);};var restore=function restore(editor){getRng(editor).each(function(rng){return editor.selection.setRng(rng);});};var isEditorUIElement$1=function isEditorUIElement$1(elm){var className=elm.className.toString();return className.indexOf('tox-')!==-1||className.indexOf('mce-')!==-1;};var FocusManager={isEditorUIElement:isEditorUIElement$1};var isManualNodeChange=function isManualNodeChange(e){return e.type==='nodechange'&&e.selectionChange;};var registerPageMouseUp=function registerPageMouseUp(editor,throttledStore){var mouseUpPage=function mouseUpPage(){throttledStore.throttle();};_DOMUtils.DOM.bind(document,'mouseup',mouseUpPage);editor.on('remove',function(){_DOMUtils.DOM.unbind(document,'mouseup',mouseUpPage);});};var registerFocusOut=function registerFocusOut(editor){editor.on('focusout',function(){store(editor);});};var registerMouseUp=function registerMouseUp(editor,throttledStore){editor.on('mouseup touchend',function(_e){throttledStore.throttle();});};var registerEditorEvents=function registerEditorEvents(editor,throttledStore){var browser=detect().browser;if(browser.isIE()){registerFocusOut(editor);}else{registerMouseUp(editor,throttledStore);}editor.on('keyup NodeChange',function(e){if(!isManualNodeChange(e)){store(editor);}});};var register$3=function register$3(editor){var throttledStore=first(function(){store(editor);},0);editor.on('init',function(){if(editor.inline){registerPageMouseUp(editor,throttledStore);}registerEditorEvents(editor,throttledStore);});editor.on('remove',function(){throttledStore.cancel();});};var documentFocusInHandler;var DOM$8=_DOMUtils.DOM;var isEditorUIElement=function isEditorUIElement(elm){return FocusManager.isEditorUIElement(elm);};var isEditorContentAreaElement=function isEditorContentAreaElement(elm){var classList=elm.classList;if(classList!==undefined){return classList.contains('tox-edit-area')||classList.contains('tox-edit-area__iframe')||classList.contains('mce-content-body');}else{return false;}};var isUIElement=function isUIElement(editor,elm){var customSelector=getCustomUiSelector(editor);var parent=DOM$8.getParent(elm,function(elm){return isEditorUIElement(elm)||(customSelector?editor.dom.is(elm,customSelector):false);});return parent!==null;};var getActiveElement=function getActiveElement(editor){try{var root=getRootNode(SugarElement.fromDom(editor.getElement()));return active(root).fold(function(){return document.body;},function(x){return x.dom;});}catch(ex){return document.body;}};var registerEvents$1=function registerEvents$1(editorManager,e){var editor=e.editor;register$3(editor);editor.on('focusin',function(){var focusedEditor=editorManager.focusedEditor;if(focusedEditor!==editor){if(focusedEditor){focusedEditor.fire('blur',{focusedEditor:editor});}editorManager.setActive(editor);editorManager.focusedEditor=editor;editor.fire('focus',{blurredEditor:focusedEditor});editor.focus(true);}});editor.on('focusout',function(){Delay.setEditorTimeout(editor,function(){var focusedEditor=editorManager.focusedEditor;if(!isUIElement(editor,getActiveElement(editor))&&focusedEditor===editor){editor.fire('blur',{focusedEditor:null});editorManager.focusedEditor=null;}});});if(!documentFocusInHandler){documentFocusInHandler=function documentFocusInHandler(e){var activeEditor=editorManager.activeEditor;if(activeEditor){getOriginalEventTarget(e).each(function(target){if(target.ownerDocument===document){if(target!==document.body&&!isUIElement(activeEditor,target)&&editorManager.focusedEditor===activeEditor){activeEditor.fire('blur',{focusedEditor:null});editorManager.focusedEditor=null;}}});}};DOM$8.bind(document,'focusin',documentFocusInHandler);}};var unregisterDocumentEvents=function unregisterDocumentEvents(editorManager,e){if(editorManager.focusedEditor===e.editor){editorManager.focusedEditor=null;}if(!editorManager.activeEditor){DOM$8.unbind(document,'focusin',documentFocusInHandler);documentFocusInHandler=null;}};var setup$l=function setup$l(editorManager){editorManager.on('AddEditor',curry(registerEvents$1,editorManager));editorManager.on('RemoveEditor',curry(unregisterDocumentEvents,editorManager));};var getContentEditableHost=function getContentEditableHost(editor,node){return editor.dom.getParent(node,function(node){return editor.dom.getContentEditable(node)==='true';});};var getCollapsedNode=function getCollapsedNode(rng){return rng.collapsed?Optional.from(getNode$1(rng.startContainer,rng.startOffset)).map(SugarElement.fromDom):Optional.none();};var getFocusInElement=function getFocusInElement(root,rng){return getCollapsedNode(rng).bind(function(node){if(isTableSection(node)){return Optional.some(node);}else if(contains$1(root,node)===false){return Optional.some(root);}else{return Optional.none();}});};var normalizeSelection$1=function normalizeSelection$1(editor,rng){getFocusInElement(SugarElement.fromDom(editor.getBody()),rng).bind(function(elm){return firstPositionIn(elm.dom);}).fold(function(){editor.selection.normalize();return;},function(caretPos){return editor.selection.setRng(caretPos.toRange());});};var focusBody=function focusBody(body){if(body.setActive){try{body.setActive();}catch(ex){body.focus();}}else{body.focus();}};var hasElementFocus=function hasElementFocus(elm){return hasFocus$1(elm)||search(elm).isSome();};var hasIframeFocus=function hasIframeFocus(editor){return editor.iframeElement&&hasFocus$1(SugarElement.fromDom(editor.iframeElement));};var hasInlineFocus=function hasInlineFocus(editor){var rawBody=editor.getBody();return rawBody&&hasElementFocus(SugarElement.fromDom(rawBody));};var hasUiFocus=function hasUiFocus(editor){var dos=getRootNode(SugarElement.fromDom(editor.getElement()));return active(dos).filter(function(elem){return!isEditorContentAreaElement(elem.dom)&&isUIElement(editor,elem.dom);}).isSome();};var hasFocus=function hasFocus(editor){return editor.inline?hasInlineFocus(editor):hasIframeFocus(editor);};var hasEditorOrUiFocus=function hasEditorOrUiFocus(editor){return hasFocus(editor)||hasUiFocus(editor);};var focusEditor=function focusEditor(editor){var selection=editor.selection;var body=editor.getBody();var rng=selection.getRng();editor.quirks.refreshContentEditable();if(editor.bookmark!==undefined&&hasFocus(editor)===false){getRng(editor).each(function(bookmarkRng){editor.selection.setRng(bookmarkRng);rng=bookmarkRng;});}var contentEditableHost=getContentEditableHost(editor,selection.getNode());if(editor.$.contains(body,contentEditableHost)){focusBody(contentEditableHost);normalizeSelection$1(editor,rng);activateEditor(editor);return;}if(!editor.inline){if(!Env.opera){focusBody(body);}editor.getWin().focus();}if(Env.gecko||editor.inline){focusBody(body);normalizeSelection$1(editor,rng);}activateEditor(editor);};var activateEditor=function activateEditor(editor){return editor.editorManager.setActive(editor);};var focus=function focus(editor,skipFocus){if(editor.removed){return;}if(skipFocus){activateEditor(editor);}else{focusEditor(editor);}};var getEndpointElement=function getEndpointElement(root,rng,start,real,resolve){var container=start?rng.startContainer:rng.endContainer;var offset=start?rng.startOffset:rng.endOffset;return Optional.from(container).map(SugarElement.fromDom).map(function(elm){return!real||!rng.collapsed?child$1(elm,resolve(elm,offset)).getOr(elm):elm;}).bind(function(elm){return isElement$6(elm)?Optional.some(elm):parent(elm).filter(isElement$6);}).map(function(elm){return elm.dom;}).getOr(root);};var getStart=function getStart(root,rng,real){return getEndpointElement(root,rng,true,real,function(elm,offset){return Math.min(childNodesCount(elm),offset);});};var getEnd=function getEnd(root,rng,real){return getEndpointElement(root,rng,false,real,function(elm,offset){return offset>0?offset-1:offset;});};var skipEmptyTextNodes=function skipEmptyTextNodes(node,forwards){var orig=node;while(node&&isText$7(node)&&node.length===0){node=forwards?node.nextSibling:node.previousSibling;}return node||orig;};var getNode=function getNode(root,rng){var elm,startContainer,endContainer;if(!rng){return root;}startContainer=rng.startContainer;endContainer=rng.endContainer;var startOffset=rng.startOffset;var endOffset=rng.endOffset;elm=rng.commonAncestorContainer;if(!rng.collapsed){if(startContainer===endContainer){if(endOffset-startOffset<2){if(startContainer.hasChildNodes()){elm=startContainer.childNodes[startOffset];}}}if(startContainer.nodeType===3&&endContainer.nodeType===3){if(startContainer.length===startOffset){startContainer=skipEmptyTextNodes(startContainer.nextSibling,true);}else{startContainer=startContainer.parentNode;}if(endOffset===0){endContainer=skipEmptyTextNodes(endContainer.previousSibling,false);}else{endContainer=endContainer.parentNode;}if(startContainer&&startContainer===endContainer){return startContainer;}}}if(elm&&elm.nodeType===3){return elm.parentNode;}return elm;};var getSelectedBlocks=function getSelectedBlocks(dom,rng,startElm,endElm){var node;var selectedBlocks=[];var root=dom.getRoot();startElm=dom.getParent(startElm||getStart(root,rng,rng.collapsed),dom.isBlock);endElm=dom.getParent(endElm||getEnd(root,rng,rng.collapsed),dom.isBlock);if(startElm&&startElm!==root){selectedBlocks.push(startElm);}if(startElm&&endElm&&startElm!==endElm){node=startElm;var walker=new DomTreeWalker(startElm,root);while((node=walker.next())&&node!==endElm){if(dom.isBlock(node)){selectedBlocks.push(node);}}}if(endElm&&startElm!==endElm&&endElm!==root){selectedBlocks.push(endElm);}return selectedBlocks;};var select=function select(dom,node,content){return Optional.from(node).map(function(node){var idx=dom.nodeIndex(node);var rng=dom.createRng();rng.setStart(node.parentNode,idx);rng.setEnd(node.parentNode,idx+1);if(content){moveEndPoint(dom,rng,node,true);moveEndPoint(dom,rng,node,false);}return rng;});};var processRanges=function processRanges(editor,ranges){return map$3(ranges,function(range){var evt=editor.fire('GetSelectionRange',{range:range});return evt.range!==range?evt.range:range;});};var typeLookup={'#text':3,'#comment':8,'#cdata':4,'#pi':7,'#doctype':10,'#document-fragment':11};var walk$1=function walk$1(node,root,prev){var startName=prev?'lastChild':'firstChild';var siblingName=prev?'prev':'next';if(node[startName]){return node[startName];}if(node!==root){var sibling=node[siblingName];if(sibling){return sibling;}for(var parent_1=node.parent;parent_1&&parent_1!==root;parent_1=parent_1.parent){sibling=parent_1[siblingName];if(sibling){return sibling;}}}};var isEmptyTextNode=function isEmptyTextNode(node){if(!isWhitespaceText(node.value)){return false;}var parentNode=node.parent;if(parentNode&&(parentNode.name!=='span'||parentNode.attr('style'))&&/^[ ]+$/.test(node.value)){return false;}return true;};var isNonEmptyElement=function isNonEmptyElement(node){var isNamedAnchor=node.name==='a'&&!node.attr('href')&&node.attr('id');return node.attr('name')||node.attr('id')&&!node.firstChild||node.attr('data-mce-bookmark')||isNamedAnchor;};var AstNode=function(){function AstNode(name,type){this.name=name;this.type=type;if(type===1){this.attributes=[];this.attributes.map={};}}AstNode.create=function(name,attrs){var node=new AstNode(name,typeLookup[name]||1);if(attrs){each$j(attrs,function(value,attrName){node.attr(attrName,value);});}return node;};AstNode.prototype.replace=function(node){var self=this;if(node.parent){node.remove();}self.insert(node,self);self.remove();return self;};AstNode.prototype.attr=function(name,value){var self=this;var attrs;if(typeof name!=='string'){if(name!==undefined&&name!==null){each$j(name,function(value,key){self.attr(key,value);});}return self;}if(attrs=self.attributes){if(value!==undefined){if(value===null){if(name in attrs.map){delete attrs.map[name];var i=attrs.length;while(i--){if(attrs[i].name===name){attrs.splice(i,1);return self;}}}return self;}if(name in attrs.map){var i=attrs.length;while(i--){if(attrs[i].name===name){attrs[i].value=value;break;}}}else{attrs.push({name:name,value:value});}attrs.map[name]=value;return self;}return attrs.map[name];}};AstNode.prototype.clone=function(){var self=this;var clone=new AstNode(self.name,self.type);var selfAttrs;if(selfAttrs=self.attributes){var cloneAttrs=[];cloneAttrs.map={};for(var i=0,l=selfAttrs.length;i<l;i++){var selfAttr=selfAttrs[i];if(selfAttr.name!=='id'){cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value};cloneAttrs.map[selfAttr.name]=selfAttr.value;}}clone.attributes=cloneAttrs;}clone.value=self.value;clone.shortEnded=self.shortEnded;return clone;};AstNode.prototype.wrap=function(wrapper){var self=this;self.parent.insert(wrapper,self);wrapper.append(self);return self;};AstNode.prototype.unwrap=function(){var self=this;for(var node=self.firstChild;node;){var next=node.next;self.insert(node,self,true);node=next;}self.remove();};AstNode.prototype.remove=function(){var self=this,parent=self.parent,next=self.next,prev=self.prev;if(parent){if(parent.firstChild===self){parent.firstChild=next;if(next){next.prev=null;}}else{prev.next=next;}if(parent.lastChild===self){parent.lastChild=prev;if(prev){prev.next=null;}}else{next.prev=prev;}self.parent=self.next=self.prev=null;}return self;};AstNode.prototype.append=function(node){var self=this;if(node.parent){node.remove();}var last=self.lastChild;if(last){last.next=node;node.prev=last;self.lastChild=node;}else{self.lastChild=self.firstChild=node;}node.parent=self;return node;};AstNode.prototype.insert=function(node,refNode,before){if(node.parent){node.remove();}var parent=refNode.parent||this;if(before){if(refNode===parent.firstChild){parent.firstChild=node;}else{refNode.prev.next=node;}node.prev=refNode.prev;node.next=refNode;refNode.prev=node;}else{if(refNode===parent.lastChild){parent.lastChild=node;}else{refNode.next.prev=node;}node.next=refNode.next;node.prev=refNode;refNode.next=node;}node.parent=parent;return node;};AstNode.prototype.getAll=function(name){var self=this;var collection=[];for(var node=self.firstChild;node;node=walk$1(node,self)){if(node.name===name){collection.push(node);}}return collection;};AstNode.prototype.children=function(){var self=this;var collection=[];for(var node=self.firstChild;node;node=node.next){collection.push(node);}return collection;};AstNode.prototype.empty=function(){var self=this;if(self.firstChild){var nodes=[];for(var node=self.firstChild;node;node=walk$1(node,self)){nodes.push(node);}var i=nodes.length;while(i--){var node=nodes[i];node.parent=node.firstChild=node.lastChild=node.next=node.prev=null;}}self.firstChild=self.lastChild=null;return self;};AstNode.prototype.isEmpty=function(elements,whitespace,predicate){if(whitespace===void 0){whitespace={};}var self=this;var node=self.firstChild;if(isNonEmptyElement(self)){return false;}if(node){do{if(node.type===1){if(node.attr('data-mce-bogus')){continue;}if(elements[node.name]){return false;}if(isNonEmptyElement(node)){return false;}}if(node.type===8){return false;}if(node.type===3&&!isEmptyTextNode(node)){return false;}if(node.type===3&&node.parent&&whitespace[node.parent.name]&&isWhitespaceText(node.value)){return false;}if(predicate&&predicate(node)){return false;}}while(node=walk$1(node,self));}return true;};AstNode.prototype.walk=function(prev){return walk$1(this,null,prev);};return AstNode;}();var unescapedTextParents=Tools.makeMap('NOSCRIPT STYLE SCRIPT XMP IFRAME NOEMBED NOFRAMES PLAINTEXT',' ');var containsZwsp=function containsZwsp(node){return isString$1(node.nodeValue)&&contains$2(node.nodeValue,ZWSP$1);};var getTemporaryNodeSelector=function getTemporaryNodeSelector(tempAttrs){return(tempAttrs.length===0?'':map$3(tempAttrs,function(attr){return'['+attr+']';}).join(',')+',')+'[data-mce-bogus=\"all\"]';};var getTemporaryNodes=function getTemporaryNodes(tempAttrs,body){return body.querySelectorAll(getTemporaryNodeSelector(tempAttrs));};var createWalker=function createWalker(body,whatToShow,filter){return document.createTreeWalker(body,whatToShow,filter,false);};var createZwspCommentWalker=function createZwspCommentWalker(body){return createWalker(body,NodeFilter.SHOW_COMMENT,function(node){return containsZwsp(node)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP;});};var createUnescapedZwspTextWalker=function createUnescapedZwspTextWalker(body){return createWalker(body,NodeFilter.SHOW_TEXT,function(node){if(containsZwsp(node)){var parent_1=node.parentNode;return parent_1&&has$2(unescapedTextParents,parent_1.nodeName)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP;}else{return NodeFilter.FILTER_SKIP;}});};var hasZwspComment=function hasZwspComment(body){return createZwspCommentWalker(body).nextNode()!==null;};var hasUnescapedZwspText=function hasUnescapedZwspText(body){return createUnescapedZwspTextWalker(body).nextNode()!==null;};var hasTemporaryNode=function hasTemporaryNode(tempAttrs,body){return body.querySelector(getTemporaryNodeSelector(tempAttrs))!==null;};var trimTemporaryNodes=function trimTemporaryNodes(tempAttrs,body){each$k(getTemporaryNodes(tempAttrs,body),function(elm){var element=SugarElement.fromDom(elm);if(get$6(element,'data-mce-bogus')==='all'){remove$7(element);}else{each$k(tempAttrs,function(attr){if(has$1(element,attr)){remove$6(element,attr);}});}});};var emptyAllNodeValuesInWalker=function emptyAllNodeValuesInWalker(walker){var curr=walker.nextNode();while(curr!==null){curr.nodeValue=null;curr=walker.nextNode();}};var emptyZwspComments=compose(emptyAllNodeValuesInWalker,createZwspCommentWalker);var emptyUnescapedZwspTexts=compose(emptyAllNodeValuesInWalker,createUnescapedZwspTextWalker);var trim$1=function trim$1(body,tempAttrs){var conditionalTrims=[{condition:curry(hasTemporaryNode,tempAttrs),action:curry(trimTemporaryNodes,tempAttrs)},{condition:hasZwspComment,action:emptyZwspComments},{condition:hasUnescapedZwspText,action:emptyUnescapedZwspTexts}];var trimmed=body;var cloned=false;each$k(conditionalTrims,function(_a){var condition=_a.condition,action=_a.action;if(condition(trimmed)){if(!cloned){trimmed=body.cloneNode(true);cloned=true;}action(trimmed);}});return trimmed;};var trimEmptyContents=function trimEmptyContents(editor,html){var blockName=getForcedRootBlock(editor);var emptyRegExp=new RegExp('^(<'+blockName+'[^>]*>(&nbsp;|&#160;|\\\\s|\\xA0|<br \\\\/>|)<\\\\/'+blockName+'>[\\r\\n]*|<br \\\\/>[\\r\\n]*)$');return html.replace(emptyRegExp,'');};var setupArgs$3=function setupArgs$3(args,format){return _assign(_assign({},args),{format:format,get:true,getInner:true});};var getContentFromBody=function getContentFromBody(editor,args,format,body){var defaultedArgs=setupArgs$3(args,format);var updatedArgs=args.no_events?defaultedArgs:editor.fire('BeforeGetContent',defaultedArgs);var content;if(updatedArgs.format==='raw'){content=Tools.trim(trim$3(trim$1(body,editor.serializer.getTempAttrs()).innerHTML));}else if(updatedArgs.format==='text'){content=editor.dom.isEmpty(body)?'':trim$3(body.innerText||body.textContent);}else if(updatedArgs.format==='tree'){content=editor.serializer.serialize(body,updatedArgs);}else{content=trimEmptyContents(editor,editor.serializer.serialize(body,updatedArgs));}if(!contains$3(['text','tree'],updatedArgs.format)&&!isWsPreserveElement(SugarElement.fromDom(body))){updatedArgs.content=Tools.trim(content);}else{updatedArgs.content=content;}if(updatedArgs.no_events){return updatedArgs.content;}else{return editor.fire('GetContent',updatedArgs).content;}};var getContentInternal=function getContentInternal(editor,args,format){return Optional.from(editor.getBody()).fold(constant(args.format==='tree'?new AstNode('body',11):''),function(body){return getContentFromBody(editor,args,format,body);});};var each$d=Tools.each;var ElementUtils=function ElementUtils(dom){var compare=function compare(node1,node2){if(node1.nodeName!==node2.nodeName){return false;}var getAttribs=function getAttribs(node){var attribs={};each$d(dom.getAttribs(node),function(attr){var name=attr.nodeName.toLowerCase();if(name.indexOf('_')!==0&&name!=='style'&&name.indexOf('data-')!==0){attribs[name]=dom.getAttrib(node,name);}});return attribs;};var compareObjects=function compareObjects(obj1,obj2){var value,name;for(name in obj1){if(has$2(obj1,name)){value=obj2[name];if(typeof value==='undefined'){return false;}if(obj1[name]!==value){return false;}delete obj2[name];}}for(name in obj2){if(has$2(obj2,name)){return false;}}return true;};if(!compareObjects(getAttribs(node1),getAttribs(node2))){return false;}if(!compareObjects(dom.parseStyle(dom.getAttrib(node1,'style')),dom.parseStyle(dom.getAttrib(node2,'style')))){return false;}return!isBookmarkNode$1(node1)&&!isBookmarkNode$1(node2);};return{compare:compare};};var makeMap$1=Tools.makeMap;var Writer=function Writer(settings){var html=[];settings=settings||{};var indent=settings.indent;var indentBefore=makeMap$1(settings.indent_before||'');var indentAfter=makeMap$1(settings.indent_after||'');var encode=Entities.getEncodeFunc(settings.entity_encoding||'raw',settings.entities);var htmlOutput=settings.element_format==='html';return{start:function start(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=='\\n'){html.push('\\n');}}html.push('<',name);if(attrs){for(i=0,l=attrs.length;i<l;i++){attr=attrs[i];html.push(' ',attr.name,'=\"',encode(attr.value,true),'\"');}}if(!empty||htmlOutput){html[html.length]='>';}else{html[html.length]=' />';}if(empty&&indent&&indentAfter[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=='\\n'){html.push('\\n');}}},end:function end(name){var value;html.push('</',name,'>');if(indent&&indentAfter[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=='\\n'){html.push('\\n');}}},text:function text(_text,raw){if(_text.length>0){html[html.length]=raw?_text:encode(_text);}},cdata:function cdata(text){html.push('<![CDATA[',text,']]>');},comment:function comment(text){html.push('<!--',text,'-->');},pi:function pi(name,text){if(text){html.push('<?',name,' ',encode(text),'?>');}else{html.push('<?',name,'?>');}if(indent){html.push('\\n');}},doctype:function doctype(text){html.push('<!DOCTYPE',text,'>',indent?'\\n':'');},reset:function reset(){html.length=0;},getContent:function getContent(){return html.join('').replace(/\\n$/,'');}};};var HtmlSerializer=function HtmlSerializer(settings,schema){if(schema===void 0){schema=Schema();}var writer=Writer(settings);settings=settings||{};settings.validate='validate'in settings?settings.validate:true;var serialize=function serialize(node){var validate=settings.validate;var handlers={3:function _(node){writer.text(node.value,node.raw);},8:function _(node){writer.comment(node.value);},7:function _(node){writer.pi(node.name,node.value);},10:function _(node){writer.doctype(node.value);},4:function _(node){writer.cdata(node.value);},11:function _(node){if(node=node.firstChild){do{_walk2(node);}while(node=node.next);}}};writer.reset();var _walk2=function walk(node){var handler=handlers[node.type];if(!handler){var name_1=node.name;var isEmpty=node.shortEnded;var attrs=node.attributes;if(validate&&attrs&&attrs.length>1){var sortedAttrs=[];sortedAttrs.map={};var elementRule=schema.getElementRule(node.name);if(elementRule){for(var i=0,l=elementRule.attributesOrder.length;i<l;i++){var attrName=elementRule.attributesOrder[i];if(attrName in attrs.map){var attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue;sortedAttrs.push({name:attrName,value:attrValue});}}for(var i=0,l=attrs.length;i<l;i++){var attrName=attrs[i].name;if(!(attrName in sortedAttrs.map)){var attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue;sortedAttrs.push({name:attrName,value:attrValue});}}attrs=sortedAttrs;}}writer.start(node.name,attrs,isEmpty);if(!isEmpty){if(node=node.firstChild){do{_walk2(node);}while(node=node.next);}writer.end(name_1);}}else{handler(node);}};if(node.type===1&&!settings.inner){_walk2(node);}else{handlers[11](node);}return writer.getContent();};return{serialize:serialize};};var nonInheritableStyles=new Set();(function(){var nonInheritableStylesArr=['margin','margin-left','margin-right','margin-top','margin-bottom','padding','padding-left','padding-right','padding-top','padding-bottom','border','border-width','border-style','border-color','background','background-attachment','background-clip','background-color','background-image','background-origin','background-position','background-repeat','background-size','float','position','left','right','top','bottom','z-index','display','transform','width','max-width','min-width','height','max-height','min-height','overflow','overflow-x','overflow-y','text-overflow','vertical-align','transition','transition-delay','transition-duration','transition-property','transition-timing-function'];each$k(nonInheritableStylesArr,function(style){nonInheritableStyles.add(style);});})();var shorthandStyleProps=['font','text-decoration','text-emphasis'];var getStyleProps=function getStyleProps(dom,node){return keys(dom.parseStyle(dom.getAttrib(node,'style')));};var isNonInheritableStyle=function isNonInheritableStyle(style){return nonInheritableStyles.has(style);};var hasInheritableStyles=function hasInheritableStyles(dom,node){return forall(getStyleProps(dom,node),function(style){return!isNonInheritableStyle(style);});};var getLonghandStyleProps=function getLonghandStyleProps(styles){return filter$4(styles,function(style){return exists(shorthandStyleProps,function(prop){return startsWith(style,prop);});});};var hasStyleConflict=function hasStyleConflict(dom,node,parentNode){var nodeStyleProps=getStyleProps(dom,node);var parentNodeStyleProps=getStyleProps(dom,parentNode);var valueMismatch=function valueMismatch(prop){var nodeValue=dom.getStyle(node,prop);var parentValue=dom.getStyle(parentNode,prop);return isNotEmpty(nodeValue)&&isNotEmpty(parentValue)&&nodeValue!==parentValue;};return exists(nodeStyleProps,function(nodeStyleProp){var propExists=function propExists(props){return exists(props,function(prop){return prop===nodeStyleProp;});};if(!propExists(parentNodeStyleProps)&&propExists(shorthandStyleProps)){var longhandProps=getLonghandStyleProps(parentNodeStyleProps);return exists(longhandProps,valueMismatch);}else{return valueMismatch(nodeStyleProp);}});};var isChar=function isChar(forward,predicate,pos){return Optional.from(pos.container()).filter(isText$7).exists(function(text){var delta=forward?0:-1;return predicate(text.data.charAt(pos.offset()+delta));});};var isBeforeSpace=curry(isChar,true,isWhiteSpace);var isAfterSpace=curry(isChar,false,isWhiteSpace);var isEmptyText=function isEmptyText(pos){var container=pos.container();return isText$7(container)&&(container.data.length===0||isZwsp(container.data)&&BookmarkManager.isBookmarkNode(container.parentNode));};var matchesElementPosition=function matchesElementPosition(before,predicate){return function(pos){return Optional.from(getChildNodeAtRelativeOffset(before?0:-1,pos)).filter(predicate).isSome();};};var isImageBlock=function isImageBlock(node){return isImg(node)&&get$5(SugarElement.fromDom(node),'display')==='block';};var isCefNode=function isCefNode(node){return isContentEditableFalse$b(node)&&!isBogusAll$1(node);};var isBeforeImageBlock=matchesElementPosition(true,isImageBlock);var isAfterImageBlock=matchesElementPosition(false,isImageBlock);var isBeforeMedia=matchesElementPosition(true,isMedia$2);var isAfterMedia=matchesElementPosition(false,isMedia$2);var isBeforeTable=matchesElementPosition(true,isTable$3);var isAfterTable=matchesElementPosition(false,isTable$3);var isBeforeContentEditableFalse=matchesElementPosition(true,isCefNode);var isAfterContentEditableFalse=matchesElementPosition(false,isCefNode);var getLastChildren=function getLastChildren(elm){var children=[];var rawNode=elm.dom;while(rawNode){children.push(SugarElement.fromDom(rawNode));rawNode=rawNode.lastChild;}return children;};var removeTrailingBr=function removeTrailingBr(elm){var allBrs=descendants(elm,'br');var brs=filter$4(getLastChildren(elm).slice(-1),isBr$4);if(allBrs.length===brs.length){each$k(brs,remove$7);}};var fillWithPaddingBr=function fillWithPaddingBr(elm){empty(elm);append$1(elm,SugarElement.fromHtml('<br data-mce-bogus=\"1\">'));};var trimBlockTrailingBr=function trimBlockTrailingBr(elm){lastChild(elm).each(function(lastChild){prevSibling(lastChild).each(function(lastChildPrevSibling){if(isBlock$2(elm)&&isBr$4(lastChild)&&isBlock$2(lastChildPrevSibling)){remove$7(lastChild);}});});};var dropLast=function dropLast(xs){return xs.slice(0,-1);};var parentsUntil=function parentsUntil(start,root,predicate){if(contains$1(root,start)){return dropLast(parents$1(start,function(elm){return predicate(elm)||eq(elm,root);}));}else{return[];}};var parents=function parents(start,root){return parentsUntil(start,root,never);};var parentsAndSelf=function parentsAndSelf(start,root){return[start].concat(parents(start,root));};var navigateIgnoreEmptyTextNodes=function navigateIgnoreEmptyTextNodes(forward,root,from){return _navigateIgnore(forward,root,from,isEmptyText);};var getClosestBlock$1=function getClosestBlock$1(root,pos){return find$3(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);};var isAtBeforeAfterBlockBoundary=function isAtBeforeAfterBlockBoundary(forward,root,pos){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall(function(newPos){return getClosestBlock$1(root,pos).fold(function(){return isInSameBlock(newPos,pos,root.dom)===false;},function(fromBlock){return isInSameBlock(newPos,pos,root.dom)===false&&contains$1(fromBlock,SugarElement.fromDom(newPos.container()));});});};var isAtBlockBoundary=function isAtBlockBoundary(forward,root,pos){return getClosestBlock$1(root,pos).fold(function(){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall(function(newPos){return isInSameBlock(newPos,pos,root.dom)===false;});},function(parent){return navigateIgnoreEmptyTextNodes(forward,parent.dom,pos).isNone();});};var isAtStartOfBlock=curry(isAtBlockBoundary,false);var isAtEndOfBlock=curry(isAtBlockBoundary,true);var isBeforeBlock=curry(isAtBeforeAfterBlockBoundary,false);var isAfterBlock=curry(isAtBeforeAfterBlockBoundary,true);var isBr=function isBr(pos){return getElementFromPosition(pos).exists(isBr$4);};var findBr=function findBr(forward,root,pos){var parentBlocks=filter$4(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);var scope=head(parentBlocks).getOr(root);return fromPosition(forward,scope.dom,pos).filter(isBr);};var isBeforeBr$1=function isBeforeBr$1(root,pos){return getElementFromPosition(pos).exists(isBr$4)||findBr(true,root,pos).isSome();};var isAfterBr=function isAfterBr(root,pos){return getElementFromPrevPosition(pos).exists(isBr$4)||findBr(false,root,pos).isSome();};var findPreviousBr=curry(findBr,false);var findNextBr=curry(findBr,true);var isInMiddleOfText=function isInMiddleOfText(pos){return _CaretPosition.isTextPosition(pos)&&!pos.isAtStart()&&!pos.isAtEnd();};var getClosestBlock=function getClosestBlock(root,pos){var parentBlocks=filter$4(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);return head(parentBlocks).getOr(root);};var hasSpaceBefore=function hasSpaceBefore(root,pos){if(isInMiddleOfText(pos)){return isAfterSpace(pos);}else{return isAfterSpace(pos)||prevPosition(getClosestBlock(root,pos).dom,pos).exists(isAfterSpace);}};var hasSpaceAfter=function hasSpaceAfter(root,pos){if(isInMiddleOfText(pos)){return isBeforeSpace(pos);}else{return isBeforeSpace(pos)||nextPosition(getClosestBlock(root,pos).dom,pos).exists(isBeforeSpace);}};var isPreValue=function isPreValue(value){return contains$3(['pre','pre-wrap'],value);};var isInPre=function isInPre(pos){return getElementFromPosition(pos).bind(function(elm){return closest$3(elm,isElement$6);}).exists(function(elm){return isPreValue(get$5(elm,'white-space'));});};var isAtBeginningOfBody=function isAtBeginningOfBody(root,pos){return prevPosition(root.dom,pos).isNone();};var isAtEndOfBody=function isAtEndOfBody(root,pos){return nextPosition(root.dom,pos).isNone();};var isAtLineBoundary=function isAtLineBoundary(root,pos){return isAtBeginningOfBody(root,pos)||isAtEndOfBody(root,pos)||isAtStartOfBlock(root,pos)||isAtEndOfBlock(root,pos)||isAfterBr(root,pos)||isBeforeBr$1(root,pos);};var needsToHaveNbsp=function needsToHaveNbsp(root,pos){if(isInPre(pos)){return false;}else{return isAtLineBoundary(root,pos)||hasSpaceBefore(root,pos)||hasSpaceAfter(root,pos);}};var needsToBeNbspLeft=function needsToBeNbspLeft(root,pos){if(isInPre(pos)){return false;}else{return isAtStartOfBlock(root,pos)||isBeforeBlock(root,pos)||isAfterBr(root,pos)||hasSpaceBefore(root,pos);}};var leanRight=function leanRight(pos){var container=pos.container();var offset=pos.offset();if(isText$7(container)&&offset<container.data.length){return _CaretPosition(container,offset+1);}else{return pos;}};var needsToBeNbspRight=function needsToBeNbspRight(root,pos){if(isInPre(pos)){return false;}else{return isAtEndOfBlock(root,pos)||isAfterBlock(root,pos)||isBeforeBr$1(root,pos)||hasSpaceAfter(root,pos);}};var needsToBeNbsp=function needsToBeNbsp(root,pos){return needsToBeNbspLeft(root,pos)||needsToBeNbspRight(root,leanRight(pos));};var isNbspAt=function isNbspAt(text,offset){return isNbsp(text.charAt(offset));};var hasNbsp=function hasNbsp(pos){var container=pos.container();return isText$7(container)&&contains$2(container.data,nbsp);};var normalizeNbspMiddle=function normalizeNbspMiddle(text){var chars=text.split('');return map$3(chars,function(chr,i){if(isNbsp(chr)&&i>0&&i<chars.length-1&&isContent(chars[i-1])&&isContent(chars[i+1])){return' ';}else{return chr;}}).join('');};var normalizeNbspAtStart=function normalizeNbspAtStart(root,node){var text=node.data;var firstPos=_CaretPosition(node,0);if(isNbspAt(text,0)&&!needsToBeNbsp(root,firstPos)){node.data=' '+text.slice(1);return true;}else{return false;}};var normalizeNbspInMiddleOfTextNode=function normalizeNbspInMiddleOfTextNode(node){var text=node.data;var newText=normalizeNbspMiddle(text);if(newText!==text){node.data=newText;return true;}else{return false;}};var normalizeNbspAtEnd=function normalizeNbspAtEnd(root,node){var text=node.data;var lastPos=_CaretPosition(node,text.length-1);if(isNbspAt(text,text.length-1)&&!needsToBeNbsp(root,lastPos)){node.data=text.slice(0,-1)+' ';return true;}else{return false;}};var normalizeNbsps=function normalizeNbsps(root,pos){return Optional.some(pos).filter(hasNbsp).bind(function(pos){var container=pos.container();var normalized=normalizeNbspAtStart(root,container)||normalizeNbspInMiddleOfTextNode(container)||normalizeNbspAtEnd(root,container);return normalized?Optional.some(pos):Optional.none();});};var normalizeNbspsInEditor=function normalizeNbspsInEditor(editor){var root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){normalizeNbsps(root,_CaretPosition.fromRangeStart(editor.selection.getRng())).each(function(pos){editor.selection.setRng(pos.toRange());});}};var normalizeContent=function normalizeContent(content,isStartOfContent,isEndOfContent){var result=foldl(content,function(acc,c){if(isWhiteSpace(c)||isNbsp(c)){if(acc.previousCharIsSpace||acc.str===''&&isStartOfContent||acc.str.length===content.length-1&&isEndOfContent){return{previousCharIsSpace:false,str:acc.str+nbsp};}else{return{previousCharIsSpace:true,str:acc.str+' '};}}else{return{previousCharIsSpace:false,str:acc.str+c};}},{previousCharIsSpace:false,str:''});return result.str;};var normalize$1=function normalize$1(node,offset,count){if(count===0){return;}var elm=SugarElement.fromDom(node);var root=ancestor$3(elm,isBlock$2).getOr(elm);var whitespace=node.data.slice(offset,offset+count);var isEndOfContent=offset+count>=node.data.length&&needsToBeNbspRight(root,_CaretPosition(node,node.data.length));var isStartOfContent=offset===0&&needsToBeNbspLeft(root,_CaretPosition(node,0));node.replaceData(offset,count,normalizeContent(whitespace,isStartOfContent,isEndOfContent));};var normalizeWhitespaceAfter=function normalizeWhitespaceAfter(node,offset){var content=node.data.slice(offset);var whitespaceCount=content.length-lTrim(content).length;normalize$1(node,offset,whitespaceCount);};var normalizeWhitespaceBefore=function normalizeWhitespaceBefore(node,offset){var content=node.data.slice(0,offset);var whitespaceCount=content.length-rTrim(content).length;normalize$1(node,offset-whitespaceCount,whitespaceCount);};var mergeTextNodes=function mergeTextNodes(prevNode,nextNode,normalizeWhitespace,mergeToPrev){if(mergeToPrev===void 0){mergeToPrev=true;}var whitespaceOffset=rTrim(prevNode.data).length;var newNode=mergeToPrev?prevNode:nextNode;var removeNode=mergeToPrev?nextNode:prevNode;if(mergeToPrev){newNode.appendData(removeNode.data);}else{newNode.insertData(0,removeNode.data);}remove$7(SugarElement.fromDom(removeNode));if(normalizeWhitespace){normalizeWhitespaceAfter(newNode,whitespaceOffset);}return newNode;};var needsReposition=function needsReposition(pos,elm){var container=pos.container();var offset=pos.offset();return _CaretPosition.isTextPosition(pos)===false&&container===elm.parentNode&&offset>_CaretPosition.before(elm).offset();};var reposition=function reposition(elm,pos){return needsReposition(pos,elm)?_CaretPosition(pos.container(),pos.offset()-1):pos;};var beforeOrStartOf=function beforeOrStartOf(node){return isText$7(node)?_CaretPosition(node,0):_CaretPosition.before(node);};var afterOrEndOf=function afterOrEndOf(node){return isText$7(node)?_CaretPosition(node,node.data.length):_CaretPosition.after(node);};var getPreviousSiblingCaretPosition=function getPreviousSiblingCaretPosition(elm){if(isCaretCandidate$3(elm.previousSibling)){return Optional.some(afterOrEndOf(elm.previousSibling));}else{return elm.previousSibling?lastPositionIn(elm.previousSibling):Optional.none();}};var getNextSiblingCaretPosition=function getNextSiblingCaretPosition(elm){if(isCaretCandidate$3(elm.nextSibling)){return Optional.some(beforeOrStartOf(elm.nextSibling));}else{return elm.nextSibling?firstPositionIn(elm.nextSibling):Optional.none();}};var findCaretPositionBackwardsFromElm=function findCaretPositionBackwardsFromElm(rootElement,elm){var startPosition=_CaretPosition.before(elm.previousSibling?elm.previousSibling:elm.parentNode);return prevPosition(rootElement,startPosition).fold(function(){return nextPosition(rootElement,_CaretPosition.after(elm));},Optional.some);};var findCaretPositionForwardsFromElm=function findCaretPositionForwardsFromElm(rootElement,elm){return nextPosition(rootElement,_CaretPosition.after(elm)).fold(function(){return prevPosition(rootElement,_CaretPosition.before(elm));},Optional.some);};var findCaretPositionBackwards=function findCaretPositionBackwards(rootElement,elm){return getPreviousSiblingCaretPosition(elm).orThunk(function(){return getNextSiblingCaretPosition(elm);}).orThunk(function(){return findCaretPositionBackwardsFromElm(rootElement,elm);});};var findCaretPositionForward=function findCaretPositionForward(rootElement,elm){return getNextSiblingCaretPosition(elm).orThunk(function(){return getPreviousSiblingCaretPosition(elm);}).orThunk(function(){return findCaretPositionForwardsFromElm(rootElement,elm);});};var findCaretPosition=function findCaretPosition(forward,rootElement,elm){return forward?findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm);};var findCaretPosOutsideElmAfterDelete=function findCaretPosOutsideElmAfterDelete(forward,rootElement,elm){return findCaretPosition(forward,rootElement,elm).map(curry(reposition,elm));};var setSelection$1=function setSelection$1(editor,forward,pos){pos.fold(function(){editor.focus();},function(pos){editor.selection.setRng(pos.toRange(),forward);});};var eqRawNode=function eqRawNode(rawNode){return function(elm){return elm.dom===rawNode;};};var isBlock=function isBlock(editor,elm){return elm&&has$2(editor.schema.getBlockElements(),name(elm));};var paddEmptyBlock=function paddEmptyBlock(elm){if(isEmpty$2(elm)){var br=SugarElement.fromHtml('<br data-mce-bogus=\"1\">');empty(elm);append$1(elm,br);return Optional.some(_CaretPosition.before(br.dom));}else{return Optional.none();}};var deleteNormalized=function deleteNormalized(elm,afterDeletePosOpt,normalizeWhitespace){var prevTextOpt=prevSibling(elm).filter(isText$8);var nextTextOpt=nextSibling(elm).filter(isText$8);remove$7(elm);return lift3(prevTextOpt,nextTextOpt,afterDeletePosOpt,function(prev,next,pos){var prevNode=prev.dom,nextNode=next.dom;var offset=prevNode.data.length;mergeTextNodes(prevNode,nextNode,normalizeWhitespace);return pos.container()===nextNode?_CaretPosition(prevNode,offset):pos;}).orThunk(function(){if(normalizeWhitespace){prevTextOpt.each(function(elm){return normalizeWhitespaceBefore(elm.dom,elm.dom.length);});nextTextOpt.each(function(elm){return normalizeWhitespaceAfter(elm.dom,0);});}return afterDeletePosOpt;});};var isInlineElement=function isInlineElement(editor,element){return has$2(editor.schema.getTextInlineElements(),name(element));};var deleteElement$2=function deleteElement$2(editor,forward,elm,moveCaret){if(moveCaret===void 0){moveCaret=true;}var afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom);var parentBlock=ancestor$3(elm,curry(isBlock,editor),eqRawNode(editor.getBody()));var normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos,isInlineElement(editor,elm));if(editor.dom.isEmpty(editor.getBody())){editor.setContent('');editor.selection.setCursorLocation();}else{parentBlock.bind(paddEmptyBlock).fold(function(){if(moveCaret){setSelection$1(editor,forward,normalizedAfterDeletePos);}},function(paddPos){if(moveCaret){setSelection$1(editor,forward,Optional.some(paddPos));}});}};var isRootFromElement=function isRootFromElement(root){return function(cur){return eq(root,cur);};};var getTableCells=function getTableCells(table){return descendants(table,'td,th');};var getTableDetailsFromRange=function getTableDetailsFromRange(rng,isRoot){var getTable=function getTable(node){return getClosestTable(SugarElement.fromDom(node),isRoot);};var startTable=getTable(rng.startContainer);var endTable=getTable(rng.endContainer);var isStartInTable=startTable.isSome();var isEndInTable=endTable.isSome();var isSameTable=lift2(startTable,endTable,eq).getOr(false);var isMultiTable=!isSameTable&&isStartInTable&&isEndInTable;return{startTable:startTable,endTable:endTable,isStartInTable:isStartInTable,isEndInTable:isEndInTable,isSameTable:isSameTable,isMultiTable:isMultiTable};};var tableCellRng=function tableCellRng(start,end){return{start:start,end:end};};var tableSelection=function tableSelection(rng,table,cells){return{rng:rng,table:table,cells:cells};};var deleteAction=Adt.generate([{singleCellTable:['rng','cell']},{fullTable:['table']},{partialTable:['cells','outsideDetails']},{multiTable:['startTableCells','endTableCells','betweenRng']}]);var getClosestCell$1=function getClosestCell$1(container,isRoot){return closest$2(SugarElement.fromDom(container),'td,th',isRoot);};var isExpandedCellRng=function isExpandedCellRng(cellRng){return!eq(cellRng.start,cellRng.end);};var getTableFromCellRng=function getTableFromCellRng(cellRng,isRoot){return getClosestTable(cellRng.start,isRoot).bind(function(startParentTable){return getClosestTable(cellRng.end,isRoot).bind(function(endParentTable){return someIf(eq(startParentTable,endParentTable),startParentTable);});});};var isSingleCellTable=function isSingleCellTable(cellRng,isRoot){return!isExpandedCellRng(cellRng)&&getTableFromCellRng(cellRng,isRoot).exists(function(table){var rows=table.dom.rows;return rows.length===1&&rows[0].cells.length===1;});};var getCellRng=function getCellRng(rng,isRoot){var startCell=getClosestCell$1(rng.startContainer,isRoot);var endCell=getClosestCell$1(rng.endContainer,isRoot);return lift2(startCell,endCell,tableCellRng);};var getCellRangeFromStartTable=function getCellRangeFromStartTable(isRoot){return function(startCell){return getClosestTable(startCell,isRoot).bind(function(table){return last$2(getTableCells(table)).map(function(endCell){return tableCellRng(startCell,endCell);});});};};var getCellRangeFromEndTable=function getCellRangeFromEndTable(isRoot){return function(endCell){return getClosestTable(endCell,isRoot).bind(function(table){return head(getTableCells(table)).map(function(startCell){return tableCellRng(startCell,endCell);});});};};var getTableSelectionFromCellRng=function getTableSelectionFromCellRng(isRoot){return function(cellRng){return getTableFromCellRng(cellRng,isRoot).map(function(table){return tableSelection(cellRng,table,getTableCells(table));});};};var getTableSelections=function getTableSelections(cellRng,selectionDetails,rng,isRoot){if(rng.collapsed||!cellRng.forall(isExpandedCellRng)){return Optional.none();}else if(selectionDetails.isSameTable){var sameTableSelection=cellRng.bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:sameTableSelection,end:sameTableSelection});}else{var startCell=getClosestCell$1(rng.startContainer,isRoot);var endCell=getClosestCell$1(rng.endContainer,isRoot);var startTableSelection=startCell.bind(getCellRangeFromStartTable(isRoot)).bind(getTableSelectionFromCellRng(isRoot));var endTableSelection=endCell.bind(getCellRangeFromEndTable(isRoot)).bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:startTableSelection,end:endTableSelection});}};var getCellIndex=function getCellIndex(cells,cell){return findIndex$2(cells,function(x){return eq(x,cell);});};var getSelectedCells=function getSelectedCells(tableSelection){return lift2(getCellIndex(tableSelection.cells,tableSelection.rng.start),getCellIndex(tableSelection.cells,tableSelection.rng.end),function(startIndex,endIndex){return tableSelection.cells.slice(startIndex,endIndex+1);});};var isSingleCellTableContentSelected=function isSingleCellTableContentSelected(optCellRng,rng,isRoot){return optCellRng.exists(function(cellRng){return isSingleCellTable(cellRng,isRoot)&&hasAllContentsSelected(cellRng.start,rng);});};var unselectCells=function unselectCells(rng,selectionDetails){var startTable=selectionDetails.startTable,endTable=selectionDetails.endTable;var otherContentRng=rng.cloneRange();startTable.each(function(table){return otherContentRng.setStartAfter(table.dom);});endTable.each(function(table){return otherContentRng.setEndBefore(table.dom);});return otherContentRng;};var handleSingleTable=function handleSingleTable(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind(function(_a){var start=_a.start,end=_a.end;return start.or(end);}).bind(function(tableSelection){var isSameTable=selectionDetails.isSameTable;var selectedCells=getSelectedCells(tableSelection).getOr([]);if(isSameTable&&tableSelection.cells.length===selectedCells.length){return Optional.some(deleteAction.fullTable(tableSelection.table));}else if(selectedCells.length>0){if(isSameTable){return Optional.some(deleteAction.partialTable(selectedCells,Optional.none()));}else{var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.partialTable(selectedCells,Optional.some(_assign(_assign({},selectionDetails),{rng:otherContentRng}))));}}else{return Optional.none();}});};var handleMultiTable=function handleMultiTable(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind(function(_a){var start=_a.start,end=_a.end;var startTableSelectedCells=start.bind(getSelectedCells).getOr([]);var endTableSelectedCells=end.bind(getSelectedCells).getOr([]);if(startTableSelectedCells.length>0&&endTableSelectedCells.length>0){var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.multiTable(startTableSelectedCells,endTableSelectedCells,otherContentRng));}else{return Optional.none();}});};var getActionFromRange=function getActionFromRange(root,rng){var isRoot=isRootFromElement(root);var optCellRng=getCellRng(rng,isRoot);var selectionDetails=getTableDetailsFromRange(rng,isRoot);if(isSingleCellTableContentSelected(optCellRng,rng,isRoot)){return optCellRng.map(function(cellRng){return deleteAction.singleCellTable(rng,cellRng.start);});}else if(selectionDetails.isMultiTable){return handleMultiTable(optCellRng,selectionDetails,rng,isRoot);}else{return handleSingleTable(optCellRng,selectionDetails,rng,isRoot);}};var _freefallRtl=function freefallRtl(root){var child=isComment$1(root)?prevSibling(root):lastChild(root);return child.bind(_freefallRtl).orThunk(function(){return Optional.some(root);});};var cleanCells=function cleanCells(cells){return each$k(cells,function(cell){remove$6(cell,'contenteditable');fillWithPaddingBr(cell);});};var getOutsideBlock=function getOutsideBlock(editor,container){return Optional.from(editor.dom.getParent(container,editor.dom.isBlock)).map(SugarElement.fromDom);};var handleEmptyBlock=function handleEmptyBlock(editor,startInTable,emptyBlock){emptyBlock.each(function(block){if(startInTable){remove$7(block);}else{fillWithPaddingBr(block);editor.selection.setCursorLocation(block.dom,0);}});};var deleteContentInsideCell=function deleteContentInsideCell(editor,cell,rng,isFirstCellInSelection){var insideTableRng=rng.cloneRange();if(isFirstCellInSelection){insideTableRng.setStart(rng.startContainer,rng.startOffset);insideTableRng.setEndAfter(cell.dom.lastChild);}else{insideTableRng.setStartBefore(cell.dom.firstChild);insideTableRng.setEnd(rng.endContainer,rng.endOffset);}deleteCellContents(editor,insideTableRng,cell,false);};var collapseAndRestoreCellSelection=function collapseAndRestoreCellSelection(editor){var selectedCells=getCellsFromEditor(editor);var selectedNode=SugarElement.fromDom(editor.selection.getNode());if(isTableCell$5(selectedNode.dom)&&isEmpty$2(selectedNode)){editor.selection.setCursorLocation(selectedNode.dom,0);}else{editor.selection.collapse(true);}if(selectedCells.length>1&&exists(selectedCells,function(cell){return eq(cell,selectedNode);})){set$1(selectedNode,'data-mce-selected','1');}};var emptySingleTableCells=function emptySingleTableCells(editor,cells,outsideDetails){var editorRng=editor.selection.getRng();var cellsToClean=outsideDetails.bind(function(_a){var rng=_a.rng,isStartInTable=_a.isStartInTable;var outsideBlock=getOutsideBlock(editor,isStartInTable?rng.endContainer:rng.startContainer);rng.deleteContents();handleEmptyBlock(editor,isStartInTable,outsideBlock.filter(isEmpty$2));var endPointCell=isStartInTable?cells[0]:cells[cells.length-1];deleteContentInsideCell(editor,endPointCell,editorRng,isStartInTable);if(!isEmpty$2(endPointCell)){return Optional.some(isStartInTable?cells.slice(1):cells.slice(0,-1));}else{return Optional.none();}}).getOr(cells);cleanCells(cellsToClean);collapseAndRestoreCellSelection(editor);return true;};var emptyMultiTableCells=function emptyMultiTableCells(editor,startTableCells,endTableCells,betweenRng){var rng=editor.selection.getRng();var startCell=startTableCells[0];var endCell=endTableCells[endTableCells.length-1];deleteContentInsideCell(editor,startCell,rng,true);deleteContentInsideCell(editor,endCell,rng,false);var startTableCellsToClean=isEmpty$2(startCell)?startTableCells:startTableCells.slice(1);var endTableCellsToClean=isEmpty$2(endCell)?endTableCells:endTableCells.slice(0,-1);cleanCells(startTableCellsToClean.concat(endTableCellsToClean));betweenRng.deleteContents();collapseAndRestoreCellSelection(editor);return true;};var deleteCellContents=function deleteCellContents(editor,rng,cell,moveSelection){if(moveSelection===void 0){moveSelection=true;}rng.deleteContents();var lastNode=_freefallRtl(cell).getOr(cell);var lastBlock=SugarElement.fromDom(editor.dom.getParent(lastNode.dom,editor.dom.isBlock));if(isEmpty$2(lastBlock)){fillWithPaddingBr(lastBlock);if(moveSelection){editor.selection.setCursorLocation(lastBlock.dom,0);}}if(!eq(cell,lastBlock)){var additionalCleanupNodes=is$1(parent(lastBlock),cell)?[]:siblings(lastBlock);each$k(additionalCleanupNodes.concat(children(cell)),function(node){if(!eq(node,lastBlock)&&!contains$1(node,lastBlock)&&isEmpty$2(node)){remove$7(node);}});}return true;};var deleteTableElement=function deleteTableElement(editor,table){deleteElement$2(editor,false,table);return true;};var deleteCellRange=function deleteCellRange(editor,rootElm,rng){return getActionFromRange(rootElm,rng).map(function(action){return action.fold(curry(deleteCellContents,editor),curry(deleteTableElement,editor),curry(emptySingleTableCells,editor),curry(emptyMultiTableCells,editor));});};var deleteCaptionRange=function deleteCaptionRange(editor,caption){return emptyElement(editor,caption);};var deleteTableRange=function deleteTableRange(editor,rootElm,rng,startElm){return getParentCaption(rootElm,startElm).fold(function(){return deleteCellRange(editor,rootElm,rng);},function(caption){return deleteCaptionRange(editor,caption);}).getOr(false);};var deleteRange$2=function deleteRange$2(editor,startElm,selectedCells){var rootNode=SugarElement.fromDom(editor.getBody());var rng=editor.selection.getRng();return selectedCells.length!==0?emptySingleTableCells(editor,selectedCells,Optional.none()):deleteTableRange(editor,rootNode,rng,startElm);};var getParentCell=function getParentCell(rootElm,elm){return find$3(parentsAndSelf(elm,rootElm),isTableCell$4);};var getParentCaption=function getParentCaption(rootElm,elm){return find$3(parentsAndSelf(elm,rootElm),isTag('caption'));};var deleteBetweenCells=function deleteBetweenCells(editor,rootElm,forward,fromCell,from){return navigate(forward,editor.getBody(),from).bind(function(to){return getParentCell(rootElm,SugarElement.fromDom(to.getNode())).map(function(toCell){return eq(toCell,fromCell)===false;});});};var emptyElement=function emptyElement(editor,elm){fillWithPaddingBr(elm);editor.selection.setCursorLocation(elm.dom,0);return Optional.some(true);};var isDeleteOfLastCharPos=function isDeleteOfLastCharPos(fromCaption,forward,from,to){return firstPositionIn(fromCaption.dom).bind(function(first){return lastPositionIn(fromCaption.dom).map(function(last){return forward?from.isEqual(first)&&to.isEqual(last):from.isEqual(last)&&to.isEqual(first);});}).getOr(true);};var emptyCaretCaption=function emptyCaretCaption(editor,elm){return emptyElement(editor,elm);};var validateCaretCaption=function validateCaretCaption(rootElm,fromCaption,to){return getParentCaption(rootElm,SugarElement.fromDom(to.getNode())).map(function(toCaption){return eq(toCaption,fromCaption)===false;});};var deleteCaretInsideCaption=function deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from){return navigate(forward,editor.getBody(),from).bind(function(to){return isDeleteOfLastCharPos(fromCaption,forward,from,to)?emptyCaretCaption(editor,fromCaption):validateCaretCaption(rootElm,fromCaption,to);}).or(Optional.some(true));};var deleteCaretCells=function deleteCaretCells(editor,forward,rootElm,startElm){var from=_CaretPosition.fromRangeStart(editor.selection.getRng());return getParentCell(rootElm,startElm).bind(function(fromCell){return isEmpty$2(fromCell)?emptyElement(editor,fromCell):deleteBetweenCells(editor,rootElm,forward,fromCell,from);}).getOr(false);};var deleteCaretCaption=function deleteCaretCaption(editor,forward,rootElm,fromCaption){var from=_CaretPosition.fromRangeStart(editor.selection.getRng());return isEmpty$2(fromCaption)?emptyElement(editor,fromCaption):deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from);};var isNearTable=function isNearTable(forward,pos){return forward?isBeforeTable(pos):isAfterTable(pos);};var isBeforeOrAfterTable=function isBeforeOrAfterTable(editor,forward){var fromPos=_CaretPosition.fromRangeStart(editor.selection.getRng());return isNearTable(forward,fromPos)||fromPosition(forward,editor.getBody(),fromPos).exists(function(pos){return isNearTable(forward,pos);});};var deleteCaret$3=function deleteCaret$3(editor,forward,startElm){var rootElm=SugarElement.fromDom(editor.getBody());return getParentCaption(rootElm,startElm).fold(function(){return deleteCaretCells(editor,forward,rootElm,startElm)||isBeforeOrAfterTable(editor,forward);},function(fromCaption){return deleteCaretCaption(editor,forward,rootElm,fromCaption).getOr(false);});};var backspaceDelete$9=function backspaceDelete$9(editor,forward){var startElm=SugarElement.fromDom(editor.selection.getStart(true));var cells=getCellsFromEditor(editor);return editor.selection.isCollapsed()&&cells.length===0?deleteCaret$3(editor,forward,startElm):deleteRange$2(editor,startElm,cells);};var createRange=function createRange(sc,so,ec,eo){var rng=document.createRange();rng.setStart(sc,so);rng.setEnd(ec,eo);return rng;};var normalizeBlockSelectionRange=function normalizeBlockSelectionRange(rng){var startPos=_CaretPosition.fromRangeStart(rng);var endPos=_CaretPosition.fromRangeEnd(rng);var rootNode=rng.commonAncestorContainer;return fromPosition(false,rootNode,endPos).map(function(newEndPos){if(!isInSameBlock(startPos,endPos,rootNode)&&isInSameBlock(startPos,newEndPos,rootNode)){return createRange(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset());}else{return rng;}}).getOr(rng);};var normalize=function normalize(rng){return rng.collapsed?rng:normalizeBlockSelectionRange(rng);};var hasOnlyOneChild$1=function hasOnlyOneChild$1(node){return node.firstChild&&node.firstChild===node.lastChild;};var isPaddingNode=function isPaddingNode(node){return node.name==='br'||node.value===nbsp;};var isPaddedEmptyBlock=function isPaddedEmptyBlock(schema,node){var blockElements=schema.getBlockElements();return blockElements[node.name]&&hasOnlyOneChild$1(node)&&isPaddingNode(node.firstChild);};var isEmptyFragmentElement=function isEmptyFragmentElement(schema,node){var nonEmptyElements=schema.getNonEmptyElements();return node&&(node.isEmpty(nonEmptyElements)||isPaddedEmptyBlock(schema,node));};var isListFragment=function isListFragment(schema,fragment){var firstChild=fragment.firstChild;var lastChild=fragment.lastChild;if(firstChild&&firstChild.name==='meta'){firstChild=firstChild.next;}if(lastChild&&lastChild.attr('id')==='mce_marker'){lastChild=lastChild.prev;}if(isEmptyFragmentElement(schema,lastChild)){lastChild=lastChild.prev;}if(!firstChild||firstChild!==lastChild){return false;}return firstChild.name==='ul'||firstChild.name==='ol';};var cleanupDomFragment=function cleanupDomFragment(domFragment){var firstChild=domFragment.firstChild;var lastChild=domFragment.lastChild;if(firstChild&&firstChild.nodeName==='META'){firstChild.parentNode.removeChild(firstChild);}if(lastChild&&lastChild.id==='mce_marker'){lastChild.parentNode.removeChild(lastChild);}return domFragment;};var toDomFragment=function toDomFragment(dom,serializer,fragment){var html=serializer.serialize(fragment);var domFragment=dom.createFragment(html);return cleanupDomFragment(domFragment);};var listItems=function listItems(elm){return filter$4(elm.childNodes,function(child){return child.nodeName==='LI';});};var isPadding=function isPadding(node){return node.data===nbsp||isBr$5(node);};var isListItemPadded=function isListItemPadded(node){return node&&node.firstChild&&node.firstChild===node.lastChild&&isPadding(node.firstChild);};var isEmptyOrPadded=function isEmptyOrPadded(elm){return!elm.firstChild||isListItemPadded(elm);};var trimListItems=function trimListItems(elms){return elms.length>0&&isEmptyOrPadded(elms[elms.length-1])?elms.slice(0,-1):elms;};var getParentLi=function getParentLi(dom,node){var parentBlock=dom.getParent(node,dom.isBlock);return parentBlock&&parentBlock.nodeName==='LI'?parentBlock:null;};var isParentBlockLi=function isParentBlockLi(dom,node){return!!getParentLi(dom,node);};var getSplit=function getSplit(parentNode,rng){var beforeRng=rng.cloneRange();var afterRng=rng.cloneRange();beforeRng.setStartBefore(parentNode);afterRng.setEndAfter(parentNode);return[beforeRng.cloneContents(),afterRng.cloneContents()];};var findFirstIn=function findFirstIn(node,rootNode){var caretPos=_CaretPosition.before(node);var caretWalker=CaretWalker(rootNode);var newCaretPos=caretWalker.next(caretPos);return newCaretPos?newCaretPos.toRange():null;};var findLastOf=function findLastOf(node,rootNode){var caretPos=_CaretPosition.after(node);var caretWalker=CaretWalker(rootNode);var newCaretPos=caretWalker.prev(caretPos);return newCaretPos?newCaretPos.toRange():null;};var insertMiddle=function insertMiddle(target,elms,rootNode,rng){var parts=getSplit(target,rng);var parentElm=target.parentNode;parentElm.insertBefore(parts[0],target);Tools.each(elms,function(li){parentElm.insertBefore(li,target);});parentElm.insertBefore(parts[1],target);parentElm.removeChild(target);return findLastOf(elms[elms.length-1],rootNode);};var insertBefore$1=function insertBefore$1(target,elms,rootNode){var parentElm=target.parentNode;Tools.each(elms,function(elm){parentElm.insertBefore(elm,target);});return findFirstIn(target,rootNode);};var insertAfter$1=function insertAfter$1(target,elms,rootNode,dom){dom.insertAfter(elms.reverse(),target);return findLastOf(elms[0],rootNode);};var insertAtCaret$1=function insertAtCaret$1(serializer,dom,rng,fragment){var domFragment=toDomFragment(dom,serializer,fragment);var liTarget=getParentLi(dom,rng.startContainer);var liElms=trimListItems(listItems(domFragment.firstChild));var BEGINNING=1,END=2;var rootNode=dom.getRoot();var isAt=function isAt(location){var caretPos=_CaretPosition.fromRangeStart(rng);var caretWalker=CaretWalker(dom.getRoot());var newPos=location===BEGINNING?caretWalker.prev(caretPos):caretWalker.next(caretPos);return newPos?getParentLi(dom,newPos.getNode())!==liTarget:true;};if(isAt(BEGINNING)){return insertBefore$1(liTarget,liElms,rootNode);}else if(isAt(END)){return insertAfter$1(liTarget,liElms,rootNode,dom);}return insertMiddle(liTarget,liElms,rootNode,rng);};var trimOrPadLeftRight=function trimOrPadLeftRight(dom,rng,html){var root=SugarElement.fromDom(dom.getRoot());if(needsToBeNbspLeft(root,_CaretPosition.fromRangeStart(rng))){html=html.replace(/^ /,'&nbsp;');}else{html=html.replace(/^&nbsp;/,' ');}if(needsToBeNbspRight(root,_CaretPosition.fromRangeEnd(rng))){html=html.replace(/(&nbsp;| )(<br( \\/)>)?$/,'&nbsp;');}else{html=html.replace(/&nbsp;(<br( \\/)?>)?$/,' ');}return html;};var isTableCell$1=isTableCell$5;var isTableCellContentSelected=function isTableCellContentSelected(dom,rng,cell){if(cell!==null){var endCell=dom.getParent(rng.endContainer,isTableCell$1);return cell===endCell&&hasAllContentsSelected(SugarElement.fromDom(cell),rng);}else{return false;}};var validInsertion=function validInsertion(editor,value,parentNode){if(parentNode.getAttribute('data-mce-bogus')==='all'){parentNode.parentNode.insertBefore(editor.dom.createFragment(value),parentNode);}else{var node=parentNode.firstChild;var node2=parentNode.lastChild;if(!node||node===node2&&node.nodeName==='BR'){editor.dom.setHTML(parentNode,value);}else{editor.selection.setContent(value);}}};var trimBrsFromTableCell=function trimBrsFromTableCell(dom,elm){Optional.from(dom.getParent(elm,'td,th')).map(SugarElement.fromDom).each(trimBlockTrailingBr);};var reduceInlineTextElements=function reduceInlineTextElements(editor,merge){var textInlineElements=editor.schema.getTextInlineElements();var dom=editor.dom;if(merge){var root_1=editor.getBody();var elementUtils_1=ElementUtils(dom);Tools.each(dom.select('*[data-mce-fragment]'),function(node){var isInline=isNonNullable(textInlineElements[node.nodeName.toLowerCase()]);if(isInline&&hasInheritableStyles(dom,node)){for(var parentNode=node.parentNode;isNonNullable(parentNode)&&parentNode!==root_1;parentNode=parentNode.parentNode){var styleConflict=hasStyleConflict(dom,node,parentNode);if(styleConflict){break;}if(elementUtils_1.compare(parentNode,node)){dom.remove(node,true);break;}}}});}};var markFragmentElements=function markFragmentElements(fragment){var node=fragment;while(node=node.walk()){if(node.type===1){node.attr('data-mce-fragment','1');}}};var unmarkFragmentElements=function unmarkFragmentElements(elm){Tools.each(elm.getElementsByTagName('*'),function(elm){elm.removeAttribute('data-mce-fragment');});};var isPartOfFragment=function isPartOfFragment(node){return!!node.getAttribute('data-mce-fragment');};var canHaveChildren=function canHaveChildren(editor,node){return node&&!editor.schema.getShortEndedElements()[node.nodeName];};var moveSelectionToMarker=function moveSelectionToMarker(editor,marker){var nextRng;var dom=editor.dom;var selection=editor.selection;if(!marker){return;}selection.scrollIntoView(marker);var parentEditableElm=getContentEditableRoot$1(editor.getBody(),marker);if(dom.getContentEditable(parentEditableElm)==='false'){dom.remove(marker);selection.select(parentEditableElm);return;}var rng=dom.createRng();var node=marker.previousSibling;if(isText$7(node)){rng.setStart(node,node.nodeValue.length);if(!Env.ie){var node2=marker.nextSibling;if(isText$7(node2)){node.appendData(node2.data);node2.parentNode.removeChild(node2);}}}else{rng.setStartBefore(marker);rng.setEndBefore(marker);}var findNextCaretRng=function findNextCaretRng(rng){var caretPos=_CaretPosition.fromRangeStart(rng);var caretWalker=CaretWalker(editor.getBody());caretPos=caretWalker.next(caretPos);if(caretPos){return caretPos.toRange();}};var parentBlock=dom.getParent(marker,dom.isBlock);dom.remove(marker);if(parentBlock&&dom.isEmpty(parentBlock)){editor.$(parentBlock).empty();rng.setStart(parentBlock,0);rng.setEnd(parentBlock,0);if(!isTableCell$1(parentBlock)&&!isPartOfFragment(parentBlock)&&(nextRng=findNextCaretRng(rng))){rng=nextRng;dom.remove(parentBlock);}else{dom.add(parentBlock,dom.create('br',{'data-mce-bogus':'1'}));}}selection.setRng(rng);};var deleteSelectedContent=function deleteSelectedContent(editor){var dom=editor.dom;var rng=normalize(editor.selection.getRng());editor.selection.setRng(rng);var startCell=dom.getParent(rng.startContainer,isTableCell$1);if(isTableCellContentSelected(dom,rng,startCell)){deleteCellContents(editor,rng,SugarElement.fromDom(startCell));}else{editor.getDoc().execCommand('Delete',false,null);}};var insertHtmlAtCaret=function insertHtmlAtCaret(editor,value,details){var parentNode;var rng,node;var selection=editor.selection;var dom=editor.dom;if(/^ | $/.test(value)){value=trimOrPadLeftRight(dom,selection.getRng(),value);}var parser=editor.parser;var merge=details.merge;var serializer=HtmlSerializer({validate:shouldValidate(editor)},editor.schema);var bookmarkHtml='<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;</span>';var args=editor.fire('BeforeSetContent',{content:value,format:'html',selection:true,paste:details.paste});if(args.isDefaultPrevented()){editor.fire('SetContent',{content:args.content,format:'html',selection:true,paste:details.paste});return;}value=args.content;if(!details.preserve_zwsp){value=trim$3(value);}if(value.indexOf('{$caret}')===-1){value+='{$caret}';}value=value.replace(/\\{\\$caret\\}/,bookmarkHtml);rng=selection.getRng();var caretElement=rng.startContainer||(rng.parentElement?rng.parentElement():null);var body=editor.getBody();if(caretElement===body&&selection.isCollapsed()){if(dom.isBlock(body.firstChild)&&canHaveChildren(editor,body.firstChild)&&dom.isEmpty(body.firstChild)){rng=dom.createRng();rng.setStart(body.firstChild,0);rng.setEnd(body.firstChild,0);selection.setRng(rng);}}if(!selection.isCollapsed()){deleteSelectedContent(editor);}parentNode=selection.getNode();var parserArgs={context:parentNode.nodeName.toLowerCase(),data:details.data,insert:true};var fragment=parser.parse(value,parserArgs);if(details.paste===true&&isListFragment(editor.schema,fragment)&&isParentBlockLi(dom,parentNode)){rng=insertAtCaret$1(serializer,dom,selection.getRng(),fragment);selection.setRng(rng);editor.fire('SetContent',args);return;}markFragmentElements(fragment);node=fragment.lastChild;if(node.attr('id')==='mce_marker'){var marker=node;for(node=node.prev;node;node=node.walk(true)){if(node.type===3||!dom.isBlock(node.name)){if(editor.schema.isValidChild(node.parent.name,'span')){node.parent.insert(marker,node,node.name==='br');}break;}}}editor._selectionOverrides.showBlockCaretContainer(parentNode);if(!parserArgs.invalid){value=serializer.serialize(fragment);validInsertion(editor,value,parentNode);}else{editor.selection.setContent(bookmarkHtml);parentNode=selection.getNode();var rootNode=editor.getBody();if(parentNode.nodeType===9){parentNode=node=rootNode;}else{node=parentNode;}while(node!==rootNode){parentNode=node;node=node.parentNode;}value=parentNode===rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode);value=serializer.serialize(parser.parse(value.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i,function(){return serializer.serialize(fragment);})));if(parentNode===rootNode){dom.setHTML(rootNode,value);}else{dom.setOuterHTML(parentNode,value);}}reduceInlineTextElements(editor,merge);moveSelectionToMarker(editor,dom.get('mce_marker'));unmarkFragmentElements(editor.getBody());trimBrsFromTableCell(dom,selection.getStart());editor.fire('SetContent',args);editor.addVisual();};var _traverse=function traverse(node,fn){fn(node);if(node.firstChild){_traverse(node.firstChild,fn);}if(node.next){_traverse(node.next,fn);}};var findMatchingNodes=function findMatchingNodes(nodeFilters,attributeFilters,node){var nodeMatches={};var attrMatches={};var matches=[];if(node.firstChild){_traverse(node.firstChild,function(node){each$k(nodeFilters,function(filter){if(filter.name===node.name){if(nodeMatches[filter.name]){nodeMatches[filter.name].nodes.push(node);}else{nodeMatches[filter.name]={filter:filter,nodes:[node]};}}});each$k(attributeFilters,function(filter){if(typeof node.attr(filter.name)==='string'){if(attrMatches[filter.name]){attrMatches[filter.name].nodes.push(node);}else{attrMatches[filter.name]={filter:filter,nodes:[node]};}}});});}for(var name_1 in nodeMatches){if(has$2(nodeMatches,name_1)){matches.push(nodeMatches[name_1]);}}for(var name_2 in attrMatches){if(has$2(attrMatches,name_2)){matches.push(attrMatches[name_2]);}}return matches;};var filter$1=function filter$1(nodeFilters,attributeFilters,node){var matches=findMatchingNodes(nodeFilters,attributeFilters,node);each$k(matches,function(match){each$k(match.filter.callbacks,function(callback){callback(match.nodes,match.filter.name,{});});});};var defaultFormat$1='html';var isTreeNode=function isTreeNode(content){return content instanceof AstNode;};var moveSelection=function moveSelection(editor){if(hasFocus(editor)){firstPositionIn(editor.getBody()).each(function(pos){var node=pos.getNode();var caretPos=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange());});}};var setEditorHtml=function setEditorHtml(editor,html,noSelection){editor.dom.setHTML(editor.getBody(),html);if(noSelection!==true){moveSelection(editor);}};var setContentString=function setContentString(editor,body,content,args){content=trim$3(content);if(content.length===0||/^\\s+$/.test(content)){var padd='<br data-mce-bogus=\"1\">';if(body.nodeName==='TABLE'){content='<tr><td>'+padd+'</td></tr>';}else if(/^(UL|OL)$/.test(body.nodeName)){content='<li>'+padd+'</li>';}var forcedRootBlockName=getForcedRootBlock(editor);if(forcedRootBlockName&&editor.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())){content=padd;content=editor.dom.createHTML(forcedRootBlockName,getForcedRootBlockAttrs(editor),content);}else if(!content){content='<br data-mce-bogus=\"1\">';}setEditorHtml(editor,content,args.no_selection);editor.fire('SetContent',args);}else{if(args.format!=='raw'){content=HtmlSerializer({validate:editor.validate},editor.schema).serialize(editor.parser.parse(content,{isRootContent:true,insert:true}));}args.content=isWsPreserveElement(SugarElement.fromDom(body))?content:Tools.trim(content);setEditorHtml(editor,args.content,args.no_selection);if(!args.no_events){editor.fire('SetContent',args);}}return args.content;};var setContentTree=function setContentTree(editor,body,content,args){filter$1(editor.parser.getNodeFilters(),editor.parser.getAttributeFilters(),content);var html=HtmlSerializer({validate:editor.validate},editor.schema).serialize(content);args.content=trim$3(isWsPreserveElement(SugarElement.fromDom(body))?html:Tools.trim(html));setEditorHtml(editor,args.content,args.no_selection);if(!args.no_events){editor.fire('SetContent',args);}return content;};var setupArgs$2=function setupArgs$2(args,content){return _assign(_assign({format:defaultFormat$1},args),{set:true,content:isTreeNode(content)?'':content});};var setContentInternal=function setContentInternal(editor,content,args){var defaultedArgs=setupArgs$2(args,content);var updatedArgs=args.no_events?defaultedArgs:editor.fire('BeforeSetContent',defaultedArgs);if(!isTreeNode(content)){content=updatedArgs.content;}return Optional.from(editor.getBody()).fold(constant(content),function(body){return isTreeNode(content)?setContentTree(editor,body,content,updatedArgs):setContentString(editor,body,content,updatedArgs);});};var sibling=function sibling(scope,predicate){return sibling$2(scope,predicate).isSome();};var ensureIsRoot=function ensureIsRoot(isRoot){return isFunction(isRoot)?isRoot:never;};var ancestor=function ancestor(scope,transform,isRoot){var element=scope.dom;var stop=ensureIsRoot(isRoot);while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);var transformed=transform(el);if(transformed.isSome()){return transformed;}else if(stop(el)){break;}}return Optional.none();};var closest$1=function closest$1(scope,transform,isRoot){var current=transform(scope);var stop=ensureIsRoot(isRoot);return current.orThunk(function(){return stop(scope)?Optional.none():ancestor(scope,transform,stop);});};var isEq$3=isEq$5;var matchesUnInheritedFormatSelector=function matchesUnInheritedFormatSelector(ed,node,name){var formatList=ed.formatter.get(name);if(formatList){for(var i=0;i<formatList.length;i++){var format=formatList[i];if(isSelectorFormat(format)&&format.inherit===false&&ed.dom.is(node,format.selector)){return true;}}}return false;};var matchParents=function matchParents(editor,node,name,vars,similar){var root=editor.dom.getRoot();if(node===root){return false;}node=editor.dom.getParent(node,function(node){if(matchesUnInheritedFormatSelector(editor,node,name)){return true;}return node.parentNode===root||!!_matchNode(editor,node,name,vars,true);});return!!_matchNode(editor,node,name,vars,similar);};var matchName$1=function matchName$1(dom,node,format){if(isEq$3(node,format.inline)){return true;}if(isEq$3(node,format.block)){return true;}if(format.selector){return node.nodeType===1&&dom.is(node,format.selector);}};var matchItems=function matchItems(dom,node,format,itemName,similar,vars){var items=format[itemName];if(isFunction(format.onmatch)){return format.onmatch(node,format,itemName);}if(items){if(isUndefined(items.length)){for(var key in items){if(has$2(items,key)){var value=itemName==='attributes'?dom.getAttrib(node,key):getStyle(dom,node,key);var expectedValue=replaceVars(items[key],vars);var isEmptyValue=isNullable(value)||isEmpty$3(value);if(isEmptyValue&&isNullable(expectedValue)){continue;}if(similar&&isEmptyValue&&!format.exact){return false;}if((!similar||format.exact)&&!isEq$3(value,normalizeStyleValue(dom,expectedValue,key))){return false;}}}}else{for(var i=0;i<items.length;i++){if(itemName==='attributes'?dom.getAttrib(node,items[i]):getStyle(dom,node,items[i])){return true;}}}}return true;};var _matchNode=function matchNode(ed,node,name,vars,similar){var formatList=ed.formatter.get(name);var dom=ed.dom;if(formatList&&node){for(var i=0;i<formatList.length;i++){var format=formatList[i];if(matchName$1(ed.dom,node,format)&&matchItems(dom,node,format,'attributes',similar,vars)&&matchItems(dom,node,format,'styles',similar,vars)){var classes=format.classes;if(classes){for(var x=0;x<classes.length;x++){if(!ed.dom.hasClass(node,replaceVars(classes[x],vars))){return;}}}return format;}}}};var match$2=function match$2(editor,name,vars,node,similar){if(node){return matchParents(editor,node,name,vars,similar);}node=editor.selection.getNode();if(matchParents(editor,node,name,vars,similar)){return true;}var startNode=editor.selection.getStart();if(startNode!==node){if(matchParents(editor,startNode,name,vars,similar)){return true;}}return false;};var _matchAll=function matchAll(editor,names,vars){var matchedFormatNames=[];var checkedMap={};var startElement=editor.selection.getStart();editor.dom.getParent(startElement,function(node){for(var i=0;i<names.length;i++){var name_1=names[i];if(!checkedMap[name_1]&&_matchNode(editor,node,name_1,vars)){checkedMap[name_1]=true;matchedFormatNames.push(name_1);}}},editor.dom.getRoot());return matchedFormatNames;};var _closest=function closest(editor,names){var isRoot=function isRoot(elm){return eq(elm,SugarElement.fromDom(editor.getBody()));};var match=function match(elm,name){return _matchNode(editor,elm.dom,name)?Optional.some(name):Optional.none();};return Optional.from(editor.selection.getStart(true)).bind(function(rawElm){return closest$1(SugarElement.fromDom(rawElm),function(elm){return findMap(names,function(name){return match(elm,name);});},isRoot);}).getOrNull();};var _canApply=function canApply(editor,name){var formatList=editor.formatter.get(name);var dom=editor.dom;if(formatList){var startNode=editor.selection.getStart();var parents=getParents$2(dom,startNode);for(var x=formatList.length-1;x>=0;x--){var format=formatList[x];if(!isSelectorFormat(format)||isNonNullable(format.defaultBlock)){return true;}for(var i=parents.length-1;i>=0;i--){if(dom.is(parents[i],format.selector)){return true;}}}}return false;};var matchAllOnNode=function matchAllOnNode(editor,node,formatNames){return foldl(formatNames,function(acc,name){var matchSimilar=isVariableFormatName(editor,name);if(editor.formatter.matchNode(node,name,{},matchSimilar)){return acc.concat([name]);}else{return acc;}},[]);};var ZWSP=ZWSP$1,CARET_ID='_mce_caret';var importNode=function importNode(ownerDocument,node){return ownerDocument.importNode(node,true);};var getEmptyCaretContainers=function getEmptyCaretContainers(node){var nodes=[];while(node){if(node.nodeType===3&&node.nodeValue!==ZWSP||node.childNodes.length>1){return[];}if(node.nodeType===1){nodes.push(node);}node=node.firstChild;}return nodes;};var isCaretContainerEmpty=function isCaretContainerEmpty(node){return getEmptyCaretContainers(node).length>0;};var findFirstTextNode=function findFirstTextNode(node){if(node){var walker=new DomTreeWalker(node,node);for(node=walker.current();node;node=walker.next()){if(isText$7(node)){return node;}}}return null;};var createCaretContainer=function createCaretContainer(fill){var caretContainer=SugarElement.fromTag('span');setAll$1(caretContainer,{'id':CARET_ID,'data-mce-bogus':'1','data-mce-type':'format-caret'});if(fill){append$1(caretContainer,SugarElement.fromText(ZWSP));}return caretContainer;};var trimZwspFromCaretContainer=function trimZwspFromCaretContainer(caretContainerNode){var textNode=findFirstTextNode(caretContainerNode);if(textNode&&textNode.nodeValue.charAt(0)===ZWSP){textNode.deleteData(0,1);}return textNode;};var removeCaretContainerNode=function removeCaretContainerNode(editor,node,moveCaret){if(moveCaret===void 0){moveCaret=true;}var dom=editor.dom,selection=editor.selection;if(isCaretContainerEmpty(node)){deleteElement$2(editor,false,SugarElement.fromDom(node),moveCaret);}else{var rng=selection.getRng();var block=dom.getParent(node,dom.isBlock);var startContainer=rng.startContainer;var startOffset=rng.startOffset;var endContainer=rng.endContainer;var endOffset=rng.endOffset;var textNode=trimZwspFromCaretContainer(node);dom.remove(node,true);if(startContainer===textNode&&startOffset>0){rng.setStart(textNode,startOffset-1);}if(endContainer===textNode&&endOffset>0){rng.setEnd(textNode,endOffset-1);}if(block&&dom.isEmpty(block)){fillWithPaddingBr(SugarElement.fromDom(block));}selection.setRng(rng);}};var removeCaretContainer=function removeCaretContainer(editor,node,moveCaret){if(moveCaret===void 0){moveCaret=true;}var dom=editor.dom,selection=editor.selection;if(!node){node=getParentCaretContainer(editor.getBody(),selection.getStart());if(!node){while(node=dom.get(CARET_ID)){removeCaretContainerNode(editor,node,false);}}}else{removeCaretContainerNode(editor,node,moveCaret);}};var insertCaretContainerNode=function insertCaretContainerNode(editor,caretContainer,formatNode){var dom=editor.dom,block=dom.getParent(formatNode,curry(isTextBlock$1,editor));if(block&&dom.isEmpty(block)){formatNode.parentNode.replaceChild(caretContainer,formatNode);}else{removeTrailingBr(SugarElement.fromDom(formatNode));if(dom.isEmpty(formatNode)){formatNode.parentNode.replaceChild(caretContainer,formatNode);}else{dom.insertAfter(caretContainer,formatNode);}}};var appendNode=function appendNode(parentNode,node){parentNode.appendChild(node);return node;};var insertFormatNodesIntoCaretContainer=function insertFormatNodesIntoCaretContainer(formatNodes,caretContainer){var innerMostFormatNode=foldr(formatNodes,function(parentNode,formatNode){return appendNode(parentNode,formatNode.cloneNode(false));},caretContainer);return appendNode(innerMostFormatNode,innerMostFormatNode.ownerDocument.createTextNode(ZWSP));};var cleanFormatNode=function cleanFormatNode(editor,caretContainer,formatNode,name,vars,similar){var formatter=editor.formatter;var dom=editor.dom;var validFormats=filter$4(keys(formatter.get()),function(formatName){return formatName!==name&&!contains$2(formatName,'removeformat');});var matchedFormats=matchAllOnNode(editor,formatNode,validFormats);var uniqueFormats=filter$4(matchedFormats,function(fmtName){return!areSimilarFormats(editor,fmtName,name);});if(uniqueFormats.length>0){var clonedFormatNode=formatNode.cloneNode(false);dom.add(caretContainer,clonedFormatNode);formatter.remove(name,vars,clonedFormatNode,similar);dom.remove(clonedFormatNode);return Optional.some(clonedFormatNode);}else{return Optional.none();}};var applyCaretFormat=function applyCaretFormat(editor,name,vars){var caretContainer,textNode;var selection=editor.selection;var selectionRng=selection.getRng();var offset=selectionRng.startOffset;var container=selectionRng.startContainer;var text=container.nodeValue;caretContainer=getParentCaretContainer(editor.getBody(),selection.getStart());if(caretContainer){textNode=findFirstTextNode(caretContainer);}var wordcharRegex=/[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;if(text&&offset>0&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))){var bookmark=selection.getBookmark();selectionRng.collapse(true);var rng=expandRng(editor,selectionRng,editor.formatter.get(name));rng=split(rng);editor.formatter.apply(name,vars,rng);selection.moveToBookmark(bookmark);}else{if(!caretContainer||textNode.nodeValue!==ZWSP){caretContainer=importNode(editor.getDoc(),createCaretContainer(true).dom);textNode=caretContainer.firstChild;selectionRng.insertNode(caretContainer);offset=1;editor.formatter.apply(name,vars,caretContainer);}else{editor.formatter.apply(name,vars,caretContainer);}selection.setCursorLocation(textNode,offset);}};var removeCaretFormat=function removeCaretFormat(editor,name,vars,similar){var dom=editor.dom;var selection=editor.selection;var hasContentAfter,node,formatNode;var parents=[];var rng=selection.getRng();var container=rng.startContainer;var offset=rng.startOffset;node=container;if(container.nodeType===3){if(offset!==container.nodeValue.length){hasContentAfter=true;}node=node.parentNode;}while(node){if(_matchNode(editor,node,name,vars,similar)){formatNode=node;break;}if(node.nextSibling){hasContentAfter=true;}parents.push(node);node=node.parentNode;}if(!formatNode){return;}if(hasContentAfter){var bookmark=selection.getBookmark();rng.collapse(true);var expandedRng=expandRng(editor,rng,editor.formatter.get(name),true);expandedRng=split(expandedRng);editor.formatter.remove(name,vars,expandedRng,similar);selection.moveToBookmark(bookmark);}else{var caretContainer=getParentCaretContainer(editor.getBody(),formatNode);var newCaretContainer=createCaretContainer(false).dom;insertCaretContainerNode(editor,newCaretContainer,caretContainer!==null?caretContainer:formatNode);var cleanedFormatNode=cleanFormatNode(editor,newCaretContainer,formatNode,name,vars,similar);var caretTextNode=insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()),newCaretContainer);removeCaretContainerNode(editor,caretContainer,false);selection.setCursorLocation(caretTextNode,1);if(dom.isEmpty(formatNode)){dom.remove(formatNode);}}};var disableCaretContainer=function disableCaretContainer(editor,keyCode){var selection=editor.selection,body=editor.getBody();removeCaretContainer(editor,null,false);if((keyCode===8||keyCode===46)&&selection.isCollapsed()&&selection.getStart().innerHTML===ZWSP){removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()));}if(keyCode===37||keyCode===39){removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()));}};var setup$k=function setup$k(editor){editor.on('mouseup keydown',function(e){disableCaretContainer(editor,e.keyCode);});};var replaceWithCaretFormat=function replaceWithCaretFormat(targetNode,formatNodes){var caretContainer=createCaretContainer(false);var innerMost=insertFormatNodesIntoCaretContainer(formatNodes,caretContainer.dom);before$4(SugarElement.fromDom(targetNode),caretContainer);remove$7(SugarElement.fromDom(targetNode));return _CaretPosition(innerMost,0);};var isFormatElement=function isFormatElement(editor,element){var inlineElements=editor.schema.getTextInlineElements();return has$2(inlineElements,name(element))&&!isCaretNode(element.dom)&&!isBogus$2(element.dom);};var isEmptyCaretFormatElement=function isEmptyCaretFormatElement(element){return isCaretNode(element.dom)&&isCaretContainerEmpty(element.dom);};var postProcessHooks={};var filter=filter$2;var each$c=each$i;var addPostProcessHook=function addPostProcessHook(name,hook){var hooks=postProcessHooks[name];if(!hooks){postProcessHooks[name]=[];}postProcessHooks[name].push(hook);};var postProcess$1=function postProcess$1(name,editor){each$c(postProcessHooks[name],function(hook){hook(editor);});};addPostProcessHook('pre',function(editor){var rng=editor.selection.getRng();var blocks;var hasPreSibling=function hasPreSibling(pre){return isPre(pre.previousSibling)&&indexOf$1(blocks,pre.previousSibling)!==-1;};var joinPre=function joinPre(pre1,pre2){DomQuery(pre2).remove();DomQuery(pre1).append('<br><br>').append(pre2.childNodes);};var isPre=matchNodeNames(['pre']);if(!rng.collapsed){blocks=editor.selection.getSelectedBlocks();each$c(filter(filter(blocks,isPre),hasPreSibling),function(pre){joinPre(pre.previousSibling,pre);});}});var each$b=Tools.each;var isElementNode$1=function isElementNode$1(node){return isElement$5(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node);};var findElementSibling=function findElementSibling(node,siblingName){for(var sibling=node;sibling;sibling=sibling[siblingName]){if(isText$7(sibling)&&isNotEmpty(sibling.data)){return node;}if(isElement$5(sibling)&&!isBookmarkNode$1(sibling)){return sibling;}}return node;};var mergeSiblingsNodes=function mergeSiblingsNodes(dom,prev,next){var elementUtils=ElementUtils(dom);if(prev&&next){prev=findElementSibling(prev,'previousSibling');next=findElementSibling(next,'nextSibling');if(elementUtils.compare(prev,next)){for(var sibling=prev.nextSibling;sibling&&sibling!==next;){var tmpSibling=sibling;sibling=sibling.nextSibling;prev.appendChild(tmpSibling);}dom.remove(next);Tools.each(Tools.grep(next.childNodes),function(node){prev.appendChild(node);});return prev;}}return next;};var mergeSiblings=function mergeSiblings(dom,format,vars,node){if(node&&format.merge_siblings!==false){var newNode=mergeSiblingsNodes(dom,getNonWhiteSpaceSibling(node),node);mergeSiblingsNodes(dom,newNode,getNonWhiteSpaceSibling(newNode,true));}};var clearChildStyles=function clearChildStyles(dom,format,node){if(format.clear_child_styles){var selector=format.links?'*:not(a)':'*';each$b(dom.select(selector,node),function(node){if(isElementNode$1(node)){each$b(format.styles,function(value,name){dom.setStyle(node,name,'');});}});}};var _processChildElements=function processChildElements(node,filter,process){each$b(node.childNodes,function(node){if(isElementNode$1(node)){if(filter(node)){process(node);}if(node.hasChildNodes()){_processChildElements(node,filter,process);}}});};var unwrapEmptySpan=function unwrapEmptySpan(dom,node){if(node.nodeName==='SPAN'&&dom.getAttribs(node).length===0){dom.remove(node,true);}};var hasStyle=function hasStyle(dom,name){return function(node){return!!(node&&getStyle(dom,node,name));};};var applyStyle=function applyStyle(dom,name,value){return function(node){dom.setStyle(node,name,value);if(node.getAttribute('style')===''){node.removeAttribute('style');}unwrapEmptySpan(dom,node);};};var removeResult=Adt.generate([{keep:[]},{rename:['name']},{removed:[]}]);var MCE_ATTR_RE=/^(src|href|style)$/;var each$a=Tools.each;var isEq$2=isEq$5;var isTableCellOrRow=function isTableCellOrRow(node){return /^(TR|TH|TD)$/.test(node.nodeName);};var isChildOfInlineParent=function isChildOfInlineParent(dom,node,parent){return dom.isChildOf(node,parent)&&node!==parent&&!dom.isBlock(parent);};var getContainer=function getContainer(ed,rng,start){var container=rng[start?'startContainer':'endContainer'];var offset=rng[start?'startOffset':'endOffset'];if(isElement$5(container)){var lastIdx=container.childNodes.length-1;if(!start&&offset){offset--;}container=container.childNodes[offset>lastIdx?lastIdx:offset];}if(isText$7(container)&&start&&offset>=container.nodeValue.length){container=new DomTreeWalker(container,ed.getBody()).next()||container;}if(isText$7(container)&&!start&&offset===0){container=new DomTreeWalker(container,ed.getBody()).prev()||container;}return container;};var normalizeTableSelection=function normalizeTableSelection(node,start){var prop=start?'firstChild':'lastChild';if(isTableCellOrRow(node)&&node[prop]){var childNode=node[prop];if(node.nodeName==='TR'){return childNode[prop]||childNode;}else{return childNode;}}return node;};var wrap$1=function wrap$1(dom,node,name,attrs){var wrapper=dom.create(name,attrs);node.parentNode.insertBefore(wrapper,node);wrapper.appendChild(node);return wrapper;};var wrapWithSiblings=function wrapWithSiblings(dom,node,next,name,attrs){var start=SugarElement.fromDom(node);var wrapper=SugarElement.fromDom(dom.create(name,attrs));var siblings=next?nextSiblings(start):prevSiblings(start);append(wrapper,siblings);if(next){before$4(start,wrapper);prepend(wrapper,start);}else{after$3(start,wrapper);append$1(wrapper,start);}return wrapper.dom;};var matchName=function matchName(dom,node,format){if(isInlineFormat(format)&&isEq$2(node,format.inline)){return true;}if(isBlockFormat(format)&&isEq$2(node,format.block)){return true;}if(isSelectorFormat(format)){return isElement$5(node)&&dom.is(node,format.selector);}};var isColorFormatAndAnchor=function isColorFormatAndAnchor(node,format){return format.links&&node.nodeName==='A';};var find=function find(dom,node,next,inc){var sibling=getNonWhiteSpaceSibling(node,next,inc);return isNullable(sibling)||sibling.nodeName==='BR'||dom.isBlock(sibling);};var removeNode=function removeNode(ed,node,format){var parentNode=node.parentNode;var rootBlockElm;var dom=ed.dom,forcedRootBlock=getForcedRootBlock(ed);if(isBlockFormat(format)){if(!forcedRootBlock){if(dom.isBlock(node)&&!dom.isBlock(parentNode)){if(!find(dom,node,false)&&!find(dom,node.firstChild,true,true)){node.insertBefore(dom.create('br'),node.firstChild);}if(!find(dom,node,true)&&!find(dom,node.lastChild,false,true)){node.appendChild(dom.create('br'));}}}else{if(parentNode===dom.getRoot()){if(!format.list_block||!isEq$2(node,format.list_block)){each$k(from(node.childNodes),function(node){if(isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())){if(!rootBlockElm){rootBlockElm=wrap$1(dom,node,forcedRootBlock);dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs);}else{rootBlockElm.appendChild(node);}}else{rootBlockElm=null;}});}}}}if(isMixedFormat(format)&&!isEq$2(format.inline,node)){return;}dom.remove(node,true);};var removeFormatInternal=function removeFormatInternal(ed,format,vars,node,compareNode){var stylesModified;var dom=ed.dom;if(!matchName(dom,node,format)&&!isColorFormatAndAnchor(node,format)){return removeResult.keep();}var elm=node;if(isInlineFormat(format)&&format.remove==='all'&&isArray$1(format.preserve_attributes)){var attrsToPreserve=filter$4(dom.getAttribs(elm),function(attr){return contains$3(format.preserve_attributes,attr.name.toLowerCase());});dom.removeAllAttribs(elm);each$k(attrsToPreserve,function(attr){return dom.setAttrib(elm,attr.name,attr.value);});if(attrsToPreserve.length>0){return removeResult.rename('span');}}if(format.remove!=='all'){each$a(format.styles,function(value,name){value=normalizeStyleValue(dom,replaceVars(value,vars),name+'');if(isNumber(name)){name=value;compareNode=null;}if(format.remove_similar||!compareNode||isEq$2(getStyle(dom,compareNode,name),value)){dom.setStyle(elm,name,'');}stylesModified=true;});if(stylesModified&&dom.getAttrib(elm,'style')===''){elm.removeAttribute('style');elm.removeAttribute('data-mce-style');}each$a(format.attributes,function(value,name){var valueOut;value=replaceVars(value,vars);if(isNumber(name)){name=value;compareNode=null;}if(format.remove_similar||!compareNode||isEq$2(dom.getAttrib(compareNode,name),value)){if(name==='class'){value=dom.getAttrib(elm,name);if(value){valueOut='';each$k(value.split(/\\s+/),function(cls){if(/mce\\-\\w+/.test(cls)){valueOut+=(valueOut?' ':'')+cls;}});if(valueOut){dom.setAttrib(elm,name,valueOut);return;}}}if(MCE_ATTR_RE.test(name)){elm.removeAttribute('data-mce-'+name);}if(name==='style'&&matchNodeNames(['li'])(elm)&&dom.getStyle(elm,'list-style-type')==='none'){elm.removeAttribute(name);dom.setStyle(elm,'list-style-type','none');return;}if(name==='class'){elm.removeAttribute('className');}elm.removeAttribute(name);}});each$a(format.classes,function(value){value=replaceVars(value,vars);if(!compareNode||dom.hasClass(compareNode,value)){dom.removeClass(elm,value);}});var attrs=dom.getAttribs(elm);for(var i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(attrName.indexOf('_')!==0&&attrName.indexOf('data-')!==0){return removeResult.keep();}}}if(format.remove!=='none'){removeNode(ed,elm,format);return removeResult.removed();}return removeResult.keep();};var removeFormat$1=function removeFormat$1(ed,format,vars,node,compareNode){return removeFormatInternal(ed,format,vars,node,compareNode).fold(never,function(newName){ed.dom.rename(node,newName);return true;},always);};var findFormatRoot=function findFormatRoot(editor,container,name,vars,similar){var formatRoot;each$k(getParents$2(editor.dom,container.parentNode).reverse(),function(parent){if(!formatRoot&&parent.id!=='_start'&&parent.id!=='_end'){var format=_matchNode(editor,parent,name,vars,similar);if(format&&format.split!==false){formatRoot=parent;}}});return formatRoot;};var removeFormatFromClone=function removeFormatFromClone(editor,format,vars,clone){return removeFormatInternal(editor,format,vars,clone,clone).fold(constant(clone),function(newName){var fragment=editor.dom.createFragment();fragment.appendChild(clone);return editor.dom.rename(clone,newName);},constant(null));};var wrapAndSplit=function wrapAndSplit(editor,formatList,formatRoot,container,target,split,format,vars){var clone,lastClone,firstClone;var dom=editor.dom;if(formatRoot){var formatRootParent=formatRoot.parentNode;for(var parent_1=container.parentNode;parent_1&&parent_1!==formatRootParent;parent_1=parent_1.parentNode){clone=dom.clone(parent_1,false);for(var i=0;i<formatList.length;i++){clone=removeFormatFromClone(editor,formatList[i],vars,clone);if(clone===null){break;}}if(clone){if(lastClone){clone.appendChild(lastClone);}if(!firstClone){firstClone=clone;}lastClone=clone;}}if(split&&(!format.mixed||!dom.isBlock(formatRoot))){container=dom.split(formatRoot,container);}if(lastClone){target.parentNode.insertBefore(lastClone,target);firstClone.appendChild(target);if(isInlineFormat(format)){mergeSiblings(dom,format,vars,lastClone);}}}return container;};var remove$1=function remove$1(ed,name,vars,node,similar){var formatList=ed.formatter.get(name);var format=formatList[0];var contentEditable=true;var dom=ed.dom;var selection=ed.selection;var splitToFormatRoot=function splitToFormatRoot(container){var formatRoot=findFormatRoot(ed,container,name,vars,similar);return wrapAndSplit(ed,formatList,formatRoot,container,container,true,format,vars);};var isRemoveBookmarkNode=function isRemoveBookmarkNode(node){return isBookmarkNode$1(node)&&isElement$5(node)&&(node.id==='_start'||node.id==='_end');};var removeNodeFormat=function removeNodeFormat(node){return exists(formatList,function(fmt){return removeFormat$1(ed,fmt,vars,node,node);});};var _process=function process(node){var lastContentEditable=true;var hasContentEditableState=false;if(isElement$5(node)&&dom.getContentEditable(node)){lastContentEditable=contentEditable;contentEditable=dom.getContentEditable(node)==='true';hasContentEditableState=true;}var children=from(node.childNodes);if(contentEditable&&!hasContentEditableState){var removed=removeNodeFormat(node);var currentNodeMatches=removed||exists(formatList,function(f){return matchName$1(dom,node,f);});var parentNode=node.parentNode;if(!currentNodeMatches&&isNonNullable(parentNode)&&shouldExpandToSelector(format)){removeNodeFormat(parentNode);}}if(format.deep){if(children.length){for(var i=0;i<children.length;i++){_process(children[i]);}if(hasContentEditableState){contentEditable=lastContentEditable;}}}var textDecorations=['underline','line-through','overline'];each$k(textDecorations,function(decoration){if(isElement$5(node)&&ed.dom.getStyle(node,'text-decoration')===decoration&&node.parentNode&&getTextDecoration(dom,node.parentNode)===decoration){removeFormat$1(ed,{deep:false,exact:true,inline:'span',styles:{textDecoration:decoration}},null,node);}});};var unwrap=function unwrap(start){var node=dom.get(start?'_start':'_end');var out=node[start?'firstChild':'lastChild'];if(isRemoveBookmarkNode(out)){out=out[start?'firstChild':'lastChild'];}if(isText$7(out)&&out.data.length===0){out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling;}dom.remove(node,true);return out;};var removeRngStyle=function removeRngStyle(rng){var startContainer,endContainer;var expandedRng=expandRng(ed,rng,formatList,rng.collapsed);if(format.split){expandedRng=split(expandedRng);startContainer=getContainer(ed,expandedRng,true);endContainer=getContainer(ed,expandedRng);if(startContainer!==endContainer){startContainer=normalizeTableSelection(startContainer,true);endContainer=normalizeTableSelection(endContainer,false);if(isChildOfInlineParent(dom,startContainer,endContainer)){var marker=Optional.from(startContainer.firstChild).getOr(startContainer);splitToFormatRoot(wrapWithSiblings(dom,marker,true,'span',{'id':'_start','data-mce-type':'bookmark'}));unwrap(true);return;}if(isChildOfInlineParent(dom,endContainer,startContainer)){var marker=Optional.from(endContainer.lastChild).getOr(endContainer);splitToFormatRoot(wrapWithSiblings(dom,marker,false,'span',{'id':'_end','data-mce-type':'bookmark'}));unwrap(false);return;}startContainer=wrap$1(dom,startContainer,'span',{'id':'_start','data-mce-type':'bookmark'});endContainer=wrap$1(dom,endContainer,'span',{'id':'_end','data-mce-type':'bookmark'});var newRng=dom.createRng();newRng.setStartAfter(startContainer);newRng.setEndBefore(endContainer);walk$2(dom,newRng,function(nodes){each$k(nodes,function(n){if(!isBookmarkNode$1(n)&&!isBookmarkNode$1(n.parentNode)){splitToFormatRoot(n);}});});splitToFormatRoot(startContainer);splitToFormatRoot(endContainer);startContainer=unwrap(true);endContainer=unwrap();}else{startContainer=endContainer=splitToFormatRoot(startContainer);}expandedRng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer;expandedRng.startOffset=dom.nodeIndex(startContainer);expandedRng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer;expandedRng.endOffset=dom.nodeIndex(endContainer)+1;}walk$2(dom,expandedRng,function(nodes){each$k(nodes,_process);});};if(node){if(isNode(node)){var rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);removeRngStyle(rng);}else{removeRngStyle(node);}fireFormatRemove(ed,name,node,vars);return;}if(dom.getContentEditable(selection.getNode())==='false'){node=selection.getNode();for(var i=0;i<formatList.length;i++){if(formatList[i].ceFalseOverride){if(removeFormat$1(ed,formatList[i],vars,node,node)){break;}}}fireFormatRemove(ed,name,node,vars);return;}if(!selection.isCollapsed()||!isInlineFormat(format)||getCellsFromEditor(ed).length){preserve(selection,true,function(){runOnRanges(ed,removeRngStyle);});if(isInlineFormat(format)&&match$2(ed,name,vars,selection.getStart())){moveStart(dom,selection,selection.getRng());}ed.nodeChanged();}else{removeCaretFormat(ed,name,vars,similar);}fireFormatRemove(ed,name,node,vars);};var each$9=Tools.each;var mergeTextDecorationsAndColor=function mergeTextDecorationsAndColor(dom,format,vars,node){var processTextDecorationsAndColor=function processTextDecorationsAndColor(n){if(n.nodeType===1&&n.parentNode&&n.parentNode.nodeType===1){var textDecoration=getTextDecoration(dom,n.parentNode);if(dom.getStyle(n,'color')&&textDecoration){dom.setStyle(n,'text-decoration',textDecoration);}else if(dom.getStyle(n,'text-decoration')===textDecoration){dom.setStyle(n,'text-decoration',null);}}};if(format.styles&&(format.styles.color||format.styles.textDecoration)){Tools.walk(node,processTextDecorationsAndColor,'childNodes');processTextDecorationsAndColor(node);}};var mergeBackgroundColorAndFontSize=function mergeBackgroundColorAndFontSize(dom,format,vars,node){if(format.styles&&format.styles.backgroundColor){_processChildElements(node,hasStyle(dom,'fontSize'),applyStyle(dom,'backgroundColor',replaceVars(format.styles.backgroundColor,vars)));}};var mergeSubSup=function mergeSubSup(dom,format,vars,node){if(isInlineFormat(format)&&(format.inline==='sub'||format.inline==='sup')){_processChildElements(node,hasStyle(dom,'fontSize'),applyStyle(dom,'fontSize',''));dom.remove(dom.select(format.inline==='sup'?'sub':'sup',node),true);}};var mergeWithChildren=function mergeWithChildren(editor,formatList,vars,node){each$9(formatList,function(format){if(isInlineFormat(format)){each$9(editor.dom.select(format.inline,node),function(child){if(!isElementNode$1(child)){return;}removeFormat$1(editor,format,vars,child,format.exact?child:null);});}clearChildStyles(editor.dom,format,node);});};var mergeWithParents=function mergeWithParents(editor,format,name,vars,node){if(_matchNode(editor,node.parentNode,name,vars)){if(removeFormat$1(editor,format,vars,node)){return;}}if(format.merge_with_parents){editor.dom.getParent(node.parentNode,function(parent){if(_matchNode(editor,parent,name,vars)){removeFormat$1(editor,format,vars,node);return true;}});}};var each$8=Tools.each;var isElementNode=function isElementNode(node){return isElement$5(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node);};var canFormatBR=function canFormatBR(editor,format,node,parentName){if(canFormatEmptyLines(editor)&&isInlineFormat(format)){var validBRParentElements=getTextRootBlockElements(editor.schema);var hasCaretNodeSibling=sibling(SugarElement.fromDom(node),function(sibling){return isCaretNode(sibling.dom);});return hasNonNullableKey(validBRParentElements,parentName)&&isEmpty$2(SugarElement.fromDom(node.parentNode),false)&&!hasCaretNodeSibling;}else{return false;}};var _applyFormat$=function applyFormat$1(ed,name,vars,node){var formatList=ed.formatter.get(name);var format=formatList[0];var isCollapsed=!node&&ed.selection.isCollapsed();var dom=ed.dom;var selection=ed.selection;var setElementFormat=function setElementFormat(elm,fmt){if(fmt===void 0){fmt=format;}if(isFunction(fmt.onformat)){fmt.onformat(elm,fmt,vars,node);}each$8(fmt.styles,function(value,name){dom.setStyle(elm,name,replaceVars(value,vars));});if(fmt.styles){var styleVal=dom.getAttrib(elm,'style');if(styleVal){dom.setAttrib(elm,'data-mce-style',styleVal);}}each$8(fmt.attributes,function(value,name){dom.setAttrib(elm,name,replaceVars(value,vars));});each$8(fmt.classes,function(value){value=replaceVars(value,vars);if(!dom.hasClass(elm,value)){dom.addClass(elm,value);}});};var applyNodeStyle=function applyNodeStyle(formatList,node){var found=false;each$8(formatList,function(format){if(!isSelectorFormat(format)){return false;}if(isNonNullable(format.collapsed)&&format.collapsed!==isCollapsed){return;}if(dom.is(node,format.selector)&&!isCaretNode(node)){setElementFormat(node,format);found=true;return false;}});return found;};var createWrapElement=function createWrapElement(wrapName){if(isString$1(wrapName)){var wrapElm=dom.create(wrapName);setElementFormat(wrapElm);return wrapElm;}else{return null;}};var applyRngStyle=function applyRngStyle(dom,rng,nodeSpecific){var newWrappers=[];var contentEditable=true;var wrapName=format.inline||format.block;var wrapElm=createWrapElement(wrapName);walk$2(dom,rng,function(nodes){var currentWrapElm;var _process2=function process(node){var hasContentEditableState=false;var lastContentEditable=contentEditable;var nodeName=node.nodeName.toLowerCase();var parentNode=node.parentNode;var parentName=parentNode.nodeName.toLowerCase();if(isElement$5(node)&&dom.getContentEditable(node)){lastContentEditable=contentEditable;contentEditable=dom.getContentEditable(node)==='true';hasContentEditableState=true;}if(isBr$5(node)&&!canFormatBR(ed,format,node,parentName)){currentWrapElm=null;if(isBlockFormat(format)){dom.remove(node);}return;}if(isBlockFormat(format)&&format.wrapper&&_matchNode(ed,node,name,vars)){currentWrapElm=null;return;}if(contentEditable&&!hasContentEditableState&&isBlockFormat(format)&&!format.wrapper&&isTextBlock$1(ed,nodeName)&&isValid(ed,parentName,wrapName)){var elm=dom.rename(node,wrapName);setElementFormat(elm);newWrappers.push(elm);currentWrapElm=null;return;}if(isSelectorFormat(format)){var found=applyNodeStyle(formatList,node);if(!found&&isNonNullable(parentNode)&&shouldExpandToSelector(format)){found=applyNodeStyle(formatList,parentNode);}if(!isInlineFormat(format)||found){currentWrapElm=null;return;}}if(contentEditable&&!hasContentEditableState&&isValid(ed,wrapName,nodeName)&&isValid(ed,parentName,wrapName)&&!(!nodeSpecific&&isText$7(node)&&isZwsp(node.data))&&!isCaretNode(node)&&(!isInlineFormat(format)||!dom.isBlock(node))){if(!currentWrapElm){currentWrapElm=dom.clone(wrapElm,false);node.parentNode.insertBefore(currentWrapElm,node);newWrappers.push(currentWrapElm);}currentWrapElm.appendChild(node);}else{currentWrapElm=null;each$k(from(node.childNodes),_process2);if(hasContentEditableState){contentEditable=lastContentEditable;}currentWrapElm=null;}};each$k(nodes,_process2);});if(format.links===true){each$k(newWrappers,function(node){var _process3=function process(node){if(node.nodeName==='A'){setElementFormat(node,format);}each$k(from(node.childNodes),_process3);};_process3(node);});}each$k(newWrappers,function(node){var getChildCount=function getChildCount(node){var count=0;each$k(node.childNodes,function(node){if(!isEmptyTextNode$1(node)&&!isBookmarkNode$1(node)){count++;}});return count;};var mergeStyles=function mergeStyles(node){var childElement=find$3(node.childNodes,isElementNode).filter(function(child){return matchName$1(dom,child,format);});return childElement.map(function(child){var clone=dom.clone(child,false);setElementFormat(clone);dom.replace(clone,node,true);dom.remove(child,true);return clone;}).getOr(node);};var childCount=getChildCount(node);if((newWrappers.length>1||!dom.isBlock(node))&&childCount===0){dom.remove(node,true);return;}if(isInlineFormat(format)||isBlockFormat(format)&&format.wrapper){if(!format.exact&&childCount===1){node=mergeStyles(node);}mergeWithChildren(ed,formatList,vars,node);mergeWithParents(ed,format,name,vars,node);mergeBackgroundColorAndFontSize(dom,format,vars,node);mergeTextDecorationsAndColor(dom,format,vars,node);mergeSubSup(dom,format,vars,node);mergeSiblings(dom,format,vars,node);}});};if(dom.getContentEditable(selection.getNode())==='false'){node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){var formatItem=formatList[i];if(formatItem.ceFalseOverride&&isSelectorFormat(formatItem)&&dom.is(node,formatItem.selector)){setElementFormat(node,formatItem);break;}}fireFormatApply(ed,name,node,vars);return;}if(format){if(node){if(isNode(node)){if(!applyNodeStyle(formatList,node)){var rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);applyRngStyle(dom,expandRng(ed,rng,formatList),true);}}else{applyRngStyle(dom,node,true);}}else{if(!isCollapsed||!isInlineFormat(format)||getCellsFromEditor(ed).length){var curSelNode=selection.getNode();var firstFormat=formatList[0];if(!ed.settings.forced_root_block&&firstFormat.defaultBlock&&!dom.getParent(curSelNode,dom.isBlock)){_applyFormat$(ed,firstFormat.defaultBlock);}selection.setRng(normalize(selection.getRng()));preserve(selection,true,function(){runOnRanges(ed,function(selectionRng,fake){var expandedRng=fake?selectionRng:expandRng(ed,selectionRng,formatList);applyRngStyle(dom,expandedRng,false);});});moveStart(dom,selection,selection.getRng());ed.nodeChanged();}else{applyCaretFormat(ed,name,vars);}}postProcess$1(name,ed);}fireFormatApply(ed,name,node,vars);};var hasVars=function hasVars(value){return has$2(value,'vars');};var setup$j=function setup$j(registeredFormatListeners,editor){registeredFormatListeners.set({});editor.on('NodeChange',function(e){updateAndFireChangeCallbacks(editor,e.element,registeredFormatListeners.get());});editor.on('FormatApply FormatRemove',function(e){var element=Optional.from(e.node).map(function(nodeOrRange){return isNode(nodeOrRange)?nodeOrRange:nodeOrRange.startContainer;}).bind(function(node){return isElement$5(node)?Optional.some(node):Optional.from(node.parentElement);}).getOrThunk(function(){return fallbackElement(editor);});updateAndFireChangeCallbacks(editor,element,registeredFormatListeners.get());});};var fallbackElement=function fallbackElement(editor){return editor.selection.getStart();};var matchingNode=function matchingNode(editor,parents,format,similar,vars){var isMatchingNode=function isMatchingNode(node){var matchingFormat=editor.formatter.matchNode(node,format,vars!==null&&vars!==void 0?vars:{},similar);return!isUndefined(matchingFormat);};var isUnableToMatch=function isUnableToMatch(node){if(matchesUnInheritedFormatSelector(editor,node,format)){return true;}else{if(!similar){return isNonNullable(editor.formatter.matchNode(node,format,vars,true));}else{return false;}}};return findUntil$1(parents,isMatchingNode,isUnableToMatch);};var getParents=function getParents(editor,elm){var element=elm!==null&&elm!==void 0?elm:fallbackElement(editor);return filter$4(getParents$2(editor.dom,element),function(node){return isElement$5(node)&&!isBogus$2(node);});};var updateAndFireChangeCallbacks=function updateAndFireChangeCallbacks(editor,elm,registeredCallbacks){var parents=getParents(editor,elm);each$j(registeredCallbacks,function(data,format){var runIfChanged=function runIfChanged(spec){var match=matchingNode(editor,parents,format,spec.similar,hasVars(spec)?spec.vars:undefined);var isSet=match.isSome();if(spec.state.get()!==isSet){spec.state.set(isSet);var node_1=match.getOr(elm);if(hasVars(spec)){spec.callback(isSet,{node:node_1,format:format,parents:parents});}else{each$k(spec.callbacks,function(callback){return callback(isSet,{node:node_1,format:format,parents:parents});});}}};each$k([data.withSimilar,data.withoutSimilar],runIfChanged);each$k(data.withVars,runIfChanged);});};var addListeners=function addListeners(editor,registeredFormatListeners,formats,callback,similar,vars){var formatChangeItems=registeredFormatListeners.get();each$k(formats.split(','),function(format){var group=get$9(formatChangeItems,format).getOrThunk(function(){var base={withSimilar:{state:Cell(false),similar:true,callbacks:[]},withoutSimilar:{state:Cell(false),similar:false,callbacks:[]},withVars:[]};formatChangeItems[format]=base;return base;});var getCurrent=function getCurrent(){var parents=getParents(editor);return matchingNode(editor,parents,format,similar,vars).isSome();};if(isUndefined(vars)){var toAppendTo=similar?group.withSimilar:group.withoutSimilar;toAppendTo.callbacks.push(callback);if(toAppendTo.callbacks.length===1){toAppendTo.state.set(getCurrent());}}else{group.withVars.push({state:Cell(getCurrent()),similar:similar,vars:vars,callback:callback});}});registeredFormatListeners.set(formatChangeItems);};var removeListeners=function removeListeners(registeredFormatListeners,formats,callback){var formatChangeItems=registeredFormatListeners.get();each$k(formats.split(','),function(format){return get$9(formatChangeItems,format).each(function(group){formatChangeItems[format]={withSimilar:_assign(_assign({},group.withSimilar),{callbacks:filter$4(group.withSimilar.callbacks,function(cb){return cb!==callback;})}),withoutSimilar:_assign(_assign({},group.withoutSimilar),{callbacks:filter$4(group.withoutSimilar.callbacks,function(cb){return cb!==callback;})}),withVars:filter$4(group.withVars,function(item){return item.callback!==callback;})};});});registeredFormatListeners.set(formatChangeItems);};var formatChangedInternal=function formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars){if(registeredFormatListeners.get()===null){setup$j(registeredFormatListeners,editor);}addListeners(editor,registeredFormatListeners,formats,callback,similar,vars);return{unbind:function unbind(){return removeListeners(registeredFormatListeners,formats,callback);}};};var _toggle=function toggle(editor,name,vars,node){var fmt=editor.formatter.get(name);if(match$2(editor,name,vars,node)&&(!('toggle'in fmt[0])||fmt[0].toggle)){remove$1(editor,name,vars,node);}else{_applyFormat$(editor,name,vars,node);}};var fromElements=function fromElements(elements,scope){var doc=scope||document;var fragment=doc.createDocumentFragment();each$k(elements,function(element){fragment.appendChild(element.dom);});return SugarElement.fromDom(fragment);};var tableModel=function tableModel(element,width,rows){return{element:element,width:width,rows:rows};};var tableRow=function tableRow(element,cells){return{element:element,cells:cells};};var cellPosition=function cellPosition(x,y){return{x:x,y:y};};var getSpan=function getSpan(td,key){var value=parseInt(get$6(td,key),10);return isNaN(value)?1:value;};var fillout=function fillout(table,x,y,tr,td){var rowspan=getSpan(td,'rowspan');var colspan=getSpan(td,'colspan');var rows=table.rows;for(var y2=y;y2<y+rowspan;y2++){if(!rows[y2]){rows[y2]=tableRow(deep$1(tr),[]);}for(var x2=x;x2<x+colspan;x2++){var cells=rows[y2].cells;cells[x2]=y2===y&&x2===x?td:shallow(td);}}};var cellExists=function cellExists(table,x,y){var rows=table.rows;var cells=rows[y]?rows[y].cells:[];return!!cells[x];};var skipCellsX=function skipCellsX(table,x,y){while(cellExists(table,x,y)){x++;}return x;};var getWidth=function getWidth(rows){return foldl(rows,function(acc,row){return row.cells.length>acc?row.cells.length:acc;},0);};var findElementPos=function findElementPos(table,element){var rows=table.rows;for(var y=0;y<rows.length;y++){var cells=rows[y].cells;for(var x=0;x<cells.length;x++){if(eq(cells[x],element)){return Optional.some(cellPosition(x,y));}}}return Optional.none();};var extractRows=function extractRows(table,sx,sy,ex,ey){var newRows=[];var rows=table.rows;for(var y=sy;y<=ey;y++){var cells=rows[y].cells;var slice=sx<ex?cells.slice(sx,ex+1):cells.slice(ex,sx+1);newRows.push(tableRow(rows[y].element,slice));}return newRows;};var subTable=function subTable(table,startPos,endPos){var sx=startPos.x,sy=startPos.y;var ex=endPos.x,ey=endPos.y;var newRows=sy<ey?extractRows(table,sx,sy,ex,ey):extractRows(table,sx,ey,ex,sy);return tableModel(table.element,getWidth(newRows),newRows);};var createDomTable=function createDomTable(table,rows){var tableElement=shallow(table.element);var tableBody=SugarElement.fromTag('tbody');append(tableBody,rows);append$1(tableElement,tableBody);return tableElement;};var modelRowsToDomRows=function modelRowsToDomRows(table){return map$3(table.rows,function(row){var cells=map$3(row.cells,function(cell){var td=deep$1(cell);remove$6(td,'colspan');remove$6(td,'rowspan');return td;});var tr=shallow(row.element);append(tr,cells);return tr;});};var fromDom=function fromDom(tableElm){var table=tableModel(shallow(tableElm),0,[]);each$k(descendants(tableElm,'tr'),function(tr,y){each$k(descendants(tr,'td,th'),function(td,x){fillout(table,skipCellsX(table,x,y),y,tr,td);});});return tableModel(table.element,getWidth(table.rows),table.rows);};var toDom=function toDom(table){return createDomTable(table,modelRowsToDomRows(table));};var subsection=function subsection(table,startElement,endElement){return findElementPos(table,startElement).bind(function(startPos){return findElementPos(table,endElement).map(function(endPos){return subTable(table,startPos,endPos);});});};var findParentListContainer=function findParentListContainer(parents){return find$3(parents,function(elm){return name(elm)==='ul'||name(elm)==='ol';});};var getFullySelectedListWrappers=function getFullySelectedListWrappers(parents,rng){return find$3(parents,function(elm){return name(elm)==='li'&&hasAllContentsSelected(elm,rng);}).fold(constant([]),function(_li){return findParentListContainer(parents).map(function(listCont){var listElm=SugarElement.fromTag(name(listCont));var listStyles=filter$3(getAllRaw(listCont),function(_style,name){return startsWith(name,'list-style');});setAll(listElm,listStyles);return[SugarElement.fromTag('li'),listElm];}).getOr([]);});};var wrap=function wrap(innerElm,elms){var wrapped=foldl(elms,function(acc,elm){append$1(elm,acc);return elm;},innerElm);return elms.length>0?fromElements([wrapped]):wrapped;};var directListWrappers=function directListWrappers(commonAnchorContainer){if(isListItem(commonAnchorContainer)){return parent(commonAnchorContainer).filter(isList).fold(constant([]),function(listElm){return[commonAnchorContainer,listElm];});}else{return isList(commonAnchorContainer)?[commonAnchorContainer]:[];}};var getWrapElements=function getWrapElements(rootNode,rng){var commonAnchorContainer=SugarElement.fromDom(rng.commonAncestorContainer);var parents=parentsAndSelf(commonAnchorContainer,rootNode);var wrapElements=filter$4(parents,function(elm){return isInline$1(elm)||isHeading(elm);});var listWrappers=getFullySelectedListWrappers(parents,rng);var allWrappers=wrapElements.concat(listWrappers.length?listWrappers:directListWrappers(commonAnchorContainer));return map$3(allWrappers,shallow);};var emptyFragment=function emptyFragment(){return fromElements([]);};var getFragmentFromRange=function getFragmentFromRange(rootNode,rng){return wrap(SugarElement.fromDom(rng.cloneContents()),getWrapElements(rootNode,rng));};var getParentTable=function getParentTable(rootElm,cell){return ancestor$2(cell,'table',curry(eq,rootElm));};var getTableFragment=function getTableFragment(rootNode,selectedTableCells){return getParentTable(rootNode,selectedTableCells[0]).bind(function(tableElm){var firstCell=selectedTableCells[0];var lastCell=selectedTableCells[selectedTableCells.length-1];var fullTableModel=fromDom(tableElm);return subsection(fullTableModel,firstCell,lastCell).map(function(sectionedTableModel){return fromElements([toDom(sectionedTableModel)]);});}).getOrThunk(emptyFragment);};var getSelectionFragment=function getSelectionFragment(rootNode,ranges){return ranges.length>0&&ranges[0].collapsed?emptyFragment():getFragmentFromRange(rootNode,ranges[0]);};var read$3=function read$3(rootNode,ranges){var selectedCells=getCellsFromElementOrRanges(ranges,rootNode);return selectedCells.length>0?getTableFragment(rootNode,selectedCells):getSelectionFragment(rootNode,ranges);};var trimLeadingCollapsibleText=function trimLeadingCollapsibleText(text){return text.replace(/^[ \\f\\n\\r\\t\\v]+/,'');};var isCollapsibleWhitespace=function isCollapsibleWhitespace(text,index){return index>=0&&index<text.length&&isWhiteSpace(text.charAt(index));};var getInnerText=function getInnerText(bin,shouldTrim){var text=trim$3(bin.innerText);return shouldTrim?trimLeadingCollapsibleText(text):text;};var getContextNodeName=function getContextNodeName(parentBlockOpt){return parentBlockOpt.map(function(block){return block.nodeName;}).getOr('div').toLowerCase();};var getTextContent=function getTextContent(editor){return Optional.from(editor.selection.getRng()).map(function(rng){var parentBlockOpt=Optional.from(editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock));var body=editor.getBody();var contextNodeName=getContextNodeName(parentBlockOpt);var shouldTrimSpaces=Env.browser.isIE()&&contextNodeName!=='pre';var bin=editor.dom.add(body,contextNodeName,{'data-mce-bogus':'all','style':'overflow: hidden; opacity: 0;'},rng.cloneContents());var text=getInnerText(bin,shouldTrimSpaces);var nonRenderedText=trim$3(bin.textContent);editor.dom.remove(bin);if(isCollapsibleWhitespace(nonRenderedText,0)||isCollapsibleWhitespace(nonRenderedText,nonRenderedText.length-1)){var parentBlock=parentBlockOpt.getOr(body);var parentBlockText=getInnerText(parentBlock,shouldTrimSpaces);var textIndex=parentBlockText.indexOf(text);if(textIndex===-1){return text;}else{var hasProceedingSpace=isCollapsibleWhitespace(parentBlockText,textIndex-1);var hasTrailingSpace=isCollapsibleWhitespace(parentBlockText,textIndex+text.length);return(hasProceedingSpace?' ':'')+text+(hasTrailingSpace?' ':'');}}else{return text;}}).getOr('');};var getSerializedContent=function getSerializedContent(editor,args){var rng=editor.selection.getRng(),tmpElm=editor.dom.create('body');var sel=editor.selection.getSel();var ranges=processRanges(editor,getRanges(sel));var fragment=args.contextual?read$3(SugarElement.fromDom(editor.getBody()),ranges).dom:rng.cloneContents();if(fragment){tmpElm.appendChild(fragment);}return editor.selection.serializer.serialize(tmpElm,args);};var setupArgs$1=function setupArgs$1(args,format){return _assign(_assign({},args),{format:format,get:true,selection:true});};var getSelectedContentInternal=function getSelectedContentInternal(editor,format,args){if(args===void 0){args={};}var defaultedArgs=setupArgs$1(args,format);var updatedArgs=editor.fire('BeforeGetContent',defaultedArgs);if(updatedArgs.isDefaultPrevented()){editor.fire('GetContent',updatedArgs);return updatedArgs.content;}if(updatedArgs.format==='text'){return getTextContent(editor);}else{updatedArgs.getInner=true;var content=getSerializedContent(editor,updatedArgs);if(updatedArgs.format==='tree'){return content;}else{updatedArgs.content=editor.selection.isCollapsed()?'':content;editor.fire('GetContent',updatedArgs);return updatedArgs.content;}}};var KEEP=0,INSERT=1,DELETE=2;var diff=function diff(left,right){var size=left.length+right.length+2;var vDown=new Array(size);var vUp=new Array(size);var snake=function snake(start,end,diag){return{start:start,end:end,diag:diag};};var _buildScript=function buildScript(start1,end1,start2,end2,script){var middle=getMiddleSnake(start1,end1,start2,end2);if(middle===null||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2){var i=start1;var j=start2;while(i<end1||j<end2){if(i<end1&&j<end2&&left[i]===right[j]){script.push([KEEP,left[i]]);++i;++j;}else{if(end1-start1>end2-start2){script.push([DELETE,left[i]]);++i;}else{script.push([INSERT,right[j]]);++j;}}}}else{_buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2){script.push([KEEP,left[i2]]);}_buildScript(middle.end,end1,middle.end-middle.diag,end2,script);}};var buildSnake=function buildSnake(start,diag,end1,end2){var end=start;while(end-diag<end2&&end<end1&&left[end]===right[end-diag]){++end;}return snake(start,end,diag);};var getMiddleSnake=function getMiddleSnake(start1,end1,start2,end2){var m=end1-start1;var n=end2-start2;if(m===0||n===0){return null;}var delta=m-n;var sum=n+m;var offset=(sum%2===0?sum:sum+1)/2;vDown[1+offset]=start1;vUp[1+offset]=end1+1;var d,k,i,x,y;for(d=0;d<=offset;++d){for(k=-d;k<=d;k+=2){i=k+offset;if(k===-d||k!==d&&vDown[i-1]<vDown[i+1]){vDown[i]=vDown[i+1];}else{vDown[i]=vDown[i-1]+1;}x=vDown[i];y=x-start1+start2-k;while(x<end1&&y<end2&&left[x]===right[y]){vDown[i]=++x;++y;}if(delta%2!==0&&delta-d<=k&&k<=delta+d){if(vUp[i-delta]<=vDown[i]){return buildSnake(vUp[i-delta],k+start1-start2,end1,end2);}}}for(k=delta-d;k<=delta+d;k+=2){i=k+offset-delta;if(k===delta-d||k!==delta+d&&vUp[i+1]<=vUp[i-1]){vUp[i]=vUp[i+1]-1;}else{vUp[i]=vUp[i-1];}x=vUp[i]-1;y=x-start1+start2-k;while(x>=start1&&y>=start2&&left[x]===right[y]){vUp[i]=x--;y--;}if(delta%2===0&&-d<=k&&k<=d){if(vUp[i]<=vDown[i+delta]){return buildSnake(vUp[i],k+start1-start2,end1,end2);}}}}};var script=[];_buildScript(0,left.length,0,right.length,script);return script;};var getOuterHtml=function getOuterHtml(elm){if(isElement$5(elm)){return elm.outerHTML;}else if(isText$7(elm)){return Entities.encodeRaw(elm.data,false);}else if(isComment(elm)){return'<!--'+elm.data+'-->';}return'';};var createFragment=function createFragment(html){var node;var container=document.createElement('div');var frag=document.createDocumentFragment();if(html){container.innerHTML=html;}while(node=container.firstChild){frag.appendChild(node);}return frag;};var insertAt=function insertAt(elm,html,index){var fragment=createFragment(html);if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.insertBefore(fragment,target);}else{elm.appendChild(fragment);}};var removeAt=function removeAt(elm,index){if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.removeChild(target);}};var applyDiff=function applyDiff(diff,elm){var index=0;each$k(diff,function(action){if(action[0]===KEEP){index++;}else if(action[0]===INSERT){insertAt(elm,action[1],index);index++;}else if(action[0]===DELETE){removeAt(elm,index);}});};var read$2=function read$2(elm,trimZwsp){return filter$4(map$3(from(elm.childNodes),trimZwsp?compose(trim$3,getOuterHtml):getOuterHtml),function(item){return item.length>0;});};var write=function write(fragments,elm){var currentFragments=map$3(from(elm.childNodes),getOuterHtml);applyDiff(diff(currentFragments,fragments),elm);return elm;};var lazyTempDocument$1=cached(function(){return document.implementation.createHTMLDocument('undo');});var hasIframes=function hasIframes(body){return body.querySelector('iframe')!==null;};var createFragmentedLevel=function createFragmentedLevel(fragments){return{type:'fragmented',fragments:fragments,content:'',bookmark:null,beforeBookmark:null};};var createCompleteLevel=function createCompleteLevel(content){return{type:'complete',fragments:null,content:content,bookmark:null,beforeBookmark:null};};var createFromEditor=function createFromEditor(editor){var tempAttrs=editor.serializer.getTempAttrs();var body=trim$1(editor.getBody(),tempAttrs);return hasIframes(body)?createFragmentedLevel(read$2(body,true)):createCompleteLevel(trim$3(body.innerHTML));};var applyToEditor=function applyToEditor(editor,level,before){var bookmark=before?level.beforeBookmark:level.bookmark;if(level.type==='fragmented'){write(level.fragments,editor.getBody());}else{editor.setContent(level.content,{format:'raw',no_selection:isNonNullable(bookmark)&&isPathBookmark(bookmark)?!bookmark.isFakeCaret:true});}editor.selection.moveToBookmark(bookmark);};var getLevelContent=function getLevelContent(level){return level.type==='fragmented'?level.fragments.join(''):level.content;};var getCleanLevelContent=function getCleanLevelContent(level){var elm=SugarElement.fromTag('body',lazyTempDocument$1());set(elm,getLevelContent(level));each$k(descendants(elm,'*[data-mce-bogus]'),unwrap);return get$3(elm);};var hasEqualContent=function hasEqualContent(level1,level2){return getLevelContent(level1)===getLevelContent(level2);};var hasEqualCleanedContent=function hasEqualCleanedContent(level1,level2){return getCleanLevelContent(level1)===getCleanLevelContent(level2);};var isEq$1=function isEq$1(level1,level2){if(!level1||!level2){return false;}else if(hasEqualContent(level1,level2)){return true;}else{return hasEqualCleanedContent(level1,level2);}};var isUnlocked=function isUnlocked(locks){return locks.get()===0;};var setTyping=function setTyping(undoManager,typing,locks){if(isUnlocked(locks)){undoManager.typing=typing;}};var endTyping=function endTyping(undoManager,locks){if(undoManager.typing){setTyping(undoManager,false,locks);undoManager.add();}};var endTypingLevelIgnoreLocks=function endTypingLevelIgnoreLocks(undoManager){if(undoManager.typing){undoManager.typing=false;undoManager.add();}};var beforeChange$1=function beforeChange$1(editor,locks,beforeBookmark){if(isUnlocked(locks)){beforeBookmark.set(getUndoBookmark(editor.selection));}};var addUndoLevel$1=function addUndoLevel$1(editor,undoManager,index,locks,beforeBookmark,level,event){var currentLevel=createFromEditor(editor);level=level||{};level=Tools.extend(level,currentLevel);if(isUnlocked(locks)===false||editor.removed){return null;}var lastLevel=undoManager.data[index.get()];if(editor.fire('BeforeAddUndo',{level:level,lastLevel:lastLevel,originalEvent:event}).isDefaultPrevented()){return null;}if(lastLevel&&isEq$1(lastLevel,level)){return null;}if(undoManager.data[index.get()]){beforeBookmark.get().each(function(bm){undoManager.data[index.get()].beforeBookmark=bm;});}var customUndoRedoLevels=getCustomUndoRedoLevels(editor);if(customUndoRedoLevels){if(undoManager.data.length>customUndoRedoLevels){for(var i=0;i<undoManager.data.length-1;i++){undoManager.data[i]=undoManager.data[i+1];}undoManager.data.length--;index.set(undoManager.data.length);}}level.bookmark=getUndoBookmark(editor.selection);if(index.get()<undoManager.data.length-1){undoManager.data.length=index.get()+1;}undoManager.data.push(level);index.set(undoManager.data.length-1);var args={level:level,lastLevel:lastLevel,originalEvent:event};if(index.get()>0){editor.setDirty(true);editor.fire('AddUndo',args);editor.fire('change',args);}else{editor.fire('AddUndo',args);}return level;};var clear$1=function clear$1(editor,undoManager,index){undoManager.data=[];index.set(0);undoManager.typing=false;editor.fire('ClearUndos');};var extra$1=function extra$1(editor,undoManager,index,callback1,callback2){if(undoManager.transact(callback1)){var bookmark=undoManager.data[index.get()].bookmark;var lastLevel=undoManager.data[index.get()-1];applyToEditor(editor,lastLevel,true);if(undoManager.transact(callback2)){undoManager.data[index.get()-1].beforeBookmark=bookmark;}}};var redo$1=function redo$1(editor,index,data){var level;if(index.get()<data.length-1){index.set(index.get()+1);level=data[index.get()];applyToEditor(editor,level,false);editor.setDirty(true);editor.fire('Redo',{level:level});}return level;};var undo$1=function undo$1(editor,undoManager,locks,index){var level;if(undoManager.typing){undoManager.add();undoManager.typing=false;setTyping(undoManager,false,locks);}if(index.get()>0){index.set(index.get()-1);level=undoManager.data[index.get()];applyToEditor(editor,level,true);editor.setDirty(true);editor.fire('Undo',{level:level});}return level;};var reset$1=function reset$1(undoManager){undoManager.clear();undoManager.add();};var hasUndo$1=function hasUndo$1(editor,undoManager,index){return index.get()>0||undoManager.typing&&undoManager.data[0]&&!isEq$1(createFromEditor(editor),undoManager.data[0]);};var hasRedo$1=function hasRedo$1(undoManager,index){return index.get()<undoManager.data.length-1&&!undoManager.typing;};var transact$1=function transact$1(undoManager,locks,callback){endTyping(undoManager,locks);undoManager.beforeChange();undoManager.ignore(callback);return undoManager.add();};var ignore$1=function ignore$1(locks,callback){try{locks.set(locks.get()+1);callback();}finally{locks.set(locks.get()-1);}};var addVisualInternal=function addVisualInternal(editor,elm){var dom=editor.dom;var scope=isNonNullable(elm)?elm:editor.getBody();if(isUndefined(editor.hasVisual)){editor.hasVisual=isVisualAidsEnabled(editor);}each$k(dom.select('table,a',scope),function(matchedElm){switch(matchedElm.nodeName){case'TABLE':var cls=getVisualAidsTableClass(editor);var value=dom.getAttrib(matchedElm,'border');if((!value||value==='0')&&editor.hasVisual){dom.addClass(matchedElm,cls);}else{dom.removeClass(matchedElm,cls);}break;case'A':if(!dom.getAttrib(matchedElm,'href')){var value_1=dom.getAttrib(matchedElm,'name')||matchedElm.id;var cls_1=getVisualAidsAnchorClass(editor);if(value_1&&editor.hasVisual){dom.addClass(matchedElm,cls_1);}else{dom.removeClass(matchedElm,cls_1);}}break;}});editor.fire('VisualAid',{element:elm,hasVisual:editor.hasVisual});};var makePlainAdaptor=function makePlainAdaptor(editor){return{undoManager:{beforeChange:function beforeChange(locks,beforeBookmark){return beforeChange$1(editor,locks,beforeBookmark);},add:function add(undoManager,index,locks,beforeBookmark,level,event){return addUndoLevel$1(editor,undoManager,index,locks,beforeBookmark,level,event);},undo:function undo(undoManager,locks,index){return undo$1(editor,undoManager,locks,index);},redo:function redo(index,data){return redo$1(editor,index,data);},clear:function clear(undoManager,index){return clear$1(editor,undoManager,index);},reset:function reset(undoManager){return reset$1(undoManager);},hasUndo:function hasUndo(undoManager,index){return hasUndo$1(editor,undoManager,index);},hasRedo:function hasRedo(undoManager,index){return hasRedo$1(undoManager,index);},transact:function transact(undoManager,locks,callback){return transact$1(undoManager,locks,callback);},ignore:function ignore(locks,callback){return ignore$1(locks,callback);},extra:function extra(undoManager,index,callback1,callback2){return extra$1(editor,undoManager,index,callback1,callback2);}},formatter:{match:function match(name,vars,node,similar){return match$2(editor,name,vars,node,similar);},matchAll:function matchAll(names,vars){return _matchAll(editor,names,vars);},matchNode:function matchNode(node,name,vars,similar){return _matchNode(editor,node,name,vars,similar);},canApply:function canApply(name){return _canApply(editor,name);},closest:function closest(names){return _closest(editor,names);},apply:function apply(name,vars,node){return _applyFormat$(editor,name,vars,node);},remove:function remove(name,vars,node,similar){return remove$1(editor,name,vars,node,similar);},toggle:function toggle(name,vars,node){return _toggle(editor,name,vars,node);},formatChanged:function formatChanged(registeredFormatListeners,formats,callback,similar,vars){return formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars);}},editor:{getContent:function getContent(args,format){return getContentInternal(editor,args,format);},setContent:function setContent(content,args){return setContentInternal(editor,content,args);},insertContent:function insertContent(value,details){return insertHtmlAtCaret(editor,value,details);},addVisual:function addVisual(elm){return addVisualInternal(editor,elm);}},selection:{getContent:function getContent(format,args){return getSelectedContentInternal(editor,format,args);}},raw:{getModel:function getModel(){return Optional.none();}}};};var makeRtcAdaptor=function makeRtcAdaptor(rtcEditor){var defaultVars=function defaultVars(vars){return isObject(vars)?vars:{};};var undoManager=rtcEditor.undoManager,formatter=rtcEditor.formatter,editor=rtcEditor.editor,selection=rtcEditor.selection,raw=rtcEditor.raw;return{undoManager:{beforeChange:undoManager.beforeChange,add:undoManager.add,undo:undoManager.undo,redo:undoManager.redo,clear:undoManager.clear,reset:undoManager.reset,hasUndo:undoManager.hasUndo,hasRedo:undoManager.hasRedo,transact:function transact(_undoManager,_locks,fn){return undoManager.transact(fn);},ignore:function ignore(_locks,callback){return undoManager.ignore(callback);},extra:function extra(_undoManager,_index,callback1,callback2){return undoManager.extra(callback1,callback2);}},formatter:{match:function match(name,vars,_node,similar){return formatter.match(name,defaultVars(vars),similar);},matchAll:formatter.matchAll,matchNode:formatter.matchNode,canApply:function canApply(name){return formatter.canApply(name);},closest:function closest(names){return formatter.closest(names);},apply:function apply(name,vars,_node){return formatter.apply(name,defaultVars(vars));},remove:function remove(name,vars,_node,_similar){return formatter.remove(name,defaultVars(vars));},toggle:function toggle(name,vars,_node){return formatter.toggle(name,defaultVars(vars));},formatChanged:function formatChanged(_rfl,formats,callback,similar,vars){return formatter.formatChanged(formats,callback,similar,vars);}},editor:{getContent:function getContent(args,_format){return editor.getContent(args);},setContent:function setContent(content,args){return editor.setContent(content,args);},insertContent:function insertContent(content,_details){return editor.insertContent(content);},addVisual:editor.addVisual},selection:{getContent:function getContent(_format,args){return selection.getContent(args);}},raw:{getModel:function getModel(){return Optional.some(raw.getRawModel());}}};};var makeNoopAdaptor=function makeNoopAdaptor(){var nul=constant(null);var empty=constant('');return{undoManager:{beforeChange:noop,add:nul,undo:nul,redo:nul,clear:noop,reset:noop,hasUndo:never,hasRedo:never,transact:nul,ignore:noop,extra:noop},formatter:{match:never,matchAll:constant([]),matchNode:constant(undefined),canApply:never,closest:empty,apply:noop,remove:noop,toggle:noop,formatChanged:constant({unbind:noop})},editor:{getContent:empty,setContent:empty,insertContent:noop,addVisual:noop},selection:{getContent:empty},raw:{getModel:constant(Optional.none())}};};var isRtc=function isRtc(editor){return has$2(editor.plugins,'rtc');};var getRtcSetup=function getRtcSetup(editor){return get$9(editor.plugins,'rtc').bind(function(rtcPlugin){return Optional.from(rtcPlugin.setup);});};var setup$i=function setup$i(editor){var editorCast=editor;return getRtcSetup(editor).fold(function(){editorCast.rtcInstance=makePlainAdaptor(editor);return Optional.none();},function(setup){editorCast.rtcInstance=makeNoopAdaptor();return Optional.some(function(){return setup().then(function(rtcEditor){editorCast.rtcInstance=makeRtcAdaptor(rtcEditor);return rtcEditor.rtc.isRemote;});});});};var getRtcInstanceWithFallback=function getRtcInstanceWithFallback(editor){return editor.rtcInstance?editor.rtcInstance:makePlainAdaptor(editor);};var getRtcInstanceWithError=function getRtcInstanceWithError(editor){var rtcInstance=editor.rtcInstance;if(!rtcInstance){throw new Error('Failed to get RTC instance not yet initialized.');}else{return rtcInstance;}};var _beforeChange=function beforeChange(editor,locks,beforeBookmark){getRtcInstanceWithError(editor).undoManager.beforeChange(locks,beforeBookmark);};var addUndoLevel=function addUndoLevel(editor,undoManager,index,locks,beforeBookmark,level,event){return getRtcInstanceWithError(editor).undoManager.add(undoManager,index,locks,beforeBookmark,level,event);};var _undo=function undo(editor,undoManager,locks,index){return getRtcInstanceWithError(editor).undoManager.undo(undoManager,locks,index);};var _redo=function redo(editor,index,data){return getRtcInstanceWithError(editor).undoManager.redo(index,data);};var _clear=function clear(editor,undoManager,index){getRtcInstanceWithError(editor).undoManager.clear(undoManager,index);};var _reset=function reset(editor,undoManager){getRtcInstanceWithError(editor).undoManager.reset(undoManager);};var _hasUndo=function hasUndo(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager,index);};var _hasRedo=function hasRedo(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager,index);};var _transact=function transact(editor,undoManager,locks,callback){return getRtcInstanceWithError(editor).undoManager.transact(undoManager,locks,callback);};var _ignore=function ignore(editor,locks,callback){getRtcInstanceWithError(editor).undoManager.ignore(locks,callback);};var _extra=function extra(editor,undoManager,index,callback1,callback2){getRtcInstanceWithError(editor).undoManager.extra(undoManager,index,callback1,callback2);};var matchFormat=function matchFormat(editor,name,vars,node,similar){return getRtcInstanceWithError(editor).formatter.match(name,vars,node,similar);};var matchAllFormats=function matchAllFormats(editor,names,vars){return getRtcInstanceWithError(editor).formatter.matchAll(names,vars);};var matchNodeFormat=function matchNodeFormat(editor,node,name,vars,similar){return getRtcInstanceWithError(editor).formatter.matchNode(node,name,vars,similar);};var canApplyFormat=function canApplyFormat(editor,name){return getRtcInstanceWithError(editor).formatter.canApply(name);};var closestFormat=function closestFormat(editor,names){return getRtcInstanceWithError(editor).formatter.closest(names);};var applyFormat=function applyFormat(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.apply(name,vars,node);};var removeFormat=function removeFormat(editor,name,vars,node,similar){getRtcInstanceWithError(editor).formatter.remove(name,vars,node,similar);};var toggleFormat=function toggleFormat(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.toggle(name,vars,node);};var _formatChanged=function formatChanged(editor,registeredFormatListeners,formats,callback,similar,vars){return getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners,formats,callback,similar,vars);};var getContent$2=function getContent$2(editor,args,format){return getRtcInstanceWithFallback(editor).editor.getContent(args,format);};var setContent$2=function setContent$2(editor,content,args){return getRtcInstanceWithFallback(editor).editor.setContent(content,args);};var insertContent=function insertContent(editor,value,details){return getRtcInstanceWithFallback(editor).editor.insertContent(value,details);};var getSelectedContent=function getSelectedContent(editor,format,args){return getRtcInstanceWithError(editor).selection.getContent(format,args);};var addVisual$1=function addVisual$1(editor,elm){return getRtcInstanceWithError(editor).editor.addVisual(elm);};var getContent$1=function getContent$1(editor,args){if(args===void 0){args={};}var format=args.format?args.format:'html';return getSelectedContent(editor,format,args);};var removeEmpty=function removeEmpty(text){if(text.dom.length===0){remove$7(text);return Optional.none();}else{return Optional.some(text);}};var walkPastBookmark=function walkPastBookmark(node,start){return node.filter(function(elm){return BookmarkManager.isBookmarkNode(elm.dom);}).bind(start?nextSibling:prevSibling);};var merge=function merge(outer,inner,rng,start){var outerElm=outer.dom;var innerElm=inner.dom;var oldLength=start?outerElm.length:innerElm.length;if(start){mergeTextNodes(outerElm,innerElm,false,!start);rng.setStart(innerElm,oldLength);}else{mergeTextNodes(innerElm,outerElm,false,!start);rng.setEnd(innerElm,oldLength);}};var normalizeTextIfRequired=function normalizeTextIfRequired(inner,start){parent(inner).each(function(root){var text=inner.dom;if(start&&needsToBeNbspLeft(root,_CaretPosition(text,0))){normalizeWhitespaceAfter(text,0);}else if(!start&&needsToBeNbspRight(root,_CaretPosition(text,text.length))){normalizeWhitespaceBefore(text,text.length);}});};var mergeAndNormalizeText=function mergeAndNormalizeText(outerNode,innerNode,rng,start){outerNode.bind(function(outer){var normalizer=start?normalizeWhitespaceBefore:normalizeWhitespaceAfter;normalizer(outer.dom,start?outer.dom.length:0);return innerNode.filter(isText$8).map(function(inner){return merge(outer,inner,rng,start);});}).orThunk(function(){var innerTextNode=walkPastBookmark(innerNode,start).or(innerNode).filter(isText$8);return innerTextNode.map(function(inner){return normalizeTextIfRequired(inner,start);});});};var rngSetContent=function rngSetContent(rng,fragment){var firstChild=Optional.from(fragment.firstChild).map(SugarElement.fromDom);var lastChild=Optional.from(fragment.lastChild).map(SugarElement.fromDom);rng.deleteContents();rng.insertNode(fragment);var prevText=firstChild.bind(prevSibling).filter(isText$8).bind(removeEmpty);var nextText=lastChild.bind(nextSibling).filter(isText$8).bind(removeEmpty);mergeAndNormalizeText(prevText,firstChild,rng,true);mergeAndNormalizeText(nextText,lastChild,rng,false);rng.collapse(false);};var setupArgs=function setupArgs(args,content){return _assign(_assign({format:'html'},args),{set:true,selection:true,content:content});};var cleanContent=function cleanContent(editor,args){if(args.format!=='raw'){var rng=editor.selection.getRng();var contextBlock=editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock);var contextArgs=contextBlock?{context:contextBlock.nodeName.toLowerCase()}:{};var node=editor.parser.parse(args.content,_assign(_assign({isRootContent:true,forced_root_block:false},contextArgs),args));return HtmlSerializer({validate:editor.validate},editor.schema).serialize(node);}else{return args.content;}};var setContent$1=function setContent$1(editor,content,args){if(args===void 0){args={};}var defaultedArgs=setupArgs(args,content);var updatedArgs=defaultedArgs;if(!defaultedArgs.no_events){var eventArgs=editor.fire('BeforeSetContent',defaultedArgs);if(eventArgs.isDefaultPrevented()){editor.fire('SetContent',eventArgs);return;}else{updatedArgs=eventArgs;}}updatedArgs.content=cleanContent(editor,updatedArgs);var rng=editor.selection.getRng();rngSetContent(rng,rng.createContextualFragment(updatedArgs.content));editor.selection.setRng(rng);scrollRangeIntoView(editor,rng);if(!updatedArgs.no_events){editor.fire('SetContent',updatedArgs);}};var deleteFromCallbackMap=function deleteFromCallbackMap(callbackMap,selector,callback){if(callbackMap&&has$2(callbackMap,selector)){var newCallbacks=filter$4(callbackMap[selector],function(cb){return cb!==callback;});if(newCallbacks.length===0){delete callbackMap[selector];}else{callbackMap[selector]=newCallbacks;}}};function SelectorChanged(dom,editor){var selectorChangedData;var currentSelectors;var findMatchingNode=function findMatchingNode(selector,nodes){return find$3(nodes,function(node){return dom.is(node,selector);});};var getParents=function getParents(elem){return dom.getParents(elem,null,dom.getRoot());};return{selectorChangedWithUnbind:function selectorChangedWithUnbind(selector,callback){if(!selectorChangedData){selectorChangedData={};currentSelectors={};editor.on('NodeChange',function(e){var node=e.element;var parents=getParents(node);var matchedSelectors={};Tools.each(selectorChangedData,function(callbacks,selector){findMatchingNode(selector,parents).each(function(node){if(!currentSelectors[selector]){each$k(callbacks,function(callback){callback(true,{node:node,selector:selector,parents:parents});});currentSelectors[selector]=callbacks;}matchedSelectors[selector]=callbacks;});});Tools.each(currentSelectors,function(callbacks,selector){if(!matchedSelectors[selector]){delete currentSelectors[selector];Tools.each(callbacks,function(callback){callback(false,{node:node,selector:selector,parents:parents});});}});});}if(!selectorChangedData[selector]){selectorChangedData[selector]=[];}selectorChangedData[selector].push(callback);findMatchingNode(selector,getParents(editor.selection.getStart())).each(function(){currentSelectors[selector]=selectorChangedData[selector];});return{unbind:function unbind(){deleteFromCallbackMap(selectorChangedData,selector,callback);deleteFromCallbackMap(currentSelectors,selector,callback);}};}};}var isNativeIeSelection=function isNativeIeSelection(rng){return!!rng.select;};var isAttachedToDom=function isAttachedToDom(node){return!!(node&&node.ownerDocument)&&contains$1(SugarElement.fromDom(node.ownerDocument),SugarElement.fromDom(node));};var isValidRange=function isValidRange(rng){if(!rng){return false;}else if(isNativeIeSelection(rng)){return true;}else{return isAttachedToDom(rng.startContainer)&&isAttachedToDom(rng.endContainer);}};var EditorSelection=function EditorSelection(dom,win,serializer,editor){var selectedRange;var explicitRange;var selectorChangedWithUnbind=SelectorChanged(dom,editor).selectorChangedWithUnbind;var setCursorLocation=function setCursorLocation(node,offset){var rng=dom.createRng();if(isNonNullable(node)&&isNonNullable(offset)){rng.setStart(node,offset);rng.setEnd(node,offset);setRng(rng);collapse(false);}else{moveEndPoint(dom,rng,editor.getBody(),true);setRng(rng);}};var getContent=function getContent(args){return getContent$1(editor,args);};var setContent=function setContent(content,args){return setContent$1(editor,content,args);};var getStart$1=function getStart$1(real){return getStart(editor.getBody(),getRng$1(),real);};var getEnd$1=function getEnd$1(real){return getEnd(editor.getBody(),getRng$1(),real);};var getBookmark=function getBookmark(type,normalized){return bookmarkManager.getBookmark(type,normalized);};var moveToBookmark=function moveToBookmark(bookmark){return bookmarkManager.moveToBookmark(bookmark);};var select$1=function select$1(node,content){select(dom,node,content).each(setRng);return node;};var isCollapsed=function isCollapsed(){var rng=getRng$1(),sel=getSel();if(!rng||rng.item){return false;}if(rng.compareEndPoints){return rng.compareEndPoints('StartToEnd',rng)===0;}return!sel||rng.collapsed;};var collapse=function collapse(toStart){var rng=getRng$1();rng.collapse(!!toStart);setRng(rng);};var getSel=function getSel(){return win.getSelection?win.getSelection():win.document.selection;};var getRng$1=function getRng$1(){var selection,rng,elm;var tryCompareBoundaryPoints=function tryCompareBoundaryPoints(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange);}catch(ex){return-1;}};var doc=win.document;if(editor.bookmark!==undefined&&hasFocus(editor)===false){var bookmark=getRng(editor);if(bookmark.isSome()){return bookmark.map(function(r){return processRanges(editor,[r])[0];}).getOr(doc.createRange());}}try{if((selection=getSel())&&!isRestrictedNode(selection.anchorNode)){if(selection.rangeCount>0){rng=selection.getRangeAt(0);}else{rng=selection.createRange?selection.createRange():doc.createRange();}rng=processRanges(editor,[rng])[0];}}catch(ex){}if(!rng){rng=doc.createRange?doc.createRange():doc.body.createTextRange();}if(rng.setStart&&rng.startContainer.nodeType===9&&rng.collapsed){elm=dom.getRoot();rng.setStart(elm,0);rng.setEnd(elm,0);}if(selectedRange&&explicitRange){if(tryCompareBoundaryPoints(rng.START_TO_START,rng,selectedRange)===0&&tryCompareBoundaryPoints(rng.END_TO_END,rng,selectedRange)===0){rng=explicitRange;}else{selectedRange=null;explicitRange=null;}}return rng;};var setRng=function setRng(rng,forward){var node;if(!isValidRange(rng)){return;}var ieRange=isNativeIeSelection(rng)?rng:null;if(ieRange){explicitRange=null;try{ieRange.select();}catch(ex){}return;}var sel=getSel();var evt=editor.fire('SetSelectionRange',{range:rng,forward:forward});rng=evt.range;if(sel){explicitRange=rng;try{sel.removeAllRanges();sel.addRange(rng);}catch(ex){}if(forward===false&&sel.extend){sel.collapse(rng.endContainer,rng.endOffset);sel.extend(rng.startContainer,rng.startOffset);}selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null;}if(!rng.collapsed&&rng.startContainer===rng.endContainer&&sel.setBaseAndExtent&&!Env.ie){if(rng.endOffset-rng.startOffset<2){if(rng.startContainer.hasChildNodes()){node=rng.startContainer.childNodes[rng.startOffset];if(node&&node.tagName==='IMG'){sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset);if(sel.anchorNode!==rng.startContainer||sel.focusNode!==rng.endContainer){sel.setBaseAndExtent(node,0,node,1);}}}}}editor.fire('AfterSetSelectionRange',{range:rng,forward:forward});};var setNode=function setNode(elm){setContent(dom.getOuterHTML(elm));return elm;};var getNode$1=function getNode$1(){return getNode(editor.getBody(),getRng$1());};var getSelectedBlocks$1=function getSelectedBlocks$1(startElm,endElm){return getSelectedBlocks(dom,getRng$1(),startElm,endElm);};var isForward=function isForward(){var sel=getSel();var anchorNode=sel===null||sel===void 0?void 0:sel.anchorNode;var focusNode=sel===null||sel===void 0?void 0:sel.focusNode;if(!sel||!anchorNode||!focusNode||isRestrictedNode(anchorNode)||isRestrictedNode(focusNode)){return true;}var anchorRange=dom.createRng();anchorRange.setStart(anchorNode,sel.anchorOffset);anchorRange.collapse(true);var focusRange=dom.createRng();focusRange.setStart(focusNode,sel.focusOffset);focusRange.collapse(true);return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0;};var normalize=function normalize(){var rng=getRng$1();var sel=getSel();if(!hasMultipleRanges(sel)&&hasAnyRanges(editor)){var normRng=normalize$2(dom,rng);normRng.each(function(normRng){setRng(normRng,isForward());});return normRng.getOr(rng);}return rng;};var selectorChanged=function selectorChanged(selector,callback){selectorChangedWithUnbind(selector,callback);return exports;};var getScrollContainer=function getScrollContainer(){var scrollContainer;var node=dom.getRoot();while(node&&node.nodeName!=='BODY'){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break;}node=node.parentNode;}return scrollContainer;};var scrollIntoView=function scrollIntoView(elm,alignToTop){if(isNonNullable(elm)){scrollElementIntoView(editor,elm,alignToTop);}else{scrollRangeIntoView(editor,getRng$1(),alignToTop);}};var placeCaretAt=function placeCaretAt(clientX,clientY){return setRng(fromPoint(clientX,clientY,editor.getDoc()));};var getBoundingClientRect=function getBoundingClientRect(){var rng=getRng$1();return rng.collapsed?_CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect();};var destroy=function destroy(){win=selectedRange=explicitRange=null;controlSelection.destroy();};var exports={bookmarkManager:null,controlSelection:null,dom:dom,win:win,serializer:serializer,editor:editor,collapse:collapse,setCursorLocation:setCursorLocation,getContent:getContent,setContent:setContent,getBookmark:getBookmark,moveToBookmark:moveToBookmark,select:select$1,isCollapsed:isCollapsed,isForward:isForward,setNode:setNode,getNode:getNode$1,getSel:getSel,setRng:setRng,getRng:getRng$1,getStart:getStart$1,getEnd:getEnd$1,getSelectedBlocks:getSelectedBlocks$1,normalize:normalize,selectorChanged:selectorChanged,selectorChangedWithUnbind:selectorChangedWithUnbind,getScrollContainer:getScrollContainer,scrollIntoView:scrollIntoView,placeCaretAt:placeCaretAt,getBoundingClientRect:getBoundingClientRect,destroy:destroy};var bookmarkManager=BookmarkManager(exports);var controlSelection=ControlSelection(exports,editor);exports.bookmarkManager=bookmarkManager;exports.controlSelection=controlSelection;return exports;};var removeAttrs=function removeAttrs(node,names){each$k(names,function(name){node.attr(name,null);});};var addFontToSpansFilter=function addFontToSpansFilter(domParser,styles,fontSizes){domParser.addNodeFilter('font',function(nodes){each$k(nodes,function(node){var props=styles.parse(node.attr('style'));var color=node.attr('color');var face=node.attr('face');var size=node.attr('size');if(color){props.color=color;}if(face){props['font-family']=face;}if(size){props['font-size']=fontSizes[parseInt(node.attr('size'),10)-1];}node.name='span';node.attr('style',styles.serialize(props));removeAttrs(node,['color','face','size']);});});};var addStrikeToSpanFilter=function addStrikeToSpanFilter(domParser,styles){domParser.addNodeFilter('strike',function(nodes){each$k(nodes,function(node){var props=styles.parse(node.attr('style'));props['text-decoration']='line-through';node.name='span';node.attr('style',styles.serialize(props));});});};var addFilters=function addFilters(domParser,settings){var styles=Styles();if(settings.convert_fonts_to_spans){addFontToSpansFilter(domParser,styles,Tools.explode(settings.font_size_legacy_values));}addStrikeToSpanFilter(domParser,styles);};var register$2=function register$2(domParser,settings){if(settings.inline_styles){addFilters(domParser,settings);}};var blobUriToBlob=function blobUriToBlob(url){return new promiseObj(function(resolve,reject){var rejectWithError=function rejectWithError(){reject('Cannot convert '+url+' to Blob. Resource might not exist or is inaccessible.');};try{var xhr_1=new XMLHttpRequest();xhr_1.open('GET',url,true);xhr_1.responseType='blob';xhr_1.onload=function(){if(xhr_1.status===200){resolve(xhr_1.response);}else{rejectWithError();}};xhr_1.onerror=rejectWithError;xhr_1.send();}catch(ex){rejectWithError();}});};var parseDataUri$1=function parseDataUri$1(uri){var type;var uriParts=decodeURIComponent(uri).split(',');var matches=/data:([^;]+)/.exec(uriParts[0]);if(matches){type=matches[1];}return{type:type,data:uriParts[1]};};var buildBlob=function buildBlob(type,data){var str;try{str=atob(data);}catch(e){return Optional.none();}var arr=new Uint8Array(str.length);for(var i=0;i<arr.length;i++){arr[i]=str.charCodeAt(i);}return Optional.some(new Blob([arr],{type:type}));};var dataUriToBlob=function dataUriToBlob(uri){return new promiseObj(function(resolve){var _a=parseDataUri$1(uri),type=_a.type,data=_a.data;buildBlob(type,data).fold(function(){return resolve(new Blob([]));},resolve);});};var uriToBlob=function uriToBlob(url){if(url.indexOf('blob:')===0){return blobUriToBlob(url);}if(url.indexOf('data:')===0){return dataUriToBlob(url);}return null;};var blobToDataUri=function blobToDataUri(blob){return new promiseObj(function(resolve){var reader=new FileReader();reader.onloadend=function(){resolve(reader.result);};reader.readAsDataURL(blob);});};var count$1=0;var uniqueId=function uniqueId(prefix){return(prefix||'blobid')+count$1++;};var imageToBlobInfo=function imageToBlobInfo(blobCache,img,resolve,reject){var base64,blobInfo;if(img.src.indexOf('blob:')===0){blobInfo=blobCache.getByUri(img.src);if(blobInfo){resolve({image:img,blobInfo:blobInfo});}else{uriToBlob(img.src).then(function(blob){blobToDataUri(blob).then(function(dataUri){base64=parseDataUri$1(dataUri).data;blobInfo=blobCache.create(uniqueId(),blob,base64);blobCache.add(blobInfo);resolve({image:img,blobInfo:blobInfo});});},function(err){reject(err);});}return;}var _a=parseDataUri$1(img.src),data=_a.data,type=_a.type;base64=data;blobInfo=blobCache.getByData(base64,type);if(blobInfo){resolve({image:img,blobInfo:blobInfo});}else{uriToBlob(img.src).then(function(blob){blobInfo=blobCache.create(uniqueId(),blob,base64);blobCache.add(blobInfo);resolve({image:img,blobInfo:blobInfo});},function(err){reject(err);});}};var getAllImages=function getAllImages(elm){return elm?from(elm.getElementsByTagName('img')):[];};var ImageScanner=function ImageScanner(uploadStatus,blobCache){var cachedPromises={};var findAll=function findAll(elm,predicate){if(!predicate){predicate=always;}var images=filter$4(getAllImages(elm),function(img){var src=img.src;if(!Env.fileApi){return false;}if(img.hasAttribute('data-mce-bogus')){return false;}if(img.hasAttribute('data-mce-placeholder')){return false;}if(!src||src===Env.transparentSrc){return false;}if(src.indexOf('blob:')===0){return!uploadStatus.isUploaded(src)&&predicate(img);}if(src.indexOf('data:')===0){return predicate(img);}return false;});var promises=map$3(images,function(img){if(cachedPromises[img.src]!==undefined){return new promiseObj(function(resolve){cachedPromises[img.src].then(function(imageInfo){if(typeof imageInfo==='string'){return imageInfo;}resolve({image:img,blobInfo:imageInfo.blobInfo});});});}var newPromise=new promiseObj(function(resolve,reject){imageToBlobInfo(blobCache,img,resolve,reject);}).then(function(result){delete cachedPromises[result.image.src];return result;}).catch(function(error){delete cachedPromises[img.src];return error;});cachedPromises[img.src]=newPromise;return newPromise;});return promiseObj.all(promises);};return{findAll:findAll};};var extractBase64DataUris=function extractBase64DataUris(html){var dataImageUri=/data:[^;<\"'\\s]+;base64,([a-z0-9\\+\\/=\\s]+)/gi;var chunks=[];var uris={};var prefix=generate('img');var matches;var index=0;var count=0;while(matches=dataImageUri.exec(html)){var uri=matches[0];var imageId=prefix+'_'+count++;uris[imageId]=uri;if(index<matches.index){chunks.push(html.substr(index,matches.index-index));}chunks.push(imageId);index=matches.index+uri.length;}var re=new RegExp(prefix+'_[0-9]+','g');if(index===0){return{prefix:prefix,uris:uris,html:html,re:re};}else{if(index<html.length){chunks.push(html.substr(index));}return{prefix:prefix,uris:uris,html:chunks.join(''),re:re};}};var restoreDataUris=function restoreDataUris(html,result){return html.replace(result.re,function(imageId){return get$9(result.uris,imageId).getOr(imageId);});};var parseDataUri=function parseDataUri(uri){var matches=/data:([^;]+);base64,([a-z0-9\\+\\/=\\s]+)/i.exec(uri);if(matches){return Optional.some({type:matches[1],data:decodeURIComponent(matches[2])});}else{return Optional.none();}};var paddEmptyNode=function paddEmptyNode(settings,args,blockElements,node){var brPreferred=settings.padd_empty_with_br||args.insert;if(brPreferred&&blockElements[node.name]){node.empty().append(new AstNode('br',1)).shortEnded=true;}else{node.empty().append(new AstNode('#text',3)).value=nbsp;}};var isPaddedWithNbsp=function isPaddedWithNbsp(node){return hasOnlyChild(node,'#text')&&node.firstChild.value===nbsp;};var hasOnlyChild=function hasOnlyChild(node,name){return node&&node.firstChild&&node.firstChild===node.lastChild&&node.firstChild.name===name;};var isPadded=function isPadded(schema,node){var rule=schema.getElementRule(node.name);return rule&&rule.paddEmpty;};var isEmpty=function isEmpty(schema,nonEmptyElements,whitespaceElements,node){return node.isEmpty(nonEmptyElements,whitespaceElements,function(node){return isPadded(schema,node);});};var isLineBreakNode=function isLineBreakNode(node,blockElements){return node&&(has$2(blockElements,node.name)||node.name==='br');};var isBogusImage=function isBogusImage(img){return isNonNullable(img.attr('data-mce-bogus'));};var isInternalImageSource=function isInternalImageSource(img){return img.attr('src')===Env.transparentSrc||isNonNullable(img.attr('data-mce-placeholder'));};var isValidDataImg=function isValidDataImg(img,settings){if(settings.images_dataimg_filter){var imgElem_1=new Image();imgElem_1.src=img.attr('src');each$j(img.attributes.map,function(value,key){imgElem_1.setAttribute(key,value);});return settings.images_dataimg_filter(imgElem_1);}else{return true;}};var registerBase64ImageFilter=function registerBase64ImageFilter(parser,settings){var blobCache=settings.blob_cache;var processImage=function processImage(img){var inputSrc=img.attr('src');if(isInternalImageSource(img)||isBogusImage(img)){return;}parseDataUri(inputSrc).filter(function(){return isValidDataImg(img,settings);}).bind(function(_a){var type=_a.type,data=_a.data;return Optional.from(blobCache.getByData(data,type)).orThunk(function(){return buildBlob(type,data).map(function(blob){var blobInfo=blobCache.create(uniqueId(),blob,data);blobCache.add(blobInfo);return blobInfo;});});}).each(function(blobInfo){img.attr('src',blobInfo.blobUri());});};if(blobCache){parser.addAttributeFilter('src',function(nodes){return each$k(nodes,processImage);});}};var register$1=function register$1(parser,settings){var schema=parser.schema;if(settings.remove_trailing_brs){parser.addNodeFilter('br',function(nodes,_,args){var i;var l=nodes.length;var node;var blockElements=Tools.extend({},schema.getBlockElements());var nonEmptyElements=schema.getNonEmptyElements();var parent,lastParent,prev,prevName;var whiteSpaceElements=schema.getWhiteSpaceElements();var elementRule,textNode;blockElements.body=1;for(i=0;i<l;i++){node=nodes[i];parent=node.parent;if(blockElements[node.parent.name]&&node===parent.lastChild){prev=node.prev;while(prev){prevName=prev.name;if(prevName!=='span'||prev.attr('data-mce-type')!=='bookmark'){if(prevName==='br'){node=null;}break;}prev=prev.prev;}if(node){node.remove();if(isEmpty(schema,nonEmptyElements,whiteSpaceElements,parent)){elementRule=schema.getElementRule(parent.name);if(elementRule){if(elementRule.removeEmpty){parent.remove();}else if(elementRule.paddEmpty){paddEmptyNode(settings,args,blockElements,parent);}}}}}else{lastParent=node;while(parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent){lastParent=parent;if(blockElements[parent.name]){break;}parent=parent.parent;}if(lastParent===parent&&settings.padd_empty_with_br!==true){textNode=new AstNode('#text',3);textNode.value=nbsp;node.replace(textNode);}}}});}parser.addAttributeFilter('href',function(nodes){var i=nodes.length;var appendRel=function appendRel(rel){var parts=rel.split(' ').filter(function(p){return p.length>0;});return parts.concat(['noopener']).sort().join(' ');};var addNoOpener=function addNoOpener(rel){var newRel=rel?Tools.trim(rel):'';if(!/\\b(noopener)\\b/g.test(newRel)){return appendRel(newRel);}else{return newRel;}};if(!settings.allow_unsafe_link_target){while(i--){var node=nodes[i];if(node.name==='a'&&node.attr('target')==='_blank'){node.attr('rel',addNoOpener(node.attr('rel')));}}}});if(!settings.allow_html_in_named_anchor){parser.addAttributeFilter('id,name',function(nodes){var i=nodes.length,sibling,prevSibling,parent,node;while(i--){node=nodes[i];if(node.name==='a'&&node.firstChild&&!node.attr('href')){parent=node.parent;sibling=node.lastChild;do{prevSibling=sibling.prev;parent.insert(sibling,node);sibling=prevSibling;}while(sibling);}}});}if(settings.fix_list_elements){parser.addNodeFilter('ul,ol',function(nodes){var i=nodes.length,node,parentNode;while(i--){node=nodes[i];parentNode=node.parent;if(parentNode.name==='ul'||parentNode.name==='ol'){if(node.prev&&node.prev.name==='li'){node.prev.append(node);}else{var li=new AstNode('li',1);li.attr('style','list-style-type: none');node.wrap(li);}}}});}if(settings.validate&&schema.getValidClasses()){parser.addAttributeFilter('class',function(nodes){var validClasses=schema.getValidClasses();var i=nodes.length;while(i--){var node=nodes[i];var classList=node.attr('class').split(' ');var classValue='';for(var ci=0;ci<classList.length;ci++){var className=classList[ci];var valid=false;var validClassesMap=validClasses['*'];if(validClassesMap&&validClassesMap[className]){valid=true;}validClassesMap=validClasses[node.name];if(!valid&&validClassesMap&&validClassesMap[className]){valid=true;}if(valid){if(classValue){classValue+=' ';}classValue+=className;}}if(!classValue.length){classValue=null;}node.attr('class',classValue);}});}registerBase64ImageFilter(parser,settings);};var each$7=Tools.each,trim=Tools.trim;var queryParts='source protocol authority userInfo user password host port relative path directory file query anchor'.split(' ');var DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25};var safeSvgDataUrlElements=['img','video'];var blockSvgDataUris=function blockSvgDataUris(allowSvgDataUrls,tagName){if(isNonNullable(allowSvgDataUrls)){return!allowSvgDataUrls;}else{return isNonNullable(tagName)?!contains$3(safeSvgDataUrlElements,tagName):true;}};var isInvalidUri=function isInvalidUri(settings,uri,tagName){if(settings.allow_html_data_urls){return false;}else if(/^data:image\\//i.test(uri)){return blockSvgDataUris(settings.allow_svg_data_urls,tagName)&&/^data:image\\/svg\\+xml/i.test(uri);}else{return /^data:/i.test(uri);}};var URI=function(){function URI(url,settings){url=trim(url);this.settings=settings||{};var baseUri=this.settings.base_uri;var self=this;if(/^([\\w\\-]+):([^\\/]{2})/i.test(url)||/^\\s*#/.test(url)){self.source=url;return;}var isProtocolRelative=url.indexOf('//')===0;if(url.indexOf('/')===0&&!isProtocolRelative){url=(baseUri?baseUri.protocol||'http':'http')+'://mce_host'+url;}if(!/^[\\w\\-]*:?\\/\\//.test(url)){var baseUrl=this.settings.base_uri?this.settings.base_uri.path:new URI(document.location.href).directory;if(this.settings.base_uri&&this.settings.base_uri.protocol==''){url='//mce_host'+self.toAbsPath(baseUrl,url);}else{var match=/([^#?]*)([#?]?.*)/.exec(url);url=(baseUri&&baseUri.protocol||'http')+'://mce_host'+self.toAbsPath(baseUrl,match[1])+match[2];}}url=url.replace(/@@/g,'(mce_at)');var urlMatch=/^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?(\\[[a-zA-Z0-9:.%]+\\]|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);each$7(queryParts,function(v,i){var part=urlMatch[i];if(part){part=part.replace(/\\(mce_at\\)/g,'@@');}self[v]=part;});if(baseUri){if(!self.protocol){self.protocol=baseUri.protocol;}if(!self.userInfo){self.userInfo=baseUri.userInfo;}if(!self.port&&self.host==='mce_host'){self.port=baseUri.port;}if(!self.host||self.host==='mce_host'){self.host=baseUri.host;}self.source='';}if(isProtocolRelative){self.protocol='';}}URI.parseDataUri=function(uri){var type;var uriComponents=decodeURIComponent(uri).split(',');var matches=/data:([^;]+)/.exec(uriComponents[0]);if(matches){type=matches[1];}return{type:type,data:uriComponents[1]};};URI.isDomSafe=function(uri,context,options){if(options===void 0){options={};}if(options.allow_script_urls){return true;}else{var decodedUri=Entities.decode(uri).replace(/[\\s\\u0000-\\u001F]+/g,'');try{decodedUri=decodeURIComponent(decodedUri);}catch(ex){decodedUri=unescape(decodedUri);}if(/((java|vb)script|mhtml):/i.test(decodedUri)){return false;}return!isInvalidUri(options,decodedUri,context);}};URI.getDocumentBaseUrl=function(loc){var baseUrl;if(loc.protocol.indexOf('http')!==0&&loc.protocol!=='file:'){baseUrl=loc.href;}else{baseUrl=loc.protocol+'//'+loc.host+loc.pathname;}if(/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)){baseUrl=baseUrl.replace(/[\\?#].*$/,'').replace(/[\\/\\\\][^\\/]+$/,'');if(!/[\\/\\\\]$/.test(baseUrl)){baseUrl+='/';}}return baseUrl;};URI.prototype.setPath=function(path){var pathMatch=/^(.*?)\\/?(\\w+)?$/.exec(path);this.path=pathMatch[0];this.directory=pathMatch[1];this.file=pathMatch[2];this.source='';this.getURI();};URI.prototype.toRelative=function(uri){var output;if(uri==='./'){return uri;}var relativeUri=new URI(uri,{base_uri:this});if(relativeUri.host!=='mce_host'&&this.host!==relativeUri.host&&relativeUri.host||this.port!==relativeUri.port||this.protocol!==relativeUri.protocol&&relativeUri.protocol!==''){return relativeUri.getURI();}var tu=this.getURI(),uu=relativeUri.getURI();if(tu===uu||tu.charAt(tu.length-1)==='/'&&tu.substr(0,tu.length-1)===uu){return tu;}output=this.toRelPath(this.path,relativeUri.path);if(relativeUri.query){output+='?'+relativeUri.query;}if(relativeUri.anchor){output+='#'+relativeUri.anchor;}return output;};URI.prototype.toAbsolute=function(uri,noHost){var absoluteUri=new URI(uri,{base_uri:this});return absoluteUri.getURI(noHost&&this.isSameOrigin(absoluteUri));};URI.prototype.isSameOrigin=function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port){return true;}var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort)){return true;}}return false;};URI.prototype.toRelPath=function(base,path){var breakPoint=0,out='',i,l;var normalizedBase=base.substring(0,base.lastIndexOf('/')).split('/');var items=path.split('/');if(normalizedBase.length>=items.length){for(i=0,l=normalizedBase.length;i<l;i++){if(i>=items.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break;}}}if(normalizedBase.length<items.length){for(i=0,l=items.length;i<l;i++){if(i>=normalizedBase.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break;}}}if(breakPoint===1){return path;}for(i=0,l=normalizedBase.length-(breakPoint-1);i<l;i++){out+='../';}for(i=breakPoint-1,l=items.length;i<l;i++){if(i!==breakPoint-1){out+='/'+items[i];}else{out+=items[i];}}return out;};URI.prototype.toAbsPath=function(base,path){var i,nb=0,o=[],outPath;var tr=/\\/$/.test(path)?'/':'';var normalizedBase=base.split('/');var normalizedPath=path.split('/');each$7(normalizedBase,function(k){if(k){o.push(k);}});normalizedBase=o;for(i=normalizedPath.length-1,o=[];i>=0;i--){if(normalizedPath[i].length===0||normalizedPath[i]==='.'){continue;}if(normalizedPath[i]==='..'){nb++;continue;}if(nb>0){nb--;continue;}o.push(normalizedPath[i]);}i=normalizedBase.length-nb;if(i<=0){outPath=reverse(o).join('/');}else{outPath=normalizedBase.slice(0,i).join('/')+'/'+reverse(o).join('/');}if(outPath.indexOf('/')!==0){outPath='/'+outPath;}if(tr&&outPath.lastIndexOf('/')!==outPath.length-1){outPath+=tr;}return outPath;};URI.prototype.getURI=function(noProtoHost){if(noProtoHost===void 0){noProtoHost=false;}var s;if(!this.source||noProtoHost){s='';if(!noProtoHost){if(this.protocol){s+=this.protocol+'://';}else{s+='//';}if(this.userInfo){s+=this.userInfo+'@';}if(this.host){s+=this.host;}if(this.port){s+=':'+this.port;}}if(this.path){s+=this.path;}if(this.query){s+='?'+this.query;}if(this.anchor){s+='#'+this.anchor;}this.source=s;}return this.source;};return URI;}();var filteredClobberElements=Tools.makeMap('button,fieldset,form,iframe,img,image,input,object,output,select,textarea');var isValidPrefixAttrName=function isValidPrefixAttrName(name){return name.indexOf('data-')===0||name.indexOf('aria-')===0;};var lazyTempDocument=cached(function(){return document.implementation.createHTMLDocument('parser');});var findMatchingEndTagIndex=function findMatchingEndTagIndex(schema,html,startIndex){var startTagRegExp=/<([!?\\/])?([A-Za-z0-9\\-_:.]+)/g;var endTagRegExp=/(?:\\s(?:[^'\">]+(?:\"[^\"]*\"|'[^']*'))*[^\"'>]*(?:\"[^\">]*|'[^'>]*)?|\\s*|\\/)>/g;var shortEndedElements=schema.getShortEndedElements();var count=1,index=startIndex;while(count!==0){startTagRegExp.lastIndex=index;while(true){var startMatch=startTagRegExp.exec(html);if(startMatch===null){return index;}else if(startMatch[1]==='!'){if(startsWith(startMatch[2],'--')){index=findCommentEndIndex(html,false,startMatch.index+'!--'.length);}else{index=findCommentEndIndex(html,true,startMatch.index+1);}break;}else{endTagRegExp.lastIndex=startTagRegExp.lastIndex;var endMatch=endTagRegExp.exec(html);if(isNull(endMatch)||endMatch.index!==startTagRegExp.lastIndex){continue;}if(startMatch[1]==='/'){count-=1;}else if(!has$2(shortEndedElements,startMatch[2])){count+=1;}index=startTagRegExp.lastIndex+endMatch[0].length;break;}}}return index;};var isConditionalComment=function isConditionalComment(html,startIndex){return /^\\s*\\[if [\\w\\W]+\\]>.*<!\\[endif\\](--!?)?>/.test(html.substr(startIndex));};var findCommentEndIndex=function findCommentEndIndex(html,isBogus,startIndex){if(startIndex===void 0){startIndex=0;}var lcHtml=html.toLowerCase();if(lcHtml.indexOf('[if ',startIndex)!==-1&&isConditionalComment(lcHtml,startIndex)){var endIfIndex=lcHtml.indexOf('[endif]',startIndex);return lcHtml.indexOf('>',endIfIndex);}else{if(isBogus){var endIndex=lcHtml.indexOf('>',startIndex);return endIndex!==-1?endIndex:lcHtml.length;}else{var endCommentRegexp=/--!?>/g;endCommentRegexp.lastIndex=startIndex;var match=endCommentRegexp.exec(html);return match?match.index+match[0].length:lcHtml.length;}}};var checkBogusAttribute=function checkBogusAttribute(regExp,attrString){var matches=regExp.exec(attrString);if(matches){var name_1=matches[1];var value=matches[2];return typeof name_1==='string'&&name_1.toLowerCase()==='data-mce-bogus'?value:null;}else{return null;}};var SaxParser=function SaxParser(settings,schema){if(schema===void 0){schema=Schema();}settings=settings||{};var doc=lazyTempDocument();var form=doc.createElement('form');if(settings.fix_self_closing!==false){settings.fix_self_closing=true;}var comment=settings.comment?settings.comment:noop;var cdata=settings.cdata?settings.cdata:noop;var text=settings.text?settings.text:noop;var start=settings.start?settings.start:noop;var end=settings.end?settings.end:noop;var pi=settings.pi?settings.pi:noop;var doctype=settings.doctype?settings.doctype:noop;var parseInternal=function parseInternal(base64Extract,format){if(format===void 0){format='html';}var html=base64Extract.html;var matches,index=0,value,endRegExp;var stack=[];var attrList,i,textData,name;var isInternalElement,isShortEnded;var elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns;var attributesRequired,attributesDefault,attributesForced;var anyAttributesRequired,attrValue,idCount=0;var decode=Entities.decode;var filteredUrlAttrs=Tools.makeMap('src,href,data,background,action,formaction,poster,xlink:href');var parsingMode=format==='html'?0:1;var processEndTag=function processEndTag(name){var pos,i;pos=stack.length;while(pos--){if(stack[pos].name===name){break;}}if(pos>=0){for(i=stack.length-1;i>=pos;i--){name=stack[i];if(name.valid){end(name.name);}}stack.length=pos;}};var processText=function processText(value,raw){return text(restoreDataUris(value,base64Extract),raw);};var processComment=function processComment(value){if(value===''){return;}if(value.charAt(0)==='>'){value=' '+value;}if(!settings.allow_conditional_comments&&value.substr(0,3).toLowerCase()==='[if'){value=' '+value;}comment(restoreDataUris(value,base64Extract));};var processAttr=function processAttr(value){return restoreDataUris(value,base64Extract);};var processMalformedComment=function processMalformedComment(value,startIndex){var startTag=value||'';var isBogus=!startsWith(startTag,'--');var endIndex=findCommentEndIndex(html,isBogus,startIndex);value=html.substr(startIndex,endIndex-startIndex);processComment(isBogus?startTag+value:value);return endIndex+1;};var parseAttribute=function parseAttribute(tagName,name,value,val2,val3){name=name.toLowerCase();value=processAttr(name in fillAttrsMap?name:decode(value||val2||val3||''));if(validate&&!isInternalElement&&isValidPrefixAttrName(name)===false){var attrRule=validAttributesMap[name];if(!attrRule&&validAttributePatterns){var i_1=validAttributePatterns.length;while(i_1--){attrRule=validAttributePatterns[i_1];if(attrRule.pattern.test(name)){break;}}if(i_1===-1){attrRule=null;}}if(!attrRule){return;}if(attrRule.validValues&&!(value in attrRule.validValues)){return;}}var isNameOrId=name==='name'||name==='id';if(isNameOrId&&tagName in filteredClobberElements&&(value in doc||value in form)){return;}if(filteredUrlAttrs[name]&&!URI.isDomSafe(value,tagName,settings)){return;}if(isInternalElement&&(name in filteredUrlAttrs||name.indexOf('on')===0)){return;}attrList.map[name]=value;attrList.push({name:name,value:value});};var tokenRegExp=new RegExp('<(?:'+'(?:!--([\\\\w\\\\W]*?)--!?>)|'+'(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|'+'(?:![Dd][Oo][Cc][Tt][Yy][Pp][Ee]([\\\\w\\\\W]*?)>)|'+'(?:!(--)?)|'+'(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|'+'(?:\\\\/([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)>)|'+'(?:([A-Za-z][A-Za-z0-9\\\\-_:.]*)(\\\\s(?:[^\\'\">]+(?:\"[^\"]*\"|\\'[^\\']*\\'))*[^\"\\'>]*(?:\"[^\">]*|\\'[^\\'>]*)?|\\\\s*|\\\\/)>)'+')','g');var attrRegExp=/([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;var shortEndedElements=schema.getShortEndedElements();var selfClosing=settings.self_closing_elements||schema.getSelfClosingElements();var fillAttrsMap=schema.getBoolAttrs();var validate=settings.validate;var removeInternalElements=settings.remove_internals;var fixSelfClosing=settings.fix_self_closing;var specialElements=schema.getSpecialElements();var processHtml=html+'>';while(matches=tokenRegExp.exec(processHtml)){var matchText=matches[0];if(index<matches.index){processText(decode(html.substr(index,matches.index-index)));}if(value=matches[7]){value=value.toLowerCase();if(value.charAt(0)===':'){value=value.substr(1);}processEndTag(value);}else if(value=matches[8]){if(matches.index+matchText.length>html.length){processText(decode(html.substr(matches.index)));index=matches.index+matchText.length;continue;}value=value.toLowerCase();if(value.charAt(0)===':'){value=value.substr(1);}isShortEnded=value in shortEndedElements;if(fixSelfClosing&&selfClosing[value]&&stack.length>0&&stack[stack.length-1].name===value){processEndTag(value);}var bogusValue=checkBogusAttribute(attrRegExp,matches[9]);if(bogusValue!==null){if(bogusValue==='all'){index=findMatchingEndTagIndex(schema,html,tokenRegExp.lastIndex);tokenRegExp.lastIndex=index;continue;}isValidElement=false;}if(!validate||(elementRule=schema.getElementRule(value))){isValidElement=true;if(validate){validAttributesMap=elementRule.attributes;validAttributePatterns=elementRule.attributePatterns;}if(attribsValue=matches[9]){isInternalElement=attribsValue.indexOf('data-mce-type')!==-1;if(isInternalElement&&removeInternalElements){isValidElement=false;}attrList=[];attrList.map={};attribsValue.replace(attrRegExp,function(match,name,val,val2,val3){parseAttribute(value,name,val,val2,val3);return'';});}else{attrList=[];attrList.map={};}if(validate&&!isInternalElement){attributesRequired=elementRule.attributesRequired;attributesDefault=elementRule.attributesDefault;attributesForced=elementRule.attributesForced;anyAttributesRequired=elementRule.removeEmptyAttrs;if(anyAttributesRequired&&!attrList.length){isValidElement=false;}if(attributesForced){i=attributesForced.length;while(i--){attr=attributesForced[i];name=attr.name;attrValue=attr.value;if(attrValue==='{$uid}'){attrValue='mce_'+idCount++;}attrList.map[name]=attrValue;attrList.push({name:name,value:attrValue});}}if(attributesDefault){i=attributesDefault.length;while(i--){attr=attributesDefault[i];name=attr.name;if(!(name in attrList.map)){attrValue=attr.value;if(attrValue==='{$uid}'){attrValue='mce_'+idCount++;}attrList.map[name]=attrValue;attrList.push({name:name,value:attrValue});}}}if(attributesRequired){i=attributesRequired.length;while(i--){if(attributesRequired[i]in attrList.map){break;}}if(i===-1){isValidElement=false;}}if(attr=attrList.map['data-mce-bogus']){if(attr==='all'){index=findMatchingEndTagIndex(schema,html,tokenRegExp.lastIndex);tokenRegExp.lastIndex=index;continue;}isValidElement=false;}}if(isValidElement){start(value,attrList,isShortEnded);}}else{isValidElement=false;}if(endRegExp=specialElements[value]){endRegExp.lastIndex=index=matches.index+matchText.length;if(matches=endRegExp.exec(html)){if(isValidElement){textData=html.substr(index,matches.index-index);}index=matches.index+matches[0].length;}else{textData=html.substr(index);index=html.length;}if(isValidElement){if(textData.length>0){processText(textData,true);}end(value);}tokenRegExp.lastIndex=index;continue;}if(!isShortEnded){if(!attribsValue||attribsValue.indexOf('/')!==attribsValue.length-1){stack.push({name:value,valid:isValidElement});}else if(isValidElement){end(value);}}}else if(value=matches[1]){processComment(value);}else if(value=matches[2]){var isValidCdataSection=parsingMode===1||settings.preserve_cdata||stack.length>0&&schema.isValidChild(stack[stack.length-1].name,'#cdata');if(isValidCdataSection){cdata(value);}else{index=processMalformedComment('',matches.index+2);tokenRegExp.lastIndex=index;continue;}}else if(value=matches[3]){doctype(value);}else if((value=matches[4])||matchText==='<!'){index=processMalformedComment(value,matches.index+matchText.length);tokenRegExp.lastIndex=index;continue;}else if(value=matches[5]){if(parsingMode===1){pi(value,matches[6]);}else{index=processMalformedComment('?',matches.index+2);tokenRegExp.lastIndex=index;continue;}}index=matches.index+matchText.length;}if(index<html.length){processText(decode(html.substr(index)));}for(i=stack.length-1;i>=0;i--){value=stack[i];if(value.valid){end(value.name);}}};var parse=function parse(html,format){if(format===void 0){format='html';}parseInternal(extractBase64DataUris(html),format);};return{parse:parse};};SaxParser.findEndTag=findMatchingEndTagIndex;var makeMap=Tools.makeMap,each$6=Tools.each,explode$2=Tools.explode,extend$4=Tools.extend;var DomParser=function DomParser(settings,schema){if(schema===void 0){schema=Schema();}var nodeFilters={};var attributeFilters=[];var matchedNodes={};var matchedAttributes={};settings=settings||{};settings.validate='validate'in settings?settings.validate:true;settings.root_name=settings.root_name||'body';var fixInvalidChildren=function fixInvalidChildren(nodes){var nonSplitableElements=makeMap('tr,td,th,tbody,thead,tfoot,table');var nonEmptyElements=schema.getNonEmptyElements();var whitespaceElements=schema.getWhiteSpaceElements();var textBlockElements=schema.getTextBlockElements();var specialElements=schema.getSpecialElements();var _removeOrUnwrapInvalidNode=function removeOrUnwrapInvalidNode(node,originalNodeParent){if(originalNodeParent===void 0){originalNodeParent=node.parent;}if(specialElements[node.name]){node.empty().remove();}else{var children=node.children();for(var _i=0,children_1=children;_i<children_1.length;_i++){var childNode=children_1[_i];if(!schema.isValidChild(originalNodeParent.name,childNode.name)){_removeOrUnwrapInvalidNode(childNode,originalNodeParent);}}node.unwrap();}};for(var ni=0;ni<nodes.length;ni++){var node=nodes[ni];var parent_1=void 0,newParent=void 0,tempNode=void 0;if(!node.parent||node.fixed){continue;}if(textBlockElements[node.name]&&node.parent.name==='li'){var sibling=node.next;while(sibling){if(textBlockElements[sibling.name]){sibling.name='li';sibling.fixed=true;node.parent.insert(sibling,node.parent);}else{break;}sibling=sibling.next;}node.unwrap();continue;}var parents=[node];for(parent_1=node.parent;parent_1&&!schema.isValidChild(parent_1.name,node.name)&&!nonSplitableElements[parent_1.name];parent_1=parent_1.parent){parents.push(parent_1);}if(parent_1&&parents.length>1){if(schema.isValidChild(parent_1.name,node.name)){parents.reverse();newParent=filterNode(parents[0].clone());var currentNode=newParent;for(var i=0;i<parents.length-1;i++){if(schema.isValidChild(currentNode.name,parents[i].name)){tempNode=filterNode(parents[i].clone());currentNode.append(tempNode);}else{tempNode=currentNode;}for(var childNode=parents[i].firstChild;childNode&&childNode!==parents[i+1];){var nextNode=childNode.next;tempNode.append(childNode);childNode=nextNode;}currentNode=tempNode;}if(!isEmpty(schema,nonEmptyElements,whitespaceElements,newParent)){parent_1.insert(newParent,parents[0],true);parent_1.insert(node,newParent);}else{parent_1.insert(node,parents[0],true);}parent_1=parents[0];if(isEmpty(schema,nonEmptyElements,whitespaceElements,parent_1)||hasOnlyChild(parent_1,'br')){parent_1.empty().remove();}}else{_removeOrUnwrapInvalidNode(node);}}else if(node.parent){if(node.name==='li'){var sibling=node.prev;if(sibling&&(sibling.name==='ul'||sibling.name==='ol')){sibling.append(node);continue;}sibling=node.next;if(sibling&&(sibling.name==='ul'||sibling.name==='ol')){sibling.insert(node,sibling.firstChild,true);continue;}node.wrap(filterNode(new AstNode('ul',1)));continue;}if(schema.isValidChild(node.parent.name,'div')&&schema.isValidChild('div',node.name)){node.wrap(filterNode(new AstNode('div',1)));}else{_removeOrUnwrapInvalidNode(node);}}}};var filterNode=function filterNode(node){var name=node.name;if(name in nodeFilters){var list=matchedNodes[name];if(list){list.push(node);}else{matchedNodes[name]=[node];}}var i=attributeFilters.length;while(i--){var attrName=attributeFilters[i].name;if(attrName in node.attributes.map){var list=matchedAttributes[attrName];if(list){list.push(node);}else{matchedAttributes[attrName]=[node];}}}return node;};var addNodeFilter=function addNodeFilter(name,callback){each$6(explode$2(name),function(name){var list=nodeFilters[name];if(!list){nodeFilters[name]=list=[];}list.push(callback);});};var getNodeFilters=function getNodeFilters(){var out=[];for(var name_1 in nodeFilters){if(has$2(nodeFilters,name_1)){out.push({name:name_1,callbacks:nodeFilters[name_1]});}}return out;};var addAttributeFilter=function addAttributeFilter(name,callback){each$6(explode$2(name),function(name){var i;for(i=0;i<attributeFilters.length;i++){if(attributeFilters[i].name===name){attributeFilters[i].callbacks.push(callback);return;}}attributeFilters.push({name:name,callbacks:[callback]});});};var getAttributeFilters=function getAttributeFilters(){return[].concat(attributeFilters);};var parse=function parse(html,args){var nodes,i,l,fi,fl,list,name;var invalidChildren=[];var node;var getRootBlockName=function getRootBlockName(name){if(name===false){return'';}else if(name===true){return'p';}else{return name;}};args=args||{};matchedNodes={};matchedAttributes={};var blockElements=extend$4(makeMap('script,style,head,html,body,title,meta,param'),schema.getBlockElements());var textRootBlockElements=getTextRootBlockElements(schema);var nonEmptyElements=schema.getNonEmptyElements();var children=schema.children;var validate=settings.validate;var forcedRootBlockName='forced_root_block'in args?args.forced_root_block:settings.forced_root_block;var rootBlockName=getRootBlockName(forcedRootBlockName);var whiteSpaceElements=schema.getWhiteSpaceElements();var startWhiteSpaceRegExp=/^[ \\t\\r\\n]+/;var endWhiteSpaceRegExp=/[ \\t\\r\\n]+$/;var allWhiteSpaceRegExp=/[ \\t\\r\\n]+/g;var isAllWhiteSpaceRegExp=/^[ \\t\\r\\n]+$/;var isInWhiteSpacePreservedElement=has$2(whiteSpaceElements,args.context)||has$2(whiteSpaceElements,settings.root_name);var addRootBlocks=function addRootBlocks(){var node=rootNode.firstChild,rootBlockNode=null;var trim=function trim(rootBlock){if(rootBlock){node=rootBlock.firstChild;if(node&&node.type===3){node.value=node.value.replace(startWhiteSpaceRegExp,'');}node=rootBlock.lastChild;if(node&&node.type===3){node.value=node.value.replace(endWhiteSpaceRegExp,'');}}};if(!schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){return;}while(node){var next=node.next;if(node.type===3||node.type===1&&node.name!=='p'&&!blockElements[node.name]&&!node.attr('data-mce-type')){if(!rootBlockNode){rootBlockNode=createNode(rootBlockName,1);rootBlockNode.attr(settings.forced_root_block_attrs);rootNode.insert(rootBlockNode,node);rootBlockNode.append(node);}else{rootBlockNode.append(node);}}else{trim(rootBlockNode);rootBlockNode=null;}node=next;}trim(rootBlockNode);};var createNode=function createNode(name,type){var node=new AstNode(name,type);var list;if(name in nodeFilters){list=matchedNodes[name];if(list){list.push(node);}else{matchedNodes[name]=[node];}}return node;};var removeWhitespaceBefore=function removeWhitespaceBefore(node){var blockElements=schema.getBlockElements();for(var textNode=node.prev;textNode&&textNode.type===3;){var textVal=textNode.value.replace(endWhiteSpaceRegExp,'');if(textVal.length>0){textNode.value=textVal;return;}var textNodeNext=textNode.next;if(textNodeNext){if(textNodeNext.type===3&&textNodeNext.value.length){textNode=textNode.prev;continue;}if(!blockElements[textNodeNext.name]&&textNodeNext.name!=='script'&&textNodeNext.name!=='style'){textNode=textNode.prev;continue;}}var sibling=textNode.prev;textNode.remove();textNode=sibling;}};var cloneAndExcludeBlocks=function cloneAndExcludeBlocks(input){var output={};for(var name_2 in input){if(name_2!=='li'&&name_2!=='p'){output[name_2]=input[name_2];}}return output;};var isTextRootBlockEmpty=function isTextRootBlockEmpty(node){var tempNode=node;while(isNonNullable(tempNode)){if(tempNode.name in textRootBlockElements){return isEmpty(schema,nonEmptyElements,whiteSpaceElements,tempNode);}else{tempNode=tempNode.parent;}}return false;};var parser=SaxParser({validate:validate,document:settings.document,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,preserve_cdata:settings.preserve_cdata,self_closing_elements:cloneAndExcludeBlocks(schema.getSelfClosingElements()),cdata:function cdata(text){node.append(createNode('#cdata',4)).value=text;},text:function text(_text2,raw){var textNode;if(!isInWhiteSpacePreservedElement){_text2=_text2.replace(allWhiteSpaceRegExp,' ');if(isLineBreakNode(node.lastChild,blockElements)){_text2=_text2.replace(startWhiteSpaceRegExp,'');}}if(_text2.length!==0){textNode=createNode('#text',3);textNode.raw=!!raw;node.append(textNode).value=_text2;}},comment:function comment(text){node.append(createNode('#comment',8)).value=text;},pi:function pi(name,text){node.append(createNode(name,7)).value=text;removeWhitespaceBefore(node);},doctype:function doctype(text){var newNode=node.append(createNode('#doctype',10));newNode.value=text;removeWhitespaceBefore(node);},start:function start(name,attrs,empty){var elementRule=validate?schema.getElementRule(name):{};if(elementRule){var newNode=createNode(elementRule.outputName||name,1);newNode.attributes=attrs;newNode.shortEnded=empty;node.append(newNode);var parent_2=children[node.name];if(parent_2&&children[newNode.name]&&!parent_2[newNode.name]){invalidChildren.push(newNode);}var attrFiltersLen=attributeFilters.length;while(attrFiltersLen--){var attrName=attributeFilters[attrFiltersLen].name;if(attrName in attrs.map){list=matchedAttributes[attrName];if(list){list.push(newNode);}else{matchedAttributes[attrName]=[newNode];}}}if(blockElements[name]){removeWhitespaceBefore(newNode);}if(!empty){node=newNode;}if(!isInWhiteSpacePreservedElement&&whiteSpaceElements[name]){isInWhiteSpacePreservedElement=true;}}},end:function end(name){var textNode,text,sibling;var elementRule=validate?schema.getElementRule(name):{};if(elementRule){if(blockElements[name]){if(!isInWhiteSpacePreservedElement){textNode=node.firstChild;if(textNode&&textNode.type===3){text=textNode.value.replace(startWhiteSpaceRegExp,'');if(text.length>0){textNode.value=text;textNode=textNode.next;}else{sibling=textNode.next;textNode.remove();textNode=sibling;while(textNode&&textNode.type===3){text=textNode.value;sibling=textNode.next;if(text.length===0||isAllWhiteSpaceRegExp.test(text)){textNode.remove();textNode=sibling;}textNode=sibling;}}}textNode=node.lastChild;if(textNode&&textNode.type===3){text=textNode.value.replace(endWhiteSpaceRegExp,'');if(text.length>0){textNode.value=text;textNode=textNode.prev;}else{sibling=textNode.prev;textNode.remove();textNode=sibling;while(textNode&&textNode.type===3){text=textNode.value;sibling=textNode.prev;if(text.length===0||isAllWhiteSpaceRegExp.test(text)){textNode.remove();textNode=sibling;}textNode=sibling;}}}}}if(isInWhiteSpacePreservedElement&&whiteSpaceElements[name]){isInWhiteSpacePreservedElement=false;}var isNodeEmpty=isEmpty(schema,nonEmptyElements,whiteSpaceElements,node);var parentNode=node.parent;if(elementRule.paddInEmptyBlock&&isNodeEmpty&&isTextRootBlockEmpty(node)){paddEmptyNode(settings,args,blockElements,node);}else if(elementRule.removeEmpty&&isNodeEmpty){if(blockElements[node.name]){node.empty().remove();}else{node.unwrap();}}else if(elementRule.paddEmpty&&(isPaddedWithNbsp(node)||isNodeEmpty)){paddEmptyNode(settings,args,blockElements,node);}node=parentNode;}}},schema);var rootNode=node=new AstNode(args.context||settings.root_name,11);parser.parse(html,args.format);if(validate&&invalidChildren.length){if(!args.context){fixInvalidChildren(invalidChildren);}else{args.invalid=true;}}if(rootBlockName&&(rootNode.name==='body'||args.isRootContent)){addRootBlocks();}if(!args.invalid){for(name in matchedNodes){if(!has$2(matchedNodes,name)){continue;}list=nodeFilters[name];nodes=matchedNodes[name];fi=nodes.length;while(fi--){if(!nodes[fi].parent){nodes.splice(fi,1);}}for(i=0,l=list.length;i<l;i++){list[i](nodes,name,args);}}for(i=0,l=attributeFilters.length;i<l;i++){list=attributeFilters[i];if(list.name in matchedAttributes){nodes=matchedAttributes[list.name];fi=nodes.length;while(fi--){if(!nodes[fi].parent){nodes.splice(fi,1);}}for(fi=0,fl=list.callbacks.length;fi<fl;fi++){list.callbacks[fi](nodes,list.name,args);}}}}return rootNode;};var exports={schema:schema,addAttributeFilter:addAttributeFilter,getAttributeFilters:getAttributeFilters,addNodeFilter:addNodeFilter,getNodeFilters:getNodeFilters,filterNode:filterNode,parse:parse};register$1(exports,settings);register$2(exports,settings);return exports;};var register=function register(htmlParser,settings,dom){htmlParser.addAttributeFilter('data-mce-tabindex',function(nodes,name){var i=nodes.length;while(i--){var node=nodes[i];node.attr('tabindex',node.attr('data-mce-tabindex'));node.attr(name,null);}});htmlParser.addAttributeFilter('src,href,style',function(nodes,name){var internalName='data-mce-'+name;var urlConverter=settings.url_converter;var urlConverterScope=settings.url_converter_scope;var i=nodes.length;while(i--){var node=nodes[i];var value=node.attr(internalName);if(value!==undefined){node.attr(name,value.length>0?value:null);node.attr(internalName,null);}else{value=node.attr(name);if(name==='style'){value=dom.serializeStyle(dom.parseStyle(value),node.name);}else if(urlConverter){value=urlConverter.call(urlConverterScope,value,name,node.name);}node.attr(name,value.length>0?value:null);}}});htmlParser.addAttributeFilter('class',function(nodes){var i=nodes.length;while(i--){var node=nodes[i];var value=node.attr('class');if(value){value=node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g,'');node.attr('class',value.length>0?value:null);}}});htmlParser.addAttributeFilter('data-mce-type',function(nodes,name,args){var i=nodes.length;while(i--){var node=nodes[i];if(node.attr('data-mce-type')==='bookmark'&&!args.cleanup){var hasChildren=Optional.from(node.firstChild).exists(function(firstChild){return!isZwsp(firstChild.value);});if(hasChildren){node.unwrap();}else{node.remove();}}}});htmlParser.addNodeFilter('noscript',function(nodes){var i=nodes.length;while(i--){var node=nodes[i].firstChild;if(node){node.value=Entities.decode(node.value);}}});htmlParser.addNodeFilter('script,style',function(nodes,name){var trim=function trim(value){return value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g,'\\n').replace(/^[\\r\\n]*|[\\r\\n]*$/g,'').replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi,'').replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g,'');};var i=nodes.length;while(i--){var node=nodes[i];var value=node.firstChild?node.firstChild.value:'';if(name==='script'){var type=node.attr('type');if(type){node.attr('type',type==='mce-no/type'?null:type.replace(/^mce\\-/,''));}if(settings.element_format==='xhtml'&&value.length>0){node.firstChild.value='// <![CDATA[\\n'+trim(value)+'\\n// ]]>';}}else{if(settings.element_format==='xhtml'&&value.length>0){node.firstChild.value='<!--\\n'+trim(value)+'\\n-->';}}}});htmlParser.addNodeFilter('#comment',function(nodes){var i=nodes.length;while(i--){var node=nodes[i];if(settings.preserve_cdata&&node.value.indexOf('[CDATA[')===0){node.name='#cdata';node.type=4;node.value=dom.decode(node.value.replace(/^\\[CDATA\\[|\\]\\]$/g,''));}else if(node.value.indexOf('mce:protected ')===0){node.name='#text';node.type=3;node.raw=true;node.value=unescape(node.value).substr(14);}}});htmlParser.addNodeFilter('xml:namespace,input',function(nodes,name){var i=nodes.length;while(i--){var node=nodes[i];if(node.type===7){node.remove();}else if(node.type===1){if(name==='input'&&!node.attr('type')){node.attr('type','text');}}}});htmlParser.addAttributeFilter('data-mce-type',function(nodes){each$k(nodes,function(node){if(node.attr('data-mce-type')==='format-caret'){if(node.isEmpty(htmlParser.schema.getNonEmptyElements())){node.remove();}else{node.unwrap();}}});});htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,'+'data-mce-selected,data-mce-expando,'+'data-mce-type,data-mce-resize,data-mce-placeholder',function(nodes,name){var i=nodes.length;while(i--){nodes[i].attr(name,null);}});};var trimTrailingBr=function trimTrailingBr(rootNode){var isBr=function isBr(node){return node&&node.name==='br';};var brNode1=rootNode.lastChild;if(isBr(brNode1)){var brNode2=brNode1.prev;if(isBr(brNode2)){brNode1.remove();brNode2.remove();}}};var preProcess=function preProcess(editor,node,args){var oldDoc;var dom=editor.dom;var clonedNode=node.cloneNode(true);var impl=document.implementation;if(impl.createHTMLDocument){var doc_1=impl.createHTMLDocument('');Tools.each(clonedNode.nodeName==='BODY'?clonedNode.childNodes:[clonedNode],function(node){doc_1.body.appendChild(doc_1.importNode(node,true));});if(clonedNode.nodeName!=='BODY'){clonedNode=doc_1.body.firstChild;}else{clonedNode=doc_1.body;}oldDoc=dom.doc;dom.doc=doc_1;}firePreProcess(editor,_assign(_assign({},args),{node:clonedNode}));if(oldDoc){dom.doc=oldDoc;}return clonedNode;};var shouldFireEvent=function shouldFireEvent(editor,args){return editor&&editor.hasEventListeners('PreProcess')&&!args.no_events;};var process=function process(editor,node,args){return shouldFireEvent(editor,args)?preProcess(editor,node,args):node;};var addTempAttr=function addTempAttr(htmlParser,tempAttrs,name){if(Tools.inArray(tempAttrs,name)===-1){htmlParser.addAttributeFilter(name,function(nodes,name){var i=nodes.length;while(i--){nodes[i].attr(name,null);}});tempAttrs.push(name);}};var postProcess=function postProcess(editor,args,content){if(!args.no_events&&editor){var outArgs=firePostProcess(editor,_assign(_assign({},args),{content:content}));return outArgs.content;}else{return content;}};var getHtmlFromNode=function getHtmlFromNode(dom,node,args){var html=trim$3(args.getInner?node.innerHTML:dom.getOuterHTML(node));return args.selection||isWsPreserveElement(SugarElement.fromDom(node))?html:Tools.trim(html);};var parseHtml=function parseHtml(htmlParser,html,args){var parserArgs=args.selection?_assign({forced_root_block:false},args):args;var rootNode=htmlParser.parse(html,parserArgs);trimTrailingBr(rootNode);return rootNode;};var serializeNode=function serializeNode(settings,schema,node){var htmlSerializer=HtmlSerializer(settings,schema);return htmlSerializer.serialize(node);};var toHtml=function toHtml(editor,settings,schema,rootNode,args){var content=serializeNode(settings,schema,rootNode);return postProcess(editor,args,content);};var DomSerializerImpl=function DomSerializerImpl(settings,editor){var tempAttrs=['data-mce-selected'];var dom=editor&&editor.dom?editor.dom:_DOMUtils.DOM;var schema=editor&&editor.schema?editor.schema:Schema(settings);settings.entity_encoding=settings.entity_encoding||'named';settings.remove_trailing_brs='remove_trailing_brs'in settings?settings.remove_trailing_brs:true;var htmlParser=DomParser(settings,schema);register(htmlParser,settings,dom);var serialize=function serialize(node,parserArgs){if(parserArgs===void 0){parserArgs={};}var args=_assign({format:'html'},parserArgs);var targetNode=process(editor,node,args);var html=getHtmlFromNode(dom,targetNode,args);var rootNode=parseHtml(htmlParser,html,args);return args.format==='tree'?rootNode:toHtml(editor,settings,schema,rootNode,args);};return{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:serialize,addRules:schema.addValidElements,setRules:schema.setValidElements,addTempAttr:curry(addTempAttr,htmlParser,tempAttrs),getTempAttrs:constant(tempAttrs),getNodeFilters:htmlParser.getNodeFilters,getAttributeFilters:htmlParser.getAttributeFilters};};var DomSerializer=function DomSerializer(settings,editor){var domSerializer=DomSerializerImpl(settings,editor);return{schema:domSerializer.schema,addNodeFilter:domSerializer.addNodeFilter,addAttributeFilter:domSerializer.addAttributeFilter,serialize:domSerializer.serialize,addRules:domSerializer.addRules,setRules:domSerializer.setRules,addTempAttr:domSerializer.addTempAttr,getTempAttrs:domSerializer.getTempAttrs,getNodeFilters:domSerializer.getNodeFilters,getAttributeFilters:domSerializer.getAttributeFilters};};var defaultFormat='html';var getContent=function getContent(editor,args){if(args===void 0){args={};}var format=args.format?args.format:defaultFormat;return getContent$2(editor,args,format);};var setContent=function setContent(editor,content,args){if(args===void 0){args={};}return setContent$2(editor,content,args);};var DOM$7=_DOMUtils.DOM;var restoreOriginalStyles=function restoreOriginalStyles(editor){DOM$7.setStyle(editor.id,'display',editor.orgDisplay);};var safeDestroy=function safeDestroy(x){return Optional.from(x).each(function(x){return x.destroy();});};var clearDomReferences=function clearDomReferences(editor){editor.contentAreaContainer=editor.formElement=editor.container=editor.editorContainer=null;editor.bodyElement=editor.contentDocument=editor.contentWindow=null;editor.iframeElement=editor.targetElm=null;if(editor.selection){editor.selection=editor.selection.win=editor.selection.dom=editor.selection.dom.doc=null;}};var restoreForm=function restoreForm(editor){var form=editor.formElement;if(form){if(form._mceOldSubmit){form.submit=form._mceOldSubmit;form._mceOldSubmit=null;}DOM$7.unbind(form,'submit reset',editor.formEventDelegate);}};var remove=function remove(editor){if(!editor.removed){var _selectionOverrides=editor._selectionOverrides,editorUpload=editor.editorUpload;var body=editor.getBody();var element=editor.getElement();if(body){editor.save({is_removing:true});}editor.removed=true;editor.unbindAllNativeEvents();if(editor.hasHiddenInput&&element){DOM$7.remove(element.nextSibling);}fireRemove(editor);editor.editorManager.remove(editor);if(!editor.inline&&body){restoreOriginalStyles(editor);}fireDetach(editor);DOM$7.remove(editor.getContainer());safeDestroy(_selectionOverrides);safeDestroy(editorUpload);editor.destroy();}};var destroy=function destroy(editor,automatic){var selection=editor.selection,dom=editor.dom;if(editor.destroyed){return;}if(!automatic&&!editor.removed){editor.remove();return;}if(!automatic){editor.editorManager.off('beforeunload',editor._beforeUnload);if(editor.theme&&editor.theme.destroy){editor.theme.destroy();}safeDestroy(selection);safeDestroy(dom);}restoreForm(editor);clearDomReferences(editor);editor.destroyed=true;};var deep=function deep(old,nu){var bothObjects=isObject(old)&&isObject(nu);return bothObjects?deepMerge(old,nu):nu;};var baseMerge=function baseMerge(merger){return function(){var objects=[];for(var _i=0;_i<arguments.length;_i++){objects[_i]=arguments[_i];}if(objects.length===0){throw new Error('Can\\'t merge zero objects');}var ret={};for(var j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject){if(has$2(curObject,key)){ret[key]=merger(ret[key],curObject[key]);}}}return ret;};};var deepMerge=baseMerge(deep);var deprecatedSettings=('autoresize_on_init,content_editable_state,convert_fonts_to_spans,inline_styles,padd_empty_with_br,block_elements,'+'boolean_attributes,editor_deselector,editor_selector,elements,file_browser_callback_types,filepicker_validator_handler,'+'force_hex_style_colors,force_p_newlines,gecko_spellcheck,images_dataimg_filter,media_scripts,mode,move_caret_before_on_enter_elements,'+'non_empty_elements,self_closing_elements,short_ended_elements,special,spellchecker_select_languages,spellchecker_whitelist,'+'tab_focus,table_responsive_width,text_block_elements,text_inline_elements,toolbar_drawer,types,validate,whitespace_elements,'+'paste_word_valid_elements,paste_retain_style_properties,paste_convert_word_fake_lists').split(',');var deprecatedPlugins='bbcode,colorpicker,contextmenu,fullpage,legacyoutput,spellchecker,textcolor'.split(',');var movedToPremiumPlugins='imagetools,toc'.split(',');var getDeprecatedSettings=function getDeprecatedSettings(settings){var settingNames=filter$4(deprecatedSettings,function(setting){return has$2(settings,setting);});var forcedRootBlock=settings.forced_root_block;if(forcedRootBlock===false||forcedRootBlock===''){settingNames.push('forced_root_block (false only)');}return sort(settingNames);};var getDeprecatedPlugins=function getDeprecatedPlugins(settings){var plugins=Tools.makeMap(settings.plugins,' ');var hasPlugin=function hasPlugin(plugin){return has$2(plugins,plugin);};var pluginNames=__spreadArray(__spreadArray([],filter$4(deprecatedPlugins,hasPlugin),true),bind(movedToPremiumPlugins,function(plugin){return hasPlugin(plugin)?[plugin+' (moving to premium)']:[];}),true);return sort(pluginNames);};var logDeprecationsWarning=function logDeprecationsWarning(rawSettings,finalSettings){var deprecatedSettings=getDeprecatedSettings(rawSettings);var deprecatedPlugins=getDeprecatedPlugins(finalSettings);var hasDeprecatedPlugins=deprecatedPlugins.length>0;var hasDeprecatedSettings=deprecatedSettings.length>0;var isLegacyMobileTheme=finalSettings.theme==='mobile';if(hasDeprecatedPlugins||hasDeprecatedSettings||isLegacyMobileTheme){var listJoiner='\\n- ';var themesMessage=isLegacyMobileTheme?'\\n\\nThemes:'+listJoiner+'mobile':'';var pluginsMessage=hasDeprecatedPlugins?'\\n\\nPlugins:'+listJoiner+deprecatedPlugins.join(listJoiner):'';var settingsMessage=hasDeprecatedSettings?'\\n\\nSettings:'+listJoiner+deprecatedSettings.join(listJoiner):'';console.warn('The following deprecated features are currently enabled, these will be removed in TinyMCE 6.0. '+'See https://www.tiny.cloud/docs/release-notes/6.0-upcoming-changes/ for more information.'+themesMessage+pluginsMessage+settingsMessage);}};var sectionResult=function sectionResult(sections,settings){return{sections:constant(sections),settings:constant(settings)};};var deviceDetection=detect().deviceType;var isTouch=deviceDetection.isTouch();var isPhone=deviceDetection.isPhone();var isTablet=deviceDetection.isTablet();var legacyMobilePlugins=['lists','autolink','autosave'];var defaultTouchSettings={table_grid:false,object_resizing:false,resize:false};var normalizePlugins=function normalizePlugins(plugins){var pluginNames=isArray$1(plugins)?plugins.join(' '):plugins;var trimmedPlugins=map$3(isString$1(pluginNames)?pluginNames.split(' '):[],trim$5);return filter$4(trimmedPlugins,function(item){return item.length>0;});};var filterLegacyMobilePlugins=function filterLegacyMobilePlugins(plugins){return filter$4(plugins,curry(contains$3,legacyMobilePlugins));};var extractSections=function extractSections(keys,settings){var result=bifilter(settings,function(value,key){return contains$3(keys,key);});return sectionResult(result.t,result.f);};var getSection=function getSection(sectionResult,name,defaults){if(defaults===void 0){defaults={};}var sections=sectionResult.sections();var sectionSettings=get$9(sections,name).getOr({});return Tools.extend({},defaults,sectionSettings);};var hasSection=function hasSection(sectionResult,name){return has$2(sectionResult.sections(),name);};var isSectionTheme=function isSectionTheme(sectionResult,name,theme){var section=sectionResult.sections();return hasSection(sectionResult,name)&&section[name].theme===theme;};var getSectionConfig=function getSectionConfig(sectionResult,name){return hasSection(sectionResult,name)?sectionResult.sections()[name]:{};};var getToolbarMode=function getToolbarMode(settings,defaultVal){return get$9(settings,'toolbar_mode').orThunk(function(){return get$9(settings,'toolbar_drawer').map(function(val){return val===false?'wrap':val;});}).getOr(defaultVal);};var getDefaultSettings=function getDefaultSettings(settings,id,documentBaseUrl,isTouch,editor){var baseDefaults={id:id,theme:'silver',toolbar_mode:getToolbarMode(settings,'floating'),plugins:'',document_base_url:documentBaseUrl,add_form_submit_trigger:true,submit_patch:true,add_unload_trigger:true,convert_urls:true,relative_urls:true,remove_script_host:true,object_resizing:true,doctype:'<!DOCTYPE html>',visual:true,font_size_legacy_values:'xx-small,small,medium,large,x-large,xx-large,300%',forced_root_block:'p',hidden_input:true,inline_styles:true,convert_fonts_to_spans:true,indent:true,indent_before:'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,'+'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',indent_after:'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,'+'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',entity_encoding:'named',url_converter:editor.convertURL,url_converter_scope:editor};return _assign(_assign({},baseDefaults),isTouch?defaultTouchSettings:{});};var getDefaultMobileSettings=function getDefaultMobileSettings(mobileSettings,isPhone){var defaultMobileSettings={resize:false,toolbar_mode:getToolbarMode(mobileSettings,'scrolling'),toolbar_sticky:false};var defaultPhoneSettings={menubar:false};return _assign(_assign(_assign({},defaultTouchSettings),defaultMobileSettings),isPhone?defaultPhoneSettings:{});};var getExternalPlugins=function getExternalPlugins(overrideSettings,settings){var userDefinedExternalPlugins=settings.external_plugins?settings.external_plugins:{};if(overrideSettings&&overrideSettings.external_plugins){return Tools.extend({},overrideSettings.external_plugins,userDefinedExternalPlugins);}else{return userDefinedExternalPlugins;}};var combinePlugins=function combinePlugins(forcedPlugins,plugins){return[].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));};var getPlatformPlugins=function getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins){if(isMobileDevice&&isSectionTheme(sectionResult,'mobile','mobile')){return filterLegacyMobilePlugins(mobilePlugins);}else if(isMobileDevice&&hasSection(sectionResult,'mobile')){return mobilePlugins;}else{return desktopPlugins;}};var processPlugins=function processPlugins(isMobileDevice,sectionResult,defaultOverrideSettings,settings){var forcedPlugins=normalizePlugins(defaultOverrideSettings.forced_plugins);var desktopPlugins=normalizePlugins(settings.plugins);var mobileConfig=getSectionConfig(sectionResult,'mobile');var mobilePlugins=mobileConfig.plugins?normalizePlugins(mobileConfig.plugins):desktopPlugins;var platformPlugins=getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins);var combinedPlugins=combinePlugins(forcedPlugins,platformPlugins);if(Env.browser.isIE()&&contains$3(combinedPlugins,'rtc')){throw new Error('RTC plugin is not supported on IE 11.');}return Tools.extend(settings,{plugins:combinedPlugins.join(' ')});};var isOnMobile=function isOnMobile(isMobileDevice,sectionResult){return isMobileDevice&&hasSection(sectionResult,'mobile');};var combineSettings=function combineSettings(isMobileDevice,isPhone,defaultSettings,defaultOverrideSettings,settings){var defaultDeviceSettings=isMobileDevice?{mobile:getDefaultMobileSettings(settings.mobile||{},isPhone)}:{};var sectionResult=extractSections(['mobile'],deepMerge(defaultDeviceSettings,settings));var extendedSettings=Tools.extend(defaultSettings,defaultOverrideSettings,sectionResult.settings(),isOnMobile(isMobileDevice,sectionResult)?getSection(sectionResult,'mobile'):{},{validate:true,external_plugins:getExternalPlugins(defaultOverrideSettings,sectionResult.settings())});return processPlugins(isMobileDevice,sectionResult,defaultOverrideSettings,extendedSettings);};var getEditorSettings=function getEditorSettings(editor,id,documentBaseUrl,defaultOverrideSettings,settings){var defaultSettings=getDefaultSettings(settings,id,documentBaseUrl,isTouch,editor);var finalSettings=combineSettings(isPhone||isTablet,isPhone,defaultSettings,defaultOverrideSettings,settings);if(finalSettings.deprecation_warnings!==false){logDeprecationsWarning(settings,finalSettings);}return finalSettings;};var getFiltered=function getFiltered(predicate,editor,name){return Optional.from(editor.settings[name]).filter(predicate);};var getParamObject=function getParamObject(value){var output={};if(typeof value==='string'){each$k(value.indexOf('=')>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(','),function(val){var arr=val.split('=');if(arr.length>1){output[Tools.trim(arr[0])]=Tools.trim(arr[1]);}else{output[Tools.trim(arr[0])]=Tools.trim(arr[0]);}});}else{output=value;}return output;};var isArrayOf=function isArrayOf(p){return function(a){return isArray$1(a)&&forall(a,p);};};var getParam=function getParam(editor,name,defaultVal,type){var value=name in editor.settings?editor.settings[name]:defaultVal;if(type==='hash'){return getParamObject(value);}else if(type==='string'){return getFiltered(isString$1,editor,name).getOr(defaultVal);}else if(type==='number'){return getFiltered(isNumber,editor,name).getOr(defaultVal);}else if(type==='boolean'){return getFiltered(isBoolean,editor,name).getOr(defaultVal);}else if(type==='object'){return getFiltered(isObject,editor,name).getOr(defaultVal);}else if(type==='array'){return getFiltered(isArray$1,editor,name).getOr(defaultVal);}else if(type==='string[]'){return getFiltered(isArrayOf(isString$1),editor,name).getOr(defaultVal);}else if(type==='function'){return getFiltered(isFunction,editor,name).getOr(defaultVal);}else{return value;}};var CreateIconManager=function CreateIconManager(){var lookup={};var add=function add(id,iconPack){lookup[id]=iconPack;};var get=function get(id){if(lookup[id]){return lookup[id];}return{icons:{}};};var has=function has(id){return has$2(lookup,id);};return{add:add,get:get,has:has};};var IconManager=CreateIconManager();var getProp=function getProp(propName,elm){var rawElm=elm.dom;return rawElm[propName];};var getComputedSizeProp=function getComputedSizeProp(propName,elm){return parseInt(get$5(elm,propName),10);};var getClientWidth=curry(getProp,'clientWidth');var getClientHeight=curry(getProp,'clientHeight');var getMarginTop=curry(getComputedSizeProp,'margin-top');var getMarginLeft=curry(getComputedSizeProp,'margin-left');var getBoundingClientRect=function getBoundingClientRect(elm){return elm.dom.getBoundingClientRect();};var isInsideElementContentArea=function isInsideElementContentArea(bodyElm,clientX,clientY){var clientWidth=getClientWidth(bodyElm);var clientHeight=getClientHeight(bodyElm);return clientX>=0&&clientY>=0&&clientX<=clientWidth&&clientY<=clientHeight;};var transpose=function transpose(inline,elm,clientX,clientY){var clientRect=getBoundingClientRect(elm);var deltaX=inline?clientRect.left+elm.dom.clientLeft+getMarginLeft(elm):0;var deltaY=inline?clientRect.top+elm.dom.clientTop+getMarginTop(elm):0;var x=clientX-deltaX;var y=clientY-deltaY;return{x:x,y:y};};var isXYInContentArea=function isXYInContentArea(editor,clientX,clientY){var bodyElm=SugarElement.fromDom(editor.getBody());var targetElm=editor.inline?bodyElm:documentElement(bodyElm);var transposedPoint=transpose(editor.inline,targetElm,clientX,clientY);return isInsideElementContentArea(targetElm,transposedPoint.x,transposedPoint.y);};var fromDomSafe=function fromDomSafe(node){return Optional.from(node).map(SugarElement.fromDom);};var isEditorAttachedToDom=function isEditorAttachedToDom(editor){var rawContainer=editor.inline?editor.getBody():editor.getContentAreaContainer();return fromDomSafe(rawContainer).map(_inBody).getOr(false);};var NotificationManagerImpl=function NotificationManagerImpl(){var unimplemented=function unimplemented(){throw new Error('Theme did not provide a NotificationManager implementation.');};return{open:unimplemented,close:unimplemented,reposition:unimplemented,getArgs:unimplemented};};var NotificationManager=function NotificationManager(editor){var notifications=[];var getImplementation=function getImplementation(){var theme=editor.theme;return theme&&theme.getNotificationManagerImpl?theme.getNotificationManagerImpl():NotificationManagerImpl();};var getTopNotification=function getTopNotification(){return Optional.from(notifications[0]);};var isEqual=function isEqual(a,b){return a.type===b.type&&a.text===b.text&&!a.progressBar&&!a.timeout&&!b.progressBar&&!b.timeout;};var reposition=function reposition(){if(notifications.length>0){getImplementation().reposition(notifications);}};var addNotification=function addNotification(notification){notifications.push(notification);};var closeNotification=function closeNotification(notification){findIndex$2(notifications,function(otherNotification){return otherNotification===notification;}).each(function(index){notifications.splice(index,1);});};var open=function open(spec,fireEvent){if(fireEvent===void 0){fireEvent=true;}if(editor.removed||!isEditorAttachedToDom(editor)){return;}if(fireEvent){editor.fire('BeforeOpenNotification',{notification:spec});}return find$3(notifications,function(notification){return isEqual(getImplementation().getArgs(notification),spec);}).getOrThunk(function(){editor.editorManager.setActive(editor);var notification=getImplementation().open(spec,function(){closeNotification(notification);reposition();getTopNotification().fold(function(){return editor.focus();},function(top){return focus$1(SugarElement.fromDom(top.getEl()));});});addNotification(notification);reposition();editor.fire('OpenNotification',{notification:_assign({},notification)});return notification;});};var close=function close(){getTopNotification().each(function(notification){getImplementation().close(notification);closeNotification(notification);reposition();});};var getNotifications=constant(notifications);var registerEvents=function registerEvents(editor){editor.on('SkinLoaded',function(){var serviceMessage=getServiceMessage(editor);if(serviceMessage){open({text:serviceMessage,type:'warning',timeout:0},false);}reposition();});editor.on('show ResizeEditor ResizeWindow NodeChange',function(){Delay.requestAnimationFrame(reposition);});editor.on('remove',function(){each$k(notifications.slice(),function(notification){getImplementation().close(notification);});});};registerEvents(editor);return{open:open,close:close,getNotifications:getNotifications};};var PluginManager=_AddOnManager.PluginManager;var ThemeManager=_AddOnManager.ThemeManager;function WindowManagerImpl(){var unimplemented=function unimplemented(){throw new Error('Theme did not provide a WindowManager implementation.');};return{open:unimplemented,openUrl:unimplemented,alert:unimplemented,confirm:unimplemented,close:unimplemented,getParams:unimplemented,setParams:unimplemented};}var WindowManager=function WindowManager(editor){var dialogs=[];var getImplementation=function getImplementation(){var theme=editor.theme;return theme&&theme.getWindowManagerImpl?theme.getWindowManagerImpl():WindowManagerImpl();};var funcBind=function funcBind(scope,f){return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}return f?f.apply(scope,args):undefined;};};var fireOpenEvent=function fireOpenEvent(dialog){editor.fire('OpenWindow',{dialog:dialog});};var fireCloseEvent=function fireCloseEvent(dialog){editor.fire('CloseWindow',{dialog:dialog});};var addDialog=function addDialog(dialog){dialogs.push(dialog);fireOpenEvent(dialog);};var closeDialog=function closeDialog(dialog){fireCloseEvent(dialog);dialogs=filter$4(dialogs,function(otherDialog){return otherDialog!==dialog;});if(dialogs.length===0){editor.focus();}};var getTopDialog=function getTopDialog(){return Optional.from(dialogs[dialogs.length-1]);};var storeSelectionAndOpenDialog=function storeSelectionAndOpenDialog(openDialog){editor.editorManager.setActive(editor);store(editor);var dialog=openDialog();addDialog(dialog);return dialog;};var open=function open(args,params){return storeSelectionAndOpenDialog(function(){return getImplementation().open(args,params,closeDialog);});};var openUrl=function openUrl(args){return storeSelectionAndOpenDialog(function(){return getImplementation().openUrl(args,closeDialog);});};var alert=function alert(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.alert(message,funcBind(scope?scope:windowManagerImpl,callback));};var confirm=function confirm(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.confirm(message,funcBind(scope?scope:windowManagerImpl,callback));};var close=function close(){getTopDialog().each(function(dialog){getImplementation().close(dialog);closeDialog(dialog);});};editor.on('remove',function(){each$k(dialogs,function(dialog){getImplementation().close(dialog);});});return{open:open,openUrl:openUrl,alert:alert,confirm:confirm,close:close};};var displayNotification=function displayNotification(editor,message){editor.notificationManager.open({type:'error',text:message});};var displayError=function displayError(editor,message){if(editor._skinLoaded){displayNotification(editor,message);}else{editor.on('SkinLoaded',function(){displayNotification(editor,message);});}};var uploadError=function uploadError(editor,message){displayError(editor,I18n.translate(['Failed to upload image: {0}',message]));};var logError=function logError(editor,errorType,msg){fireError(editor,errorType,{message:msg});console.error(msg);};var createLoadError=function createLoadError(type,url,name){return name?'Failed to load '+type+': '+name+' from url '+url:'Failed to load '+type+' url: '+url;};var pluginLoadError=function pluginLoadError(editor,url,name){logError(editor,'PluginLoadError',createLoadError('plugin',url,name));};var iconsLoadError=function iconsLoadError(editor,url,name){logError(editor,'IconsLoadError',createLoadError('icons',url,name));};var languageLoadError=function languageLoadError(editor,url,name){logError(editor,'LanguageLoadError',createLoadError('language',url,name));};var pluginInitError=function pluginInitError(editor,name,err){var message=I18n.translate(['Failed to initialize plugin: {0}',name]);fireError(editor,'PluginLoadError',{message:message});initError(message,err);displayError(editor,message);};var initError=function initError(message){var x=[];for(var _i=1;_i<arguments.length;_i++){x[_i-1]=arguments[_i];}var console=window.console;if(console){if(console.error){console.error.apply(console,__spreadArray([message],x,false));}else{console.log.apply(console,__spreadArray([message],x,false));}}};var isContentCssSkinName=function isContentCssSkinName(url){return /^[a-z0-9\\-]+$/i.test(url);};var getContentCssUrls=function getContentCssUrls(editor){return transformToUrls(editor,getContentCss(editor));};var getFontCssUrls=function getFontCssUrls(editor){return transformToUrls(editor,getFontCss(editor));};var transformToUrls=function transformToUrls(editor,cssLinks){var skinUrl=editor.editorManager.baseURL+'/skins/content';var suffix=editor.editorManager.suffix;var contentCssFile='content'+suffix+'.css';var inline=editor.inline===true;return map$3(cssLinks,function(url){if(isContentCssSkinName(url)&&!inline){return skinUrl+'/'+url+'/'+contentCssFile;}else{return editor.documentBaseURI.toAbsolute(url);}});};var appendContentCssFromSettings=function appendContentCssFromSettings(editor){editor.contentCSS=editor.contentCSS.concat(getContentCssUrls(editor),getFontCssUrls(editor));};var UploadStatus=function UploadStatus(){var PENDING=1,UPLOADED=2;var blobUriStatuses={};var createStatus=function createStatus(status,resultUri){return{status:status,resultUri:resultUri};};var hasBlobUri=function hasBlobUri(blobUri){return blobUri in blobUriStatuses;};var getResultUri=function getResultUri(blobUri){var result=blobUriStatuses[blobUri];return result?result.resultUri:null;};var isPending=function isPending(blobUri){return hasBlobUri(blobUri)?blobUriStatuses[blobUri].status===PENDING:false;};var isUploaded=function isUploaded(blobUri){return hasBlobUri(blobUri)?blobUriStatuses[blobUri].status===UPLOADED:false;};var markPending=function markPending(blobUri){blobUriStatuses[blobUri]=createStatus(PENDING,null);};var markUploaded=function markUploaded(blobUri,resultUri){blobUriStatuses[blobUri]=createStatus(UPLOADED,resultUri);};var removeFailed=function removeFailed(blobUri){delete blobUriStatuses[blobUri];};var destroy=function destroy(){blobUriStatuses={};};return{hasBlobUri:hasBlobUri,getResultUri:getResultUri,isPending:isPending,isUploaded:isUploaded,markPending:markPending,markUploaded:markUploaded,removeFailed:removeFailed,destroy:destroy};};var count=0;var seed=function seed(){var rnd=function rnd(){return Math.round(Math.random()*4294967295).toString(36);};var now=new Date().getTime();return's'+now.toString(36)+rnd()+rnd()+rnd();};var uuid=function uuid(prefix){return prefix+count++ +seed();};var BlobCache=function BlobCache(){var cache=[];var mimeToExt=function mimeToExt(mime){var mimes={'image/jpeg':'jpg','image/jpg':'jpg','image/gif':'gif','image/png':'png','image/apng':'apng','image/avif':'avif','image/svg+xml':'svg','image/webp':'webp','image/bmp':'bmp','image/tiff':'tiff'};return mimes[mime.toLowerCase()]||'dat';};var create=function create(o,blob,base64,name,filename){if(isString$1(o)){var id=o;return toBlobInfo({id:id,name:name,filename:filename,blob:blob,base64:base64});}else if(isObject(o)){return toBlobInfo(o);}else{throw new Error('Unknown input type');}};var toBlobInfo=function toBlobInfo(o){if(!o.blob||!o.base64){throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');}var id=o.id||uuid('blobid');var name=o.name||id;var blob=o.blob;return{id:constant(id),name:constant(name),filename:constant(o.filename||name+'.'+mimeToExt(blob.type)),blob:constant(blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(blob)),uri:constant(o.uri)};};var add=function add(blobInfo){if(!get(blobInfo.id())){cache.push(blobInfo);}};var findFirst=function findFirst(predicate){return find$3(cache,predicate).getOrUndefined();};var get=function get(id){return findFirst(function(cachedBlobInfo){return cachedBlobInfo.id()===id;});};var getByUri=function getByUri(blobUri){return findFirst(function(blobInfo){return blobInfo.blobUri()===blobUri;});};var getByData=function getByData(base64,type){return findFirst(function(blobInfo){return blobInfo.base64()===base64&&blobInfo.blob().type===type;});};var removeByUri=function removeByUri(blobUri){cache=filter$4(cache,function(blobInfo){if(blobInfo.blobUri()===blobUri){URL.revokeObjectURL(blobInfo.blobUri());return false;}return true;});};var destroy=function destroy(){each$k(cache,function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri());});cache=[];};return{create:create,add:add,get:get,getByUri:getByUri,getByData:getByData,findFirst:findFirst,removeByUri:removeByUri,destroy:destroy};};var Uploader=function Uploader(uploadStatus,settings){var pendingPromises={};var pathJoin=function pathJoin(path1,path2){if(path1){return path1.replace(/\\/$/,'')+'/'+path2.replace(/^\\//,'');}return path2;};var defaultHandler=function defaultHandler(blobInfo,success,failure,progress){var xhr=new XMLHttpRequest();xhr.open('POST',settings.url);xhr.withCredentials=settings.credentials;xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100);};xhr.onerror=function(){failure('Image upload failed due to a XHR Transport error. Code: '+xhr.status);};xhr.onload=function(){if(xhr.status<200||xhr.status>=300){failure('HTTP Error: '+xhr.status);return;}var json=JSON.parse(xhr.responseText);if(!json||typeof json.location!=='string'){failure('Invalid JSON: '+xhr.responseText);return;}success(pathJoin(settings.basePath,json.location));};var formData=new FormData();formData.append('file',blobInfo.blob(),blobInfo.filename());xhr.send(formData);};var noUpload=function noUpload(){return new promiseObj(function(resolve){resolve([]);});};var handlerSuccess=function handlerSuccess(blobInfo,url){return{url:url,blobInfo:blobInfo,status:true};};var handlerFailure=function handlerFailure(blobInfo,message,options){return{url:'',blobInfo:blobInfo,status:false,error:{message:message,options:options}};};var resolvePending=function resolvePending(blobUri,result){Tools.each(pendingPromises[blobUri],function(resolve){resolve(result);});delete pendingPromises[blobUri];};var uploadBlobInfo=function uploadBlobInfo(blobInfo,handler,openNotification){uploadStatus.markPending(blobInfo.blobUri());return new promiseObj(function(resolve){var notification,progress;try{var closeNotification_1=function closeNotification_1(){if(notification){notification.close();progress=noop;}};var success=function success(url){closeNotification_1();uploadStatus.markUploaded(blobInfo.blobUri(),url);resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url));resolve(handlerSuccess(blobInfo,url));};var failure=function failure(error,options){var failureOptions=options?options:{};closeNotification_1();uploadStatus.removeFailed(blobInfo.blobUri());resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error,failureOptions));resolve(handlerFailure(blobInfo,error,failureOptions));};progress=function progress(percent){if(percent<0||percent>100){return;}Optional.from(notification).orThunk(function(){return Optional.from(openNotification).map(apply);}).each(function(n){notification=n;n.progressBar.value(percent);});};handler(blobInfo,success,failure,progress);}catch(ex){resolve(handlerFailure(blobInfo,ex.message,{}));}});};var isDefaultHandler=function isDefaultHandler(handler){return handler===defaultHandler;};var pendingUploadBlobInfo=function pendingUploadBlobInfo(blobInfo){var blobUri=blobInfo.blobUri();return new promiseObj(function(resolve){pendingPromises[blobUri]=pendingPromises[blobUri]||[];pendingPromises[blobUri].push(resolve);});};var uploadBlobs=function uploadBlobs(blobInfos,openNotification){blobInfos=Tools.grep(blobInfos,function(blobInfo){return!uploadStatus.isUploaded(blobInfo.blobUri());});return promiseObj.all(Tools.map(blobInfos,function(blobInfo){return uploadStatus.isPending(blobInfo.blobUri())?pendingUploadBlobInfo(blobInfo):uploadBlobInfo(blobInfo,settings.handler,openNotification);}));};var upload=function upload(blobInfos,openNotification){return!settings.url&&isDefaultHandler(settings.handler)?noUpload():uploadBlobs(blobInfos,openNotification);};if(isFunction(settings.handler)===false){settings.handler=defaultHandler;}return{upload:upload};};var openNotification=function openNotification(editor){return function(){return editor.notificationManager.open({text:editor.translate('Image uploading...'),type:'info',timeout:-1,progressBar:true});};};var createUploader=function createUploader(editor,uploadStatus){return Uploader(uploadStatus,{url:getImageUploadUrl(editor),basePath:getImageUploadBasePath(editor),credentials:getImagesUploadCredentials(editor),handler:getImagesUploadHandler(editor)});};var ImageUploader=function ImageUploader(editor){var uploadStatus=UploadStatus();var uploader=createUploader(editor,uploadStatus);return{upload:function upload(blobInfos,showNotification){if(showNotification===void 0){showNotification=true;}return uploader.upload(blobInfos,showNotification?openNotification(editor):undefined);}};};var UploadChangeHandler=function UploadChangeHandler(editor){var lastChangedLevel=Cell(null);editor.on('change AddUndo',function(e){lastChangedLevel.set(_assign({},e.level));});var fireIfChanged=function fireIfChanged(){var data=editor.undoManager.data;last$2(data).filter(function(level){return!isEq$1(lastChangedLevel.get(),level);}).each(function(level){editor.setDirty(true);editor.fire('change',{level:level,lastLevel:get$a(data,data.length-2).getOrNull()});});};return{fireIfChanged:fireIfChanged};};var EditorUpload=function EditorUpload(editor){var blobCache=BlobCache();var uploader,imageScanner;var uploadStatus=UploadStatus();var urlFilters=[];var changeHandler=UploadChangeHandler(editor);var aliveGuard=function aliveGuard(callback){return function(result){if(editor.selection){return callback(result);}return[];};};var cacheInvalidator=function cacheInvalidator(url){return url+(url.indexOf('?')===-1?'?':'&')+new Date().getTime();};var replaceString=function replaceString(content,search,replace){var index=0;do{index=content.indexOf(search,index);if(index!==-1){content=content.substring(0,index)+replace+content.substr(index+search.length);index+=replace.length-search.length+1;}}while(index!==-1);return content;};var replaceImageUrl=function replaceImageUrl(content,targetUrl,replacementUrl){var replacementString='src=\"'+replacementUrl+'\"'+(replacementUrl===Env.transparentSrc?' data-mce-placeholder=\"1\"':'');content=replaceString(content,'src=\"'+targetUrl+'\"',replacementString);content=replaceString(content,'data-mce-src=\"'+targetUrl+'\"','data-mce-src=\"'+replacementUrl+'\"');return content;};var replaceUrlInUndoStack=function replaceUrlInUndoStack(targetUrl,replacementUrl){each$k(editor.undoManager.data,function(level){if(level.type==='fragmented'){level.fragments=map$3(level.fragments,function(fragment){return replaceImageUrl(fragment,targetUrl,replacementUrl);});}else{level.content=replaceImageUrl(level.content,targetUrl,replacementUrl);}});};var replaceImageUriInView=function replaceImageUriInView(image,resultUri){var src=editor.convertURL(resultUri,'src');replaceUrlInUndoStack(image.src,resultUri);editor.$(image).attr({'src':shouldReuseFileName(editor)?cacheInvalidator(resultUri):resultUri,'data-mce-src':src});};var uploadImages=function uploadImages(callback){if(!uploader){uploader=createUploader(editor,uploadStatus);}return scanForImages().then(aliveGuard(function(imageInfos){var blobInfos=map$3(imageInfos,function(imageInfo){return imageInfo.blobInfo;});return uploader.upload(blobInfos,openNotification(editor)).then(aliveGuard(function(result){var imagesToRemove=[];var filteredResult=map$3(result,function(uploadInfo,index){var blobInfo=imageInfos[index].blobInfo;var image=imageInfos[index].image;if(uploadInfo.status&&shouldReplaceBlobUris(editor)){blobCache.removeByUri(image.src);if(isRtc(editor));else{replaceImageUriInView(image,uploadInfo.url);}}else if(uploadInfo.error){if(uploadInfo.error.options.remove){replaceUrlInUndoStack(image.getAttribute('src'),Env.transparentSrc);imagesToRemove.push(image);}uploadError(editor,uploadInfo.error.message);}return{element:image,status:uploadInfo.status,uploadUri:uploadInfo.url,blobInfo:blobInfo};});if(filteredResult.length>0){changeHandler.fireIfChanged();}if(imagesToRemove.length>0){if(isRtc(editor)){console.error('Removing images on failed uploads is currently unsupported for RTC');}else{editor.undoManager.transact(function(){each$k(imagesToRemove,function(element){editor.dom.remove(element);blobCache.removeByUri(element.src);});});}}if(callback){callback(filteredResult);}return filteredResult;}));}));};var uploadImagesAuto=function uploadImagesAuto(callback){if(isAutomaticUploadsEnabled(editor)){return uploadImages(callback);}};var isValidDataUriImage=function isValidDataUriImage(imgElm){if(forall(urlFilters,function(filter){return filter(imgElm);})===false){return false;}if(imgElm.getAttribute('src').indexOf('data:')===0){var dataImgFilter=getImagesDataImgFilter(editor);return dataImgFilter(imgElm);}return true;};var addFilter=function addFilter(filter){urlFilters.push(filter);};var scanForImages=function scanForImages(){if(!imageScanner){imageScanner=ImageScanner(uploadStatus,blobCache);}return imageScanner.findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard(function(result){result=filter$4(result,function(resultItem){if(typeof resultItem==='string'){displayError(editor,resultItem);return false;}return true;});if(isRtc(editor));else{each$k(result,function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri());resultItem.image.src=resultItem.blobInfo.blobUri();resultItem.image.removeAttribute('data-mce-src');});}return result;}));};var destroy=function destroy(){blobCache.destroy();uploadStatus.destroy();imageScanner=uploader=null;};var replaceBlobUris=function replaceBlobUris(content){return content.replace(/src=\"(blob:[^\"]+)\"/g,function(match,blobUri){var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri){return'src=\"'+resultUri+'\"';}var blobInfo=blobCache.getByUri(blobUri);if(!blobInfo){blobInfo=foldl(editor.editorManager.get(),function(result,editor){return result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri);},null);}if(blobInfo){var blob=blobInfo.blob();return'src=\"data:'+blob.type+';base64,'+blobInfo.base64()+'\"';}return match;});};editor.on('SetContent',function(){if(isAutomaticUploadsEnabled(editor)){uploadImagesAuto();}else{scanForImages();}});editor.on('RawSaveContent',function(e){e.content=replaceBlobUris(e.content);});editor.on('GetContent',function(e){if(e.source_view||e.format==='raw'||e.format==='tree'){return;}e.content=replaceBlobUris(e.content);});editor.on('PostRender',function(){editor.parser.addNodeFilter('img',function(images){each$k(images,function(img){var src=img.attr('src');if(blobCache.getByUri(src)){return;}var resultUri=uploadStatus.getResultUri(src);if(resultUri){img.attr('src',resultUri);}});});});return{blobCache:blobCache,addFilter:addFilter,uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:destroy};};var get=function get(dom){var formats={valigntop:[{selector:'td,th',styles:{verticalAlign:'top'}}],valignmiddle:[{selector:'td,th',styles:{verticalAlign:'middle'}}],valignbottom:[{selector:'td,th',styles:{verticalAlign:'bottom'}}],alignleft:[{selector:'figure.image',collapsed:false,classes:'align-left',ceFalseOverride:true,preview:'font-family font-size'},{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',styles:{textAlign:'left'},inherit:false,preview:false,defaultBlock:'div'},{selector:'img,table,audio,video',collapsed:false,styles:{float:'left'},preview:'font-family font-size'}],aligncenter:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',styles:{textAlign:'center'},inherit:false,preview:'font-family font-size',defaultBlock:'div'},{selector:'figure.image',collapsed:false,classes:'align-center',ceFalseOverride:true,preview:'font-family font-size'},{selector:'img,audio,video',collapsed:false,styles:{display:'block',marginLeft:'auto',marginRight:'auto'},preview:false},{selector:'table',collapsed:false,styles:{marginLeft:'auto',marginRight:'auto'},preview:'font-family font-size'}],alignright:[{selector:'figure.image',collapsed:false,classes:'align-right',ceFalseOverride:true,preview:'font-family font-size'},{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',styles:{textAlign:'right'},inherit:false,preview:'font-family font-size',defaultBlock:'div'},{selector:'img,table,audio,video',collapsed:false,styles:{float:'right'},preview:'font-family font-size'}],alignjustify:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',styles:{textAlign:'justify'},inherit:false,defaultBlock:'div',preview:'font-family font-size'}],bold:[{inline:'strong',remove:'all',preserve_attributes:['class','style']},{inline:'span',styles:{fontWeight:'bold'}},{inline:'b',remove:'all',preserve_attributes:['class','style']}],italic:[{inline:'em',remove:'all',preserve_attributes:['class','style']},{inline:'span',styles:{fontStyle:'italic'}},{inline:'i',remove:'all',preserve_attributes:['class','style']}],underline:[{inline:'span',styles:{textDecoration:'underline'},exact:true},{inline:'u',remove:'all',preserve_attributes:['class','style']}],strikethrough:[{inline:'span',styles:{textDecoration:'line-through'},exact:true},{inline:'strike',remove:'all',preserve_attributes:['class','style']},{inline:'s',remove:'all',preserve_attributes:['class','style']}],forecolor:{inline:'span',styles:{color:'%value'},links:true,remove_similar:true,clear_child_styles:true},hilitecolor:{inline:'span',styles:{backgroundColor:'%value'},links:true,remove_similar:true,clear_child_styles:true},fontname:{inline:'span',toggle:false,styles:{fontFamily:'%value'},clear_child_styles:true},fontsize:{inline:'span',toggle:false,styles:{fontSize:'%value'},clear_child_styles:true},lineheight:{selector:'h1,h2,h3,h4,h5,h6,p,li,td,th,div',defaultBlock:'p',styles:{lineHeight:'%value'}},fontsize_class:{inline:'span',attributes:{class:'%value'}},blockquote:{block:'blockquote',wrapper:true,remove:'all'},subscript:{inline:'sub'},superscript:{inline:'sup'},code:{inline:'code'},link:{inline:'a',selector:'a',remove:'all',split:true,deep:true,onmatch:function onmatch(node,_fmt,_itemName){return isElement$5(node)&&node.hasAttribute('href');},onformat:function onformat(elm,_fmt,vars){Tools.each(vars,function(value,key){dom.setAttrib(elm,key,value);});}},lang:{inline:'span',clear_child_styles:true,remove_similar:true,attributes:{'lang':'%value','data-mce-lang':function dataMceLang(vars){var _a;return(_a=vars===null||vars===void 0?void 0:vars.customValue)!==null&&_a!==void 0?_a:null;}}},removeformat:[{selector:'b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins,small',remove:'all',split:true,expand:false,block_expand:true,deep:true},{selector:'span',attributes:['style','class'],remove:'empty',split:true,expand:false,deep:true},{selector:'*',attributes:['style','class'],split:false,expand:false,deep:true}]};Tools.each('p h1 h2 h3 h4 h5 h6 div address pre dt dd samp'.split(/\\s/),function(name){formats[name]={block:name,remove:'all'};});return formats;};var FormatRegistry=function FormatRegistry(editor){var formats={};var get$1=function get$1(name){return isNonNullable(name)?formats[name]:formats;};var has=function has(name){return has$2(formats,name);};var _register=function register(name,format){if(name){if(!isString$1(name)){each$j(name,function(format,name){_register(name,format);});}else{if(!isArray$1(format)){format=[format];}each$k(format,function(format){if(isUndefined(format.deep)){format.deep=!isSelectorFormat(format);}if(isUndefined(format.split)){format.split=!isSelectorFormat(format)||isInlineFormat(format);}if(isUndefined(format.remove)&&isSelectorFormat(format)&&!isInlineFormat(format)){format.remove='none';}if(isSelectorFormat(format)&&isInlineFormat(format)){format.mixed=true;format.block_expand=true;}if(isString$1(format.classes)){format.classes=format.classes.split(/\\s+/);}});formats[name]=format;}}};var unregister=function unregister(name){if(name&&formats[name]){delete formats[name];}return formats;};_register(get(editor.dom));_register(getFormats(editor));return{get:get$1,has:has,register:_register,unregister:unregister};};var each$5=Tools.each;var dom=_DOMUtils.DOM;var parsedSelectorToHtml=function parsedSelectorToHtml(ancestry,editor){var elm,item,fragment;var schema=editor&&editor.schema||Schema({});var decorate=function decorate(elm,item){if(item.classes.length){dom.addClass(elm,item.classes.join(' '));}dom.setAttribs(elm,item.attrs);};var createElement=function createElement(sItem){item=typeof sItem==='string'?{name:sItem,classes:[],attrs:{}}:sItem;var elm=dom.create(item.name);decorate(elm,item);return elm;};var getRequiredParent=function getRequiredParent(elm,candidate){var name=typeof elm!=='string'?elm.nodeName.toLowerCase():elm;var elmRule=schema.getElementRule(name);var parentsRequired=elmRule&&elmRule.parentsRequired;if(parentsRequired&&parentsRequired.length){return candidate&&Tools.inArray(parentsRequired,candidate)!==-1?candidate:parentsRequired[0];}else{return false;}};var _wrapInHtml=function wrapInHtml(elm,ancestry,siblings){var parent,parentCandidate;var ancestor=ancestry.length>0&&ancestry[0];var ancestorName=ancestor&&ancestor.name;var parentRequired=getRequiredParent(elm,ancestorName);if(parentRequired){if(ancestorName===parentRequired){parentCandidate=ancestry[0];ancestry=ancestry.slice(1);}else{parentCandidate=parentRequired;}}else if(ancestor){parentCandidate=ancestry[0];ancestry=ancestry.slice(1);}else if(!siblings){return elm;}if(parentCandidate){parent=createElement(parentCandidate);parent.appendChild(elm);}if(siblings){if(!parent){parent=dom.create('div');parent.appendChild(elm);}Tools.each(siblings,function(sibling){var siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm);});}return _wrapInHtml(parent,ancestry,parentCandidate&&parentCandidate.siblings);};if(ancestry&&ancestry.length){item=ancestry[0];elm=createElement(item);fragment=dom.create('div');fragment.appendChild(_wrapInHtml(elm,ancestry.slice(1),item.siblings));return fragment;}else{return'';}};var parseSelectorItem=function parseSelectorItem(item){var tagName;var obj={classes:[],attrs:{}};item=obj.selector=Tools.trim(item);if(item!=='*'){tagName=item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g,function($0,$1,$2,$3,$4){switch($1){case'#':obj.attrs.id=$2;break;case'.':obj.classes.push($2);break;case':':if(Tools.inArray('checked disabled enabled read-only required'.split(' '),$2)!==-1){obj.attrs[$2]=$2;}break;}if($3==='['){var m=$4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);if(m){obj.attrs[m[1]]=m[2];}}return'';});}obj.name=tagName||'div';return obj;};var parseSelector=function parseSelector(selector){if(!selector||typeof selector!=='string'){return[];}selector=selector.split(/\\s*,\\s*/)[0];selector=selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g,'$1');return Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/),function(item){var siblings=Tools.map(item.split(/(?:~\\+|~|\\+)/),parseSelectorItem);var obj=siblings.pop();if(siblings.length){obj.siblings=siblings;}return obj;}).reverse();};var getCssText=function getCssText(editor,format){var name,previewFrag;var previewCss='',parentFontSize;var previewStyles=getPreviewStyles(editor);if(previewStyles===''){return'';}var removeVars=function removeVars(val){return val.replace(/%(\\w+)/g,'');};if(typeof format==='string'){format=editor.formatter.get(format);if(!format){return;}format=format[0];}if('preview'in format){var previewOpt=get$9(format,'preview');if(is$1(previewOpt,false)){return'';}else{previewStyles=previewOpt.getOr(previewStyles);}}name=format.block||format.inline||'span';var items=parseSelector(format.selector);if(items.length){if(!items[0].name){items[0].name=name;}name=format.selector;previewFrag=parsedSelectorToHtml(items,editor);}else{previewFrag=parsedSelectorToHtml([name],editor);}var previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild;each$5(format.styles,function(value,name){var newValue=removeVars(value);if(newValue){dom.setStyle(previewElm,name,newValue);}});each$5(format.attributes,function(value,name){var newValue=removeVars(value);if(newValue){dom.setAttrib(previewElm,name,newValue);}});each$5(format.classes,function(value){var newValue=removeVars(value);if(!dom.hasClass(previewElm,newValue)){dom.addClass(previewElm,newValue);}});editor.fire('PreviewFormats');dom.setStyles(previewFrag,{position:'absolute',left:-65535});editor.getBody().appendChild(previewFrag);parentFontSize=dom.getStyle(editor.getBody(),'fontSize',true);parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0;each$5(previewStyles.split(' '),function(name){var value=dom.getStyle(previewElm,name,true);if(name==='background-color'&&/transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)){value=dom.getStyle(editor.getBody(),name,true);if(dom.toHex(value).toLowerCase()==='#ffffff'){return;}}if(name==='color'){if(dom.toHex(value).toLowerCase()==='#000000'){return;}}if(name==='font-size'){if(/em|%$/.test(value)){if(parentFontSize===0){return;}var numValue=parseFloat(value)/(/%$/.test(value)?100:1);value=numValue*parentFontSize+'px';}}if(name==='border'&&value){previewCss+='padding:0 2px;';}previewCss+=name+':'+value+';';});editor.fire('AfterPreviewFormats');dom.remove(previewFrag);return previewCss;};var setup$h=function setup$h(editor){editor.addShortcut('meta+b','','Bold');editor.addShortcut('meta+i','','Italic');editor.addShortcut('meta+u','','Underline');for(var i=1;i<=6;i++){editor.addShortcut('access+'+i,'',['FormatBlock',false,'h'+i]);}editor.addShortcut('access+7','',['FormatBlock',false,'p']);editor.addShortcut('access+8','',['FormatBlock',false,'div']);editor.addShortcut('access+9','',['FormatBlock',false,'address']);};var Formatter=function Formatter(editor){var formats=FormatRegistry(editor);var formatChangeState=Cell(null);setup$h(editor);setup$k(editor);return{get:formats.get,has:formats.has,register:formats.register,unregister:formats.unregister,apply:function apply(name,vars,node){applyFormat(editor,name,vars,node);},remove:function remove(name,vars,node,similar){removeFormat(editor,name,vars,node,similar);},toggle:function toggle(name,vars,node){toggleFormat(editor,name,vars,node);},match:function match(name,vars,node,similar){return matchFormat(editor,name,vars,node,similar);},closest:function closest(names){return closestFormat(editor,names);},matchAll:function matchAll(names,vars){return matchAllFormats(editor,names,vars);},matchNode:function matchNode(node,name,vars,similar){return matchNodeFormat(editor,node,name,vars,similar);},canApply:function canApply(name){return canApplyFormat(editor,name);},formatChanged:function formatChanged(formats,callback,similar,vars){return _formatChanged(editor,formatChangeState,formats,callback,similar,vars);},getCssText:curry(getCssText,editor)};};var shouldIgnoreCommand=function shouldIgnoreCommand(cmd){switch(cmd.toLowerCase()){case'undo':case'redo':case'mcerepaint':case'mcefocus':return true;default:return false;}};var registerEvents=function registerEvents(editor,undoManager,locks){var isFirstTypedCharacter=Cell(false);var addNonTypingUndoLevel=function addNonTypingUndoLevel(e){setTyping(undoManager,false,locks);undoManager.add({},e);};editor.on('init',function(){undoManager.add();});editor.on('BeforeExecCommand',function(e){var cmd=e.command;if(!shouldIgnoreCommand(cmd)){endTyping(undoManager,locks);undoManager.beforeChange();}});editor.on('ExecCommand',function(e){var cmd=e.command;if(!shouldIgnoreCommand(cmd)){addNonTypingUndoLevel(e);}});editor.on('ObjectResizeStart cut',function(){undoManager.beforeChange();});editor.on('SaveContent ObjectResized blur',addNonTypingUndoLevel);editor.on('dragend',addNonTypingUndoLevel);editor.on('keyup',function(e){var keyCode=e.keyCode;if(e.isDefaultPrevented()){return;}if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||keyCode===45||e.ctrlKey){addNonTypingUndoLevel();editor.nodeChanged();}if(keyCode===46||keyCode===8){editor.nodeChanged();}if(isFirstTypedCharacter.get()&&undoManager.typing&&isEq$1(createFromEditor(editor),undoManager.data[0])===false){if(editor.isDirty()===false){editor.setDirty(true);editor.fire('change',{level:undoManager.data[0],lastLevel:null});}editor.fire('TypingUndo');isFirstTypedCharacter.set(false);editor.nodeChanged();}});editor.on('keydown',function(e){var keyCode=e.keyCode;if(e.isDefaultPrevented()){return;}if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||keyCode===45){if(undoManager.typing){addNonTypingUndoLevel(e);}return;}var modKey=e.ctrlKey&&!e.altKey||e.metaKey;if((keyCode<16||keyCode>20)&&keyCode!==224&&keyCode!==91&&!undoManager.typing&&!modKey){undoManager.beforeChange();setTyping(undoManager,true,locks);undoManager.add({},e);isFirstTypedCharacter.set(true);}});editor.on('mousedown',function(e){if(undoManager.typing){addNonTypingUndoLevel(e);}});var isInsertReplacementText=function isInsertReplacementText(event){return event.inputType==='insertReplacementText';};var isInsertTextDataNull=function isInsertTextDataNull(event){return event.inputType==='insertText'&&event.data===null;};var isInsertFromPasteOrDrop=function isInsertFromPasteOrDrop(event){return event.inputType==='insertFromPaste'||event.inputType==='insertFromDrop';};editor.on('input',function(e){if(e.inputType&&(isInsertReplacementText(e)||isInsertTextDataNull(e)||isInsertFromPasteOrDrop(e))){addNonTypingUndoLevel(e);}});editor.on('AddUndo Undo Redo ClearUndos',function(e){if(!e.isDefaultPrevented()){editor.nodeChanged();}});};var addKeyboardShortcuts=function addKeyboardShortcuts(editor){editor.addShortcut('meta+z','','Undo');editor.addShortcut('meta+y,meta+shift+z','','Redo');};var UndoManager=function UndoManager(editor){var beforeBookmark=value();var locks=Cell(0);var index=Cell(0);var undoManager={data:[],typing:false,beforeChange:function beforeChange(){_beforeChange(editor,locks,beforeBookmark);},add:function add(level,event){return addUndoLevel(editor,undoManager,index,locks,beforeBookmark,level,event);},undo:function undo(){return _undo(editor,undoManager,locks,index);},redo:function redo(){return _redo(editor,index,undoManager.data);},clear:function clear(){_clear(editor,undoManager,index);},reset:function reset(){_reset(editor,undoManager);},hasUndo:function hasUndo(){return _hasUndo(editor,undoManager,index);},hasRedo:function hasRedo(){return _hasRedo(editor,undoManager,index);},transact:function transact(callback){return _transact(editor,undoManager,locks,callback);},ignore:function ignore(callback){_ignore(editor,locks,callback);},extra:function extra(callback1,callback2){_extra(editor,undoManager,index,callback1,callback2);}};if(!isRtc(editor)){registerEvents(editor,undoManager,locks);}addKeyboardShortcuts(editor);return undoManager;};var nonTypingKeycodes=[9,27,VK.HOME,VK.END,19,20,44,144,145,33,34,45,16,17,18,91,92,93,VK.DOWN,VK.UP,VK.LEFT,VK.RIGHT].concat(Env.browser.isFirefox()?[224]:[]);var placeholderAttr='data-mce-placeholder';var isKeyboardEvent=function isKeyboardEvent(e){return e.type==='keydown'||e.type==='keyup';};var isDeleteEvent=function isDeleteEvent(e){var keyCode=e.keyCode;return keyCode===VK.BACKSPACE||keyCode===VK.DELETE;};var isNonTypingKeyboardEvent=function isNonTypingKeyboardEvent(e){if(isKeyboardEvent(e)){var keyCode=e.keyCode;return!isDeleteEvent(e)&&(VK.metaKeyPressed(e)||e.altKey||keyCode>=112&&keyCode<=123||contains$3(nonTypingKeycodes,keyCode));}else{return false;}};var isTypingKeyboardEvent=function isTypingKeyboardEvent(e){return isKeyboardEvent(e)&&!(isDeleteEvent(e)||e.type==='keyup'&&e.keyCode===229);};var isVisuallyEmpty=function isVisuallyEmpty(dom,rootElm,forcedRootBlock){if(isEmpty$2(SugarElement.fromDom(rootElm),false)){var isForcedRootBlockFalse=forcedRootBlock==='';var firstElement=rootElm.firstElementChild;if(!firstElement){return true;}else if(dom.getStyle(rootElm.firstElementChild,'padding-left')||dom.getStyle(rootElm.firstElementChild,'padding-right')){return false;}else{return isForcedRootBlockFalse?!dom.isBlock(firstElement):forcedRootBlock===firstElement.nodeName.toLowerCase();}}else{return false;}};var setup$g=function setup$g(editor){var dom=editor.dom;var rootBlock=getForcedRootBlock(editor);var placeholder=getPlaceholder(editor);var _updatePlaceholder=function updatePlaceholder(e,initial){if(isNonTypingKeyboardEvent(e)){return;}var body=editor.getBody();var showPlaceholder=isTypingKeyboardEvent(e)?false:isVisuallyEmpty(dom,body,rootBlock);var isPlaceholderShown=dom.getAttrib(body,placeholderAttr)!=='';if(isPlaceholderShown!==showPlaceholder||initial){dom.setAttrib(body,placeholderAttr,showPlaceholder?placeholder:null);dom.setAttrib(body,'aria-placeholder',showPlaceholder?placeholder:null);firePlaceholderToggle(editor,showPlaceholder);editor.on(showPlaceholder?'keydown':'keyup',_updatePlaceholder);editor.off(showPlaceholder?'keyup':'keydown',_updatePlaceholder);}};if(placeholder){editor.on('init',function(e){_updatePlaceholder(e,true);editor.on('change SetContent ExecCommand',_updatePlaceholder);editor.on('paste',function(e){return Delay.setEditorTimeout(editor,function(){return _updatePlaceholder(e);});});});}};var strongRtl=/[\\u0591-\\u07FF\\uFB1D-\\uFDFF\\uFE70-\\uFEFC]/;var hasStrongRtl=function hasStrongRtl(text){return strongRtl.test(text);};var isInlineTarget=function isInlineTarget(editor,elm){return is$2(SugarElement.fromDom(elm),getInlineBoundarySelector(editor));};var isRtl=function isRtl(element){return _DOMUtils.DOM.getStyle(element,'direction',true)==='rtl'||hasStrongRtl(element.textContent);};var findInlineParents=function findInlineParents(isInlineTarget,rootNode,pos){return filter$4(_DOMUtils.DOM.getParents(pos.container(),'*',rootNode),isInlineTarget);};var findRootInline=function findRootInline(isInlineTarget,rootNode,pos){var parents=findInlineParents(isInlineTarget,rootNode,pos);return Optional.from(parents[parents.length-1]);};var hasSameParentBlock=function hasSameParentBlock(rootNode,node1,node2){var block1=getParentBlock$2(node1,rootNode);var block2=getParentBlock$2(node2,rootNode);return block1&&block1===block2;};var isAtZwsp=function isAtZwsp(pos){return isBeforeInline(pos)||isAfterInline(pos);};var normalizePosition=function normalizePosition(forward,pos){if(!pos){return pos;}var container=pos.container(),offset=pos.offset();if(forward){if(isCaretContainerInline(container)){if(isText$7(container.nextSibling)){return _CaretPosition(container.nextSibling,0);}else{return _CaretPosition.after(container);}}else{return isBeforeInline(pos)?_CaretPosition(container,offset+1):pos;}}else{if(isCaretContainerInline(container)){if(isText$7(container.previousSibling)){return _CaretPosition(container.previousSibling,container.previousSibling.data.length);}else{return _CaretPosition.before(container);}}else{return isAfterInline(pos)?_CaretPosition(container,offset-1):pos;}}};var normalizeForwards=curry(normalizePosition,true);var normalizeBackwards=curry(normalizePosition,false);var isBeforeRoot=function isBeforeRoot(rootNode){return function(elm){return eq(rootNode,SugarElement.fromDom(elm.dom.parentNode));};};var isTextBlockOrListItem=function isTextBlockOrListItem(element){return isTextBlock$2(element)||isListItem(element);};var getParentBlock$1=function getParentBlock$1(rootNode,elm){if(contains$1(rootNode,elm)){return closest$3(elm,isTextBlockOrListItem,isBeforeRoot(rootNode));}else{return Optional.none();}};var placeCaretInEmptyBody=function placeCaretInEmptyBody(editor){var body=editor.getBody();var node=body.firstChild&&editor.dom.isBlock(body.firstChild)?body.firstChild:body;editor.selection.setCursorLocation(node,0);};var paddEmptyBody=function paddEmptyBody(editor){if(editor.dom.isEmpty(editor.getBody())){editor.setContent('');placeCaretInEmptyBody(editor);}};var willDeleteLastPositionInElement=function willDeleteLastPositionInElement(forward,fromPos,elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(true,firstPos);var normalizedLastPos=normalizePosition(false,lastPos);var normalizedFromPos=normalizePosition(false,fromPos);if(forward){return nextPosition(elm,normalizedFromPos).exists(function(nextPos){return nextPos.isEqual(normalizedLastPos)&&fromPos.isEqual(normalizedFirstPos);});}else{return prevPosition(elm,normalizedFromPos).exists(function(prevPos){return prevPos.isEqual(normalizedFirstPos)&&fromPos.isEqual(normalizedLastPos);});}}).getOr(true);};var blockPosition=function blockPosition(block,position){return{block:block,position:position};};var blockBoundary=function blockBoundary(from,to){return{from:from,to:to};};var getBlockPosition=function getBlockPosition(rootNode,pos){var rootElm=SugarElement.fromDom(rootNode);var containerElm=SugarElement.fromDom(pos.container());return getParentBlock$1(rootElm,containerElm).map(function(block){return blockPosition(block,pos);});};var isDifferentBlocks=function isDifferentBlocks(blockBoundary){return eq(blockBoundary.from.block,blockBoundary.to.block)===false;};var hasSameParent=function hasSameParent(blockBoundary){return parent(blockBoundary.from.block).bind(function(parent1){return parent(blockBoundary.to.block).filter(function(parent2){return eq(parent1,parent2);});}).isSome();};var isEditable$1=function isEditable$1(blockBoundary){return isContentEditableFalse$b(blockBoundary.from.block.dom)===false&&isContentEditableFalse$b(blockBoundary.to.block.dom)===false;};var skipLastBr=function skipLastBr(rootNode,forward,blockPosition){if(isBr$5(blockPosition.position.getNode())&&isEmpty$2(blockPosition.block)===false){return positionIn(false,blockPosition.block.dom).bind(function(lastPositionInBlock){if(lastPositionInBlock.isEqual(blockPosition.position)){return fromPosition(forward,rootNode,lastPositionInBlock).bind(function(to){return getBlockPosition(rootNode,to);});}else{return Optional.some(blockPosition);}}).getOr(blockPosition);}else{return blockPosition;}};var readFromRange=function readFromRange(rootNode,forward,rng){var fromBlockPos=getBlockPosition(rootNode,_CaretPosition.fromRangeStart(rng));var toBlockPos=fromBlockPos.bind(function(blockPos){return fromPosition(forward,rootNode,blockPos.position).bind(function(to){return getBlockPosition(rootNode,to).map(function(blockPos){return skipLastBr(rootNode,forward,blockPos);});});});return lift2(fromBlockPos,toBlockPos,blockBoundary).filter(function(blockBoundary){return isDifferentBlocks(blockBoundary)&&hasSameParent(blockBoundary)&&isEditable$1(blockBoundary);});};var read$1=function read$1(rootNode,forward,rng){return rng.collapsed?readFromRange(rootNode,forward,rng):Optional.none();};var getChildrenUntilBlockBoundary=function getChildrenUntilBlockBoundary(block){var children$1=children(block);return findIndex$2(children$1,isBlock$2).fold(constant(children$1),function(index){return children$1.slice(0,index);});};var extractChildren=function extractChildren(block){var children=getChildrenUntilBlockBoundary(block);each$k(children,remove$7);return children;};var removeEmptyRoot=function removeEmptyRoot(rootNode,block){var parents=parentsAndSelf(block,rootNode);return find$3(parents.reverse(),function(element){return isEmpty$2(element);}).each(remove$7);};var isEmptyBefore=function isEmptyBefore(el){return filter$4(prevSiblings(el),function(el){return!isEmpty$2(el);}).length===0;};var nestedBlockMerge=function nestedBlockMerge(rootNode,fromBlock,toBlock,insertionPoint){if(isEmpty$2(toBlock)){fillWithPaddingBr(toBlock);return firstPositionIn(toBlock.dom);}if(isEmptyBefore(insertionPoint)&&isEmpty$2(fromBlock)){before$4(insertionPoint,SugarElement.fromTag('br'));}var position=prevPosition(toBlock.dom,_CaretPosition.before(insertionPoint.dom));each$k(extractChildren(fromBlock),function(child){before$4(insertionPoint,child);});removeEmptyRoot(rootNode,fromBlock);return position;};var sidelongBlockMerge=function sidelongBlockMerge(rootNode,fromBlock,toBlock){if(isEmpty$2(toBlock)){remove$7(toBlock);if(isEmpty$2(fromBlock)){fillWithPaddingBr(fromBlock);}return firstPositionIn(fromBlock.dom);}var position=lastPositionIn(toBlock.dom);each$k(extractChildren(fromBlock),function(child){append$1(toBlock,child);});removeEmptyRoot(rootNode,fromBlock);return position;};var findInsertionPoint=function findInsertionPoint(toBlock,block){var parentsAndSelf$1=parentsAndSelf(block,toBlock);return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length-1]);};var getInsertionPoint=function getInsertionPoint(fromBlock,toBlock){return contains$1(toBlock,fromBlock)?findInsertionPoint(toBlock,fromBlock):Optional.none();};var trimBr=function trimBr(first,block){positionIn(first,block.dom).map(function(position){return position.getNode();}).map(SugarElement.fromDom).filter(isBr$4).each(remove$7);};var mergeBlockInto=function mergeBlockInto(rootNode,fromBlock,toBlock){trimBr(true,fromBlock);trimBr(false,toBlock);return getInsertionPoint(fromBlock,toBlock).fold(curry(sidelongBlockMerge,rootNode,fromBlock,toBlock),curry(nestedBlockMerge,rootNode,fromBlock,toBlock));};var mergeBlocks=function mergeBlocks(rootNode,forward,block1,block2){return forward?mergeBlockInto(rootNode,block2,block1):mergeBlockInto(rootNode,block1,block2);};var backspaceDelete$8=function backspaceDelete$8(editor,forward){var rootNode=SugarElement.fromDom(editor.getBody());var position=read$1(rootNode.dom,forward,editor.selection.getRng()).bind(function(blockBoundary){return mergeBlocks(rootNode,forward,blockBoundary.from.block,blockBoundary.to.block);});position.each(function(pos){editor.selection.setRng(pos.toRange());});return position.isSome();};var deleteRangeMergeBlocks=function deleteRangeMergeBlocks(rootNode,selection){var rng=selection.getRng();return lift2(getParentBlock$1(rootNode,SugarElement.fromDom(rng.startContainer)),getParentBlock$1(rootNode,SugarElement.fromDom(rng.endContainer)),function(block1,block2){if(eq(block1,block2)===false){rng.deleteContents();mergeBlocks(rootNode,true,block1,block2).each(function(pos){selection.setRng(pos.toRange());});return true;}else{return false;}}).getOr(false);};var isRawNodeInTable=function isRawNodeInTable(root,rawNode){var node=SugarElement.fromDom(rawNode);var isRoot=curry(eq,root);return ancestor$3(node,isTableCell$4,isRoot).isSome();};var isSelectionInTable=function isSelectionInTable(root,rng){return isRawNodeInTable(root,rng.startContainer)||isRawNodeInTable(root,rng.endContainer);};var isEverythingSelected=function isEverythingSelected(root,rng){var noPrevious=prevPosition(root.dom,_CaretPosition.fromRangeStart(rng)).isNone();var noNext=nextPosition(root.dom,_CaretPosition.fromRangeEnd(rng)).isNone();return!isSelectionInTable(root,rng)&&noPrevious&&noNext;};var emptyEditor=function emptyEditor(editor){editor.setContent('');editor.selection.setCursorLocation();return true;};var deleteRange$1=function deleteRange$1(editor){var rootNode=SugarElement.fromDom(editor.getBody());var rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)?emptyEditor(editor):deleteRangeMergeBlocks(rootNode,editor.selection);};var backspaceDelete$7=function backspaceDelete$7(editor,_forward){return editor.selection.isCollapsed()?false:deleteRange$1(editor);};var isContentEditableTrue$2=isContentEditableTrue$4;var isContentEditableFalse$4=isContentEditableFalse$b;var showCaret=function showCaret(direction,editor,node,before,scrollIntoView){return Optional.from(editor._selectionOverrides.showCaret(direction,node,before,scrollIntoView));};var getNodeRange=function getNodeRange(node){var rng=node.ownerDocument.createRange();rng.selectNode(node);return rng;};var selectNode=function selectNode(editor,node){var e=editor.fire('BeforeObjectSelected',{target:node});if(e.isDefaultPrevented()){return Optional.none();}return Optional.some(getNodeRange(node));};var renderCaretAtRange=function renderCaretAtRange(editor,range,scrollIntoView){var normalizedRange=normalizeRange(1,editor.getBody(),range);var caretPosition=_CaretPosition.fromRangeStart(normalizedRange);var caretPositionNode=caretPosition.getNode();if(isInlineFakeCaretTarget(caretPositionNode)){return showCaret(1,editor,caretPositionNode,!caretPosition.isAtEnd(),false);}var caretPositionBeforeNode=caretPosition.getNode(true);if(isInlineFakeCaretTarget(caretPositionBeforeNode)){return showCaret(1,editor,caretPositionBeforeNode,false,false);}var ceRoot=editor.dom.getParent(caretPosition.getNode(),function(node){return isContentEditableFalse$4(node)||isContentEditableTrue$2(node);});if(isInlineFakeCaretTarget(ceRoot)){return showCaret(1,editor,ceRoot,false,scrollIntoView);}return Optional.none();};var renderRangeCaret=function renderRangeCaret(editor,range,scrollIntoView){return range.collapsed?renderCaretAtRange(editor,range,scrollIntoView).getOr(range):range;};var isBeforeBoundary=function isBeforeBoundary(pos){return isBeforeContentEditableFalse(pos)||isBeforeMedia(pos);};var isAfterBoundary=function isAfterBoundary(pos){return isAfterContentEditableFalse(pos)||isAfterMedia(pos);};var trimEmptyTextNode=function trimEmptyTextNode(dom,node){if(isText$7(node)&&node.data.length===0){dom.remove(node);}};var deleteContentAndShowCaret=function deleteContentAndShowCaret(editor,range,node,direction,forward,peekCaretPosition){showCaret(direction,editor,peekCaretPosition.getNode(!forward),forward,true).each(function(caretRange){if(range.collapsed){var deleteRange=range.cloneRange();if(forward){deleteRange.setEnd(caretRange.startContainer,caretRange.startOffset);}else{deleteRange.setStart(caretRange.endContainer,caretRange.endOffset);}deleteRange.deleteContents();}else{range.deleteContents();}editor.selection.setRng(caretRange);});trimEmptyTextNode(editor.dom,node);return true;};var deleteBoundaryText=function deleteBoundaryText(editor,forward){var range=editor.selection.getRng();if(!isText$7(range.commonAncestorContainer)){return false;}var direction=forward?HDirection.Forwards:HDirection.Backwards;var caretWalker=CaretWalker(editor.getBody());var getNextPosFn=curry(getVisualCaretPosition,forward?caretWalker.next:caretWalker.prev);var isBeforeFn=forward?isBeforeBoundary:isAfterBoundary;var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);var nextCaretPosition=normalizePosition(forward,getNextPosFn(caretPosition));if(!nextCaretPosition||!isMoveInsideSameBlock(caretPosition,nextCaretPosition)){return false;}else if(isBeforeFn(nextCaretPosition)){return deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,nextCaretPosition);}var peekCaretPosition=getNextPosFn(nextCaretPosition);if(peekCaretPosition&&isBeforeFn(peekCaretPosition)){if(isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition)){return deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,peekCaretPosition);}}return false;};var backspaceDelete$6=function backspaceDelete$6(editor,forward){return deleteBoundaryText(editor,forward);};var isCompoundElement=function isCompoundElement(node){return isTableCell$4(SugarElement.fromDom(node))||isListItem(SugarElement.fromDom(node));};var DeleteAction=Adt.generate([{remove:['element']},{moveToElement:['element']},{moveToPosition:['position']}]);var isAtContentEditableBlockCaret=function isAtContentEditableBlockCaret(forward,from){var elm=from.getNode(forward===false);var caretLocation=forward?'after':'before';return isElement$5(elm)&&elm.getAttribute('data-mce-caret')===caretLocation;};var isDeleteFromCefDifferentBlocks=function isDeleteFromCefDifferentBlocks(root,forward,from,to){var inSameBlock=function inSameBlock(elm){return isInline$1(SugarElement.fromDom(elm))&&!isInSameBlock(from,to,root);};return getRelativeCefElm(!forward,from).fold(function(){return getRelativeCefElm(forward,to).fold(never,inSameBlock);},inSameBlock);};var deleteEmptyBlockOrMoveToCef=function deleteEmptyBlockOrMoveToCef(root,forward,from,to){var toCefElm=to.getNode(forward===false);return getParentBlock$1(SugarElement.fromDom(root),SugarElement.fromDom(from.getNode())).map(function(blockElm){return isEmpty$2(blockElm)?DeleteAction.remove(blockElm.dom):DeleteAction.moveToElement(toCefElm);}).orThunk(function(){return Optional.some(DeleteAction.moveToElement(toCefElm));});};var findCefPosition=function findCefPosition(root,forward,from){return fromPosition(forward,root,from).bind(function(to){if(isCompoundElement(to.getNode())){return Optional.none();}else if(isDeleteFromCefDifferentBlocks(root,forward,from,to)){return Optional.none();}else if(forward&&isContentEditableFalse$b(to.getNode())){return deleteEmptyBlockOrMoveToCef(root,forward,from,to);}else if(forward===false&&isContentEditableFalse$b(to.getNode(true))){return deleteEmptyBlockOrMoveToCef(root,forward,from,to);}else if(forward&&isAfterContentEditableFalse(from)){return Optional.some(DeleteAction.moveToPosition(to));}else if(forward===false&&isBeforeContentEditableFalse(from)){return Optional.some(DeleteAction.moveToPosition(to));}else{return Optional.none();}});};var getContentEditableBlockAction=function getContentEditableBlockAction(forward,elm){if(forward&&isContentEditableFalse$b(elm.nextSibling)){return Optional.some(DeleteAction.moveToElement(elm.nextSibling));}else if(forward===false&&isContentEditableFalse$b(elm.previousSibling)){return Optional.some(DeleteAction.moveToElement(elm.previousSibling));}else{return Optional.none();}};var skipMoveToActionFromInlineCefToContent=function skipMoveToActionFromInlineCefToContent(root,from,deleteAction){return deleteAction.fold(function(elm){return Optional.some(DeleteAction.remove(elm));},function(elm){return Optional.some(DeleteAction.moveToElement(elm));},function(to){if(isInSameBlock(from,to,root)){return Optional.none();}else{return Optional.some(DeleteAction.moveToPosition(to));}});};var getContentEditableAction=function getContentEditableAction(root,forward,from){if(isAtContentEditableBlockCaret(forward,from)){return getContentEditableBlockAction(forward,from.getNode(forward===false)).fold(function(){return findCefPosition(root,forward,from);},Optional.some);}else{return findCefPosition(root,forward,from).bind(function(deleteAction){return skipMoveToActionFromInlineCefToContent(root,from,deleteAction);});}};var read=function read(root,forward,rng){var normalizedRange=normalizeRange(forward?1:-1,root,rng);var from=_CaretPosition.fromRangeStart(normalizedRange);var rootElement=SugarElement.fromDom(root);if(forward===false&&isAfterContentEditableFalse(from)){return Optional.some(DeleteAction.remove(from.getNode(true)));}else if(forward&&isBeforeContentEditableFalse(from)){return Optional.some(DeleteAction.remove(from.getNode()));}else if(forward===false&&isBeforeContentEditableFalse(from)&&isAfterBr(rootElement,from)){return findPreviousBr(rootElement,from).map(function(br){return DeleteAction.remove(br.getNode());});}else if(forward&&isAfterContentEditableFalse(from)&&isBeforeBr$1(rootElement,from)){return findNextBr(rootElement,from).map(function(br){return DeleteAction.remove(br.getNode());});}else{return getContentEditableAction(root,forward,from);}};var deleteElement$1=function deleteElement$1(editor,forward){return function(element){editor._selectionOverrides.hideFakeCaret();deleteElement$2(editor,forward,SugarElement.fromDom(element));return true;};};var moveToElement=function moveToElement(editor,forward){return function(element){var pos=forward?_CaretPosition.before(element):_CaretPosition.after(element);editor.selection.setRng(pos.toRange());return true;};};var moveToPosition=function moveToPosition(editor){return function(pos){editor.selection.setRng(pos.toRange());return true;};};var getAncestorCe=function getAncestorCe(editor,node){return Optional.from(getContentEditableRoot$1(editor.getBody(),node));};var backspaceDeleteCaret=function backspaceDeleteCaret(editor,forward){var selectedNode=editor.selection.getNode();return getAncestorCe(editor,selectedNode).filter(isContentEditableFalse$b).fold(function(){return read(editor.getBody(),forward,editor.selection.getRng()).exists(function(deleteAction){return deleteAction.fold(deleteElement$1(editor,forward),moveToElement(editor,forward),moveToPosition(editor));});},always);};var deleteOffscreenSelection=function deleteOffscreenSelection(rootElement){each$k(descendants(rootElement,'.mce-offscreen-selection'),remove$7);};var backspaceDeleteRange=function backspaceDeleteRange(editor,forward){var selectedNode=editor.selection.getNode();if(isContentEditableFalse$b(selectedNode)&&!isTableCell$5(selectedNode)){var hasCefAncestor=getAncestorCe(editor,selectedNode.parentNode).filter(isContentEditableFalse$b);return hasCefAncestor.fold(function(){deleteOffscreenSelection(SugarElement.fromDom(editor.getBody()));deleteElement$2(editor,forward,SugarElement.fromDom(editor.selection.getNode()));paddEmptyBody(editor);return true;},always);}return false;};var paddEmptyElement=function paddEmptyElement(editor){var dom=editor.dom,selection=editor.selection;var ceRoot=getContentEditableRoot$1(editor.getBody(),selection.getNode());if(isContentEditableTrue$4(ceRoot)&&dom.isBlock(ceRoot)&&dom.isEmpty(ceRoot)){var br=dom.create('br',{'data-mce-bogus':'1'});dom.setHTML(ceRoot,'');ceRoot.appendChild(br);selection.setRng(_CaretPosition.before(br).toRange());}return true;};var backspaceDelete$5=function backspaceDelete$5(editor,forward){if(editor.selection.isCollapsed()){return backspaceDeleteCaret(editor,forward);}else{return backspaceDeleteRange(editor,forward);}};var deleteCaret$2=function deleteCaret$2(editor,forward){var fromPos=_CaretPosition.fromRangeStart(editor.selection.getRng());return fromPosition(forward,editor.getBody(),fromPos).filter(function(pos){return forward?isBeforeImageBlock(pos):isAfterImageBlock(pos);}).bind(function(pos){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,pos));}).exists(function(elm){editor.selection.select(elm);return true;});};var backspaceDelete$4=function backspaceDelete$4(editor,forward){return editor.selection.isCollapsed()?deleteCaret$2(editor,forward):false;};var isText=isText$7;var startsWithCaretContainer=function startsWithCaretContainer(node){return isText(node)&&node.data[0]===ZWSP$1;};var endsWithCaretContainer=function endsWithCaretContainer(node){return isText(node)&&node.data[node.data.length-1]===ZWSP$1;};var createZwsp=function createZwsp(node){return node.ownerDocument.createTextNode(ZWSP$1);};var insertBefore=function insertBefore(node){if(isText(node.previousSibling)){if(endsWithCaretContainer(node.previousSibling)){return node.previousSibling;}else{node.previousSibling.appendData(ZWSP$1);return node.previousSibling;}}else if(isText(node)){if(startsWithCaretContainer(node)){return node;}else{node.insertData(0,ZWSP$1);return node;}}else{var newNode=createZwsp(node);node.parentNode.insertBefore(newNode,node);return newNode;}};var insertAfter=function insertAfter(node){if(isText(node.nextSibling)){if(startsWithCaretContainer(node.nextSibling)){return node.nextSibling;}else{node.nextSibling.insertData(0,ZWSP$1);return node.nextSibling;}}else if(isText(node)){if(endsWithCaretContainer(node)){return node;}else{node.appendData(ZWSP$1);return node;}}else{var newNode=createZwsp(node);if(node.nextSibling){node.parentNode.insertBefore(newNode,node.nextSibling);}else{node.parentNode.appendChild(newNode);}return newNode;}};var insertInline=function insertInline(before,node){return before?insertBefore(node):insertAfter(node);};var insertInlineBefore=curry(insertInline,true);var insertInlineAfter=curry(insertInline,false);var insertInlinePos=function insertInlinePos(pos,before){if(isText$7(pos.container())){return insertInline(before,pos.container());}else{return insertInline(before,pos.getNode());}};var isPosCaretContainer=function isPosCaretContainer(pos,caret){var caretNode=caret.get();return caretNode&&pos.container()===caretNode&&isCaretContainerInline(caretNode);};var renderCaret=function renderCaret(caret,location){return location.fold(function(element){remove$2(caret.get());var text=insertInlineBefore(element);caret.set(text);return Optional.some(_CaretPosition(text,text.length-1));},function(element){return firstPositionIn(element).map(function(pos){if(!isPosCaretContainer(pos,caret)){remove$2(caret.get());var text=insertInlinePos(pos,true);caret.set(text);return _CaretPosition(text,1);}else{return _CaretPosition(caret.get(),1);}});},function(element){return lastPositionIn(element).map(function(pos){if(!isPosCaretContainer(pos,caret)){remove$2(caret.get());var text=insertInlinePos(pos,false);caret.set(text);return _CaretPosition(text,text.length-1);}else{return _CaretPosition(caret.get(),caret.get().length-1);}});},function(element){remove$2(caret.get());var text=insertInlineAfter(element);caret.set(text);return Optional.some(_CaretPosition(text,1));});};var evaluateUntil=function evaluateUntil(fns,args){for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome()){return result;}}return Optional.none();};var Location=Adt.generate([{before:['element']},{start:['element']},{end:['element']},{after:['element']}]);var rescope$1=function rescope$1(rootNode,node){var parentBlock=getParentBlock$2(node,rootNode);return parentBlock?parentBlock:rootNode;};var before=function before(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos);var scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold(function(){return nextPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map(function(inline){return Location.before(inline);});},Optional.none);};var isNotInsideFormatCaretContainer=function isNotInsideFormatCaretContainer(rootNode,elm){return getParentCaretContainer(rootNode,elm)===null;};var findInsideRootInline=function findInsideRootInline(isInlineTarget,rootNode,pos){return findRootInline(isInlineTarget,rootNode,pos).filter(curry(isNotInsideFormatCaretContainer,rootNode));};var start$1=function start$1(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){var prevPos=prevPosition(inline,nPos);return prevPos.isNone()?Optional.some(Location.start(inline)):Optional.none();});};var end=function end(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){var nextPos=nextPosition(inline,nPos);return nextPos.isNone()?Optional.some(Location.end(inline)):Optional.none();});};var after=function after(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos);var scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold(function(){return prevPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map(function(inline){return Location.after(inline);});},Optional.none);};var isValidLocation=function isValidLocation(location){return isRtl(getElement(location))===false;};var readLocation=function readLocation(isInlineTarget,rootNode,pos){var location=evaluateUntil([before,start$1,end,after],[isInlineTarget,rootNode,pos]);return location.filter(isValidLocation);};var getElement=function getElement(location){return location.fold(identity,identity,identity,identity);};var getName=function getName(location){return location.fold(constant('before'),constant('start'),constant('end'),constant('after'));};var outside=function outside(location){return location.fold(Location.before,Location.before,Location.after,Location.after);};var inside=function inside(location){return location.fold(Location.start,Location.start,Location.end,Location.end);};var isEq=function isEq(location1,location2){return getName(location1)===getName(location2)&&getElement(location1)===getElement(location2);};var betweenInlines=function betweenInlines(forward,isInlineTarget,rootNode,from,to,location){return lift2(findRootInline(isInlineTarget,rootNode,from),findRootInline(isInlineTarget,rootNode,to),function(fromInline,toInline){if(fromInline!==toInline&&hasSameParentBlock(rootNode,fromInline,toInline)){return Location.after(forward?fromInline:toInline);}else{return location;}}).getOr(location);};var skipNoMovement=function skipNoMovement(fromLocation,toLocation){return fromLocation.fold(always,function(fromLocation){return!isEq(fromLocation,toLocation);});};var findLocationTraverse=function findLocationTraverse(forward,isInlineTarget,rootNode,fromLocation,pos){var from=normalizePosition(forward,pos);var to=fromPosition(forward,rootNode,from).map(curry(normalizePosition,forward));var location=to.fold(function(){return fromLocation.map(outside);},function(to){return readLocation(isInlineTarget,rootNode,to).map(curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(curry(skipNoMovement,fromLocation));});return location.filter(isValidLocation);};var findLocationSimple=function findLocationSimple(forward,location){if(forward){return location.fold(compose(Optional.some,Location.start),Optional.none,compose(Optional.some,Location.after),Optional.none);}else{return location.fold(Optional.none,compose(Optional.some,Location.before),Optional.none,compose(Optional.some,Location.end));}};var findLocation$1=function findLocation$1(forward,isInlineTarget,rootNode,pos){var from=normalizePosition(forward,pos);var fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(curry(findLocationSimple,forward)).orThunk(function(){return findLocationTraverse(forward,isInlineTarget,rootNode,fromLocation,pos);});};curry(findLocation$1,false);curry(findLocation$1,true);var hasSelectionModifyApi=function hasSelectionModifyApi(editor){return isFunction(editor.selection.getSel().modify);};var moveRel=function moveRel(forward,selection,pos){var delta=forward?1:-1;selection.setRng(_CaretPosition(pos.container(),pos.offset()+delta).toRange());selection.getSel().modify('move',forward?'forward':'backward','word');return true;};var moveByWord=function moveByWord(forward,editor){var rng=editor.selection.getRng();var pos=forward?_CaretPosition.fromRangeEnd(rng):_CaretPosition.fromRangeStart(rng);if(!hasSelectionModifyApi(editor)){return false;}else if(forward&&isBeforeInline(pos)){return moveRel(true,editor.selection,pos);}else if(!forward&&isAfterInline(pos)){return moveRel(false,editor.selection,pos);}else{return false;}};var BreakType;(function(BreakType){BreakType[BreakType['Br']=0]='Br';BreakType[BreakType['Block']=1]='Block';BreakType[BreakType['Wrap']=2]='Wrap';BreakType[BreakType['Eol']=3]='Eol';})(BreakType||(BreakType={}));var flip=function flip(direction,positions){return direction===HDirection.Backwards?reverse(positions):positions;};var walk=function walk(direction,caretWalker,pos){return direction===HDirection.Forwards?caretWalker.next(pos):caretWalker.prev(pos);};var getBreakType=function getBreakType(scope,direction,currentPos,nextPos){if(isBr$5(nextPos.getNode(direction===HDirection.Forwards))){return BreakType.Br;}else if(isInSameBlock(currentPos,nextPos)===false){return BreakType.Block;}else{return BreakType.Wrap;}};var getPositionsUntil=function getPositionsUntil(predicate,direction,scope,start){var caretWalker=CaretWalker(scope);var currentPos=start;var positions=[];while(currentPos){var nextPos=walk(direction,caretWalker,currentPos);if(!nextPos){break;}if(isBr$5(nextPos.getNode(false))){if(direction===HDirection.Forwards){return{positions:flip(direction,positions).concat([nextPos]),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};}else{return{positions:flip(direction,positions),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};}}if(!nextPos.isVisible()){currentPos=nextPos;continue;}if(predicate(currentPos,nextPos)){var breakType=getBreakType(scope,direction,currentPos,nextPos);return{positions:flip(direction,positions),breakType:breakType,breakAt:Optional.some(nextPos)};}positions.push(nextPos);currentPos=nextPos;}return{positions:flip(direction,positions),breakType:BreakType.Eol,breakAt:Optional.none()};};var getAdjacentLinePositions=function getAdjacentLinePositions(direction,getPositionsUntilBreak,scope,start){return getPositionsUntilBreak(scope,start).breakAt.map(function(pos){var positions=getPositionsUntilBreak(scope,pos).positions;return direction===HDirection.Backwards?positions.concat(pos):[pos].concat(positions);}).getOr([]);};var findClosestHorizontalPositionFromPoint=function findClosestHorizontalPositionFromPoint(positions,x){return foldl(positions,function(acc,newPos){return acc.fold(function(){return Optional.some(newPos);},function(lastPos){return lift2(head(lastPos.getClientRects()),head(newPos.getClientRects()),function(lastRect,newRect){var lastDist=Math.abs(x-lastRect.left);var newDist=Math.abs(x-newRect.left);return newDist<=lastDist?newPos:lastPos;}).or(acc);});},Optional.none());};var findClosestHorizontalPosition=function findClosestHorizontalPosition(positions,pos){return head(pos.getClientRects()).bind(function(targetRect){return findClosestHorizontalPositionFromPoint(positions,targetRect.left);});};var getPositionsUntilPreviousLine=curry(getPositionsUntil,_CaretPosition.isAbove,-1);var getPositionsUntilNextLine=curry(getPositionsUntil,_CaretPosition.isBelow,1);var getPositionsAbove=curry(getAdjacentLinePositions,-1,getPositionsUntilPreviousLine);var getPositionsBelow=curry(getAdjacentLinePositions,1,getPositionsUntilNextLine);var isAtFirstLine=function isAtFirstLine(scope,pos){return getPositionsUntilPreviousLine(scope,pos).breakAt.isNone();};var isAtLastLine=function isAtLastLine(scope,pos){return getPositionsUntilNextLine(scope,pos).breakAt.isNone();};var getFirstLinePositions=function getFirstLinePositions(scope){return firstPositionIn(scope).map(function(pos){return[pos].concat(getPositionsUntilNextLine(scope,pos).positions);}).getOr([]);};var getLastLinePositions=function getLastLinePositions(scope){return lastPositionIn(scope).map(function(pos){return getPositionsUntilPreviousLine(scope,pos).positions.concat(pos);}).getOr([]);};var getNodeClientRects=function getNodeClientRects(node){var toArrayWithNode=function toArrayWithNode(clientRects){return map$3(clientRects,function(rect){var clientRect=clone(rect);clientRect.node=node;return clientRect;});};if(isElement$5(node)){return toArrayWithNode(node.getClientRects());}if(isText$7(node)){var rng=node.ownerDocument.createRange();rng.setStart(node,0);rng.setEnd(node,node.data.length);return toArrayWithNode(rng.getClientRects());}};var getClientRects=function getClientRects(nodes){return bind(nodes,getNodeClientRects);};var VDirection;(function(VDirection){VDirection[VDirection['Up']=-1]='Up';VDirection[VDirection['Down']=1]='Down';})(VDirection||(VDirection={}));var findUntil=function findUntil(direction,root,predicateFn,node){while(node=findNode$1(node,direction,isEditableCaretCandidate$1,root)){if(predicateFn(node)){return;}}};var walkUntil$1=function walkUntil$1(direction,isAboveFn,isBeflowFn,root,predicateFn,caretPosition){var line=0;var result=[];var add=function add(node){var clientRects=getClientRects([node]);if(direction===-1){clientRects=clientRects.reverse();}for(var i=0;i<clientRects.length;i++){var clientRect=clientRects[i];if(isBeflowFn(clientRect,targetClientRect)){continue;}if(result.length>0&&isAboveFn(clientRect,last$1(result))){line++;}clientRect.line=line;if(predicateFn(clientRect)){return true;}result.push(clientRect);}};var targetClientRect=last$1(caretPosition.getClientRects());if(!targetClientRect){return result;}var node=caretPosition.getNode();add(node);findUntil(direction,root,add,node);return result;};var aboveLineNumber=function aboveLineNumber(lineNumber,clientRect){return clientRect.line>lineNumber;};var isLineNumber=function isLineNumber(lineNumber,clientRect){return clientRect.line===lineNumber;};var upUntil=curry(walkUntil$1,VDirection.Up,isAbove$1,isBelow$1);var downUntil=curry(walkUntil$1,VDirection.Down,isBelow$1,isAbove$1);var positionsUntil=function positionsUntil(direction,root,predicateFn,node){var caretWalker=CaretWalker(root);var walkFn;var isBelowFn;var isAboveFn;var caretPosition;var result=[];var line=0;var getClientRect=function getClientRect(caretPosition){if(direction===1){return last$1(caretPosition.getClientRects());}return last$1(caretPosition.getClientRects());};if(direction===1){walkFn=caretWalker.next;isBelowFn=isBelow$1;isAboveFn=isAbove$1;caretPosition=_CaretPosition.after(node);}else{walkFn=caretWalker.prev;isBelowFn=isAbove$1;isAboveFn=isBelow$1;caretPosition=_CaretPosition.before(node);}var targetClientRect=getClientRect(caretPosition);do{if(!caretPosition.isVisible()){continue;}var rect=getClientRect(caretPosition);if(isAboveFn(rect,targetClientRect)){continue;}if(result.length>0&&isBelowFn(rect,last$1(result))){line++;}var clientRect=clone(rect);clientRect.position=caretPosition;clientRect.line=line;if(predicateFn(clientRect)){return result;}result.push(clientRect);}while(caretPosition=walkFn(caretPosition));return result;};var isAboveLine=function isAboveLine(lineNumber){return function(clientRect){return aboveLineNumber(lineNumber,clientRect);};};var isLine=function isLine(lineNumber){return function(clientRect){return isLineNumber(lineNumber,clientRect);};};var isContentEditableFalse$3=isContentEditableFalse$b;var findNode=findNode$1;var distanceToRectLeft=function distanceToRectLeft(clientRect,clientX){return Math.abs(clientRect.left-clientX);};var distanceToRectRight=function distanceToRectRight(clientRect,clientX){return Math.abs(clientRect.right-clientX);};var isInsideX=function isInsideX(clientX,clientRect){return clientX>=clientRect.left&&clientX<=clientRect.right;};var isInsideY=function isInsideY(clientY,clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom;};var isNodeClientRect=function isNodeClientRect(rect){return hasNonNullableKey(rect,'node');};var findClosestClientRect=function findClosestClientRect(clientRects,clientX,allowInside){if(allowInside===void 0){allowInside=always;}return reduce(clientRects,function(oldClientRect,clientRect){if(isInsideX(clientX,clientRect)){return allowInside(clientRect)?clientRect:oldClientRect;}if(isInsideX(clientX,oldClientRect)){return allowInside(oldClientRect)?oldClientRect:clientRect;}var oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX));var newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX));if(newDistance===oldDistance&&isNodeClientRect(clientRect)&&isContentEditableFalse$3(clientRect.node)){return clientRect;}if(newDistance<oldDistance){return clientRect;}return oldClientRect;});};var walkUntil=function walkUntil(direction,root,predicateFn,startNode,includeChildren){var node=findNode(startNode,direction,isEditableCaretCandidate$1,root,!includeChildren);do{if(!node||predicateFn(node)){return;}}while(node=findNode(node,direction,isEditableCaretCandidate$1,root));};var findLineNodeRects=function findLineNodeRects(root,targetNodeRect,includeChildren){if(includeChildren===void 0){includeChildren=true;}var clientRects=[];var collect=function collect(checkPosFn,node){var lineRects=filter$4(getClientRects([node]),function(clientRect){return!checkPosFn(clientRect,targetNodeRect);});clientRects=clientRects.concat(lineRects);return lineRects.length===0;};clientRects.push(targetNodeRect);walkUntil(VDirection.Up,root,curry(collect,isAbove$1),targetNodeRect.node,includeChildren);walkUntil(VDirection.Down,root,curry(collect,isBelow$1),targetNodeRect.node,includeChildren);return clientRects;};var getFakeCaretTargets=function getFakeCaretTargets(root){return filter$4(from(root.getElementsByTagName('*')),isFakeCaretTarget);};var caretInfo=function caretInfo(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)};};var closestFakeCaret=function closestFakeCaret(root,clientX,clientY){var fakeTargetNodeRects=getClientRects(getFakeCaretTargets(root));var targetNodeRects=filter$4(fakeTargetNodeRects,curry(isInsideY,clientY));var checkInside=function checkInside(clientRect){return!isTable$3(clientRect.node)&&!isMedia$2(clientRect.node);};var closestNodeRect=findClosestClientRect(targetNodeRects,clientX,checkInside);if(closestNodeRect){var includeChildren=checkInside(closestNodeRect);closestNodeRect=findClosestClientRect(findLineNodeRects(root,closestNodeRect,includeChildren),clientX,checkInside);if(closestNodeRect&&isFakeCaretTarget(closestNodeRect.node)){return caretInfo(closestNodeRect,clientX);}}return null;};var moveToRange=function moveToRange(editor,rng){editor.selection.setRng(rng);scrollRangeIntoView(editor,editor.selection.getRng());};var renderRangeCaretOpt=function renderRangeCaretOpt(editor,range,scrollIntoView){return Optional.some(renderRangeCaret(editor,range,scrollIntoView));};var moveHorizontally=function moveHorizontally(editor,direction,range,isBefore,isAfter,isElement){var forwards=direction===HDirection.Forwards;var caretWalker=CaretWalker(editor.getBody());var getNextPosFn=curry(getVisualCaretPosition,forwards?caretWalker.next:caretWalker.prev);var isBeforeFn=forwards?isBefore:isAfter;if(!range.collapsed){var node=getSelectedNode(range);if(isElement(node)){return showCaret(direction,editor,node,direction===HDirection.Backwards,false);}}var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);if(isBeforeFn(caretPosition)){return selectNode(editor,caretPosition.getNode(!forwards));}var nextCaretPosition=normalizePosition(forwards,getNextPosFn(caretPosition));var rangeIsInContainerBlock=isRangeInCaretContainerBlock(range);if(!nextCaretPosition){return rangeIsInContainerBlock?Optional.some(range):Optional.none();}if(isBeforeFn(nextCaretPosition)){return showCaret(direction,editor,nextCaretPosition.getNode(!forwards),forwards,false);}var peekCaretPosition=getNextPosFn(nextCaretPosition);if(peekCaretPosition&&isBeforeFn(peekCaretPosition)){if(isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition)){return showCaret(direction,editor,peekCaretPosition.getNode(!forwards),forwards,false);}}if(rangeIsInContainerBlock){return renderRangeCaretOpt(editor,nextCaretPosition.toRange(),false);}return Optional.none();};var moveVertically=function moveVertically(editor,direction,range,isBefore,isAfter,isElement){var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);var caretClientRect=last$1(caretPosition.getClientRects());var forwards=direction===VDirection.Down;if(!caretClientRect){return Optional.none();}var walkerFn=forwards?downUntil:upUntil;var linePositions=walkerFn(editor.getBody(),isAboveLine(1),caretPosition);var nextLinePositions=filter$4(linePositions,isLine(1));var clientX=caretClientRect.left;var nextLineRect=findClosestClientRect(nextLinePositions,clientX);if(nextLineRect&&isElement(nextLineRect.node)){var dist1=Math.abs(clientX-nextLineRect.left);var dist2=Math.abs(clientX-nextLineRect.right);return showCaret(direction,editor,nextLineRect.node,dist1<dist2,false);}var currentNode;if(isBefore(caretPosition)){currentNode=caretPosition.getNode();}else if(isAfter(caretPosition)){currentNode=caretPosition.getNode(true);}else{currentNode=getSelectedNode(range);}if(currentNode){var caretPositions=positionsUntil(direction,editor.getBody(),isAboveLine(1),currentNode);var closestNextLineRect=findClosestClientRect(filter$4(caretPositions,isLine(1)),clientX);if(closestNextLineRect){return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),false);}closestNextLineRect=last$1(filter$4(caretPositions,isLine(0)));if(closestNextLineRect){return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),false);}}if(nextLinePositions.length===0){return getLineEndPoint(editor,forwards).filter(forwards?isAfter:isBefore).map(function(pos){return renderRangeCaret(editor,pos.toRange(),false);});}return Optional.none();};var getLineEndPoint=function getLineEndPoint(editor,forward){var rng=editor.selection.getRng();var body=editor.getBody();if(forward){var from=_CaretPosition.fromRangeEnd(rng);var result=getPositionsUntilNextLine(body,from);return last$2(result.positions);}else{var from=_CaretPosition.fromRangeStart(rng);var result=getPositionsUntilPreviousLine(body,from);return head(result.positions);}};var moveToLineEndPoint$3=function moveToLineEndPoint$3(editor,forward,isElementPosition){return getLineEndPoint(editor,forward).filter(isElementPosition).exists(function(pos){editor.selection.setRng(pos.toRange());return true;});};var setCaretPosition=function setCaretPosition(editor,pos){var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset());rng.setEnd(pos.container(),pos.offset());editor.selection.setRng(rng);};var setSelected=function setSelected(state,elm){if(state){elm.setAttribute('data-mce-selected','inline-boundary');}else{elm.removeAttribute('data-mce-selected');}};var renderCaretLocation=function renderCaretLocation(editor,caret,location){return renderCaret(caret,location).map(function(pos){setCaretPosition(editor,pos);return location;});};var findLocation=function findLocation(editor,caret,forward){var rootNode=editor.getBody();var from=_CaretPosition.fromRangeStart(editor.selection.getRng());var isInlineTarget$1=curry(isInlineTarget,editor);var location=findLocation$1(forward,isInlineTarget$1,rootNode,from);return location.bind(function(location){return renderCaretLocation(editor,caret,location);});};var toggleInlines=function toggleInlines(isInlineTarget,dom,elms){var inlineBoundaries=map$3(descendants(SugarElement.fromDom(dom.getRoot()),'*[data-mce-selected=\"inline-boundary\"]'),function(e){return e.dom;});var selectedInlines=filter$4(inlineBoundaries,isInlineTarget);var targetInlines=filter$4(elms,isInlineTarget);each$k(difference(selectedInlines,targetInlines),curry(setSelected,false));each$k(difference(targetInlines,selectedInlines),curry(setSelected,true));};var safeRemoveCaretContainer=function safeRemoveCaretContainer(editor,caret){if(editor.selection.isCollapsed()&&editor.composing!==true&&caret.get()){var pos=_CaretPosition.fromRangeStart(editor.selection.getRng());if(_CaretPosition.isTextPosition(pos)&&isAtZwsp(pos)===false){setCaretPosition(editor,removeAndReposition(caret.get(),pos));caret.set(null);}}};var renderInsideInlineCaret=function renderInsideInlineCaret(isInlineTarget,editor,caret,elms){if(editor.selection.isCollapsed()){var inlines=filter$4(elms,isInlineTarget);each$k(inlines,function(_inline){var pos=_CaretPosition.fromRangeStart(editor.selection.getRng());readLocation(isInlineTarget,editor.getBody(),pos).bind(function(location){return renderCaretLocation(editor,caret,location);});});}};var move$2=function move$2(editor,caret,forward){return isInlineBoundariesEnabled(editor)?findLocation(editor,caret,forward).isSome():false;};var moveWord=function moveWord(forward,editor,_caret){return isInlineBoundariesEnabled(editor)?moveByWord(forward,editor):false;};var setupSelectedState=function setupSelectedState(editor){var caret=Cell(null);var isInlineTarget$1=curry(isInlineTarget,editor);editor.on('NodeChange',function(e){if(isInlineBoundariesEnabled(editor)&&!(Env.browser.isIE()&&e.initial)){toggleInlines(isInlineTarget$1,editor.dom,e.parents);safeRemoveCaretContainer(editor,caret);renderInsideInlineCaret(isInlineTarget$1,editor,caret,e.parents);}});return caret;};var moveNextWord=curry(moveWord,true);var movePrevWord=curry(moveWord,false);var moveToLineEndPoint$2=function moveToLineEndPoint$2(editor,forward,caret){if(isInlineBoundariesEnabled(editor)){var linePoint=getLineEndPoint(editor,forward).getOrThunk(function(){var rng=editor.selection.getRng();return forward?_CaretPosition.fromRangeEnd(rng):_CaretPosition.fromRangeStart(rng);});return readLocation(curry(isInlineTarget,editor),editor.getBody(),linePoint).exists(function(loc){var outsideLoc=outside(loc);return renderCaret(caret,outsideLoc).exists(function(pos){setCaretPosition(editor,pos);return true;});});}else{return false;}};var rangeFromPositions=function rangeFromPositions(from,to){var range=document.createRange();range.setStart(from.container(),from.offset());range.setEnd(to.container(),to.offset());return range;};var hasOnlyTwoOrLessPositionsLeft=function hasOnlyTwoOrLessPositionsLeft(elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(true,firstPos);var normalizedLastPos=normalizePosition(false,lastPos);return nextPosition(elm,normalizedFirstPos).forall(function(pos){return pos.isEqual(normalizedLastPos);});}).getOr(true);};var setCaretLocation=function setCaretLocation(editor,caret){return function(location){return renderCaret(caret,location).exists(function(pos){setCaretPosition(editor,pos);return true;});};};var deleteFromTo=function deleteFromTo(editor,caret,from,to){var rootNode=editor.getBody();var isInlineTarget$1=curry(isInlineTarget,editor);editor.undoManager.ignore(function(){editor.selection.setRng(rangeFromPositions(from,to));editor.execCommand('Delete');readLocation(isInlineTarget$1,rootNode,_CaretPosition.fromRangeStart(editor.selection.getRng())).map(inside).map(setCaretLocation(editor,caret));});editor.nodeChanged();};var rescope=function rescope(rootNode,node){var parentBlock=getParentBlock$2(node,rootNode);return parentBlock?parentBlock:rootNode;};var backspaceDeleteCollapsed=function backspaceDeleteCollapsed(editor,caret,forward,from){var rootNode=rescope(editor.getBody(),from.container());var isInlineTarget$1=curry(isInlineTarget,editor);var fromLocation=readLocation(isInlineTarget$1,rootNode,from);return fromLocation.bind(function(location){if(forward){return location.fold(constant(Optional.some(inside(location))),Optional.none,constant(Optional.some(outside(location))),Optional.none);}else{return location.fold(Optional.none,constant(Optional.some(outside(location))),Optional.none,constant(Optional.some(inside(location))));}}).map(setCaretLocation(editor,caret)).getOrThunk(function(){var toPosition=navigate(forward,rootNode,from);var toLocation=toPosition.bind(function(pos){return readLocation(isInlineTarget$1,rootNode,pos);});return lift2(fromLocation,toLocation,function(){return findRootInline(isInlineTarget$1,rootNode,from).exists(function(elm){if(hasOnlyTwoOrLessPositionsLeft(elm)){deleteElement$2(editor,forward,SugarElement.fromDom(elm));return true;}else{return false;}});}).orThunk(function(){return toLocation.bind(function(_){return toPosition.map(function(to){if(forward){deleteFromTo(editor,caret,from,to);}else{deleteFromTo(editor,caret,to,from);}return true;});});}).getOr(false);});};var backspaceDelete$3=function backspaceDelete$3(editor,caret,forward){if(editor.selection.isCollapsed()&&isInlineBoundariesEnabled(editor)){var from=_CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,from);}return false;};var getParentInlines=function getParentInlines(rootElm,startElm){var parents=parentsAndSelf(startElm,rootElm);return findIndex$2(parents,isBlock$2).fold(constant(parents),function(index){return parents.slice(0,index);});};var hasOnlyOneChild=function hasOnlyOneChild(elm){return childNodesCount(elm)===1;};var deleteLastPosition=function deleteLastPosition(forward,editor,target,parentInlines){var isFormatElement$1=curry(isFormatElement,editor);var formatNodes=map$3(filter$4(parentInlines,isFormatElement$1),function(elm){return elm.dom;});if(formatNodes.length===0){deleteElement$2(editor,forward,target);}else{var pos=replaceWithCaretFormat(target.dom,formatNodes);editor.selection.setRng(pos.toRange());}};var deleteCaret$1=function deleteCaret$1(editor,forward){var rootElm=SugarElement.fromDom(editor.getBody());var startElm=SugarElement.fromDom(editor.selection.getStart());var parentInlines=filter$4(getParentInlines(rootElm,startElm),hasOnlyOneChild);return last$2(parentInlines).exists(function(target){var fromPos=_CaretPosition.fromRangeStart(editor.selection.getRng());if(willDeleteLastPositionInElement(forward,fromPos,target.dom)&&!isEmptyCaretFormatElement(target)){deleteLastPosition(forward,editor,target,parentInlines);return true;}else{return false;}});};var backspaceDelete$2=function backspaceDelete$2(editor,forward){return editor.selection.isCollapsed()?deleteCaret$1(editor,forward):false;};var deleteElement=function deleteElement(editor,forward,element){editor._selectionOverrides.hideFakeCaret();deleteElement$2(editor,forward,SugarElement.fromDom(element));return true;};var deleteCaret=function deleteCaret(editor,forward){var isNearMedia=forward?isBeforeMedia:isAfterMedia;var direction=forward?HDirection.Forwards:HDirection.Backwards;var fromPos=getNormalizedRangeEndPoint(direction,editor.getBody(),editor.selection.getRng());if(isNearMedia(fromPos)){return deleteElement(editor,forward,fromPos.getNode(!forward));}else{return Optional.from(normalizePosition(forward,fromPos)).filter(function(pos){return isNearMedia(pos)&&isMoveInsideSameBlock(fromPos,pos);}).exists(function(pos){return deleteElement(editor,forward,pos.getNode(!forward));});}};var deleteRange=function deleteRange(editor,forward){var selectedNode=editor.selection.getNode();return isMedia$2(selectedNode)?deleteElement(editor,forward,selectedNode):false;};var backspaceDelete$1=function backspaceDelete$1(editor,forward){return editor.selection.isCollapsed()?deleteCaret(editor,forward):deleteRange(editor,forward);};var isEditable=function isEditable(target){return closest$3(target,function(elm){return isContentEditableTrue$4(elm.dom)||isContentEditableFalse$b(elm.dom);}).exists(function(elm){return isContentEditableTrue$4(elm.dom);});};var parseIndentValue=function parseIndentValue(value){var number=parseInt(value,10);return isNaN(number)?0:number;};var getIndentStyleName=function getIndentStyleName(useMargin,element){var indentStyleName=useMargin||isTable$2(element)?'margin':'padding';var suffix=get$5(element,'direction')==='rtl'?'-right':'-left';return indentStyleName+suffix;};var indentElement=function indentElement(dom,command,useMargin,value,unit,element){var indentStyleName=getIndentStyleName(useMargin,SugarElement.fromDom(element));if(command==='outdent'){var styleValue=Math.max(0,parseIndentValue(element.style[indentStyleName])-value);dom.setStyle(element,indentStyleName,styleValue?styleValue+unit:'');}else{var styleValue=parseIndentValue(element.style[indentStyleName])+value+unit;dom.setStyle(element,indentStyleName,styleValue);}};var validateBlocks=function validateBlocks(editor,blocks){return forall(blocks,function(block){var indentStyleName=getIndentStyleName(shouldIndentUseMargin(editor),block);var intentValue=getRaw(block,indentStyleName).map(parseIndentValue).getOr(0);var contentEditable=editor.dom.getContentEditable(block.dom);return contentEditable!=='false'&&intentValue>0;});};var canOutdent=function canOutdent(editor){var blocks=getBlocksToIndent(editor);return!editor.mode.isReadOnly()&&(blocks.length>1||validateBlocks(editor,blocks));};var isListComponent=function isListComponent(el){return isList(el)||isListItem(el);};var parentIsListComponent=function parentIsListComponent(el){return parent(el).exists(isListComponent);};var getBlocksToIndent=function getBlocksToIndent(editor){return filter$4(fromDom$1(editor.selection.getSelectedBlocks()),function(el){return!isListComponent(el)&&!parentIsListComponent(el)&&isEditable(el);});};var handle=function handle(editor,command){var dom=editor.dom,selection=editor.selection,formatter=editor.formatter;var indentation=getIndentation(editor);var indentUnit=/[a-z%]+$/i.exec(indentation)[0];var indentValue=parseInt(indentation,10);var useMargin=shouldIndentUseMargin(editor);var forcedRootBlock=getForcedRootBlock(editor);if(!editor.queryCommandState('InsertUnorderedList')&&!editor.queryCommandState('InsertOrderedList')){if(forcedRootBlock===''&&!dom.getParent(selection.getNode(),dom.isBlock)){formatter.apply('div');}}each$k(getBlocksToIndent(editor),function(block){indentElement(dom,command,useMargin,indentValue,indentUnit,block.dom);});};var backspaceDelete=function backspaceDelete(editor,_forward){if(editor.selection.isCollapsed()&&canOutdent(editor)){var dom=editor.dom;var rng=editor.selection.getRng();var pos=_CaretPosition.fromRangeStart(rng);var block=dom.getParent(rng.startContainer,dom.isBlock);if(block!==null&&isAtStartOfBlock(SugarElement.fromDom(block),pos)){handle(editor,'outdent');return true;}}return false;};var nativeCommand=function nativeCommand(editor,command){editor.getDoc().execCommand(command,false,null);};var deleteCommand=function deleteCommand(editor,caret){if(backspaceDelete(editor)){return;}else if(backspaceDelete$5(editor,false)){return;}else if(backspaceDelete$6(editor,false)){return;}else if(backspaceDelete$3(editor,caret,false)){return;}else if(backspaceDelete$8(editor,false)){return;}else if(backspaceDelete$9(editor)){return;}else if(backspaceDelete$4(editor,false)){return;}else if(backspaceDelete$1(editor,false)){return;}else if(backspaceDelete$7(editor)){return;}else if(backspaceDelete$2(editor,false)){return;}else{nativeCommand(editor,'Delete');paddEmptyBody(editor);}};var forwardDeleteCommand=function forwardDeleteCommand(editor,caret){if(backspaceDelete$5(editor,true)){return;}else if(backspaceDelete$6(editor,true)){return;}else if(backspaceDelete$3(editor,caret,true)){return;}else if(backspaceDelete$8(editor,true)){return;}else if(backspaceDelete$9(editor)){return;}else if(backspaceDelete$4(editor,true)){return;}else if(backspaceDelete$1(editor,true)){return;}else if(backspaceDelete$7(editor)){return;}else if(backspaceDelete$2(editor,true)){return;}else{nativeCommand(editor,'ForwardDelete');}};var setup$f=function setup$f(editor,caret){editor.addCommand('delete',function(){deleteCommand(editor,caret);});editor.addCommand('forwardDelete',function(){forwardDeleteCommand(editor,caret);});};var SIGNIFICANT_MOVE=5;var LONGPRESS_DELAY=400;var getTouch=function getTouch(event){if(event.touches===undefined||event.touches.length!==1){return Optional.none();}return Optional.some(event.touches[0]);};var isFarEnough=function isFarEnough(touch,data){var distX=Math.abs(touch.clientX-data.x);var distY=Math.abs(touch.clientY-data.y);return distX>SIGNIFICANT_MOVE||distY>SIGNIFICANT_MOVE;};var setup$e=function setup$e(editor){var startData=value();var longpressFired=Cell(false);var debounceLongpress=last(function(e){editor.fire('longpress',_assign(_assign({},e),{type:'longpress'}));longpressFired.set(true);},LONGPRESS_DELAY);editor.on('touchstart',function(e){getTouch(e).each(function(touch){debounceLongpress.cancel();var data={x:touch.clientX,y:touch.clientY,target:e.target};debounceLongpress.throttle(e);longpressFired.set(false);startData.set(data);});},true);editor.on('touchmove',function(e){debounceLongpress.cancel();getTouch(e).each(function(touch){startData.on(function(data){if(isFarEnough(touch,data)){startData.clear();longpressFired.set(false);editor.fire('longpresscancel');}});});},true);editor.on('touchend touchcancel',function(e){debounceLongpress.cancel();if(e.type==='touchcancel'){return;}startData.get().filter(function(data){return data.target.isEqualNode(e.target);}).each(function(){if(longpressFired.get()){e.preventDefault();}else{editor.fire('tap',_assign(_assign({},e),{type:'tap'}));}});},true);};var isBlockElement=function isBlockElement(blockElements,node){return has$2(blockElements,node.nodeName);};var isValidTarget=function isValidTarget(blockElements,node){if(isText$7(node)){return true;}else if(isElement$5(node)){return!isBlockElement(blockElements,node)&&!isBookmarkNode$1(node);}else{return false;}};var hasBlockParent=function hasBlockParent(blockElements,root,node){return exists(parents(SugarElement.fromDom(node),SugarElement.fromDom(root)),function(elm){return isBlockElement(blockElements,elm.dom);});};var shouldRemoveTextNode=function shouldRemoveTextNode(blockElements,node){if(isText$7(node)){if(node.nodeValue.length===0){return true;}else if(/^\\s+$/.test(node.nodeValue)&&(!node.nextSibling||isBlockElement(blockElements,node.nextSibling))){return true;}}return false;};var addRootBlocks=function addRootBlocks(editor){var dom=editor.dom,selection=editor.selection;var schema=editor.schema,blockElements=schema.getBlockElements();var node=selection.getStart();var rootNode=editor.getBody();var rootBlockNode,tempNode,wrapped;var forcedRootBlock=getForcedRootBlock(editor);if(!node||!isElement$5(node)||!forcedRootBlock){return;}var rootNodeName=rootNode.nodeName.toLowerCase();if(!schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())||hasBlockParent(blockElements,rootNode,node)){return;}var rng=selection.getRng();var startContainer=rng.startContainer;var startOffset=rng.startOffset;var endContainer=rng.endContainer;var endOffset=rng.endOffset;var restoreSelection=hasFocus(editor);node=rootNode.firstChild;while(node){if(isValidTarget(blockElements,node)){if(shouldRemoveTextNode(blockElements,node)){tempNode=node;node=node.nextSibling;dom.remove(tempNode);continue;}if(!rootBlockNode){rootBlockNode=dom.create(forcedRootBlock,getForcedRootBlockAttrs(editor));node.parentNode.insertBefore(rootBlockNode,node);wrapped=true;}tempNode=node;node=node.nextSibling;rootBlockNode.appendChild(tempNode);}else{rootBlockNode=null;node=node.nextSibling;}}if(wrapped&&restoreSelection){rng.setStart(startContainer,startOffset);rng.setEnd(endContainer,endOffset);selection.setRng(rng);editor.nodeChanged();}};var setup$d=function setup$d(editor){if(getForcedRootBlock(editor)){editor.on('NodeChange',curry(addRootBlocks,editor));}};var findBlockCaretContainer=function findBlockCaretContainer(editor){return descendant(SugarElement.fromDom(editor.getBody()),'*[data-mce-caret]').map(function(elm){return elm.dom;}).getOrNull();};var removeIeControlRect=function removeIeControlRect(editor){editor.selection.setRng(editor.selection.getRng());};var showBlockCaretContainer=function showBlockCaretContainer(editor,blockCaretContainer){if(blockCaretContainer.hasAttribute('data-mce-caret')){showCaretContainerBlock(blockCaretContainer);removeIeControlRect(editor);editor.selection.scrollIntoView(blockCaretContainer);}};var handleBlockContainer=function handleBlockContainer(editor,e){var blockCaretContainer=findBlockCaretContainer(editor);if(!blockCaretContainer){return;}if(e.type==='compositionstart'){e.preventDefault();e.stopPropagation();showBlockCaretContainer(editor,blockCaretContainer);return;}if(hasContent(blockCaretContainer)){showBlockCaretContainer(editor,blockCaretContainer);editor.undoManager.add();}};var setup$c=function setup$c(editor){editor.on('keyup compositionstart',curry(handleBlockContainer,editor));};var isContentEditableFalse$2=isContentEditableFalse$b;var moveToCeFalseHorizontally=function moveToCeFalseHorizontally(direction,editor,range){return moveHorizontally(editor,direction,range,isBeforeContentEditableFalse,isAfterContentEditableFalse,isContentEditableFalse$2);};var moveToCeFalseVertically=function moveToCeFalseVertically(direction,editor,range){var isBefore=function isBefore(caretPosition){return isBeforeContentEditableFalse(caretPosition)||isBeforeTable(caretPosition);};var isAfter=function isAfter(caretPosition){return isAfterContentEditableFalse(caretPosition)||isAfterTable(caretPosition);};return moveVertically(editor,direction,range,isBefore,isAfter,isContentEditableFalse$2);};var createTextBlock=function createTextBlock(editor){var textBlock=editor.dom.create(getForcedRootBlock(editor));if(!Env.ie||Env.ie>=11){textBlock.innerHTML='<br data-mce-bogus=\"1\">';}return textBlock;};var exitPreBlock=function exitPreBlock(editor,direction,range){var caretWalker=CaretWalker(editor.getBody());var getVisualCaretPosition$1=curry(getVisualCaretPosition,direction===1?caretWalker.next:caretWalker.prev);if(range.collapsed&&hasForcedRootBlock(editor)){var pre=editor.dom.getParent(range.startContainer,'PRE');if(!pre){return;}var caretPos=getVisualCaretPosition$1(_CaretPosition.fromRangeStart(range));if(!caretPos){var newBlock=createTextBlock(editor);if(direction===1){editor.$(pre).after(newBlock);}else{editor.$(pre).before(newBlock);}editor.selection.select(newBlock,true);editor.selection.collapse();}}};var getHorizontalRange=function getHorizontalRange(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards;var range=editor.selection.getRng();return moveToCeFalseHorizontally(direction,editor,range).orThunk(function(){exitPreBlock(editor,direction,range);return Optional.none();});};var getVerticalRange=function getVerticalRange(editor,down){var direction=down?1:-1;var range=editor.selection.getRng();return moveToCeFalseVertically(direction,editor,range).orThunk(function(){exitPreBlock(editor,direction,range);return Optional.none();});};var moveH$2=function moveH$2(editor,forward){return getHorizontalRange(editor,forward).exists(function(newRange){moveToRange(editor,newRange);return true;});};var moveV$3=function moveV$3(editor,down){return getVerticalRange(editor,down).exists(function(newRange){moveToRange(editor,newRange);return true;});};var moveToLineEndPoint$1=function moveToLineEndPoint$1(editor,forward){var isCefPosition=forward?isAfterContentEditableFalse:isBeforeContentEditableFalse;return moveToLineEndPoint$3(editor,forward,isCefPosition);};var isTarget=function isTarget(node){return contains$3(['figcaption'],name(node));};var rangeBefore=function rangeBefore(target){var rng=document.createRange();rng.setStartBefore(target.dom);rng.setEndBefore(target.dom);return rng;};var insertElement=function insertElement(root,elm,forward){if(forward){append$1(root,elm);}else{prepend(root,elm);}};var insertBr=function insertBr(root,forward){var br=SugarElement.fromTag('br');insertElement(root,br,forward);return rangeBefore(br);};var insertBlock=function insertBlock(root,forward,blockName,attrs){var block=SugarElement.fromTag(blockName);var br=SugarElement.fromTag('br');setAll$1(block,attrs);append$1(block,br);insertElement(root,block,forward);return rangeBefore(br);};var insertEmptyLine=function insertEmptyLine(root,rootBlockName,attrs,forward){if(rootBlockName===''){return insertBr(root,forward);}else{return insertBlock(root,forward,rootBlockName,attrs);}};var getClosestTargetBlock=function getClosestTargetBlock(pos,root){var isRoot=curry(eq,root);return closest$3(SugarElement.fromDom(pos.container()),isBlock$2,isRoot).filter(isTarget);};var isAtFirstOrLastLine=function isAtFirstOrLastLine(root,forward,pos){return forward?isAtLastLine(root.dom,pos):isAtFirstLine(root.dom,pos);};var moveCaretToNewEmptyLine=function moveCaretToNewEmptyLine(editor,forward){var root=SugarElement.fromDom(editor.getBody());var pos=_CaretPosition.fromRangeStart(editor.selection.getRng());var rootBlock=getForcedRootBlock(editor);var rootBlockAttrs=getForcedRootBlockAttrs(editor);return getClosestTargetBlock(pos,root).exists(function(){if(isAtFirstOrLastLine(root,forward,pos)){var rng=insertEmptyLine(root,rootBlock,rootBlockAttrs,forward);editor.selection.setRng(rng);return true;}else{return false;}});};var moveV$2=function moveV$2(editor,forward){if(editor.selection.isCollapsed()){return moveCaretToNewEmptyLine(editor,forward);}else{return false;}};var defaultPatterns=function defaultPatterns(patterns){return map$3(patterns,function(pattern){return _assign({shiftKey:false,altKey:false,ctrlKey:false,metaKey:false,keyCode:0,action:noop},pattern);});};var matchesEvent=function matchesEvent(pattern,evt){return evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey;};var match$1=function match$1(patterns,evt){return bind(defaultPatterns(patterns),function(pattern){return matchesEvent(pattern,evt)?[pattern]:[];});};var action=function action(f){var x=[];for(var _i=1;_i<arguments.length;_i++){x[_i-1]=arguments[_i];}return function(){return f.apply(null,x);};};var execute=function execute(patterns,evt){return find$3(match$1(patterns,evt),function(pattern){return pattern.action();});};var moveH$1=function moveH$1(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards;var range=editor.selection.getRng();return moveHorizontally(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists(function(newRange){moveToRange(editor,newRange);return true;});};var moveV$1=function moveV$1(editor,down){var direction=down?1:-1;var range=editor.selection.getRng();return moveVertically(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists(function(newRange){moveToRange(editor,newRange);return true;});};var moveToLineEndPoint=function moveToLineEndPoint(editor,forward){var isNearMedia=forward?isAfterMedia:isBeforeMedia;return moveToLineEndPoint$3(editor,forward,isNearMedia);};var deflate=function deflate(rect,delta){return{left:rect.left-delta,top:rect.top-delta,right:rect.right+delta*2,bottom:rect.bottom+delta*2,width:rect.width+delta,height:rect.height+delta};};var getCorners=function getCorners(getYAxisValue,tds){return bind(tds,function(td){var rect=deflate(clone(td.getBoundingClientRect()),-1);return[{x:rect.left,y:getYAxisValue(rect),cell:td},{x:rect.right,y:getYAxisValue(rect),cell:td}];});};var findClosestCorner=function findClosestCorner(corners,x,y){return foldl(corners,function(acc,newCorner){return acc.fold(function(){return Optional.some(newCorner);},function(oldCorner){var oldDist=Math.sqrt(Math.abs(oldCorner.x-x)+Math.abs(oldCorner.y-y));var newDist=Math.sqrt(Math.abs(newCorner.x-x)+Math.abs(newCorner.y-y));return Optional.some(newDist<oldDist?newCorner:oldCorner);});},Optional.none());};var getClosestCell=function getClosestCell(getYAxisValue,isTargetCorner,table,x,y){var cells=descendants(SugarElement.fromDom(table),'td,th,caption').map(function(e){return e.dom;});var corners=filter$4(getCorners(getYAxisValue,cells),function(corner){return isTargetCorner(corner,y);});return findClosestCorner(corners,x,y).map(function(corner){return corner.cell;});};var getBottomValue=function getBottomValue(rect){return rect.bottom;};var getTopValue=function getTopValue(rect){return rect.top;};var isAbove=function isAbove(corner,y){return corner.y<y;};var isBelow=function isBelow(corner,y){return corner.y>y;};var getClosestCellAbove=curry(getClosestCell,getBottomValue,isAbove);var getClosestCellBelow=curry(getClosestCell,getTopValue,isBelow);var findClosestPositionInAboveCell=function findClosestPositionInAboveCell(table,pos){return head(pos.getClientRects()).bind(function(rect){return getClosestCellAbove(table,rect.left,rect.top);}).bind(function(cell){return findClosestHorizontalPosition(getLastLinePositions(cell),pos);});};var findClosestPositionInBelowCell=function findClosestPositionInBelowCell(table,pos){return last$2(pos.getClientRects()).bind(function(rect){return getClosestCellBelow(table,rect.left,rect.top);}).bind(function(cell){return findClosestHorizontalPosition(getFirstLinePositions(cell),pos);});};var hasNextBreak=function hasNextBreak(getPositionsUntil,scope,lineInfo){return lineInfo.breakAt.exists(function(breakPos){return getPositionsUntil(scope,breakPos).breakAt.isSome();});};var startsWithWrapBreak=function startsWithWrapBreak(lineInfo){return lineInfo.breakType===BreakType.Wrap&&lineInfo.positions.length===0;};var startsWithBrBreak=function startsWithBrBreak(lineInfo){return lineInfo.breakType===BreakType.Br&&lineInfo.positions.length===1;};var isAtTableCellLine=function isAtTableCellLine(getPositionsUntil,scope,pos){var lineInfo=getPositionsUntil(scope,pos);if(startsWithWrapBreak(lineInfo)||!isBr$5(pos.getNode())&&startsWithBrBreak(lineInfo)){return!hasNextBreak(getPositionsUntil,scope,lineInfo);}else{return lineInfo.breakAt.isNone();}};var isAtFirstTableCellLine=curry(isAtTableCellLine,getPositionsUntilPreviousLine);var isAtLastTableCellLine=curry(isAtTableCellLine,getPositionsUntilNextLine);var isCaretAtStartOrEndOfTable=function isCaretAtStartOrEndOfTable(forward,rng,table){var caretPos=_CaretPosition.fromRangeStart(rng);return positionIn(!forward,table).exists(function(pos){return pos.isEqual(caretPos);});};var navigateHorizontally=function navigateHorizontally(editor,forward,table,_td){var rng=editor.selection.getRng();var direction=forward?1:-1;if(isFakeCaretTableBrowser()&&isCaretAtStartOrEndOfTable(forward,rng,table)){showCaret(direction,editor,table,!forward,false).each(function(newRng){moveToRange(editor,newRng);});return true;}return false;};var getClosestAbovePosition=function getClosestAbovePosition(root,table,start){return findClosestPositionInAboveCell(table,start).orThunk(function(){return head(start.getClientRects()).bind(function(rect){return findClosestHorizontalPositionFromPoint(getPositionsAbove(root,_CaretPosition.before(table)),rect.left);});}).getOr(_CaretPosition.before(table));};var getClosestBelowPosition=function getClosestBelowPosition(root,table,start){return findClosestPositionInBelowCell(table,start).orThunk(function(){return head(start.getClientRects()).bind(function(rect){return findClosestHorizontalPositionFromPoint(getPositionsBelow(root,_CaretPosition.after(table)),rect.left);});}).getOr(_CaretPosition.after(table));};var getTable=function getTable(previous,pos){var node=pos.getNode(previous);return isElement$5(node)&&node.nodeName==='TABLE'?Optional.some(node):Optional.none();};var renderBlock=function renderBlock(down,editor,table,pos){var forcedRootBlock=getForcedRootBlock(editor);if(forcedRootBlock){editor.undoManager.transact(function(){var element=SugarElement.fromTag(forcedRootBlock);setAll$1(element,getForcedRootBlockAttrs(editor));append$1(element,SugarElement.fromTag('br'));if(down){after$3(SugarElement.fromDom(table),element);}else{before$4(SugarElement.fromDom(table),element);}var rng=editor.dom.createRng();rng.setStart(element.dom,0);rng.setEnd(element.dom,0);moveToRange(editor,rng);});}else{moveToRange(editor,pos.toRange());}};var moveCaret=function moveCaret(editor,down,pos){var table=down?getTable(true,pos):getTable(false,pos);var last=down===false;table.fold(function(){return moveToRange(editor,pos.toRange());},function(table){return positionIn(last,editor.getBody()).filter(function(lastPos){return lastPos.isEqual(pos);}).fold(function(){return moveToRange(editor,pos.toRange());},function(_){return renderBlock(down,editor,table,pos);});});};var navigateVertically=function navigateVertically(editor,down,table,td){var rng=editor.selection.getRng();var pos=_CaretPosition.fromRangeStart(rng);var root=editor.getBody();if(!down&&isAtFirstTableCellLine(td,pos)){var newPos=getClosestAbovePosition(root,table,pos);moveCaret(editor,down,newPos);return true;}else if(down&&isAtLastTableCellLine(td,pos)){var newPos=getClosestBelowPosition(root,table,pos);moveCaret(editor,down,newPos);return true;}else{return false;}};var move$1=function move$1(editor,forward,mover){return Optional.from(editor.dom.getParent(editor.selection.getNode(),'td,th')).bind(function(td){return Optional.from(editor.dom.getParent(td,'table')).map(function(table){return mover(editor,forward,table,td);});}).getOr(false);};var moveH=function moveH(editor,forward){return move$1(editor,forward,navigateHorizontally);};var moveV=function moveV(editor,forward){return move$1(editor,forward,navigateVertically);};var executeKeydownOverride$3=function executeKeydownOverride$3(editor,caret,evt){var os=detect().os;execute([{keyCode:VK.RIGHT,action:action(moveH$2,editor,true)},{keyCode:VK.LEFT,action:action(moveH$2,editor,false)},{keyCode:VK.UP,action:action(moveV$3,editor,false)},{keyCode:VK.DOWN,action:action(moveV$3,editor,true)},{keyCode:VK.RIGHT,action:action(moveH,editor,true)},{keyCode:VK.LEFT,action:action(moveH,editor,false)},{keyCode:VK.UP,action:action(moveV,editor,false)},{keyCode:VK.DOWN,action:action(moveV,editor,true)},{keyCode:VK.RIGHT,action:action(moveH$1,editor,true)},{keyCode:VK.LEFT,action:action(moveH$1,editor,false)},{keyCode:VK.UP,action:action(moveV$1,editor,false)},{keyCode:VK.DOWN,action:action(moveV$1,editor,true)},{keyCode:VK.RIGHT,action:action(move$2,editor,caret,true)},{keyCode:VK.LEFT,action:action(move$2,editor,caret,false)},{keyCode:VK.RIGHT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(moveNextWord,editor,caret)},{keyCode:VK.LEFT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(movePrevWord,editor,caret)},{keyCode:VK.UP,action:action(moveV$2,editor,false)},{keyCode:VK.DOWN,action:action(moveV$2,editor,true)}],evt).each(function(_){evt.preventDefault();});};var setup$b=function setup$b(editor,caret){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride$3(editor,caret,evt);}});};var executeKeydownOverride$2=function executeKeydownOverride$2(editor,caret,evt){execute([{keyCode:VK.BACKSPACE,action:action(backspaceDelete,editor,false)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$5,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$5,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$6,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$6,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$3,editor,caret,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$3,editor,caret,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$9,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$9,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$4,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$4,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$1,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$1,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$7,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$7,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$8,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$8,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$2,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$2,editor,true)}],evt).each(function(_){evt.preventDefault();});};var executeKeyupOverride=function executeKeyupOverride(editor,evt){execute([{keyCode:VK.BACKSPACE,action:action(paddEmptyElement,editor)},{keyCode:VK.DELETE,action:action(paddEmptyElement,editor)}],evt);};var setup$a=function setup$a(editor,caret){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride$2(editor,caret,evt);}});editor.on('keyup',function(evt){if(evt.isDefaultPrevented()===false){executeKeyupOverride(editor,evt);}});};var firstNonWhiteSpaceNodeSibling=function firstNonWhiteSpaceNodeSibling(node){while(node){if(node.nodeType===1||node.nodeType===3&&node.data&&/[\\r\\n\\s]/.test(node.data)){return node;}node=node.nextSibling;}};var moveToCaretPosition=function moveToCaretPosition(editor,root){var node,lastNode=root;var dom=editor.dom;var moveCaretBeforeOnEnterElementsMap=editor.schema.getMoveCaretBeforeOnEnterElements();if(!root){return;}if(/^(LI|DT|DD)$/.test(root.nodeName)){var firstChild=firstNonWhiteSpaceNodeSibling(root.firstChild);if(firstChild&&/^(UL|OL|DL)$/.test(firstChild.nodeName)){root.insertBefore(dom.doc.createTextNode(nbsp),root.firstChild);}}var rng=dom.createRng();root.normalize();if(root.hasChildNodes()){var walker=new DomTreeWalker(root,root);while(node=walker.current()){if(isText$7(node)){rng.setStart(node,0);rng.setEnd(node,0);break;}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node);rng.setEndBefore(node);break;}lastNode=node;node=walker.next();}if(!node){rng.setStart(lastNode,0);rng.setEnd(lastNode,0);}}else{if(isBr$5(root)){if(root.nextSibling&&dom.isBlock(root.nextSibling)){rng.setStartBefore(root);rng.setEndBefore(root);}else{rng.setStartAfter(root);rng.setEndAfter(root);}}else{rng.setStart(root,0);rng.setEnd(root,0);}}editor.selection.setRng(rng);scrollRangeIntoView(editor,rng);};var getEditableRoot$1=function getEditableRoot$1(dom,node){var root=dom.getRoot();var parent,editableRoot;parent=node;while(parent!==root&&dom.getContentEditable(parent)!=='false'){if(dom.getContentEditable(parent)==='true'){editableRoot=parent;}parent=parent.parentNode;}return parent!==root?editableRoot:root;};var getParentBlock=function getParentBlock(editor){return Optional.from(editor.dom.getParent(editor.selection.getStart(true),editor.dom.isBlock));};var getParentBlockName=function getParentBlockName(editor){return getParentBlock(editor).fold(constant(''),function(parentBlock){return parentBlock.nodeName.toUpperCase();});};var isListItemParentBlock=function isListItemParentBlock(editor){return getParentBlock(editor).filter(function(elm){return isListItem(SugarElement.fromDom(elm));}).isSome();};var hasFirstChild=function hasFirstChild(elm,name){return elm.firstChild&&elm.firstChild.nodeName===name;};var isFirstChild=function isFirstChild(elm){var _a;return((_a=elm.parentNode)===null||_a===void 0?void 0:_a.firstChild)===elm;};var hasParent=function hasParent(elm,parentName){return elm&&elm.parentNode&&elm.parentNode.nodeName===parentName;};var isListBlock=function isListBlock(elm){return elm&&/^(OL|UL|LI)$/.test(elm.nodeName);};var isNestedList=function isNestedList(elm){return isListBlock(elm)&&isListBlock(elm.parentNode);};var getContainerBlock=function getContainerBlock(containerBlock){var containerBlockParent=containerBlock.parentNode;if(/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)){return containerBlockParent;}return containerBlock;};var isFirstOrLastLi=function isFirstOrLastLi(containerBlock,parentBlock,first){var node=containerBlock[first?'firstChild':'lastChild'];while(node){if(isElement$5(node)){break;}node=node[first?'nextSibling':'previousSibling'];}return node===parentBlock;};var insert$3=function insert$3(editor,createNewBlock,containerBlock,parentBlock,newBlockName){var dom=editor.dom;var rng=editor.selection.getRng();if(containerBlock===editor.getBody()){return;}if(isNestedList(containerBlock)){newBlockName='LI';}var newBlock=newBlockName?createNewBlock(newBlockName):dom.create('BR');if(isFirstOrLastLi(containerBlock,parentBlock,true)&&isFirstOrLastLi(containerBlock,parentBlock,false)){if(hasParent(containerBlock,'LI')){var containerBlockParent=getContainerBlock(containerBlock);dom.insertAfter(newBlock,containerBlockParent);if(isFirstChild(containerBlock)){dom.remove(containerBlockParent);}else{dom.remove(containerBlock);}}else{dom.replace(newBlock,containerBlock);}}else if(isFirstOrLastLi(containerBlock,parentBlock,true)){if(hasParent(containerBlock,'LI')){dom.insertAfter(newBlock,getContainerBlock(containerBlock));newBlock.appendChild(dom.doc.createTextNode(' '));newBlock.appendChild(containerBlock);}else{containerBlock.parentNode.insertBefore(newBlock,containerBlock);}dom.remove(parentBlock);}else if(isFirstOrLastLi(containerBlock,parentBlock,false)){dom.insertAfter(newBlock,getContainerBlock(containerBlock));dom.remove(parentBlock);}else{containerBlock=getContainerBlock(containerBlock);var tmpRng=rng.cloneRange();tmpRng.setStartAfter(parentBlock);tmpRng.setEndAfter(containerBlock);var fragment=tmpRng.extractContents();if(newBlockName==='LI'&&hasFirstChild(fragment,'LI')){newBlock=fragment.firstChild;dom.insertAfter(fragment,containerBlock);}else{dom.insertAfter(fragment,containerBlock);dom.insertAfter(newBlock,containerBlock);}dom.remove(parentBlock);}moveToCaretPosition(editor,newBlock);};var trimZwsp=function trimZwsp(fragment){each$k(_descendants$(SugarElement.fromDom(fragment),isText$8),function(text){var rawNode=text.dom;rawNode.nodeValue=trim$3(rawNode.nodeValue);});};var isEmptyAnchor=function isEmptyAnchor(dom,elm){return elm&&elm.nodeName==='A'&&dom.isEmpty(elm);};var isTableCell=function isTableCell(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName);};var emptyBlock=function emptyBlock(elm){elm.innerHTML='<br data-mce-bogus=\"1\">';};var containerAndSiblingName=function containerAndSiblingName(container,nodeName){return container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName;};var canSplitBlock=function canSplitBlock(dom,node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&dom.getContentEditable(node)!=='true';};var trimInlineElementsOnLeftSideOfBlock=function trimInlineElementsOnLeftSideOfBlock(dom,nonEmptyElementsMap,block){var node=block;var firstChilds=[];var i;if(!node){return;}while(node=node.firstChild){if(dom.isBlock(node)){return;}if(isElement$5(node)&&!nonEmptyElementsMap[node.nodeName.toLowerCase()]){firstChilds.push(node);}}i=firstChilds.length;while(i--){node=firstChilds[i];if(!node.hasChildNodes()||node.firstChild===node.lastChild&&node.firstChild.nodeValue===''){dom.remove(node);}else{if(isEmptyAnchor(dom,node)){dom.remove(node);}}}};var normalizeZwspOffset=function normalizeZwspOffset(start,container,offset){if(isText$7(container)===false){return offset;}else if(start){return offset===1&&container.data.charAt(offset-1)===ZWSP$1?0:offset;}else{return offset===container.data.length-1&&container.data.charAt(offset)===ZWSP$1?container.data.length:offset;}};var includeZwspInRange=function includeZwspInRange(rng){var newRng=rng.cloneRange();newRng.setStart(rng.startContainer,normalizeZwspOffset(true,rng.startContainer,rng.startOffset));newRng.setEnd(rng.endContainer,normalizeZwspOffset(false,rng.endContainer,rng.endOffset));return newRng;};var trimLeadingLineBreaks=function trimLeadingLineBreaks(node){do{if(isText$7(node)){node.nodeValue=node.nodeValue.replace(/^[\\r\\n]+/,'');}node=node.firstChild;}while(node);};var getEditableRoot=function getEditableRoot(dom,node){var root=dom.getRoot();var parent,editableRoot;parent=node;while(parent!==root&&dom.getContentEditable(parent)!=='false'){if(dom.getContentEditable(parent)==='true'){editableRoot=parent;}parent=parent.parentNode;}return parent!==root?editableRoot:root;};var applyAttributes=function applyAttributes(editor,node,forcedRootBlockAttrs){var dom=editor.dom;Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each(function(attrStyles){var currentStyles=getAllRaw(SugarElement.fromDom(node));var newStyles=_assign(_assign({},currentStyles),attrStyles);dom.setStyles(node,newStyles);});var attrClassesOpt=Optional.from(forcedRootBlockAttrs.class).map(function(attrClasses){return attrClasses.split(/\\s+/);});var currentClassesOpt=Optional.from(node.className).map(function(currentClasses){return filter$4(currentClasses.split(/\\s+/),function(clazz){return clazz!=='';});});lift2(attrClassesOpt,currentClassesOpt,function(attrClasses,currentClasses){var filteredClasses=filter$4(currentClasses,function(clazz){return!contains$3(attrClasses,clazz);});var newClasses=__spreadArray(__spreadArray([],attrClasses,true),filteredClasses,true);dom.setAttrib(node,'class',newClasses.join(' '));});var appliedAttrs=['style','class'];var remainingAttrs=filter$3(forcedRootBlockAttrs,function(_,attrs){return!contains$3(appliedAttrs,attrs);});dom.setAttribs(node,remainingAttrs);};var setForcedBlockAttrs=function setForcedBlockAttrs(editor,node){var forcedRootBlockName=getForcedRootBlock(editor);if(forcedRootBlockName&&forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()){var forcedRootBlockAttrs=getForcedRootBlockAttrs(editor);applyAttributes(editor,node,forcedRootBlockAttrs);}};var wrapSelfAndSiblingsInDefaultBlock=function wrapSelfAndSiblingsInDefaultBlock(editor,newBlockName,rng,container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName;var blockName=newBlockName||'P';var dom=editor.dom,editableRoot=getEditableRoot(dom,container);parentBlock=dom.getParent(container,dom.isBlock);if(!parentBlock||!canSplitBlock(dom,parentBlock)){parentBlock=parentBlock||editableRoot;if(parentBlock===editor.getBody()||isTableCell(parentBlock)){rootBlockName=parentBlock.nodeName.toLowerCase();}else{rootBlockName=parentBlock.parentNode.nodeName.toLowerCase();}if(!parentBlock.hasChildNodes()){newBlock=dom.create(blockName);setForcedBlockAttrs(editor,newBlock);parentBlock.appendChild(newBlock);rng.setStart(newBlock,0);rng.setEnd(newBlock,0);return newBlock;}node=container;while(node.parentNode!==parentBlock){node=node.parentNode;}while(node&&!dom.isBlock(node)){startNode=node;node=node.previousSibling;}if(startNode&&editor.schema.isValidChild(rootBlockName,blockName.toLowerCase())){newBlock=dom.create(blockName);setForcedBlockAttrs(editor,newBlock);startNode.parentNode.insertBefore(newBlock,startNode);node=startNode;while(node&&!dom.isBlock(node)){next=node.nextSibling;newBlock.appendChild(node);node=next;}rng.setStart(container,offset);rng.setEnd(container,offset);}}return container;};var addBrToBlockIfNeeded=function addBrToBlockIfNeeded(dom,block){block.normalize();var lastChild=block.lastChild;if(!lastChild||/^(left|right)$/gi.test(dom.getStyle(lastChild,'float',true))){dom.add(block,'br');}};var insert$2=function insert$2(editor,evt){var tmpRng,container,offset,parentBlock;var newBlock,fragment,containerBlock,parentBlockName,newBlockName,isAfterLastNodeInContainer;var dom=editor.dom;var schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements();var rng=editor.selection.getRng();var createNewBlock=function createNewBlock(name){var node=container,block,clonedNode,caretNode;var textInlineElements=schema.getTextInlineElements();if(name||parentBlockName==='TABLE'||parentBlockName==='HR'){block=dom.create(name||newBlockName);}else{block=parentBlock.cloneNode(false);}caretNode=block;if(shouldKeepStyles(editor)===false){dom.setAttrib(block,'style',null);dom.setAttrib(block,'class',null);}else{do{if(textInlineElements[node.nodeName]){if(isCaretNode(node)||isBookmarkNode$1(node)){continue;}clonedNode=node.cloneNode(false);dom.setAttrib(clonedNode,'id','');if(block.hasChildNodes()){clonedNode.appendChild(block.firstChild);block.appendChild(clonedNode);}else{caretNode=clonedNode;block.appendChild(clonedNode);}}}while((node=node.parentNode)&&node!==editableRoot);}setForcedBlockAttrs(editor,block);emptyBlock(caretNode);return block;};var isCaretAtStartOrEndOfBlock=function isCaretAtStartOrEndOfBlock(start){var node,name;var normalizedOffset=normalizeZwspOffset(start,container,offset);if(isText$7(container)&&(start?normalizedOffset>0:normalizedOffset<container.nodeValue.length)){return false;}if(container.parentNode===parentBlock&&isAfterLastNodeInContainer&&!start){return true;}if(start&&isElement$5(container)&&container===parentBlock.firstChild){return true;}if(containerAndSiblingName(container,'TABLE')||containerAndSiblingName(container,'HR')){return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;}var walker=new DomTreeWalker(container,parentBlock);if(isText$7(container)){if(start&&normalizedOffset===0){walker.prev();}else if(!start&&normalizedOffset===container.nodeValue.length){walker.next();}}while(node=walker.current()){if(isElement$5(node)){if(!node.getAttribute('data-mce-bogus')){name=node.nodeName.toLowerCase();if(nonEmptyElementsMap[name]&&name!=='br'){return false;}}}else if(isText$7(node)&&!isWhitespaceText(node.nodeValue)){return false;}if(start){walker.prev();}else{walker.next();}}return true;};var insertNewBlockAfter=function insertNewBlockAfter(){if(/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&containerBlockName!=='HGROUP'){newBlock=createNewBlock(newBlockName);}else{newBlock=createNewBlock();}if(shouldEndContainerOnEmptyBlock(editor)&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock)){newBlock=dom.split(containerBlock,parentBlock);}else{dom.insertAfter(newBlock,parentBlock);}moveToCaretPosition(editor,newBlock);};normalize$2(dom,rng).each(function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset);rng.setEnd(normRng.endContainer,normRng.endOffset);});container=rng.startContainer;offset=rng.startOffset;newBlockName=getForcedRootBlock(editor);var shiftKey=!!(evt&&evt.shiftKey);var ctrlKey=!!(evt&&evt.ctrlKey);if(isElement$5(container)&&container.hasChildNodes()){isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer&&isText$7(container)){offset=container.nodeValue.length;}else{offset=0;}}var editableRoot=getEditableRoot(dom,container);if(!editableRoot){return;}if(newBlockName&&!shiftKey||!newBlockName&&shiftKey){container=wrapSelfAndSiblingsInDefaultBlock(editor,newBlockName,rng,container,offset);}parentBlock=dom.getParent(container,dom.isBlock);containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null;parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():'';var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():'';if(containerBlockName==='LI'&&!ctrlKey){parentBlock=containerBlock;containerBlock=containerBlock.parentNode;parentBlockName=containerBlockName;}if(/^(LI|DT|DD)$/.test(parentBlockName)){if(dom.isEmpty(parentBlock)){insert$3(editor,createNewBlock,containerBlock,parentBlock,newBlockName);return;}}if(newBlockName&&parentBlock===editor.getBody()){return;}newBlockName=newBlockName||'P';if(isCaretContainerBlock$1(parentBlock)){newBlock=showCaretContainerBlock(parentBlock);if(dom.isEmpty(parentBlock)){emptyBlock(parentBlock);}setForcedBlockAttrs(editor,newBlock);moveToCaretPosition(editor,newBlock);}else if(isCaretAtStartOrEndOfBlock()){insertNewBlockAfter();}else if(isCaretAtStartOrEndOfBlock(true)){newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock);moveToCaretPosition(editor,containerAndSiblingName(parentBlock,'HR')?newBlock:parentBlock);}else{tmpRng=includeZwspInRange(rng).cloneRange();tmpRng.setEndAfter(parentBlock);fragment=tmpRng.extractContents();trimZwsp(fragment);trimLeadingLineBreaks(fragment);newBlock=fragment.firstChild;dom.insertAfter(fragment,parentBlock);trimInlineElementsOnLeftSideOfBlock(dom,nonEmptyElementsMap,newBlock);addBrToBlockIfNeeded(dom,parentBlock);if(dom.isEmpty(parentBlock)){emptyBlock(parentBlock);}newBlock.normalize();if(dom.isEmpty(newBlock)){dom.remove(newBlock);insertNewBlockAfter();}else{setForcedBlockAttrs(editor,newBlock);moveToCaretPosition(editor,newBlock);}}dom.setAttrib(newBlock,'id','');editor.fire('NewBlock',{newBlock:newBlock});};var hasRightSideContent=function hasRightSideContent(schema,container,parentBlock){var walker=new DomTreeWalker(container,parentBlock);var node;var nonEmptyElementsMap=schema.getNonEmptyElements();while(node=walker.next()){if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0){return true;}}};var moveSelectionToBr=function moveSelectionToBr(editor,brElm,extraBr){var rng=editor.dom.createRng();if(!extraBr){rng.setStartAfter(brElm);rng.setEndAfter(brElm);}else{rng.setStartBefore(brElm);rng.setEndBefore(brElm);}editor.selection.setRng(rng);scrollRangeIntoView(editor,rng);};var insertBrAtCaret=function insertBrAtCaret(editor,evt){var selection=editor.selection;var dom=editor.dom;var rng=selection.getRng();var brElm;var extraBr;normalize$2(dom,rng).each(function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset);rng.setEnd(normRng.endContainer,normRng.endOffset);});var offset=rng.startOffset;var container=rng.startContainer;if(container.nodeType===1&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer&&container.nodeType===3){offset=container.nodeValue.length;}else{offset=0;}}var parentBlock=dom.getParent(container,dom.isBlock);var containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null;var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():'';var isControlKey=!!(evt&&evt.ctrlKey);if(containerBlockName==='LI'&&!isControlKey){parentBlock=containerBlock;}if(container&&container.nodeType===3&&offset>=container.nodeValue.length){if(!hasRightSideContent(editor.schema,container,parentBlock)){brElm=dom.create('br');rng.insertNode(brElm);rng.setStartAfter(brElm);rng.setEndAfter(brElm);extraBr=true;}}brElm=dom.create('br');rangeInsertNode(dom,rng,brElm);moveSelectionToBr(editor,brElm,extraBr);editor.undoManager.add();};var insertBrBefore=function insertBrBefore(editor,inline){var br=SugarElement.fromTag('br');before$4(SugarElement.fromDom(inline),br);editor.undoManager.add();};var insertBrAfter=function insertBrAfter(editor,inline){if(!hasBrAfter(editor.getBody(),inline)){after$3(SugarElement.fromDom(inline),SugarElement.fromTag('br'));}var br=SugarElement.fromTag('br');after$3(SugarElement.fromDom(inline),br);moveSelectionToBr(editor,br.dom,false);editor.undoManager.add();};var isBeforeBr=function isBeforeBr(pos){return isBr$5(pos.getNode());};var hasBrAfter=function hasBrAfter(rootNode,startNode){if(isBeforeBr(_CaretPosition.after(startNode))){return true;}else{return nextPosition(rootNode,_CaretPosition.after(startNode)).map(function(pos){return isBr$5(pos.getNode());}).getOr(false);}};var isAnchorLink=function isAnchorLink(elm){return elm&&elm.nodeName==='A'&&'href'in elm;};var isInsideAnchor=function isInsideAnchor(location){return location.fold(never,isAnchorLink,isAnchorLink,never);};var readInlineAnchorLocation=function readInlineAnchorLocation(editor){var isInlineTarget$1=curry(isInlineTarget,editor);var position=_CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),position).filter(isInsideAnchor);};var insertBrOutsideAnchor=function insertBrOutsideAnchor(editor,location){location.fold(noop,curry(insertBrBefore,editor),curry(insertBrAfter,editor),noop);};var insert$1=function insert$1(editor,evt){var anchorLocation=readInlineAnchorLocation(editor);if(anchorLocation.isSome()){anchorLocation.each(curry(insertBrOutsideAnchor,editor));}else{insertBrAtCaret(editor,evt);}};var matchesSelector=function matchesSelector(editor,selector){return getParentBlock(editor).filter(function(parentBlock){return selector.length>0&&is$2(SugarElement.fromDom(parentBlock),selector);}).isSome();};var shouldInsertBr=function shouldInsertBr(editor){return matchesSelector(editor,getBrNewLineSelector(editor));};var shouldBlockNewLine$1=function shouldBlockNewLine$1(editor){return matchesSelector(editor,getNoNewLineSelector(editor));};var newLineAction=Adt.generate([{br:[]},{block:[]},{none:[]}]);var shouldBlockNewLine=function shouldBlockNewLine(editor,_shiftKey){return shouldBlockNewLine$1(editor);};var isBrMode=function isBrMode(requiredState){return function(editor,_shiftKey){var brMode=getForcedRootBlock(editor)==='';return brMode===requiredState;};};var inListBlock=function inListBlock(requiredState){return function(editor,_shiftKey){return isListItemParentBlock(editor)===requiredState;};};var inBlock=function inBlock(blockName,requiredState){return function(editor,_shiftKey){var state=getParentBlockName(editor)===blockName.toUpperCase();return state===requiredState;};};var inPreBlock=function inPreBlock(requiredState){return inBlock('pre',requiredState);};var inSummaryBlock=function inSummaryBlock(){return inBlock('summary',true);};var shouldPutBrInPre=function shouldPutBrInPre(requiredState){return function(editor,_shiftKey){return shouldPutBrInPre$1(editor)===requiredState;};};var inBrContext=function inBrContext(editor,_shiftKey){return shouldInsertBr(editor);};var hasShiftKey=function hasShiftKey(_editor,shiftKey){return shiftKey;};var canInsertIntoEditableRoot=function canInsertIntoEditableRoot(editor){var forcedRootBlock=getForcedRootBlock(editor);var rootEditable=getEditableRoot$1(editor.dom,editor.selection.getStart());return rootEditable&&editor.schema.isValidChild(rootEditable.nodeName,forcedRootBlock?forcedRootBlock:'P');};var match=function match(predicates,action){return function(editor,shiftKey){var isMatch=foldl(predicates,function(res,p){return res&&p(editor,shiftKey);},true);return isMatch?Optional.some(action):Optional.none();};};var getAction=function getAction(editor,evt){return evaluateUntil([match([shouldBlockNewLine],newLineAction.none()),match([inSummaryBlock()],newLineAction.br()),match([inPreBlock(true),shouldPutBrInPre(false),hasShiftKey],newLineAction.br()),match([inPreBlock(true),shouldPutBrInPre(false)],newLineAction.block()),match([inPreBlock(true),shouldPutBrInPre(true),hasShiftKey],newLineAction.block()),match([inPreBlock(true),shouldPutBrInPre(true)],newLineAction.br()),match([inListBlock(true),hasShiftKey],newLineAction.br()),match([inListBlock(true)],newLineAction.block()),match([isBrMode(true),hasShiftKey,canInsertIntoEditableRoot],newLineAction.block()),match([isBrMode(true)],newLineAction.br()),match([inBrContext],newLineAction.br()),match([isBrMode(false),hasShiftKey],newLineAction.br()),match([canInsertIntoEditableRoot],newLineAction.block())],[editor,!!(evt&&evt.shiftKey)]).getOr(newLineAction.none());};var insert=function insert(editor,evt){getAction(editor,evt).fold(function(){insert$1(editor,evt);},function(){insert$2(editor,evt);},noop);};var handleEnterKeyEvent=function handleEnterKeyEvent(editor,event){if(event.isDefaultPrevented()){return;}event.preventDefault();endTypingLevelIgnoreLocks(editor.undoManager);editor.undoManager.transact(function(){if(editor.selection.isCollapsed()===false){editor.execCommand('Delete');}insert(editor,event);});};var setup$9=function setup$9(editor){editor.on('keydown',function(event){if(event.keyCode===VK.ENTER){handleEnterKeyEvent(editor,event);}});};var executeKeydownOverride$1=function executeKeydownOverride$1(editor,caret,evt){execute([{keyCode:VK.END,action:action(moveToLineEndPoint$1,editor,true)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$1,editor,false)},{keyCode:VK.END,action:action(moveToLineEndPoint,editor,true)},{keyCode:VK.HOME,action:action(moveToLineEndPoint,editor,false)},{keyCode:VK.END,action:action(moveToLineEndPoint$2,editor,true,caret)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$2,editor,false,caret)}],evt).each(function(_){evt.preventDefault();});};var setup$8=function setup$8(editor,caret){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride$1(editor,caret,evt);}});};var browser=detect().browser;var setupIeInput=function setupIeInput(editor){var keypressThrotter=first(function(){if(!editor.composing){normalizeNbspsInEditor(editor);}},0);if(browser.isIE()){editor.on('keypress',function(_e){keypressThrotter.throttle();});editor.on('remove',function(_e){keypressThrotter.cancel();});}};var setup$7=function setup$7(editor){setupIeInput(editor);editor.on('input',function(e){if(e.isComposing===false){normalizeNbspsInEditor(editor);}});};var platform=detect();var executeKeyupAction=function executeKeyupAction(editor,caret,evt){execute([{keyCode:VK.PAGE_UP,action:action(moveToLineEndPoint$2,editor,false,caret)},{keyCode:VK.PAGE_DOWN,action:action(moveToLineEndPoint$2,editor,true,caret)}],evt);};var stopImmediatePropagation=function stopImmediatePropagation(e){return e.stopImmediatePropagation();};var isPageUpDown=function isPageUpDown(evt){return evt.keyCode===VK.PAGE_UP||evt.keyCode===VK.PAGE_DOWN;};var setNodeChangeBlocker=function setNodeChangeBlocker(blocked,editor,block){if(block&&!blocked.get()){editor.on('NodeChange',stopImmediatePropagation,true);}else if(!block&&blocked.get()){editor.off('NodeChange',stopImmediatePropagation);}blocked.set(block);};var setup$6=function setup$6(editor,caret){if(platform.os.isOSX()){return;}var blocked=Cell(false);editor.on('keydown',function(evt){if(isPageUpDown(evt)){setNodeChangeBlocker(blocked,editor,true);}});editor.on('keyup',function(evt){if(evt.isDefaultPrevented()===false){executeKeyupAction(editor,caret,evt);}if(isPageUpDown(evt)&&blocked.get()){setNodeChangeBlocker(blocked,editor,false);editor.nodeChanged();}});};var insertTextAtPosition=function insertTextAtPosition(text,pos){var container=pos.container();var offset=pos.offset();if(isText$7(container)){container.insertData(offset,text);return Optional.some(_CaretPosition(container,offset+text.length));}else{return getElementFromPosition(pos).map(function(elm){var textNode=SugarElement.fromText(text);if(pos.isAtEnd()){after$3(elm,textNode);}else{before$4(elm,textNode);}return _CaretPosition(textNode.dom,text.length);});}};var insertNbspAtPosition=curry(insertTextAtPosition,nbsp);var insertSpaceAtPosition=curry(insertTextAtPosition,' ');var locationToCaretPosition=function locationToCaretPosition(root){return function(location){return location.fold(function(element){return prevPosition(root.dom,_CaretPosition.before(element));},function(element){return firstPositionIn(element);},function(element){return lastPositionIn(element);},function(element){return nextPosition(root.dom,_CaretPosition.after(element));});};};var insertInlineBoundarySpaceOrNbsp=function insertInlineBoundarySpaceOrNbsp(root,pos){return function(checkPos){return needsToHaveNbsp(root,checkPos)?insertNbspAtPosition(pos):insertSpaceAtPosition(pos);};};var setSelection=function setSelection(editor){return function(pos){editor.selection.setRng(pos.toRange());editor.nodeChanged();return true;};};var insertSpaceOrNbspAtSelection=function insertSpaceOrNbspAtSelection(editor){var pos=_CaretPosition.fromRangeStart(editor.selection.getRng());var root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){var isInlineTarget$1=curry(isInlineTarget,editor);var caretPosition=_CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),caretPosition).bind(locationToCaretPosition(root)).bind(insertInlineBoundarySpaceOrNbsp(root,pos)).exists(setSelection(editor));}else{return false;}};var executeKeydownOverride=function executeKeydownOverride(editor,evt){execute([{keyCode:VK.SPACEBAR,action:action(insertSpaceOrNbspAtSelection,editor)}],evt).each(function(_){evt.preventDefault();});};var setup$5=function setup$5(editor){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride(editor,evt);}});};var registerKeyboardOverrides=function registerKeyboardOverrides(editor){var caret=setupSelectedState(editor);setup$c(editor);setup$b(editor,caret);setup$a(editor,caret);setup$9(editor);setup$5(editor);setup$7(editor);setup$8(editor,caret);setup$6(editor,caret);return caret;};var setup$4=function setup$4(editor){if(!isRtc(editor)){return registerKeyboardOverrides(editor);}else{return Cell(null);}};var NodeChange=function(){function NodeChange(editor){this.lastPath=[];this.editor=editor;var lastRng;var self=this;if(!('onselectionchange'in editor.getDoc())){editor.on('NodeChange click mouseup keyup focus',function(e){var nativeRng=editor.selection.getRng();var fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};if(e.type==='nodechange'||!isEq$4(fakeRng,lastRng)){editor.fire('SelectionChange');}lastRng=fakeRng;});}editor.on('contextmenu',function(){editor.fire('SelectionChange');});editor.on('SelectionChange',function(){var startElm=editor.selection.getStart(true);if(!startElm||!Env.range&&editor.selection.isCollapsed()){return;}if(hasAnyRanges(editor)&&!self.isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())){editor.nodeChanged({selectionChange:true});}});editor.on('mouseup',function(e){if(!e.isDefaultPrevented()&&hasAnyRanges(editor)){if(editor.selection.getNode().nodeName==='IMG'){Delay.setEditorTimeout(editor,function(){editor.nodeChanged();});}else{editor.nodeChanged();}}});}NodeChange.prototype.nodeChanged=function(args){var selection=this.editor.selection;var node,parents,root;if(this.editor.initialized&&selection&&!shouldDisableNodeChange(this.editor)&&!this.editor.mode.isReadOnly()){root=this.editor.getBody();node=selection.getStart(true)||root;if(node.ownerDocument!==this.editor.getDoc()||!this.editor.dom.isChildOf(node,root)){node=root;}parents=[];this.editor.dom.getParent(node,function(node){if(node===root){return true;}parents.push(node);});args=args||{};args.element=node;args.parents=parents;this.editor.fire('NodeChange',args);}};NodeChange.prototype.isSameElementPath=function(startElm){var i;var currentPath=this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);if(currentPath.length===this.lastPath.length){for(i=currentPath.length;i>=0;i--){if(currentPath[i]!==this.lastPath[i]){break;}}if(i===-1){this.lastPath=currentPath;return true;}}this.lastPath=currentPath;return false;};return NodeChange;}();var preventSummaryToggle=function preventSummaryToggle(editor){editor.on('click',function(e){if(editor.dom.getParent(e.target,'details')){e.preventDefault();}});};var filterDetails=function filterDetails(editor){editor.parser.addNodeFilter('details',function(elms){each$k(elms,function(details){details.attr('data-mce-open',details.attr('open'));details.attr('open','open');});});editor.serializer.addNodeFilter('details',function(elms){each$k(elms,function(details){var open=details.attr('data-mce-open');details.attr('open',isString$1(open)?open:null);details.attr('data-mce-open',null);});});};var setup$3=function setup$3(editor){preventSummaryToggle(editor);filterDetails(editor);};var isTextBlockNode=function isTextBlockNode(node){return isElement$5(node)&&isTextBlock$2(SugarElement.fromDom(node));};var normalizeSelection=function normalizeSelection(editor){var rng=editor.selection.getRng();var startPos=_CaretPosition.fromRangeStart(rng);var endPos=_CaretPosition.fromRangeEnd(rng);if(_CaretPosition.isElementPosition(startPos)){var container=startPos.container();if(isTextBlockNode(container)){firstPositionIn(container).each(function(pos){return rng.setStart(pos.container(),pos.offset());});}}if(_CaretPosition.isElementPosition(endPos)){var container=startPos.container();if(isTextBlockNode(container)){lastPositionIn(container).each(function(pos){return rng.setEnd(pos.container(),pos.offset());});}}editor.selection.setRng(normalize(rng));};var setup$2=function setup$2(editor){editor.on('click',function(e){if(e.detail>=3){normalizeSelection(editor);}});};var getAbsolutePosition=function getAbsolutePosition(elm){var clientRect=elm.getBoundingClientRect();var doc=elm.ownerDocument;var docElem=doc.documentElement;var win=doc.defaultView;return{top:clientRect.top+win.pageYOffset-docElem.clientTop,left:clientRect.left+win.pageXOffset-docElem.clientLeft};};var getBodyPosition=function getBodyPosition(editor){return editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0};};var getScrollPosition=function getScrollPosition(editor){var body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0};};var getBodyScroll=function getBodyScroll(editor){var body=editor.getBody(),docElm=editor.getDoc().documentElement;var inlineScroll={left:body.scrollLeft,top:body.scrollTop};var iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:iframeScroll;};var getMousePosition=function getMousePosition(editor,event){if(event.target.ownerDocument!==editor.getDoc()){var iframePosition=getAbsolutePosition(editor.getContentAreaContainer());var scrollPosition=getBodyScroll(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top};}return{left:event.pageX,top:event.pageY};};var calculatePosition=function calculatePosition(bodyPosition,scrollPosition,mousePosition){return{pageX:mousePosition.left-bodyPosition.left+scrollPosition.left,pageY:mousePosition.top-bodyPosition.top+scrollPosition.top};};var calc=function calc(editor,event){return calculatePosition(getBodyPosition(editor),getScrollPosition(editor),getMousePosition(editor,event));};var isContentEditableFalse$1=isContentEditableFalse$b,isContentEditableTrue$1=isContentEditableTrue$4;var isDraggable=function isDraggable(rootElm,elm){return isContentEditableFalse$1(elm)&&elm!==rootElm;};var isValidDropTarget=function isValidDropTarget(editor,targetElement,dragElement){if(targetElement===dragElement||editor.dom.isChildOf(targetElement,dragElement)){return false;}return!isContentEditableFalse$1(targetElement);};var cloneElement=function cloneElement(elm){var cloneElm=elm.cloneNode(true);cloneElm.removeAttribute('data-mce-selected');return cloneElm;};var createGhost=function createGhost(editor,elm,width,height){var dom=editor.dom;var clonedElm=elm.cloneNode(true);dom.setStyles(clonedElm,{width:width,height:height});dom.setAttrib(clonedElm,'data-mce-selected',null);var ghostElm=dom.create('div',{'class':'mce-drag-container','data-mce-bogus':'all','unselectable':'on','contenteditable':'false'});dom.setStyles(ghostElm,{position:'absolute',opacity:0.5,overflow:'hidden',border:0,padding:0,margin:0,width:width,height:height});dom.setStyles(clonedElm,{margin:0,boxSizing:'border-box'});ghostElm.appendChild(clonedElm);return ghostElm;};var appendGhostToBody=function appendGhostToBody(ghostElm,bodyElm){if(ghostElm.parentNode!==bodyElm){bodyElm.appendChild(ghostElm);}};var moveGhost=function moveGhost(ghostElm,position,width,height,maxX,maxY){var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+'px';ghostElm.style.top=position.pageY+'px';if(position.pageX+width>maxX){overflowX=position.pageX+width-maxX;}if(position.pageY+height>maxY){overflowY=position.pageY+height-maxY;}ghostElm.style.width=width-overflowX+'px';ghostElm.style.height=height-overflowY+'px';};var removeElement=function removeElement(elm){if(elm&&elm.parentNode){elm.parentNode.removeChild(elm);}};var isLeftMouseButtonPressed=function isLeftMouseButtonPressed(e){return e.button===0;};var applyRelPos=function applyRelPos(state,position){return{pageX:position.pageX-state.relX,pageY:position.pageY+5};};var start=function start(state,editor){return function(e){if(isLeftMouseButtonPressed(e)){var ceElm=find$3(editor.dom.getParents(e.target),or(isContentEditableFalse$1,isContentEditableTrue$1)).getOr(null);if(isDraggable(editor.getBody(),ceElm)){var elmPos=editor.dom.getPos(ceElm);var bodyElm=editor.getBody();var docElm=editor.getDoc().documentElement;state.set({element:ceElm,dragging:false,screenX:e.screenX,screenY:e.screenY,maxX:(editor.inline?bodyElm.scrollWidth:docElm.offsetWidth)-2,maxY:(editor.inline?bodyElm.scrollHeight:docElm.offsetHeight)-2,relX:e.pageX-elmPos.x,relY:e.pageY-elmPos.y,width:ceElm.offsetWidth,height:ceElm.offsetHeight,ghost:createGhost(editor,ceElm,ceElm.offsetWidth,ceElm.offsetHeight)});}}};};var move=function move(state,editor){var throttledPlaceCaretAt=Delay.throttle(function(clientX,clientY){editor._selectionOverrides.hideFakeCaret();editor.selection.placeCaretAt(clientX,clientY);},0);editor.on('remove',throttledPlaceCaretAt.stop);return function(e){return state.on(function(state){var movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(!state.dragging&&movement>10){var args=editor.fire('dragstart',{target:state.element});if(args.isDefaultPrevented()){return;}state.dragging=true;editor.focus();}if(state.dragging){var targetPos=applyRelPos(state,calc(editor,e));appendGhostToBody(state.ghost,editor.getBody());moveGhost(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY);throttledPlaceCaretAt(e.clientX,e.clientY);}});};};var getRawTarget=function getRawTarget(selection){var rng=selection.getSel().getRangeAt(0);var startContainer=rng.startContainer;return startContainer.nodeType===3?startContainer.parentNode:startContainer;};var drop=function drop(state,editor){return function(e){state.on(function(state){if(state.dragging){if(isValidDropTarget(editor,getRawTarget(editor.selection),state.element)){var targetClone_1=cloneElement(state.element);var args=editor.fire('drop',{clientX:e.clientX,clientY:e.clientY});if(!args.isDefaultPrevented()){editor.undoManager.transact(function(){removeElement(state.element);editor.insertContent(editor.dom.getOuterHTML(targetClone_1));editor._selectionOverrides.hideFakeCaret();});}}editor.fire('dragend');}});removeDragState(state);};};var stop=function stop(state,editor){return function(){state.on(function(state){if(state.dragging){editor.fire('dragend');}});removeDragState(state);};};var removeDragState=function removeDragState(state){state.on(function(state){removeElement(state.ghost);});state.clear();};var bindFakeDragEvents=function bindFakeDragEvents(editor){var state=value();var pageDom=_DOMUtils.DOM;var rootDocument=document;var dragStartHandler=start(state,editor);var dragHandler=move(state,editor);var dropHandler=drop(state,editor);var dragEndHandler=stop(state,editor);editor.on('mousedown',dragStartHandler);editor.on('mousemove',dragHandler);editor.on('mouseup',dropHandler);pageDom.bind(rootDocument,'mousemove',dragHandler);pageDom.bind(rootDocument,'mouseup',dragEndHandler);editor.on('remove',function(){pageDom.unbind(rootDocument,'mousemove',dragHandler);pageDom.unbind(rootDocument,'mouseup',dragEndHandler);});editor.on('keydown',function(e){if(e.keyCode===VK.ESC){dragEndHandler();}});};var blockIeDrop=function blockIeDrop(editor){editor.on('drop',function(e){var realTarget=typeof e.clientX!=='undefined'?editor.getDoc().elementFromPoint(e.clientX,e.clientY):null;if(isContentEditableFalse$1(realTarget)||editor.dom.getContentEditableParent(realTarget)==='false'){e.preventDefault();}});};var blockUnsupportedFileDrop=function blockUnsupportedFileDrop(editor){var preventFileDrop=function preventFileDrop(e){if(!e.isDefaultPrevented()){var dataTransfer=e.dataTransfer;if(dataTransfer&&(contains$3(dataTransfer.types,'Files')||dataTransfer.files.length>0)){e.preventDefault();if(e.type==='drop'){displayError(editor,'Dropped file type is not supported');}}}};var preventFileDropIfUIElement=function preventFileDropIfUIElement(e){if(isUIElement(editor,e.target)){preventFileDrop(e);}};var setup=function setup(){var pageDom=_DOMUtils.DOM;var dom=editor.dom;var doc=document;var editorRoot=editor.inline?editor.getBody():editor.getDoc();var eventNames=['drop','dragover'];each$k(eventNames,function(name){pageDom.bind(doc,name,preventFileDropIfUIElement);dom.bind(editorRoot,name,preventFileDrop);});editor.on('remove',function(){each$k(eventNames,function(name){pageDom.unbind(doc,name,preventFileDropIfUIElement);dom.unbind(editorRoot,name,preventFileDrop);});});};editor.on('init',function(){Delay.setEditorTimeout(editor,setup,0);});};var init$2=function init$2(editor){bindFakeDragEvents(editor);blockIeDrop(editor);if(shouldBlockUnsupportedDrop(editor)){blockUnsupportedFileDrop(editor);}};var setup$1=function setup$1(editor){var renderFocusCaret=first(function(){if(!editor.removed&&editor.getBody().contains(document.activeElement)){var rng=editor.selection.getRng();if(rng.collapsed){var caretRange=renderRangeCaret(editor,rng,false);editor.selection.setRng(caretRange);}}},0);editor.on('focus',function(){renderFocusCaret.throttle();});editor.on('blur',function(){renderFocusCaret.cancel();});};var setup=function setup(editor){editor.on('init',function(){editor.on('focusin',function(e){var target=e.target;if(isMedia$2(target)){var ceRoot=getContentEditableRoot$1(editor.getBody(),target);var node=isContentEditableFalse$b(ceRoot)?ceRoot:target;if(editor.selection.getNode()!==node){selectNode(editor,node).each(function(rng){return editor.selection.setRng(rng);});}}});});};var isContentEditableTrue=isContentEditableTrue$4;var isContentEditableFalse=isContentEditableFalse$b;var getContentEditableRoot=function getContentEditableRoot(editor,node){return getContentEditableRoot$1(editor.getBody(),node);};var SelectionOverrides=function SelectionOverrides(editor){var selection=editor.selection,dom=editor.dom;var isBlock=dom.isBlock;var rootNode=editor.getBody();var fakeCaret=FakeCaret(editor,rootNode,isBlock,function(){return hasFocus(editor);});var realSelectionId='sel-'+dom.uniqueId();var elementSelectionAttr='data-mce-selected';var selectedElement;var isFakeSelectionElement=function isFakeSelectionElement(node){return dom.hasClass(node,'mce-offscreen-selection');};var isFakeSelectionTargetElement=function isFakeSelectionTargetElement(node){return node!==rootNode&&(isContentEditableFalse(node)||isMedia$2(node))&&dom.isChildOf(node,rootNode);};var isNearFakeSelectionElement=function isNearFakeSelectionElement(pos){return isBeforeContentEditableFalse(pos)||isAfterContentEditableFalse(pos)||isBeforeMedia(pos)||isAfterMedia(pos);};var getRealSelectionElement=function getRealSelectionElement(){var container=dom.get(realSelectionId);return container?container.getElementsByTagName('*')[0]:container;};var setRange=function setRange(range){if(range){selection.setRng(range);}};var getRange=selection.getRng;var showCaret=function showCaret(direction,node,before,scrollIntoView){if(scrollIntoView===void 0){scrollIntoView=true;}var e=editor.fire('ShowCaret',{target:node,direction:direction,before:before});if(e.isDefaultPrevented()){return null;}if(scrollIntoView){selection.scrollIntoView(node,direction===-1);}return fakeCaret.show(before,node);};var showBlockCaretContainer=function showBlockCaretContainer(blockCaretContainer){if(blockCaretContainer.hasAttribute('data-mce-caret')){showCaretContainerBlock(blockCaretContainer);setRange(getRange());selection.scrollIntoView(blockCaretContainer);}};var registerEvents=function registerEvents(){editor.on('mouseup',function(e){var range=getRange();if(range.collapsed&&isXYInContentArea(editor,e.clientX,e.clientY)){renderCaretAtRange(editor,range,false).each(setRange);}});editor.on('click',function(e){var contentEditableRoot=getContentEditableRoot(editor,e.target);if(contentEditableRoot){if(isContentEditableFalse(contentEditableRoot)){e.preventDefault();editor.focus();}if(isContentEditableTrue(contentEditableRoot)){if(dom.isChildOf(contentEditableRoot,selection.getNode())){removeElementSelection();}}}});editor.on('blur NewBlock',removeElementSelection);editor.on('ResizeWindow FullscreenStateChanged',fakeCaret.reposition);var hasNormalCaretPosition=function hasNormalCaretPosition(elm){var start=elm.firstChild;if(isNullable(start)){return false;}var startPos=_CaretPosition.before(start);if(isBr$5(startPos.getNode())&&elm.childNodes.length===1){return!isNearFakeSelectionElement(startPos);}else{var caretWalker=CaretWalker(elm);var newPos=caretWalker.next(startPos);return newPos&&!isNearFakeSelectionElement(newPos);}};var isInSameBlock=function isInSameBlock(node1,node2){var block1=dom.getParent(node1,isBlock);var block2=dom.getParent(node2,isBlock);return block1===block2;};var hasBetterMouseTarget=function hasBetterMouseTarget(targetNode,caretNode){var targetBlock=dom.getParent(targetNode,isBlock);var caretBlock=dom.getParent(caretNode,isBlock);if(isNullable(targetBlock)){return false;}if(targetNode!==caretBlock&&dom.isChildOf(targetBlock,caretBlock)&&isContentEditableFalse(getContentEditableRoot(editor,targetBlock))===false){return true;}return!dom.isChildOf(caretBlock,targetBlock)&&!isInSameBlock(targetBlock,caretBlock)&&hasNormalCaretPosition(targetBlock);};editor.on('tap',function(e){var targetElm=e.target;var contentEditableRoot=getContentEditableRoot(editor,targetElm);if(isContentEditableFalse(contentEditableRoot)){e.preventDefault();selectNode(editor,contentEditableRoot).each(setElementSelection);}else if(isFakeSelectionTargetElement(targetElm)){selectNode(editor,targetElm).each(setElementSelection);}},true);editor.on('mousedown',function(e){var targetElm=e.target;if(targetElm!==rootNode&&targetElm.nodeName!=='HTML'&&!dom.isChildOf(targetElm,rootNode)){return;}if(isXYInContentArea(editor,e.clientX,e.clientY)===false){return;}var contentEditableRoot=getContentEditableRoot(editor,targetElm);if(contentEditableRoot){if(isContentEditableFalse(contentEditableRoot)){e.preventDefault();selectNode(editor,contentEditableRoot).each(setElementSelection);}else{removeElementSelection();if(!(isContentEditableTrue(contentEditableRoot)&&e.shiftKey)&&!isXYWithinRange(e.clientX,e.clientY,selection.getRng())){hideFakeCaret();selection.placeCaretAt(e.clientX,e.clientY);}}}else if(isFakeSelectionTargetElement(targetElm)){selectNode(editor,targetElm).each(setElementSelection);}else if(isFakeCaretTarget(targetElm)===false){removeElementSelection();hideFakeCaret();var fakeCaretInfo=closestFakeCaret(rootNode,e.clientX,e.clientY);if(fakeCaretInfo){if(!hasBetterMouseTarget(targetElm,fakeCaretInfo.node)){e.preventDefault();var range=showCaret(1,fakeCaretInfo.node,fakeCaretInfo.before,false);setRange(range);editor.getBody().focus();}}}});editor.on('keypress',function(e){if(VK.modifierPressed(e)){return;}if(isContentEditableFalse(selection.getNode())){e.preventDefault();}});editor.on('GetSelectionRange',function(e){var rng=e.range;if(selectedElement){if(!selectedElement.parentNode){selectedElement=null;return;}rng=rng.cloneRange();rng.selectNode(selectedElement);e.range=rng;}});editor.on('SetSelectionRange',function(e){e.range=normalizeShortEndedElementSelection(e.range);var rng=setElementSelection(e.range,e.forward);if(rng){e.range=rng;}});var isPasteBin=function isPasteBin(node){return node.id==='mcepastebin';};editor.on('AfterSetSelectionRange',function(e){var rng=e.range;var parentNode=rng.startContainer.parentNode;if(!isRangeInCaretContainer(rng)&&!isPasteBin(parentNode)){hideFakeCaret();}if(!isFakeSelectionElement(parentNode)){removeElementSelection();}});editor.on('copy',function(e){var clipboardData=e.clipboardData;if(!e.isDefaultPrevented()&&e.clipboardData&&!Env.ie){var realSelectionElement=getRealSelectionElement();if(realSelectionElement){e.preventDefault();clipboardData.clearData();clipboardData.setData('text/html',realSelectionElement.outerHTML);clipboardData.setData('text/plain',realSelectionElement.outerText||realSelectionElement.innerText);}}});init$2(editor);setup$1(editor);setup(editor);};var isWithinCaretContainer=function isWithinCaretContainer(node){return isCaretContainer$2(node)||startsWithCaretContainer$1(node)||endsWithCaretContainer$1(node);};var isRangeInCaretContainer=function isRangeInCaretContainer(rng){return isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer);};var normalizeShortEndedElementSelection=function normalizeShortEndedElementSelection(rng){var shortEndedElements=editor.schema.getShortEndedElements();var newRng=dom.createRng();var startContainer=rng.startContainer;var startOffset=rng.startOffset;var endContainer=rng.endContainer;var endOffset=rng.endOffset;if(has$2(shortEndedElements,startContainer.nodeName.toLowerCase())){if(startOffset===0){newRng.setStartBefore(startContainer);}else{newRng.setStartAfter(startContainer);}}else{newRng.setStart(startContainer,startOffset);}if(has$2(shortEndedElements,endContainer.nodeName.toLowerCase())){if(endOffset===0){newRng.setEndBefore(endContainer);}else{newRng.setEndAfter(endContainer);}}else{newRng.setEnd(endContainer,endOffset);}return newRng;};var setupOffscreenSelection=function setupOffscreenSelection(node,targetClone,origTargetClone){var $=editor.$;var $realSelectionContainer=descendant(SugarElement.fromDom(editor.getBody()),'#'+realSelectionId).fold(function(){return $([]);},function(elm){return $([elm.dom]);});if($realSelectionContainer.length===0){$realSelectionContainer=$('<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>').attr('id',realSelectionId);$realSelectionContainer.appendTo(editor.getBody());}var newRange=dom.createRng();if(targetClone===origTargetClone&&Env.ie){$realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\xA0</p>').append(targetClone);newRange.setStartAfter($realSelectionContainer[0].firstChild.firstChild);newRange.setEndAfter(targetClone);}else{$realSelectionContainer.empty().append(nbsp).append(targetClone).append(nbsp);newRange.setStart($realSelectionContainer[0].firstChild,1);newRange.setEnd($realSelectionContainer[0].lastChild,0);}$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y});$realSelectionContainer[0].focus();var sel=selection.getSel();sel.removeAllRanges();sel.addRange(newRange);return newRange;};var selectElement=function selectElement(elm){var targetClone=elm.cloneNode(true);var e=editor.fire('ObjectSelected',{target:elm,targetClone:targetClone});if(e.isDefaultPrevented()){return null;}var range=setupOffscreenSelection(elm,e.targetClone,targetClone);var nodeElm=SugarElement.fromDom(elm);each$k(descendants(SugarElement.fromDom(editor.getBody()),'*[data-mce-selected]'),function(elm){if(!eq(nodeElm,elm)){remove$6(elm,elementSelectionAttr);}});if(!dom.getAttrib(elm,elementSelectionAttr)){elm.setAttribute(elementSelectionAttr,'1');}selectedElement=elm;hideFakeCaret();return range;};var setElementSelection=function setElementSelection(range,forward){if(!range){return null;}if(range.collapsed){if(!isRangeInCaretContainer(range)){var dir=forward?1:-1;var caretPosition=getNormalizedRangeEndPoint(dir,rootNode,range);var beforeNode=caretPosition.getNode(!forward);if(isFakeCaretTarget(beforeNode)){return showCaret(dir,beforeNode,forward?!caretPosition.isAtEnd():false,false);}var afterNode=caretPosition.getNode(forward);if(isFakeCaretTarget(afterNode)){return showCaret(dir,afterNode,forward?false:!caretPosition.isAtEnd(),false);}}return null;}var startContainer=range.startContainer;var startOffset=range.startOffset;var endOffset=range.endOffset;if(startContainer.nodeType===3&&startOffset===0&&isContentEditableFalse(startContainer.parentNode)){startContainer=startContainer.parentNode;startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode;}if(startContainer.nodeType!==1){return null;}if(endOffset===startOffset+1&&startContainer===range.endContainer){var node=startContainer.childNodes[startOffset];if(isFakeSelectionTargetElement(node)){return selectElement(node);}}return null;};var removeElementSelection=function removeElementSelection(){if(selectedElement){selectedElement.removeAttribute(elementSelectionAttr);}descendant(SugarElement.fromDom(editor.getBody()),'#'+realSelectionId).each(remove$7);selectedElement=null;};var destroy=function destroy(){fakeCaret.destroy();selectedElement=null;};var hideFakeCaret=function hideFakeCaret(){fakeCaret.hide();};if(Env.ceFalse&&!isRtc(editor)){registerEvents();}return{showCaret:showCaret,showBlockCaretContainer:showBlockCaretContainer,hideFakeCaret:hideFakeCaret,destroy:destroy};};var Quirks=function Quirks(editor){var each=Tools.each;var BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,parser=editor.parser;var isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit;var mceInternalUrlPrefix='data:text/mce-internal,';var mceInternalDataType=isIE?'Text':'URL';var setEditorCommandState=function setEditorCommandState(cmd,state){try{editor.getDoc().execCommand(cmd,false,state);}catch(ex){}};var isDefaultPrevented=function isDefaultPrevented(e){return e.isDefaultPrevented();};var setMceInternalContent=function setMceInternalContent(e){var selectionHtml,internalContent;if(e.dataTransfer){if(editor.selection.isCollapsed()&&e.target.tagName==='IMG'){selection.select(e.target);}selectionHtml=editor.selection.getContent();if(selectionHtml.length>0){internalContent=mceInternalUrlPrefix+escape(editor.id)+','+escape(selectionHtml);e.dataTransfer.setData(mceInternalDataType,internalContent);}}};var getMceInternalContent=function getMceInternalContent(e){var internalContent;if(e.dataTransfer){internalContent=e.dataTransfer.getData(mceInternalDataType);if(internalContent&&internalContent.indexOf(mceInternalUrlPrefix)>=0){internalContent=internalContent.substr(mceInternalUrlPrefix.length).split(',');return{id:unescape(internalContent[0]),html:unescape(internalContent[1])};}}return null;};var insertClipboardContents=function insertClipboardContents(content,internal){if(editor.queryCommandSupported('mceInsertClipboardContent')){editor.execCommand('mceInsertClipboardContent',false,{content:content,internal:internal});}else{editor.execCommand('mceInsertContent',false,content);}};var emptyEditorWhenDeleting=function emptyEditorWhenDeleting(){var serializeRng=function serializeRng(rng){var body=dom.create('body');var contents=rng.cloneContents();body.appendChild(contents);return selection.serializer.serialize(body,{format:'html'});};var allContentsSelected=function allContentsSelected(rng){var selection=serializeRng(rng);var allRng=dom.createRng();allRng.selectNode(editor.getBody());var allSelection=serializeRng(allRng);return selection===allSelection;};editor.on('keydown',function(e){var keyCode=e.keyCode;var isCollapsed,body;if(!isDefaultPrevented(e)&&(keyCode===DELETE||keyCode===BACKSPACE)){isCollapsed=editor.selection.isCollapsed();body=editor.getBody();if(isCollapsed&&!dom.isEmpty(body)){return;}if(!isCollapsed&&!allContentsSelected(editor.selection.getRng())){return;}e.preventDefault();editor.setContent('');if(body.firstChild&&dom.isBlock(body.firstChild)){editor.selection.setCursorLocation(body.firstChild,0);}else{editor.selection.setCursorLocation(body,0);}editor.nodeChanged();}});};var selectAll=function selectAll(){editor.shortcuts.add('meta+a',null,'SelectAll');};var documentElementEditingFocus=function documentElementEditingFocus(){if(!editor.inline){dom.bind(editor.getDoc(),'mousedown mouseup',function(e){var rng;if(e.target===editor.getDoc().documentElement){rng=selection.getRng();editor.getBody().focus();if(e.type==='mousedown'){if(isCaretContainer$2(rng.startContainer)){return;}selection.placeCaretAt(e.clientX,e.clientY);}else{selection.setRng(rng);}}});}};var removeHrOnBackspace=function removeHrOnBackspace(){editor.on('keydown',function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName('hr').length){return;}if(selection.isCollapsed()&&selection.getRng().startOffset===0){var node=selection.getNode();var previousSibling=node.previousSibling;if(node.nodeName==='HR'){dom.remove(node);e.preventDefault();return;}if(previousSibling&&previousSibling.nodeName&&previousSibling.nodeName.toLowerCase()==='hr'){dom.remove(previousSibling);e.preventDefault();}}}});};var focusBody=function focusBody(){if(!Range.prototype.getClientRects){editor.on('mousedown',function(e){if(!isDefaultPrevented(e)&&e.target.nodeName==='HTML'){var body_1=editor.getBody();body_1.blur();Delay.setEditorTimeout(editor,function(){body_1.focus();});}});}};var selectControlElements=function selectControlElements(){editor.on('click',function(e){var target=e.target;if(/^(IMG|HR)$/.test(target.nodeName)&&dom.getContentEditableParent(target)!=='false'){e.preventDefault();editor.selection.select(target);editor.nodeChanged();}if(target.nodeName==='A'&&dom.hasClass(target,'mce-item-anchor')){e.preventDefault();selection.select(target);}});};var removeStylesWhenDeletingAcrossBlockElements=function removeStylesWhenDeletingAcrossBlockElements(){var getAttributeApplyFunction=function getAttributeApplyFunction(){var template=dom.getAttribs(selection.getStart().cloneNode(false));return function(){var target=selection.getStart();if(target!==editor.getBody()){dom.setAttrib(target,'style',null);each(template,function(attr){target.setAttributeNode(attr.cloneNode(true));});}};};var isSelectionAcrossElements=function isSelectionAcrossElements(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!==dom.getParent(selection.getEnd(),dom.isBlock);};editor.on('keypress',function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(e.keyCode===8||e.keyCode===46)&&isSelectionAcrossElements()){applyAttributes=getAttributeApplyFunction();editor.getDoc().execCommand('delete',false,null);applyAttributes();e.preventDefault();return false;}});dom.bind(editor.getDoc(),'cut',function(e){var applyAttributes;if(!isDefaultPrevented(e)&&isSelectionAcrossElements()){applyAttributes=getAttributeApplyFunction();Delay.setEditorTimeout(editor,function(){applyAttributes();});}});};var disableBackspaceIntoATable=function disableBackspaceIntoATable(){editor.on('keydown',function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(selection.isCollapsed()&&selection.getRng().startOffset===0){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&previousSibling.nodeName.toLowerCase()==='table'){e.preventDefault();return false;}}}});};var removeBlockQuoteOnBackSpace=function removeBlockQuoteOnBackSpace(){editor.on('keydown',function(e){var rng,parent;if(isDefaultPrevented(e)||e.keyCode!==VK.BACKSPACE){return;}rng=selection.getRng();var container=rng.startContainer;var offset=rng.startOffset;var root=dom.getRoot();parent=container;if(!rng.collapsed||offset!==0){return;}while(parent&&parent.parentNode&&parent.parentNode.firstChild===parent&&parent.parentNode!==root){parent=parent.parentNode;}if(parent.tagName==='BLOCKQUOTE'){editor.formatter.toggle('blockquote',null,parent);rng=dom.createRng();rng.setStart(container,0);rng.setEnd(container,0);selection.setRng(rng);}});};var setGeckoEditingOptions=function setGeckoEditingOptions(){var setOpts=function setOpts(){setEditorCommandState('StyleWithCSS',false);setEditorCommandState('enableInlineTableEditing',false);if(!getObjectResizing(editor)){setEditorCommandState('enableObjectResizing',false);}};if(!isReadOnly$1(editor)){editor.on('BeforeExecCommand mousedown',setOpts);}};var addBrAfterLastLinks=function addBrAfterLastLinks(){var fixLinks=function fixLinks(){each(dom.select('a'),function(node){var parentNode=node.parentNode;var root=dom.getRoot();if(parentNode.lastChild===node){while(parentNode&&!dom.isBlock(parentNode)){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root){return;}parentNode=parentNode.parentNode;}dom.add(parentNode,'br',{'data-mce-bogus':1});}});};editor.on('SetContent ExecCommand',function(e){if(e.type==='setcontent'||e.command==='mceInsertLink'){fixLinks();}});};var setDefaultBlockType=function setDefaultBlockType(){if(getForcedRootBlock(editor)){editor.on('init',function(){setEditorCommandState('DefaultParagraphSeparator',getForcedRootBlock(editor));});}};var normalizeSelection=function normalizeSelection(){editor.on('keyup focusin mouseup',function(e){if(!VK.modifierPressed(e)){selection.normalize();}},true);};var showBrokenImageIcon=function showBrokenImageIcon(){editor.contentStyles.push('img:-moz-broken {'+'-moz-force-broken-image-icon:1;'+'min-width:24px;'+'min-height:24px'+'}');};var restoreFocusOnKeyDown=function restoreFocusOnKeyDown(){if(!editor.inline){editor.on('keydown',function(){if(document.activeElement===document.body){editor.getWin().focus();}});}};var bodyHeight=function bodyHeight(){if(!editor.inline){editor.contentStyles.push('body {min-height: 150px}');editor.on('click',function(e){var rng;if(e.target.nodeName==='HTML'){if(Env.ie>11){editor.getBody().focus();return;}rng=editor.selection.getRng();editor.getBody().focus();editor.selection.setRng(rng);editor.selection.normalize();editor.nodeChanged();}});}};var blockCmdArrowNavigation=function blockCmdArrowNavigation(){if(Env.mac){editor.on('keydown',function(e){if(VK.metaKeyPressed(e)&&!e.shiftKey&&(e.keyCode===37||e.keyCode===39)){e.preventDefault();var selection_1=editor.selection.getSel();selection_1.modify('move',e.keyCode===37?'backward':'forward','lineboundary');}});}};var disableAutoUrlDetect=function disableAutoUrlDetect(){setEditorCommandState('AutoUrlDetect',false);};var tapLinksAndImages=function tapLinksAndImages(){editor.on('click',function(e){var elm=e.target;do{if(elm.tagName==='A'){e.preventDefault();return;}}while(elm=elm.parentNode);});editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');};var blockFormSubmitInsideEditor=function blockFormSubmitInsideEditor(){editor.on('init',function(){editor.dom.bind(editor.getBody(),'submit',function(e){e.preventDefault();});});};var removeAppleInterchangeBrs=function removeAppleInterchangeBrs(){parser.addNodeFilter('br',function(nodes){var i=nodes.length;while(i--){if(nodes[i].attr('class')==='Apple-interchange-newline'){nodes[i].remove();}}});};var ieInternalDragAndDrop=function ieInternalDragAndDrop(){editor.on('dragstart',function(e){setMceInternalContent(e);});editor.on('drop',function(e){if(!isDefaultPrevented(e)){var internalContent=getMceInternalContent(e);if(internalContent&&internalContent.id!==editor.id){e.preventDefault();var rng=fromPoint(e.x,e.y,editor.getDoc());selection.setRng(rng);insertClipboardContents(internalContent.html,true);}}});};var refreshContentEditable=noop;var isHidden=function isHidden(){if(!isGecko||editor.removed){return false;}var sel=editor.selection.getSel();return!sel||!sel.rangeCount||sel.rangeCount===0;};var setupRtc=function setupRtc(){if(isWebKit){documentElementEditingFocus();selectControlElements();blockFormSubmitInsideEditor();selectAll();if(Env.iOS){restoreFocusOnKeyDown();bodyHeight();tapLinksAndImages();}}if(isGecko){focusBody();setGeckoEditingOptions();showBrokenImageIcon();blockCmdArrowNavigation();}};var setup=function setup(){removeBlockQuoteOnBackSpace();emptyEditorWhenDeleting();if(!Env.windowsPhone){normalizeSelection();}if(isWebKit){documentElementEditingFocus();selectControlElements();setDefaultBlockType();blockFormSubmitInsideEditor();disableBackspaceIntoATable();removeAppleInterchangeBrs();if(Env.iOS){restoreFocusOnKeyDown();bodyHeight();tapLinksAndImages();}else{selectAll();}}if(Env.ie>=11){bodyHeight();disableBackspaceIntoATable();}if(Env.ie){selectAll();disableAutoUrlDetect();ieInternalDragAndDrop();}if(isGecko){removeHrOnBackspace();focusBody();removeStylesWhenDeletingAcrossBlockElements();setGeckoEditingOptions();addBrAfterLastLinks();showBrokenImageIcon();blockCmdArrowNavigation();disableBackspaceIntoATable();}};if(isRtc(editor)){setupRtc();}else{setup();}return{refreshContentEditable:refreshContentEditable,isHidden:isHidden};};var DOM$6=_DOMUtils.DOM;var appendStyle=function appendStyle(editor,text){var body=SugarElement.fromDom(editor.getBody());var container=getStyleContainer(getRootNode(body));var style=SugarElement.fromTag('style');set$1(style,'type','text/css');append$1(style,SugarElement.fromText(text));append$1(container,style);editor.on('remove',function(){remove$7(style);});};var getRootName=function getRootName(editor){return editor.inline?editor.getElement().nodeName.toLowerCase():undefined;};var removeUndefined=function removeUndefined(obj){return filter$3(obj,function(v){return isUndefined(v)===false;});};var mkSchemaSettings=function mkSchemaSettings(editor){var settings=editor.settings;return removeUndefined({block_elements:settings.block_elements,boolean_attributes:settings.boolean_attributes,custom_elements:settings.custom_elements,extended_valid_elements:settings.extended_valid_elements,invalid_elements:settings.invalid_elements,invalid_styles:settings.invalid_styles,move_caret_before_on_enter_elements:settings.move_caret_before_on_enter_elements,non_empty_elements:settings.non_empty_elements,schema:settings.schema,self_closing_elements:settings.self_closing_elements,short_ended_elements:settings.short_ended_elements,special:settings.special,text_block_elements:settings.text_block_elements,text_inline_elements:settings.text_inline_elements,valid_children:settings.valid_children,valid_classes:settings.valid_classes,valid_elements:settings.valid_elements,valid_styles:settings.valid_styles,verify_html:settings.verify_html,whitespace_elements:settings.whitespace_elements,padd_empty_block_inline_children:settings.format_empty_lines});};var mkParserSettings=function mkParserSettings(editor){var settings=editor.settings;var blobCache=editor.editorUpload.blobCache;return removeUndefined({allow_conditional_comments:settings.allow_conditional_comments,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_html_in_named_anchor:settings.allow_html_in_named_anchor,allow_script_urls:settings.allow_script_urls,allow_unsafe_link_target:settings.allow_unsafe_link_target,convert_fonts_to_spans:settings.convert_fonts_to_spans,fix_list_elements:settings.fix_list_elements,font_size_legacy_values:settings.font_size_legacy_values,forced_root_block:settings.forced_root_block,forced_root_block_attrs:settings.forced_root_block_attrs,padd_empty_with_br:settings.padd_empty_with_br,preserve_cdata:settings.preserve_cdata,remove_trailing_brs:settings.remove_trailing_brs,inline_styles:settings.inline_styles,root_name:getRootName(editor),validate:true,blob_cache:blobCache,document:editor.getDoc(),images_dataimg_filter:settings.images_dataimg_filter});};var mkSerializerSettings=function mkSerializerSettings(editor){var settings=editor.settings;return _assign(_assign(_assign({},mkParserSettings(editor)),mkSchemaSettings(editor)),removeUndefined({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope,element_format:settings.element_format,entities:settings.entities,entity_encoding:settings.entity_encoding,indent:settings.indent,indent_after:settings.indent_after,indent_before:settings.indent_before}));};var createParser=function createParser(editor){var parser=DomParser(mkParserSettings(editor),editor.schema);parser.addAttributeFilter('src,href,style,tabindex',function(nodes,name){var i=nodes.length,node,value;var dom=editor.dom;var internalName='data-mce-'+name;while(i--){node=nodes[i];value=node.attr(name);if(value&&!node.attr(internalName)){if(value.indexOf('data:')===0||value.indexOf('blob:')===0){continue;}if(name==='style'){value=dom.serializeStyle(dom.parseStyle(value),node.name);if(!value.length){value=null;}node.attr(internalName,value);node.attr(name,value);}else if(name==='tabindex'){node.attr(internalName,value);node.attr(name,null);}else{node.attr(internalName,editor.convertURL(value,name,node.name));}}}});parser.addNodeFilter('script',function(nodes){var i=nodes.length;while(i--){var node=nodes[i];var type=node.attr('type')||'no/type';if(type.indexOf('mce-')!==0){node.attr('type','mce-'+type);}}});if(editor.settings.preserve_cdata){parser.addNodeFilter('#cdata',function(nodes){var i=nodes.length;while(i--){var node=nodes[i];node.type=8;node.name='#comment';node.value='[CDATA['+editor.dom.encode(node.value)+']]';}});}parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div',function(nodes){var i=nodes.length;var nonEmptyElements=editor.schema.getNonEmptyElements();while(i--){var node=nodes[i];if(node.isEmpty(nonEmptyElements)&&node.getAll('br').length===0){node.append(new AstNode('br',1)).shortEnded=true;}}});return parser;};var autoFocus=function autoFocus(editor){if(editor.settings.auto_focus){Delay.setEditorTimeout(editor,function(){var focusEditor;if(editor.settings.auto_focus===true){focusEditor=editor;}else{focusEditor=editor.editorManager.get(editor.settings.auto_focus);}if(!focusEditor.destroyed){focusEditor.focus();}},100);}};var moveSelectionToFirstCaretPosition=function moveSelectionToFirstCaretPosition(editor){var root=editor.dom.getRoot();if(!editor.inline&&(!hasAnyRanges(editor)||editor.selection.getStart(true)===root)){firstPositionIn(root).each(function(pos){var node=pos.getNode();var caretPos=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;if(Env.browser.isIE()){storeNative(editor,caretPos.toRange());}else{editor.selection.setRng(caretPos.toRange());}});}};var initEditor=function initEditor(editor){editor.bindPendingEventDelegates();editor.initialized=true;fireInit(editor);editor.focus(true);moveSelectionToFirstCaretPosition(editor);editor.nodeChanged({initial:true});editor.execCallback('init_instance_callback',editor);autoFocus(editor);};var getStyleSheetLoader$1=function getStyleSheetLoader$1(editor){return editor.inline?editor.ui.styleSheetLoader:editor.dom.styleSheetLoader;};var makeStylesheetLoadingPromises=function makeStylesheetLoadingPromises(editor,css,framedFonts){var promises=[new promiseObj(function(resolve,reject){return getStyleSheetLoader$1(editor).loadAll(css,resolve,reject);})];if(editor.inline){return promises;}else{return promises.concat([new promiseObj(function(resolve,reject){return editor.ui.styleSheetLoader.loadAll(framedFonts,resolve,reject);})]);}};var loadContentCss=function loadContentCss(editor){var styleSheetLoader=getStyleSheetLoader$1(editor);var fontCss=getFontCss(editor);var css=editor.contentCSS;var removeCss=function removeCss(){styleSheetLoader.unloadAll(css);if(!editor.inline){editor.ui.styleSheetLoader.unloadAll(fontCss);}};var loaded=function loaded(){if(editor.removed){removeCss();}else{editor.on('remove',removeCss);}};if(editor.contentStyles.length>0){var contentCssText_1='';Tools.each(editor.contentStyles,function(style){contentCssText_1+=style+'\\r\\n';});editor.dom.addStyle(contentCssText_1);}var allStylesheets=promiseObj.all(makeStylesheetLoadingPromises(editor,css,fontCss)).then(loaded).catch(loaded);if(editor.settings.content_style){appendStyle(editor,editor.settings.content_style);}return allStylesheets;};var preInit=function preInit(editor){var settings=editor.settings,doc=editor.getDoc(),body=editor.getBody();firePreInit(editor);if(!settings.browser_spellcheck&&!settings.gecko_spellcheck){doc.body.spellcheck=false;DOM$6.setAttrib(body,'spellcheck','false');}editor.quirks=Quirks(editor);firePostRender(editor);var directionality=getDirectionality(editor);if(directionality!==undefined){body.dir=directionality;}if(settings.protect){editor.on('BeforeSetContent',function(e){Tools.each(settings.protect,function(pattern){e.content=e.content.replace(pattern,function(str){return'<!--mce:protected '+escape(str)+'-->';});});});}editor.on('SetContent',function(){editor.addVisual(editor.getBody());});editor.on('compositionstart compositionend',function(e){editor.composing=e.type==='compositionstart';});};var loadInitialContent=function loadInitialContent(editor){if(!isRtc(editor)){editor.load({initial:true,format:'html'});}editor.startContent=editor.getContent({format:'raw'});};var initEditorWithInitialContent=function initEditorWithInitialContent(editor){if(editor.removed!==true){loadInitialContent(editor);initEditor(editor);}};var initContentBody=function initContentBody(editor,skipWrite){var settings=editor.settings;var targetElm=editor.getElement();var doc=editor.getDoc();if(!settings.inline){editor.getElement().style.visibility=editor.orgVisibility;}if(!skipWrite&&!editor.inline){doc.open();doc.write(editor.iframeHTML);doc.close();}if(editor.inline){DOM$6.addClass(targetElm,'mce-content-body');editor.contentDocument=doc=document;editor.contentWindow=window;editor.bodyElement=targetElm;editor.contentAreaContainer=targetElm;}var body=editor.getBody();body.disabled=true;editor.readonly=!!settings.readonly;if(!editor.readonly){if(editor.inline&&DOM$6.getStyle(body,'position',true)==='static'){body.style.position='relative';}body.contentEditable=editor.getParam('content_editable_state',true);}body.disabled=false;editor.editorUpload=EditorUpload(editor);editor.schema=Schema(mkSchemaSettings(editor));editor.dom=_DOMUtils(doc,{keep_values:true,url_converter:editor.convertURL,url_converter_scope:editor,hex_colors:settings.force_hex_style_colors,update_styles:true,root_element:editor.inline?editor.getBody():null,collect:function collect(){return editor.inline;},schema:editor.schema,contentCssCors:shouldUseContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor),onSetAttrib:function onSetAttrib(e){editor.fire('SetAttrib',e);}});editor.parser=createParser(editor);editor.serializer=DomSerializer(mkSerializerSettings(editor),editor);editor.selection=EditorSelection(editor.dom,editor.getWin(),editor.serializer,editor);editor.annotator=Annotator(editor);editor.formatter=Formatter(editor);editor.undoManager=UndoManager(editor);editor._nodeChangeDispatcher=new NodeChange(editor);editor._selectionOverrides=SelectionOverrides(editor);setup$e(editor);setup$3(editor);if(!isRtc(editor)){setup$2(editor);}var caret=setup$4(editor);setup$f(editor,caret);setup$d(editor);setup$g(editor);var setupRtcThunk=setup$i(editor);preInit(editor);setupRtcThunk.fold(function(){loadContentCss(editor).then(function(){return initEditorWithInitialContent(editor);});},function(setupRtc){editor.setProgressState(true);loadContentCss(editor).then(function(){setupRtc().then(function(_rtcMode){editor.setProgressState(false);initEditorWithInitialContent(editor);},function(err){editor.notificationManager.open({type:'error',text:String(err)});initEditorWithInitialContent(editor);});});});};var DOM$5=_DOMUtils.DOM;var relaxDomain=function relaxDomain(editor,ifr){if(document.domain!==window.location.hostname&&Env.browser.isIE()){var bodyUuid=uuid('mce');editor[bodyUuid]=function(){initContentBody(editor);};var domainRelaxUrl='javascript:(function(){'+'document.open();document.domain=\"'+document.domain+'\";'+'var ed = window.parent.tinymce.get(\"'+editor.id+'\");document.write(ed.iframeHTML);'+'document.close();ed.'+bodyUuid+'(true);})()';DOM$5.setAttrib(ifr,'src',domainRelaxUrl);return true;}return false;};var createIframeElement=function createIframeElement(id,title,height,customAttrs){var iframe=SugarElement.fromTag('iframe');setAll$1(iframe,customAttrs);setAll$1(iframe,{id:id+'_ifr',frameBorder:'0',allowTransparency:'true',title:title});add$1(iframe,'tox-edit-area__iframe');return iframe;};var getIframeHtml=function getIframeHtml(editor){var iframeHTML=getDocType(editor)+'<html><head>';if(getDocumentBaseUrl(editor)!==editor.documentBaseUrl){iframeHTML+='<base href=\"'+editor.documentBaseURI.getURI()+'\" />';}iframeHTML+='<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';var bodyId=getBodyId(editor);var bodyClass=getBodyClass(editor);var translatedAriaText=editor.translate(getIframeAriaText(editor));if(getContentSecurityPolicy(editor)){iframeHTML+='<meta http-equiv=\"Content-Security-Policy\" content=\"'+getContentSecurityPolicy(editor)+'\" />';}iframeHTML+='</head>'+('<body id=\"'+bodyId+'\" class=\"mce-content-body '+bodyClass+'\" data-id=\"'+editor.id+'\" aria-label=\"'+translatedAriaText+'\">')+'<br>'+'</body></html>';return iframeHTML;};var createIframe=function createIframe(editor,o){var iframeTitle=editor.translate('Rich Text Area');var ifr=createIframeElement(editor.id,iframeTitle,o.height,getIframeAttrs(editor)).dom;ifr.onload=function(){ifr.onload=null;editor.fire('load');};var isDomainRelaxed=relaxDomain(editor,ifr);editor.contentAreaContainer=o.iframeContainer;editor.iframeElement=ifr;editor.iframeHTML=getIframeHtml(editor);DOM$5.add(o.iframeContainer,ifr);return isDomainRelaxed;};var init$1=function init$1(editor,boxInfo){var isDomainRelaxed=createIframe(editor,boxInfo);if(boxInfo.editorContainer){DOM$5.get(boxInfo.editorContainer).style.display=editor.orgDisplay;editor.hidden=DOM$5.isHidden(boxInfo.editorContainer);}editor.getElement().style.display='none';DOM$5.setAttrib(editor.id,'aria-hidden','true');if(!isDomainRelaxed){initContentBody(editor);}};var DOM$4=_DOMUtils.DOM;var _initPlugin=function initPlugin(editor,initializedPlugins,plugin){var Plugin=PluginManager.get(plugin);var pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\\/$/,'');plugin=Tools.trim(plugin);if(Plugin&&Tools.inArray(initializedPlugins,plugin)===-1){Tools.each(PluginManager.dependencies(plugin),function(dep){_initPlugin(editor,initializedPlugins,dep);});if(editor.plugins[plugin]){return;}try{var pluginInstance=new Plugin(editor,pluginUrl,editor.$);editor.plugins[plugin]=pluginInstance;if(pluginInstance.init){pluginInstance.init(editor,pluginUrl);initializedPlugins.push(plugin);}}catch(e){pluginInitError(editor,plugin,e);}}};var trimLegacyPrefix=function trimLegacyPrefix(name){return name.replace(/^\\-/,'');};var initPlugins=function initPlugins(editor){var initializedPlugins=[];Tools.each(getPlugins(editor).split(/[ ,]/),function(name){_initPlugin(editor,initializedPlugins,trimLegacyPrefix(name));});};var initIcons=function initIcons(editor){var iconPackName=Tools.trim(getIconPackName(editor));var currentIcons=editor.ui.registry.getAll().icons;var loadIcons=_assign(_assign({},IconManager.get('default').icons),IconManager.get(iconPackName).icons);each$j(loadIcons,function(svgData,icon){if(!has$2(currentIcons,icon)){editor.ui.registry.addIcon(icon,svgData);}});};var initTheme=function initTheme(editor){var theme=getTheme(editor);if(isString$1(theme)){editor.settings.theme=trimLegacyPrefix(theme);var Theme=ThemeManager.get(theme);editor.theme=new Theme(editor,ThemeManager.urls[theme]);if(editor.theme.init){editor.theme.init(editor,ThemeManager.urls[theme]||editor.documentBaseUrl.replace(/\\/$/,''),editor.$);}}else{editor.theme={};}};var renderFromLoadedTheme=function renderFromLoadedTheme(editor){return editor.theme.renderUI();};var renderFromThemeFunc=function renderFromThemeFunc(editor){var elm=editor.getElement();var theme=getTheme(editor);var info=theme(editor,elm);if(info.editorContainer.nodeType){info.editorContainer.id=info.editorContainer.id||editor.id+'_parent';}if(info.iframeContainer&&info.iframeContainer.nodeType){info.iframeContainer.id=info.iframeContainer.id||editor.id+'_iframecontainer';}info.height=info.iframeHeight?info.iframeHeight:elm.offsetHeight;return info;};var createThemeFalseResult=function createThemeFalseResult(element){return{editorContainer:element,iframeContainer:element,api:{}};};var renderThemeFalseIframe=function renderThemeFalseIframe(targetElement){var iframeContainer=DOM$4.create('div');DOM$4.insertAfter(iframeContainer,targetElement);return createThemeFalseResult(iframeContainer);};var renderThemeFalse=function renderThemeFalse(editor){var targetElement=editor.getElement();return editor.inline?createThemeFalseResult(null):renderThemeFalseIframe(targetElement);};var renderThemeUi=function renderThemeUi(editor){var elm=editor.getElement();editor.orgDisplay=elm.style.display;if(isString$1(getTheme(editor))){return renderFromLoadedTheme(editor);}else if(isFunction(getTheme(editor))){return renderFromThemeFunc(editor);}else{return renderThemeFalse(editor);}};var augmentEditorUiApi=function augmentEditorUiApi(editor,api){var uiApiFacade={show:Optional.from(api.show).getOr(noop),hide:Optional.from(api.hide).getOr(noop),disable:Optional.from(api.disable).getOr(noop),isDisabled:Optional.from(api.isDisabled).getOr(never),enable:function enable(){if(!editor.mode.isReadOnly()){Optional.from(api.enable).map(call);}}};editor.ui=_assign(_assign({},editor.ui),uiApiFacade);};var init=function init(editor){editor.fire('ScriptsLoaded');initIcons(editor);initTheme(editor);initPlugins(editor);var renderInfo=renderThemeUi(editor);augmentEditorUiApi(editor,Optional.from(renderInfo.api).getOr({}));var boxInfo={editorContainer:renderInfo.editorContainer,iframeContainer:renderInfo.iframeContainer};editor.editorContainer=boxInfo.editorContainer?boxInfo.editorContainer:null;appendContentCssFromSettings(editor);if(editor.inline){return initContentBody(editor);}else{return init$1(editor,boxInfo);}};var DOM$3=_DOMUtils.DOM;var hasSkipLoadPrefix=function hasSkipLoadPrefix(name){return name.charAt(0)==='-';};var loadLanguage=function loadLanguage(scriptLoader,editor){var languageCode=getLanguageCode(editor);var languageUrl=getLanguageUrl(editor);if(I18n.hasCode(languageCode)===false&&languageCode!=='en'){var url_1=languageUrl!==''?languageUrl:editor.editorManager.baseURL+'/langs/'+languageCode+'.js';scriptLoader.add(url_1,noop,undefined,function(){languageLoadError(editor,url_1,languageCode);});}};var loadTheme=function loadTheme(scriptLoader,editor,suffix,callback){var theme=getTheme(editor);if(isString$1(theme)){if(!hasSkipLoadPrefix(theme)&&!has$2(ThemeManager.urls,theme)){var themeUrl=getThemeUrl(editor);if(themeUrl){ThemeManager.load(theme,editor.documentBaseURI.toAbsolute(themeUrl));}else{ThemeManager.load(theme,'themes/'+theme+'/theme'+suffix+'.js');}}scriptLoader.loadQueue(function(){ThemeManager.waitFor(theme,callback);});}else{callback();}};var getIconsUrlMetaFromUrl=function getIconsUrlMetaFromUrl(editor){return Optional.from(getIconsUrl(editor)).filter(function(url){return url.length>0;}).map(function(url){return{url:url,name:Optional.none()};});};var getIconsUrlMetaFromName=function getIconsUrlMetaFromName(editor,name,suffix){return Optional.from(name).filter(function(name){return name.length>0&&!IconManager.has(name);}).map(function(name){return{url:editor.editorManager.baseURL+'/icons/'+name+'/icons'+suffix+'.js',name:Optional.some(name)};});};var loadIcons=function loadIcons(scriptLoader,editor,suffix){var defaultIconsUrl=getIconsUrlMetaFromName(editor,'default',suffix);var customIconsUrl=getIconsUrlMetaFromUrl(editor).orThunk(function(){return getIconsUrlMetaFromName(editor,getIconPackName(editor),'');});each$k(cat([defaultIconsUrl,customIconsUrl]),function(urlMeta){scriptLoader.add(urlMeta.url,noop,undefined,function(){iconsLoadError(editor,urlMeta.url,urlMeta.name.getOrUndefined());});});};var loadPlugins=function loadPlugins(editor,suffix){Tools.each(getExternalPlugins$1(editor),function(url,name){PluginManager.load(name,url,noop,undefined,function(){pluginLoadError(editor,url,name);});editor.settings.plugins+=' '+name;});Tools.each(getPlugins(editor).split(/[ ,]/),function(plugin){plugin=Tools.trim(plugin);if(plugin&&!PluginManager.urls[plugin]){if(hasSkipLoadPrefix(plugin)){plugin=plugin.substr(1,plugin.length);var dependencies=PluginManager.dependencies(plugin);Tools.each(dependencies,function(depPlugin){var defaultSettings={prefix:'plugins/',resource:depPlugin,suffix:'/plugin'+suffix+'.js'};var dep=PluginManager.createUrl(defaultSettings,depPlugin);PluginManager.load(dep.resource,dep,noop,undefined,function(){pluginLoadError(editor,dep.prefix+dep.resource+dep.suffix,dep.resource);});});}else{var url_2={prefix:'plugins/',resource:plugin,suffix:'/plugin'+suffix+'.js'};PluginManager.load(plugin,url_2,noop,undefined,function(){pluginLoadError(editor,url_2.prefix+url_2.resource+url_2.suffix,plugin);});}}});};var loadScripts=function loadScripts(editor,suffix){var scriptLoader=ScriptLoader.ScriptLoader;loadTheme(scriptLoader,editor,suffix,function(){loadLanguage(scriptLoader,editor);loadIcons(scriptLoader,editor,suffix);loadPlugins(editor,suffix);scriptLoader.loadQueue(function(){if(!editor.removed){init(editor);}},editor,function(){if(!editor.removed){init(editor);}});});};var getStyleSheetLoader=function getStyleSheetLoader(element,editor){return instance.forElement(element,{contentCssCors:hasContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor)});};var render=function render(editor){var id=editor.id;I18n.setCode(getLanguageCode(editor));var _readyHandler2=function readyHandler(){DOM$3.unbind(window,'ready',_readyHandler2);editor.render();};if(!EventUtils.Event.domLoaded){DOM$3.bind(window,'ready',_readyHandler2);return;}if(!editor.getElement()){return;}if(!Env.contentEditable){return;}var element=SugarElement.fromDom(editor.getElement());var snapshot=clone$3(element);editor.on('remove',function(){eachr(element.dom.attributes,function(attr){return remove$6(element,attr.name);});setAll$1(element,snapshot);});editor.ui.styleSheetLoader=getStyleSheetLoader(element,editor);if(!isInline(editor)){editor.orgVisibility=editor.getElement().style.visibility;editor.getElement().style.visibility='hidden';}else{editor.inline=true;}var form=editor.getElement().form||DOM$3.getParent(id,'form');if(form){editor.formElement=form;if(hasHiddenInput(editor)&&!isTextareaOrInput(editor.getElement())){DOM$3.insertAfter(DOM$3.create('input',{type:'hidden',name:id}),id);editor.hasHiddenInput=true;}editor.formEventDelegate=function(e){editor.fire(e.type,e);};DOM$3.bind(form,'submit reset',editor.formEventDelegate);editor.on('reset',function(){editor.resetContent();});if(shouldPatchSubmit(editor)&&!form.submit.nodeType&&!form.submit.length&&!form._mceOldSubmit){form._mceOldSubmit=form.submit;form.submit=function(){editor.editorManager.triggerSave();editor.setDirty(false);return form._mceOldSubmit(form);};}}editor.windowManager=WindowManager(editor);editor.notificationManager=NotificationManager(editor);if(isEncodingXml(editor)){editor.on('GetContent',function(e){if(e.save){e.content=DOM$3.encode(e.content);}});}if(shouldAddFormSubmitTrigger(editor)){editor.on('submit',function(){if(editor.initialized){editor.save();}});}if(shouldAddUnloadTrigger(editor)){editor._beforeUnload=function(){if(editor.initialized&&!editor.destroyed&&!editor.isHidden()){editor.save({format:'raw',no_events:true,set_dirty:false});}};editor.editorManager.on('BeforeUnload',editor._beforeUnload);}editor.editorManager.add(editor);loadScripts(editor,editor.suffix);};var addVisual=function addVisual(editor,elm){return addVisual$1(editor,elm);};var legacyPropNames={'font-size':'size','font-family':'face'};var getSpecifiedFontProp=function getSpecifiedFontProp(propName,rootElm,elm){var getProperty=function getProperty(elm){return getRaw(elm,propName).orThunk(function(){if(name(elm)==='font'){return get$9(legacyPropNames,propName).bind(function(legacyPropName){return getOpt(elm,legacyPropName);});}else{return Optional.none();}});};var isRoot=function isRoot(elm){return eq(SugarElement.fromDom(rootElm),elm);};return closest$1(SugarElement.fromDom(elm),function(elm){return getProperty(elm);},isRoot);};var normalizeFontFamily=function normalizeFontFamily(fontFamily){return fontFamily.replace(/[\\'\\\"\\\\]/g,'').replace(/,\\s+/g,',');};var getComputedFontProp=function getComputedFontProp(propName,elm){return Optional.from(_DOMUtils.DOM.getStyle(elm,propName,true));};var getFontProp=function getFontProp(propName){return function(rootElm,elm){return Optional.from(elm).map(SugarElement.fromDom).filter(isElement$6).bind(function(element){return getSpecifiedFontProp(propName,rootElm,element.dom).or(getComputedFontProp(propName,element.dom));}).getOr('');};};var getFontSize=getFontProp('font-size');var getFontFamily=compose(normalizeFontFamily,getFontProp('font-family'));var findFirstCaretElement=function findFirstCaretElement(editor){return firstPositionIn(editor.getBody()).map(function(caret){var container=caret.container();return isText$7(container)?container.parentNode:container;});};var getCaretElement=function getCaretElement(editor){return Optional.from(editor.selection.getRng()).bind(function(rng){var root=editor.getBody();var atStartOfNode=rng.startContainer===root&&rng.startOffset===0;return atStartOfNode?Optional.none():Optional.from(editor.selection.getStart(true));});};var bindRange=function bindRange(editor,binder){return getCaretElement(editor).orThunk(curry(findFirstCaretElement,editor)).map(SugarElement.fromDom).filter(isElement$6).bind(binder);};var mapRange=function mapRange(editor,mapper){return bindRange(editor,compose1(Optional.some,mapper));};var fromFontSizeNumber=function fromFontSizeNumber(editor,value){if(/^[0-9.]+$/.test(value)){var fontSizeNumber=parseInt(value,10);if(fontSizeNumber>=1&&fontSizeNumber<=7){var fontSizes=getFontStyleValues(editor);var fontClasses=getFontSizeClasses(editor);if(fontClasses){return fontClasses[fontSizeNumber-1]||value;}else{return fontSizes[fontSizeNumber-1]||value;}}else{return value;}}else{return value;}};var normalizeFontNames=function normalizeFontNames(font){var fonts=font.split(/\\s*,\\s*/);return map$3(fonts,function(font){if(font.indexOf(' ')!==-1&&!(startsWith(font,'\"')||startsWith(font,'\\''))){return'\\''+font+'\\'';}else{return font;}}).join(',');};var fontNameAction=function fontNameAction(editor,value){var font=fromFontSizeNumber(editor,value);editor.formatter.toggle('fontname',{value:normalizeFontNames(font)});editor.nodeChanged();};var fontNameQuery=function fontNameQuery(editor){return mapRange(editor,function(elm){return getFontFamily(editor.getBody(),elm.dom);}).getOr('');};var fontSizeAction=function fontSizeAction(editor,value){editor.formatter.toggle('fontsize',{value:fromFontSizeNumber(editor,value)});editor.nodeChanged();};var fontSizeQuery=function fontSizeQuery(editor){return mapRange(editor,function(elm){return getFontSize(editor.getBody(),elm.dom);}).getOr('');};var lineHeightQuery=function lineHeightQuery(editor){return mapRange(editor,function(elm){var root=SugarElement.fromDom(editor.getBody());var specifiedStyle=closest$1(elm,function(elm){return getRaw(elm,'line-height');},curry(eq,root));var computedStyle=function computedStyle(){var lineHeight=parseFloat(get$5(elm,'line-height'));var fontSize=parseFloat(get$5(elm,'font-size'));return String(lineHeight/fontSize);};return specifiedStyle.getOrThunk(computedStyle);}).getOr('');};var lineHeightAction=function lineHeightAction(editor,lineHeight){editor.formatter.toggle('lineheight',{value:String(lineHeight)});editor.nodeChanged();};var processValue=function processValue(value){if(typeof value!=='string'){var details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value);return{content:value.content,details:details};}return{content:value,details:{}};};var insertAtCaret=function insertAtCaret(editor,value){var result=processValue(value);insertContent(editor,result.content,result.details);};var each$4=Tools.each;var map=Tools.map,inArray=Tools.inArray;var EditorCommands=function(){function EditorCommands(editor){this.commands={state:{},exec:{},value:{}};this.editor=editor;this.setupCommands(editor);}EditorCommands.prototype.execCommand=function(command,ui,value,args){var func,state=false;var self=this;if(self.editor.removed){return;}if(command.toLowerCase()!=='mcefocus'){if(!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)&&(!args||!args.skip_focus)){self.editor.focus();}else{restore(self.editor);}}args=self.editor.fire('BeforeExecCommand',{command:command,ui:ui,value:value});if(args.isDefaultPrevented()){return false;}var customCommand=command.toLowerCase();if(func=self.commands.exec[customCommand]){func(customCommand,ui,value);self.editor.fire('ExecCommand',{command:command,ui:ui,value:value});return true;}each$4(this.editor.plugins,function(p){if(p.execCommand&&p.execCommand(command,ui,value)){self.editor.fire('ExecCommand',{command:command,ui:ui,value:value});state=true;return false;}});if(state){return state;}if(self.editor.theme&&self.editor.theme.execCommand&&self.editor.theme.execCommand(command,ui,value)){self.editor.fire('ExecCommand',{command:command,ui:ui,value:value});return true;}try{state=self.editor.getDoc().execCommand(command,ui,value);}catch(ex){}if(state){self.editor.fire('ExecCommand',{command:command,ui:ui,value:value});return true;}return false;};EditorCommands.prototype.queryCommandState=function(command){var func;if(this.editor.quirks.isHidden()||this.editor.removed){return;}command=command.toLowerCase();if(func=this.commands.state[command]){return func(command);}try{return this.editor.getDoc().queryCommandState(command);}catch(ex){}return false;};EditorCommands.prototype.queryCommandValue=function(command){var func;if(this.editor.quirks.isHidden()||this.editor.removed){return;}command=command.toLowerCase();if(func=this.commands.value[command]){return func(command);}try{return this.editor.getDoc().queryCommandValue(command);}catch(ex){}};EditorCommands.prototype.addCommands=function(commandList,type){if(type===void 0){type='exec';}var self=this;each$4(commandList,function(callback,command){each$4(command.toLowerCase().split(','),function(command){self.commands[type][command]=callback;});});};EditorCommands.prototype.addCommand=function(command,callback,scope){var _this=this;command=command.toLowerCase();this.commands.exec[command]=function(command,ui,value,args){return callback.call(scope||_this.editor,ui,value,args);};};EditorCommands.prototype.queryCommandSupported=function(command){command=command.toLowerCase();if(this.commands.exec[command]){return true;}try{return this.editor.getDoc().queryCommandSupported(command);}catch(ex){}return false;};EditorCommands.prototype.addQueryStateHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase();this.commands.state[command]=function(){return callback.call(scope||_this.editor);};};EditorCommands.prototype.addQueryValueHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase();this.commands.value[command]=function(){return callback.call(scope||_this.editor);};};EditorCommands.prototype.hasCustomCommand=function(command){command=command.toLowerCase();return!!this.commands.exec[command];};EditorCommands.prototype.execNativeCommand=function(command,ui,value){if(ui===undefined){ui=false;}if(value===undefined){value=null;}return this.editor.getDoc().execCommand(command,ui,value);};EditorCommands.prototype.isFormatMatch=function(name){return this.editor.formatter.match(name);};EditorCommands.prototype.toggleFormat=function(name,value){this.editor.formatter.toggle(name,value);this.editor.nodeChanged();};EditorCommands.prototype.storeSelection=function(type){this.selectionBookmark=this.editor.selection.getBookmark(type);};EditorCommands.prototype.restoreSelection=function(){this.editor.selection.moveToBookmark(this.selectionBookmark);};EditorCommands.prototype.setupCommands=function(editor){var self=this;this.addCommands({'mceResetDesignMode,mceBeginUndoLevel':noop,'mceEndUndoLevel,mceAddUndoLevel':function mceEndUndoLevelMceAddUndoLevel(){editor.undoManager.add();},'mceFocus':function mceFocus(_command,_ui,value){focus(editor,value);},'Cut,Copy,Paste':function CutCopyPaste(command){var doc=editor.getDoc();var failed;try{self.execNativeCommand(command);}catch(ex){failed=true;}if(command==='paste'&&!doc.queryCommandEnabled(command)){failed=true;}if(failed||!doc.queryCommandSupported(command)){var msg=editor.translate('Your browser doesn\\'t support direct access to the clipboard. '+'Please use the Ctrl+X/C/V keyboard shortcuts instead.');if(Env.mac){msg=msg.replace(/Ctrl\\+/g,'\\u2318+');}editor.notificationManager.open({text:msg,type:'error'});}},'unlink':function unlink(){if(editor.selection.isCollapsed()){var elm=editor.dom.getParent(editor.selection.getStart(),'a');if(elm){editor.dom.remove(elm,true);}return;}editor.formatter.remove('link');},'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone':function JustifyLeftJustifyCenterJustifyRightJustifyFullJustifyNone(command){var align=command.substring(7);if(align==='full'){align='justify';}each$4('left,center,right,justify'.split(','),function(name){if(align!==name){editor.formatter.remove('align'+name);}});if(align!=='none'){self.toggleFormat('align'+align);}},'InsertUnorderedList,InsertOrderedList':function InsertUnorderedListInsertOrderedList(command){var listParent;self.execNativeCommand(command);var listElm=editor.dom.getParent(editor.selection.getNode(),'ol,ul');if(listElm){listParent=listElm.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)){self.storeSelection();editor.dom.split(listParent,listElm);self.restoreSelection();}}},'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':function BoldItalicUnderlineStrikethroughSuperscriptSubscript(command){self.toggleFormat(command);},'ForeColor,HiliteColor':function ForeColorHiliteColor(command,ui,value){self.toggleFormat(command,{value:value});},'FontName':function FontName(command,ui,value){fontNameAction(editor,value);},'FontSize':function FontSize(command,ui,value){fontSizeAction(editor,value);},'LineHeight':function LineHeight(command,ui,value){lineHeightAction(editor,value);},'Lang':function Lang(command,ui,lang){self.toggleFormat(command,{value:lang.code,customValue:lang.customCode});},'RemoveFormat':function RemoveFormat(command){editor.formatter.remove(command);},'mceBlockQuote':function mceBlockQuote(){self.toggleFormat('blockquote');},'FormatBlock':function FormatBlock(command,ui,value){return self.toggleFormat(value||'p');},'mceCleanup':function mceCleanup(){var bookmark=editor.selection.getBookmark();editor.setContent(editor.getContent());editor.selection.moveToBookmark(bookmark);},'mceRemoveNode':function mceRemoveNode(command,ui,value){var node=value||editor.selection.getNode();if(node!==editor.getBody()){self.storeSelection();editor.dom.remove(node,true);self.restoreSelection();}},'mceSelectNodeDepth':function mceSelectNodeDepth(command,ui,value){var counter=0;editor.dom.getParent(editor.selection.getNode(),function(node){if(node.nodeType===1&&counter++===value){editor.selection.select(node);return false;}},editor.getBody());},'mceSelectNode':function mceSelectNode(command,ui,value){editor.selection.select(value);},'mceInsertContent':function mceInsertContent(command,ui,value){insertAtCaret(editor,value);},'mceInsertRawHTML':function mceInsertRawHTML(command,ui,value){editor.selection.setContent('tiny_mce_marker');var content=editor.getContent();editor.setContent(content.replace(/tiny_mce_marker/g,function(){return value;}));},'mceInsertNewLine':function mceInsertNewLine(command,ui,value){insert(editor,value);},'mceToggleFormat':function mceToggleFormat(command,ui,value){self.toggleFormat(value);},'mceSetContent':function mceSetContent(command,ui,value){editor.setContent(value);},'Indent,Outdent':function IndentOutdent(command){handle(editor,command);},'mceRepaint':noop,'InsertHorizontalRule':function InsertHorizontalRule(){editor.execCommand('mceInsertContent',false,'<hr />');},'mceToggleVisualAid':function mceToggleVisualAid(){editor.hasVisual=!editor.hasVisual;editor.addVisual();},'mceReplaceContent':function mceReplaceContent(command,ui,value){editor.execCommand('mceInsertContent',false,value.replace(/\\{\\$selection\\}/g,editor.selection.getContent({format:'text'})));},'mceInsertLink':function mceInsertLink(command,ui,value){if(typeof value==='string'){value={href:value};}var anchor=editor.dom.getParent(editor.selection.getNode(),'a');value.href=value.href.replace(/ /g,'%20');if(!anchor||!value.href){editor.formatter.remove('link');}if(value.href){editor.formatter.apply('link',value,anchor);}},'selectAll':function selectAll(){var editingHost=editor.dom.getParent(editor.selection.getStart(),isContentEditableTrue$4);if(editingHost){var rng=editor.dom.createRng();rng.selectNodeContents(editingHost);editor.selection.setRng(rng);}},'mceNewDocument':function mceNewDocument(){editor.setContent('');},'InsertLineBreak':function InsertLineBreak(command,ui,value){insert$1(editor,value);return true;}});var alignStates=function alignStates(name){return function(){var selection=editor.selection;var nodes=selection.isCollapsed()?[editor.dom.getParent(selection.getNode(),editor.dom.isBlock)]:selection.getSelectedBlocks();var matches=map(nodes,function(node){return!!editor.formatter.matchNode(node,name);});return inArray(matches,true)!==-1;};};self.addCommands({'JustifyLeft':alignStates('alignleft'),'JustifyCenter':alignStates('aligncenter'),'JustifyRight':alignStates('alignright'),'JustifyFull':alignStates('alignjustify'),'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':function BoldItalicUnderlineStrikethroughSuperscriptSubscript(command){return self.isFormatMatch(command);},'mceBlockQuote':function mceBlockQuote(){return self.isFormatMatch('blockquote');},'Outdent':function Outdent(){return canOutdent(editor);},'InsertUnorderedList,InsertOrderedList':function InsertUnorderedListInsertOrderedList(command){var list=editor.dom.getParent(editor.selection.getNode(),'ul,ol');return list&&(command==='insertunorderedlist'&&list.tagName==='UL'||command==='insertorderedlist'&&list.tagName==='OL');}},'state');self.addCommands({Undo:function Undo(){editor.undoManager.undo();},Redo:function Redo(){editor.undoManager.redo();}});self.addQueryValueHandler('FontName',function(){return fontNameQuery(editor);},this);self.addQueryValueHandler('FontSize',function(){return fontSizeQuery(editor);},this);self.addQueryValueHandler('LineHeight',function(){return lineHeightQuery(editor);},this);};return EditorCommands;}();var internalContentEditableAttr='data-mce-contenteditable';var toggleClass=function toggleClass(elm,cls,state){if(has(elm,cls)&&state===false){remove$3(elm,cls);}else if(state){add$1(elm,cls);}};var setEditorCommandState=function setEditorCommandState(editor,cmd,state){try{editor.getDoc().execCommand(cmd,false,String(state));}catch(ex){}};var setContentEditable=function setContentEditable(elm,state){elm.dom.contentEditable=state?'true':'false';};var switchOffContentEditableTrue=function switchOffContentEditableTrue(elm){each$k(descendants(elm,'*[contenteditable=\"true\"]'),function(elm){set$1(elm,internalContentEditableAttr,'true');setContentEditable(elm,false);});};var switchOnContentEditableTrue=function switchOnContentEditableTrue(elm){each$k(descendants(elm,'*['+internalContentEditableAttr+'=\"true\"]'),function(elm){remove$6(elm,internalContentEditableAttr);setContentEditable(elm,true);});};var removeFakeSelection=function removeFakeSelection(editor){Optional.from(editor.selection.getNode()).each(function(elm){elm.removeAttribute('data-mce-selected');});};var restoreFakeSelection=function restoreFakeSelection(editor){editor.selection.setRng(editor.selection.getRng());};var toggleReadOnly=function toggleReadOnly(editor,state){var body=SugarElement.fromDom(editor.getBody());toggleClass(body,'mce-content-readonly',state);if(state){editor.selection.controlSelection.hideResizeRect();editor._selectionOverrides.hideFakeCaret();removeFakeSelection(editor);editor.readonly=true;setContentEditable(body,false);switchOffContentEditableTrue(body);}else{editor.readonly=false;setContentEditable(body,true);switchOnContentEditableTrue(body);setEditorCommandState(editor,'StyleWithCSS',false);setEditorCommandState(editor,'enableInlineTableEditing',false);setEditorCommandState(editor,'enableObjectResizing',false);if(hasEditorOrUiFocus(editor)){editor.focus();}restoreFakeSelection(editor);editor.nodeChanged();}};var _isReadOnly=function isReadOnly(editor){return editor.readonly;};var registerFilters=function registerFilters(editor){editor.parser.addAttributeFilter('contenteditable',function(nodes){if(_isReadOnly(editor)){each$k(nodes,function(node){node.attr(internalContentEditableAttr,node.attr('contenteditable'));node.attr('contenteditable','false');});}});editor.serializer.addAttributeFilter(internalContentEditableAttr,function(nodes){if(_isReadOnly(editor)){each$k(nodes,function(node){node.attr('contenteditable',node.attr(internalContentEditableAttr));});}});editor.serializer.addTempAttr(internalContentEditableAttr);};var registerReadOnlyContentFilters=function registerReadOnlyContentFilters(editor){if(editor.serializer){registerFilters(editor);}else{editor.on('PreInit',function(){registerFilters(editor);});}};var isClickEvent=function isClickEvent(e){return e.type==='click';};var getAnchorHrefOpt=function getAnchorHrefOpt(editor,elm){var isRoot=function isRoot(elm){return eq(elm,SugarElement.fromDom(editor.getBody()));};return closest$2(elm,'a',isRoot).bind(function(a){return getOpt(a,'href');});};var processReadonlyEvents=function processReadonlyEvents(editor,e){if(isClickEvent(e)&&!VK.metaKeyPressed(e)){var elm=SugarElement.fromDom(e.target);getAnchorHrefOpt(editor,elm).each(function(href){e.preventDefault();if(/^#/.test(href)){var targetEl=editor.dom.select(href+',[name=\"'+removeLeading(href,'#')+'\"]');if(targetEl.length){editor.selection.scrollIntoView(targetEl[0],true);}}else{window.open(href,'_blank','rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes');}});}};var registerReadOnlySelectionBlockers=function registerReadOnlySelectionBlockers(editor){editor.on('ShowCaret',function(e){if(_isReadOnly(editor)){e.preventDefault();}});editor.on('ObjectSelected',function(e){if(_isReadOnly(editor)){e.preventDefault();}});};var nativeEvents=Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange '+'mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover '+'draggesture dragdrop drop drag submit '+'compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel',' ');var EventDispatcher=function(){function EventDispatcher(settings){this.bindings={};this.settings=settings||{};this.scope=this.settings.scope||this;this.toggleEvent=this.settings.toggleEvent||never;}EventDispatcher.isNative=function(name){return!!nativeEvents[name.toLowerCase()];};EventDispatcher.prototype.fire=function(name,args){var lcName=name.toLowerCase();var event=normalize$3(lcName,args||{},this.scope);if(this.settings.beforeFire){this.settings.beforeFire(event);}var handlers=this.bindings[lcName];if(handlers){for(var i=0,l=handlers.length;i<l;i++){var callback=handlers[i];if(callback.removed){continue;}if(callback.once){this.off(lcName,callback.func);}if(event.isImmediatePropagationStopped()){return event;}if(callback.func.call(this.scope,event)===false){event.preventDefault();return event;}}}return event;};EventDispatcher.prototype.on=function(name,callback,prepend,extra){if(callback===false){callback=never;}if(callback){var wrappedCallback={func:callback,removed:false};if(extra){Tools.extend(wrappedCallback,extra);}var names=name.toLowerCase().split(' ');var i=names.length;while(i--){var currentName=names[i];var handlers=this.bindings[currentName];if(!handlers){handlers=[];this.toggleEvent(currentName,true);}if(prepend){handlers=__spreadArray([wrappedCallback],handlers,true);}else{handlers=__spreadArray(__spreadArray([],handlers,true),[wrappedCallback],false);}this.bindings[currentName]=handlers;}}return this;};EventDispatcher.prototype.off=function(name,callback){var _this=this;if(name){var names=name.toLowerCase().split(' ');var i=names.length;while(i--){var currentName=names[i];var handlers=this.bindings[currentName];if(!currentName){each$j(this.bindings,function(_value,bindingName){_this.toggleEvent(bindingName,false);delete _this.bindings[bindingName];});return this;}if(handlers){if(!callback){handlers.length=0;}else{var filteredHandlers=partition(handlers,function(handler){return handler.func===callback;});handlers=filteredHandlers.fail;this.bindings[currentName]=handlers;each$k(filteredHandlers.pass,function(handler){handler.removed=true;});}if(!handlers.length){this.toggleEvent(name,false);delete this.bindings[currentName];}}}}else{each$j(this.bindings,function(_value,name){_this.toggleEvent(name,false);});this.bindings={};}return this;};EventDispatcher.prototype.once=function(name,callback,prepend){return this.on(name,callback,prepend,{once:true});};EventDispatcher.prototype.has=function(name){name=name.toLowerCase();return!(!this.bindings[name]||this.bindings[name].length===0);};return EventDispatcher;}();var getEventDispatcher=function getEventDispatcher(obj){if(!obj._eventDispatcher){obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function toggleEvent(name,state){if(EventDispatcher.isNative(name)&&obj.toggleNativeEvent){obj.toggleNativeEvent(name,state);}}});}return obj._eventDispatcher;};var Observable={fire:function fire(name,args,bubble){var self=this;if(self.removed&&name!=='remove'&&name!=='detach'){return args;}var dispatcherArgs=getEventDispatcher(self).fire(name,args);if(bubble!==false&&self.parent){var parent_1=self.parent();while(parent_1&&!dispatcherArgs.isPropagationStopped()){parent_1.fire(name,dispatcherArgs,false);parent_1=parent_1.parent();}}return dispatcherArgs;},on:function on(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend);},off:function off(name,callback){return getEventDispatcher(this).off(name,callback);},once:function once(name,callback){return getEventDispatcher(this).once(name,callback);},hasEventListeners:function hasEventListeners(name){return getEventDispatcher(this).has(name);}};var DOM$2=_DOMUtils.DOM;var customEventRootDelegates;var getEventTarget=function getEventTarget(editor,eventName){if(eventName==='selectionchange'){return editor.getDoc();}if(!editor.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)){return editor.getDoc().documentElement;}var eventRoot=getEventRoot(editor);if(eventRoot){if(!editor.eventRoot){editor.eventRoot=DOM$2.select(eventRoot)[0];}return editor.eventRoot;}return editor.getBody();};var isListening=function isListening(editor){return!editor.hidden&&!_isReadOnly(editor);};var fireEvent=function fireEvent(editor,eventName,e){if(isListening(editor)){editor.fire(eventName,e);}else if(_isReadOnly(editor)){processReadonlyEvents(editor,e);}};var bindEventDelegate=function bindEventDelegate(editor,eventName){var delegate;if(!editor.delegates){editor.delegates={};}if(editor.delegates[eventName]||editor.removed){return;}var eventRootElm=getEventTarget(editor,eventName);if(getEventRoot(editor)){if(!customEventRootDelegates){customEventRootDelegates={};editor.editorManager.on('removeEditor',function(){if(!editor.editorManager.activeEditor){if(customEventRootDelegates){each$j(customEventRootDelegates,function(_value,name){editor.dom.unbind(getEventTarget(editor,name));});customEventRootDelegates=null;}}});}if(customEventRootDelegates[eventName]){return;}delegate=function delegate(e){var target=e.target;var editors=editor.editorManager.get();var i=editors.length;while(i--){var body=editors[i].getBody();if(body===target||DOM$2.isChildOf(target,body)){fireEvent(editors[i],eventName,e);}}};customEventRootDelegates[eventName]=delegate;DOM$2.bind(eventRootElm,eventName,delegate);}else{delegate=function delegate(e){fireEvent(editor,eventName,e);};DOM$2.bind(eventRootElm,eventName,delegate);editor.delegates[eventName]=delegate;}};var EditorObservable=_assign(_assign({},Observable),{bindPendingEventDelegates:function bindPendingEventDelegates(){var self=this;Tools.each(self._pendingNativeEvents,function(name){bindEventDelegate(self,name);});},toggleNativeEvent:function toggleNativeEvent(name,state){var self=this;if(name==='focus'||name==='blur'){return;}if(self.removed){return;}if(state){if(self.initialized){bindEventDelegate(self,name);}else{if(!self._pendingNativeEvents){self._pendingNativeEvents=[name];}else{self._pendingNativeEvents.push(name);}}}else if(self.initialized){self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]);delete self.delegates[name];}},unbindAllNativeEvents:function unbindAllNativeEvents(){var self=this;var body=self.getBody();var dom=self.dom;if(self.delegates){each$j(self.delegates,function(value,name){self.dom.unbind(getEventTarget(self,name),name,value);});delete self.delegates;}if(!self.inline&&body&&dom){body.onload=null;dom.unbind(self.getWin());dom.unbind(self.getDoc());}if(dom){dom.unbind(body);dom.unbind(self.getContainer());}}});var defaultModes=['design','readonly'];var switchToMode=function switchToMode(editor,activeMode,availableModes,mode){var oldMode=availableModes[activeMode.get()];var newMode=availableModes[mode];try{newMode.activate();}catch(e){console.error('problem while activating editor mode '+mode+':',e);return;}oldMode.deactivate();if(oldMode.editorReadOnly!==newMode.editorReadOnly){toggleReadOnly(editor,newMode.editorReadOnly);}activeMode.set(mode);fireSwitchMode(editor,mode);};var setMode=function setMode(editor,availableModes,activeMode,mode){if(mode===activeMode.get()){return;}else if(!has$2(availableModes,mode)){throw new Error('Editor mode \\''+mode+'\\' is invalid');}if(editor.initialized){switchToMode(editor,activeMode,availableModes,mode);}else{editor.on('init',function(){return switchToMode(editor,activeMode,availableModes,mode);});}};var registerMode=function registerMode(availableModes,mode,api){var _a;if(contains$3(defaultModes,mode)){throw new Error('Cannot override default mode '+mode);}return _assign(_assign({},availableModes),(_a={},_a[mode]=_assign(_assign({},api),{deactivate:function deactivate(){try{api.deactivate();}catch(e){console.error('problem while deactivating editor mode '+mode+':',e);}}}),_a));};var create$4=function create$4(editor){var activeMode=Cell('design');var availableModes=Cell({design:{activate:noop,deactivate:noop,editorReadOnly:false},readonly:{activate:noop,deactivate:noop,editorReadOnly:true}});registerReadOnlyContentFilters(editor);registerReadOnlySelectionBlockers(editor);return{isReadOnly:function isReadOnly(){return _isReadOnly(editor);},set:function set(mode){return setMode(editor,availableModes.get(),activeMode,mode);},get:function get(){return activeMode.get();},register:function register(mode,api){availableModes.set(registerMode(availableModes.get(),mode,api));}};};var each$3=Tools.each,explode$1=Tools.explode;var keyCodeLookup={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var modifierNames=Tools.makeMap('alt,ctrl,shift,meta,access');var parseShortcut=function parseShortcut(pattern){var key;var shortcut={};each$3(explode$1(pattern.toLowerCase(),'+'),function(value){if(value in modifierNames){shortcut[value]=true;}else{if(/^[0-9]{2,}$/.test(value)){shortcut.keyCode=parseInt(value,10);}else{shortcut.charCode=value.charCodeAt(0);shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0);}}});var id=[shortcut.keyCode];for(key in modifierNames){if(shortcut[key]){id.push(key);}else{shortcut[key]=false;}}shortcut.id=id.join(',');if(shortcut.access){shortcut.alt=true;if(Env.mac){shortcut.ctrl=true;}else{shortcut.shift=true;}}if(shortcut.meta){if(Env.mac){shortcut.meta=true;}else{shortcut.ctrl=true;shortcut.meta=false;}}return shortcut;};var Shortcuts=function(){function Shortcuts(editor){this.shortcuts={};this.pendingPatterns=[];this.editor=editor;var self=this;editor.on('keyup keypress keydown',function(e){if((self.hasModifier(e)||self.isFunctionKey(e))&&!e.isDefaultPrevented()){each$3(self.shortcuts,function(shortcut){if(self.matchShortcut(e,shortcut)){self.pendingPatterns=shortcut.subpatterns.slice(0);if(e.type==='keydown'){self.executeShortcutAction(shortcut);}return true;}});if(self.matchShortcut(e,self.pendingPatterns[0])){if(self.pendingPatterns.length===1){if(e.type==='keydown'){self.executeShortcutAction(self.pendingPatterns[0]);}}self.pendingPatterns.shift();}}});}Shortcuts.prototype.add=function(pattern,desc,cmdFunc,scope){var self=this;var func=self.normalizeCommandFunc(cmdFunc);each$3(explode$1(Tools.trim(pattern)),function(pattern){var shortcut=self.createShortcut(pattern,desc,func,scope);self.shortcuts[shortcut.id]=shortcut;});return true;};Shortcuts.prototype.remove=function(pattern){var shortcut=this.createShortcut(pattern);if(this.shortcuts[shortcut.id]){delete this.shortcuts[shortcut.id];return true;}return false;};Shortcuts.prototype.normalizeCommandFunc=function(cmdFunc){var self=this;var cmd=cmdFunc;if(typeof cmd==='string'){return function(){self.editor.execCommand(cmd,false,null);};}else if(Tools.isArray(cmd)){return function(){self.editor.execCommand(cmd[0],cmd[1],cmd[2]);};}else{return cmd;}};Shortcuts.prototype.createShortcut=function(pattern,desc,cmdFunc,scope){var shortcuts=Tools.map(explode$1(pattern,'>'),parseShortcut);shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||this.editor});return Tools.extend(shortcuts[0],{desc:this.editor.translate(desc),subpatterns:shortcuts.slice(1)});};Shortcuts.prototype.hasModifier=function(e){return e.altKey||e.ctrlKey||e.metaKey;};Shortcuts.prototype.isFunctionKey=function(e){return e.type==='keydown'&&e.keyCode>=112&&e.keyCode<=123;};Shortcuts.prototype.matchShortcut=function(e,shortcut){if(!shortcut){return false;}if(shortcut.ctrl!==e.ctrlKey||shortcut.meta!==e.metaKey){return false;}if(shortcut.alt!==e.altKey||shortcut.shift!==e.shiftKey){return false;}if(e.keyCode===shortcut.keyCode||e.charCode&&e.charCode===shortcut.charCode){e.preventDefault();return true;}return false;};Shortcuts.prototype.executeShortcutAction=function(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null;};return Shortcuts;}();var create$3=function create$3(){var buttons={};var menuItems={};var popups={};var icons={};var contextMenus={};var contextToolbars={};var sidebars={};var add=function add(collection,type){return function(name,spec){return collection[name.toLowerCase()]=_assign(_assign({},spec),{type:type});};};var addIcon=function addIcon(name,svgData){return icons[name.toLowerCase()]=svgData;};return{addButton:add(buttons,'button'),addGroupToolbarButton:add(buttons,'grouptoolbarbutton'),addToggleButton:add(buttons,'togglebutton'),addMenuButton:add(buttons,'menubutton'),addSplitButton:add(buttons,'splitbutton'),addMenuItem:add(menuItems,'menuitem'),addNestedMenuItem:add(menuItems,'nestedmenuitem'),addToggleMenuItem:add(menuItems,'togglemenuitem'),addAutocompleter:add(popups,'autocompleter'),addContextMenu:add(contextMenus,'contextmenu'),addContextToolbar:add(contextToolbars,'contexttoolbar'),addContextForm:add(contextToolbars,'contextform'),addSidebar:add(sidebars,'sidebar'),addIcon:addIcon,getAll:function getAll(){return{buttons:buttons,menuItems:menuItems,icons:icons,popups:popups,contextMenus:contextMenus,contextToolbars:contextToolbars,sidebars:sidebars};}};};var registry=function registry(){var bridge=create$3();return{addAutocompleter:bridge.addAutocompleter,addButton:bridge.addButton,addContextForm:bridge.addContextForm,addContextMenu:bridge.addContextMenu,addContextToolbar:bridge.addContextToolbar,addIcon:bridge.addIcon,addMenuButton:bridge.addMenuButton,addMenuItem:bridge.addMenuItem,addNestedMenuItem:bridge.addNestedMenuItem,addSidebar:bridge.addSidebar,addSplitButton:bridge.addSplitButton,addToggleButton:bridge.addToggleButton,addGroupToolbarButton:bridge.addGroupToolbarButton,addToggleMenuItem:bridge.addToggleMenuItem,getAll:bridge.getAll};};var DOM$1=_DOMUtils.DOM;var extend$3=Tools.extend,each$2=Tools.each;var resolve=Tools.resolve;var ie=Env.ie;var Editor=function(){function Editor(id,settings,editorManager){var _this=this;this.plugins={};this.contentCSS=[];this.contentStyles=[];this.loadedCSS={};this.isNotDirty=false;this.editorManager=editorManager;this.documentBaseUrl=editorManager.documentBaseURL;extend$3(this,EditorObservable);this.settings=getEditorSettings(this,id,this.documentBaseUrl,editorManager.defaultSettings,settings);if(this.settings.suffix){editorManager.suffix=this.settings.suffix;}this.suffix=editorManager.suffix;if(this.settings.base_url){editorManager._setBaseUrl(this.settings.base_url);}this.baseUri=editorManager.baseURI;if(this.settings.referrer_policy){ScriptLoader.ScriptLoader._setReferrerPolicy(this.settings.referrer_policy);_DOMUtils.DOM.styleSheetLoader._setReferrerPolicy(this.settings.referrer_policy);}_AddOnManager.languageLoad=this.settings.language_load;_AddOnManager.baseURL=editorManager.baseURL;this.id=id;this.setDirty(false);this.documentBaseURI=new URI(this.settings.document_base_url,{base_uri:this.baseUri});this.baseURI=this.baseUri;this.inline=!!this.settings.inline;this.shortcuts=new Shortcuts(this);this.editorCommands=new EditorCommands(this);if(this.settings.cache_suffix){Env.cacheSuffix=this.settings.cache_suffix.replace(/^[\\?\\&]+/,'');}this.ui={registry:registry(),styleSheetLoader:undefined,show:noop,hide:noop,enable:noop,disable:noop,isDisabled:never};var self=this;var modeInstance=create$4(self);this.mode=modeInstance;this.setMode=modeInstance.set;editorManager.fire('SetupEditor',{editor:this});this.execCallback('setup',this);this.$=DomQuery.overrideDefaults(function(){return{context:_this.inline?_this.getBody():_this.getDoc(),element:_this.getBody()};});}Editor.prototype.render=function(){render(this);};Editor.prototype.focus=function(skipFocus){this.execCommand('mceFocus',false,skipFocus);};Editor.prototype.hasFocus=function(){return hasFocus(this);};Editor.prototype.execCallback=function(name){var x=[];for(var _i=1;_i<arguments.length;_i++){x[_i-1]=arguments[_i];}var self=this;var callback=self.settings[name],scope;if(!callback){return;}if(self.callbackLookup&&(scope=self.callbackLookup[name])){callback=scope.func;scope=scope.scope;}if(typeof callback==='string'){scope=callback.replace(/\\.\\w+$/,'');scope=scope?resolve(scope):0;callback=resolve(callback);self.callbackLookup=self.callbackLookup||{};self.callbackLookup[name]={func:callback,scope:scope};}return callback.apply(scope||self,x);};Editor.prototype.translate=function(text){return I18n.translate(text);};Editor.prototype.getParam=function(name,defaultVal,type){return getParam(this,name,defaultVal,type);};Editor.prototype.hasPlugin=function(name,loaded){var hasPlugin=contains$3(getPlugins(this).split(/[ ,]/),name);if(hasPlugin){return loaded?PluginManager.get(name)!==undefined:true;}else{return false;}};Editor.prototype.nodeChanged=function(args){this._nodeChangeDispatcher.nodeChanged(args);};Editor.prototype.addCommand=function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope);};Editor.prototype.addQueryStateHandler=function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope);};Editor.prototype.addQueryValueHandler=function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope);};Editor.prototype.addShortcut=function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope);};Editor.prototype.execCommand=function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args);};Editor.prototype.queryCommandState=function(cmd){return this.editorCommands.queryCommandState(cmd);};Editor.prototype.queryCommandValue=function(cmd){return this.editorCommands.queryCommandValue(cmd);};Editor.prototype.queryCommandSupported=function(cmd){return this.editorCommands.queryCommandSupported(cmd);};Editor.prototype.show=function(){var self=this;if(self.hidden){self.hidden=false;if(self.inline){self.getBody().contentEditable='true';}else{DOM$1.show(self.getContainer());DOM$1.hide(self.id);}self.load();self.fire('show');}};Editor.prototype.hide=function(){var self=this,doc=self.getDoc();if(!self.hidden){if(ie&&doc&&!self.inline){doc.execCommand('SelectAll');}self.save();if(self.inline){self.getBody().contentEditable='false';if(self===self.editorManager.focusedEditor){self.editorManager.focusedEditor=null;}}else{DOM$1.hide(self.getContainer());DOM$1.setStyle(self.id,'display',self.orgDisplay);}self.hidden=true;self.fire('hide');}};Editor.prototype.isHidden=function(){return!!this.hidden;};Editor.prototype.setProgressState=function(state,time){this.fire('ProgressState',{state:state,time:time});};Editor.prototype.load=function(args){var self=this;var elm=self.getElement(),html;if(self.removed){return'';}if(elm){args=args||{};args.load=true;var value=isTextareaOrInput(elm)?elm.value:elm.innerHTML;html=self.setContent(value,args);args.element=elm;if(!args.no_events){self.fire('LoadContent',args);}args.element=elm=null;return html;}};Editor.prototype.save=function(args){var self=this;var elm=self.getElement(),html,form;if(!elm||!self.initialized||self.removed){return;}args=args||{};args.save=true;args.element=elm;html=args.content=self.getContent(args);if(!args.no_events){self.fire('SaveContent',args);}if(args.format==='raw'){self.fire('RawSaveContent',args);}html=args.content;if(!isTextareaOrInput(elm)){if(args.is_removing||!self.inline){elm.innerHTML=html;}if(form=DOM$1.getParent(self.id,'form')){each$2(form.elements,function(elm){if(elm.name===self.id){elm.value=html;return false;}});}}else{elm.value=html;}args.element=elm=null;if(args.set_dirty!==false){self.setDirty(false);}return html;};Editor.prototype.setContent=function(content,args){return setContent(this,content,args);};Editor.prototype.getContent=function(args){return getContent(this,args);};Editor.prototype.insertContent=function(content,args){if(args){content=extend$3({content:content},args);}this.execCommand('mceInsertContent',false,content);};Editor.prototype.resetContent=function(initialContent){if(initialContent===undefined){setContent(this,this.startContent,{format:'raw'});}else{setContent(this,initialContent);}this.undoManager.reset();this.setDirty(false);this.nodeChanged();};Editor.prototype.isDirty=function(){return!this.isNotDirty;};Editor.prototype.setDirty=function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state;if(state&&state!==oldState){this.fire('dirty');}};Editor.prototype.getContainer=function(){var self=this;if(!self.container){self.container=DOM$1.get(self.editorContainer||self.id+'_parent');}return self.container;};Editor.prototype.getContentAreaContainer=function(){return this.contentAreaContainer;};Editor.prototype.getElement=function(){if(!this.targetElm){this.targetElm=DOM$1.get(this.id);}return this.targetElm;};Editor.prototype.getWin=function(){var self=this;var elm;if(!self.contentWindow){elm=self.iframeElement;if(elm){self.contentWindow=elm.contentWindow;}}return self.contentWindow;};Editor.prototype.getDoc=function(){var self=this;var win;if(!self.contentDocument){win=self.getWin();if(win){self.contentDocument=win.document;}}return self.contentDocument;};Editor.prototype.getBody=function(){var doc=this.getDoc();return this.bodyElement||(doc?doc.body:null);};Editor.prototype.convertURL=function(url,name,elm){var self=this,settings=self.settings;if(settings.urlconverter_callback){return self.execCallback('urlconverter_callback',url,elm,true,name);}if(!settings.convert_urls||elm&&elm.nodeName==='LINK'||url.indexOf('file:')===0||url.length===0){return url;}if(settings.relative_urls){return self.documentBaseURI.toRelative(url);}url=self.documentBaseURI.toAbsolute(url,settings.remove_script_host);return url;};Editor.prototype.addVisual=function(elm){addVisual(this,elm);};Editor.prototype.remove=function(){remove(this);};Editor.prototype.destroy=function(automatic){destroy(this,automatic);};Editor.prototype.uploadImages=function(callback){return this.editorUpload.uploadImages(callback);};Editor.prototype._scanForImages=function(){return this.editorUpload.scanForImages();};Editor.prototype.addButton=function(){throw new Error('editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead');};Editor.prototype.addSidebar=function(){throw new Error('editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead');};Editor.prototype.addMenuItem=function(){throw new Error('editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead');};Editor.prototype.addContextToolbar=function(){throw new Error('editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead');};return Editor;}();var DOM=_DOMUtils.DOM;var explode=Tools.explode,each$1=Tools.each,extend$2=Tools.extend;var instanceCounter=0,boundGlobalEvents=false;var beforeUnloadDelegate;var legacyEditors=[];var editors=[];var isValidLegacyKey=function isValidLegacyKey(id){return id!=='length';};var globalEventDelegate=function globalEventDelegate(e){var type=e.type;each$1(EditorManager.get(),function(editor){switch(type){case'scroll':editor.fire('ScrollWindow',e);break;case'resize':editor.fire('ResizeWindow',e);break;}});};var toggleGlobalEvents=function toggleGlobalEvents(state){if(state!==boundGlobalEvents){if(state){DomQuery(window).on('resize scroll',globalEventDelegate);}else{DomQuery(window).off('resize scroll',globalEventDelegate);}boundGlobalEvents=state;}};var removeEditorFromList=function removeEditorFromList(targetEditor){var oldEditors=editors;delete legacyEditors[targetEditor.id];for(var i=0;i<legacyEditors.length;i++){if(legacyEditors[i]===targetEditor){legacyEditors.splice(i,1);break;}}editors=filter$4(editors,function(editor){return targetEditor!==editor;});if(EditorManager.activeEditor===targetEditor){EditorManager.activeEditor=editors.length>0?editors[0]:null;}if(EditorManager.focusedEditor===targetEditor){EditorManager.focusedEditor=null;}return oldEditors.length!==editors.length;};var purgeDestroyedEditor=function purgeDestroyedEditor(editor){if(editor&&editor.initialized&&!(editor.getContainer()||editor.getBody()).parentNode){removeEditorFromList(editor);editor.unbindAllNativeEvents();editor.destroy(true);editor.removed=true;editor=null;}return editor;};var isQuirksMode=document.compatMode!=='CSS1Compat';var EditorManager=_assign(_assign({},Observable),{baseURI:null,baseURL:null,defaultSettings:{},documentBaseURL:null,suffix:null,$:DomQuery,majorVersion:'5',minorVersion:'10.9',releaseDate:'2023-11-15',editors:legacyEditors,i18n:I18n,activeEditor:null,focusedEditor:null,settings:{},setup:function setup(){var self=this;var baseURL,documentBaseURL,suffix='';documentBaseURL=URI.getDocumentBaseUrl(document.location);if(/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)){documentBaseURL=documentBaseURL.replace(/[\\?#].*$/,'').replace(/[\\/\\\\][^\\/]+$/,'');if(!/[\\/\\\\]$/.test(documentBaseURL)){documentBaseURL+='/';}}var preInit=window.tinymce||window.tinyMCEPreInit;if(preInit){baseURL=preInit.base||preInit.baseURL;suffix=preInit.suffix;}else{var scripts=document.getElementsByTagName('script');for(var i=0;i<scripts.length;i++){var src=scripts[i].src||'';if(src===''){continue;}var srcScript=src.substring(src.lastIndexOf('/'));if(/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)){if(srcScript.indexOf('.min')!==-1){suffix='.min';}baseURL=src.substring(0,src.lastIndexOf('/'));break;}}if(!baseURL&&document.currentScript){var src=document.currentScript.src;if(src.indexOf('.min')!==-1){suffix='.min';}baseURL=src.substring(0,src.lastIndexOf('/'));}}self.baseURL=new URI(documentBaseURL).toAbsolute(baseURL);self.documentBaseURL=documentBaseURL;self.baseURI=new URI(self.baseURL);self.suffix=suffix;setup$l(self);},overrideDefaults:function overrideDefaults(defaultSettings){var baseUrl=defaultSettings.base_url;if(baseUrl){this._setBaseUrl(baseUrl);}var suffix=defaultSettings.suffix;if(defaultSettings.suffix){this.suffix=suffix;}this.defaultSettings=defaultSettings;var pluginBaseUrls=defaultSettings.plugin_base_urls;if(pluginBaseUrls!==undefined){each$j(pluginBaseUrls,function(pluginBaseUrl,pluginName){_AddOnManager.PluginManager.urls[pluginName]=pluginBaseUrl;});}},init:function init(settings){var self=this;var result;var invalidInlineTargets=Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track '+'colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu',' ');var isInvalidInlineTarget=function isInvalidInlineTarget(settings,elm){return settings.inline&&elm.tagName.toLowerCase()in invalidInlineTargets;};var createId=function createId(elm){var id=elm.id;if(!id){id=get$9(elm,'name').filter(function(name){return!DOM.get(name);}).getOrThunk(DOM.uniqueId);elm.setAttribute('id',id);}return id;};var execCallback=function execCallback(name){var callback=settings[name];if(!callback){return;}return callback.apply(self,[]);};var hasClass=function hasClass(elm,className){return className.constructor===RegExp?className.test(elm.className):DOM.hasClass(elm,className);};var findTargets=function findTargets(settings){var targets=[];if(Env.browser.isIE()&&Env.browser.version.major<11){initError('TinyMCE does not support the browser you are using. For a list of supported'+' browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/');return[];}else if(isQuirksMode){initError('Failed to initialize the editor as the document is not in standards mode. '+'TinyMCE requires standards mode.');return[];}if(settings.types){each$1(settings.types,function(type){targets=targets.concat(DOM.select(type.selector));});return targets;}else if(settings.selector){return DOM.select(settings.selector);}else if(settings.target){return[settings.target];}switch(settings.mode){case'exact':var l=settings.elements||'';if(l.length>0){each$1(explode(l),function(id){var elm=DOM.get(id);if(elm){targets.push(elm);}else{each$1(document.forms,function(f){each$1(f.elements,function(e){if(e.name===id){id='mce_editor_'+instanceCounter++;DOM.setAttrib(e,'id',id);targets.push(e);}});});}});}break;case'textareas':case'specific_textareas':each$1(DOM.select('textarea'),function(elm){if(settings.editor_deselector&&hasClass(elm,settings.editor_deselector)){return;}if(!settings.editor_selector||hasClass(elm,settings.editor_selector)){targets.push(elm);}});break;}return targets;};var provideResults=function provideResults(editors){result=editors;};var _initEditors=function initEditors(){var initCount=0;var editors=[];var targets;var createEditor=function createEditor(id,settings,targetElm){var editor=new Editor(id,settings,self);editors.push(editor);editor.on('init',function(){if(++initCount===targets.length){provideResults(editors);}});editor.targetElm=editor.targetElm||targetElm;editor.render();};DOM.unbind(window,'ready',_initEditors);execCallback('onpageload');targets=DomQuery.unique(findTargets(settings));if(settings.types){each$1(settings.types,function(type){Tools.each(targets,function(elm){if(DOM.is(elm,type.selector)){createEditor(createId(elm),extend$2({},settings,type),elm);return false;}return true;});});return;}Tools.each(targets,function(elm){purgeDestroyedEditor(self.get(elm.id));});targets=Tools.grep(targets,function(elm){return!self.get(elm.id);});if(targets.length===0){provideResults([]);}else{each$1(targets,function(elm){if(isInvalidInlineTarget(settings,elm)){initError('Could not initialize inline editor on invalid inline target element',elm);}else{createEditor(createId(elm),settings,elm);}});}};self.settings=settings;DOM.bind(window,'ready',_initEditors);return new promiseObj(function(resolve){if(result){resolve(result);}else{provideResults=function provideResults(editors){resolve(editors);};}});},get:function get(id){if(arguments.length===0){return editors.slice(0);}else if(isString$1(id)){return find$3(editors,function(editor){return editor.id===id;}).getOr(null);}else if(isNumber(id)){return editors[id]?editors[id]:null;}else{return null;}},add:function add(editor){var self=this;var existingEditor=legacyEditors[editor.id];if(existingEditor===editor){return editor;}if(self.get(editor.id)===null){if(isValidLegacyKey(editor.id)){legacyEditors[editor.id]=editor;}legacyEditors.push(editor);editors.push(editor);}toggleGlobalEvents(true);self.activeEditor=editor;self.fire('AddEditor',{editor:editor});if(!beforeUnloadDelegate){beforeUnloadDelegate=function beforeUnloadDelegate(e){var event=self.fire('BeforeUnload');if(event.returnValue){e.preventDefault();e.returnValue=event.returnValue;return event.returnValue;}};window.addEventListener('beforeunload',beforeUnloadDelegate);}return editor;},createEditor:function createEditor(id,settings){return this.add(new Editor(id,settings,this));},remove:function remove(selector){var self=this;var i,editor;if(!selector){for(i=editors.length-1;i>=0;i--){self.remove(editors[i]);}return;}if(isString$1(selector)){each$1(DOM.select(selector),function(elm){editor=self.get(elm.id);if(editor){self.remove(editor);}});return;}editor=selector;if(isNull(self.get(editor.id))){return null;}if(removeEditorFromList(editor)){self.fire('RemoveEditor',{editor:editor});}if(editors.length===0){window.removeEventListener('beforeunload',beforeUnloadDelegate);}editor.remove();toggleGlobalEvents(editors.length>0);return editor;},execCommand:function execCommand(cmd,ui,value){var self=this,editor=self.get(value);switch(cmd){case'mceAddEditor':if(!self.get(value)){new Editor(value,self.settings,self).render();}return true;case'mceRemoveEditor':if(editor){editor.remove();}return true;case'mceToggleEditor':if(!editor){self.execCommand('mceAddEditor',false,value);return true;}if(editor.isHidden()){editor.show();}else{editor.hide();}return true;}if(self.activeEditor){return self.activeEditor.execCommand(cmd,ui,value);}return false;},triggerSave:function triggerSave(){each$1(editors,function(editor){editor.save();});},addI18n:function addI18n(code,items){I18n.add(code,items);},translate:function translate(text){return I18n.translate(text);},setActive:function setActive(editor){var activeEditor=this.activeEditor;if(this.activeEditor!==editor){if(activeEditor){activeEditor.fire('deactivate',{relatedTarget:editor});}editor.fire('activate',{relatedTarget:activeEditor});}this.activeEditor=editor;},_setBaseUrl:function _setBaseUrl(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/,''));this.baseURI=new URI(this.baseURL);}});EditorManager.setup();var min$1=Math.min,max$1=Math.max,round$1=Math.round;var relativePosition=function relativePosition(rect,targetRect,rel){var x=targetRect.x;var y=targetRect.y;var w=rect.w;var h=rect.h;var targetW=targetRect.w;var targetH=targetRect.h;var relChars=(rel||'').split('');if(relChars[0]==='b'){y+=targetH;}if(relChars[1]==='r'){x+=targetW;}if(relChars[0]==='c'){y+=round$1(targetH/2);}if(relChars[1]==='c'){x+=round$1(targetW/2);}if(relChars[3]==='b'){y-=h;}if(relChars[4]==='r'){x-=w;}if(relChars[3]==='c'){y-=round$1(h/2);}if(relChars[4]==='c'){x-=round$1(w/2);}return create$2(x,y,w,h);};var findBestRelativePosition=function findBestRelativePosition(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++){pos=relativePosition(rect,targetRect,rels[i]);if(pos.x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y){return rels[i];}}return null;};var inflate=function inflate(rect,w,h){return create$2(rect.x-w,rect.y-h,rect.w+w*2,rect.h+h*2);};var intersect=function intersect(rect,cropRect){var x1=max$1(rect.x,cropRect.x);var y1=max$1(rect.y,cropRect.y);var x2=min$1(rect.x+rect.w,cropRect.x+cropRect.w);var y2=min$1(rect.y+rect.h,cropRect.y+cropRect.h);if(x2-x1<0||y2-y1<0){return null;}return create$2(x1,y1,x2-x1,y2-y1);};var clamp=function clamp(rect,clampRect,fixedSize){var x1=rect.x;var y1=rect.y;var x2=rect.x+rect.w;var y2=rect.y+rect.h;var cx2=clampRect.x+clampRect.w;var cy2=clampRect.y+clampRect.h;var underflowX1=max$1(0,clampRect.x-x1);var underflowY1=max$1(0,clampRect.y-y1);var overflowX2=max$1(0,x2-cx2);var overflowY2=max$1(0,y2-cy2);x1+=underflowX1;y1+=underflowY1;if(fixedSize){x2+=underflowX1;y2+=underflowY1;x1-=overflowX2;y1-=overflowY2;}x2-=overflowX2;y2-=overflowY2;return create$2(x1,y1,x2-x1,y2-y1);};var create$2=function create$2(x,y,w,h){return{x:x,y:y,w:w,h:h};};var fromClientRect=function fromClientRect(clientRect){return create$2(clientRect.left,clientRect.top,clientRect.width,clientRect.height);};var Rect={inflate:inflate,relativePosition:relativePosition,findBestRelativePosition:findBestRelativePosition,intersect:intersect,clamp:clamp,create:create$2,fromClientRect:fromClientRect};var awaiter=function awaiter(resolveCb,rejectCb,timeout){if(timeout===void 0){timeout=1000;}var done=false;var timer=null;var complete=function complete(completer){return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}if(!done){done=true;if(timer!==null){clearTimeout(timer);timer=null;}completer.apply(null,args);}};};var resolve=complete(resolveCb);var reject=complete(rejectCb);var start=function start(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}if(!done&&timer===null){timer=setTimeout(function(){return reject.apply(null,args);},timeout);}};return{start:start,resolve:resolve,reject:reject};};var create$1=function create$1(){var tasks={};var resultFns={};var load=function load(id,url){var loadErrMsg='Script at URL \"'+url+'\" failed to load';var runErrMsg='Script at URL \"'+url+'\" did not call `tinymce.Resource.add(\\''+id+'\\', data)` within 1 second';if(tasks[id]!==undefined){return tasks[id];}else{var task=new promiseObj(function(resolve,reject){var waiter=awaiter(resolve,reject);resultFns[id]=waiter.resolve;ScriptLoader.ScriptLoader.loadScript(url,function(){return waiter.start(runErrMsg);},function(){return waiter.reject(loadErrMsg);});});tasks[id]=task;return task;}};var add=function add(id,data){if(resultFns[id]!==undefined){resultFns[id](data);delete resultFns[id];}tasks[id]=promiseObj.resolve(data);};return{load:load,add:add};};var Resource=create$1();var each=Tools.each,extend$1=Tools.extend;var _extendClass,initializing;var Class=function Class(){};Class.extend=_extendClass=function extendClass(props){var self=this;var _super=self.prototype;var Class=function Class(){var i,mixins,mixin;var self=this;if(!initializing){if(self.init){self.init.apply(self,arguments);}mixins=self.Mixins;if(mixins){i=mixins.length;while(i--){mixin=mixins[i];if(mixin.init){mixin.init.apply(self,arguments);}}}}};var dummy=function dummy(){return this;};var createMethod=function createMethod(name,fn){return function(){var self=this;var tmp=self._super;self._super=_super[name];var ret=fn.apply(self,arguments);self._super=tmp;return ret;};};initializing=true;var prototype=new self();initializing=false;if(props.Mixins){each(props.Mixins,function(mixin){for(var name_1 in mixin){if(name_1!=='init'){props[name_1]=mixin[name_1];}}});if(_super.Mixins){props.Mixins=_super.Mixins.concat(props.Mixins);}}if(props.Methods){each(props.Methods.split(','),function(name){props[name]=dummy;});}if(props.Properties){each(props.Properties.split(','),function(name){var fieldName='_'+name;props[name]=function(value){var self=this;if(value!==undefined){self[fieldName]=value;return self;}return self[fieldName];};});}if(props.Statics){each(props.Statics,function(func,name){Class[name]=func;});}if(props.Defaults&&_super.Defaults){props.Defaults=extend$1({},_super.Defaults,props.Defaults);}each$j(props,function(member,name){if(typeof member==='function'&&_super[name]){prototype[name]=createMethod(name,member);}else{prototype[name]=member;}});Class.prototype=prototype;Class.constructor=Class;Class.extend=_extendClass;return Class;};var min=Math.min,max=Math.max,round=Math.round;var Color=function Color(value){var self={};var r=0,g=0,b=0;var rgb2hsv=function rgb2hsv(r,g,b){var h,s,v;h=0;s=0;v=0;r=r/255;g=g/255;b=b/255;var minRGB=min(r,min(g,b));var maxRGB=max(r,max(g,b));if(minRGB===maxRGB){v=minRGB;return{h:0,s:0,v:v*100};}var d=r===minRGB?g-b:b===minRGB?r-g:b-r;h=r===minRGB?3:b===minRGB?1:5;h=60*(h-d/(maxRGB-minRGB));s=(maxRGB-minRGB)/maxRGB;v=maxRGB;return{h:round(h),s:round(s*100),v:round(v*100)};};var hsvToRgb=function hsvToRgb(hue,saturation,brightness){hue=(parseInt(hue,10)||0)%360;saturation=parseInt(saturation,10)/100;brightness=parseInt(brightness,10)/100;saturation=max(0,min(saturation,1));brightness=max(0,min(brightness,1));if(saturation===0){r=g=b=round(255*brightness);return;}var side=hue/60;var chroma=brightness*saturation;var x=chroma*(1-Math.abs(side%2-1));var match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma;g=x;b=0;break;case 1:r=x;g=chroma;b=0;break;case 2:r=0;g=chroma;b=x;break;case 3:r=0;g=x;b=chroma;break;case 4:r=x;g=0;b=chroma;break;case 5:r=chroma;g=0;b=x;break;default:r=g=b=0;}r=round(255*(r+match));g=round(255*(g+match));b=round(255*(b+match));};var toHex=function toHex(){var hex=function hex(val){val=parseInt(val,10).toString(16);return val.length>1?val:'0'+val;};return'#'+hex(r)+hex(g)+hex(b);};var toRgb=function toRgb(){return{r:r,g:g,b:b};};var toHsv=function toHsv(){return rgb2hsv(r,g,b);};var parse=function parse(value){var matches;if(typeof value==='object'){if('r'in value){r=value.r;g=value.g;b=value.b;}else if('v'in value){hsvToRgb(value.h,value.s,value.v);}}else{if(matches=/rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value)){r=parseInt(matches[1],10);g=parseInt(matches[2],10);b=parseInt(matches[3],10);}else if(matches=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value)){r=parseInt(matches[1],16);g=parseInt(matches[2],16);b=parseInt(matches[3],16);}else if(matches=/#([0-F])([0-F])([0-F])/gi.exec(value)){r=parseInt(matches[1]+matches[1],16);g=parseInt(matches[2]+matches[2],16);b=parseInt(matches[3]+matches[3],16);}}r=r<0?0:r>255?255:r;g=g<0?0:g>255?255:g;b=b<0?0:b>255?255:b;return self;};if(value){parse(value);}self.toRgb=toRgb;self.toHsv=toHsv;self.toHex=toHex;self.parse=parse;return self;};var serialize=function serialize(obj){var data=JSON.stringify(obj);if(!isString$1(data)){return data;}return data.replace(/[\\u0080-\\uFFFF]/g,function(match){var hexCode=match.charCodeAt(0).toString(16);return'\\\\u'+'0000'.substring(hexCode.length)+hexCode;});};var JSONUtils={serialize:serialize,parse:function parse(text){try{return JSON.parse(text);}catch(ex){}}};var JSONP={callbacks:{},count:0,send:function send(settings){var self=this,dom=_DOMUtils.DOM,count=settings.count!==undefined?settings.count:self.count;var id='tinymce_jsonp_'+count;self.callbacks[count]=function(json){dom.remove(id);delete self.callbacks[count];settings.callback(json);};dom.add(dom.doc.body,'script',{id:id,src:settings.url,type:'text/javascript'});self.count++;}};var XHR=_assign(_assign({},Observable),{send:function send(settings){var xhr,count=0;var _ready=function ready(){if(!settings.async||xhr.readyState===4||count++>10000){if(settings.success&&count<10000&&xhr.status===200){settings.success.call(settings.success_scope,''+xhr.responseText,xhr,settings);}else if(settings.error){settings.error.call(settings.error_scope,count>10000?'TIMED_OUT':'GENERAL',xhr,settings);}xhr=null;}else{Delay.setTimeout(_ready,10);}};settings.scope=settings.scope||this;settings.success_scope=settings.success_scope||settings.scope;settings.error_scope=settings.error_scope||settings.scope;settings.async=settings.async!==false;settings.data=settings.data||'';XHR.fire('beforeInitialize',{settings:settings});xhr=new XMLHttpRequest();if(xhr.overrideMimeType){xhr.overrideMimeType(settings.content_type);}xhr.open(settings.type||(settings.data?'POST':'GET'),settings.url,settings.async);if(settings.crossDomain){xhr.withCredentials=true;}if(settings.content_type){xhr.setRequestHeader('Content-Type',settings.content_type);}if(settings.requestheaders){Tools.each(settings.requestheaders,function(header){xhr.setRequestHeader(header.key,header.value);});}xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr=XHR.fire('beforeSend',{xhr:xhr,settings:settings}).xhr;xhr.send(settings.data);if(!settings.async){return _ready();}Delay.setTimeout(_ready,10);}});var extend=Tools.extend;var JSONRequest=function(){function JSONRequest(settings){this.settings=extend({},settings);this.count=0;}JSONRequest.sendRPC=function(o){return new JSONRequest().send(o);};JSONRequest.prototype.send=function(args){var ecb=args.error,scb=args.success;var xhrArgs=extend(this.settings,args);xhrArgs.success=function(c,x){c=JSONUtils.parse(c);if(typeof c==='undefined'){c={error:'JSON Parse error.'};}if(c.error){ecb.call(xhrArgs.error_scope||xhrArgs.scope,c.error,x);}else{scb.call(xhrArgs.success_scope||xhrArgs.scope,c.result);}};xhrArgs.error=function(ty,x){if(ecb){ecb.call(xhrArgs.error_scope||xhrArgs.scope,ty,x);}};xhrArgs.data=JSONUtils.serialize({id:args.id||'c'+this.count++,method:args.method,params:args.params});xhrArgs.content_type='application/json';XHR.send(xhrArgs);};return JSONRequest;}();var create=function create(){return function(){var data={};var keys=[];var storage={getItem:function getItem(key){var item=data[key];return item?item:null;},setItem:function setItem(key,value){keys.push(key);data[key]=String(value);},key:function key(index){return keys[index];},removeItem:function removeItem(key){keys=keys.filter(function(k){return k===key;});delete data[key];},clear:function clear(){keys=[];data={};},length:0};Object.defineProperty(storage,'length',{get:function get(){return keys.length;},configurable:false,enumerable:false});return storage;}();};var localStorage;try{var test='__storage_test__';localStorage=window.localStorage;localStorage.setItem(test,test);localStorage.removeItem(test);}catch(e){localStorage=create();}var LocalStorage=localStorage;var publicApi={geom:{Rect:Rect},util:{Promise:promiseObj,Delay:Delay,Tools:Tools,VK:VK,URI:URI,Class:Class,EventDispatcher:EventDispatcher,Observable:Observable,I18n:I18n,XHR:XHR,JSON:JSONUtils,JSONRequest:JSONRequest,JSONP:JSONP,LocalStorage:LocalStorage,Color:Color,ImageUploader:ImageUploader},dom:{EventUtils:EventUtils,Sizzle:Sizzle,DomQuery:DomQuery,TreeWalker:DomTreeWalker,TextSeeker:TextSeeker,DOMUtils:_DOMUtils,ScriptLoader:ScriptLoader,RangeUtils:RangeUtils,Serializer:DomSerializer,StyleSheetLoader:StyleSheetLoader,ControlSelection:ControlSelection,BookmarkManager:BookmarkManager,Selection:EditorSelection,Event:EventUtils.Event},html:{Styles:Styles,Entities:Entities,Node:AstNode,Schema:Schema,SaxParser:SaxParser,DomParser:DomParser,Writer:Writer,Serializer:HtmlSerializer},Env:Env,AddOnManager:_AddOnManager,Annotator:Annotator,Formatter:Formatter,UndoManager:UndoManager,EditorCommands:EditorCommands,WindowManager:WindowManager,NotificationManager:NotificationManager,EditorObservable:EditorObservable,Shortcuts:Shortcuts,Editor:Editor,FocusManager:FocusManager,EditorManager:EditorManager,DOM:_DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager:PluginManager,ThemeManager:ThemeManager,IconManager:IconManager,Resource:Resource,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,create:Tools.create,walk:Tools.walk,createNS:Tools.createNS,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix,isOpera:Env.opera,isWebKit:Env.webkit,isIE:Env.ie,isGecko:Env.gecko,isMac:Env.mac};var tinymce=Tools.extend(EditorManager,publicApi);var exportToModuleLoaders=function exportToModuleLoaders(tinymce){if(true){try{module.exports=tinymce;}catch(_){}}};var exportToWindowGlobal=function exportToWindowGlobal(tinymce){window.tinymce=tinymce;window.tinyMCE=tinymce;};exportToWindowGlobal(tinymce);exportToModuleLoaders(tinymce);})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/tinymce.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./TinyMCEComponent/index.ts");
/******/ 	pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad = __webpack_exports__;
/******/ 	
/******/ })()
;
if (window.ComponentFramework && window.ComponentFramework.registerControl) {
	ComponentFramework.registerControl('KimleyHorn.TinyMCEComponent', pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.TinyMCEComponent);
} else {
	var KimleyHorn = KimleyHorn || {};
	KimleyHorn.TinyMCEComponent = pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.TinyMCEComponent;
	pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad = undefined;
}